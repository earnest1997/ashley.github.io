{"meta":{"title":"Ashley's blog","subtitle":null,"description":null,"author":"Ashley","url":"https://ashleyblog.xyz","root":"/ashley271017.github.io/"},"pages":[{"title":"","date":"2023-04-15T14:19:04.358Z","updated":"2023-04-15T14:19:04.358Z","comments":true,"path":"404.html","permalink":"https://ashleyblog.xyz/404.html","excerpt":"","text":"404 Not Found | Material X function setLoadingBarProgress(num) { document.getElementById('loading-bar').style.width=num+\"%\"; } Ashley's blog &nbsp;åšæ–‡ &nbsp;æ”¶è— &nbsp;å…³äº Material X &nbsp;ç¤ºä¾‹ &nbsp;åˆ†ç±» &nbsp;æ ‡ç­¾ &nbsp;è¿‘æœŸæ–‡ç«  &nbsp;æˆ‘çš„å‹é“¾ setLoadingBarProgress(40); 404 Not Found **å¾ˆæŠ±æ­‰ï¼Œæ‚¨è®¿é—®çš„é¡µé¢ä¸å­˜åœ¨** å¯èƒ½æ˜¯è¾“å…¥åœ°å€æœ‰è¯¯æˆ–è¯¥åœ°å€å·²è¢«åˆ é™¤ &nbsp;Comments &nbsp;&nbsp;ç«™å†…å¯¼èˆª è¿‘æœŸæ–‡ç«  æˆ‘çš„å‹é“¾ &nbsp;&nbsp;Hot Tags BOM css css hooks es6 eslint - eslint git git sass hooks,react-router jsæŠ€å·§ nodeè¿›ç¨‹ nodeè¿›ç¨‹é€šä¿¡ æ¨¡å—åŒ– åŠ¨æ€å¼•å…¥ pm2 react hooks react-router react-router useeffect react-transition-group reactçŠ¶æ€ç®¡ç† sass css scss ts webpack å‰ç«¯å·¥å…· åŸºç¡€æŠ€èƒ½ æ•ˆç‡æå‡é…ç½® æ¨¡å—åŒ– æ­£åˆ™è¡¨è¾¾å¼ ç§»åŠ¨ç«¯é€‚é… é¢ç» é¡¹ç›®æ­å»º Ashley Â© 2018- é„‚ICPå¤‡17030443å· æ€»è®¿é—®é‡ä¸º æ¬¡ . setLoadingBarProgress(80); setLoadingBarProgress(60); var GOOGLE_CUSTOM_SEARCH_API_KEY = \"\"; var GOOGLE_CUSTOM_SEARCH_ENGINE_ID = \"\"; var ALGOLIA_API_KEY = \"\"; var ALGOLIA_APP_ID = \"\"; var ALGOLIA_INDEX_NAME = \"\"; var AZURE_SERVICE_NAME = \"\"; var AZURE_INDEX_NAME = \"\"; var AZURE_QUERY_KEY = \"\"; var BAIDU_API_ID = \"\"; var SEARCH_SERVICE = \"hexo\" || \"hexo\"; var ROOT = \"/\"||\"/\"; if(!ROOT.endsWith('/'))ROOT += '/'; $(function() { const $reveal = $('.reveal'); if ($reveal.length === 0) return; const sr = ScrollReveal({ distance: 0 }); sr.reveal('.reveal'); const year=$('.year-now') const yearVal=new Date().getFullYear() year.text(yearVal) }); $(function() { Waves.attach('.flat-btn', ['waves-button']); Waves.attach('.float-btn', ['waves-button', 'waves-float']); Waves.attach('.float-btn-light', ['waves-button', 'waves-float', 'waves-light']); Waves.attach('.flat-box', ['waves-block']); Waves.attach('.float-box', ['waves-block', 'waves-float']); Waves.attach('.waves-image'); Waves.init(); }); $(function(){ if ('.cover') { $('.cover').backstretch( [\"/ashley271017.github.io/images/bg.jpg\"], { duration: \"6000\", fade: \"2500\" }); } else { $.backstretch( [\"/ashley271017.github.io/images/bg.jpg\"], { duration: \"6000\", fade: \"2500\" }); } }); var GUEST_INFO = ['nick','mail','link']; var guest_info = 'nick,mail,link'.split(',').filter(function(item){ return GUEST_INFO.indexOf(item) > -1 }); var notify = 'true' == true; var verify = 'true' == true; var valine = new Valine(); valine.init({ el: '#valine_container', notify: notify, verify: verify, guest_info: guest_info, path: \"/404.html\", appId: \"vu5VJ9hGtTUPkCsBP1ItVzg9-gzGzoHsz\", appKey: \"HfSu2jw0KjCyYYMydHTCArO2\", placeholder: \"è¯·ç•™è¨€å‘Šè¯‰æˆ‘æ‚¨è¦è®¿é—®å“ªä¸ªé¡µé¢æ‰¾ä¸åˆ°äº†\", pageSize:'10', avatar:'mp', lang:'zh-cn', highlight:'true' }) let COPY_SUCCESS = \"Copied\"; let COPY_FAILURE = \"Copy failed\"; /*é¡µé¢è½½å…¥å®Œæˆåï¼Œåˆ›å»ºå¤åˆ¶æŒ‰é’®*/ !function (e, t, a) { /* code */ var initCopyCode = function(){ var copyHtml = ''; copyHtml += ''; copyHtml += ' Copy'; copyHtml += ''; $(\".highlight .code pre\").before(copyHtml); var clipboard = new ClipboardJS('.btn-copy', { target: function(trigger) { return trigger.nextElementSibling; } }); clipboard.on('success', function(e) { //æ‚¨å¯ä»¥åŠ å…¥æˆåŠŸæç¤º console.info('Action:', e.action); console.info('Text:', e.text); console.info('Trigger:', e.trigger); success_prompt(COPY_SUCCESS); e.clearSelection(); }); clipboard.on('error', function(e) { //æ‚¨å¯ä»¥åŠ å…¥å¤±è´¥æç¤º console.error('Action:', e.action); console.error('Trigger:', e.trigger); fail_prompt(COPY_FAILURE); }); } initCopyCode(); }(window, document); /** * å¼¹å‡ºå¼æç¤ºæ¡†ï¼Œé»˜è®¤1.5ç§’è‡ªåŠ¨æ¶ˆå¤± * @param message æç¤ºä¿¡æ¯ * @param style æç¤ºæ ·å¼ï¼Œæœ‰alert-successã€alert-dangerã€alert-warningã€alert-info * @param time æ¶ˆå¤±æ—¶é—´ */ var prompt = function (message, style, time) { style = (style === undefined) ? 'alert-success' : style; time = (time === undefined) ? 1500 : time*1000; $('') .appendTo('body') .addClass('alert ' + style) .html(message) .show() .delay(time) .fadeOut(); }; // æˆåŠŸæç¤º var success_prompt = function(message, time) { prompt(message, 'alert-success', time); }; // å¤±è´¥æç¤º var fail_prompt = function(message, time) { prompt(message, 'alert-danger', time); }; // æé†’ var warning_prompt = function(message, time) { prompt(message, 'alert-warning', time); }; // ä¿¡æ¯æç¤º var info_prompt = function(message, time) { prompt(message, 'alert-info', time); }; let LAZY_LOAD_IMAGE = \"\"; $(\".article-entry\").find(\"fancybox\").find(\"img\").each(function () { var element = document.createElement(\"a\"); $(element).attr(\"data-fancybox\", \"gallery\"); $(element).attr(\"href\", $(this).attr(\"src\")); /* å›¾ç‰‡é‡‡ç”¨æ‡’åŠ è½½å¤„ç†æ—¶, * ä¸€èˆ¬å›¾ç‰‡æ ‡ç­¾å†…ä¼šæœ‰ä¸ªå±æ€§åæ¥å­˜æ”¾å›¾ç‰‡çš„çœŸå®åœ°å€ï¼Œæ¯”å¦‚ data-original, * é‚£ä¹ˆæ­¤å¤„å°†åŸæœ¬çš„å±æ€§åsrcæ›¿æ¢ä¸ºå¯¹åº”å±æ€§ådata-original, * ä¿®æ”¹å¦‚ä¸‹ */ if (LAZY_LOAD_IMAGE) { $(element).attr(\"href\", $(this).attr(\"data-original\")); } $(this).wrap(element); }); setLoadingBarProgress(100); if ('serviceWorker' in navigator) { navigator.serviceWorker.register('/sw.js?t=1681615907510') .then(function () {console.log('ServiceWorker Register Successfully.')}) .catch(function (e) {console.error(e)}); }"},{"title":"","date":"2023-04-02T14:00:30.303Z","updated":"2023-04-02T14:00:30.303Z","comments":true,"path":"manifest.json","permalink":"https://ashleyblog.xyz/manifest.json","excerpt":"","text":"{\"name\":\"Ashley's Blog\",\"short_name\":\"blog\",\"theme_color\":\"#2196f3\",\"background_color\":\"#2196f3\",\"display\":\"fullscreen\",\"orientation\":\"portrait\",\"Scope\":\"/\",\"start_url\":\"/\",\"icons\":[{\"src\":\"images/icons/icon-72x72.png\",\"sizes\":\"72x72\",\"type\":\"image/png\"}],\"splash_pages\":null}"},{"title":"","date":"2023-04-02T14:00:30.286Z","updated":"2023-04-02T14:00:30.285Z","comments":true,"path":"archive/index.html","permalink":"https://ashleyblog.xyz/archive/index.html","excerpt":"","text":""},{"title":"404 Not Found","date":"2023-04-02T14:00:30.305Z","updated":"2023-04-02T14:00:30.305Z","comments":true,"path":"404/index.html","permalink":"https://ashleyblog.xyz/404/index.html","excerpt":"","text":"404 Not Found **å¾ˆæŠ±æ­‰ï¼Œæ‚¨è®¿é—®çš„é¡µé¢ä¸å­˜åœ¨** å¯èƒ½æ˜¯è¾“å…¥åœ°å€æœ‰è¯¯æˆ–è¯¥åœ°å€å·²è¢«åˆ é™¤"},{"title":"å…³äº","date":"2023-04-02T14:00:30.301Z","updated":"2023-04-02T14:00:30.301Z","comments":true,"path":"about/index.html","permalink":"https://ashleyblog.xyz/about/index.html","excerpt":"","text":"å…³äºæœ¬ç«™ ä¸»è¦ç”¨äºè®°å½•æ—¥å¸¸å¼€å‘ä¸­çš„æ”¶è·ä¸å­¦åˆ°çš„æ–°æŠ€èƒ½ï½ï½ä¹‹å‰æ˜¯ä¸æœ‹å‹ä¸€èµ·ç»´æŠ¤ä¸€ä¸ªå«åšfrontnoteçš„githubä»“åº“ ä½†æ˜¯å‘ç°è®°çš„å¤ªä¹±å†²çªå¤ªå¤šäº†ã€‚ã€‚ å·²å‡çº§https,æ”¯æŒPWA~ ä¸‹ä¸€æ­¥:æ¥å…¥ç™¾åº¦ç»Ÿè®¡ ä¼˜åŒ–seoâ€¦ Day Day up~"},{"title":"collect","date":"2019-09-01T06:48:25.000Z","updated":"2023-04-02T14:00:30.285Z","comments":true,"path":"collect/index.html","permalink":"https://ashleyblog.xyz/collect/index.html","excerpt":"","text":"node ä»é›¶å¼€å‘ä¸€ä¸ªnodeå‘½ä»¤è¡Œå·¥å…· nodeè¿›ç¨‹ ä½ å¯èƒ½æƒ³çŸ¥é“çš„ Node å­è¿›ç¨‹æ¨¡å— ä½ åº”è¯¥çŸ¥é“çš„Node.jså­è¿›ç¨‹ Node.js å­è¿›ç¨‹ï¼šä½ éœ€è¦çŸ¥é“çš„ä¸€åˆ‡ Node JSåç«¯é¡¹ç›®å¼€å‘ä¸ç”Ÿäº§ç¯å¢ƒæ€»ç»“ nodeæµ Node.js æµ: ä½ éœ€è¦çŸ¥é“çš„ä¸€åˆ‡ webpack webpack 4 Code Splitting çš„ splitChunks é…ç½®æ¢ç´¢ - è…¾è®¯Webå‰ç«¯ IMWeb å›¢é˜Ÿç¤¾åŒº | blog | å›¢é˜Ÿåšå®¢ webpackå¤šå…¥å£æ–‡ä»¶ è¦ç‚¹ glob.sync docker å‘½ä»¤è¯´æ˜ Â· Docker â€”â€” ä»å…¥é—¨åˆ°å®è·µ flutter (1) Flutter çŠ¶æ€ç®¡ç†ä¹‹ Scoped Model &amp; Redux - æ˜é‡‘ Flutter Â· è¯­é›€ é¢è¯•å¿…å¤‡è®¡ç®—æœºåŸºç¡€ http2 pwa service workerä»‹ç» ç”Ÿæˆmanifest.json service workerç”Ÿå‘½å‘¨æœŸ service workerç¦»çº¿ç¼“å­˜ å¸¸è§é—®é¢˜ è·¨åŸŸé—®é¢˜ SEO ä½œä¸ºå‰ç«¯ï¼Œä½ ä¸å¾—ä¸çŸ¥é“çš„æœç´¢å¼•æ“ä¼˜åŒ– å‰ç«¯æ€§èƒ½ç›‘æ§ å‰ç«¯é”™è¯¯ç›‘æ§ä¸æ”¶é›†æ¢ç©¶ å¦‚ä½•åˆ†æç½‘é¡µæ€§èƒ½ç“¶é¢ˆ"},{"title":"","date":"2023-04-02T14:00:30.303Z","updated":"2023-04-02T14:00:30.303Z","comments":true,"path":"private/index.html","permalink":"https://ashleyblog.xyz/private/index.html","excerpt":"","text":"å‰ç«¯é…ç½®æœ¬åœ°ä»£ç†æ–¹æ³•æ€»ç»“ https://juejin.im/post/5c0a6be4f265da616f6fc79c123456789101112131415161718192021devServer: &#123; proxy: &#123; '/api': &#123; // éœ€è¦ç›´æ¥ä»£ç†åˆ°çº¿ä¸Šç¯å¢ƒçš„æ¥å£ target: 'http://ad.server.com', changeOrigin: true, headers: &#123; // åç«¯è¦æ ¡éªŒè¯·æ±‚æºï¼Œé‚£æ”¹ä¸‹ host æˆ–è€… origin ä¸å°±ç¾æ»‹æ»‹äº†ï¼Ÿ Host: 'ad.server.com', Origin: 'ad.server.com' &#125;, &#125;, '/apitest': &#123; // éœ€è¦ä¸åç«¯è”è°ƒçš„æ¥å£ target: '10.8.0.1:9909',// åç«¯æœ¬åœ°å¼€å‘ç¯å¢ƒ &#125;, '/iframe': &#123; target: 'http://localhost:8085', &#125; // å¦å¤–è¿˜æœ‰ iframe é‡Œçš„ api è°ƒç”¨æŒ‡å‘çº¿ä¸Šç¯å¢ƒ &#125; &#125; ç„¶è€Œï¼Œåç«¯æ¥å£æ®‹é…·åœ°ç»™è·³è½¬åˆ°ç™»é™†æ¥å£å»äº† ğŸ˜­ã€‚çŒœæƒ³ä¸€ä¸‹å¯èƒ½åç«¯çš„æ¥å£æ˜¯é€šè¿‡ cookie æ¥åˆ¤æ–­å½“å‰ç™»é™†åŸŸçš„ï¼Œä» localhost è¿‡å»çš„è¯·æ±‚ä¸å¸¦ cookieã€‚åæ¥å°è¯•å‘ç°åœ¨ proxyçš„headersé‡Œå†å¢åŠ  cookie å³å¯ç ´è·³è½¬ï¼Œä½†æ˜¯è¯·æ±‚è¿‡å»è¿”å›ç»“æœè¿˜æ˜¯åœ¨æŠ¥é”™ï¼Œåç«¯è¡¨ç¤ºä»ç„¶æ˜¯è®¤è¯å¤±è´¥ ä½œè€…ï¼šè¡¨ç¤ºå¾ˆä¸è›‹å®šé“¾æ¥ï¼šhttps://juejin.im/post/5c0a6be4f265da616f6fc79cæ¥æºï¼šæ˜é‡‘è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚ è§£è¯» Redux ä¸­é—´ä»¶çš„åŸç† https://juejin.im/post/59dc7e43f265da4332268906"},{"title":"æˆ‘çš„æœ‹å‹ä»¬","date":"2023-04-02T14:00:30.304Z","updated":"2023-04-02T14:00:30.304Z","comments":true,"path":"friends/index.html","permalink":"https://ashleyblog.xyz/friends/index.html","excerpt":"","text":""},{"title":"æ‰€æœ‰åˆ†ç±»","date":"2023-04-02T14:00:30.302Z","updated":"2023-04-02T14:00:30.302Z","comments":true,"path":"blog/category/index.html","permalink":"https://ashleyblog.xyz/blog/category/index.html","excerpt":"","text":""},{"title":"æ‰€æœ‰æ ‡ç­¾","date":"2023-04-02T14:00:30.302Z","updated":"2023-04-02T14:00:30.302Z","comments":true,"path":"blog/tags/index.html","permalink":"https://ashleyblog.xyz/blog/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"å‰ç«¯åŒ…ç®¡ç†å·¥å…·","slug":"å‰ç«¯åŒ…ç®¡ç†å·¥å…·","date":"2023-04-23T15:39:34.000Z","updated":"2023-04-16T03:23:41.989Z","comments":true,"path":"2023/04/23/å‰ç«¯åŒ…ç®¡ç†å·¥å…·/","link":"","permalink":"https://ashleyblog.xyz/2023/04/23/å‰ç«¯åŒ…ç®¡ç†å·¥å…·/","excerpt":"","text":"å½“ä¸‹æœ€ç«çš„åŒ…ç®¡ç†å·¥å…·æ˜¯pnpmï¼Œåœ¨å…¶å‡ºç°ä¹‹å‰ï¼Œå‰ç«¯æœ€å¸¸ç”¨çš„åŒ…ç®¡ç†å·¥å…·æœ‰ä¸¤ä¸ª npmã€yarnï¼Œé‚£ä¸ºä»€ä¹ˆä¼šå‡ºç° pnpm å‘¢ï¼Œä»¥åŠ pnpm çš„å‡ºç°åˆ°åº•è§£å†³äº†å“ªäº›é—®é¢˜ï¼Ÿ npm å­˜åœ¨çš„é—®é¢˜1ã€æ—©æœŸnpm çš„ node_modules é‡‡ç”¨äº†åµŒå¥—ç»“æ„ï¼Œå®Œå…¨æŒ‰ç…§ç›®å½•ç»“æ„æ¥ä¸‹è½½ä¾èµ–æ ‘ï¼Œå®¹æ˜“é€ æˆä¾èµ–é»‘æ´ï¼Œæœ€å…³é”®çš„æ˜¯windowsä¸Šæ”¯æŒçš„æ–‡ä»¶è·¯å¾„æœ€é•¿æ˜¯ 260 å¤šä¸ªå­—ç¬¦ã€‚ 2ã€å•ä¸ªé¡¹ç›®ä¸­ï¼ŒåŒä¸€ä¸ªç‰ˆæœ¬çš„ä¾èµ–åŒ…ï¼Œæœ‰å¯èƒ½è¢«ä¸‹è½½å¤šæ¬¡ï¼›å¤šä¸ªé¡¹ç›®ä¸­ï¼Œæ¯æ¬¡éƒ½éœ€è¦é‡æ–°ä¸‹è½½æ‰€æœ‰ä¾èµ–åŒ…ï¼Œæµªè´¹äº†å¤§é‡çš„ç£ç›˜ç©ºé—´ã€‚ npm2.x ç›®å½•ç»“æ„123456789node_modules â”œâ”€â”€ moduleA â”‚ â””â”€â”€ node_modules â”‚ â””â”€â”€ moduleC â””â”€â”€ moduleB â””â”€â”€ node_modules â””â”€â”€ moduleC â””â”€â”€ node_modules â””â”€â”€ moduleD ä»ä¸Šé¢çš„ç›®å½•ç»“æ„æˆ‘ä»¬èƒ½çœ‹åˆ°ï¼Œå¤šå±‚çš„åµŒå¥—ç»“æ„ï¼Œä»¥åŠ moduleC åŒæ—¶è¢«moduleAã€moduleBä¾èµ–ï¼Œæ‰€ä»¥è¢«é‡å¤ä¸‹è½½äº†ä¸¤æ¬¡ã€‚ npm å®˜æ–¹åœ¨ npm3.x ä¸­å¯¹ä¸Šè¿°é—®é¢˜åšäº†æ”¹è¿›ã€‚ npm3.x ä¸­ node_modules é‡‡ç”¨äº†æ‰å¹³åŒ–ç»“æ„ã€‚å°†æ‰€æœ‰çš„å­ä¾èµ–éƒ½æå‡åˆ°æ ¹ç›®å½•ä¸‹ã€‚ä¹Ÿå°±æ˜¯ hoist æœºåˆ¶ã€‚ npm3.x ç›®å½•ç»“æ„12345node_modules â”œâ”€â”€ moduleA â”œâ”€â”€ moduleB â””â”€â”€ moduleC â””â”€â”€ moduleD è¿™åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šè§£å†³äº†åœ°ç‹±ä¾èµ–çš„é—®é¢˜ï¼Œä»¥åŠç£ç›˜ç©ºé—´çš„æµªè´¹é—®é¢˜ï¼Œä½†åŒæ—¶åˆå¸¦æ¥äº†å…¶ä»–é—®é¢˜ 1ã€å¹½çµä¾èµ–åœ¨package.jsonä¸­æ²¡æœ‰å£°æ˜çš„ä¾èµ–åŒ…ï¼Œå› ä¸ºè¢«å…¶ä»–åŒ…ä¾èµ–ï¼Œè¢«ä¸‹è½½å¹¶æå‡åˆ° node_modules æ ¹ç›®å½•ä¸‹ï¼Œå¯¼è‡´ç›´æ¥å¯ä»¥åœ¨é¡¹ç›®ä¸­å»å¼•ç”¨ã€‚ 2ã€ä¸‹è½½æ–‡ä»¶çš„ä¸ç¡®å®šæ€§åŒä¸€ä»½ package.jsonï¼Œä¸‹è½½å‡ºæ¥çš„ node_modules å¯èƒ½ä¸ä¸€è‡´çš„é—®é¢˜ã€‚ 3ã€ä¾èµ–é‡å¤å®‰è£…è¿™ä¸ªä¹Ÿå¾ˆå¥½ç†è§£ï¼ŒABéƒ½ä¾èµ–æŸä¸ªåŒ…ï¼Œä¾èµ–ä¸åŒçš„ç‰ˆæœ¬ï¼Œæ— è®ºnode_modulesçš„é¡¶å±‚æå‡äº†å“ªä¸ªç‰ˆæœ¬ï¼Œè¿™ä¸ªåŒ…éƒ½æ˜¯ä¼šè¢«å®‰è£…ä¸¤æ¬¡çš„ã€‚è¿™ä¼šåŠ å‰§node_moduleså¯¹ç£ç›˜ç©ºé—´çš„å ç”¨ç‡ ä¹Ÿå°±æ˜¯è¯´ä¸¤ä¸ªä¾èµ–åŒ…åŒæ—¶ä¾èµ–çš„CåŒ…çš„ä¸åŒç‰ˆæœ¬ï¼ŒCåŒ…åªæœ‰ä¸€ä¸ªç‰ˆæœ¬ä¼šè¢« hoistï¼Œé‚£ä¹ˆåˆ°åº•åº”è¯¥æå‡å“ªä¸ªç‰ˆæœ¬å‘¢ï¼Œç­”æ¡ˆæ˜¯ä¸ç¡®å®šã€‚ npm 5.x ä¸ºæ­¤æ–°å¢äº† package-lock.json æ–‡ä»¶ï¼Œç”¨æ¥é”å®šä¾èµ–åŒ…çš„ç‰ˆæœ¬å·ï¼Œä»¥åŠç¡®å®šä¸åŒç‰ˆæœ¬å¦‚ä½• hoist çš„é—®é¢˜ã€‚ è¿™æ ·å°±ç¡®ä¿äº†åŒä¸€ä»½ package.json ä¸‹è½½å‡ºæ¥çš„ node_modules ç›®å½•ç»“æ„ä¸€è‡´ã€ä½† å¹½çµä¾èµ– é—®é¢˜ä»ç„¶æ²¡æœ‰å¾—åˆ°è§£å†³ yarnyarn çš„å‡ºç°ï¼Œå¼¥è¡¥äº† npm2.x çš„ä¼—å¤šç¼ºé™·ã€‚ 1ã€é‡‡ç”¨æ‰å¹³åŒ–çš„æ–¹å¼ç®¡ç† node_modulesï¼Œå¹¶ä¸”é¦–æ¬¡æå‡ºäº†ç¦»çº¿ç¼“å­˜ä¸‹è½½çš„æ¦‚å¿µï¼Œä¸‹è½½é€Ÿåº¦å¤§å¹…æå‡ã€‚ 2ã€yarn.lockyarn.lock ç”¨æ¥ç¡®å®šä¾èµ–æ ‘ä¹‹é—´çš„ç»“æ„ï¼Œç¡®ä¿åŒä¸€ä¸ªé¡¹ç›®ç”ŸæˆåŒæ ·çš„ node_modules ä½†æ˜¯ yarn è·Ÿ npm ä¸€æ ·ï¼Œéƒ½æ²¡æœ‰è§£å†³å¹½çµä¾èµ–çš„é—®é¢˜ã€‚ pnpmpnpm åœ¨ 2017 å¹´å‘å¸ƒï¼Œå®ƒçš„å‡ºç°ï¼Œè§£å†³äº† npmã€yarn é•¿æœŸä»¥æ¥å­˜åœ¨çš„æ€§èƒ½ã€å®‰å…¨è®¿é—®ç­‰é—®é¢˜ã€‚ ç›¸å¯¹äºåˆ«çš„åŒ…ç®¡ç†å·¥å…·å…·æœ‰å¦‚ä¸‹çš„ç‰¹ç‚¹ï¼š åŒ…å®‰è£…é€Ÿåº¦æå¿«ï¼› ç£ç›˜ç©ºé—´åˆ©ç”¨éå¸¸é«˜æ•ˆã€‚ pnpmçš„åŒ…ç®¡ç†æ–¹å¼æ˜¯é€šè¿‡å»ºç«‹é“¾æ¥+storeçš„æ–¹å¼æ¥å®Œæˆå¿«é€Ÿå®‰è£…å’Œé˜²æ­¢é‡å¤å®‰è£…ï¼ˆä»¥å‡å°‘ç£ç›˜ç©ºé—´ï¼‰çš„é—®é¢˜ã€‚ storepnpm é»˜è®¤ä¼šå°†æ‰€æœ‰ä¾èµ–åŒ…ä¸‹è½½åˆ°ç³»ç»Ÿ{home dir}/Library/pnpm/store/v3ä¸­ï¼Œç³»ç»Ÿä¸­ç›¸åŒæ–‡ä»¶åªä¼šå­˜åœ¨ä¸€ä»½ã€‚ è½¯ç¡¬é“¾æ¥è½¯è¿æ¥æ¯ä¸ªé¡¹ç›® node_modules ä¸‹å®‰è£…çš„åŒ…ç»“æ„ä¸ºæ ‘çŠ¶ï¼Œç¬¦åˆ node å°±è¿‘æŸ¥æ‰¾è§„åˆ™ï¼Œä»¥è½¯é“¾æ¥æ–¹å¼å°†å†…å®¹æŒ‡å‘ node_modules/.pnpm ä¸­çš„åŒ…ã€‚ ç¡¬é“¾æ¥æ¯ä¸ªé¡¹ç›®çš„ node_modules ä¸‹æœ‰ .pnpm ç›®å½•ä»¥æ‰“å¹³ç»“æ„ç®¡ç†æ¯ä¸ªç‰ˆæœ¬åŒ…çš„æºç å†…å®¹ï¼Œä»¥ç¡¬é“¾æ¥æ–¹å¼æŒ‡å‘ pnpm-store ä¸­çš„æ–‡ä»¶åœ°å€ã€‚ è¿™æ ·å¹½çµä¾èµ–çš„é—®é¢˜å°±è§£å†³äº†ï¼ŒåŒ…ç‰ˆæœ¬ä¸ç¡®å®šæ€§çš„é—®é¢˜ä¹Ÿå°±è§£å†³äº†ã€‚æ¯•ç«Ÿé¡¶å±‚å°±åªæœ‰æˆ‘ä»¬æ‰‹åŠ¨å®‰è£…çš„åŒ…ï¼Œå…¶ä»–ä¾èµ–åŒ…éƒ½æ”¶åœ¨.pnpmä¸­ é™¤æ­¤ä¹‹å¤–ï¼Œè¿™ç§æ–¹å¼çš„å¥½å¤„æ˜¯ï¼š ä¸ä¼šé‡å¤å®‰è£…åŒä¸€ä¸ªåŒ…ã€‚ç”¨ npm/yarn çš„æ—¶å€™ï¼Œå¦‚æœ 100 ä¸ªé¡¹ç›®éƒ½ä¾èµ– lodashï¼Œé‚£ä¹ˆ lodash å¾ˆå¯èƒ½å°±è¢«å®‰è£…äº† 100 æ¬¡ï¼Œç£ç›˜ä¸­å°±æœ‰ 100 ä¸ªåœ°æ–¹å†™å…¥äº†è¿™éƒ¨åˆ†ä»£ç ã€‚ä½†åœ¨ä½¿ç”¨ pnpm åªä¼šå®‰è£…ä¸€æ¬¡ï¼Œç£ç›˜ä¸­åªæœ‰ä¸€ä¸ªåœ°æ–¹å†™å…¥ï¼Œåé¢å†æ¬¡ä½¿ç”¨éƒ½ä¼šç›´æ¥ä½¿ç”¨ hardlink(ç¡¬é“¾æ¥ï¼‰ å³ä½¿ä¸€ä¸ªåŒ…çš„ä¸åŒç‰ˆæœ¬ï¼Œpnpm ä¹Ÿä¼šæå¤§ç¨‹åº¦åœ°å¤ç”¨ä¹‹å‰ç‰ˆæœ¬çš„ä»£ç ã€‚æ¯”å¦‚ lodash æœ‰ 100 ä¸ªæ–‡ä»¶ï¼Œæ›´æ–°ç‰ˆæœ¬ä¹‹åå¤šäº†ä¸€ä¸ªæ–‡ä»¶ï¼Œé‚£ä¹ˆç£ç›˜å½“ä¸­å¹¶ä¸ä¼šé‡æ–°å†™å…¥ 101 ä¸ªæ–‡ä»¶ï¼Œè€Œæ˜¯ä¿ç•™åŸæ¥çš„ 100 ä¸ªæ–‡ä»¶çš„ hardlinkï¼Œä»…ä»…å†™å…¥é‚£ä¸€ä¸ªæ–°å¢çš„æ–‡ä»¶ã€‚ è½¯ç¡¬é“¾æ¥çš„åŒºåˆ«è½¯ç¡¬é“¾æ¥çš„åŒºåˆ« æ€»ç»“å°±æ˜¯è½¯é“¾æ¥æŒ‡å‘çš„æ˜¯æ–‡ä»¶çš„æ–‡ä»¶è·¯å¾„ï¼Œç¡¬é“¾æ¥è®°å½•çš„æ˜¯æ–‡ä»¶çš„å†…å®¹ï¼Œä½†æ˜¯å½“æºæ–‡ä»¶è¢«åˆ é™¤çš„æ—¶å€™ï¼Œç¡¬é“¾æ¥è¿˜æ˜¯èƒ½è®¿é—®ï¼ˆæ–‡ä»¶çœŸæ­£åˆ é™¤çš„æ¡ä»¶æ˜¯ä¸ä¹‹ç›¸å…³çš„æ‰€æœ‰ç¡¬è¿æ¥æ–‡ä»¶å‡è¢«åˆ é™¤ã€‚ï¼‰è½¯ç¡¬é“¾æ¥ä»»ä½•ä¸€ä¸ªæ–‡ä»¶å‘ç”Ÿæ”¹å˜ï¼Œéƒ½ä¼šåŒæ­¥åˆ°å…¶ä»–çš„é“¾æ¥ï¼Œå› æ­¤ç¡¬é“¾æ¥å¯ä»¥ç”¨æ¥è¢«å¤šä¸ªåœ°æ–¹åŒæ—¶æ“ä½œä½†æ˜¯é˜²æ­¢è¯¯åˆ ï¼Œæ‰€ä»¥pnpmä¼šä½¿ç”¨ç¡¬è¿æ¥æŒ‡å‘.pnpm store ä¸­çš„æ–‡ä»¶åœ°å€ï¼Œç›¸æ¯”ç¡¬é“¾æ¥ï¼Œè½¯é“¾æ¥çš„ä¼˜åŠ¿æ˜¯ï¼šå¯ä»¥ç«‹å³çŸ¥é“ç¬¦å·é“¾æ¥æŒ‡å‘çš„ä½ç½®ï¼Œè€Œä½¿ç”¨ç¡¬é“¾æ¥ï¼Œæ‚¨éœ€è¦æ¢ç´¢æ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿä»¥æ‰¾åˆ°å…±äº«ç›¸åŒ inode çš„æ–‡ä»¶ã€‚å› æ­¤è½¯é“¾æ¥é€šå¸¸ç”¨æ¥åšå¿«æ·æ–¹å¼ï¼Œè€Œè¿™é‡Œä½¿ç”¨è½¯é“¾æ¥æ˜¯ä¸ºäº†æ›´å¿«æ‰¾åˆ°ä¾èµ–åœ¨pnpm storeä¸­çš„ä½ç½®","categories":[],"tags":[{"name":"åŒ…ç®¡ç†","slug":"åŒ…ç®¡ç†","permalink":"https://ashleyblog.xyz/tags/åŒ…ç®¡ç†/"}]},{"title":"æ¨¡å—è”é‚¦åœ¨å¾®å‰ç«¯æ¶æ„ä¸­çš„å®è·µ","slug":"æ¨¡å—è”é‚¦åœ¨å¾®å‰ç«¯æ¶æ„ä¸­çš„å®è·µ","date":"2023-04-23T14:46:42.000Z","updated":"2023-04-16T03:21:21.262Z","comments":true,"path":"2023/04/23/æ¨¡å—è”é‚¦åœ¨å¾®å‰ç«¯æ¶æ„ä¸­çš„å®è·µ/","link":"","permalink":"https://ashleyblog.xyz/2023/04/23/æ¨¡å—è”é‚¦åœ¨å¾®å‰ç«¯æ¶æ„ä¸­çš„å®è·µ/","excerpt":"","text":"èƒŒæ™¯æˆ‘ä»¬æœ‰ä¸€ä¸ªç”¨Reactç¼–å†™çš„ç®¡ç†é¢æ¿ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬è·Ÿè¸ªå’Œç®¡ç†Trendyol GOï¼ˆHÄ±zlÄ± Marketå’ŒTrendyol Yemekï¼‰ä¸­æ‰€æœ‰é˜¶æ®µçš„è®¢å•ã€‚å•ä¸€ä»“åº“å¾ˆå¥½åœ°æ»¡è¶³äº†æˆ‘ä»¬çš„æœŸæœ›ï¼Œå› ä¸ºä¸€å¼€å§‹æˆ‘ä»¬æ˜¯å”¯ä¸€çš„å›¢é˜Ÿï¼Œå‘˜å·¥æ•°é‡ä¸å¤šã€‚ å•ä¸€çš„ä»“åº“å¹¶ä¸æ€»æ˜¯åçš„ã€‚å¦‚æœå®ƒèƒ½æ»¡è¶³ä½ çš„æœŸæœ›ï¼Œå¦‚æœå®ƒä¸ä¼šç»™ä½ å¸¦æ¥è´Ÿé¢å½±å“ï¼Œé‚£ä¹ˆä½ å¯ä»¥ä½¿ç”¨å„ç§æ–¹æ³•ã€‚é‡è¦çš„æ˜¯ï¼›æ‰¾åˆ°ä»¥æœ€æœ‰æ•ˆçš„æ–¹å¼è¾¾åˆ°ä½ çš„ç›®æ ‡çš„æ–¹æ³•ã€‚ å¤§çº¦1.5å¹´åï¼Œå½“æˆ‘ä»¬çš„é˜Ÿå‹äººæ•°å˜å¾—è¶³å¤Ÿå¤šæ—¶ï¼Œæˆ‘ä»¬ä»¥é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDDDï¼‰çš„ç†å¿µå°†æˆ‘ä»¬çš„å›¢é˜Ÿåˆ’åˆ†ä¸ºå¤šä¸ªå°å›¢é˜Ÿã€‚åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œæˆ‘ä»¬å¿…é¡»è®¾è®¡å¾®å‰ç«¯çš„ç»“æ„ï¼Œä½¿æ¯ä¸ªå›¢é˜Ÿå¯ä»¥ç‹¬ç«‹å¼€å‘åº”ç”¨ã€‚ æˆ‘ä¹‹å‰åœ¨å‡ ä¸ªä¸åŒçš„é¡¹ç›®ä¸­æœ‰è¿‡å¾®å‰ç«¯çš„ç»éªŒã€‚æˆ‘ä¹Ÿæ›¾è‡ªå·±è®¾è®¡è¿‡ä¸€ä¸ªå¾®å‰ç«¯æ¶æ„ï¼Œä½†ç ”ç©¶æ‰€æœ‰å…¶ä»–çš„æ›¿ä»£æ–¹æ¡ˆå¹¶é€‰æ‹©æœ€èƒ½æ»¡è¶³æˆ‘ä»¬éœ€æ±‚çš„æ–¹æ¡ˆæ˜¯æ›´åˆç†çš„ã€‚æˆ‘ä»¬æ¢ç´¢äº†æ‰€æœ‰çš„æ›¿ä»£æ–¹æ¡ˆï¼Œæƒè¡¡äº†æ¯ä¸ªæ–¹æ¡ˆçš„åˆ©å¼Šï¼ˆæˆ‘ä¸ä¼šåœ¨è¿™ç¯‡æ–‡ç« ä¸­è°ˆè®ºæ‰€æœ‰çš„æ›¿ä»£æ–¹æ¡ˆï¼Œå› ä¸ºé‚£æ˜¯å¦ä¸€ä¸ªè¯é¢˜ã€‚ï¼‰ï¼Œåœ¨è¯„ä¼°çš„æœ€åï¼Œæˆ‘ä»¬å‘ç°Webpack æ¨¡å—è”é‚¦å¯ä»¥å¾ˆå¥½åœ°æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ã€‚ ä¸ºä»€ä¹ˆæ˜¯Webpackæ¨¡å—è”é‚¦ï¼Ÿå½“æˆ‘ä»¬ç ”ç©¶äº†æ‰€æœ‰çš„æ›¿ä»£æ–¹æ¡ˆåï¼Œå‡ºäºä»¥ä¸‹åŸå› ï¼Œé€‰æ‹©Webpackæ¨¡å—è”é‚¦æ›´æœ‰æ„ä¹‰ã€‚ æ²¡æœ‰ç»´æŠ¤æˆæœ¬ï¼ˆå¦‚æœä½ è‡ªå·±å»ºç«‹ä¸€ä¸ªæ¶æ„ï¼Œä¼šæœ‰ç»´æŠ¤æˆæœ¬ï¼‰ æ²¡æœ‰å›¢é˜Ÿç‰¹å®šçš„å­¦ä¹ æˆæœ¬ï¼ˆå¦‚æœä½ è‡ªå·±å»ºç«‹ä¸€ä¸ªæ¶æ„ï¼Œä¼šæœ‰å­¦ä¹ æˆæœ¬ï¼‰ å‘æ¨¡å—è”é‚¦è¿‡æ¸¡çš„æˆæœ¬å¾ˆå° ä¸éœ€è¦å¯¹æ¯ä¸ªé¡¹ç›®è¿›è¡Œé‡æ–°æ¶æ„ æ‰€æœ‰çš„éœ€æ±‚éƒ½åœ¨æ„å»ºæ—¶å¾—åˆ°æ»¡è¶³ åœ¨è¿è¡Œæ—¶ä¸éœ€è¦é¢å¤–çš„å·¥ä½œ åˆ†äº«ä¾èµ–çš„æˆæœ¬ä½ åº“/æ¡†æ¶ç‹¬ç«‹ ä½ ä¸éœ€è¦å¤„ç†æ‰€æœ‰çš„å‹ç¼©å’Œç¼“å­˜é—®é¢˜ ä½ ä¸éœ€è¦å¤„ç†è·¯ç”±é—®é¢˜ Shellå’ŒMicro Appsä¸æ˜¯ç´§è€¦åˆçš„ï¼Œè€Œæ˜¯æ¾è€¦åˆçš„ æ€ä¹ˆä½¿ç”¨æ¨¡å—è”é‚¦æœ‰ä»¥ä¸‹ä¸‰ç§å½¢å¼ï¼š åŸŸå é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä½ å¯ä»¥åˆ›å»ºå°½å¯èƒ½å¤šçš„å¾®å‹å‰ç«¯ï¼ˆåº”ç”¨ç¨‹åºï¼‰ï¼Œå¹¶é€šè¿‡Shell Appç®¡ç†å®Œå…¨ç‹¬ç«‹çš„åŸŸã€‚ä¾‹å¦‚ï¼Œæƒ³è±¡ä¸€ä¸‹ï¼Œåœ¨Shell Appä¸­æœ‰ä¸€ä¸ªèœå•ï¼Œå½“é“¾æ¥è¢«ç‚¹å‡»æ—¶ï¼Œå®ƒå°†åœ¨å³è¾¹å¸¦å‡ºç›¸å…³çš„åº”ç”¨ç¨‹åºã€‚ 2.å¾®ä»¶ é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä½ å¯ä»¥ä»ä»»ä½•åº”ç”¨ç¨‹åºä¸­æ·»åŠ ä»»ä½•å¾®ä»¶/ç»„ä»¶ï¼ˆå³ä¸€å°æ®µä»£ç ï¼‰åˆ°ä»»ä½•åº”ç”¨ç¨‹åºã€‚ä½ å¯ä»¥åœ¨äº§å“åº”ç”¨ä¸­çš„ç”¨æˆ·åº”ç”¨ä¸­å…¬å¼€UserDetailç»„ä»¶ã€‚ æ··åˆå‹ ä½ å¯ä»¥åŒæ—¶ä½¿ç”¨ç¬¬ä¸€å’Œç¬¬äºŒç§æ–¹å¼ã€‚ å¼€å§‹å®è·µé¦–å…ˆåˆ›å»ºä¸€ä¸ªapp å‘½åä¸ºshellï¼Œå¹¶ä¸”ä»¥ç›¸åŒçš„æ–¹å¼åˆ›å»ºåº”ç”¨product &amp; user 1npx create-react-app shellcd shellyarn add webpack webpack-cli webpack-server html-webpack-plugin css-loader style-loader babel-loader webpack-dev-server ç¬¬ä¸€æ­¥ï¼šåˆå§‹åŒ–é¡¹ç›®123456import React from &apos;react&apos;;import ReactDOM from &apos;react-dom&apos;;import App from &apos;./App&apos;;ReactDOM.render( &lt;App /&gt;, document.getElementById(&apos;root&apos;)); ç¬¬äºŒæ­¥ï¼šé…ç½®webpack123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051const HtmlWebpackPlugin = require(&apos;html-webpack-plugin&apos;);const ModuleFederationPlugin = require(&apos;webpack/lib/container/ModuleFederationPlugin&apos;);const deps = require(&apos;./package.json&apos;).dependencies;module.exports = &#123; mode: &apos;development&apos;, devServer: &#123; port: 3001, &#125;, module: &#123; rules: [ &#123; test: /.js?$/, exclude: /node_modules/, loader: &apos;babel-loader&apos;, options: &#123; presets: [ &apos;@babel/preset-env&apos;, &apos;@babel/preset-react&apos;, ], &#125;, &#125;, &#123; test: /.css$/i, use: [&quot;style-loader&quot;, &quot;css-loader&quot;], &#125;, ], &#125;, plugins: [ new ModuleFederationPlugin( &#123; name: &apos;SHELL&apos;, filename: &apos;remoteEntry.js&apos;, shared: [ &#123; ...deps, react: &#123; requiredVersion: deps.react, singleton: true &#125;, &apos;react-dom&apos;: &#123; requiredVersion: deps[&apos;react-dom&apos;], singleton: true, &#125;, &#125;, ], &#125; ), new HtmlWebpackPlugin(&#123; template: &apos;./public/index.html&apos;, &#125;), ],&#125;; å…¶ä¸­å…³äºæ¨¡å—è”é‚¦çš„é…ç½®é¡¹ï¼Œè§£é‡Šå¦‚ä¸‹ï¼š name: æˆ‘ä»¬ç”¨å®ƒæ¥ç¡®å®šåº”ç”¨ç¨‹åºçš„åç§°ã€‚æˆ‘ä»¬å°†é€šè¿‡è¿™ä¸ªåç§°ä¸å…¶ä»–åº”ç”¨ç¨‹åºè¿›è¡Œäº¤æµã€‚ filename: æˆ‘ä»¬ç”¨å®ƒä½œä¸ºä¸€ä¸ªå…¥å£æ–‡ä»¶ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå…¶ä»–åº”ç”¨ç¨‹åºå°†èƒ½å¤Ÿé€šè¿‡è¾“å…¥ â€œSHELL@http://localhost:3001/remoteEntry.js â€œè®¿é—®SHELLåº”ç”¨ç¨‹åºã€‚ sharedï¼ˆå…±äº«ï¼‰ã€‚æˆ‘ä»¬ç”¨å®ƒæ¥æŒ‡å®šè¿™ä¸ªåº”ç”¨ç¨‹åºå°†ä¸å…¶ä»–åº”ç”¨ç¨‹åºå…±äº«å“ªäº›ä¾èµ–ã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ &quot;singleton: true&quot;ã€‚å¦‚æœä½ ä¸å†™ &quot;singleton: true&quot;ï¼Œæ¯ä¸ªåº”ç”¨ç¨‹åºå°†åœ¨ä¸€ä¸ªå•ç‹¬çš„Reactå®ä¾‹ä¸Šè¿è¡Œ æŠŠåŒæ ·çš„æ–‡ä»¶å¤åˆ¶åˆ°Userå’Œ Producté¡¹ç›®ï¼Œä½†ä¸è¦å¿˜è®°å¢åŠ ç«¯å£å’Œæ”¹å˜åç§°å­—æ®µã€‚ ç¬¬ä¸‰æ­¥ï¼šè®¾è®¡1234567// app.jsimport React from &apos;react&apos;;import &apos;./App.css&apos;;const App = () =&gt; ( &lt;div className=&quot;shell-app&quot;&gt; &lt;h2&gt;Hi from Shell App&lt;/h2&gt; &lt;/div&gt;);export default App; 123456789// app.css.shell-app &#123; margin: 5px; text-align: center; background: #FFF3E0; border: 1px dashed #FFB74D; border-radius: 5px; color: #FFB74D; &#125; ä¸Šé¢ä¸¤ä¸ªæ–‡ä»¶éƒ½æ”¾åˆ°srcä¸‹ï¼ŒProduct ä»¥åŠ User é¡¹ç›®ä¹ŸåšåŒæ ·çš„æ›´æ”¹ï¼Œåªæ˜¯å°†srcå‘½åä¸ºshellã€‚ä¸‰ä¸ªé¡¹ç›®ä¾æ¬¡è¿è¡Œä»¥ä¸‹çš„å‘½ä»¤ 1yarn webpack server ç°åœ¨ï¼Œæˆ‘ä»¬æ‰€æœ‰çš„åº”ç”¨ç¨‹åºéƒ½ä¸ºMicro Frontendsæ¶æ„åšå¥½äº†å‡†å¤‡ï¼Œå¹¶ä¸”å¯ä»¥ç›¸äº’ç‹¬ç«‹è¿è¡Œã€‚ğŸ‰ ç¬¬å››æ­¥ï¼šæ•´åˆæ˜¯æ—¶å€™æåˆ°æ¨¡å—è”é‚¦çš„ä¸¤ä¸ªä¼Ÿå¤§çš„åŠŸèƒ½äº† :) exposeï¼šå®ƒå…è®¸ä½ ä»ä»»ä½•åº”ç”¨ç¨‹åºåˆ°å¦ä¸€ä¸ªåº”ç”¨ç¨‹åºå…±äº«ä¸€ä¸ªç»„ä»¶ã€ä¸€ä¸ªé¡µé¢æˆ–æ•´ä¸ªåº”ç”¨ç¨‹åºã€‚ä½ æ‰€æš´éœ²çš„ä¸€åˆ‡éƒ½è¢«åˆ›å»ºä¸ºä¸€ä¸ªå•ç‹¬çš„æ„å»ºï¼Œä»è€Œåˆ›é€ äº†ä¸€ä¸ªè‡ªç„¶çš„tree shakingã€‚æ¯ä¸ªæ„å»ºéƒ½ä»¥æ–‡ä»¶çš„MD5å“ˆå¸Œå€¼å‘½åï¼Œæ‰€ä»¥ä½ ä¸å¿…æ‹…å¿ƒç¼“å­˜çš„é—®é¢˜ã€‚ remoteï¼š å®ƒå†³å®šäº†ä½ å°†ä»å“ªäº›åº”ç”¨ç¨‹åºæ¥æ”¶ä¸€ä¸ªç»„ä»¶ã€ä¸€ä¸ªé¡µé¢æˆ–åº”ç”¨ç¨‹åºæœ¬èº«ã€‚æ¯ä¸ªåº”ç”¨ç¨‹åºéƒ½å¯ä»¥åŒæ—¶æš´éœ²å’Œå®šä¹‰ä¸€ä¸ªè¿œç¨‹ï¼Œå¹¶å¤šæ¬¡è¿›è¡Œã€‚ ç°åœ¨è®©æˆ‘ä»¬æŠŠProductåº”ç”¨æš´éœ²ç»™Shellåº”ç”¨ï¼Œè®©æˆ‘ä»¬åšç¬¬ä¸€ä¸ªå¾®å‰ç«¯è¿æ¥ã€‚ è®©æˆ‘ä»¬æ‰“å¼€äº§å“ repo ä¸­çš„ webpack.config.js æ–‡ä»¶ï¼Œå¹¶æ”¹å˜å…¶ä¸­ä¼ ç»™ModuleFederationPluginä¸­çš„å¯¹è±¡ï¼Œå¦‚ä¸‹ã€‚exposeså¯¹è±¡ä¸­çš„å€¼å†³å®šäº†å®ƒåœ¨repoä¸­å…±äº«å“ªä¸ªç»„ä»¶ï¼Œè€Œå¯¹è±¡ä¸­çš„keyå†³å®šäº†å…¶ä»–åº”ç”¨ç¨‹åºå¯ä»¥è®¿é—®è¿™ä¸ªç»„ä»¶çš„åç§°ã€‚ 12345678910111213141516171819new ModuleFederationPlugin( &#123; name: &apos;PRODUCT&apos;, filename: &apos;remoteEntry.js&apos;, exposes: &#123; &apos;./App&apos;: &apos;./src/App&apos;, &#125;, shared: [ &#123; ...deps, react: &#123; requiredVersion: deps.react, singleton: true &#125;, &apos;react-dom&apos;: &#123; requiredVersion: deps[&apos;react-dom&apos;], singleton: true, &#125;, &#125;, ], &#125;), è®©æˆ‘ä»¬æ‰“å¼€shell repoä¸­çš„webpack.config.jsæ–‡ä»¶ï¼Œå°†å…¶ä¸­ä¼ ç»™ModuleFederationPluginæ–¹æ³•çš„å¯¹è±¡åšå¦‚ä¸‹ä¿®æ”¹ã€‚remoteså¯¹è±¡ä¸­çš„å€¼å†³å®šäº†å¦‚ä½•è®¿é—®Productï¼ˆ@ç¬¦å·å‰çš„åç§°å¿…é¡»ä¸Productåº“ä¸­Webpack configä¸­çš„åç§°ç›¸åŒï¼‰ï¼Œå¯¹è±¡ä¸­çš„keyå…è®¸æˆ‘ä»¬åªç”¨åç§°æ¥è®¿é—®Productã€‚ 12345678910111213141516171819new ModuleFederationPlugin( &#123; name: &apos;SHELL&apos;, filename: &apos;remoteEntry.js&apos;, remotes: &#123; PRODUCT: &apos;PRODUCT@http://localhost:3002/remoteEntry.js&apos; &#125;, shared: [ &#123; ...deps, react: &#123; requiredVersion: deps.react, singleton: true &#125;, &apos;react-dom&apos;: &#123; requiredVersion: deps[&apos;react-dom&apos;], singleton: true, &#125;, &#125;, ], &#125;), æˆ‘ä»¬å·²ç»å°†2ä¸ªåº”ç”¨ç¨‹åºè¿æ¥åœ¨ä¸€èµ·ã€‚ç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•åœ¨Shellåº”ç”¨ç¨‹åºä¸­ä½¿ç”¨Productã€‚è®©æˆ‘ä»¬åœ¨shellèµ„æºåº“ä¸­æ‰“å¼€App.jså¹¶åšå¦‚ä¸‹ä¿®æ”¹ã€‚ 1234567891011121314import React from &apos;react&apos;;import &apos;./App.css&apos;;const ProductApp = React.lazy( () =&gt; import(&apos;PRODUCT/App&apos;));const App = () =&gt; ( &lt;div className=&quot;App&quot;&gt; &lt;h2&gt;Hi from Shell App&lt;/h2&gt;&lt;React.Suspense fallback=&apos;Loading...&apos;&gt; &lt;ProductApp /&gt; &lt;/React.Suspense&gt; &lt;/div&gt;);export default App; æˆ‘ä»¬å·²ç»å®šä¹‰äº†åä¸º â€œApp â€œçš„ç»„ä»¶ï¼Œè¯¥ç»„ä»¶é€šè¿‡Reactçš„lazyæ–¹æ³•ä»Productä¸­æš´éœ²å‡ºæ¥ï¼Œåˆ°æˆ‘ä»¬åä¸ºProductAppçš„å˜é‡ã€‚æˆ‘ä»¬éœ€è¦å¯¹æˆ‘ä»¬å°†ä»ä¸åŒçš„å¾®å‰ç«¯è·å¾—çš„ç»„ä»¶ä½¿ç”¨lazyå‡½æ•°ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨Suspenseåœ¨æ¨¡æ¿éƒ¨åˆ†ä½¿ç”¨å®ƒï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥ç¡®ä¿æ‰€æœ‰çš„ä¸œè¥¿éƒ½åŠ è½½åˆ°é¡µé¢ä¸Šã€‚ å¦‚æœä½ ç°åœ¨æƒ³ï¼Œä½ å¯ä»¥åœ¨Useråº”ç”¨ç¨‹åºä¸­æ·»åŠ ä¸€ä¸ªç»„ä»¶ï¼Œå¹¶å°è¯•åœ¨äº§å“åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨è¿™ä¸ªç»„ä»¶:) ä½ å¯ä»¥ä½¿ç”¨exposeå’Œremoteså…±äº«ä½ æƒ³è¦çš„ç»„ä»¶ã€‚åˆ›å»ºæ¨¡å—è”é‚¦çš„Zack Jacksonæœ‰ä¸€ä¸ªGithub repoï¼Œå«åšmodule-federation-examplesã€‚åœ¨è¿™ä¸ªRepoä¸­ï¼Œæœ‰è®¸å¤šçš„ç¤ºä¾‹ï¼Œå¦‚Reactã€Vueã€Angularã€æœåŠ¡å™¨ç«¯æ¸²æŸ“ã€å…±äº«è·¯ç”±ï¼Œå¦‚æœä½ æƒ³çš„è¯ï¼Œä½ å¯ä»¥æŸ¥çœ‹å®ƒä»¬ã€‚ éœ€è¦è§£å†³çš„é—®é¢˜è·¯ç”±å…¶ä¸­ä¸€ä¸ªé‡è¦çš„é—®é¢˜æ˜¯ï¼Œå¾®å‰ç«¯ç®¡ç†è‡ªå·±çš„è·¯ç”±ï¼Œä»¥ä¿æŒå®ƒä»¬ä¸Shellçš„æ¾æ•£è€¦åˆå…³ç³»ã€‚ åœ¨æˆ‘ä»¬å»ºç«‹çš„é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å€¾å‘äºåœ¨Shellçš„è·¯ç”±å®‰è£…å¾®å‰ç«¯æ¨¡å—ã€‚å½“åˆ°è¾¾/mf-aè·¯å¾„æ—¶ï¼ŒShellä¼šæ‡’åŠ è½½Micro-Frontend-Aåº”ç”¨ç¨‹åºï¼Œå½“ç”¨æˆ·åˆ°è¾¾/mf-bè·¯å¾„æ—¶ï¼Œå®ƒä»¥åŒæ ·çš„æ–¹å¼åŠ è½½Micro-Frontend-Bã€‚ 12345678910111213141516171819202122232425// shell/src/Shell.jsimport ...const MicroFrontendA = lazy(() =&gt; import(&apos;MicroFrontendA/MicroFrontendARoutes&apos;));const MicroFrontendB = lazy(() =&gt; import(&apos;MicroFrontendB/MicroFrontendBRoutes&apos;));const Shell = () =&gt; &#123; return ( &lt;Router&gt; &lt;Menu /&gt; &lt;main&gt; &lt;Suspense fallback=&#123;&lt;div&gt;YÃ¼kleniyor...&lt;/div&gt;&#125;&gt; &lt;Switch&gt; &lt;Route exact path=&quot;/&quot;&gt; &lt;Redirect to=&quot;/mf-a&quot; /&gt; &lt;/Route&gt; &lt;Route path=&quot;/mf-a&quot;&gt; &lt;MicroFrontendA /&gt; &lt;/Route&gt; &lt;Route path=&quot;/mf-b&quot;&gt; &lt;MicroFrontendB /&gt; &lt;/Route&gt; &lt;/Switch&gt; &lt;/Suspense&gt; &lt;/main&gt; &lt;/Router&gt; );&#125;;export default Shell; ä¹‹åï¼Œæ§åˆ¶æƒè½¬ç§»åˆ°å¾®å‰ç«¯ã€‚å¾®å‰ç«¯-Aå¤„ç†è‡ªå·±çš„å­æ¨¡å—ï¼Œå¹¶å¯¹å…¶è¿›è¡Œè·¯ç”±è®¾ç½®ã€‚ä¸ä¸Šé¢çš„ä¾‹å­æœ‰å…³ï¼Œå½“å¯¼èˆªåˆ°/mf-açš„è·¯å¾„æ—¶ï¼ŒPageAè¢«åŠ è½½ï¼Œå½“è·¯å¾„æ˜¯/mf-a/page-bæ—¶ï¼ŒPageBè¢«åŠ è½½ã€‚ 1234567891011121314151617181920212223// micro-frontend-a/src/pages/MicroFrontendARoutes.jsimport React, &#123; lazy &#125; from 'react';import &#123; Switch, Route, useRouteMatch &#125; from 'react-router-dom';import withPermissions from 'Shell/hoc/withPermissions';const PageA = lazy(() =&gt; import('pages/pageA/PageA'));const PageB = lazy(() =&gt; import('pages/pageB/PageB'));const MicroFrontendARoutes = () =&gt; &#123; const &#123; path &#125; = useRouteMatch();return ( &lt;Switch&gt; &lt;Route exact path=&#123;path&#125; render=&#123;() =&gt; withPermissions(['VIEW_PAGE_A'])(PageA)&#125; /&gt; &lt;Route exact path=&#123;`$&#123;path&#125;/page-b`&#125; render=&#123;() =&gt; withPermissions(['VIEW_PAGE_B'])(PageB)&#125; /&gt; &lt;/Switch&gt; );&#125;;export default MicroFrontendARoutes; å…±äº«çŠ¶æ€ä»¥åŠhookså®é™…ä¸Šï¼Œåœ¨æ¨¡å—è”é‚¦ä¸­å…±äº«è¿™äº›æ˜¯éå¸¸å®¹æ˜“çš„ï¼›ä½†å®ƒç›®å‰æœ‰ä¸€ä¸ªæœ‰è¶£çš„è§£å†³æ–¹æ¡ˆã€‚ å¦‚æœä½ çœ‹çœ‹æˆ‘ä¸ºShellçš„webpack.config.jsæ‰€ä¸¾çš„ä¾‹å­ï¼Œåœ¨å…±äº«æ–¹é¢æœ‰ä¸€ä¸ªå¾®å¦™çš„æ¥è§¦ã€‚ä¸€ä¸ªæ¶ˆè€—å…¬å…±çŠ¶æ€çš„hooksä¹Ÿåœ¨åº“ä¸‹å…±äº«ã€‚ç”±äºåº”ç”¨ç¨‹åºæ€»æ˜¯åœ¨Shellä¸‹æ¸²æŸ“ï¼Œæ‰€æœ‰çš„contextéƒ½ä»¥æ­£ç¡®çš„é¡ºåºåŠ è½½ï¼Œå½“æˆ‘ä»¬åƒä¾‹å­ä¸­é‚£æ ·å…±äº« hooksæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å¾®å‰ç«¯ä¸­ä½¿ç”¨é€šç”¨contextè€Œä¸ä¼šæœ‰ä»»ä½•é”™è¯¯ã€‚ 12345678910111213// shell/webpack.config.jsconst &#123; dependencies: deps &#125; = require('./package.json');const moduleFederationOptions = &#123; ...exposes: &#123; ... './hooks/useToastr': './src/hooks/useToastr', &#125;, shared: [ &#123; ... &#125;, './src/hooks/useToastr', // Here! ],&#125;; çƒ­é‡è½½ä¸¾ä¾‹è¯´æ˜æˆ‘ä»¬é‡åˆ°çš„é—®é¢˜ã€‚å¦‚æœæˆ‘ä»¬é€šè¿‡Shellè®¿é—®åº”ç”¨ç¨‹åºï¼Œæˆ‘ä»¬åœ¨Micro-Frontend-Aä¸­åšçš„ä¸€ä¸ªæ”¹å˜ä¸ä¼šè§¦å‘çƒ­é‡è½½ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åœ¨å¼€å‘çš„æ—¶å€™ä¼šæ…¢ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨æ¯æ¬¡æ”¹å˜ååˆ·æ–°ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ¨¡å—è”é‚¦å›¢é˜Ÿå¼€å‘äº†@module-federation/fmråŒ…ã€‚å½“å®ƒä½œä¸ºæ’ä»¶è¢«åŒ…å«åœ¨Webpacké…ç½®ä¸­æ—¶ï¼Œä½ çš„æ¨¡å—è”é‚¦ç»“æ„çš„ä»»ä½•å˜åŒ–éƒ½ä¼šè‡ªåŠ¨è¿è¡ŒLive Reloadã€‚ éƒ¨ç½²åœ¨ä½¿åº”ç”¨ç¨‹åºä¸Šçº¿çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬é‡åˆ°äº†ä¸¤ä¸ªä¸»è¦é—®é¢˜ã€‚ åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°è®¾ç½®publicPathã€‚å½“ç”¨æ¨¡å—è”é‚¦åˆ›å»ºä¸€ä¸ªå¤æ‚çš„åº”ç”¨ç¨‹åºæ—¶ï¼Œä¼šå‡ºç°è¿™ç±»é—®é¢˜ã€‚Shellå°†ä»å“ªé‡Œè·å¾—å¾®å‰ç«¯çš„å…±äº«æ–‡ä»¶ï¼Ÿå±äºShellçš„æ–‡ä»¶å°†æ¥è‡ªå¾®å‰ç«¯çš„å“ªäº›è·¯å¾„ï¼Ÿè®¸å¤šæ–‡ä»¶è·¯å¾„éœ€è¦è¢«è®¾ç½®ã€‚æˆ‘ä»¬é€šè¿‡æ­£ç¡®æŒ‡å®špublicPathé€‰é¡¹æ¥æ§åˆ¶è¿™äº›ã€‚ åœ¨Trendyol GOä¸­ï¼Œæˆ‘ä»¬å°†åº”ç”¨ç¨‹åºä½œä¸ºDockeré•œåƒåˆ›å»ºä¸€æ¬¡ï¼Œç„¶åæˆ‘ä»¬ä½¿å®ƒä»¬åœ¨ä¸åŒçš„ç¯å¢ƒä¸­é€šè¿‡ç¯å¢ƒå˜é‡æ¥å—ä¸åŒçš„è®¾ç½®ã€‚å¦‚æœpublicPathæ˜¯åœ¨æ„å»ºæ—¶è®¾ç½®çš„ï¼Œæˆ‘ä»¬å°±å¿…é¡»è§£å†³å¤§çš„é…ç½®æ–‡ä»¶é—®é¢˜ï¼Œè¿™ä¸æ˜¯ä¸€ä¸ªä¼˜åŒ–çš„è§£å†³æ–¹æ¡ˆã€‚ æˆ‘ä»¬ç¨å¾®ä¿®æ”¹äº†Zack Jacksonåœ¨è¿™ç¯‡æ–‡ç« ä¸­æåˆ°çš„æ–¹æ³•ï¼Œä½¿å…¶éå¸¸ç®€å•åœ°åœ¨è¿è¡Œæ—¶åˆ†é…åŠ¨æ€publicPathã€‚ åœ¨æˆ‘ä»¬ä½¿ç”¨çš„æ–¹æ³•ä¸­ï¼Œæœ‰ä¸€ä¸ªå«åšsetPublicPath.jsçš„æ–‡ä»¶ã€‚å…¶å†…å®¹çš„æ ¼å¼å¦‚ä¸‹ã€‚ 12// shell/src/setPublicPath.js__webpack_public_path__ = `$&#123;new URL(document.currentScript.src).origin&#125;/`; æˆ‘ä»¬é€šè¿‡åœ¨æ„å»ºæ—¶æ“ä½œWebpackè®¾ç½®ä¸­çš„entry 12345// shell/webpack.config.jsentry: &#123; Shell: './src/setPublicPath', main: './src/index',&#125;, åœ¨è¿è¡Œæ—¶ï¼ŒåŠ¨æ€è®¾ç½®æ¨¡å—è”é‚¦è®¾ç½®ä¸­åˆ†é…çš„è¿œç¨‹URLã€‚æˆ‘ä»¬ç”¨External Remotes Pluginæ¥å®ç° 1234567// shell/webpack.config.jsconst moduleFederationOptions = &#123; ...remotes: &#123; MicroFrontendA: 'MicroFrontendA@[window.MF_A_URL]/remoteEntry.js', MicroFrontendB: 'MicroFrontendB@[window.MF_B_URL]/remoteEntry.js', &#125;, ...&#125;; å¦‚ä½•åœ¨è¿è¡Œæ—¶è®¾ç½®window.MF_A_URL and window.MF_B_URL 12345678// shell/src/index.jsimport config from 'config'; // dynamic vars. from an .env file e.g.window.MF_A_URL = config.MF_A_URL;window.MF_B_URL = config.MF_B_URL;import('./bootstrap'); åœ¨è¿™ä¸ªè¿‡ç¨‹çš„æœ€åï¼Œæˆ‘ä»¬å®ç°äº†ä¸€ä¸ªç¨³å®šçš„åº”ç”¨ç¨‹åºã€‚è™½ç„¶åœ¨æˆ‘ä»¬é¢å‰è¿˜æœ‰è®¸å¤šä¸åŒçš„æ”¹è¿›ï¼Œä½†ä»ç°åœ¨å¼€å§‹ï¼Œæ¯ä¸ªå›¢é˜Ÿå¯ä»¥å¼€å‘è‡ªå·±çš„æ¨¡å—ï¼Œè€Œä¸å¿…ä¾èµ–å…¶ä»–å›¢é˜Ÿã€‚","categories":[],"tags":[{"name":"webpack","slug":"webpack","permalink":"https://ashleyblog.xyz/tags/webpack/"},{"name":"æ¨¡å—è”é‚¦","slug":"æ¨¡å—è”é‚¦","permalink":"https://ashleyblog.xyz/tags/æ¨¡å—è”é‚¦/"}]},{"title":"åˆæˆäº‹ä»¶","slug":"åˆæˆäº‹ä»¶","date":"2023-04-15T13:16:01.000Z","updated":"2023-04-15T13:34:11.918Z","comments":true,"path":"2023/04/15/åˆæˆäº‹ä»¶/","link":"","permalink":"https://ashleyblog.xyz/2023/04/15/åˆæˆäº‹ä»¶/","excerpt":"","text":"å¤§å®¶éƒ½çŸ¥é“ React æœ‰ä¸€å¥—è‡ªå·±çš„äº‹ä»¶æœºåˆ¶ï¼Œå¦‚å®˜æ–¹æ–‡æ¡£æ‰€è¿°ï¼š SyntheticEvent å®ä¾‹å°†è¢«ä¼ é€’ç»™ä½ çš„äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œå®ƒæ˜¯æµè§ˆå™¨çš„åŸç”Ÿäº‹ä»¶çš„è·¨æµè§ˆå™¨åŒ…è£…å™¨ã€‚é™¤å…¼å®¹æ‰€æœ‰æµè§ˆå™¨å¤–ï¼Œå®ƒè¿˜æ‹¥æœ‰å’Œæµè§ˆå™¨åŸç”Ÿäº‹ä»¶ç›¸åŒçš„æ¥å£ï¼ŒåŒ…æ‹¬ stopPropagation() å’Œ preventDefault()ã€‚å¦‚æœå› ä¸ºæŸäº›åŸå› ï¼Œå½“ä½ éœ€è¦ä½¿ç”¨æµè§ˆå™¨çš„åº•å±‚äº‹ä»¶æ—¶ï¼Œåªéœ€è¦ä½¿ç”¨ nativeEvent å±æ€§æ¥è·å–å³å¯ã€‚åˆæˆäº‹ä»¶ä¸æµè§ˆå™¨çš„åŸç”Ÿäº‹ä»¶ä¸åŒï¼Œä¹Ÿä¸ä¼šç›´æ¥æ˜ å°„åˆ°åŸç”Ÿäº‹ä»¶ã€‚ä¾‹å¦‚ï¼Œåœ¨ onMouseLeave äº‹ä»¶ä¸­ event.nativeEvent å°†æŒ‡å‘ mouseout äº‹ä»¶ã€‚æ¯ä¸ª SyntheticEvent å¯¹è±¡éƒ½åŒ…å«ä»¥ä¸‹å±æ€§ï¼š 123456789101112131415boolean bubblesboolean cancelableDOMEventTarget currentTargetboolean defaultPreventednumber eventPhaseboolean isTrustedDOMEvent nativeEventvoid preventDefault()boolean isDefaultPrevented()void stopPropagation()boolean isPropagationStopped()void persist()DOMEventTarget targetnumber timeStampstring type Reactä½¿ç”¨åˆæˆäº‹ä»¶çš„åŸå› ï¼š è¿›è¡Œæµè§ˆå™¨å…¼å®¹ é¿å…åƒåœ¾å›æ”¶ æ–¹ä¾¿äº‹ä»¶ç»Ÿä¸€ç®¡ç†å’Œäº‹åŠ¡æœºåˆ¶ä¸‹é¢å¯¹æ¯”DOM2åŸç”Ÿäº‹ä»¶ï¼Œæ¼”ç¤ºå‡ ä¸ªDemoæ–¹ä¾¿æ›´å¥½çš„ç†è§£ï¼ŒDemo ä½¿ç”¨ â€œreactâ€: â€œ^16.14.0â€ æ¥æ¼”ç¤º çˆ¶ç»„ä»¶ç›‘å¬ä¸¤ä¸ªåŸç”Ÿäº‹ä»¶1234567891011121314151617export default class App extends Component &#123; componentDidMount() &#123; document.addEventListener(\"click\", () =&gt; &#123; console.log(\"document\"); &#125;); window.addEventListener(\"click\", () =&gt; &#123; console.log(\"window\"); &#125;); &#125; render() &#123; return ( &lt;div className=\"black-box\"&gt; &lt;Demo /&gt; &lt;/div&gt; ); &#125;&#125; 1ã€åŸç”Ÿäº‹ä»¶1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859import &#123; Component &#125; from \"react\";import \"./index.css\";const getDom = (className) =&gt; &#123; return document.querySelector(`.$&#123;className&#125;`);&#125;;// å†’æ³¡/æ•è·const BUBBLING = false;export default class Demo extends Component &#123; state = &#123;&#125;; componentDidMount() &#123; const c1 = getDom(\"demo1-content1\"); const c2 = getDom(\"demo1-content2\"); const c3 = getDom(\"demo1-content3\"); c1.addEventListener( \"click\", () =&gt; &#123; console.log(1); &#125;, BUBBLING ); c2.addEventListener( \"click\", () =&gt; &#123; console.log(2); &#125;, BUBBLING ); c3.addEventListener( \"click\", () =&gt; &#123; console.log(3); &#125;, BUBBLING ); &#125; render() &#123; return ( &lt;div className=\"black\" &#123;...this.props&#125;&gt; &lt;h3 onClick=&#123;() =&gt; &#123; this.setState(&#123; show: !this.state.show &#125;); &#125;&#125; id=\"black-1\" &gt; demo1 åŸç”Ÿäº‹ä»¶ &lt;/h3&gt; &lt;div className=\"demo1-content1\"&gt; 1 &lt;div className=\"demo1-content2\"&gt; 2&lt;div className=\"demo1-content3\"&gt;3&lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &#123;this.state.show &amp;&amp; &lt;p&gt;3-2-1-document-window&lt;/p&gt;&#125; &lt;/div&gt; ); &#125;&#125; è¾“å‡ºç»“æœæ˜¯æ˜¾è€Œæ˜“è§çš„ï¼Œå¦‚å›¾ï¼š 2ã€åˆæˆäº‹ä»¶12345678910111213141516171819202122232425262728293031323334353637383940414243import &#123; Component &#125; from \"react\";import \"./index.css\";export default class Demo extends Component &#123; state = &#123;&#125;; render() &#123; return ( &lt;div className=\"black\"&gt; &lt;h3 onClick=&#123;() =&gt; &#123; this.setState(&#123; show: !this.state.show &#125;); &#125;&#125; &gt; demo2 åˆæˆäº‹ä»¶ &lt;/h3&gt; &lt;div className=\"demo2-content1 yellow\" onClick=&#123;() =&gt; &#123; console.log(1); &#125;&#125; &gt; 1 &lt;div className=\"demo2-content2 yellow\" onClick=&#123;() =&gt; &#123; console.log(2); &#125;&#125; &gt; 2 &lt;div className=\"demo2-content3 yellow\" onClick=&#123;() =&gt; &#123; console.log(3); &#125;&#125; &gt; 3 &lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &#123;this.state.show &amp;&amp; &lt;p&gt;3-2-1-document-window&lt;/p&gt;&#125; &lt;/div&gt; ); &#125;&#125; è¾“å‡ºç»“æœï¼š 3ã€åŸç”Ÿäº‹ä»¶å’Œåˆæˆäº‹ä»¶æ··åˆä½¿ç”¨123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960import &#123; Component &#125; from \"react\";import \"./index.css\";const getDom = (className) =&gt; &#123; return document.querySelector(`.$&#123;className&#125;`);&#125;;// å†’æ³¡/æ•è·const BUBBLING = false;export default class Demo extends Component &#123; state = &#123;&#125;; componentDidMount() &#123; const c1 = getDom(\"demo3-content1\"); const c3 = getDom(\"demo3-content3\"); c1.addEventListener( \"click\", () =&gt; &#123; console.log(1); &#125;, BUBBLING ); c3.addEventListener( \"click\", () =&gt; &#123; console.log(3); &#125;, BUBBLING ); &#125; render() &#123; return ( &lt;div className=\"black\"&gt; &lt;h3 onClick=&#123;() =&gt; &#123; this.setState(&#123; show: !this.state.show &#125;); &#125;&#125; &gt; demo3 æ··åˆä½¿ç”¨ &lt;/h3&gt; &lt;div className=\"demo3-content1\"&gt; 1 &lt;div className=\"demo3-content2 yellow\" onClick=&#123;() =&gt; &#123; console.log(2); &#125;&#125; &gt; 2&lt;div className=\"demo3-content3\"&gt;3&lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &#123;this.state.show &amp;&amp; ( &lt;p&gt; 3-1-2-document-window &lt;br /&gt; &lt;/p&gt; )&#125; &lt;/div&gt; ); &#125;&#125; è¾“å‡ºç»“æœï¼š é»„è‰²çš„æ•°å­—2æ‰€åœ¨åŒºåŸŸæ˜¯reactäº‹ä»¶ï¼Œ1å’Œ3æ˜¯åŸç”Ÿäº‹ä»¶ åˆ°è¿™é‡Œçš„ç–‘æƒ‘æ˜¯ï¼Œä¸ºä»€ä¹ˆ1æ¯”2å…ˆæ‰“å°å‡ºæ¥ï¼Ÿ ç®€å•çš„æ¥è¯´ï¼Œå…¶å®æ˜¯React(v16)æ‰€æœ‰äº‹ä»¶æœ€åéƒ½æ˜¯ä»£ç†åˆ° document ä¸Šé¢ï¼Œé€šè¿‡å†’æ³¡æœºåˆ¶å…ˆè¾“å‡º3å’Œ1ï¼Œç„¶åè§¦å‘documentä¸Šçš„äº‹ä»¶ æ‰“å°2ã€‚documentä¸ŠæŒ‚è½½çš„ä¸¤ä¸ªäº‹ä»¶ï¼Œç¬¬ä¸€ä¸ªæ˜¯æˆ‘ä»¬åœ¨ ç»„ä»¶é‡Œæ³¨å†Œçš„ï¼Œç¬¬äºŒä¸ªæ˜¯ React æŒ‚è½½çš„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ 4ã€åŸç”Ÿäº‹ä»¶é˜»æ­¢å†’æ³¡1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768import &#123; Component &#125; from \"react\";import \"./index.css\";const getDom = (className) =&gt; &#123; return document.querySelector(`.$&#123;className&#125;`);&#125;;// å†’æ³¡/æ•è·const BUBBLING = false;export default class Demo extends Component &#123; state = &#123;&#125;; componentDidMount() &#123; const c1 = getDom(\"demo5-content1\"); const c2 = getDom(\"demo5-content2\"); const c3 = getDom(\"demo5-content3\"); c1.addEventListener( \"click\", () =&gt; &#123; console.log(1); &#125;, BUBBLING ); c2.addEventListener( \"click\", (e) =&gt; &#123; console.log(2, \"é˜»æ­¢åŸç”Ÿäº‹ä»¶å†’æ³¡\"); // é˜»æ­¢å†’æ³¡æˆ–æ•è· e.stopPropagation(); &#125;, BUBBLING ); c3.addEventListener( \"click\", () =&gt; &#123; console.log(3); &#125;, BUBBLING ); &#125; render() &#123; return ( &lt;div className=\"black\"&gt; &lt;h3 onClick=&#123;() =&gt; &#123; this.setState(&#123; show: !this.state.show &#125;); &#125;&#125; &gt; demo4 åŸç”Ÿé˜»æ­¢å†’æ³¡ &lt;/h3&gt; &lt;div className=\"demo5-content1\"&gt; 1 &lt;div className=\"demo5-content2 stop\"&gt; 2&lt;div className=\"demo5-content3\"&gt;3&lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &#123;this.state.show &amp;&amp; ( &lt;p&gt; 3-2 &lt;br /&gt; e.stopPropagation(); &lt;/p&gt; )&#125; &lt;/div&gt; ); &#125;&#125; è¿™é‡Œä¹Ÿä¸éš¾ç†è§£ï¼Œçº¢è‰²è™šçº¿ä¸ºé˜»æ­¢äº†å†’æ³¡ 5ã€åˆæˆäº‹ä»¶é˜»æ­¢å†’æ³¡1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950import &#123; Component &#125; from \"react\";import \"./index.css\";export default class Demo extends Component &#123; state = &#123;&#125;; render() &#123; return ( &lt;div className=\"black\"&gt; &lt;h3 onClick=&#123;() =&gt; &#123; this.setState(&#123; show: !this.state.show &#125;); &#125;&#125; &gt; demo5 åˆæˆé˜»æ­¢å†’æ³¡ &lt;/h3&gt; &lt;div className=\"demo6-content1 yellow\" onClick=&#123;() =&gt; &#123; console.log(1); &#125;&#125; &gt; 1 &lt;div className=\"demo6-content2 yellow stop\" onClick=&#123;(e) =&gt; &#123; e.stopPropagation(); console.log(2); &#125;&#125; &gt; 2 &lt;div className=\"demo6-content3 yellow\" onClick=&#123;() =&gt; &#123; console.log(3); &#125;&#125; &gt; 3 &lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &#123;this.state.show &amp;&amp; ( &lt;p&gt; 3-2-document &lt;br /&gt; e.stopPropagation(); &lt;/p&gt; )&#125; &lt;/div&gt; ); &#125;&#125; è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œçš„ç¡®æ˜¯é˜»æ­¢äº†Reactäº‹ä»¶çš„å†’æ³¡ï¼Œåªè¾“å‡ºäº†3å’Œ2ã€‚ä½†æ˜¯ä¹Ÿæœ‰ä¸¤ä¸ªé—®é¢˜ã€‚ ç¬¬ä¸€ï¼Œä¸ºä½•windowä¸Šçš„åŸç”Ÿäº‹ä»¶ä¹Ÿè¢«é˜»æ­¢äº†ï¼Ÿç¬¬äºŒï¼Œä¸ºä½•documentä¸Šçš„åŸç”Ÿäº‹ä»¶æ²¡è¢«é˜»æ­¢?æˆ‘ä»¬çŸ¥é“ï¼Œä¸Šé¢è°ƒç”¨çš„e.stopPropagation()ï¼Œå…¶å®æ˜¯Reactäº‹ä»¶æœ¬èº«å¤„ç†è¿‡çš„ã€‚åŸç”Ÿçš„äº‹ä»¶éœ€è¦é€šè¿‡ nativeEvent è·å–ã€‚æ¥ç®€å•çœ‹ä¸€ä¸‹ä¸‹é¢çš„ä»£ç ï¼ŒReactæ˜¯å¦‚ä½•åšçš„ï¼š 12345678910111213141516171819202122stopPropagation: function () &#123; // åŸç”Ÿäº‹ä»¶ var event = this.nativeEvent; if (!event) &#123; return; &#125; if (event.stopPropagation) &#123; // åŸç”Ÿäº‹ä»¶é˜»æ­¢å†’æ³¡ event.stopPropagation(); &#125; else if (typeof event.cancelBubble !== 'unknown') &#123; // The ChangeEventPlugin registers a \"propertychange\" event for // IE. This event does not support bubbling or cancelling, and // any references to cancelBubble throw \"Member not found\". A // typeof check of \"unknown\" circumvents this issue (and is also // IE specific). event.cancelBubble = true; &#125; // è¿™é‡Œåº”è¯¥æ˜¯é˜»æ­¢ Reactåˆæˆäº‹ä»¶å†’æ³¡çš„åœ°æ–¹(å¾…æ±‚è¯) this.isPropagationStopped = functionThatReturnsTrue;&#125;, å½“è°ƒç”¨ Reactäº‹ä»¶æœ¬èº«çš„e.stopPropagation()çš„æ—¶å€™ï¼ŒReact è°ƒç”¨äº†ä¸€æ¬¡åŸç”Ÿäº‹ä»¶ä¸Šçš„stopPropagation()ï¼Œä»è€Œé˜»æ­¢äº†windowä¸Šçš„äº‹ä»¶ã€‚ åŸç”Ÿäº‹ä»¶ä¸åˆæˆäº‹ä»¶æ··ç”¨å¦‚ä½•é˜»æ­¢å†’æ³¡ 12e.nativeEvent.stopImmediatePropagation(); e.stopPropagation(); è°ƒç”¨ e.nativeEvent.stopImmediatePropagation()ï¼Œé˜»æ­¢documentä¸Šæ³¨å†Œçš„å…¶å®ƒåŸç”Ÿäº‹ä»¶ã€‚React å¯èƒ½æ˜¯åŸºäºè®¾è®¡æ–¹é¢è€ƒè™‘ï¼Œæ²¡æœ‰å®ç°è¿™ä¸ªæ–¹æ³•ã€‚","categories":[],"tags":[{"name":"react","slug":"react","permalink":"https://ashleyblog.xyz/tags/react/"}]},{"title":"gitlab ci  ä»å…¥é—¨åˆ°å®è·µ","slug":"ä»å…¥é—¨åˆ°å®è·µ","date":"2023-04-15T11:22:48.000Z","updated":"2023-04-15T12:04:21.663Z","comments":true,"path":"2023/04/15/ä»å…¥é—¨åˆ°å®è·µ/","link":"","permalink":"https://ashleyblog.xyz/2023/04/15/ä»å…¥é—¨åˆ°å®è·µ/","excerpt":"","text":"ä¸€ã€Gitlab CI æ˜¯ä»€ä¹ˆï¼Ÿç°ä»£æŒç»­çš„è½¯ä»¶å¼€å‘å¯¼è‡´äº†å¼€å‘è€…éœ€è¦æŒç»­çš„build, test å’Œ deploy é‡å¤çš„ä»£ç æ›´æ”¹ï¼Œè¿™äº›é‡å¤çš„è¿‡ç¨‹éå¸¸çš„ç¹çï¼Œä½†æ˜¯å¯¹ä¿è¯ä»£ç æŒç»­æ›´æ–°è¿­ä»£æ¥è¯´åˆéå¸¸çš„é‡è¦ã€‚æ­¤æ—¶ä¾¿éœ€è¦ä¸€ç§éäººä¸ºæ‰‹åŠ¨çš„æ–¹æ³•æ¥å¸®åŠ©æˆ‘ä»¬è‡ªåŠ¨å®Œæˆè¿™äº›é‡å¤çš„å·¥ä½œã€‚è¿™ä¸ªè‡ªåŠ¨å®Œæˆå·¥ä½œçš„ç†å¿µè¢«ç§°ä¸ºCI/CD. åœ¨è¿™é‡ŒGitlab CI/CDå°±æ˜¯Gitlabå®˜æ–¹å‘å¸ƒçš„ä¸€ç§è‡ªåŠ¨æµæ°´çº¿å¸®åŠ©å¼€å‘è€…å®Œæˆé‡å¤æ€§å·¥ä½œçš„ä¸€ä¸ªæœåŠ¡ã€‚ äºŒã€å¦‚ä½•ä½¿ç”¨ï¼ŸGitlab CIçš„ä½¿ç”¨ä¸»è¦éœ€è¦2å¤§æ­¥éª¤æ­¥éª¤ä¸€ï¼šé…ç½®runneræˆ‘ä»¬å¯ä»¥ç®€å•çš„æŠŠGitlab runnerç»™ç†è§£æˆ.gitlab-ci.yml æ–‡ä»¶å†…å®¹çš„*æ‰§è¡Œè€…ï¼Œ.gitlab-ci.yml å‘Šè¯‰äº†Gitlab runnerå»åšä»€ä¹ˆã€‚Gitlab runnerä¸æ˜¯ä¸€ä¸ªé…ç½®é¡¹ï¼Œå®ƒæ˜¯éœ€è¦ä¸“é—¨éƒ¨ç½²çš„ï¼Œæ¯”å¦‚ç”¨dockeréƒ¨ç½²ä¸€ä¸ªrunneré•œåƒåˆ°å¯ä»¥è¿æ¥å†…ç½‘çš„å®¹å™¨ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨å…¬å¸å†…é…å¥½çš„shared runners. ä½¿ç”¨shared runnerï¼šæ— éœ€å¤šä½™æ“ä½œï¼Œè¯·ç¡®ä¿shared runneré€‰é¡¹è¢«enableäº†å³å¯ç›´æ¥ä½¿ç”¨å…¬å…±runnerã€‚ï¼ˆå¦‚ä¸‹ï¼‰ è‡ªå·±é…ç½®runnerï¼šéƒ¨ç½²Gitlab runnerå®˜æ–¹æ–‡æ¡£ï¼šRun GitLab Runner in a container | GitLab[1] å…³è”runneråˆ°gitlabå®˜æ–¹æ–‡æ¡£ï¼šRegistering runners | GitLab[2] A. å®‰è£…docker: 1$ brew install --cask docker B. å¯åŠ¨Gitlab runner container:èµ·ä¸€ä¸ªdocker containeræ¥æ‰§è¡ŒGitlab Runneré•œåƒ 1234docker run -d --name gitlab-runner --restart always \\ -v /Users/Shared/gitlab-runner/config:/etc/gitlab-runner \\ -v /var/run/docker.sock:/var/run/docker.sock \\ gitlab/gitlab-runner:latest C. æ³¨å†Œrunneråˆ°Gitlab:åªç”¨dockerèµ·ä¸€ä¸ªgitlab runnerä¸èƒ½å°†æˆ‘ä»¬å½“å‰ä½¿ç”¨çš„gitlab repositoryå’Œä¸Šä¸€æ­¥åˆ›å»ºçš„runnerè¿›è¡Œå…³è”ã€‚åœ¨æ­¤éœ€è¦å°†å…¶è¿›è¡Œç›¸äº’å…³è”ï¼Œå°†runneræ³¨å†Œåˆ°æˆ‘ä»¬çš„gitlab repository ä½¿ç”¨ä¸Šå›¾å¾—åˆ°çš„URLå’Œtokenå»æ›¿æ¢ä¸‹é¢æŒ‡ä»¤çš„â€“urlå’Œâ€“registration-token â€“tag-list ä¸ºå½“å‰runnerçš„æ ‡ç­¾ï¼Œåœ¨é…ç½®æµæ°´çº¿jobçš„æ—¶å€™ä½¿ç”¨ï¼Œåœ¨æ­¤å¯éšæ„é…ç½®ä¸åŒçš„æ ‡ç­¾å 1234567891011docker run --rm -v /Users/Shared/gitlab-runner/config:/etc/gitlab-runner gitlab/gitlab-runner register \\ --non-interactive \\ --executor \"docker\" \\ --docker-image alpine:latest \\ --url \"https://gitlab.com/\" \\ --registration-token \"wc-Reg7qUpGRB4Lw3q9Y\" \\ --description \"gitlabâ€”cicd-runner\" \\ --tag-list \"yehanli,liyehan\" \\ --run-untagged=\"true\" \\ --locked=\"false\" \\ --access-level=\"not_protected\" è‡³æ­¤ï¼ŒGitlab runnerå’Œé…ç½®å‡å·²æˆåŠŸï¼Œæ‰“å¼€setting/CICDé¡µé¢å¯ä»¥çœ‹åˆ°å¦‚ä¸‹æç¤ºï¼š æ­¥éª¤äºŒï¼šåˆ›å»º.gitlab-ci.ymlæ–‡ä»¶åœ¨mono repoçš„æ ¹ç›®å½•åˆ›å»ºä¸€ä¸ªæ–‡ä»¶, å‘½åä¸º.gitlab-ci.yml, å¹¶å°†å…¶pushåˆ°masteråˆ†æ”¯ã€‚ 123git add .gitlab-ci.ymlgit commit -m \"Add .gitlab-ci.yml\"git push origin master åœ¨è¾ƒä½gitlabç‰ˆæœ¬(æ¯”å¦‚11.4)ï¼Œå¦‚æœåœ¨masterä¸»åˆ†æ”¯ä¸‹æ²¡æœ‰.gitlab-ci.ymlçš„è¯ï¼Œåœ¨Gitlabå·¦ä¾§çš„å¯¼èˆªæ ä¸ä¼šæœ‰Gitlab Runnerè¿™ä¸ªtabã€‚ åœ¨é¡¹ç›®çš„setting/CI/CD/General pipelinesä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰è®¾ç½®CIè®¾ç½®æ–‡ä»¶çš„è·¯å¾„ï¼Œé»˜è®¤å¦‚ä¸‹ ä¸‰ã€å¦‚ä½•ç¼–å†™.gitlab-ci.ymlæ–‡ä»¶ï¼Ÿé¦–å…ˆï¼Œè®©æˆ‘ä»¬å…ˆæ¥ç†Ÿæ‚‰ä¸‹yamlçš„å¸¸è§å†™æ³•ï¼Œä»¥åŠå¯¹æ¯”ä¸‹å®ƒä¸jsonæœ‰ä»€ä¹ˆä¸åŒã€‚ Yaml Syntaxå†™æ³•è¯¦æƒ…å…·ä½“è¯·è§ =&gt; YAML Syntax â€’ Ansible Documentation[3] YAMLè¯­æ³•ï¼šæ•°ç»„å†™æ³•ï¼š 123&#123; \"array\": [\"red\", \"blue\", \"yellow\"]&#125; è½¬åŒ–ä¸ºyamlä¸º 1234array: - red - blue - yellow å¯¹è±¡å†™æ³•ï¼š 123456789&#123; \"student1\": &#123; \"name\": \"å°æ˜\" &#125;, \"array\": [\"red\", \"blue\", \"yellow\"], \"student2\": &#123; \"name\": \"å°æ˜\" &#125;&#125; è½¬åŒ–ä¸ºyamlä¸º 123456789# æˆ‘æ˜¯æ³¨é‡Šstudent1: name: å°æ˜array: - red - blue - yellowstudent2: name: å°æ˜ yamlä¸­ä¸åƒjsoné‚£æ ·æ— æ³•æ³¨é‡Šï¼Œæˆ‘ä»¬å¯ä»¥ç”¨#è¿›è¡Œæ³¨é‡Š æµæ°´çº¿ç¯èŠ‚æ¢³ç†:æµæ°´çº¿çš„æµç¨‹ï¼Œæ ¹æ®é…ç½®çš„.gitlab-ci.ymlæ–‡ä»¶å¯ä»¥åˆ†ä¸ºå¦‚ä¸‹å‡ ä¸ªç¯èŠ‚ï¼š åœ¨å•ä¸ªçš„æµæ°´çº¿ä»»åŠ¡æ‰§è¡Œä¹‹å‰è¿›è¡Œé…ç½®å®šä¹‰å•ä¸ªæµæ°´çº¿ä»»åŠ¡(job)ï¼Œå¹¶å¯¹æ­¤ä»»åŠ¡è¿›è¡Œé’ˆå¯¹é…ç½® å•ä¸ªæµæ°´çº¿ä»»åŠ¡çš„å½¢å¼å¯ä»¥å‚è€ƒå¦‚ä¸‹ç¤ºä¾‹ï¼Œå…·ä½“å­—æ®µé‡Šä¹‰å¯ä»¥æš‚æ—¶å¿½ç•¥ï¼Œä¼šåœ¨ä¹‹åè¯¦è§£ï¼š 12345678910# è¿™ä¸ªmy_jobçš„ä»»åŠ¡åæ˜¯å¯ä»¥è‡ªå®šä¹‰èµ·çš„my_job: only: - master tags: - yehanli script: - echo 'job ========= å®Œæˆ' stage: build retry: 2 Gitlab-CI å…³é”®å­—ï¼šGitlab CIçš„å…³é”®å­—æœ‰å¾ˆå¤šï¼Œä½†å®é™…å¸¸ç”¨çš„åªæœ‰è¾ƒå°ä¸€éƒ¨åˆ†ã€‚åœ¨æ­¤éƒ¨åˆ†ä¼šå¯¹å¸¸ç”¨å…³é”®å­—è¿›è¡Œè¯¦è§£ã€‚ scriptéœ€è¦è¢«è¿è¡Œçš„è„šæœ¬ã€‚ä»¥æ•°ç»„å½¢å¼é…ç½®ã€‚ 1234567pipeline_job: ...... script: - cd &lt;æ–‡ä»¶å¤¹ç›®å½•è·¯å¾„&gt; - npm install - npm build ...... before_scriptåœ¨æ‰€æœ‰çš„æµæ°´çº¿ä»»åŠ¡æ‰§è¡Œä¹‹å‰éœ€è¦æ‰§è¡Œçš„è„šæœ¬ï¼Œæˆ–è€…å•ä¸ªæµæ°´çº¿ä»»åŠ¡ä¸­çš„scriptæ‰§è¡Œä¹‹å‰æ‰§è¡ŒæŸäº›scrip variableså˜é‡åœ¨Gitlab-CIä¸­ï¼Œå˜é‡å¤§è‡´å¯åˆ†ä¸ºä¸‰ç±»ï¼š Gitlabç»™æˆ‘ä»¬é¢„å…ˆå®šä¹‰çš„å˜é‡ï¼Œæ¯”å¦‚CI_COMMIT_BRANCH. Setting =&gt; Gitlab CI/CD =&gt; variablesä¸­å®šä¹‰çš„å˜é‡ åœ¨.gitlab-ci.ymlä¸­å®šä¹‰çš„å˜é‡(å¦‚ä¸‹ç¤ºä¾‹) 123456789variables: TEST_VAR: \"All jobs can use this variable's value\"job1: variables: TEST_VAR_JOB: \"Only job1 can use this variable's value\" script: - echo \"$TEST_VAR\" ...... imageCIæµæ°´çº¿è¿è¡Œç¯å¢ƒçš„dockeré•œåƒ(ä»»ä½•ç›¸å…³çš„ä»£ç è¿è¡Œç¯å¢ƒé•œåƒçš†å¯),æ¯”è¾ƒå¸¸ç”¨çš„æœ‰ï¼šnode, python, java, etcâ€¦ stagesGitlab CIå…è®¸æˆ‘ä»¬è¿›è¡Œè‡ªå®šä¹‰çš„æµæ°´çº¿é˜¶æ®µé…ç½®ï¼Œæˆ‘ä»¬å¯ä»¥å°†è‡ªå·±çš„æµæ°´çº¿è‡ªæˆ‘åˆ’åˆ†ä¸ºè‹¥å¹²stagesï¼Œç„¶ååœ¨ä¸åŒçš„stageæ¥åšä¸åŒçš„äº‹ã€‚ï¼ˆç¨åä¼šæœ‰ç¤ºä¾‹ï¼‰(å¯¹åº”gitlabä¸Šçš„é‚£ä¸€æ’åœ†åœˆåœˆ)stagesä¼šä¾æ¬¡æ‰§è¡Œï¼Œå¦‚æœå‰ä¸€ä¸ªstageçš„ä»»åŠ¡æ²¡æœ‰è¿è¡Œå®Œï¼Œåé¢çš„stageä¸ä¼šè¢«è§¦å‘ã€‚ ä¸€æ—¦æœ‰ä¸€ä¸ªstageä¸­çš„ä»»åŠ¡failæ‰äº†ï¼Œä¸‹ä¸€ä¸ªstageçš„ä»»åŠ¡ä¾¿ä¸ä¼šæ‰§è¡Œã€‚å¦‚æœå½“å‰stageå®šä¹‰äº†å¤šä¸ªä»»åŠ¡ï¼Œé‚£ä¹ˆå…¶ä¸­ä¸€ä¸ªä»»åŠ¡å¤±è´¥ï¼Œå¦å¤–ä¸€ä¸ªä»»åŠ¡è¿˜æ˜¯ä¼šè¢«ç»§ç»­æ‰§è¡Œã€‚ä»¥ä¸‹ä¸ºè‡ªå®šä¹‰çš„stagesï¼š 123456stages: - first_stage - second_stage - third_stage - fourth_stage - fifth_stage å¦‚æœæ²¡æœ‰è‡ªå®šä¹‰stagesï¼Œé‚£ä¹ˆé»˜è®¤çš„stagesä¸º.pre =&gt; build =&gt; test =&gt; deploy =&gt; .post(è‡ªå®šä¹‰stagesä¼šé‡å†™é™¤äº†.pre, .postä¹‹å¤–æ‰€æœ‰çš„é»˜è®¤stages) 123456stages: - .pre # æ‰§è¡Œåœ¨æ‰€æœ‰çš„stagesä¹‹å‰ - build - test - deploy - .post # æ‰§è¡Œåœ¨æ‰€æœ‰çš„stagesä¹‹å stagestageä¸ºstagesçš„ä¸€ä¸ªå­é¡¹ï¼Œåœ¨æˆ‘ä»¬è‡ªå®šä¹‰å•ä¸ªæµæ°´çº¿ä»»åŠ¡æ—¶å¯ä»¥é…ç½® cache:ç¼“å­˜å¤šä¸ªæµæ°´çº¿ä»»åŠ¡ä¹‹é—´å…±ç”¨çš„æ–‡ä»¶ï¼Œç›®å½•ï¼Œ etcâ€¦ 12345cache: key: cache-node-modules # åœ¨è¿™é‡Œå†™å‡ºéœ€è¦ç¼“å­˜çš„æ–‡ä»¶çš„è·¯å¾„ï¼Œåœ¨æ­¤ä¸ºnode_modules paths: - node_modules retry:ä¸€ä¸ªjobå¯ä»¥è¢«é‡æ–°æ‰§è¡Œçš„æœ€å¤§æ•°é‡ã€‚å¿…é¡»æ˜¯ä¸ªæ­£æ•´æ•°, 0-2, 2ä¸ºæœ€å¤§å€¼ whenå¯è®¾ç½®åœ¨ç‰¹å®šå¤±è´¥åŸå› çš„æƒ…å†µä¸‹æ‰§è¡Œ12345job: script: rspec retry: max: 2 when: runner_system_failure only &amp; except only: è®¾ç½®æµæ°´çº¿ä»»åŠ¡æ‰§è¡Œæ—¶æœº except: è®¾ç½®æµæ°´çº¿ä»»åŠ¡ä¸æ‰§è¡Œæ—¶æœºå¯é…ç½®é€‰é¡¹ï¼ˆå¸¸ç”¨çš„å‡ ä¸ªï¼‰ï¼špushesï¼š git pushæ—¶è§¦å‘ï¼Œé€‚ç”¨äºæ‰€æœ‰åˆ†æ”¯merge_requestsï¼š MRè¢«åˆ›å»ºæ—¶è§¦å‘ï¼Œé€‚ç”¨äºæ‰€æœ‰åˆ†æ”¯webï¼š æ‰‹åŠ¨åœ¨Gitlab Runner/pipelineé‡Œé¢ç‚¹å‡»run pipelineæ—¶è§¦å‘ é…ç½®branchåç§°æ¥è§„å®šè§¦å‘ä»»åŠ¡çš„åˆ†æ”¯(å¦‚ä¸‹) 123456789myjob: only: - master# ä»¥ä¸Šå†™æ³•ç­‰åŒäºmyjob: only: variables: # $CI_COMMIT_REF_NAMEæ˜¯ä¸€ä¸ªgitlabçš„é¢„è®¾å˜é‡ï¼Œä»£è¡¨å½“å‰commitç»™å“ªä¸ªbranchä¸Šäº† - $CI_COMMIT_REF_NAME == \"master\" rules:ifæ­¤å­—æ®µå¯ä»¥åœ¨å•ä¸ªæµæ°´çº¿jobæˆ–è€…workflowå­—æ®µä¸‹è¿›è¡Œé…ç½®ã€‚ ruleså…³é”®è¯ä¸‹å¯ä»¥è¿›è¡Œifè¯­å¥é…ç½®ï¼Œå¦‚æœifæ»¡è¶³çš„è¯å¯æ‰§è¡ŒæŸäº›è‡ªå®šä¹‰é…ç½® 12rules: - if: $CI_COMMIT_REF_NAME =~ /feature/ æ³¨æ„: only &amp; exceptå’Œrules:iféƒ½æ˜¯ç”¨æ¥å†³å®šå•ä¸ªjobæ‰§è¡Œæ—¶æœºçš„ï¼Œåœ¨é…ç½®æ—¶åªèƒ½å­˜åœ¨ä¸€ä¸ªï¼Œå¦åˆ™ä¼šæŠ¥é”™ workflowéœ€è¦å’Œrulesé…åˆç”¨æ¥æ§åˆ¶æ•´ä¸ªpipelineçš„è¡Œä¸ºï¼Œæ¯”å¦‚æ•´ä¸ªæµæ°´çº¿æ‰§è¡Œä¸å¦ã€‚æ•´ä¸ªæµæ°´çº¿æ­£å¸¸è¿è¡Œçš„å‰ææ˜¯å…¶rulesé…ç½®ä¸­çš„ifè¯­å¥è‡³å°‘éœ€è¦è§¦å‘ä¸€ä¸ª. åœ¨å„ä¸ªæµæ°´çº¿ä»»åŠ¡çš„å¤–å±‚è¿›è¡Œé…ç½® 12345678variables: IS_FEATURE: \"false\"workflow: rules: - if: $CI_COMMIT_REF_NAME =~ /feature/ variables: IS_FEATURE: \"true\" - when: always # Run the pipeline in other cases whenè¿™ä¸ªå…³é”®å­—å’Œstageéœ€è¦é…åˆä½¿ç”¨ã€‚å¦‚æœä¸€ä¸ªstage failæ‰äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬åº”è¯¥æœŸå¾…ä¸‹ä¸ªstageæ€ä¹ˆåŠå‘¢ï¼Ÿ (When to run a job?) on_success(default): æ‰€æœ‰ä¹‹å‰stageçš„ä»»åŠ¡éƒ½æ‰§è¡ŒæˆåŠŸäº†æ‰æ‰§è¡Œå½“å‰stageçš„ä»»åŠ¡ï¼Œæˆ–è€…ä¹‹å‰failçš„ä»»åŠ¡æœ‰é…ç½®äº†allow_failure: trueon_failure ï¼šåªæœ‰åœ¨ä¹‹å‰çš„æµæ°´çº¿ä»»åŠ¡æœ‰è‡³å°‘ä¸€æ¬¡çš„failä¹‹ä¸‹æ‰æ‰§è¡Œå½“å‰ä»»åŠ¡ã€‚alwaysï¼šæ— è®ºä¹‹å‰çš„stageçš„æµæ°´çº¿çš„ä»»åŠ¡çŠ¶æ€å¦‚ä½•ï¼Œå½“å‰çš„ä»»åŠ¡éƒ½ä¼šè§¦å‘ã€‚neverï¼šä¸è¿è¡Œå½“å‰ä»»åŠ¡manualï¼šæµæ°´çº¿æ‰‹åŠ¨è§¦å‘,ç‚¹å‡»playï¼Œå¦‚ä¸‹å›¾ tagsè¿™ä¸ªæ˜¯è®¾å®šGitlab åœ¨æ‰§è¡Œè„šæœ¬æ—¶ä½¿ç”¨å“ªä¸ªrunner æ³¨æ„äº‹é¡¹:é…ç½®æ—¶æœ‰äº›å…³é”®å­—æ¯”å¦‚workflowï¼Œrulesä»€ä¹ˆçš„ä¼šæ˜¾ç¤ºæŠ¥é”™ XXX config conatins unknown keys. è¿™ä¸ªæ˜¯å› ä¸ºå…¬å¸çš„Gitlabç‰ˆæœ¬è¾ƒæ—§ï¼ŒGitlab 12.5ä¹‹åæ‰æ”¯æŒè¿™äº›é…ç½®ã€‚ å®è·µé¡¹ç›®èƒŒæ™¯ï¼šå­é¡¹ç›®ï¼Œä¾èµ–äº360kuaiä»“åº“ï¼Œæ¯æ¬¡ç¼–è¯‘éœ€è¦æ‹‰å–è¯¥ä»“åº“ä»£ç ç„¶åè¿›è¡Œç¼–è¯‘ï¼Œä¹‹åå°†æ‰“åŒ…åçš„æ–‡ä»¶cpåˆ°360kuaiçš„publicç›®å½•ä¸‹å¯¹åº”çš„è¯¥ä»“åº“çš„æ‰“åŒ…æ–‡ä»¶ç›®å½• 123456789101112131415161718192021222324252627282930313233343536373839404142434445stages: - compileimage: xxx/node-git:0.0.1variables: # GIT_SUBMODULE_STRATEGY: normal NPM_CONFIG_CACHE: '$CI_PROJECT_DIR/.npm'cache: key: files: - package-lock.json paths: - $&#123;NPM_CONFIG_CACHE&#125;compile: stage: compile only: refs: - merge_requests variables: - $TARGET_BRANCH_NAME == \"master\" script: - ls - rm -rf 360kuai - git submodule update --init --recursive --remote --depth=1 - npm ci --prefer-offline - npm run compile after_script: - ls - rm -rf 360kuai - git clone -b xxx/360kuai.git - git config --global user.email \"xxx\" - git config --global user.name \"xxx\" - cd 360kuai # - git checkout master - cp -r ../public/static/css/supmodule public/static/css - cp -r ../public/static/js/supmodule public/static/js - cp -r ../public/static/img/supmodule public/static/img - git status - git add . - git commit --author=\"xxx &lt;xxx@360&gt;\" -m \"æ›´æ–°\" - git log -1 # - git push","categories":[],"tags":[{"name":"cicd","slug":"cicd","permalink":"https://ashleyblog.xyz/tags/cicd/"}]},{"title":"å·¨çŸ³é¡¹ç›®æ”¹é€ æ¢ç©¶.md","slug":"å·¨çŸ³é¡¹ç›®æ”¹é€ æ–¹æ¡ˆæ¢ç©¶","date":"2023-04-03T09:06:15.000Z","updated":"2023-04-16T03:19:59.655Z","comments":true,"path":"2023/04/03/å·¨çŸ³é¡¹ç›®æ”¹é€ æ–¹æ¡ˆæ¢ç©¶/","link":"","permalink":"https://ashleyblog.xyz/2023/04/03/å·¨çŸ³é¡¹ç›®æ”¹é€ æ–¹æ¡ˆæ¢ç©¶/","excerpt":"","text":"èƒŒæ™¯å…¬å¸æœ‰ä¸€ä¸ªå†å²æ‚ ä¹…ã€ä½“ç§¯åºå¤§çš„è€é¡¹ç›®ï¼Œé™¤äº†ä¼ ç»Ÿè€æ—§é¡¹ç›®å­˜åœ¨çš„ç‰¹ç‚¹ï¼Œè¯¥é¡¹ç›®å¼ºä¾èµ–åç«¯æ¨¡æ¿ï¼Œä¸”æ¯ä¸€ä¸ªé¡µé¢éƒ½å¯¹åº”ä¸€ä¸ªæ¨¡æ¿ï¼Œå¯åŠ¨ä¾æ‰˜äºdockerï¼Œéšç€é¡¹ç›®ä¸æ–­æ›´æ–°è¿­ä»£ï¼Œé¡¹ç›®ç»“æ„è¶Šæ¥è¶Šå¤æ‚ï¼Œç»´æŠ¤æˆæœ¬è¶Šæ¥è¶Šé«˜ï¼Œè¿›è€Œå¼•å‘ä¸€ç³»åˆ—çš„é—®é¢˜â€¦ å·¨çŸ³åº”ç”¨å­˜åœ¨çš„é—®é¢˜ é¡¹ç›®ä½“ç§¯è¿‡å¤§ï¼Œcloneæ—¶é—´é•¿ ç»“æ„æ··ä¹±ï¼Œé«˜åº¦è€¦åˆï¼Œéš¾ä»¥ç»´æŠ¤ éœ€è¦è§£å†³æ„å»ºæ—¶é—´é•¿çš„é—®é¢˜ï¼Œéœ€è¦ç»´æŠ¤å¤æ‚çš„webpacké…ç½® å¤šäººå¼€å‘åŒä¸€ä¸ªé¡¹ç›®ï¼Œå‘å¸ƒéƒ¨ç½²å®¹æ˜“æ··ä¹± æŠ€æœ¯æ ˆè¿­ä»£æˆæœ¬é«˜æ˜‚ å¦‚ä½•æ‹†åˆ†ï¼Ÿæ—¢ç„¶æ˜¯å·¨çŸ³åº”ç”¨ï¼Œå¾ˆå®¹æ˜“æƒ³åˆ°çš„æ”¹é€ æ–¹æ¡ˆå°±æ˜¯æ‹†åˆ†æˆå¤šä¸ªå­åº”ç”¨ï¼Œåˆ†è€Œæ²»ä¹‹ï¼Œé€šå¸¸æ¥è¯´æœ‰ä»¥ä¸‹å‡ ç§æ‹†åˆ†æ–¹æ¡ˆï¼š æŒ‰æŠ€æœ¯æ‹†åˆ† æŒ‰ç…§ä¸šåŠ¡æˆ–è€…é¡µé¢æ‹†åˆ† æŒ‰ç…§æƒé™æ‹†åˆ† æŒ‰ç…§å˜æ›´çš„é¢‘ç‡æ‹†åˆ†æˆ‘ä»¬çš„é¡¹ç›®ä¸å­˜åœ¨æƒé™é™åˆ¶ä»¥åŠæŠ€æœ¯æ ˆä¸ç»Ÿä¸€çš„é—®é¢˜,æ˜¾ç„¶è¿™ä¸¤ç§æ‹†åˆ†æ–¹å¼éƒ½ä¸åˆé€‚ï¼Œåœ¨æˆ‘ä»¬çš„ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œä¸€ä¸ªé¡¹ç›®æ˜¯ç”±å¤šä¸ªé¡µé¢ç»„æˆçš„ï¼Œæ¯ä¸ªé¡µé¢ä¹‹å‰çš„çŠ¶æ€ç›¸äº’ç‹¬ç«‹ï¼Œæ˜¾è€Œæ˜“è§çš„ç›´æ¥æŒ‰ç…§ä¸šåŠ¡æ‹†åˆ†å³å¯ï¼Œè¿™é‡Œæ¨èmadgeå·¥å…·ï¼Œå®ƒå¯æ ¹æ®ä½ æŒ‡å®šçš„å…¥å£è‡ªåŠ¨ä¸ºä½ æ‰¾åˆ°å…¥å£çš„ä¾èµ–ï¼Œå¹¶å°†å…¶ä»ä¸»é¡¹ç›®ä¸­å‰¥ç¦»å‡ºæ¥ï¼Œæ‹†åˆ†å®Œæˆä¹‹åï¼Œåˆè¯¥é‡‡ç”¨å“ªç§æ¶æ„æ–¹å¼å‘¢ï¼Ÿ ä¼ ç»Ÿè§£å†³æ–¹æ¡ˆmuti repoä¹Ÿå°±æ˜¯ç›´æ¥å°†å…¶æ‹†åˆ†æˆå¤šä¸ªä»“åº“ï¼Œç®€å•ç²—æš´ä½†å­˜åœ¨ä¸å°‘é—®é¢˜ï¼š ç®¡ç†ã€è°ƒè¯•å›°éš¾å¤šä¸ª git ä»“åº“ç®¡ç†èµ·æ¥å¤©ç„¶æ˜¯éº»çƒ¦çš„ã€‚å¯¹äºåŠŸèƒ½ç±»ä¼¼çš„æ¨¡å—ï¼Œå¦‚æœæ‹†æˆäº†å¤šä¸ªä»“åº“ï¼Œæ— è®ºå¯¹äºå¤šäººåä½œè¿˜æ˜¯ç‹¬ç«‹å¼€å‘ï¼Œéƒ½éœ€è¦æ‰“å¼€å¤šä¸ªä»“åº“ã€‚è™½ç„¶ vscode é€šè¿‡ Workspaces è§£å†³å¤šä»“åº“ç®¡ç†çš„é—®é¢˜ï¼Œä½†åœ¨å¤šäººåä½œçš„åœºæ™¯ä¸‹ï¼Œæ— æ³•ä¿è¯æ¯ä¸ªäººçš„ç¯å¢ƒé…ç½®ä¸€è‡´ã€‚ åˆ†æ”¯ç®¡ç†æ··ä¹±å‡å¦‚ä¸€ä¸ªä»“åº“æä¾›ç»™ Aã€B ä¸¤ä¸ªé¡¹ç›®ç”¨ï¼Œè€Œ B é¡¹ç›®ä¼˜å…ˆå¼€å‘äº†åŠŸèƒ½ bï¼Œæ— æ³•ä¸ A é¡¹ç›®å…¼å®¹ï¼Œæ­¤æ—¶å°±è¦åœ¨è¿™ä¸ªä»“åº“å¼€ä¸€ä¸ª feature/b çš„åˆ†æ”¯æ”¯æŒè¿™ä¸ªåŠŸèƒ½ï¼Œå¹¶ä¸”åœ¨æœªæ¥åˆå¹¶åˆ°ä¸»å¹²åŒæ­¥åˆ°é¡¹ç›® Aã€‚ä¸€æ—¦éœ€è¦å¼€åˆ†æ”¯çš„ç»„ä»¶å˜å¤šäº†ï¼Œä¸”ä¹‹é—´å‡ºæ¥ä¾èµ–å…³è”ï¼Œåˆ†æ”¯ç®¡ç†å¤æ‚åº¦å°±ä¼šå‘ˆæŒ‡æ•°ä¸Šå‡ã€‚ ä¾èµ–å…³ç³»å¤æ‚ç‹¬ç«‹ä»“åº“é—´ç»„ä»¶ç‰ˆæœ¬å·çš„ç»´æŠ¤éœ€è¦æ‰‹åŠ¨æ“ä½œï¼Œå› ä¸ºæºä»£ç ä¸åœ¨ä¸€èµ·ï¼Œæ‰€ä»¥æ²¡æœ‰åŠæ³•æ•´ä½“åˆ†æä¾èµ–ï¼Œè‡ªåŠ¨åŒ–ç®¡ç†ç‰ˆæœ¬å·çš„ä¾èµ–ã€‚ä¸‰æ–¹ä¾èµ–ç‰ˆæœ¬å¯èƒ½ä¸ä¸€è‡´:ä¸€ä¸ªç‹¬ç«‹çš„åŒ…æ‹¥æœ‰ä¸€å¥—ç‹¬ç«‹çš„å¼€å‘ç¯å¢ƒï¼Œéš¾ä»¥ä¿è¯å­æ¨¡å—çš„ç‰ˆæœ¬å’Œä¸»é¡¹ç›®å®Œå…¨ä¸€ç›´ï¼Œå°±å­˜åœ¨è¿è¡Œç»“æœä¸ä¸€è‡´çš„é£é™©ã€‚ å ç”¨æ€»ç©ºé—´å¤§æ­£å¸¸æƒ…å†µä¸‹ï¼Œä¸€ä¸ªå…¬å¸çš„ä¸šåŠ¡é¡¹ç›®åªæœ‰ä¸€ä¸ªä¸»å¹²ï¼Œå¤š git repo çš„æ–¹å¼æµªè´¹äº†å¤§é‡å­˜å‚¨ç©ºé—´é‡å¤å®‰è£…æ¯”å¦‚ React ç­‰å¤§å‹æ¨¡å—ï¼Œæ—¶é—´ä¹…äº†å¯èƒ½ä¼šå ç”¨å‡ å GB çš„é¢å¤–ç©ºé—´ï¼Œå¯¹äºæ²¡æœ‰å¤–æ¥ç¡¬ç›˜çš„åŒå­¦æ¥è¯´ï¼Œå®šæœŸæ¸…ç†ä¸ç”¨çš„é¡¹ç›®ä¸‹ node_modules ä¹Ÿæ˜¯ä¸€ä»¶éº»çƒ¦äº‹ã€‚ ä¸åˆ©äºå›¢é˜Ÿåä½œä¸€ä¸ªå¤§é¡¹ç›®å¯èƒ½ä¼šç”¨åˆ°æ•°ç™¾ä¸ªäºŒæ–¹åŒ…ï¼Œä¸åŒäºŒæ–¹åŒ…çš„ç»´æŠ¤é¢‘ç‡ä¸åŒï¼Œæƒé™ä¸åŒï¼Œä»“åº“ä½ç½®ä¹Ÿä¸åŒï¼Œä¸»ä»“åº“å¯¹å®ƒä»¬çš„ä¾èµ–æ–¹å¼ä¹Ÿä¸åŒã€‚ä¸€æ—¦å…¶ä¸­ä¸€ä¸ªåŒ…è¿›è¡Œäº†éæ­£å¸¸æ”¹åŠ¨ï¼Œå°±ä¼šå½±å“åˆ°æ•´ä¸ªé¡¹ç›®ï¼Œè€Œæˆ‘ä»¬ç²¾åŠ›æœ‰é™ï¼Œåªç›¯ç€ä¸»ä»“åº“ï¼Œå¾€å¾€ä¼šæ ½åœ¨ä¸èµ·çœ¼çš„äºŒæ–¹åŒ…å‘å¸ƒä¸Šã€‚ ä»£ç æ— æ³•å¤ç”¨ä¹‹å‰æˆ‘ä»¬è¯´è¿‡æˆ‘ä»¬çš„é¡¹ç›®å¼ºä¾èµ–äºåç«¯ï¼Œå¦‚æœç›´æ¥äº†å½“çš„æ‹†åˆ†æˆå¤šä¸ªé¡¹ç›®çš„è¯ï¼Œåç«¯ä»£ç ä¹Ÿä¼šå­˜åœ¨äºå¤šä¸ªä»“åº“ï¼Œä½†æ˜¯ç”±äºæ•´ä¸ªçš„æ”¹é€ æˆ‘ä»¬ä»…ä»…åªæƒ³é’ˆå¯¹äºå‰ç«¯ï¼Œéœ€è¦å¯¹åç«¯åŒå­¦æ˜¯æ— æ„ŸçŸ¥çš„ï¼Œæ˜¾ç„¶è¿™ç§æ–¹å¼æ— æ³•åšåˆ° ç°ä»£åŒ–è§£å†³æ–¹æ¡ˆmonorepoæ˜¯ç®¡ç†é¡¹ç›®ä»£ç çš„ä¸€ä¸ªæ–¹å¼ï¼ŒæŒ‡åœ¨ä¸€ä¸ªé¡¹ç›®ä»“åº“ (repo) ä¸­ç®¡ç†å¤šä¸ªæ¨¡å—/åŒ… (package)ï¼Œä¸åŒäºå¸¸è§çš„æ¯ä¸ªæ¨¡å—å»ºä¸€ä¸ª repoã€‚ ä¼˜åŠ¿ï¼š å¤šä¸ªé¡¹ç›®ä¸€å¥—é…ç½®ä½†æ˜¯å¯ä»¥åˆ†æ‰¹æ„å»ºåˆ†å¼€å‘å¸ƒ å¼€å‘é˜¶æ®µä¸ç”¨æ¥å›åˆ‡æ¢é¡¹ç›® å¯ä»¥å…±ç”¨ä»£ç  åŒæ—¶ä¸ç”¨å‘å¸ƒå³å¯æœ¬åœ°è°ƒè¯•å…¬å…±åŒ… ç®€åŒ–çš„ä¾èµ–ç®¡ç†ï¼Œæ— éœ€ä¸ºä¾èµ–é¡¹æŒ‡å®šç‰ˆæœ¬å·ï¼Œå› ä¸ºæ‰€æœ‰é¡¹ç›®åªæœ‰ä¸€ä¸ªé€šç”¨ç‰ˆæœ¬å·ã€‚ ä¾èµ–å¯å¤ç”¨ åŠ£åŠ¿ï¼š ä»“åº“ä½“ç§¯è¾ƒå¤§ æäº¤è®°å½•å®¹æ˜“æ··ä¹± å› ä¸ºæ˜¯ä¸€ä¸ªä»“åº“ï¼Œä¸å¥½å¯¹å­é¡¹ç›®åšå•ç‹¬çš„æƒé™å¤„ç† ä¸é€‚åˆåšè‡ªåŠ¨åŒ–å‘å¸ƒ å¤šä¸ªé¡¹ç›®ä¸€èˆ¬éƒ½æ˜¯ç‹¬ç«‹çš„å‘å¸ƒä¸å¥½ç»Ÿä¸€ éœ€è¦è‡ªå·±ç®¡ç†ä¾èµ–å…³ç³» æäº¤å†å²å®¹æ˜“æ··ä¹±ï¼Œéœ€è¦è‡ªå·±ç®¡ç† é€‚ç”¨åœºæ™¯ï¼šé€‚åˆå†…èšæ€§æ¯”è¾ƒå¼ºçš„å·¥å…·ç±»ã€æ¡†æ¶ç±»å·¥ç¨‹ï¼Œä¾‹å¦‚reactç›¸å…³ã€ Angularç›¸å…³ï¼Œä¸€èˆ¬å‘å¸ƒä¼šæœ‰ä¸€ç³»åˆ—çš„ä¾èµ–åŒæ­¥æ›´æ–°ï¼›åŒæ—¶è¿™ç§å·¥ç¨‹å‘å±•æ˜¯å¯æ§çš„ï¼Œä¸ä¼šéšæ„è†¨èƒ€ï¼Œæ‰€ä»¥åº“çš„ä½“ç§¯ä¹Ÿæ˜¯å¯æ§çš„ã€‚ ä¸é€‚ç”¨åœºæ™¯ï¼š ä½“ç§¯ä¸å¯æ§çš„é¡¹ç›® éœ€è¦åšæƒé™ç®¡ç†çš„é¡¹ç›® ä¸é€‚ç”¨å­é¡¹ç›®æŠ€æœ¯æ ˆå·®å¼‚å¤§çš„åœºæ™¯ å›åˆ°æˆ‘ä»¬çš„ä¸šåŠ¡åœºæ™¯ï¼Œç”±äºå„ä¸ªå­åº”ç”¨ä¹‹é—´çš„æ„å»ºå­˜åœ¨å·®å¼‚æ²¡å¿…è¦å…±ç”¨ä¸€å¥—æ„å»ºé…ç½®ï¼Œä¸”å­˜åœ¨é¡¹ç›®ä½“ç§¯ä¸å¯æ§ã€ç›®å‰åªæ”¯æŒå…¨é‡å‘å¸ƒç­‰å› ç´ ï¼Œå› æ­¤æœªé‡‡ç”¨æ”¹æ–¹æ¡ˆ git submodules + muti repoä»€ä¹ˆæ˜¯git submodules?å…è®¸æ‚¨å°† Git å­˜å‚¨åº“ä¿ç•™ä¸ºå¦ä¸€ä¸ª Git å­˜å‚¨åº“çš„å­ç›®å½•ï¼Œè¿™ä½¿æ‚¨å¯ä»¥å°†å¦ä¸€ä¸ªå­˜å‚¨åº“å…‹éš†åˆ°æ‚¨çš„é¡¹ç›®ä¸­ï¼Œå¹¶å°†æ‚¨çš„æäº¤åˆ†å¼€ï¼Œå­ä»“åº“åŒ…å«äº†ä¸€æ•´ä¸ªå®Œæ•´çš„gitä»“åº“,ç”šè‡³åŒ…å«äº†.gitç›®å½•ã€‚æˆ‘å¸é‡‡ç”¨çš„ä¹Ÿæ˜¯è¯¥æ–¹æ¡ˆï¼Œåœ¨æˆ‘ä»¬çš„åœºæ™¯ä¸­å¯ä»¥å°†å·¨çŸ³é¡¹ç›®ä¸­çš„å„ä¸ªé¡µé¢æ‹†åˆ†æˆä¸€ä¸ªç‹¬ç«‹çš„é¡¹ç›®ï¼Œç„¶åå°†æ‰€æœ‰é¡µé¢éƒ½ä¾èµ–çš„åº•å±‚æœåŠ¡ä»¥åŠå…¬å…±ç»„ä»¶ã€å…¬å…±æ–¹æ³•ç­‰æŠ½ç¦»å‡ºæ¥ä½œä¸ºå­ä»“åº“ï¼Œä¿®æ”¹å­ä»“åº“çš„æ—¶å€™æ— éœ€åˆ‡æ¢é¡¹ç›®åªéœ€cd ${å­ä»“åº“ç›®å½•}å³å¯ã€‚ ä¼˜åŠ¿ ä»£ç å¯å¤ç”¨ï¼Œè°ƒè¯•æˆæœ¬ä½ï¼šæ‹†åˆ†å‡ºå­æ¨¡å—ä¹‹åï¼Œä¹Ÿèƒ½åšåˆ°å¯ä»¥å…±ç”¨ä¸€å¥—å…¬å…±ä»£ç è€Œæ— éœ€å®‰è£…npmåŒ…å¹¶ä¸”å¯ä»¥ç›´æ¥æœ¬åœ°è°ƒè¯• å¯ä»¥ç›´æ¥åœ¨æ‹†å‡ºæ¥çš„é¡¹ç›®ä¸­ï¼Œè¿è¡Œsubmoduleçš„ä»£ç ï¼šå› æ­¤å¯ä»¥åœ¨submoduleä¸­æ”¾ä¸€äº›å…¬å…±æœåŠ¡ï¼Œé€‚ç”¨äºä¾èµ–äºdockeræˆ–è€…æ˜¯å‰åç«¯æœªå®Œå…¨åˆ†ç¦»ä¹‹ç±»çš„é¡¹ç›®ï¼Œæ¯”å¦‚åœ¨æˆ‘ä»¬çš„ä¸šåŠ¡ä¸­ï¼Œåªéœ€å­ä»“åº“ç»´æŠ¤ä¸€å¥—åç«¯æ¨¡æ¿ä¸dockeré…ç½®ï¼Œè¿è¡Œå­ä»“åº“çš„å®¿ä¸»ä»“åº“çš„æ—¶å€™åªéœ€cd ${å­ä»“åº“ç›®å½•}è¿è¡Œå®¹å™¨ï¼Œç„¶åå°†å®¿ä¸»ä»“åº“çš„ç«¯å£ä»£ç†åˆ°å®¹å™¨è¿è¡Œçš„8083ç«¯å£å³å¯ï¼Œåœ¨å‘æŒ¥äº†å¤šä»“åº“ä¼˜åŠ¿çš„åŒæ—¶ä¿è¯äº†åŸºç¡€æœåŠ¡ï¼ˆåç«¯ä»£ç ï¼‰çš„å”¯ä¸€æ€§ åŠ£åŠ¿ cloneçš„æ—¶å€™éœ€è¦é¢å¤–cloneä¸€ä¸‹å­é¡¹ç›®ï¼Œå¦‚æœå­ä»“åº“ä½“ç§¯è¿‡å¤§å°±ä¼šé€ æˆcloneæ—¶é—´è¿‡é•¿ ä¿®æ”¹å­é¡¹ç›®çš„æ—¶å€™éœ€è¦åˆ‡æ¢åˆ°å­é¡¹ç›®çš„ä»“åº“ ç›¸æ¯”npmåŒ…çš„å½¢å¼ï¼Œåªè¦ä¿®æ”¹äº†submoduleä¸­çš„ä»£ç å°±ä¼šç‰µä¸€å‘è€ŒåŠ¨å…¨èº«ï¼Œå­˜åœ¨é£é™© åªæ˜¯å¯¹å¤ç”¨ä»£ç æä¾›äº†è§£å†³æ–¹æ¡ˆï¼Œå…¶ä»–ä¼ ç»Ÿå¤šä»“åº“çš„é—®é¢˜è¿˜æ˜¯å­˜åœ¨ webpack5æ¨¡å—è”é‚¦ï¼ˆModule Federationï¼‰ä¹Ÿæ˜¯ä¸€ç§æå–å…¬å…±æ¨¡å—çš„æ–¹æ¡ˆï¼Œ æ¯ä¸ªå­åº”ç”¨å•ç‹¬æ„å»ºï¼Œä¸»åº”ç”¨åœ¨è¿è¡Œæ—¶é€šè¿‡å®¹å™¨åŠ è½½è¿œç¨‹æ¨¡å—å³å­åº”ç”¨çš„æ„å»ºã€‚ä¸»åº”ç”¨è‡ªåŠ¨ä½¿ç”¨å­åº”ç”¨å½“å‰ç‰ˆæœ¬çš„æœ€æ–°èµ„æºï¼Œä¸€å¥è¯æ¦‚æ‹¬å°±æ˜¯ï¼šå®ƒèƒ½å…è®¸ä¸€ä¸ªçº¿ä¸Šéƒ¨ç½²çš„é¡¹ç›®åœ¨è¿è¡Œæ—¶åŠ è½½å…¶ä»–çº¿ä¸Šéƒ¨ç½²é¡¹ç›®ä¸­çš„ç»„ä»¶ã€‚ åŸºæœ¬åŸç†è®¾æƒ³ä¸€ä¸‹ï¼Œåœ¨ webpack ä¸­å¯ä»¥å°†ä¸€äº›åç»­åŠ è½½çš„æ¨¡å—æ‰“æˆ chunk åŒ…ï¼Œç„¶ååœ¨ä½¿ç”¨åˆ°è¿™ä¸ªæ¨¡å—çš„æ—¶å€™å†æ‡’åŠ è½½ï¼Œè¿™ç§æƒ…å½¢ä¸€èˆ¬æ˜¯åœ¨åŒä¸€ä¸ªé¡¹ç›®ä¸­è¿›è¡Œã€‚é‚£ä¹ˆæˆ‘ä»¬æ˜¯å¦ä¹Ÿå¯ä»¥åœ¨ A é¡¹ç›®ä¸­æŠŠä¸€ä¸ªç»„ä»¶åŠå…¶ä¾èµ–æ‰“åŒ…æˆ chunk åŒ…ï¼Œè€Œåœ¨ B é¡¹ç›®ä¸­æŒ‰çº¦å®šçš„åœ°å€å¼‚æ­¥ import åˆšæ‰é‚£ä¸ª A é¡¹ç›®çš„ chunk åŒ…ï¼Œå¹¶è¿è¡Œä½¿ç”¨å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯ Module Federationã€‚ åŸºæœ¬æ¦‚å¿µ è¿œç¨‹ç»„ä»¶æä¾›æ–¹ç§°ä¸º remote ç«¯ï¼Œè¿œç¨‹ç»„ä»¶ä½¿ç”¨æ–¹ç§°ä¸º host ç«¯ã€‚ ä¸€ä¸ªé¡¹ç›®æ—¢å¯ä»¥ä¸º remote ç«¯ï¼Œä¹Ÿå¯ä»¥ä¸º host ç«¯ï¼Œå¯ä»¥ä½¿ç”¨æ•°ä¸ªä¸åŒå…¶ä»–é¡¹ç›®çš„ç»„ä»¶ï¼Œä¹Ÿå¯ä»¥ä¸ºæ•°ä¸ªå…¶ä»–é¡¹ç›®æä¾›ä¸åŒçš„ç»„ä»¶ã€‚ å…·ä½“æ€ä¹ˆå·¥ä½œï¼Ÿä¾‹å­ï¼šé¡¹ç›®è¦å¼•å…¥ä¸€ä¸ªå·¥å•å·¥ä½œå°çš„é¡µé¢ï¼Œå¦‚ä¸‹ï¼šå·¥å•å·¥ä½œå°ä½œä¸º remote ç«¯çš„é…ç½® remoteç«¯ï¼ˆå·¥å•å·¥ä½œå°ï¼‰(1) ç”±äºæˆ‘ä»¬ä¸¤ä¸ªé¡¹ç›®éƒ½ä½¿ç”¨çš„æ˜¯ vue3 + vite æ–¹æ¡ˆï¼Œæ‰€ä»¥ä½¿ç”¨ vite-plugin-federation æ’ä»¶æ˜¯æˆ‘ä»¬æœ€ä½³çš„é€‰æ‹©ã€‚é¦–å…ˆéœ€è¦åœ¨ host ç«¯å’Œ remote ç«¯å®‰è£…æ’ä»¶ï¼Œå¦‚ä¸‹å‘½ä»¤ï¼š 1yarn add @originjs/vite-plugin-federation -D (2) åœ¨æ’ä»¶å†…æ³¨å†Œéœ€è¦æä¾›çš„ç»„ä»¶,å¹¶ä¸”æä¾›éœ€è¦å…±äº«çš„ä¸‰æ–¹ä¾èµ– (3) é…ç½®å®Œæˆåæ‰“åŒ…åœ¨ remote ç«¯æ‰“åŒ…åä¼šç”Ÿæˆå¯¹åº”çš„å…¥å£æ–‡ä»¶ï¼Œchunk æ–‡ä»¶åŠä¾èµ–åŒ…æ–‡ä»¶ hostç«¯ï¼ˆIM å’Œç”µè¯å·¥ä½œå°ï¼‰(1) æ’ä»¶é…ç½®ï¼Œè®¾ç½®è¿œç¨‹åŒ…åœ°å€ (2) å¼•ç”¨åŠæ³¨å†Œç»„ä»¶ï¼Œmain.ts æ–‡ä»¶å¦‚ä¸‹è¿™æ—¶éœ€è¦æ³¨æ„ï¼Œticket-share ä¸º host ä¾§åœ¨ vite æ’ä»¶ä¸­æ³¨å†Œçš„åŒ…åï¼ŒDetail ä¸º remote ç«¯æš´éœ²(exposes å­—æ®µ)å£°æ˜çš„ç»„ä»¶åã€‚é™¤äº†åœ¨å…¨å±€æ³¨å†Œï¼Œè¿˜å¯ä»¥åœ¨ä»»æ„éœ€è¦å¼•ç”¨çš„åœ°æ–¹å¼•ç”¨ã€‚(3) ç»„ä»¶çš„ä½¿ç”¨åœ¨éœ€è¦çš„åœ°æ–¹å¼•å…¥ä½¿ç”¨ï¼Œå¹¶æ ¹æ®ä¸šåŠ¡æƒ…å†µä¼ é€’ propsï¼Œprops çš„ä½¿ç”¨æ–¹å¼ä¸æ™®é€šç»„ä»¶æ— å¼‚ã€‚æ­¤æ—¶æˆ‘ä»¬å·²ç»å®Œæˆäº†å…¨éƒ¨é…ç½®ï¼Œæ­¤åæˆ‘ä»¬åªè¦æ‰“åŒ…ä¸Šçº¿è¿è¡Œå³å¯ã€‚ çº¿ä¸Šå¦‚ä½•è°ƒè¯•ä½¿ç”¨Redirector æµè§ˆå™¨æ‰©å±•ï¼šå‡è®¾å¾®åº”ç”¨ç¨‹åºçš„è¿œç¨‹å…¥å£æ–‡ä»¶åœ¨https://my-federated-app.com/federated/my-micro-app/remoteEntry.js. ç„¶åï¼Œå¦‚æœæˆ‘æƒ³ä½¿ç”¨æœ¬åœ°å¼€å‘æœåŠ¡å™¨å¤„ç†æ­¤åº”ç”¨ç¨‹åºï¼Œæˆ‘å¯ä»¥å°†åŒ…å«è¯¥æ¨¡å¼çš„ä»»ä½•è¯·æ±‚é‡å®šå‘/federated/my-micro-app/åˆ°http://localhost:3000è¿è¡Œå¼€å‘æœåŠ¡å™¨çš„ä½ç½® ä¼˜åŠ¿ æ›´æ–°æˆæœ¬ä½ï¼šå¼•å…¥å…¬å…±åŒ…ä¸éœ€è¦æ‰“åŒ…å†å‘å¸ƒï¼Œç›¸æ¯”npmåŒ…ï¼Œä¸éœ€è¦æŒ¨ä¸ªå‡çº§ä½¿ç”¨è¯¥åŒ…çš„é¡¹ç›®çš„ä¾èµ–ç‰ˆæœ¬ï¼Œä»–ä¹Ÿé€‚ç”¨äºå¤æ‚åº¦é«˜çš„ï¼Œä¸šåŠ¡å…³è”æ€§é«˜ï¼Œæ›´æ–°é¢‘æ¬¡é«˜çš„ä¸‰é«˜é¡µé¢çº§ç»„ä»¶ æŠ€æœ¯æˆæœ¬ä½ï¼šåªéœ€è¦ä¿®æ”¹ä¸€ä¸‹webpacké…ç½®å³å¯ æ”¯æŒå»¶è¿ŸåŠ è½½ï¼š bundleä»¥ä»…åœ¨å¿…è¦æ—¶åŠ è½½æ¨¡å—ï¼Œä»è€Œæé«˜ Web æ€§èƒ½ã€‚ å‡å°‘é‡å¤æ€§ä¾èµ–ï¼šå¼•å…¥çš„å…¬å…±ä»£ç å¯ä»¥ç›´æ¥ä½¿ç”¨å®¿ä¸»ç¯å¢ƒçš„ä¾èµ– çµæ´»æ‹†åˆ†ï¼Œç»†ç²’åŒ–ç¨‹åº¦é«˜ï¼šç›¸æ¯”git submodulesï¼Œå¯ä»¥é¢—ç²’åŒ–åˆ°å•é¡µåº”ç”¨æˆ–è€…ç»„ä»¶ã€‚ä¹Ÿå°±æ˜¯è¯´ä»–ä¹Ÿå¯ä»¥ä»£æ›¿iframe åŠ£åŠ¿ æ²¡æœ‰æ ·å¼éš”ç¦»æœºåˆ¶ï¼Œå®¹æ˜“é€ æˆä¸»å­åº”ç”¨æ ·å¼æ±¡æŸ“ æœ¬åœ°å¼€å‘éœ€è¦å¼€å¯å¤šä¸ªç«¯å£çš„æœåŠ¡ï¼Œæ¯”è¾ƒéº»çƒ¦ å…±äº«åŒ…çš„ç»´æŠ¤æˆæœ¬é«˜ï¼šéœ€è¦å°†ç»„ä»¶å…±äº«çš„åŒ…éƒ½æ‰¾å‡ºæ¥ï¼Œå…±äº«æœ‰æ—¶æ˜¯å¼ºåˆ¶çš„ï¼Œå¦‚æœæ¼äº†æŸäº›åŒ…ï¼Œå¯èƒ½ä¼šå¯¼è‡´é¡µé¢æŠ¥é”™æˆ–å´©æºƒï¼ŒåŒä¸€ä¸ªåº“ï¼Œæœ‰æ—¶éœ€è¦ç»´æŠ¤åœ¨çº¦å®šçš„ç‰ˆæœ¬èŒƒå›´å†…ï¼Œæœ‰æ—¶ä¸€ä¸ªåŒ…å¤ªè€æˆ–å¤ªæ–°ä¹Ÿä¼šåœ¨åŠ è½½æ—¶æŠ¥é”™ï¼ˆä¸è¿‡æ˜¯å¦éœ€è¦å…±äº«å¯ä¾›ç”¨æˆ·é€‰æ‹©ï¼‰ éœ€è¦åˆç†è§„åˆ’chunkæ‹†åˆ†ï¼Œå¦‚æœæ‹†åˆ†chunkè¿‡å¤šä¼šå¯¼è‡´è¯·æ±‚Chunkæ•°é‡è¿‡å¤šï¼Œå¹¶å‘é‡è¿‡å¤§ï¼Œå¦‚æœå¤šä¸ªæ¨¡å—å…±ç”¨ä¸€ä¸ªremoteEntryåˆæ— æ³•å¯¹å…¶ä¸­åŒ…å«çš„æ¨¡å—çš„ç‰ˆæœ¬åšå•ç‹¬ç®¡ç†ï¼ˆæ”¹åŠ¨é¢‘ç¹çš„åˆ’åˆ†åˆ°ä¸€èµ·ï¼Œå¦‚ä½•åƒnpmåŒ…ä¸€æ ·åšç‰ˆæœ¬ç®¡ç†ï¼Ÿexternal-remote-plugin å¯ä»¥è®©ç‰ˆæœ¬å·ç”±JSåŠ¨æ€æ³¨å…¥ï¼Œè¿™é‡Œå¯ä»¥ç»“åˆäº‘æ§é…ç½®ï¼‰ å›åˆ°æˆ‘ä»¬çš„ä¸šåŠ¡åœºæ™¯ï¼Œç”±äºæ¨¡å—è”é‚¦åªèƒ½å¤ç”¨JS chunkï¼Œå¯¹äºæˆ‘ä»¬ä¾èµ–çš„åç«¯æœåŠ¡æ— æ³•å¤ç”¨ï¼Œå› æ­¤æ— æ³•ä½œä¸ºåŸºå±‚è§£å†³æ–¹æ¡ˆï¼Œä½†æ˜¯ä»–èƒ½è§£å†³ç›®å‰ä»£ç å¤ç”¨æ–¹å¼å­˜åœ¨çš„é—®é¢˜ï¼šç”±äºæˆ‘ä»¬çš„å„ä¸ªå­é¡¹ç›®éƒ½ä¾èµ–äº†submoduleä¸­çš„å…¬å…±ç»„ä»¶ã€å…¬å…±æ–¹æ³•ï¼Œæ¯å½“ä¿®æ”¹ä¸€æ¬¡è¿™äº›å…¬å…±ç»„ä»¶ã€æ–¹æ³•çš„æ—¶å€™ï¼Œæ— è®ºå­åº”ç”¨éœ€ä¸éœ€è¦ä¿®æ”¹è°ƒç”¨æ–¹å¼ï¼Œéƒ½éœ€è¦åœ¨æ¯ä¸ªåº”ç”¨åˆ°è¿™äº›å…¬å…±ç»„ä»¶ã€æ–¹æ³• çš„åº”ç”¨é‡æ–°ç¼–è¯‘æ‰“åŒ…ï¼Œæ˜¾ç„¶å½±å“åˆ°äº†æ•ˆç‡ï¼Œåˆ©ç”¨æ¨¡å—è”é‚¦çš„ç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¿è¯ä¿®æ”¹æ— å‰¯ä½œç”¨çš„å‰æä¸‹ï¼Œç›´æ¥ä¸Šçº¿submoduleçš„å†…å®¹ï¼Œå¯¹äºå­åº”ç”¨æ˜¯æ— æ„ŸçŸ¥çš„ï¼Œåªæ˜¯cdné“¾æ¥æŒ‡å‘çš„Js chunkçš„å†…å®¹å˜äº†è€Œå·² å¾®å‰ç«¯å¾®å‰ç«¯æ˜¯ä¸€ç§ç±»ä¼¼äºå¾®æœåŠ¡çš„æ¶æ„ï¼Œå®ƒå°†å¾®æœåŠ¡çš„ç†å¿µåº”ç”¨äºæµè§ˆå™¨ç«¯ï¼Œå³å°† Web åº”ç”¨ç”±å•ä¸€çš„å•ä½“åº”ç”¨è½¬å˜ä¸ºå¤šä¸ªå°å‹å‰ç«¯åº”ç”¨èšåˆä¸ºä¸€çš„åº”ç”¨ã€‚å¾®å‰ç«¯æ¶æ„ä¸æ¡†æ¶æ— å…³ï¼Œæ¯ä¸ªå¾®åº”ç”¨éƒ½å¯ä»¥ç‹¬ç«‹å¼€å‘ã€ç‹¬ç«‹è¿è¡Œã€ç‹¬ç«‹éƒ¨ç½²ã€‚ qiankunä¹¾å¤æ˜¯å¸‚é¢ä¸Šå¸¸è§çš„å¾®å‰ç«¯æ¡†æ¶ï¼Œä»¥æ­¤ä¸ºä¾‹è¯´è¯´ä»–çš„ç‰¹æ€§ï¼šqiankuné‡‡ç”¨HTML Entry æ–¹å¼è¿›è¡Œäº†æ›¿ä»£ä¼˜åŒ–ã€‚ ä»€ä¹ˆæ˜¯HTML Entry? å°±æ˜¯ç›´æ¥å°†å­åº”ç”¨æ‰“å‡ºæ¥ HTML ä½œä¸ºå…¥å£ï¼Œä¸»æ¡†æ¶å¯ä»¥é€šè¿‡ fetch html çš„æ–¹å¼è·å–å­åº”ç”¨çš„é™æ€èµ„æºï¼ŒåŒæ—¶å°† HTML document ä½œä¸ºå­èŠ‚ç‚¹å¡åˆ°ä¸»æ¡†æ¶çš„å®¹å™¨ä¸­ã€‚ ä½¿ç”¨qiankunè¿›è¡Œå¾®å‰ç«¯æ”¹é€ åï¼Œé¡µé¢è¢«æ‹†åˆ†ä¸ºä¸€ä¸ªåŸºåº§åº”ç”¨å’Œå¤šä¸ªå­åº”ç”¨ï¼Œæ¯ä¸ªå­åº”ç”¨éƒ½è¿è¡Œåœ¨ç‹¬ç«‹çš„æ²™ç®±ç¯å¢ƒä¸­ã€‚ å…·æœ‰å¦‚ä¸‹ç‰¹ç‚¹ï¼š ç‹¬ç«‹æ€§ï¼šå¾®å‰ç«¯çš„ä¸»åº”ç”¨ä»¥åŠå„ä¸ªå­åº”ç”¨ç‹¬ç«‹å¼€å‘ã€ç‹¬ç«‹éƒ¨ç½²ï¼Œå¹¶ä¸”åœ¨ä¸€å®šç¨‹åº¦ä¸Šå¾®å‰ç«¯å­åº”ç”¨å¯ä»¥ç‹¬ç«‹äºä¸»åº”ç”¨å•ç‹¬è¿è¡Œï¼› æ²™ç®±éš”ç¦»ï¼šå­åº”ç”¨æœ‰è‡ªå·±å•ç‹¬çš„è¿è¡Œæ—¶ï¼Œå„ä¸ªå­åº”ç”¨ä¹‹é—´çš„çŠ¶æ€ä¸è¢«å…±äº«ï¼Œä¹Ÿå°±æ˜¯å„ä¸ªå­åº”ç”¨ä¹‹é—´ï¼šCSSä¸JSéƒ½æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œä¸ä¼šè¢«åˆ«çš„å­åº”ç”¨æ‰€æ±¡æŸ“ã€‚ æ¡†æ¶æ— å…³ï¼šå­åº”ç”¨å®Œå…¨å¯ä»¥é‡‡å–ä¸åŒçš„æ¡†æ¶è¿›è¡Œå¼€å‘ï¼Œå› ä¸ºç°æœ‰å¾®å‰ç«¯æ¡†æ¶å®ç°ä¸­ï¼Œä¸»åº”ç”¨ä»…æ˜¯åŠ è½½å­åº”ç”¨æ„å»ºåçš„ bundleï¼› çŠ¶æ€å…±äº«ï¼šå­åº”ç”¨å¯å…±äº«ä¸»åº”ç”¨çš„çŠ¶æ€ å¯ä»¥çœ‹å‡ºä»–ç›¸æ¯”åˆ«çš„æ–¹æ¡ˆæœ€å¤§çš„ä¼˜åŠ¿æ˜¯æ²™ç®±éš”ç¦»ä¸æ¡†æ¶æ— å…³ é€‚ç”¨åœºæ™¯ å½“å·¨çŸ³åº”ç”¨ä¸­æŸä¸€éƒ¨åˆ†éœ€è¦åœ¨æŠ€æœ¯æ ˆä¸Šåšå¢é‡å‡çº§æˆ–è€…é‡æ„çš„æ—¶å€™ éœ€è¦å®ç°å‰ç«¯åº”ç”¨çš„åŠ¨æ€åŠ è½½å’Œå¸è½½ä»¥æé«˜ç”¨æˆ·ä½“éªŒè·Ÿèµ„æºåˆ©ç”¨ç‡ éœ€è¦ä¿è¯å„ä¸ªå‰ç«¯åº”ç”¨ä¹‹é—´çš„æ ·å¼éš”ç¦»ä»¥åŠjsæ²™ç®± éœ€è¦å°†å¤šä¸ªå‰ç«¯åº”ç”¨æ•´åˆä¸ºä¸€ä¸ªæ•´ä½“ä½†æ˜¯åˆä¸æƒ³ç‰ºç‰²å„è‡ªçš„æŠ€æœ¯æ ˆè·Ÿå¼€å‘æ–¹å¼ ä¸é€‚ç”¨åœºæ™¯å‰ç«¯å¤æ‚åº¦è¾ƒä½ï¼Œæ²¡å¿…è¦å„ä¸ªåº”ç”¨ä¹‹é—´æœ‰å¾ˆå¼ºçš„ä¸šåŠ¡è€¦åˆæˆ–è€…æ•°æ®ä¾èµ–ã€éœ€è¦é¢‘ç¹é€šä¿¡æˆ–è€…æ˜¯å…±äº«çŠ¶æ€ ç”±äºæˆ‘ä»¬çš„é¡¹ç›®æœ¬èº«å°±æ˜¯ä¸€ä¸ªå¤šé¡µé¢é¡¹ç›®ï¼Œå¤©ç„¶æ”¯æŒHTML Entryï¼ŒåŠ ä¸Šæˆ‘ä»¬æ˜¯å°†å·¨çŸ³åº”ç”¨æ‹†åˆ†æˆå¤šä¸ªå°åº”ç”¨è€Œä¸æ˜¯èšåˆå¤šä¸ªå°åº”ç”¨å› æ­¤ä¸å­˜åœ¨æŠ€æœ¯æ ˆä¸ç»Ÿä¸€çš„é—®é¢˜ï¼Œä¸è¿™ä¸ªæ–¹æ¡ˆå¹¶ä¸æ˜¯å¾ˆåŒ¹é… æ€»ç»“æ— è®ºæ˜¯å“ªä¸€ç§æ–¹æ¡ˆéƒ½ä¸æ˜¯å®Œç¾çš„ï¼Œå…·ä½“åº”ç”¨å“ªä¸€ç§è¿˜æ˜¯éœ€è¦ç»“åˆä¸šåŠ¡åœºæ™¯ã€åˆ‡èº«å®è·µé€‰æ‹© å‚è€ƒ https://xie.infoq.cn/article/cab16528dc0ecf3514fdfd492 https://www.burhanuday.com/blog/2023/03/devx-and-deployments-in-a-module-federated-micro-frontend","categories":[],"tags":[{"name":"æ¶æ„","slug":"æ¶æ„","permalink":"https://ashleyblog.xyz/tags/æ¶æ„/"}]},{"title":"æ‹¯æ•‘åŠ¨ç”»å¡é¡¿ä¹‹FLIP","slug":"æ‹¯æ•‘åŠ¨ç”»å¡é¡¿ä¹‹FLIP","date":"2023-03-20T15:16:48.000Z","updated":"2023-04-16T03:19:11.433Z","comments":true,"path":"2023/03/20/æ‹¯æ•‘åŠ¨ç”»å¡é¡¿ä¹‹FLIP/","link":"","permalink":"https://ashleyblog.xyz/2023/03/20/æ‹¯æ•‘åŠ¨ç”»å¡é¡¿ä¹‹FLIP/","excerpt":"","text":"å‰ç½®çŸ¥è¯†ä»€ä¹ˆæ˜¯FPSFPSæ˜¯æµè§ˆå™¨çš„æ¯ç§’çš„æ¸²æŸ“å¸§æ•°ï¼Œä¹Ÿå°±æ˜¯æµè§ˆå™¨åˆ‡æ¢ç”»é¢çš„æ¬¡æ•°ï¼Œå¤§å¤šæ•°è®¾å¤‡çš„åˆ·æ–°ç‡éƒ½æ˜¯60FPSï¼Œä¸€èˆ¬æ¥è¯´FPSè¶Šä½é¡µé¢å°±ä¼šè¶Šå¡é¡¿ã€‚ ä»€ä¹ˆæ˜¯åƒç´ ç®¡é“ï¼Ÿåƒç´ ç®¡é“æ˜¯æµè§ˆå™¨å•ä¸ªå¸§çš„æ¸²æŸ“æµæ°´çº¿ï¼Œå¦‚æœå…¶ä¸­æœ‰æŸäº›ç¯èŠ‚æ‰§è¡Œè¿‡ç¨‹è¿‡é•¿å°±ä¼šå¯¼è‡´å¡é¡¿ JavaScriptã€‚é€šå¸¸æ¥è¯´ï¼Œé˜»å¡çš„å‘èµ·éƒ½æ˜¯æ¥è‡ªäº JS ï¼Œè¿™ä¸æ˜¯è¯´ä¸ç”¨ JSï¼Œè€Œæ˜¯è¦æ­£ç¡®çš„ä½¿ç”¨ JS ã€‚é¦–å…ˆï¼ŒJS çº¿ç¨‹çš„è¿è¡Œæœ¬èº«å°±æ˜¯é˜»å¡ UI çº¿ç¨‹çš„ï¼ˆæš‚ä¸è€ƒè™‘ Web Workerï¼‰ã€‚ä»çº¯ç²¹çš„æ•°å­¦è§’åº¦è€Œè¨€ï¼Œæ¯å¸§çš„é¢„ç®—çº¦ä¸º 16.7 æ¯«ç§’ï¼ˆ1000 æ¯«ç§’ / 60 å¸§ = 16.66 æ¯«ç§’/å¸§ï¼‰ã€‚ä½†å› ä¸ºæµè§ˆå™¨éœ€è¦èŠ±è´¹æ—¶é—´å°†æ–°å¸§ç»˜åˆ¶åˆ°å±å¹•ä¸Šï¼Œåªæœ‰ ~10 æ¯«ç§’æ¥æ‰§è¡Œ JS ä»£ç ï¼Œè¿‡é•¿æ—¶é—´çš„åŒæ­¥æ‰§è¡Œ JS ä»£ç è‚¯å®šä¼šå¯¼è‡´è¶…è¿‡ 10ms è¿™ä¸ªé˜ˆå€¼ï¼Œå…¶æ¬¡ï¼Œé¢‘ç¹æ‰§è¡Œä¸€äº›ä»£ç ä¹Ÿä¼šè¿‡é•¿çš„å ç”¨æ¯å¸§æ¸²æŸ“çš„æ—¶é—´ã€‚æ­¤å¤–ï¼Œç”¨ JS å»è·å–ä¸€äº›æ ·å¼è¿˜ä¼šå¯¼è‡´å¼ºåˆ¶åŒæ­¥å¸ƒå±€ã€‚ æ ·å¼è®¡ç®—ï¼ˆStyleï¼‰ã€‚æ­¤è¿‡ç¨‹æ˜¯æ ¹æ®åŒ¹é…é€‰æ‹©å™¨ï¼ˆä¾‹å¦‚ .headline æˆ– .nav &gt; .nav__itemï¼‰è®¡ç®—å‡ºå“ªäº›å…ƒç´ åº”ç”¨å“ªäº› CSS è§„åˆ™çš„è¿‡ç¨‹ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸ä»…åŒ…æ‹¬è®¡ç®—å±‚å æ ·å¼è¡¨ä¸­çš„æƒé‡æ¥ç¡®å®šæ ·å¼ï¼Œä¹ŸåŒ…æ‹¬å†…è”çš„æ ·å¼ï¼Œæ¥è®¡ç®—æ¯ä¸ªå…ƒç´ çš„æœ€ç»ˆæ ·å¼ã€‚ å¸ƒå±€ï¼ˆLayoutï¼‰ã€‚åœ¨çŸ¥é“å¯¹ä¸€ä¸ªå…ƒç´ åº”ç”¨å“ªäº›è§„åˆ™ä¹‹åï¼Œæµè§ˆå™¨å³å¯å¼€å§‹è®¡ç®—è¯¥å…ƒç´ è¦å æ®çš„ç©ºé—´å¤§å°åŠå…¶åœ¨å±å¹•çš„ä½ç½®ã€‚ç½‘é¡µçš„å¸ƒå±€æ¨¡å¼æ„å‘³ç€ä¸€ä¸ªå…ƒç´ å¯èƒ½å½±å“å…¶ä»–å…ƒç´ ï¼Œä¸€èˆ¬æ¥è¯´å¦‚æœä¿®æ”¹äº†æŸä¸ªå…ƒç´ çš„å¤§å°æˆ–è€…ä½ç½®ï¼Œåˆ™éœ€è¦æ£€æŸ¥å…¶ä»–æ‰€æœ‰å…ƒç´ å¹¶é‡æ’ï¼ˆre-flowï¼‰æ•´ä¸ªé¡µé¢ã€‚ ç»˜åˆ¶ï¼ˆPaintï¼‰ã€‚ç»˜åˆ¶æ˜¯å¡«å……åƒç´ çš„è¿‡ç¨‹ã€‚å®ƒæ¶‰åŠç»˜å‡ºæ–‡æœ¬ã€é¢œè‰²ã€å›¾åƒã€è¾¹æ¡†å’Œé˜´å½±ï¼ŒåŸºæœ¬ä¸ŠåŒ…æ‹¬å…ƒç´ çš„æ¯ä¸ªå¯è§†éƒ¨åˆ†ã€‚ç»˜åˆ¶ä¸€èˆ¬æ˜¯åœ¨å¤šä¸ªè¡¨é¢ï¼ˆé€šå¸¸ç§°ä¸ºå±‚ï¼‰ä¸Šå®Œæˆçš„ï¼Œç»˜åˆ¶åŒ…æ‹¬ä¸¤ä¸ªæ­¥éª¤ï¼š 1) åˆ›å»ºç»˜å›¾è°ƒç”¨çš„åˆ—è¡¨ï¼Œ 2) å¡«å……åƒç´ ï¼Œåè€…ä¹Ÿè¢«ç§°ä½œæ …æ ¼åŒ–ã€‚ åˆæˆï¼ˆCompositeï¼‰ã€‚ç”±äºé¡µé¢çš„å„éƒ¨åˆ†å¯èƒ½è¢«ç»˜åˆ¶åˆ°å¤šä¸ªå±‚ä¸Šï¼Œå› æ­¤å®ƒä»¬éœ€è¦æŒ‰æ­£ç¡®é¡ºåºç»˜åˆ¶åˆ°å±å¹•ä¸Šï¼Œæ‰èƒ½æ­£ç¡®åœ°æ¸²æŸ“é¡µé¢ã€‚å°¤å…¶å¯¹äºä¸å¦ä¸€å…ƒç´ é‡å çš„å…ƒç´ æ¥è¯´ï¼Œè¿™ç‚¹ç‰¹åˆ«é‡è¦ï¼Œå› ä¸ºä¸€ä¸ªé”™è¯¯å¯èƒ½ä½¿ä¸€ä¸ªå…ƒç´ é”™è¯¯åœ°å‡ºç°åœ¨å¦ä¸€ä¸ªå…ƒç´ çš„ä¸Šå±‚ã€‚ ä¸Šè¿°çš„äº”ä¸ªé˜¶æ®µå¹¶ä¸æ˜¯ä¸€å®šéƒ½ä¼šæ‰§è¡Œåˆ°çš„ï¼Œè¿™äº”ä¸ªé˜¶æ®µä¸­æ¶‰åŠåˆ°äº†è€ç”Ÿå¸¸è°ˆçš„ä¸¤ä¸ªæ¦‚å¿µï¼šé‡æ’è·Ÿé‡ç»˜ï¼Œè™½ç„¶åˆæ¬¡æ¸²æŸ“å¸ƒå±€è·Ÿç»˜åˆ¶å¿…ä¸å¯å°‘ï¼Œä½†æ˜¯åæœŸæˆ‘ä»¬å¯ä»¥æ§åˆ¶é¿å…é€šè¿‡è¿™ä¸¤ä¸ªç®¡é“ï¼šä»¥ä¸‹æ˜¯å½“æˆ‘ä»¬ä¿®æ”¹ä¸åŒçš„æ ·å¼å±æ€§æ—¶ï¼Œä¼šè§¦å‘çš„å‡ ç§å¸§æµç¨‹ï¼š ä»ä¸Šå›¾ä¸­èƒ½çœ‹åˆ°JSé˜¶æ®µä»¥åŠStyle å’Œ Compositeé˜¶æ®µ æ˜¯ä¸å¯é¿å…çš„ï¼Œå› ä¸ºéœ€è¦ JS æ¥å¼•å‘æ ·å¼çš„æ”¹å˜ï¼ŒStyle æ¥è®¡ç®—æ›´æ”¹åæœ€ç»ˆçš„æ ·å¼ï¼ŒComposite æ¥åˆæˆå„ä¸ªå±‚æœ€ç»ˆè¿›è¡Œæ˜¾ç¤ºï¼Œèƒ½è·³è¿‡çš„æ­¥éª¤åªæœ‰å¸ƒå±€è·Ÿç»˜åˆ¶ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œæ‰§è¡Œçš„é˜¶æ®µè¶Šå°‘ï¼Œè€—æ—¶å°±è¶Šå°‘ï¼Œæ¯ç§’çš„æ¸²æŸ“å¸§æ•°å°±ä¼šè¶Šé«˜ï¼Œé‚£ä¹ˆèƒ½ä¸èƒ½ç›´æ¥è·³è¿‡è¿™ä¸¤ä¸ªæ­¥éª¤ç›´æ¥åˆ°åˆæˆå‘¢ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œå¦‚ä¸‹çš„å±æ€§åªä¼šè§¦å‘åˆæˆé˜¶æ®µï¼štransformã€opacityã€pointer-eventsã€perspective ï¼ˆé€è§†æ•ˆæœï¼‰ã€curosrã€orphansè®¾ç½®å½“å…ƒç´ å†…éƒ¨å‘ç”Ÿåˆ†é¡µæ—¶å¿…é¡»åœ¨é¡µé¢åº•éƒ¨ä¿ç•™çš„æœ€å°‘è¡Œæ•°ï¼ˆç”¨äºæ‰“å°æˆ–æ‰“å°é¢„è§ˆï¼‰ã€widowsï¼ˆè®¾ç½®å½“å…ƒç´ å†…éƒ¨å‘ç”Ÿåˆ†é¡µæ—¶å¿…é¡»åœ¨é¡µé¢é¡¶éƒ¨ä¿ç•™çš„æœ€å°‘è¡Œæ•°ï¼ˆç”¨äºæ‰“å°æˆ–æ‰“å°é¢„è§ˆï¼‰ï¼‰ã€‚ FLIPç»¼ä¸Šæ‰€è¿°ï¼Œå½“æˆ‘ä»¬å†™åŠ¨ç”»çš„æ—¶å€™å¦‚æœç”¨height margin padding leftç­‰ä¼šè§¦å‘é‡æ’çš„å±æ€§ï¼Œç›¸è¾ƒäºåªç”¨transformæˆ–è€…opacityä¼šå¸¦æ¥æ›´å¤šçš„æ€§èƒ½å¼€é”€ï¼Œä¸€æ—¦è¿™ä¸ªè®¡ç®—æ—¶é•¿è¶…è¿‡1ä¸ªåŠ¨ç”»å¸§(ä¸€èˆ¬æ˜¯60å¸§æ¯ç§’,ä¹Ÿå°±æ˜¯è¯´è¶…è¿‡16.7ms), é‚£ä¹ˆè¿™å¸§åŠ¨ç”»å°†ä¸ä¼šç»˜åˆ¶ï¼Œäº§ç”Ÿé¡µé¢å¡é¡¿ã€‚FLIPæŠ€æœ¯ï¼Œå°±æ˜¯ä¸€ç§è®©åŠ¨ç”»åªåˆ©ç”¨åˆ°transformæˆ–è€…opacityçš„æŠ€å·§ï¼ŒFLIPæ˜¯ First, Last, Invert, Playçš„ç®€ç§°ã€‚ æ¦‚å¿µFirstå¯¹åº”åŠ¨ç”»çš„Starté˜¶æ®µï¼Œç”¨ element.getBoundingClientRect()è®°å½•åˆå§‹ä½ç½®ã€‚ Lastå¯¹åº”åŠ¨ç”»çš„Endé˜¶æ®µï¼Œå…ˆæ‰§è¡Œè§¦å‘layoutå˜åŠ¨çš„ä»£ç ï¼ŒåŒæ ·çš„ç”¨element.getBoundingClientRect()è®°å½•å…ƒç´ çš„ç»ˆæ­¢ä½ç½®ã€‚ Invertç°åœ¨å…ƒç´ å¤„äºEndä½ç½®ï¼Œåˆ©ç”¨ transform åšä¸€ä¸ªé€†è¿ç®—ï¼Œè®©æ·»åŠ äº† transform çš„å…ƒç´ å›å½’åˆ°åˆå§‹ä½ç½®ã€‚ PlayçœŸæ­£éœ€è¦æ‰§è¡ŒåŠ¨ç”»æ—¶ï¼Œå°† transform ç½®ä¸º None ä¸Šè¿°é˜¶æ®µå¯èƒ½æœ‰äººä¼šå›°æƒ‘ï¼ŒgetBoundingClientRectä¸æ˜¯ä¹Ÿä¼šè§¦å‘é‡æ’å—ï¼Ÿä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯æˆ‘ä»¬çš„é‡å¿ƒæ˜¯åœ¨åŠ¨ç”»é˜¶æ®µï¼Œè¦ä¿éšœçš„æ˜¯åŠ¨ç”»é˜¶æ®µçš„æµç•…ï¼Œæ›´ä½•å†µç”¨æˆ·åœ¨ç½‘é¡µä¸Šè¿›è¡Œäº¤äº’æ—¶ï¼Œæ¯”å¦‚clickï¼Œtouchï¼Œä»äº¤äº’ç»“æŸåˆ°æ„ŸçŸ¥åˆ°ç¨‹åºçš„ç›¸åº”å¤§çº¦éœ€è¦100msçš„ç”Ÿç†ååº”æ—¶é—´ã€‚æˆ‘ä»¬åœ¨ç”¨æˆ·äº¤äº’åè¦åš100mså†…å‡†å¤‡å¥½åŠ¨ç”»å°±å¥½äº†ï¼Œè¿™äº›åŠ¨ç”»å‡†å¤‡è®¡ç®—å°±æ˜¯getBoundingClientRect(æˆ–getComputedStyle)ç­‰çš„è®¡ç®—ã€‚ å®è·µç°åœ¨å®ç°ä¸€ä¸ªç®€å•çš„ä»å·¦åˆ°å³çš„å¾ªç¯æ»šåŠ¨åŠ¨ç”» 1234567891011121314151617181920212223242526272829const playAnimate = (el) =&gt; &#123; if (!el) return; // è®°å½•åˆå§‹ä½ç½®ï¼Œå¯¹åº” FLIPçš„FIRST const pos = tagWrapperRef.current?.getBoundingClientRect(); const &#123; left: initLeft &#125; = pos; // è®¾ç½®å…ƒç´ æ ·å¼ä¸ºåŠ¨ç”»ç»“æŸæ—¶çš„ç›®æ ‡ä½ç½® tagWrapperRef.current.classList.add('scroll-to-end'); // è®°å½•ç»ˆæ­¢ä½ç½® å¯¹åº”FLIPçš„LAST const endPos = tagWrapperRef.current?.getBoundingClientRect(); const &#123; left: endLeft &#125; = endPos; // è®¡ç®—åˆå§‹ä½ç½®è·Ÿç»ˆæ­¢ä½ç½®çš„åå·® const deltaLeft = initLeft - endLeft; tagWrapperRef.current.animate( [ // åŠ¨ç”»å¼€å§‹æ—¶ï¼Œåˆ©ç”¨ `transform` åšä¸€ä¸ªé€†è¿ç®—ï¼Œè®©æ·»åŠ äº† `transform` çš„å…ƒç´ å›å½’åˆ°åˆå§‹ä½ç½®ã€‚ &#123; transform: `translate($&#123;deltaLeft&#125;px,0)`, &#125;, &#123; transform: 'none', &#125;, ], &#123; duration: totalTime * 1000, easing: 'linear', iterations: Infinity, &#125; ); &#125; 123.scroll-to-end&#123; left:100% &#125; é‡‡ç”¨FLIPçš„å½¢å¼æˆåŠŸçš„é¿å¼€äº†åŠ¨ç”»è¿‡ç¨‹ä¸­æ›´æ”¹leftã€‚æˆ‘ä»¬æ³¨æ„åˆ°ï¼šæˆ‘ä»¬å¯ä»¥åœ¨åŠ¨ç”»å¼€å§‹å‰é¢„å…ˆç”¨APIè®¡ç®—å…ƒç´ åœ¨åŠ¨ç”»ç»ˆæ­¢æ—¶å€™çš„ä½ç½®ï¼Œåªè¦çŸ¥é“äº†ç»ˆæ€è·Ÿåˆå§‹çŠ¶æ€ï¼Œå°±èƒ½è¿…é€Ÿè®¡ç®—å‡ºè¦è¾¾åˆ°ç»ˆæ€è¯¥æ€ä¹ˆç§»åŠ¨ï¼Œç”±æ­¤é¿å¼€ä¸€äº›å¤æ‚çš„è®¡ç®—ï¼Œç”±æ­¤æˆ‘ä»¬ä¹Ÿå¯ä»¥å¾—å‡ºï¼š é™¤äº†ç”¨æ¥åšæ€§èƒ½ä¼˜åŒ–ä¹‹å¤–ï¼ŒFLIPä¹Ÿèƒ½ç”¨äºç®€åŒ–æŸäº›åœºæ™¯ä¸‹åŠ¨ç”»çš„å®ç°è¿‡ç¨‹ï¼Œå¦‚ä»¥ä¸‹å‡ ä¸ªåœºæ™¯ï¼š å…ƒç´ å®¿ä¸»å…ƒç´ çš„å˜åŒ–ï¼Œæ¯”å¦‚å°†å…ƒç´ ä»Aç§»åŠ¨åˆ°B å®¹å™¨å¤§å°å˜åŒ– å›¾ç‰‡å±•å¼€å’Œæ”¶ç¼©æ•ˆæœ é¡¹ç›®åˆ é™¤å’Œæ·»åŠ æ—¶å¡«å……ç©ºç™½åŒºåŸŸçš„æ•ˆæœ ç½‘æ ¼é¡¹çš„é‡æ–°æ’åºä¸¾ä¸ªä¾‹å­ï¼Œå¦‚ç¬¬ä¸‰ä¸ªåœºæ™¯ï¼Œå¦‚è‹¥æ·»åŠ æˆ–è€…åˆ é™¤çš„å¡ç‰‡çš„å¤§å°æ˜¯æœªçŸ¥çš„ï¼Œå¦‚æœç”¨å¸¸è§„çš„æ–¹å¼ç§»åŠ¨å…¶ä»–å¡ç‰‡å°†å˜å¾—å›°éš¾ï¼Œè€Œå¦‚æœä½¿ç”¨FLIPï¼Œé—®é¢˜å°†è¿åˆƒè€Œè§£12345678910111213141516171819// Lastif (updateType === 0) &#123; // å¢åŠ å¡ç‰‡ newListData = this.state.listData.slice(0, activeIndex).concat(&#123; index: cardIndex++ &#125;, this.state.listData.slice(activeIndex)) &#125; else &#123; // åˆ é™¤å¡ç‰‡ newListData = this.state.listData.filter((value, index) =&gt; index !== activeIndex)&#125;// Invert// 0 å¢åŠ  1 åˆ é™¤const updateIndex = updateType === 0 ? 1 : 0activeList.forEach((item, index) =&gt; &#123; rect = item.getBoundingClientRect() invertArr[index + updateIndex][0] = invertArr[index + updateIndex][0] - rect.left invertArr[index + updateIndex][1] = invertArr[index + updateIndex][1] - rect.top ... ä½¿ç”¨FLIPå½¢å¼éœ€è¦æ³¨æ„ä»€ä¹ˆ FLIPä¸­çš„å‰ä¸‰ä¸ªé˜¶æ®µä¹Ÿå°±æ˜¯å‰æœŸçš„å‡†å¤‡å·¥ä½œéœ€è¦åœ¨ç»˜åˆ¶è¿™ä¸ªæ­¥éª¤ä¹‹å‰ï¼Œä¹Ÿå°±æ˜¯æ—¶é—´éœ€è¦å°½å¯èƒ½çš„æ§åˆ¶åœ¨ä¹‹å‰æåˆ°çš„100msä»¥å†…ï¼Œå¦åˆ™çš„è¯ æ¸²æŸ“çš„è¿‡ç¨‹ä¸­å¯èƒ½å‡ºç°é—ªçƒï¼Œä½†æ˜¯æˆ‘ä»¬æ€ä¹ˆæ‰èƒ½æŠ“ä½ç»˜åˆ¶å‰è¿™ä¸ªæ—¶æœºå‘¢ï¼Ÿæœ¬äººç”¨Reactæ¯”è¾ƒå¤šï¼Œä»¥Reactä¸ºä¾‹ï¼šç­”æ¡ˆæ˜¯useLayoutEffectï¼Œå®ƒæ¥å—ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ä¼šåœ¨domæ›´æ–°åã€é‡ç»˜ä¹‹å‰åŒæ­¥çš„æ‰§è¡Œ æ¯”å¦‚ï¼Œæˆ‘ä»¬å®ç°ä¸€ä¸ªç‚¹å‡»æ–¹å—äº’æ¢ä½ç½®çš„åŠ¨ç”»ï¼ˆè¯¦è§https://codepen.io/jlkiri/pen/oNjaMrK) 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657const Flipper = () =&gt; &#123; const [ids, setIds] = React.useState([\"square-1\", \"square-2\"]); const rects = React.useRef(new Map()).current; const swap = ([a, b]) =&gt; [b, a]; React.useEffect(() =&gt; &#123; const squares = document.querySelectorAll(\".square\"); // Cache position and size once on initial render for (const square of squares) &#123; rects.set(square.id, square.getBoundingClientRect()); &#125; &#125;, []); React.useLayoutEffect(() =&gt; &#123; const squares = document.querySelectorAll(\".square\"); for (const square of squares) &#123; // Get previous size and position from cache const cachedRect = rects.get(square.id); if (cachedRect) &#123; const nextRect = square.getBoundingClientRect(); // Invert const translateX = cachedRect.x - nextRect.x; // Cache the next size and position rects.set(square.id, nextRect); // Play square.animate( [ &#123; transform: `translateX($&#123;translateX&#125;px)` &#125;, &#123; transform: `translateX(0px)` &#125; ], 1000 ); &#125; &#125; &#125;, ids); return ( &lt;div className=\"container\"&gt; &#123;ids.map((id, i) =&gt; &#123; return ( &lt;div id=&#123;id&#125; onClick=&#123;() =&gt; setIds(swap(ids))&#125; className=&#123;`square`&#125;&gt; &#123;id&#125; &lt;/div&gt; ); &#125;)&#125; &lt;/div&gt; );&#125;;ReactDOM.render(&lt;Flipper /&gt;, document.querySelector(\"#root\")); ä»¥ä¸Šå¯ä»¥ç”¨å¦‚ä¸‹çš„æµç¨‹å›¾æ¦‚æ‹¬ï¼šè™½ç„¶useEffectæ€»æ˜¯åœ¨useLayoutEffectä»¥åŠæµè§ˆå™¨ç»˜åˆ¶ä¹‹åæ‰§è¡Œï¼Œä½†æ˜¯æ³¨æ„åˆ°è¿™é‡Œæˆ‘ä»¬ä»…ä»…åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“ä¹‹åæ‰§è¡Œäº†ï¼Œè€Œè¿™é‡Œçš„useLayoutEffectåœ¨ä¹‹åçš„æ¯ä¸€æ¬¡æ¸²æŸ“ä¹‹åéƒ½ä¼šæ‰§è¡Œã€‚ é¿å…å¤šæ¬¡è§¦å‘é‡æ’å¯èƒ½ä¼šæœ‰çš„äººâ€œè¯»â€â€œå†™â€ä¸€èµ·è¿›è¡Œã€‚ é”™è¯¯çš„åšæ³•ï¼šå¾ªç¯éå†å…ƒç´ å¹¶ä½¿ç”¨ getBoundingClientRect è¯»å–å®ƒä»¬çš„ä½ç½®ï¼Œç„¶åç«‹å³ä½¿ç”¨ animate ä¸ºå®ƒä»¬è®¾ç½®åŠ¨ç”»ã€‚ æ­£ç¡®çš„åšæ³•ï¼šæ‰¹é‡çš„è¯»å–ä¸å†™å…¥ æœ€åInvertè¿™ä¸€æ­¥éª¤å¯èƒ½æœ‰äº›è®¸éº»çƒ¦ï¼Œä»Šå¹´5æœˆä»½ä½œè€…æä¾›äº†æ’ä»¶Flip Plugin å‚è€ƒ FLIP Your Animations Animating Layouts with the FLIP Technique å‰ç«¯æ€§èƒ½ä¼˜åŒ–ä¹‹æµè§ˆå™¨æ¸²æŸ“ä¼˜åŒ– â€”â€” æ‰“é€ 60FPSé¡µé¢","categories":[],"tags":[{"name":"css","slug":"css","permalink":"https://ashleyblog.xyz/tags/css/"}]},{"title":"a2hs debugè®°å½•","slug":"debugè®°å½•","date":"2023-03-15T13:34:53.000Z","updated":"2023-04-16T03:18:54.700Z","comments":true,"path":"2023/03/15/debugè®°å½•/","link":"","permalink":"https://ashleyblog.xyz/2023/03/15/debugè®°å½•/","excerpt":"","text":"beforeInstallPromptäº‹ä»¶ä¸è§¦å‘å¦‚æœé¡µé¢æ˜¯å¯å®‰è£…çš„è¯ï¼Œå°†åœ¨é¡µé¢åŠ è½½åä¸ä¹…è§¦å‘ã€‚ æ²¡è§¦å‘çš„åŸå› ï¼Ÿ PWA å¿…é¡»å°šæœªå®‰è£… ï¼ˆchrome://appsæŸ¥çœ‹å·²ç»å®‰è£…çš„åº”ç”¨ï¼‰ æ»¡è¶³ç”¨æˆ·å‚ä¸å¯å‘å¼ï¼ˆä»¥å‰ï¼Œç”¨æˆ·å¿…é¡»ä¸åŸŸäº¤äº’è‡³å°‘ 30 ç§’ï¼Œè¿™ä¸å†æ˜¯è¦æ±‚ï¼‰ã€‚ æ‚¨çš„ Web åº”ç”¨ç¨‹åºå¿…é¡»åŒ…å« Web åº”ç”¨ç¨‹åºæ¸…å•ã€‚ æ‚¨çš„ Web åº”ç”¨ç¨‹åºå¿…é¡»é€šè¿‡å®‰å…¨çš„ HTTPS è¿æ¥æä¾›æœåŠ¡ã€‚(æˆ–è€…æ˜¯localhost)å¦‚æœè¯ä¹¦è¿‡æœŸäº†è¯ä¹¦æœ‰é—®é¢˜ä¹Ÿä¼šæœ‰é—®é¢˜ è¿™é‡Œå¯ä»¥ç›´æ¥ç”¨chrome://flags/#unsafely-treat-insecure-origin-as-secureè®¾ç½®ä¸€ä¸‹ æ³¨æ„æœ¬åœ°éœ€è¦å¯httpæœåŠ¡ï¼Œå¦‚æœæ˜¯HTTPSä¼šä¸ç”Ÿæ•ˆï¼Œå¦‚æœæ˜¯ä¸ä»…ä»…åœ¨Chromeæµ‹è¯•ï¼Œæ¨èwebpack-mkcertæœ¬åœ°å°±èƒ½å¯åŠ¨https è¯ä¹¦æœ‰æ•ˆ å·²ä½¿ç”¨ fetch äº‹ä»¶å¤„ç†ç¨‹åºæ³¨å†Œäº†ä¸€ä¸ªæœåŠ¡å·¥ä½œè€…ã€‚ manifest.jsonç¼–å†™æœ‰é—®é¢˜ï¼Œï¼ˆæ³¨æ„è¿™é‡Œä¹Ÿå¯ä»¥æ˜¯jsonåç¼€ï¼‰ å¦‚ä¸‹ start_urlæœ‰é—®é¢˜æˆ–è€…æ˜¯æ²¡è®¾ç½®scopeï¼Œå½“è®¾ç½®çš„æ˜¯ç›¸å¯¹è·¯å¾„çš„æ—¶å€™ï¼Œæ˜¯ç›¸å¯¹äºå½“å‰jsonæ–‡ä»¶æ‰€åœ¨çš„è·¯å¾„ï¼Œå¦‚æœJSONæ–‡ä»¶æ˜¯ä¸€ä¸ªå¤–é“¾æ–‡ä»¶çš„è¯ï¼Œè¿™é‡Œçš„start_urléœ€è¦æ˜¯ç»å¯¹è·¯å¾„ï¼ŒåŒæ—¶scope ä¹Ÿå¿…é¡»è®¾ç½®æˆç»å¯¹è·¯å¾„ iconsçš„srcæœ‰é—®é¢˜ï¼Œå›¾ç‰‡å¿…é¡»è·Ÿè®¾ç½®çš„sizesæ˜¯åŒä¸€å®½é«˜æ¯”ï¼Œæ­¤å¤–ä¼¼ä¹åªæ”¯æŒpng jpegæ ¼å¼ iconsçš„srcæ²¡è®¾ç½®type æ€ä¹ˆdebug ï¼Ÿ devtoolçš„lighthouseå¯ä»¥æ£€æµ‹ä½ çš„pwaå­˜åœ¨å“ªäº›é—®é¢˜ ä¸ºä»€ä¹ˆä¸ç”Ÿæ•ˆï¼Œä½†æ˜¯å¥½åƒä¸å‡†ç¡® éªŒè¯è¯¥æµè§ˆå™¨æ˜¯å¦æ”¯æŒï¼Ÿ demo(æºç ) æ€ä¹ˆåŠ¨æ€è®¾ç½®start_url?12345678910111213141516171819202122import manifestJson from './manifests.json'; const manifestContent = &#123; ...manifestJson, name, start_url: window.location.href, scope: `$&#123;window.location.origin&#125;$&#123;window.location.pathname&#125;` &#125;; const imgType = cover.replace(/\\?.*/, '').split('.').slice(-1)[0]; const &#123;icons&#125; = manifestContent; icons[0].src = cover; icons[0].type = `image/$&#123;imgType&#125;`; const linkDom = document.querySelector('#manifest'); const stringManifest = JSON.stringify(manifestContent); if (linkDom) &#123; linkDom.setAttribute('href', 'data:application/json;charset=utf-8,' + encodeURIComponent(stringManifest)); &#125; else &#123; const link = document.createElement('link'); link.id = 'manifest'; link.rel = 'manifest'; link.setAttribute('href', 'data:application/json;charset=utf-8,' + encodeURIComponent(stringManifest)); document.head.appendChild(link); &#125; ä»¥ä¸Šæµ‹è¯•ç»“æœæ¥æºäºchrome, 360æµè§ˆå™¨, Safariä¸æ”¯æŒbeforeInstallPrompt","categories":[],"tags":[{"name":"a2hs","slug":"a2hs","permalink":"https://ashleyblog.xyz/tags/a2hs/"}]},{"title":"æ·±å…¥react hooks","slug":"hooks","date":"2023-01-21T15:02:53.000Z","updated":"2023-04-16T03:18:38.808Z","comments":true,"path":"2023/01/21/hooks/","link":"","permalink":"https://ashleyblog.xyz/2023/01/21/hooks/","excerpt":"","text":"ä¸ºä»€ä¹ˆä¼šå‡ºç°hooks? ç±»ç»„ä»¶é€æ¸è¢«å‡½æ•°å¼ç»„ä»¶å®Œå…¨å–ä»£ å‡½æ•°å¼ç»„ä»¶æ•è·äº†æ¸²æŸ“æ‰€ç”¨çš„å€¼ã€‚ å‡½æ•°ç»„ä»¶æ›´åŠ ç¬¦åˆè®¾è®¡ç†å¿µã€ä¹Ÿæ›´æœ‰åˆ©äºé€»è¾‘æ‹†åˆ†å’Œå¤ç”¨ ç›¸æ¯”ç±»ç»„ä»¶ï¼Œå‡½æ•°ç»„ä»¶ç¼–å†™æ›´è½»ä¾¿ï¼Œç”Ÿæˆçš„ä»£ç ä¹Ÿæ›´å°‘hooksæ˜¯å®Œå…¨ä¸ºå‡½æ•°ç»„ä»¶è®¾è®¡çš„ï¼Œå®ƒèƒ½è®©å‡½æ•°ç»„ä»¶æ‹¥æœ‰ç±»ç»„ä»¶çš„èƒ½åŠ›ï¼Œå¹¶ä¸”ä¿ç•™è½»é‡ã€ä¼˜é›…çš„ç‰¹æ€§ã€‚æ¢è®¨åŸç†ä¹‹å‰å…ˆçœ‹çœ‹å¦‚ä¸‹å‡ ä¸ªé—®é¢˜ï¼Ÿ 1 åœ¨æ— çŠ¶æ€ç»„ä»¶æ¯ä¸€æ¬¡å‡½æ•°ä¸Šä¸‹æ–‡æ‰§è¡Œçš„æ—¶å€™ï¼Œreactç”¨ä»€ä¹ˆæ–¹å¼è®°å½•äº†hooksçš„çŠ¶æ€ï¼Ÿ 2 å¤šä¸ªreact-hooksç”¨ä»€ä¹ˆæ¥è®°å½•æ¯ä¸€ä¸ªhooksçš„é¡ºåºçš„ ï¼Ÿ æ¢ä¸ªé—®æ³•ï¼ä¸ºä»€ä¹ˆä¸èƒ½æ¡ä»¶è¯­å¥ä¸­ï¼Œå£°æ˜hooks? hookså£°æ˜ä¸ºä»€ä¹ˆåœ¨ç»„ä»¶çš„æœ€é¡¶éƒ¨ï¼Ÿ 3 functionå‡½æ•°ç»„ä»¶ä¸­çš„useStateï¼Œå’Œ classç±»ç»„ä»¶ setStateæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ 4 react æ˜¯æ€ä¹ˆæ•è·åˆ°hooksçš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œæ˜¯åœ¨å‡½æ•°ç»„ä»¶å†…éƒ¨çš„ï¼Ÿ 5 useEffect,useMemo ä¸­ï¼Œä¸ºä»€ä¹ˆuseRefä¸éœ€è¦ä¾èµ–æ³¨å…¥ï¼Œå°±èƒ½è®¿é—®åˆ°æœ€æ–°çš„æ”¹å˜å€¼ï¼Ÿ 6 useMemoæ˜¯æ€ä¹ˆå¯¹å€¼åšç¼“å­˜çš„ï¼Ÿå¦‚ä½•åº”ç”¨å®ƒä¼˜åŒ–æ€§èƒ½ï¼Ÿ 7 ä¸ºä»€ä¹ˆä¸¤æ¬¡ä¼ å…¥useStateçš„å€¼ç›¸åŒï¼Œå‡½æ•°ç»„ä»¶ä¸æ›´æ–°? functionç»„ä»¶å’Œclassç»„ä»¶æœ¬è´¨çš„åŒºåˆ«é¦–å…ˆå›é¡¾ä¸€ä¸‹functionç»„ä»¶å’Œclassç»„ä»¶çš„åŒºåˆ« 12345678910111213141516171819202122232425262728293031323334353637// classç»„ä»¶class Index extends React.Component&lt;any,any&gt;&#123; constructor(props)&#123; super(props) this.state=&#123; number:0 &#125; &#125; handerClick=()=&gt;&#123; for(let i = 0 ;i&lt;5;i++)&#123; setTimeout(()=&gt;&#123; this.setState(&#123; number:this.state.number+1 &#125;) console.log(this.state.number) // 12345 &#125;,1000) &#125; &#125; render()&#123; return &lt;div&gt; &lt;button onClick=&#123; this.handerClick &#125; &gt;num++&lt;/button&gt; &lt;/div&gt; &#125;&#125;// å‡½æ•°ç»„ä»¶function Index()&#123; const [ num ,setNumber ] = React.useState(0) const handerClick=()=&gt;&#123; for(let i=0; i&lt;5;i++ )&#123; setTimeout(() =&gt; &#123; setNumber(num+1) console.log(num) // 00000 &#125;, 1000) &#125; &#125; return &lt;button onClick=&#123; handerClick &#125; &gt;&#123; num &#125;&lt;/button&gt;&#125; ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿä¸¤ç§ä¸ä¸€æ ·çš„ç»“æœï¼Ÿç¬¬ä¸€ä¸ªç±»ç»„ä»¶ä¸­ï¼Œç”±äºæ‰§è¡Œä¸ŠsetStateæ²¡æœ‰åœ¨reactæ­£å¸¸çš„å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ä¸Šæ‰§è¡Œï¼Œè€Œæ˜¯setTimeoutä¸­æ‰§è¡Œçš„ï¼Œæ‰¹é‡æ›´æ–°æ¡ä»¶è¢«ç ´åã€‚æ‰€ä»¥å¯ä»¥ç›´æ¥è·å–åˆ°å˜åŒ–åçš„stateã€‚ è¿™é‡Œçš„æ‰¹å¤„ç†æ¡ä»¶æ˜¯å•¥ï¼Ÿ ã€Reactçš„æ›´æ–°æœºåˆ¶ã€‘ ç”Ÿå‘½å‘¨æœŸå‡½æ•°å’Œåˆæˆäº‹ä»¶ä¸­ï¼š æ— è®ºè°ƒç”¨å¤šå°‘æ¬¡setStateï¼Œéƒ½ä¸ä¼šç«‹å³æ‰§è¡Œæ›´æ–°ã€‚è€Œæ˜¯å°†è¦æ›´æ–°çš„stateå­˜å…¥â€™_pendingStateQueneâ€™,å°†è¦æ›´æ–°çš„ç»„ä»¶å­˜å…¥â€™dirtyComponentâ€™; å½“æ ¹ç»„ä»¶didMountåï¼Œæ‰¹å¤„ç†æœºåˆ¶æ›´æ–°ä¸ºfalseã€‚æ­¤æ—¶å†å–å‡ºâ€™_pendingStateQueneâ€™å’Œâ€™dirtyComponentâ€™ä¸­çš„stateå’Œç»„ä»¶è¿›è¡Œåˆå¹¶æ›´æ–°ï¼› åŸç”Ÿäº‹ä»¶å’Œå¼‚æ­¥ä»£ç ä¸­ï¼š åŸç”Ÿäº‹ä»¶ä¸ä¼šè§¦å‘reactçš„æ‰¹å¤„ç†æœºåˆ¶ï¼Œå› è€Œè°ƒç”¨setStateä¼šç›´æ¥æ›´æ–°ï¼› å¼‚æ­¥ä»£ç ä¸­è°ƒç”¨setStateï¼Œç”±äºjsçš„å¼‚æ­¥å¤„ç†æœºåˆ¶ï¼Œå¼‚æ­¥ä»£ç ä¼šæš‚å­˜ï¼Œç­‰å¾…åŒæ­¥ä»£ç æ‰§è¡Œå®Œæ¯•å†æ‰§è¡Œï¼Œæ­¤æ—¶reactçš„æ‰¹å¤„ç†æœºåˆ¶å·²ç»ç»“æŸï¼Œå› è€Œç›´æ¥æ›´æ–° åœ¨è§£é‡Šreact-hooksåŸç†çš„ä¹‹å‰ï¼Œæˆ‘ä»¬è¦åŠ æ·±ç†è§£ä¸€ä¸‹ï¼Œ å‡½æ•°ç»„ä»¶å’Œç±»ç»„ä»¶åˆ°åº•æœ‰ä»€ä¹ˆåŒºåˆ«å‡½æ•°å¼ç»„ä»¶æ•è·äº†æ¸²æŸ“æ‰€ä½¿ç”¨çš„å€¼*ï¼Œå¹¶ä¸”æˆ‘ä»¬è¿˜èƒ½è¿›ä¸€æ­¥æ„è¯†åˆ°ï¼šå‡½æ•°ç»„ä»¶çœŸæ­£å°†æ•°æ®å’Œæ¸²æŸ“ç´§ç´§çš„ç»‘å®šåˆ°ä¸€èµ·äº†ã€‚Reactæœ‰ä¸€ä¸ªç»å…¸å…¬å¼ï¼šui=f(data),å³åŒæ ·çš„è¾“å…¥å¿…å®šæœ‰åŒæ ·çš„ ç»“æœï¼Œå‡½æ•°å¼ç»„ä»¶æ•è·äº†æ¸²æŸ“æ—¶æ‰€ç”¨çš„å€¼ï¼Œå› æ­¤ç»„ä»¶æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½ä¼šæœ‰è‡ªå·±çš„propså’Œstateã€‚æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½ä¼šæœ‰ è‡ªå·±çš„äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œè€Œè¿™é‡Œæ¯æ¬¡æ¸²æŸ“éƒ½æœ‰ç‹¬ç«‹çš„ state ä¸Šä¸‹æ–‡ ä¸ºä»€ä¹ˆä¼šå‡ºç°hooksï¼Ÿ å¯¹äºclassç»„ä»¶ï¼Œæˆ‘ä»¬åªéœ€è¦å®ä¾‹åŒ–ä¸€æ¬¡ï¼Œå®ä¾‹ä¸­ä¿å­˜äº†ç»„ä»¶çš„stateç­‰çŠ¶æ€ã€‚å¯¹äºæ¯ä¸€æ¬¡æ›´æ–°åªéœ€è¦è°ƒç”¨renderæ–¹æ³•å°±å¯ä»¥ã€‚ä½†æ˜¯åœ¨functionç»„ä»¶ä¸­ï¼Œæ¯ä¸€æ¬¡æ›´æ–°éƒ½æ˜¯ä¸€æ¬¡æ–°çš„å‡½æ•°æ‰§è¡Œ,ä¸ºäº†ä¿å­˜ä¸€äº›çŠ¶æ€,æ‰§è¡Œä¸€äº›å‰¯ä½œç”¨é’©å­,react-hooksåº”è¿è€Œç”Ÿï¼Œå»å¸®åŠ©è®°å½•ç»„ä»¶çš„çŠ¶æ€ï¼Œå¤„ç†ä¸€äº›é¢å¤–çš„å‰¯ä½œç”¨ã€‚ ä¸€åŸç†æ¦‚å¿µHooksé“¾è¡¨æ— è®ºæ˜¯åˆæ¬¡æŒ‚è½½è¿˜æ˜¯æ›´æ–°ï¼Œæ¯è°ƒç”¨ä¸€æ¬¡hookså‡½æ•°ï¼Œéƒ½ä¼šäº§ç”Ÿä¸€ä¸ªhookå¯¹è±¡ä¸ä¹‹å¯¹åº”ã€‚ä»¥ä¸‹æ˜¯hookå¯¹è±¡çš„ç»“æ„ã€‚ äº§ç”Ÿçš„hookå¯¹è±¡ä¾æ¬¡æ’åˆ—ï¼Œå½¢æˆé“¾è¡¨å­˜å‚¨åˆ°fiber.memoizedStateä¸Šã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæœ‰ä¸ªååˆ†é‡è¦çš„æŒ‡é’ˆï¼šworkInProgressHookï¼Œå®ƒé€šè¿‡è®°å½•å½“å‰ç”Ÿæˆï¼ˆæ›´æ–°ï¼‰çš„hookå¯¹è±¡ï¼Œå¯ä»¥é—´æ¥åæ˜ åœ¨ç»„ä»¶ä¸­å½“å‰è°ƒç”¨åˆ°å“ªä¸ªhookå‡½æ•°äº†ã€‚æ¯è°ƒç”¨ä¸€æ¬¡hookå‡½æ•°ï¼Œå°±å°†è¿™ä¸ªæŒ‡é’ˆçš„æŒ‡å‘ç§»åˆ°è¯¥hookå‡½æ•°äº§ç”Ÿçš„hookå¯¹è±¡ä¸Šã€‚ä¾‹å¦‚ï¼š é‚£ä¹ˆæ„å»ºhooké“¾è¡¨çš„è¿‡ç¨‹ï¼Œå¯ä»¥æ¦‚æ‹¬ä¸ºä¸‹é¢è¿™æ ·è°ƒç”¨useState(â€˜Aâ€™)ï¼š è°ƒç”¨useEffectï¼š memorizedStatememorizedState å°±æ˜¯ä¿å­˜ hooks æ•°æ®çš„åœ°æ–¹ã€‚å®ƒæ˜¯ä¸€ä¸ªé€šè¿‡ next ä¸²è”çš„é“¾è¡¨ã€‚ä¸æˆ‘ä»¬è°ƒç”¨çš„hooksæ˜¯æŒ‰ç…§è°ƒç”¨hooksçš„é¡ºåºå¯¹åº”èµ·æ¥çš„ã€‚ è¿™å°±æ˜¯ hooks å­˜å–æ•°æ®çš„åœ°æ–¹ï¼Œæ‰§è¡Œçš„æ—¶å€™å„è‡ªåœ¨è‡ªå·±çš„é‚£ä¸ª memorizedState ä¸Šå­˜å–æ•°æ®ï¼Œå®Œæˆå„ç§é€»è¾‘ã€‚ è¿™ä¸ª memorizedState é“¾è¡¨æ˜¯ä»€ä¹ˆæ—¶å€™åˆ›å»ºçš„å‘¢?å¥½é—®é¢˜ï¼Œç¡®å®æœ‰ä¸ªé“¾è¡¨åˆ›å»ºçš„è¿‡ç¨‹ï¼Œä¹Ÿå°±æ˜¯ mountXxxã€‚é“¾è¡¨åªéœ€è¦åˆ›å»ºä¸€æ¬¡ï¼ˆæ­¤æ—¶ä¼šè°ƒç”¨ountWorkInProgressHookï¼‰ï¼Œåé¢åªéœ€è¦ updateï¼ˆæ­¤æ—¶ä¼šè°ƒç”¨updateWorkInProgressHookï¼‰ã€‚æ¯”å¦‚ç¬¬ä¸€æ¬¡è°ƒç”¨ useState ä¼šæ‰§è¡Œ mountStateï¼Œåé¢å†è°ƒç”¨ useState ä¼šæ‰§è¡Œ updateStateã€‚ åˆ›å»º memorizedState é“¾è¡¨çš„è¿‡ç¨‹mountXxx æ˜¯åˆ›å»º memorizedState é“¾è¡¨çš„è¿‡ç¨‹ï¼Œæ¯ä¸ª hooks api éƒ½æ˜¯è¿™æ ·çš„ï¼š å…¶ä¸­mountXXXçš„è¿‡ç¨‹å°±æ˜¯åˆ›å»ºå¯¹åº”çš„ memorizedState å¯¹è±¡ï¼Œç„¶åç”¨ next ä¸²è”èµ·æ¥ã€‚ useRefæ¯ä¸ª useXxx çš„ hooks éƒ½æœ‰ mountXxx å’Œ updateXxx ä¸¤ä¸ªé˜¶æ®µï¼Œæ¯”å¦‚ ref å°±æ˜¯ mountRef å’Œ updateRefã€‚ 12345useRef&lt;T&gt;(initialValue: T): &#123;|current: T|&#125; &#123; currentHookNameInDev = 'useRef'; mountHookTypesDev(); return mountRef(initialValue); &#125; å…¶ä¸­ï¼šmountWorkInProgressHook ï¼šåˆ›å»ºå¹¶è¿”å› memorizedState é“¾è¡¨updateWorkInProgressHookï¼šæ›´æ–°ã€‚ Object.freeze vs Object.sealObject.seal:åªè¦æ˜¯å¯å†™çš„ï¼Œå°±å¯ä»¥æ›´æ”¹å®ƒä»¬çš„å€¼ã€‚ useRefçš„åŸç†åœ¨memorizedStateä¸ŠæŒ‚è½½äº†æœ‰ current å±æ€§çš„å¯¹è±¡ï¼Œå†»ç»“äº†ä¸€ä¸‹ï¼Œåé¢ update çš„æ—¶å€™ï¼Œæ²¡æœ‰åšä»»ä½•å¤„ç†ï¼Œç›´æ¥è¿”å›è¿™ä¸ªå¯¹è±¡ã€‚æ‰€ä»¥ï¼šuseRef å¯ä»¥ä¿å­˜ä¸€ä¸ªæ•°æ®çš„å¼•ç”¨ï¼Œè¿™ä¸ªå¼•ç”¨ä¸å¯å˜ã€‚ useRefè·Ÿç›´æ¥åœ¨ç»„ä»¶æ–‡ä»¶é¡¶å±‚å®šä¹‰ä¸€ä¸ªå¯¹è±¡çš„åŒºåˆ«å‰è€…åœ¨ç»„ä»¶å¸è½½çš„æ—¶å€™ä¼šé‡Šæ”¾ï¼Œåè€…ä¸ä¼šï¼Œå½“ä»ç»„ä»¶Aåˆ‡æ¢åˆ°ç»„ä»¶Bçš„æ—¶å€™å‡å¦‚import ç»„ä»¶Aè¿™ä¸€å¥è¿˜åœ¨ï¼Œé‚£ä¹ˆåè€…å ç”¨çš„å†…å­˜ä¾æ—§å­˜åœ¨ï¼ŒåŸå› æ˜¯ï¼šES6 module æ¯ä¸ªæ¨¡å—çš„ä½œç”¨åŸŸéƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œä¸å±äºå…¨å±€ä½œç”¨åŸŸåˆ‡æ¢åˆ°ç»„ä»¶Bä¹‹åï¼Œç»„ä»¶Açš„å¼•ç”¨è¿˜åœ¨ï¼Œå®ƒæ‰€å½¢æˆçš„å±€éƒ¨ä½œç”¨åŸŸå¹¶æœªè¢«é”€æ¯ã€‚ é‚£å¦‚æœåœ¨å‡½æ•°ç»„ä»¶å†…éƒ¨å®šä¹‰ä¸€ä¸ªå˜é‡å‘¢ï¼Ÿè¿™æ ·çš„æ¯æ¬¡functioné‡æ–°æ‰§è¡Œçš„æ—¶å€™å®ƒéƒ½ä¼šé‡æ–°åˆ›å»ºä¸€æ¬¡ï¼Œå®ƒçš„å¼•ç”¨ä¸€ç›´éƒ½ä¼šå˜åŒ–ï¼Œç›¸æ¯”ä¹‹ä¸‹ useRefæ˜¯ä¸ä¼šçš„ã€‚ useCallback useCallbackçš„åŸç†useCallback åœ¨ memorizedState ä¸Šæ”¾äº†ä¸€ä¸ªæ•°ç»„ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯ä¼ å…¥çš„å›è°ƒå‡½æ•°ï¼Œç¬¬äºŒä¸ªæ˜¯ä¼ å…¥çš„ä¾èµ–ã€‚æ›´æ–°çš„æ—¶å€™æŠŠä¹‹å‰çš„é‚£ä¸ª memorizedState å–å‡ºæ¥ï¼Œå’Œæ–°ä¼ å…¥çš„ deps åšä¸‹å¯¹æ¯”ï¼Œå¦‚æœæ²¡å˜ï¼Œé‚£å°±è¿”å›ä¹‹å‰çš„å›è°ƒå‡½æ•°ï¼Œä¹Ÿå°±æ˜¯ prevState[0]ã€‚ å¦‚æœå˜äº†ï¼Œé‚£å°±åˆ›å»ºä¸€ä¸ªæ–°çš„æ•°ç»„ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯ä¼ å…¥çš„å›è°ƒå‡½æ•°ï¼Œç¬¬äºŒä¸ªæ˜¯ä¼ å…¥çš„ depsã€‚ æ‰€ä»¥ï¼ŒuseCallback çš„åŠŸèƒ½ä¹Ÿå°±å‘¼ä¹‹æ¬²å‡ºäº†ï¼šuseCallback å¯ä»¥å®ç°å‡½æ•°çš„ç¼“å­˜ï¼Œå¦‚æœ deps æ²¡å˜å°±ä¸ä¼šåˆ›å»ºæ–°çš„ï¼Œå¦åˆ™æ‰ä¼šè¿”å›æ–°ä¼ å…¥çš„å‡½æ•° useMemoè·ŸuseCallbackç±»ä¼¼ï¼Œåªæ˜¯å‡½æ•°å˜æˆå€¼ã€‚useMemo ä¹Ÿåœ¨ memorizedState ä¸Šæ”¾äº†ä¸ªæ•°ç»„ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯ä¼ å…¥å‡½æ•°çš„æ‰§è¡Œç»“æœï¼Œç¬¬äºŒä¸ªå…ƒç´ æ˜¯ä¾èµ–ã€‚æ›´æ–°çš„æ—¶å€™ä¹Ÿæ˜¯å–å‡ºä¹‹å‰çš„ memorizedStateï¼Œå’Œæ–°ä¼ å…¥çš„ deps åšä¸‹å¯¹æ¯”ï¼Œå¦‚æœæ²¡å˜ï¼Œå°±è¿”å›ä¹‹å‰çš„å€¼ï¼Œä¹Ÿå°±æ˜¯ prevState[0]ã€‚ å¦‚æœå˜äº†ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„æ•°ç»„æ”¾åœ¨ memorizedStateï¼Œç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯æ–°ä¼ å…¥å‡½æ•°çš„æ‰§è¡Œç»“æœï¼Œç¬¬äºŒä¸ªå…ƒç´ æ˜¯ä¾èµ–ã€‚ è‡ªå®šä¹‰hookså…¶å®å°±æ˜¯ä¸ªå‡½æ•°è°ƒç”¨ï¼Œæ²¡å•¥ç¥å¥‡çš„ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä¸Šé¢çš„ hooks æ”¾åˆ° xxx å‡½æ•°é‡Œï¼Œç„¶ååœ¨ function ç»„ä»¶é‡Œè°ƒç”¨ï¼Œå¯¹åº”çš„ hook é“¾è¡¨æ˜¯ä¸€æ ·çš„ã€‚ å› æ­¤è‡ªå®šä¹‰hooksåœ¨ä¸åŒçš„ç»„ä»¶ä¹‹é—´è°ƒç”¨ä¸å¯èƒ½å…±äº«stateè¿™äº›ã€‚ useStateè·ŸuseEffectçš„åŸç†æœ¬è´¨ä¸Šå°±æ˜¯é—­åŒ…åŠ ä¸Šæ•°ç»„ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879const MyReact = (function() &#123; let hooks = [], currentHook = 0 // hooksæ•°ç»„, å’Œä¸€ä¸ªiterator! return &#123; // æ³¨æ„è¿™é‡Œçš„renderç›¸å½“äºReactDOMçš„renderè€Œä¸æ˜¯rerender!æ‰€ä»¥è¦å¤ä½ render(Component) &#123; // rerenderæ˜¯ä¸ä¼šé‡æ–°æ‰§è¡Œç»„ä»¶çš„ const Comp = Component() // è¿è¡Œ effects Comp.render() currentHook = 0 // å¤ä½ï¼Œä¸ºä¸‹ä¸€æ¬¡renderåšå‡†å¤‡ return Comp &#125;, // æ³¨æ„è¿™é‡Œåªæ˜¯callbackä¸ä¼šæ¯æ¬¡rerenderçš„æ—¶å€™è¿è¡Œï¼ŒuseEffectè¿˜æ˜¯ä¼šçš„ï¼Œ // æ‰€ä»¥æ¯æ¬¡çš„depArrayéƒ½æ˜¯å½“å‰ä¾èµ–æœ€æ–°çš„å€¼ useEffect(callback, depArray) &#123; const hasNoDeps = !depArray // é—­åŒ…å˜é‡æ¥å•¦ï¼Œå®ƒè®°å½•çš„æ˜¯åˆå§‹åŒ–æˆ–è€…ä¸Šä¸€æ¬¡ä¾èµ–å˜åŒ–æ—¶å€™ä¾èµ–çš„å€¼ const deps = hooks[currentHook] // type: array | undefined // console.log('deps::: ', deps,depArray); const hasChangedDeps = deps ? !depArray.every((el, i) =&gt; el === deps[i]) : true // å¦‚æœæ˜¯åˆå§‹åŒ–æˆ–è€…æ˜¯ä¾èµ–å˜äº† æ‰§è¡Œå›è°ƒå‡½æ•° if (hasNoDeps || hasChangedDeps) &#123; callback() hooks[currentHook] = depArray &#125; currentHook++ // æœ¬hookè¿è¡Œç»“æŸ &#125;, useState(initialValue) &#123; // ä¸Šä¸€æ¬¡è°ƒç”¨useState currentHook++äº†ï¼Œæ‰€ä»¥ç¬¬äºŒè°ƒç”¨çš„æ—¶å€™ï¼Œå¾€hooksé‡Œpushæ–°çš„[0] -&gt; [0,'foo'] // hooks[currentHook] = hooks[currentHook] || initialValue // type: any // currentHook++ä¸èƒ½æ”¾åœ¨è¿™é‡Œåªèƒ½æ”¾åœ¨æœ€åä¸€è¡Œï¼Œå› ä¸ºå¦‚æœæ”¾åœ¨è¿™é‡Œå°±æ˜¯ï¼šhooks[0]=initvalue ä½†æ˜¯è¿”å›çš„å´æ˜¯[hooks[1]] hooks[currentHook]=initialValue const setStateHookIndex = currentHook // ç»™setStateçš„é—­åŒ…å‡†å¤‡çš„å˜é‡!å› ä¸ºè¿™é‡Œçš„useStateåªæ‰§è¡Œä¸€æ¬¡ï¼Œæ‰€ä»¥è¿™é‡Œçš„ // setStateHookIndexæ°¸è¿œç­‰äºè¯¥useStateçš„å€¼åœ¨hooksä¸­å¯¹åº”çš„ä½ç½®ï¼Œå¦åˆ™çš„è¯æ¯æ¬¡renderçš„æ—¶å€™currentHookéƒ½ä¼šå˜åŒ–ï¼Œå¯¼è‡´setStateä¿®æ”¹é”™ä½ç½® const setState = newState =&gt; &#123; console.log('newState::: ', setStateHookIndex,newState,currentHook,hooks); return (hooks[setStateHookIndex] = newState) &#125; // è°ƒç”¨useStateç¬¬ä¸€æ¬¡ï¼š[0] è°ƒç”¨ç¬¬äºŒæ¬¡ [0,'foo] console.log(hooks,currentHook) // æ³¨æ„è¿™é‡Œæ˜¯currentHook++è€Œä¸æ˜¯++currentHook,æ‰€ä»¥ç¬¬ä¸€æ¬¡currentHook++=0 return [hooks[currentHook++], setState] &#125; &#125; &#125;)() function Counter() &#123; const [count, setCount] = MyReact.useState(0) const [text, setText] = MyReact.useState('foo') // ç¬¬äºŒä¸ª state hook! // MyReact.useEffect(() =&gt; &#123; // console.log('effect', count, text) // &#125;, [count, text]) return &#123; click: () =&gt; setCount(count + 1), type: txt =&gt; setText(txt), noop: () =&gt; setCount(count), render:()=&gt;&#123;&#125; // render: () =&gt; console.log('render', &#123; count, text &#125;) &#125; &#125; let App App = MyReact.render(Counter) // effect 0 foo // render &#123;count: 0, text: 'foo'&#125; App.click() App = MyReact.render(Counter) // effect 1 foo // render &#123;count: 1, text: 'foo'&#125; App.type('bar') // App.type('ss') // App = MyReact.render(Counter) // // effect 1 bar // // render &#123;count: 1, text: 'bar'&#125; // App.noop() // App = MyReact.render(Counter) // // // no effect run // // render &#123;count: 1, text: 'bar'&#125; // App.click() // App = MyReact.render(Counter) æ€»ç»“ï¼š ä»¥ä¸‹çš„ç§æœ‰é—­åŒ…å˜é‡å°±æ˜¯è¯´å†…å±‚å‡½æ•°å˜é‡ å®ƒç›¸å½“äºè¿™ä¸ªå†…å±‚å‡½æ•°çš„ç§æœ‰å˜é‡ï¼Œå¤šæ¬¡å†…å±‚å‡½æ•°è°ƒç”¨ï¼Œæ¯æ¬¡çš„ç§æœ‰å˜é‡ç›¸äº’ç‹¬ç«‹ã€‚ é—­åŒ…å¥—é—­åŒ…ï¼Œç¬¬ä¸€ä¸ªé—­åŒ…è®°ä½hooksä»¬è¦ç”¨åˆ°çš„çŠ¶æ€ï¼Œå­˜æ”¾åœ¨hooksæ•°ç»„ä¸­ï¼Œä»¥é¿å…æ¯æ¬¡rerenderä¹‹åä¸¢å¤±ï¼Œè¿™é‡Œçš„hooksæ•°ç»„æŒ‰ç…§è°ƒç”¨useEffect useStateç­‰é’©å­çš„é¡ºåºå­˜æ”¾stateæˆ–è€…æ˜¯useEffectçš„ä¾èµ–é¡¹çš„å€¼ useStateä¸­åˆ©ç”¨ç§æœ‰é—­åŒ…å˜é‡è®°ä½è‡ªå·±åœ¨hooksæ•°ç»„ä¸­çš„ä½ç½®ï¼Œç„¶åæ¯æ¬¡æ›´æ–°çš„æ—¶å€™ç”¨è¿™ä¸ªé—­åŒ…å˜é‡ä½œä¸ºç´¢å¼•å»æ‰¾åˆ°è‡ªå·±åœ¨æ•°ç»„ä¸­çš„ä½ç½®ç„¶åæ›´æ–° useeffectä¸­åˆ©ç”¨ç§æœ‰é—­åŒ…å˜é‡è®°ä½è‡ªå·±çš„ä¾èµ–é¡¹çš„å€¼ï¼Œæ¯æ¬¡æ›´æ–°çš„æ—¶å€™è°ƒç”¨ä¸€æ¬¡useEffectï¼Œæ³¨æ„æ˜¯è°ƒç”¨useEffectè€Œä¸æ˜¯å®ƒçš„å›è°ƒå‡½æ•°ï¼Œç„¶åæ¯”è¾ƒä¸€ä¸‹æœ€æ–°çš„ä¾èµ–çš„å€¼è·Ÿä¹‹å‰çš„ä¾èµ–é¡¹çš„å€¼ï¼Œå¦‚æœä¸ä¸€æ ·å°±æ›´æ–°é—­åŒ…å˜é‡è®°å½•çš„å½“å‰ä¾èµ–é¡¹çš„å€¼ä»¥ä¾›ä¸‹æ¬¡ä½¿ç”¨ï¼Œå¹¶ä¸”æ‰§è¡Œå›è°ƒå‡½æ•°ã€‚ æ€»ç»“React æ”¯æŒ class å’Œ function ä¸¤ç§å½¢å¼çš„ç»„ä»¶ï¼Œclass æ”¯æŒ state å±æ€§å’Œç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼Œè€Œ function ç»„ä»¶ä¹Ÿé€šè¿‡ hooks api å®ç°äº†ç±»ä¼¼çš„åŠŸèƒ½ã€‚fiber æ¶æ„æ˜¯ React åœ¨ 16 ä»¥åå¼•å…¥çš„ï¼Œä¹‹å‰æ˜¯ jsx -&gt; render function -&gt; vdom ç„¶åç›´æ¥é€’å½’æ¸²æŸ“ vdomï¼Œç°åœ¨åˆ™æ˜¯å¤šäº†ä¸€æ­¥ vdom è½¬ fiber çš„ reconcileï¼Œåœ¨ reconcile çš„è¿‡ç¨‹ä¸­åˆ›å»º dom å’Œåš diff å¹¶æ‰“ä¸Šå¢åˆ æ”¹çš„ effectTagï¼Œç„¶åä¸€æ¬¡æ€§ commitã€‚è¿™ä¸ª reconcile æ˜¯å¯è¢«æ‰“æ–­çš„ï¼Œå¯ä»¥è°ƒåº¦ï¼Œä¹Ÿå°±æ˜¯ fiber çš„ scheduleã€‚hooks çš„å®ç°å°±æ˜¯åŸºäº fiber çš„ï¼Œä¼šåœ¨ fiber èŠ‚ç‚¹ä¸Šæ”¾ä¸€ä¸ªé“¾è¡¨ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„ memorizedState å±æ€§ä¸Šå­˜æ”¾äº†å¯¹åº”çš„æ•°æ®ï¼Œç„¶åä¸åŒçš„ hooks api ä½¿ç”¨å¯¹åº”çš„æ•°æ®æ¥å®Œæˆä¸åŒçš„åŠŸèƒ½ã€‚å…¶ä¸­è¿™é‡ŒmemorizedStateé“¾è¡¨çš„ç»´æŠ¤æ ¹æ®æ˜¯å¦æ˜¯åˆæ¬¡æ¸²æŸ“åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼šåˆæ¬¡æ¸²æŸ“ä¸ºmountedé˜¶æ®µï¼Œåç»­ä¸ºupdateé˜¶æ®µmounted é˜¶æ®µï¼šæˆ‘ä»¬æ¥æ€»ç»“ä¸€ä¸‹åˆå§‹åŒ–é˜¶æ®µ,react-hooksåšçš„äº‹æƒ…ï¼Œåœ¨ä¸€ä¸ªå‡½æ•°ç»„ä»¶ç¬¬ä¸€æ¬¡æ¸²æŸ“æ‰§è¡Œä¸Šä¸‹æ–‡è¿‡ç¨‹ä¸­ï¼Œæ¯ä¸ªreact-hooksæ‰§è¡Œï¼Œéƒ½ä¼šäº§ç”Ÿä¸€ä¸ªhookå¯¹è±¡ï¼Œå¹¶å½¢æˆé“¾è¡¨ç»“æ„ï¼Œç»‘å®šåœ¨workInProgressçš„memoizedStateå±æ€§ä¸Šï¼Œç„¶åreact-hooksä¸Šçš„çŠ¶æ€ï¼Œç»‘å®šåœ¨å½“å‰hookså¯¹è±¡çš„memoizedStateå±æ€§ä¸Šã€‚å¯¹äºeffectå‰¯ä½œç”¨é’©å­ï¼Œä¼šç»‘å®šåœ¨workInProgress.updateQueueä¸Šï¼Œç­‰åˆ°commité˜¶æ®µï¼Œdomæ ‘æ„å»ºå®Œæˆï¼Œå†æ‰§è¡Œæ¯ä¸ª effect å‰¯ä½œç”¨é’©å­ã€‚updateé˜¶æ®µï¼šåœ¨ç»„ä»¶æ›´æ–°æ—¶ï¼Œä¼šåœ¨å»ºå¥½çš„hooksé“¾è¡¨ä¸Šç”¨updateWorkInProgressHookå–å‡ºä¹‹å‰ä¿å­˜çš„hookså¯¹è±¡åšå¯¹åº”çš„æ“ä½œï¼ŒåŒæ—¶æ–°çš„hookå¯¹è±¡ä¹Ÿèƒ½åŸºäºå®ƒåˆ›å»ºï¼Œæœ€åæ›´æ–°å®Œæˆã€‚ å¸¸è§é—®é¢˜ä¸ºä»€ä¹ˆä¸èƒ½å°†hooksæ”¾åœ¨æ¡ä»¶è¯­å¥åœ¨ç»„ä»¶ç¬¬ä¸€æ¬¡æ¸²æŸ“çš„æ—¶å€™ï¼Œä¸ºæ¯ä¸ªhookséƒ½åˆ›å»ºäº†ä¸€ä¸ªå¯¹è±¡ 1234567type Hook = &#123; memoizedState: any, baseState: any, baseUpdate: Update&lt;any, any&gt; | null, queue: UpdateQueue&lt;any, any&gt; | null, next: Hook | null,&#125;; æœ€ç»ˆå½¢æˆäº†ä¸€ä¸ªé“¾è¡¨ memoizedStateå±æ€§å°±æ˜¯ç”¨æ¥å­˜å‚¨ç»„ä»¶ä¸Šä¸€æ¬¡æ›´æ–°åçš„ state,nextæŒ‡å‘ä¸‹ä¸€ä¸ªhookå¯¹è±¡ã€‚åœ¨ç»„ä»¶æ›´æ–°çš„è¿‡ç¨‹ä¸­ï¼Œhookså‡½æ•°æ‰§è¡Œçš„é¡ºåºæ˜¯ä¸å˜çš„,å¦‚æœæ”¾åˆ°æ¡ä»¶è¯­å¥ä¸­å¯èƒ½ä¼šå¯¼è‡´é¡ºåºé”™ä¹±ï¼Œå¯¼è‡´å½“å‰hooksæ‹¿åˆ°çš„ä¸æ˜¯è‡ªå·±å¯¹åº”çš„Hookå¯¹è±¡ã€‚ ä¸ºä»€ä¹ˆuseState useEffectè¿™é‡Œè¦ä½¿ç”¨é—­åŒ…é¦–å…ˆå›é¡¾ä¸€ä¸‹é—­åŒ…çš„ç‰¹æ€§ 1.å‡½æ•°å†…å†åµŒå¥—å‡½æ•°2.å†…éƒ¨å‡½æ•°å¯ä»¥å¼•ç”¨å¤–å±‚çš„å‚æ•°å’Œå˜é‡3.å‚æ•°å’Œå˜é‡ä¸ä¼šè¢«åƒåœ¾å›æ”¶æœºåˆ¶å›æ”¶ å¦‚æœè¿™é‡Œè¿™æ ·å†™useState: 12345678useState(initialValue) &#123; var _val = initialValue // ä¸ä½¿ç”¨state()å‡½æ•° function setState(newVal) &#123; _val = newVal &#125; return [_val, setState] // ç›´æ¥å¯¹å¤–æš´éœ²_val &#125; é‚£ä¹ˆæ¯æ¬¡rerenderçš„æ—¶å€™éƒ½ä¼šèµ°ä¸€éï¼š 1var _val = initialValue è¿™æ ·çš„è¯æ¯æ¬¡rerenderä¹‹åï¼Œstateçš„å€¼éƒ½å˜æˆåˆå§‹å€¼äº†ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¦ç”¨åˆ°é—­åŒ…å˜é‡hooksçš„åŸç† é—­åŒ…é™·é˜±å›é¡¾é—­åŒ…é—­åŒ…æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å¯¹è±¡å®ƒç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼Œæ‰§è¡Œä¸Šä¸‹æ–‡Aä»¥åŠåœ¨Aä¸­åˆ›å»ºçš„å‡½æ•°Bã€‚å½“Bæ‰§è¡Œæ—¶ï¼Œå¦‚æœè®¿é—®äº†Aä¸­çš„å˜é‡å¯¹è±¡ï¼Œé‚£ä¹ˆé—­åŒ…å°±ä¼šäº§ç”Ÿã€‚å› æ­¤é—­åŒ…å…¶å®ä¸å±€é™äºæˆ‘ä»¬å¸¸è§çš„è¿™ç§å½¢å¼ï¼šä¼šè½¬æ¢æˆï¼šä¹Ÿå°±æ˜¯è¿™æ ·ä¹Ÿä¼šäº§ç”Ÿé—­åŒ… æˆ‘ä»¬å°†ä¸Šé¢é—­åŒ…å®šä¹‰çš„Aï¼ŒBç”¨æœ¬ä¾‹ä¸­çš„åç§°æ›¿æ¢ä¸€ä¸‹ï¼šè‡ªæ‰§è¡Œå‡½æ•°AppModuleä»¥åŠåœ¨AppModuleä¸­åˆ›å»ºçš„å‡½æ•°Appã€‚å½“Appåœ¨render ä¸­æ‰§è¡Œæ—¶ï¼Œè®¿é—®äº†AppModuleä¸­çš„å˜é‡å¯¹è±¡(å®šä¹‰äº†å˜é‡Counter)ï¼Œé‚£ä¹ˆé—­åŒ…å°±ä¼šäº§ç”Ÿã€‚æ ¹æ®é—­åŒ…çš„ç”Ÿæˆæ¡ä»¶ä¸å®è·µåœºæ™¯ï¼Œæˆ‘ä»¬ä¼šå‘ ç°ï¼Œæ¨¡å—ä¸­ï¼Œéå¸¸å®¹æ˜“ç”Ÿæˆé—­åŒ…,ES6 module æ¯ä¸ªæ¨¡å—çš„ä½œç”¨åŸŸéƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œä¸å±äºå…¨å±€ä½œç”¨åŸŸ .æ¯ä¸€ä¸ªJSæ¨¡å—éƒ½å¯ä»¥è®¤ä¸ºæ˜¯ä¸€ä¸ªç‹¬ ç«‹çš„ä½œç”¨åŸŸï¼Œå½“ä»£ç æ‰§è¡Œæ—¶ï¼Œè¯¥è¯æ³•ä½œç”¨åŸŸåˆ›å»ºæ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œå¦‚æœåœ¨æ¨¡å—å†…éƒ¨ï¼Œåˆ›å»ºäº†å¯ä¾›å¤–éƒ¨å¼•ç”¨è®¿é—® çš„å‡½æ•°æ—¶ï¼Œå°±ä¸ºé—­åŒ…çš„äº§ç”Ÿæä¾›äº†æ¡ä»¶ï¼Œåªè¦è¯¥å‡½æ•°åœ¨å¤–éƒ¨æ‰§è¡Œè®¿é—®äº†è¯¥JSæ¨¡å—å†…éƒ¨çš„å…¶ä»–å˜é‡ï¼Œé—­åŒ…å°±ä¼šäº§ç”Ÿã€‚ é—­åŒ…é™·é˜±ä¸€ 123456789101112131415161718192021import React, &#123; useEffect, useState &#125; from \"react\";import ReactDOM from \"react-dom\";function App() &#123; const [count, setCount] = useState(0); const clickCb = () =&gt; &#123; // è¿™é‡Œæ‹¿åˆ°çš„countå§‹ç»ˆæ˜¯åˆå§‹å€¼ setCount(count + 1); &#125;; useEffect(() =&gt; &#123; document.addEventListener(\"click\", clickCb); return () =&gt; document.removeEventListener(\"click\", clickCb); &#125;, []); return ( &lt;&gt; &lt;button&gt;+1&lt;/button&gt; &lt;span&gt;count:&#123;count&#125;&lt;/span&gt; &lt;/&gt; );&#125;ReactDOM.render(&lt;App /&gt;, document.getElementById(\"root\")); è¿™é‡Œçš„é—­åŒ…é™·é˜±æ‰€è¯´çš„é—­åŒ…å®é™…ä¸Šæ˜¯äº‹ä»¶ç›‘å¬å™¨çš„å›è°ƒå‡½æ•°æ‰€å½¢æˆçš„é—­åŒ…ï¼Œè€Œé—­åŒ…æœ€å¤§çš„ç‰¹ç‚¹ï¼Œå°±æ˜¯å®ƒå¯ä»¥â€œè®°ä½â€è¯ç”Ÿçš„ç¯å¢ƒï¼Œå› ä¸ºuseEffectçš„å›è°ƒåªæ‰§è¡Œäº†ä¸€æ¬¡ï¼Œè¿™ä¸ªå›è°ƒå‡½æ•°ä½œç”¨åŸŸä¸­çš„é—­åŒ…æ°¸è¿œå¼•ç”¨ç€Appå‡½æ•°ç¬¬ä¸€æ¬¡æ‰§è¡Œæ—¶åˆ›å»ºçš„ä½œç”¨åŸŸã€‚ æ€ä¹ˆè§£å†³æ–¹å¼ä¸€ï¼šuseLayoutEffect + useRef 123456789101112131415161718192021222324function App() &#123; const [count, setCount] = useState(0); const countRef = useRef(0); const handleBtnClick = () =&gt; &#123; setCount(count + 1); &#125;; const clickCb = () =&gt; &#123; console.log(\"clickCb countRef.current\", countRef.current); &#125;; useLayoutEffect(() =&gt; &#123; // + countRef.current = count; // + è¿™é‡Œæ˜¯æ¯å½“countæ”¹å˜è‡ªåŠ¨åŒæ­¥æ›´æ–°countRefçš„å€¼ &#125;, [count]); // + useEffect(() =&gt; &#123; document.addEventListener(\"click\", clickCb); return () =&gt; document.removeEventListener(\"click\", clickCb); &#125;, []); return ( &lt;&gt; &lt;button onClick=&#123;handleBtnClick&#125;&gt;+1&lt;/button&gt; &lt;span&gt;count:&#123;count&#125;&lt;/span&gt; &lt;/&gt; );&#125; ä¸ºä»€ä¹ˆä¸æ˜¯useEFfect?useEffectçš„æ‰§è¡Œæ—¶æœº vs useEffectLayoutuseEffect åœ¨æ¯è½®æ¸²æŸ“ä¹‹åæ‰§è¡ŒuseEffectç¡®å®ç›¸å½“äºå¼‚æ­¥æ‰§è¡Œï¼Œå®ƒæ˜¯æ·±åº¦ä¼˜å…ˆï¼Œä¸”ä»æœ€åº•å±‚çš„å­ç»„ä»¶å¼€å§‹æ‰§è¡Œï¼Œå†’æ³¡åˆ°æœ€çˆ¶çº§ç»„ä»¶ï¼Œä½†æ˜¯ä¹Ÿä¸æ˜¯å®Œå…¨çš„å¼‚æ­¥ã€‚æ¯ä¸ªç»„ä»¶å†…çš„useEffectä¹Ÿæ˜¯æŒ‰é¡ºæ‰§è¡Œã€‚useLayoutEffectç±»ä¼¼äºuseEffectï¼Œæ·±åº¦ä¼˜å…ˆï¼Œä½†æ‰§è¡Œä¼˜å…ˆçº§é«˜äºuseEffectï¼Œè€Œä¸”æ²¡æœ‰é˜»å¡dom render ã€‚useLayoutEffectçš„æ˜¯åœ¨æ¸²æŸ“å™¨æ‰§è¡Œå½“å‰æ¸²æŸ“ç•Œé¢ä»»åŠ¡æ—¶ï¼ŒåŒæ­¥æ‰§è¡Œã€‚åœ¨å½“å‰ä¸€è½®çš„Reconcilerä»»åŠ¡è°ƒåº¦è¿‡ç¨‹ä¸­ï¼Œåœ¨æ¸²æŸ“å™¨æ‰§è¡Œå®Œå½“å‰ä»»åŠ¡åï¼Œæ‰ä¼šå¼‚æ­¥è°ƒç”¨useEffectã€‚useLayoutEffectå…ˆäºuseEffectæ‰§è¡Œï¼Œå¹¶ä¸”å­ç»„ä»¶ä¼˜å…ˆæ‰§è¡Œã€‚å¦‚æœæ˜¯useEffectçš„è¯ï¼Œè¿˜æ²¡æ‰§è¡Œå®ƒå°±è§¦å‘äº†clickäº‹ä»¶æ‰“å°äº†å€¼ æ–¹å¼äºŒï¼šç›´æ¥åœ¨å¤–é¢æ›´æ–°useRefçš„å€¼ 123456789101112131415161718192021222324export function useLatest(value) &#123; const ref = useRef(value); ref.current = value; return ref;&#125;function App() &#123; const [count, setCount] = useState(0); const latestCountRef = useLatest(count); const handleBtnClick = () =&gt; setCount(count + 1); const clickCb = () =&gt; &#123; console.log(\"clickCb latestCountRef\", latestCountRef.current); &#125;; useEffect(() =&gt; &#123; document.addEventListener(\"click\", clickCb); return () =&gt; document.removeEventListener(\"click\", clickCb); &#125;, []); return ( &lt;&gt; &lt;button onClick=&#123;handleBtnClick&#125;&gt;+1&lt;/button&gt; &lt;span&gt;count:&#123;count&#125;&lt;/span&gt; &lt;/&gt; );&#125;ReactDOM.render(&lt;App /&gt;, document.getElementById(\"root\")); ä¸ºä»€ä¹ˆæ˜¯useRef?countRefå¯¹è±¡å’Œå‡½æ•°Appå¤šæ¬¡é‡æ–°renderæ—¶æ“ä½œçš„countRefå¯¹è±¡æ˜¯åŒä¸€ä¸ªå†…å­˜åœ°å€(useRefåœ¨hook.memoizedStateä¿å­˜ç€)ï¼Œæ‰€ä»¥æ˜¯å¯ä»¥è·å–åˆ°é¢„æœŸçš„å€¼çš„ã€‚æ–¹å¼ä¸‰ï¼šç›´æ¥ä¿®æ”¹stateä¸ºå¯¹è±¡ï¼Œç„¶åæ›´æ”¹stateçš„æ—¶å€™ï¼š æ–¹å¼å››ï¼šå¢åŠ ä¾èµ–é¡¹ï¼šcountè®©å›è°ƒå‡½æ•°é‡æ–°æ‰§è¡Œ useEffect ** é—­åŒ…é™·é˜±äºŒ **ä»£ç æè¿°ï¼šä¸€ä¸ªå¡ç‰‡ä¸Šæœ‰å¤šä¸ªä¸‹è½½æŒ‰é’®ï¼Œç‚¹å‡»åè¯·æ±‚æ–‡ä»¶åœ°å€ã€‚é—®é¢˜æè¿°ï¼šæµ‹è¯•æ—¶å‘ç°é—®é¢˜ï¼šå¦‚æœè¿ç»­ç‚¹å‡» a å’Œ b æŒ‰é’®ï¼Œå½“ b ä¸‹è½½ç»“æŸæ—¶ï¼Œa æŒ‰é’®ä¼šè¢«é‡ç½®ä¸ºâ€ä¸‹è½½ä¸­â€ã€‚ åŸå› ï¼šæ€»ç»“å…¶å®å°±æ˜¯handle clickä¸­å»¶è¿Ÿ3ç§’ä¹‹åé‚£é‡Œæ‹¿åˆ°çš„å¹¶ä¸æ˜¯æœ€ æ–°çš„stateå€¼ï¼Œæ‰€ä»¥æ¯æ¬¡éƒ½è®¾ç½®äº†é”™è¯¯çš„stateã€‚ä¸¤æ¬¡æŒ‰é’®ç‚¹å‡» äº§ç”Ÿäº† 4 æ¬¡ setStateï¼Œå› æ­¤å¯¼è‡´ 4 æ¬¡ re-renderï¼Œç®—ä¸Šåˆå§‹ åŒ–çš„ renderï¼ŒApp å…±æ‰§è¡Œäº† 5 æ¬¡ã€‚ä¸ºä»€ä¹ˆï¼Ÿå›é¡¾æˆ‘ä»¬ä¹‹å‰æ‰€è¯´çš„é—­åŒ…ç†å¿µï¼Œè¿™é‡Œç”¨åˆ°useStateå®é™…ä¸Šä¹Ÿæ˜¯å½¢æˆäº†ä¸€ä¸ªé—­åŒ…ï¼Œè¿™é‡Œçš„useStateå¯¹åº”æˆ‘ä»¬ä¹‹å‰æ‰€è¯´çš„JSæ¨¡å—ï¼Œè€Œä¸”æˆ‘ä»¬æ°å·§åœ¨å¦ä¸€ä¸ªå‡½æ•°å†…éƒ¨ç”¨åˆ°äº†ä»–æä¾›çš„stateã€‚å®é™…ä¸Šçœ‹ä¼¼æ˜¯bugçš„é—®é¢˜æ˜¯ç¬¦åˆReactçš„è®¾è®¡ç†å¿µçš„, Reactæœ‰ä¸€ä¸ªç»å…¸å…¬å¼ï¼šui=f(data),å³åŒæ ·çš„è¾“å…¥å¿…å®šæœ‰åŒæ ·çš„ç»“æœï¼Œå‡½æ•°å¼ç»„ä»¶æ•è·äº†æ¸²æŸ“æ—¶æ‰€ç”¨çš„å€¼ï¼Œå› æ­¤ç»„ä»¶æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½ä¼šæœ‰è‡ªå·±çš„propså’Œstateã€‚æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½ä¼šæœ‰è‡ªå·±çš„äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œè€Œè¿™é‡Œæ¯æ¬¡æ¸²æŸ“éƒ½æœ‰ç‹¬ç«‹çš„ state ä¸Šä¸‹æ–‡ã€‚ Hooks æ˜¯å¦å› ä¸ºåœ¨æ¸²æŸ“ä¸­åˆ›å»ºå‡½æ•°è€Œå˜æ…¢ï¼Ÿä¸ä¼šã€‚åœ¨ç°ä»£æµè§ˆå™¨ä¸­ï¼Œé™¤äº†åœ¨æç«¯æƒ…å†µä¸‹ï¼Œé—­åŒ…çš„åŸå§‹æ€§èƒ½ä¸ç±»ç›¸æ¯”æ²¡æœ‰æ˜¾ç€å·®å¼‚ã€‚ æ­¤å¤–ï¼Œè€ƒè™‘åˆ° Hooks çš„è®¾è®¡åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢æ›´é«˜æ•ˆï¼š æŒ‚é’©é¿å…äº†ç±»æ‰€éœ€çš„å¤§é‡å¼€é”€ï¼Œä¾‹å¦‚åœ¨æ„é€ å‡½æ•°ä¸­åˆ›å»ºç±»å®ä¾‹å’Œç»‘å®šäº‹ä»¶å¤„ç†ç¨‹åºçš„æˆæœ¬ã€‚ ä½¿ç”¨ Hooks çš„æƒ¯ç”¨ä»£ç ä¸éœ€è¦åœ¨ä½¿ç”¨é«˜é˜¶ç»„ä»¶ã€æ¸²æŸ“é“å…·å’Œä¸Šä¸‹æ–‡çš„ä»£ç åº“ä¸­æ™®éå­˜åœ¨çš„æ·±å±‚ç»„ä»¶æ ‘åµŒå¥—ã€‚ä½¿ç”¨æ›´å°çš„ç»„ä»¶æ ‘ï¼ŒReact è¦åšçš„å·¥ä½œæ›´å°‘ã€‚ å¦‚ä½•æµ‹é‡ DOM èŠ‚ç‚¹ï¼Ÿ12345678910function MeasureExample() &#123; const [height, setHeight] = useState(0); const measuredRef = useCallback(node =&gt; &#123; if (node !== null) &#123; setHeight(node.getBoundingClientRect().height); &#125; &#125;, []); return ( &lt;&gt; &lt;h1 ref=&#123;measuredRef&#125;&gt;Hello, world&lt;/h1&gt; &lt;h2&gt;The above header is &#123;Math.round(height)&#125;px tall&lt;/h2&gt; &lt;/&gt; );&#125; å‚è€ƒ https://zhuanlan.zhihu.com/p/66923924 https://www.51cto.com/article/704138.html https://cooperhu.com/2020/09/03/useEffect-componentDidMount/","categories":[],"tags":[{"name":"react","slug":"react","permalink":"https://ashleyblog.xyz/tags/react/"}]},{"title":"çº¿ä¸Šå¦‚ä½•åƒæœ¬åœ°ä¸€æ ·debug","slug":"çº¿ä¸Šå¦‚ä½•åƒæœ¬åœ°ä¸€æ ·debug","date":"2022-09-23T14:54:58.000Z","updated":"2023-04-16T03:19:33.359Z","comments":true,"path":"2022/09/23/çº¿ä¸Šå¦‚ä½•åƒæœ¬åœ°ä¸€æ ·debug/","link":"","permalink":"https://ashleyblog.xyz/2022/09/23/çº¿ä¸Šå¦‚ä½•åƒæœ¬åœ°ä¸€æ ·debug/","excerpt":"","text":"æˆ‘ä¹‹å‰çŠ¯äº†ä¸€ä¸ªæ„šè ¢çš„é”™è¯¯ï¼šæ¯”å¦‚æˆ‘æƒ³åƒåœ¨æœ¬åœ°debugä¸€æ ·debugçº¿ä¸Šçš„é¡µé¢ï¼Œç›´æ¥å†™ä¸Šä»£ç†å¦‚ä¸‹ï¼š 1https://www.360kuai.com http://dev.360kuai.com:57824 ä½†æ˜¯è¿™æ ·è·Ÿ 1https://www.360kuai.com www.baidu.com æœ‰å•¥åŒºåˆ«ï¼Ÿ åŸæœ¬çš„æ–¹æ¡ˆï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142// devServerwriteToDisk(curPath) &#123;return onlineDebug ? true : ...&#125;// webpack plugin è¿™é‡Œè™½ç„¶æœ‰ç°æˆçš„é…ç½®å¯ç”¨ ä½†æ˜¯ä¸çŸ¥é“ä¸ºä»€ä¹ˆæ— è®ºæ€ä¹ˆé…ç½® æ€»æ˜¯ä¼šåœ¨åŸæ¥çš„åŸºç¡€ä¸Šç”Ÿæˆä¸€ä¸ªæ–°çš„sourcemappingUrl ä¸¤ä¸ªURLå¹¶å­˜æ ¹æœ¬æ²¡ç”¨const ReplacePlugin=require('./replace_sourcemap_url');new ReplacePlugin()// replace_sourcemap_url æŠŠç”Ÿæˆçš„sourceMappingURLæ”¹ä¸ºæœ¬åœ°çš„åœ°å€const RawSource = require('webpack-sources').RawSource;const path = require('path');const fs=require('fs');const pathPrefix = `file://$&#123;path.resolve(__dirname, '../public/static')&#125;`;module.exports = class ReplacePlugin &#123; apply(compiler) &#123; compiler.hooks.emit.tap('ReplacePlugin', (compilation, cb) =&gt; &#123; const reg = /sourceMappingURL=[^/]+.map$/; const files = compilation.getAssets(); for (const file of files) &#123; try &#123; if (/.js$/.test(file.name)) &#123; const _path = `sourceMappingURL=$&#123;pathPrefix&#125;/$&#123;file.name&#125;.map`; if(pathPrefix.includes('jenkins/workspace'))&#123; break; &#125; const content=file.source.source(); compilation.updateAsset( file.name, new RawSource(content.replace(reg, _path)) ); &#125; &#125; catch (err) &#123; console.log(err, 'err'); &#125; &#125; &#125;); &#125;&#125;; åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘æŠŠçº¿ä¸Šæºæ–‡ä»¶çš„sourceMappingURLæ”¹æˆäº†æœ¬åœ°çš„mapæ–‡ä»¶æ‰€åœ¨çš„åœ°å€ï¼Œä»¥ä¸ºè¿™æ ·æ—¢èƒ½åšåˆ°åˆ©ç”¨äº†source mapåŠŸèƒ½åˆä¸ä¼šè®©åˆ«äººçœ‹åˆ°ï¼Œä½†å®é™…ä¸Šæ˜¯ï¼Œè¿™æ ·åšåªèƒ½å¯¹è‡ªå·±æœ‰ç”¨ï¼Œå› ä¸ºè·¯å¾„éƒ½æ˜¯è‡ªå·±ç”µè„‘ä¸Šçš„ï¼Œå¯¹åˆ«çš„åŒäº‹å°±æ²¡ç”¨äº†ã€‚è™½ç„¶ä½†æ˜¯ï¼Œå¯ä»¥æŠŠè·¯å¾„æ”¹æˆä»…ä»…å†…ç½‘å¯è®¿é—®çš„å§ï¼šæ€»ç»“å°±æ˜¯ï¼š sourcemapä¸Šä¼ åˆ°ä»…ä»…å†…ç½‘å¯è®¿é—®çš„cdn ç”Ÿæˆçš„sourcemapurlåŠ ä¸Špublicpathä¸ºè¯¥cdnä½†æ˜¯è¿™æ ·çš„è¯æ€ä¹ˆèƒ½åœ¨æœ¬åœ°è¾¹æ”¹ï¼Œè¾¹åŒæ­¥çº¿ä¸Šå‘¢ï¼Ÿwritetodiskä¹Ÿæ²¡æ„ä¹‰äº†ã€‚ã€‚ã€‚æƒ³è¾¹æ”¹è¾¹çœ‹è¿˜æ˜¯å¾—é whistleã€‚ã€‚ã€‚æˆ–è€…è¯´sourceMapçš„æ˜ å°„ä¿®æ”¹åº”è¯¥æ”¾åœ¨æµè§ˆå™¨å‘èµ·è¯·æ±‚çš„æ—¶å€™è€Œä¸æ˜¯æ‰“åŒ…çš„æ—¶å€™ã€‚","categories":[],"tags":[{"name":"debug","slug":"debug","permalink":"https://ashleyblog.xyz/tags/debug/"}]},{"title":"vueå“åº”å¼åŸç†","slug":"vueå“åº”å¼åŸç†","date":"2022-09-10T12:18:35.000Z","updated":"2023-04-16T03:12:13.415Z","comments":true,"path":"2022/09/10/vueå“åº”å¼åŸç†/","link":"","permalink":"https://ashleyblog.xyz/2022/09/10/vueå“åº”å¼åŸç†/","excerpt":"","text":"æ¦‚å¿µ Dep ç®¡ç†ä¾èµ–çš„ï¼Œæ¯ä¸€ä¸ªä¾èµ–å°±æ˜¯ä¸€ä¸ªè§‚å¯Ÿè€…ï¼Œå½“è§‚å¯Ÿçš„ç›®æ ‡å˜åŒ–çš„æ—¶å€™å°±ä¼šåšå‡ºååº”ï¼Œæ‰®æ¼”è§‚å¯Ÿç›®æ ‡çš„è§’è‰²ï¼Œæ¯ä¸€ä¸ªæ•°æ®éƒ½ä¼šæœ‰Depç±»å®ä¾‹ï¼Œå®ƒéƒ¨æœ‰ä¸ªè®¢é˜…è€…é˜Ÿåˆ—ï¼Œä¿å­˜ç€ä¾èµ–æœ¬æ•°æ®çš„è§‚å¯Ÿè€…ï¼Œå½“æœ¬æ•°æ®å˜æ›´æ—¶ï¼Œè°ƒç”¨dep.notify()é€šçŸ¥è§‚å¯Ÿè€… Depæ˜¯ä¸€ä¸ªç®€å•çš„è®¢é˜…å‘å¸ƒæ¨¡å¼çš„å®ç°ã€‚Depç±»æ˜¯ä¸€ä¸ªå¯è§‚å¯Ÿå¯¹è±¡ï¼Œå¯ä»¥æœ‰å¤šä¸ªæŒ‡ä»¤è®¢é˜…å®ƒã€‚å½“å®ƒçš„notify()æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œæ‰€æœ‰è®¢é˜…è€…éƒ½ä¼šè¢«é€šçŸ¥ã€‚åœ¨Vue.jsä¸­ï¼Œæ¯ä¸ªæ•°æ®å±æ€§éƒ½æœ‰ä¸€ä¸ªDepå®ä¾‹ï¼Œå½“æ•°æ®å±æ€§è¢«ä¿®æ”¹æ—¶ï¼Œä¼šé€šçŸ¥Depå®ä¾‹ï¼Œç„¶åDepå®ä¾‹ä¼šé€šçŸ¥æ‰€æœ‰è®¢é˜…å®ƒçš„æŒ‡ä»¤æ›´æ–°è§†å›¾ã€‚ 123456789101112131415161718192021222324252627// å½“æœ¬æ•°æ®å˜æ›´æ—¶ï¼Œè°ƒç”¨dep.notify()é€šçŸ¥è§‚å¯Ÿè€… - Watcherï¼šæ‰®æ¼”è§‚å¯Ÿè€…çš„è§’è‰²ï¼Œè¿›è¡Œè§‚å¯Ÿè€…å‡½æ•°çš„åŒ…è£…å¤„ç†ã€‚å¦‚render()å‡½æ•°ï¼Œä¼šè¢«è¿›è¡ŒåŒ…è£…æˆä¸€ä¸ªWatcherå®ä¾‹ - Observerï¼šè¾…åŠ©çš„å¯è§‚æµ‹ç±»ï¼Œæ•°ç»„/å¯¹è±¡é€šè¿‡å®ƒçš„è½¬åŒ–ï¼Œå¯æˆä¸ºå¯è§‚æµ‹æ•°æ®let uid = 0; class Dep &#123; static target = null; // å·§å¦™çš„è®¾è®¡ï¼ constructor() &#123; this.id = uid++; // æ¯ä¸€ä¸ªæ•°æ®éƒ½ä¼šæœ‰Depç±»å®ä¾‹ï¼Œå®ƒå†…éƒ¨æœ‰ä¸ªsubsé˜Ÿåˆ—ï¼Œsubså°±æ˜¯subscribersçš„æ„æ€ï¼Œä¿å­˜ç€ä¾èµ–æœ¬æ•°æ®çš„è§‚å¯Ÿè€… this.subs = []; &#125; addSub(sub) &#123; // å…¶ä¸­å­˜æ”¾çš„æ˜¯å¤šä¸ªwatcher this.subs.push(sub); &#125; removeSub(sub) &#123; this.subs.$remove(sub); &#125; depend() &#123; // ç”±äºJavaScriptæ˜¯å•çº¿ç¨‹æ¨¡å‹ï¼Œæ‰€ä»¥è™½ç„¶æœ‰å¤šä¸ªè§‚å¯Ÿè€…å‡½æ•°ï¼Œä½†æ˜¯ä¸€ä¸ªæ—¶åˆ»å†…ï¼Œå°±åªä¼šæœ‰ä¸€ä¸ªè§‚å¯Ÿè€…å‡½æ•°åœ¨æ‰§è¡Œï¼Œé‚£ä¹ˆæ­¤åˆ»æ­£åœ¨æ‰§è¡Œçš„é‚£ä¸ªè§‚å¯Ÿè€…å‡½æ•°ï¼Œæ‰€å¯¹åº”çš„Watcherå®ä¾‹ï¼Œä¾¿ä¼šè¢«èµ‹ç»™Dep.targetè¿™ä¸€ç±»å˜é‡ï¼Œä»è€Œåªè¦è®¿é—®Dep.targetå°±èƒ½çŸ¥é“å½“å‰çš„è§‚å¯Ÿè€…æ˜¯è°ã€‚ åœ¨åç»­çš„ä¾èµ–æ”¶é›†å·¥ä½œé‡Œï¼Œgetteré‡Œä¼šè°ƒç”¨dep.depend()ï¼Œè€Œsetteré‡Œåˆ™ä¼šè°ƒç”¨dep.notify() Dep.target.addDep(this); &#125; notify() &#123; const subs = this.subs.slice(); for (let i = 0, l = subs.length; i &lt; l; i++) &#123; subs[i].update(); &#125; &#125;&#125; Watcheræ‰®æ¼”è§‚å¯Ÿè€…çš„è§’è‰²ï¼Œè¿›è¡Œè§‚å¯Ÿè€…å‡½æ•°çš„åŒ…è£…å¤„ç†ã€‚å¦‚render()å‡½æ•°ï¼Œä¼šè¢«è¿›è¡ŒåŒ…è£…æˆä¸€ä¸ªWatcherå®ä¾‹ - Observerï¼šè¾…åŠ©çš„å¯è§‚æµ‹ç±»ï¼Œæ•°ç»„/è±¡é€šè¿‡å®ƒçš„è½¬åŒ–ï¼Œå¯æˆä¸ºå¯è§‚æŸ¥æ•°æ®ã€‚ä¸€ä¸ªç»„ä»¶é‡Œå¯ä»¥æœ‰å¤šä¸ªWatcherç±»å®ä¾‹,åŒæ—¶æ¯ä¸ªç»„ä»¶å®ä¾‹éƒ½æœ‰ç›¸åº”çš„watcherå®ä¾‹ - æ¸²æŸ“ç»„ä»¶çš„è¿‡ç¨‹ï¼Œä¼šæŠŠå±æ€§è®°å½•ä¸ºä¾èµ– - å½“æˆ‘ä»¬æ“çºµä¸€ä¸ªæ•°æ®æ—¶ï¼Œä¾èµ–é¡¹çš„setterä¼šè¢«è°ƒç”¨ï¼Œä»è€Œé€šçŸ¥watcheré‡æ–°è®¡ç®—ï¼Œä»è€Œè‡´ä½¿ä¸ä¹‹ç›¸å…³è”çš„ç»„ä»¶å¾—ä»¥æ›´æ–° 1234567891011// åœ¨åˆå§‹å‡†å¤‡å·¥ä½œé‡Œï¼Œä¼šå°†å½“å‰Watcherå®ä¾‹èµ‹ç»™Dep.targetfunction Watcher(vm, node, name, type) &#123; Dep.target = this; this.name = name; this.node = node; this.vm = vm; this.type = type; // å½“æŸä¸ªæ•°æ®æ›´æ–°æ—¶ï¼Œç”±äºè¿›è¡Œäº†setteræ‹¦æˆªï¼Œæ‰€ä»¥ä¼šå¯¹è¯¥æ•°æ®çš„dep.subsè¿™ä¸€è§‚å¯Ÿè€…é˜Ÿåˆ—é‡Œçš„watchersè¿›è¡Œé€šçŸ¥ï¼Œä»è€Œæ‰§è¡Œwatcher.update()æ–¹æ³• this.update(); Dep.target = null;&#125; depä¸watcherä¹‹é—´çš„å…³ç³»Depæ˜¯ä¸€ä¸ªä¾èµ–æ”¶é›†å™¨ï¼Œå®ƒç”¨äºæ”¶é›†ä¾èµ–äºæ•°æ®çš„æ‰€æœ‰Watcherå®ä¾‹ã€‚å½“æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒDepä¼šé€šçŸ¥æ‰€æœ‰Watcherå®ä¾‹è¿›è¡Œæ›´æ–°ã€‚è€ŒWatcheråˆ™æ˜¯ä¸€ä¸ªè§‚å¯Ÿè€…ï¼Œå®ƒä¼šè§‚å¯Ÿæ•°æ®çš„å˜åŒ–ï¼Œå¹¶åœ¨æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶æ‰§è¡Œå›è°ƒå‡½æ•°1ã€‚ å…·ä½“æ¥è¯´ï¼Œå½“ä¸€ä¸ªç»„ä»¶è¢«æ¸²æŸ“æ—¶ï¼ŒVue.jsä¼šä¸ºè¿™ä¸ªç»„ä»¶åˆ›å»ºä¸€ä¸ªWatcherå®ä¾‹ã€‚è¿™ä¸ªWatcherå®ä¾‹ä¼šè§‚å¯Ÿç»„ä»¶ä¸­æ‰€æœ‰å“åº”å¼æ•°æ®çš„å˜åŒ–ï¼Œå¹¶å°†è‡ªå·±æ·»åŠ åˆ°è¿™äº›æ•°æ®çš„Depä¸­ã€‚å½“æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒDepä¼šé€šçŸ¥æ‰€æœ‰Watcherå®ä¾‹è¿›è¡Œæ›´æ–°ï¼Œä»è€Œæ›´æ–°ç»„ä»¶ä¸­çš„DOM1ã€‚ Observerï¼šè¾…åŠ©çš„å¯è§‚æµ‹ç±»ï¼Œæ•°ç»„/å¯¹è±¡é€šè¿‡å®ƒçš„è½¬åŒ–ï¼Œå¯æˆä¸ºå¯è§‚æŸ¥æ•°æ®Observerç±»çš„å®ä¾‹è¢«æŒ‚è½½åœ¨obå±æ€§ä¸Šï¼Œæä¾›åç»­è§‚æµ‹æ•°æ®ä½¿ç”¨ï¼Œä»¥åŠé¿å…è¢«é‡å¤å®ä¾‹åŒ– å¯¹è±¡ä»¥åŠæ•°ç»„çš„ç›‘æµ‹ å¦‚æœvalueæ˜¯ä¸ªå¯¹è±¡ï¼Œå°±éå†å¯¹è±¡ï¼ˆwalk()ï¼‰æŠŠæ¯ä¸€é¡¹æ•°æ®éƒ½å˜ä¸ºå¯è§‚æµ‹æ•°æ®ï¼ˆè°ƒç”¨defineReactiveæ–¹æ³•å¤„ç†ï¼‰ - å¦‚æœvalueæ˜¯ä¸ªæ•°ç»„ï¼Œå°±æ‰§è¡ŒobserveArray()è¿‡ç¨‹ï¼Œé€’å½’åœ°å¯¹æ•°ç»„å…ƒç´ è°ƒç”¨observe()ï¼Œä»¥ä¾¿èƒ½å¤Ÿå¯¹å…ƒç´ è¿˜æ˜¯æ•°ç»„çš„æƒ…å†µè¿›è¡Œå¤„ç† 123456789walk(obj) &#123; var keys = Object.keys(obj) for (var i = 0, l = keys.length; i &lt; l; i++) &#123; this.convert(keys[i], obj[keys[i]]) &#125; &#125;convert(key, val) &#123; defineReactive(this.value, key, val) &#125; 123456789101112131415161718192021222324252627282930313233const data = &#123; arr: [1, 2, 3]&#125;function defineReactive(obj, key, val) &#123; const property = Object.getOwnPropertyDescriptor(obj, key); if (property &amp;&amp; property.configurable === false) &#123; return; &#125; const getter = property &amp;&amp; property.get; const setter = property &amp;&amp; property.set; Object.defineProperty(obj, key, &#123; enumerable: true, configurable: true, get() &#123; console.log('å–å€¼è¿‡ç¨‹è¢«æ‹¦æˆªäº†'); const value = getter ? getter.call(obj) : val; return value; &#125;, set(newval) &#123; console.log(`æ–°çš„å€¼æ˜¯$&#123;newval&#125;`) if (setter) &#123; setter.call(obj, newval); &#125; else &#123; val = newval; &#125; &#125; &#125;)&#125;defineReactive(data, 'arr', data.arr);data.arr.reverse(); // å–å€¼è¿‡ç¨‹è¢«æ‹¦æˆªäº†data.arr = [4, 5, 6] // æ–°çš„å€¼æ˜¯4,5,6 definePropertyä¸ºä»€ä¹ˆä¸èƒ½ç›‘æµ‹åˆ°æ•°ç»„ï¼Ÿé™¤äº†å¯¹arré‡æ–°èµ‹å€¼ä¸€ä¸ªæ•°ç»„å¤–ï¼Œå…¶ä»–çš„æ“ä½œéƒ½ä¸ä¼šè¢«setteræ£€æµ‹åˆ°è€Œæ˜¯è¢«getæ‹¦æˆªäº†å› æ­¤å¯¹äºæ•°ç»„ï¼šå¦‚æœvalueæ˜¯ä¸ªæ•°ç»„ï¼Œå°±æ‰§è¡ŒobserveArray()è¿‡ç¨‹ï¼Œé€’å½’åœ°å¯¹æ•°ç»„å…ƒç´ è°ƒç”¨observe()ï¼Œå½“è°ƒç”¨æ•°ç»„çš„push()ã€pop()ã€shift()ã€unshift()ã€splice()ã€sort()å’Œreverse()ç­‰æ–¹æ³•æ—¶ï¼Œè¿™äº›æ–¹æ³•ä¼šè¢«é‡å†™ï¼Œä»è€Œè§¦å‘è§†å›¾æ›´æ–°ã€‚","categories":[],"tags":[{"name":"vue","slug":"vue","permalink":"https://ashleyblog.xyz/tags/vue/"}]},{"title":"å‡çº§Babel7è¸©å‘","slug":"å‡çº§Babel7è¸©å‘","date":"2022-08-23T15:33:43.000Z","updated":"2023-04-16T03:19:44.852Z","comments":true,"path":"2022/08/23/å‡çº§Babel7è¸©å‘/","link":"","permalink":"https://ashleyblog.xyz/2022/08/23/å‡çº§Babel7è¸©å‘/","excerpt":"","text":"æ€»ç»“ npx babel-upgrade --writeè‡ªåŠ¨æ›´æ¢ä¾èµ–ä¸­çš„Babelç‰ˆæœ¬ æ›´æ¢babelrcé…ç½® æ›´æ¢eslinté…ç½® åŸå§‹é…ç½®123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354// .babelrc&#123; \"presets\": [ // ç”¨æ¥åœ¨vueä¸­å†™jsxçš„ [\"@vue/babel-preset-jsx\"], // @babel/transform-vue-jsx æ”¯æŒçš„æ˜¯Babel6+ [ \"@babel/env\", &#123; \"targets\": &#123; \"chrome\": 52, \"browsers\": [\"last 2 versions\", \"safari 7\"] &#125;, \"modules\": false, \"useBuiltIns\": \"usage\" // polyfill ç”±äº@babel/polyfillå·²ç»å¿«è¢«åºŸå¼ƒï¼Œè¯¥é€‰é¡¹ä¾èµ–babel/polyfill,æ‰€ä»¥ä¸å»ºè®®ç”¨æ­¤é€‰é¡¹ &#125; ] ], \"sourceType\": \"unambiguous\", // é¡¹ç›®ä¸­æœ‰äº›åœ°æ–¹importè·Ÿmodule.exportsæ··ç”¨äº†ï¼Œwebpack2ä¸æ”¯æŒ ä½†æ˜¯é…ç½®äº†è¿˜æ˜¯æ— æ•ˆ \"plugins\": [ [ \"@babel/plugin-transform-runtime\", &#123; \"corejs\": false, // corejs æ˜¯ä¸€ä¸ªç»™ä½ç‰ˆæœ¬çš„æµè§ˆå™¨æä¾›æ¥å£çš„åº“ï¼Œå¦‚ Promise, map, set ç­‰ã€‚è®¾ç½®falseä¸ä¼šå¯¹polyfillè¿›è¡Œå¤„ç† å¦‚æœä¸æ˜¯å¼€å‘jsåº“ å¸¸è§„çš„ä¸šåŠ¡è®¾ç½®false \"helpers\": true, // è¾…åŠ©å‡½æ•°æ˜¯å¦æŠ½å–å‡ºæ¥ï¼Œé¿å…é‡å¤ \"regenerator\": true, // åŒbabel-plugin-transform \"useESModules\": true // ä½¿ç”¨ es modules helpers, å‡å°‘ commonJS è¯­æ³•ä»£ç  &#125; ], [\"@babel/plugin-syntax-dynamic-import\"], [\"@babel/plugin-transform-modules-commonjs\"], // è§£å†³importè·Ÿmodule.exportsæ··ç”¨çš„é—®é¢˜ [\"@babel/plugin-proposal-nullish-coalescing-operator\"] å‘çˆ¹ï¼Œè™½ç„¶å®˜æ–¹è¯´babel-preset-envæ”¯æŒäº† ä½†æ˜¯å…¶å®å¹¶ä¸ // As I know so far that babel preset-env won't support stage-x plugin. This // babel/plugin-proposal-nullish-coalescing-operator seems to be at stage-4 // for now which means you have to keep using this as plugin. ], \"comments\": false, \"env\": &#123; \"test\": &#123; \"plugins\": [\"istanbul\"] &#125; &#125;&#125;// eslintrc.js parserOptions: &#123; // eslint7æ‰æ”¯æŒes2020 7.5æ”¯æŒéç©ºè¿ç®—ç¬¦ ecmaVersion: 2020, \"sourceType\": \"module\", ecmaFeatures: &#123; experimentalObjectRestSpread: true //jsx: true &#125;, &#125;, ä¿®æ­£ç‰ˆæœ¬12345678910111213141516171819202122232425262728&#123; \"presets\": [ [ \"@babel/preset-env\", &#123; \"targets\": &#123; \"chrome\": 52, \"browsers\": [\"&gt; 1%\", \"last 2 versions\", \"not ie &lt;= 8\"] &#125;, \"modules\": false, &#125; ] ], \"plugins\": [ [ \"@babel/plugin-transform-runtime\", &#123; \"corejs\": &#123; \"version\": 3, \"proposals\": true // å¼•å…¥æ‰€æœ‰è¯¥ç‰ˆæœ¬çš„ææ¡ˆ æ³¨æ„æ˜¯ææ¡ˆï¼ˆå»ºè®®ï¼‰ä¸æ˜¯æ ‡å‡† &#125;, // å…³é—­å…¶å¯¹polyfillçš„å¤„ç† \"helpers\": true, // è¾…åŠ©å‡½æ•°æ˜¯å¦æå– \"regenerator\": true, // åŒbabel-plugin-transform \"useESModules\": true // ä½¿ç”¨ es modules helpers, å‡å°‘ commonJS è¯­æ³•ä»£ç  &#125; ] ]&#125; è¸©å‘1.å¯é€‰é“¾æ’ä»¶éœ€è¦å‡çº§Babel7æ‰èƒ½ç”¨ã€‚ã€‚2.å‡çº§çš„æ—¶å€™å¦‚æœé¡¹ç›®å­˜åœ¨stage-xxx è‡ªåŠ¨å‡çº§ä¼šå®‰è£…ä¸€å †è¯¥é˜¶æ®µçš„è¯­æ³•æ’ä»¶3.usebuiltInså·²ç»ä¸è¢«æ¨èäº†,å¦‚æœä½¿ç”¨å®ƒéœ€è¦ç»“åˆé…ç½®core-js","categories":[],"tags":[{"name":"babel","slug":"babel","permalink":"https://ashleyblog.xyz/tags/babel/"}]},{"title":"extension","slug":"extension","date":"2022-08-16T03:23:17.000Z","updated":"2023-04-16T03:31:37.114Z","comments":true,"path":"2022/08/16/extension/","link":"","permalink":"https://ashleyblog.xyz/2022/08/16/extension/","excerpt":"","text":"Chrome Extension æ˜¯ Chrome æµè§ˆå™¨çš„æ‰©å±•ï¼Œä¹Ÿå°±æ˜¯å¤§å®¶æ‰€è¯´çš„ã€æ’ä»¶ã€ã€‚ç”±ä¸€å †htmlï¼Œjsï¼Œcssç»„åˆè€Œæˆ åŸºæœ¬æ¦‚å¿µ manifest.json ï¼ˆæ’ä»¶é…ç½®æ–‡ä»¶ï¼‰ content script (æ’å…¥åˆ°ç›®æ ‡é¡µé¢ä¸­æ‰§è¡Œçš„js) background script (åœ¨chromeåå°ä¸­è¿è¡Œçš„ç¨‹åºï¼Œæ–°ç‰ˆæœ¬è¢«service workerå–ä»£) popup (ç‚¹å‡»æ’ä»¶å›¾æ ‡å¼¹å‡ºçš„é¡µé¢)manifest.json1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556&#123; \"name\": \"Chromeæ’ä»¶Demo\", \"version\": \"1.0\", \"description\": \"chromeæ’ä»¶Demoã€‚\", \"icons\": &#123; \"16\": \"images/icon.png\", \"48\": \"images/icon.png\", \"128\": \"images/icon.png\" &#125;, \"manifest_version\": 3, // æ–‡ä»¶ç‰ˆæœ¬ // popupé¡µé¢é…ç½® \"page_action\": &#123; // æµè§ˆå™¨æ’ä»¶æŒ‰é’®çš„å›¾æ ‡ \"default_icon\": \"images/icon.png\", // æµè§ˆå™¨æ’ä»¶æŒ‰é’®hoveræ˜¾ç¤ºçš„æ–‡å­— \"default_title\": \"React CRX\", // popupé¡µé¢çš„è·¯å¾„ï¼ˆæ ¹ç›®å½•ä¸ºæœ€ç»ˆbuildç”Ÿæˆçš„æ’ä»¶åŒ…ç›®å½•ï¼‰ \"default_popup\": \"index.html\" &#125;, // background scripté…ç½® \"background\": &#123; // background scriptè·¯å¾„ï¼ˆæ ¹ç›®å½•ä¸ºæœ€ç»ˆbuildç”Ÿæˆçš„æ’ä»¶åŒ…ç›®å½•ï¼‰ \"service_worker\": \"js/background.js\" &#125;, // content scripté…ç½® \"content_scripts\": [ &#123; // è¯¥è„šæœ¬ä¼šåœ¨å“ªäº›é¡µé¢åœ°å€è¿è¡Œï¼ˆå¯ä»¥ä½¿ç”¨æ­£åˆ™ï¼Œ&lt;all_urls&gt;è¡¨ç¤ºåŒ¹é…æ‰€æœ‰åœ°å€ï¼‰ \"matches\": [ \"&lt;all_urls&gt;\" ], // æ³¨å…¥çš„cssï¼Œæ³¨æ„ä¸è¦æ±¡æŸ“æ ·å¼ \"css\": [ \"static/css/content.css\" ], // æ³¨å…¥çš„js \"js\": [ \"static/js/content.js\" ], // ä»£ç æ³¨å…¥çš„æ—¶é—´ï¼Œå¯é€‰document_startã€document_endã€document_idleï¼ˆé»˜è®¤ï¼‰ \"run_at\": \"document_end\" &#125; ], // æƒé™ç”³è¯·ï¼ˆéœ€è¦backgroundå‘èµ·è·¨åŸŸè¯·æ±‚çš„urlä¹Ÿæ”¾åœ¨è¿™é‡Œï¼‰ \"permissions\": [ \"tabs\", // æ ¹æ®å®šåˆ¶çš„ç½‘é¡µè§„åˆ™ï¼Œé‡‡å–ç›¸åº”çš„æªæ–½ï¼ˆä¾‹å¦‚åªåœ¨baidu.comå¯åŠ¨ç»„ä»¶ï¼‰ \"declarativeContent\", // æ’ä»¶æœ¬åœ°å­˜å‚¨ \"storage\", // é€šçŸ¥ \"notifications\" ], // å¦‚æœå‘ç›®æ ‡é¡µé¢æ’å…¥jsï¼Œéœ€è¦åœ¨è¿™é‡Œå£°æ˜ä¸‹æ‰èƒ½è·å¾—æ‰§è¡Œçš„æƒé™ \"web_accessible_resources\": [\"insert.js\"]&#125; popupå°±æ˜¯ä¸€ä¸ªhtmlé¡µé¢ï¼Œå®ƒå¯ä»¥æœ‰è‡ªå·±çš„cssè·ŸJs,ä½¿ç”¨ä¹‹å‰éœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­å£°æ˜ä¸€ä¸‹ç‰¹æ€§ï¼š å¯è®¿é—®ç»å¤§éƒ¨åˆ† API ç”Ÿå‘½å‘¨æœŸçŸ­12345\"action\": &#123; \"default_icon\": \"icons/ic_16.png\", \"default_title\": \"Extension Popup\", \"default_popup\": \"html/popup.html\" &#125;, popupä¸å¸è½½å½“å¼¹å‡ºpopupçš„æ—¶å€™ä¼šè§¦å‘useEffectæ¨¡æ‹Ÿçš„mount content scriptsæè¿°ï¼šcontent scriptæ˜¯é©»å…¥åˆ°ç›®æ ‡é¡µé¢ä¸­æ‰§è¡Œçš„jsè„šæœ¬ï¼Œå¯ä»¥è·å–ç›®æ ‡é¡µé¢çš„Domå¹¶è¿›è¡Œä¿®æ”¹ã€‚ä½†æ˜¯ï¼Œcontent scriptçš„JavaScriptä¸ç›®æ ‡é¡µé¢æ˜¯äº’ç›¸éš”ç¦»çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œcontent scriptä¸ç›®æ ‡é¡µé¢ä¸ä¼šå‡ºç°äº’ç›¸æ±¡æŸ“çš„é—®é¢˜ï¼ŒåŒæ—¶ï¼Œä¹Ÿä¸èƒ½è°ƒç”¨å¯¹æ–¹çš„æ–¹æ³•ã€‚åŒæ—¶ä¹Ÿä¸èƒ½è·å–åˆ°ç›®æ ‡é¡µé¢çš„å˜é‡ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå¤§éƒ¨åˆ†çš„Chrome API ä»–éƒ½ä¸èƒ½è°ƒç”¨ã€‚åªèƒ½é€šè¿‡ä¸backgroundæˆ–è€…æ˜¯popupé€šä¿¡è°ƒç”¨ã€‚ ç‰¹æ€§ï¼š ç”Ÿå‘½å‘¨æœŸçŸ­ã€‚ æƒé™å’Œbackgroundéå¸¸ç±»ä¼¼ï¼Œè°ƒç”¨çš„apiä¸€æ ·ã€‚æ‰§è¡Œæ—¶æœºï¼šå¯ä»¥æŒ‡å®šå®ƒçš„æ‰§è¡Œæ—¶æœºï¼š123456\"content_scripts\": [ &#123; ... \"run_at\": \"document_start\" &#125; ], æ€»å…±æœ‰ä¸‰ä¸ªå–å€¼ï¼š document_startstyleæ ·å¼åŠ è½½å¥½ï¼Œdomæ¸²æŸ“å®Œæˆå’Œè„šæœ¬æ‰§è¡Œå‰ document_enddomæ¸²æŸ“å®Œæˆåï¼Œå³DOMContentLoadedåé©¬ä¸Šæ‰§è¡Œ document_idleï¼ˆé»˜è®¤ï¼‰åœ¨DOMContentLoaded å’Œ window loadä¹‹é—´ï¼Œå…·ä½“æ˜¯ä»€ä¹ˆæ—¶åˆ»ï¼Œè¦è§†é¡µé¢çš„å¤æ‚ç¨‹åº¦å’ŒåŠ è½½æ—¶é—´ï¼Œå¹¶é’ˆå¯¹é¡µé¢åŠ è½½é€Ÿåº¦è¿›è¡Œäº†ä¼˜åŒ–ã€‚ tips service workeræè¿°ï¼šåœ¨ç‰ˆæœ¬2å«åšbackground js,å¸¸é©»åœ¨æµè§ˆå™¨åå°è¿è¡Œï¼Œæ²¡æœ‰å®é™…é¡µé¢ï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸéšç€æµè§ˆå™¨æ‰“å¼€è€Œå¼€å§‹ï¼Œéšç€æµè§ˆå™¨å…³é—­è€Œç»“æŸã€‚ä¸€èˆ¬æŠŠå…¨å±€çš„ã€éœ€è¦ä¸€ç›´è¿è¡Œçš„ä»£ç ï¼ˆæ¯”å¦‚ç›‘å¬ä¸å®šæ—¶è§¦å‘çš„äº‹ä»¶ï¼‰æ”¾åœ¨è¿™é‡Œã€‚ä»¥ä¸‹æ‘˜è‡ªå®˜ç½‘æ‰©å±•ç¨‹åºæ˜¯åŸºäºäº‹ä»¶çš„ç¨‹åºï¼Œç”¨äºä¿®æ”¹æˆ–å¢å¼º Chrome æµè§ˆä½“éªŒã€‚äº‹ä»¶æ˜¯æµè§ˆå™¨è§¦å‘å™¨ï¼Œä¾‹å¦‚å¯¼èˆªåˆ°æ–°é¡µé¢ã€åˆ é™¤ä¹¦ç­¾æˆ–å…³é—­é€‰é¡¹å¡ã€‚æ‰©å±•ä½¿ç”¨service workerä¸­çš„è„šæœ¬ç›‘è§†è¿™äº›äº‹ä»¶ï¼Œç„¶åæ ¹æ®æŒ‡å®šçš„æŒ‡ä»¤åšå‡ºååº”ã€‚ service workeræ˜¯å•¥service worker æ˜¯ä¸€ä¸ªç‹¬ç«‹ worker çº¿ç¨‹ï¼Œç‹¬ç«‹äºå½“å‰ç½‘é¡µè¿›ç¨‹ï¼Œæœ‰è‡ªå·±ç‹¬ç«‹çš„ worker context ,service worker çš„çº¿ç¨‹èƒ½åŠ›åŸºäº webworker è€Œç”Ÿï¼Œé€šè¿‡ postMessage å’Œ onMessage è¿›è¡Œçº¿ç¨‹ä¹‹é—´çš„é€šä¿¡ï¼›ç¼“å­˜æœºåˆ¶æ˜¯ä¾èµ– cache API å®ç°çš„ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œservice workerä¸ä¼šä¸€ç›´å¤„äºæ¿€æ´»çš„çŠ¶æ€ï¼Œé™¤äº†åˆæ¬¡å®‰è£…ï¼Œä»¥åŠæ¥æ”¶åˆ°ç½‘ç»œè¯·æ±‚çš„æ—¶å€™ï¼Œåœ¨Chrome extensionä¸­ï¼ŒæŒ‰ç…§å®˜æ–¹æè¿°ï¼šæ­£åœ¨ä¾¦å¬çš„äº‹ä»¶è§¦å‘ï¼ŒæŒ‰ç…§æŒ‡å®šçš„æŒ‡ä»¤åšå‡ºååº”ï¼Œç„¶åå¸è½½ã€‚ ç‰¹æ€§ï¼š ç”Ÿå‘½å‘¨æœŸé•¿ï¼šä»æµè§ˆå™¨é¡µé¢æ‰“å¼€æ—¶å€™å¼€å§‹åŠ è½½ï¼Œå…³é—­æ—¶ç»ˆæ­¢ã€‚ æƒé™å¤§ï¼šå¯ä»¥è°ƒç”¨å‡ ä¹å¯ä»¥è°ƒç”¨æ‰€æœ‰çš„Chromeæ‰©å±•APIï¼ˆé™¤äº†devtoolsï¼‰ã€‚ æ— è·¨åŸŸé™åˆ¶ï¼šå¯ä»¥è·¨åŸŸè®¿é—®ä»»ä½•ç½‘ç«™è€Œæ— éœ€è¦æ±‚å¯¹æ–¹è®¾ç½®CORSã€‚ ä¸èƒ½è®¿é—®domï¼šworkerçº¿ç¨‹æ‰€åœ¨çš„å…¨å±€å¯¹è±¡ï¼Œä¸ä¸»çº¿ç¨‹ä¸ä¸€æ ·ï¼Œæ— æ³•è¯»å–ä¸»çº¿ç¨‹æ‰€åœ¨ç½‘é¡µçš„DOMå¯¹è±¡ï¼Œä¹Ÿæ— æ³•ä½¿ç”¨documentï¼Œwindowï¼Œparentè¿™äº›å¯¹è±¡ã€‚ æ–‡ä»¶é™åˆ¶ï¼šworkçº¿ç¨‹æ— æ³•è¯»å–æœ¬åœ°æ–‡ä»¶ï¼Œæ—¢ä¸å¯ä»¥æ‰“å¼€æœ¬å­£çš„æ–‡ä»¶ç³»ç»Ÿï¼Œæ‰€åŠ è½½çš„è„šæœ¬ï¼Œå¿…é¡»æ¥è‡ªç½‘ç»œé€šä¿¡æœºåˆ¶ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798/* eslint-disable no-undef */// ç»Ÿä¸€æ¶ˆæ¯æ ¼å¼class ChromeMessage &#123; constructor(msg, params) &#123; this.msg = msg; this.params = params; &#125;&#125;// è·å–å‡½æ•°çš„å½¢å‚ä¸ªæ•°function getFuncParameters(func) &#123; if (typeof func === 'function') &#123; const match = /[^(]+\\(([^)]*)?\\)/gm.exec(Function.prototype.toString.call(func)); if (match[1]) &#123; const args = match[1].replace(/[^,\\w]*/g, '').split(','); return args.length; &#125; &#125; return 0;&#125;// ç›‘å¬å›è°ƒå‡½æ•°const listeners = &#123;&#125;;// äº‹ä»¶åˆ†å‘function dispatchEvent(request, sendResponse) &#123; const &#123; msg &#125; = request; let callBack; Object.keys(listeners).forEach((key) =&gt; &#123; if (key === msg) &#123; callBack = listeners[key]; &#125; &#125;); if (callBack) &#123; const paramSize = getFuncParameters(callBack); callBack(request, sendResponse); return paramSize === 2; &#125; return false;&#125;chrome.runtime.onMessage.addListener((request, sender, sendResponse) =&gt; &#123; const success = dispatchEvent(request, sendResponse); if (!success) &#123; sendResponse(new ChromeMessage('Default Response')); &#125; return true;&#125;);// content scripts å‘é€å’Œç›‘å¬æ¶ˆæ¯class ContentClient &#123; listen(msg, callBack) &#123; listeners[msg] = callBack; &#125; sendMessage(message) &#123; return new Promise((resolve) =&gt; &#123; chrome.runtime.sendMessage(message, (res) =&gt; &#123; resolve(res); &#125;); &#125;); &#125;&#125;class popupClient extends ContentClient &#123;&#125;// background å‘é€å’Œç›‘å¬æ¶ˆæ¯class BackgroundClient &#123; listen(msg, callBack) &#123; listeners[msg] = callBack; &#125; sendMessage(message) &#123; return new Promise((resolve) =&gt; &#123; chrome.tabs.query(&#123; active: true &#125;, (tabs) =&gt; &#123; chrome.tabs.sendMessage(tabs[0].id, message, (response) =&gt; &#123; resolve(response); &#125;); &#125;); &#125;); &#125;&#125;const contentClient = new ContentClient();const backgroundClient = new BackgroundClient();export &#123; contentClient, backgroundClient, ChromeMessage, popupClient&#125;; å­˜å‚¨æœºåˆ¶localStorageä¼˜ç‚¹ï¼š åŒæ­¥ï¼Œå› æ­¤æ›´å®¹æ˜“ä½¿ç”¨ï¼švar value = localStorage[key] åœ¨ Dev Tools: Resources &gt; Local Storageä¸­æ”¯æŒæŸ¥çœ‹å’Œä¿®æ”¹ã€‚ç¼ºç‚¹ï¼š ä»…å­˜å‚¨å­—ç¬¦ä¸²ï¼Œå› æ­¤æ‚¨éœ€è¦è‡ªå·±åºåˆ—åŒ–æ•°æ®ï¼Œå³JSON.stringify æ— æ³•ä»å†…å®¹è„šæœ¬è®¿é—®ï¼ˆæˆ–è€…æ›´ç¡®åˆ‡åœ°è¯´ï¼Œä¸Šä¸‹æ–‡è„šæœ¬ä¸é¡µé¢è€Œä¸æ˜¯æ‰©å±•å…±äº«å®ƒï¼‰ï¼Œå› æ­¤æ‚¨éœ€è¦ä¾é æ¶ˆæ¯ä¼ é€’å°†å€¼ä¼ é€’ç»™å®ƒä»¬ã€‚ åœ¨å¹¶å‘æ‰§è¡Œçš„æ‰©å±•é¡µé¢ä¹‹é—´åŒæ­¥ AND å…±äº«ï¼Œä»è€Œå¯¼è‡´å¯èƒ½çš„åŒæ­¥é—®é¢˜ã€‚chrome.storage.localä¼˜ç‚¹ï¼š è‡ªåŠ¨åºåˆ—åŒ–ä¸ JSON å…¼å®¹çš„æ•°æ®ï¼Œå¯ä»¥å­˜å‚¨éå­—ç¬¦ä¸²ï¼Œä½†æ˜¯ä¸èƒ½å­˜å‚¨mapå¯¹è±¡ï¼Œéœ€è¦ï¼š 123456789// setconst validValue = isMap ? Object.fromEntries(value) : value; chrome.storage[storageType].set(&#123; [key]: validValue &#125;, () =&gt; &#123; resolve(value); &#125;);// get res = isMap ? new Map(Object.entries(res)) : res; resolve(res); åœ¨å†…å®¹è„šæœ¬ä¸­å®Œå…¨å¯ç”¨ã€‚ æ”¯æŒé€šçŸ¥æ›´æ”¹çš„äº‹ä»¶ï¼šchrome.storage.onChanged ç»â€unlimitedStorageâ€è®¸å¯ï¼Œå¯ä»¥ä¿å­˜ä»»æ„å¤§é‡çš„æ•°æ®ã€‚ æœ‰ä¸€ä¸ªå¾ˆå¥½çš„é»˜è®¤å€¼å†…ç½®æœºåˆ¶ï¼šchrome.storage.local.get({key: defaultValue}, function(value){/â€¦/}); Firefox WebExtensions å’Œ Edge Extensions å®Œå…¨æ”¯æŒã€‚ç¼ºç‚¹ï¼š åœ¨å¼€å‘å·¥å…·ä¸­ä¸å¯è§†åŒ–ï¼›éœ€è¦è°ƒç”¨chrome.storage.local.get(null)ä»¥è·å–æ‰€æœ‰å€¼æˆ–ä½¿ç”¨ç±»ä¼¼Storage Area Explorer çš„ä¸œè¥¿ã€‚chrome.storage.syncä¸ä¸Šé¢ç›¸åŒï¼Œä½†æ˜¯ï¼šä¼˜ç‚¹ï¼š å¦‚æœå¯ç”¨äº†æ‰©å±•åŒæ­¥ï¼Œåˆ™åœ¨å·²ç™»å½•çš„ Chrome å®ä¾‹ä¹‹é—´è‡ªåŠ¨åŒæ­¥ã€‚ç¼ºç‚¹ï¼š æ•°æ®å¤§å°å° å®æˆ˜æŒ‡å—æ€ä¹ˆåšåˆ°çƒ­æ›´æ–°ï¼Ÿæ­£å¸¸çš„æ›´æ–°æµç¨‹ 1.æœ¬åœ°npm run build2.è¿›å…¥æ‰©å±•ç¨‹åºç®¡ç†é¡µé¢ï¼Œé‡æ–°åŠ è½½distæ–‡ä»¶3.æŒ‰ä¸‹åˆ·æ–°æŒ‰é’®åˆ·æ–°4.å›åˆ°è¢«è„šæœ¬æ³¨å…¥çš„é¡µé¢ï¼Œåˆ·æ–°èµ„æº çƒ­æ›´æ–°çš„æ›´æ–°æµç¨‹åœ¨ webpack server å’Œ chrome extension ä¹‹é—´æ­å»ºä¸€ä¸ª è¿æ¥ï¼Œç”± webpack server å‘ chrome extension æ¨é€ç¼–è¯‘å®Œæˆçš„æ¶ˆæ¯ å°†bundleå†™å…¥åˆ°ç£ç›˜ä¸­è€Œä¸æ˜¯å†…å­˜ä¸­ 12345module.exports = &#123; devServer: &#123; writeToDisk: true, &#125;&#125; ç›‘å¬reloadæ¥å£ï¼Œç›‘å¬åˆ°ä¹‹åï¼Œæ³¨å†Œç›‘å¬ç¼–è¯‘å®Œæˆçš„é’©å­ï¼Œåœ¨æ­¤å¤„å‘é€æ¶ˆæ¯åˆ°Chrome extension 12345678910111213141516171819202122232425262728293031323334353637383940414243444546function ReloadServer(app) &#123; app.get('/reload', (req, res, next) =&gt; &#123; // å°† request è½¬æ¢ä¸ºä¸€ä¸ª SSEStream const sseStream = new SSEStream(req); const compiler = ChromeReloadPlugin.innerCompiler; sseStream.pipe(res); let closed = false; const reloadPlugin = () =&gt; &#123; if (!closed) &#123; // sseä¸éœ€è¦åŒå‘é€šè®¯ sseStream.write( &#123; event: 'compiled successfully', data: &#123; action: 'reload extension and refresh current page' &#125; &#125;, 'utf-8', (err) =&gt; &#123; if (err) &#123; console.error(err); &#125; &#125;, ); setTimeout(() =&gt; &#123; sseStream.unpipe(res); &#125;, 100); &#125; &#125;; compiler.hooks.done.tap( 'chrome reload plugin', reloadPlugin ); res.on('close', () =&gt; &#123; closed = true; sseStream.unpipe(res); &#125;); next(); &#125;);&#125; å…¶ä¸­æ¶‰åŠåˆ°ä¸€ç§æŠ€æœ¯ï¼šSSEï¼Œè¿™é‡Œç®€å•ä»‹ç»ä¸€ä¸‹ï¼ŒSSEæ˜¯ä¸€ç§æœåŠ¡å™¨æ¨é€æŠ€æœ¯ï¼Œä½¿å®¢æˆ·ç«¯èƒ½å¤Ÿé€šè¿‡ HTTP è¿æ¥ä»æœåŠ¡å™¨æ¥æ”¶è‡ªåŠ¨æ›´æ–°ã€‚ Chrome extensionç›‘å¬reloadæ¥å£ï¼Œè°ƒç”¨Chromeçš„reloadå®Œæˆæ›´æ–°ï¼ŒåŒæ—¶é€šçŸ¥content scriptæ›´æ–°123456789101112131415161718// background.jsimport &#123; backgroundClient, ChromeMessage, reload &#125; from '../chrome';const eventSource = new EventSource('http://localhost:8080/reload/');eventSource.addEventListener('compiled successfully', () =&gt; &#123; const res = await backgroundClient.sendMessage(new ChromeMessage('refresh page')); if (res) &#123; reload(); &#125;&#125;);// content scriptcontentClient.listen('refresh page', (res, sendResponse) =&gt; &#123; sendResponse('received refresh cmd'); setTimeout(() =&gt; &#123; window.location.reload(); &#125;, 500);&#125;); å¸¸è§é—®é¢˜ content scriptæ ·å¼æ±¡æŸ“é—®é¢˜content scriptèƒ½æ“ä½œç›®æ ‡é¡µé¢çš„domï¼Œæ‰€ä»¥ä¹Ÿèƒ½ç”Ÿæˆdomæ’å…¥åˆ°ç›®æ ‡é¡µé¢ï¼Œå¯ä»¥ä¸ºç”Ÿæˆçš„domæŒ‡å®šæ ·å¼æ–‡ä»¶12345678\"content_scripts\": [ &#123; \"matches\": [\"&lt;all_urls&gt;\"], \"js\": [\"js/contentScripts.js\"], \"css\": [\"css/contentScripts.css\"], \"run_at\": \"document_start\" &#125;] è¿™é‡Œçš„æ ·å¼æ–‡ä»¶å¹¶ä¸ä¼šä¸ç›®æ ‡é¡µé¢çš„æ ·å¼ç›¸äº’éš”ç»ã€‚æ€ä¹ˆè§£å†³ï¼Ÿä½¿ç”¨postcssçš„æ’ä»¶postcss-plugin-namespaceä¸ºå…¨å±€çš„cssç”Ÿæˆä¸€ä¸ªnamespaceåŒ…è£¹åœ¨æœ€å¤–é¢ã€‚ 1234const postCssPlugins = [ require('autoprefixer'), require('postcss-plugin-namespace')(`.$&#123;wrapperClassName&#125;`, &#123; ignore: ['#chrome-extension-content-base-element', /^((?!\\.ant-btn).)*$/] &#125;)]; åŒæ—¶ä¹Ÿè¦ä¸ºdomå…ƒç´ æ‰‹åŠ¨åŠ ä¸Šæ­¤ç±»å 123new webpack.DefinePlugin(&#123; WRAPPER_CLASS_NAME: `'$&#123;wrapperClassName&#125;'` // é˜²æ­¢æ’ä»¶çš„æ ·å¼è¢«æ±¡æŸ“æˆ–è€…æ˜¯å½“å‰é¡µé¢çš„æ ·å¼æ±¡æŸ“æ’ä»¶çš„æ ·å¼ &#125;) éœ€è¦æ³¨æ„çš„æ˜¯åƒç»„ä»¶åº“ä¸­çš„modalç­‰ç»„ä»¶ï¼Œå¹¶ä¸èƒ½ç»™ä»–çš„æœ€å¤–å±‚æŒ‡å®šç±»åï¼Œä½†æ˜¯ç»„ä»¶åº“çš„æ ·å¼æ–‡ä»¶åŒæ ·ä¼šè¢«åŠ ä¸Šnamespaceéœ€è¦åœ¨é…ç½®çš„æ—¶å€™ignoreæ‰è¿™ä¸€éƒ¨åˆ†ç±»åï¼Œæ‰‹åŠ¨åœ¨æ ·å¼æ–‡ä»¶ä¸­åŠ ä¸ŠåŒ…è£¹çš„ç±»åã€‚å‡çº§åˆ°v3ä¹‹åbackgroundæ— æ³•ç›‘å¬åˆ°å¼‚æ­¥å‘é€çš„æ¶ˆæ¯äº† 1234567891011121314151617181920212223242526272829303132333435363738// content scirptdocument.addEventListener('DOMContentLoaded', () =&gt; &#123; this.listenSetCookieCmd(); this.sendUserPermission();&#125;)// background.js async listenSetPersonalPermissionCmd() &#123; contentClient.listen('get-current-permission', async (res, sendResponse) =&gt; &#123; await storage.set('personalPermission', res.params, true); sendResponse(new ChromeMessage('set personal permission success')); &#125;); &#125;å¦‚ä¸Š å¹¶æœªå“åº”ï¼ŒçŒœæƒ³æ˜¯service workeråœ¨ä¸€æ®µæ—¶é—´æ²¡æ”¶åˆ°æ¶ˆæ¯ä¹‹åä¼šè‡ªåŠ¨è¿›å…¥ä¼‘çœ æ€ä¹ˆè§£å†³ï¼Ÿ// content script async init() &#123; this.setHeartBeat(); // æ³¨æ„ï¼Œå¿…é¡»è®¾ç½®äº†run_at=document_start æ­¤æ®µä»£ç æ‰ä¼šç”Ÿæ•ˆ document.addEventListener('DOMContentLoaded', () =&gt; &#123; ... setHeartBeat() &#123; setTimeout(() =&gt; &#123; contentClient.sendMessage('ping'); &#125;, 10); &#125; // background.js init()&#123; this.listenPing() &#125; listenPing() &#123; parentClient.listen('ping', ((res, sendResponse) =&gt; &#123; sendResponse('pong'); &#125;)); &#125; è„šæœ¬æ³¨å…¥ æ— è®ºæ˜¯registerScriptè¿˜æ˜¯execute Scriptï¼Œä»–çš„windowè·Ÿè¢«æ³¨å…¥é¡µé¢çš„éƒ½æ˜¯ç›¸äº’ç‹¬ç«‹çš„windowï¼Œå¦‚æœéœ€è¦æ›´æ”¹ç›®æ ‡é¡µé¢çš„window:const script = document.createElement(â€˜scriptâ€™); script.setAttribute(â€˜typeâ€™, â€˜text/javascriptâ€™); script.setAttribute(â€˜srcâ€™, chrome.runtime.getURL(â€˜inject.jsâ€™)); (document.head || document.documentElement).prepend(script);ä¸´æ—¶æ³¨å…¥çš„è„šæœ¬ä¸èƒ½é˜»å¡åé¢çš„è„šæœ¬çš„æ‰§è¡Œï¼Œå¯èƒ½æ˜¯å› ä¸ºè¢«æ³¨å…¥çš„æ—¶å€™è¿˜åé¢çš„è„šæœ¬å·²ç»å¼€å§‹parseäº† ä¸´æ—¶æ’å…¥çš„è„šæœ¬ï¼Œè™½ç„¶æ˜¯ä¸ªæœ¬åœ°çš„è„šæœ¬ä½†æ˜¯ä¹Ÿéœ€è¦åŠ è½½ï¼Œéœ€è¦script.onload=xxx,content scriptæ˜¯ä¸€ä¸ªstandaloneçš„å­¤ç«‹çš„è„šæœ¬ï¼Œå®ƒä¸ä¼šç­‰åˆ°è¢«æ’å…¥åˆ°é¡µé¢çš„è¿™ä¸ªè„šæœ¬æ‰§è¡Œå®Œæ¯•ä¹‹åå†æ‰§è¡Œ content scriptä¸injectjsçš„é€šä¿¡ï¼špostmessage ä¸èƒ½ç›´æ¥æ‰§è¡Œå†…è”è„šæœ¬ä¿®æ”¹windowå˜é‡ï¼Œä¼šæŠ¥é”™12script.innerHTML = `window.ggconfig=$&#123;JSON.stringify(config)&#125;`;document.body.appendChild(script); é‡å®šå‘ æ‹¦æˆªè¢«æ³¨å…¥é¡µé¢çš„é‡å®šå‘ï¼Œhtmlçš„é‡å®šå‘éœ€è¦æ˜¯ä¸€ä¸ªç›¸åŒçš„åŸŸåå¦‚ä½•é˜»å¡å½“å‰é¡µé¢çš„è§£æï¼Ÿ123var startTime = new Date().getTime() + 2*1000;while (new Date().getTime() &lt; startTime) &#123;&#125; æ’å…¥å¦‚ä¸Šè€—æ—¶ä»£ç ï¼Œä½†æ˜¯å› ä¸ºè¿™æ®µä»£ç æ˜¯ç›´æ¥åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œçš„ï¼Œæ‰€ä»¥å¦‚æœæˆ‘åœ¨æ‰©å±•çš„è„šæœ¬ä¸­åŠ ä¸Šä¸€ä¸ªå®šæ—¶å™¨ï¼Œå®šæ—¶å™¨å› ä¸ºæ˜¯å®ä»»åŠ¡ï¼Œä¹Ÿä¼šè¢«é˜»å¡ï¼Œæƒ³åˆ°çš„æ–¹æ³•æ˜¯è®©è¿™æ®µå®šæ—¶å™¨ä»£ç åœ¨web workerä¸­æ‰§è¡Œï¼Œä½†æ˜¯chrome extensionä¸æ”¯æŒæœ¬åœ°js ä½œä¸ºweb workerå­è¿›ç¨‹ï¼ŒæŠ˜ä¸­çš„æ–¹å¼ï¼šnew Worker(URL.createObjectURL(new Blob([(${xFunction.toString()})(${json})], { type: â€˜text/javascriptâ€™ })))ä½†æ˜¯ web workerè²Œä¼¼ä¸èƒ½åƒçˆ¶çª—å£ä¹‹å¤–çš„çª—å£å‘é€postMessage ç»¼ä¸Šï¼šchrome extensionå¯¹è„šæœ¬çš„é™åˆ¶è¿˜æ˜¯æ¯”è¾ƒå¤šçš„ï¼Œå¦‚æœæŠ€æœ¯ä¸Šä¸å¯è¡Œçš„è¯ï¼ŒåŠæ—¶æ›´æ¢äº§å“æ–¹æ¡ˆChrome extensionèƒ½ç”¨æ¥åšå•¥æ“ä½œcookieå¼ºå¤§çš„chrome.cookiesapièƒ½è·å–åˆ°å½“å‰åŸŸåä¸‹å­˜åœ¨çš„æ‰€æœ‰çš„cookieï¼ŒåŒ…æ‹¬è®¾ç½®äº†httpOnlyçš„ï¼Œå¯ä»¥ç”¨æ¥å¯¹cookieè¿›è¡Œå¿«é€Ÿè¯»å–åˆ é™¤ç­‰æ“ä½œã€‚æ‹¦æˆªç½‘ç»œè¯·æ±‚chrome.webRequestèƒ½æ‹¦æˆªåˆ°ajaxè¯·æ±‚çš„å„ä¸ªé˜¶æ®µï¼Œå¹¶ä¸”ä¿®æ”¹æˆ–è€…æ˜¯å±è”½è¯·æ±‚ å±è”½æ‰æ‰€æœ‰å‘å¾€www.evil.comçš„è¯·æ±‚ 1234567chrome.webRequest.onBeforeRequest.addListener( function(details) &#123; return &#123;cancel: details.url.indexOf(\"://www.evil.com/\") != -1&#125;; &#125;, &#123;urls: [\"&lt;all_urls&gt;\"]&#125;, [\"blocking\"]); å…¶ä»– å‘é¡µé¢æ³¨å…¥JSè„šæœ¬,æ¯”å¦‚temperMongkey ç½‘é¡µæˆªå›¾ åˆ©ç”¨chrome.tabsapi æ“ä½œå½“å‰æ‰“å¼€çš„æ ‡ç­¾é¡µï¼ˆæ•´ç†ï¼Œæœç´¢,ç§»é™¤ç­‰ç­‰ï¼‰ï¼Œæ¯”å¦‚one tab æ“ä½œå½“å‰é¡µé¢çš„dom,æ¯”å¦‚åˆ’è¯æœç´¢å‚è€ƒå¦‚ä½•å®ç° chrome extension çš„çƒ­æ›´æ–°","categories":[],"tags":[{"name":"chromeExtension","slug":"chromeExtension","permalink":"https://ashleyblog.xyz/tags/chromeExtension/"}]},{"title":"vue3å“åº”å¼åŸç†","slug":"å“åº”å¼åŸç†","date":"2022-05-15T12:52:41.000Z","updated":"2023-04-16T03:19:22.240Z","comments":true,"path":"2022/05/15/å“åº”å¼åŸç†/","link":"","permalink":"https://ashleyblog.xyz/2022/05/15/å“åº”å¼åŸç†/","excerpt":"","text":"ProxyVue3 çš„å“åº”å¼åŸç†ä¾èµ–äº† Proxy è¿™ä¸ªæ ¸å¿ƒ APIï¼Œé€šè¿‡ Proxy å¯ä»¥åŠ«æŒå¯¹è±¡çš„æŸäº›æ“ä½œã€‚ 123456789101112131415161718192021222324const obj = &#123; a: 1 &#125;;const p = new Proxy(obj, &#123; get(target, property, receiver) &#123; console.log(\"get\"); return Reflect.get(target, property, receiver); &#125;, set(target, property, value, receiver) &#123; console.log(\"set\"); return Reflect.set(target, property, receiver); &#125;, has(target, prop) &#123; console.log(\"has\"); return Reflect.has(target, prop); &#125;, deleteProperty(target, prop) &#123; console.log(\"deleteProperty\"); return Reflect.deleteProperty(target, prop); &#125;,&#125;);p.a; // è¾“å‡º --&gt; getp.a = 2; // è¾“å‡º --&gt; set\"a\" in p; // è¾“å‡º --&gt; hasdelete p.a; // è¾“å‡º --&gt; deleteProperty å¦‚ä¸Šä¾‹å­ï¼Œæˆ‘ä»¬ç”¨ Proxy ä»£ç†äº† Obj å¯¹è±¡çš„å±æ€§è®¿é—®ã€å±æ€§èµ‹å€¼ã€in æ“ä½œç¬¦ã€delete çš„æ“ä½œï¼Œå¹¶è¿›è¡Œ console.log è¾“å‡ºã€‚ ReflectReflect æ˜¯ä¸ Proxy æ­é…ä½¿ç”¨çš„ä¸€ä¸ª APIï¼Œå½“æˆ‘ä»¬åŠ«æŒäº†æŸäº›æ“ä½œæ—¶ï¼Œå¦‚æœéœ€è¦å†æŠŠè¿™äº›æ“ä½œåå°„å›å»ï¼Œé‚£ä¹ˆå°±éœ€è¦ Reflect è¿™ä¸ª APIã€‚ ç”±äºæˆ‘ä»¬æ‹¦æˆªäº†å¯¹è±¡çš„æ“ä½œï¼Œæ‰€ä»¥è¿™äº›æ“ä½œè¯¥æœ‰çš„åŠŸèƒ½éƒ½ä¸§å¤±äº†ï¼Œä¾‹å¦‚ï¼Œè®¿é—®å±æ€§ p.a åº”è¯¥å¾—åˆ° a å±æ€§çš„å€¼ï¼Œä½†æ­¤æ—¶å´ä¸ä¼šæœ‰ä»»ä½•ç»“æœï¼Œå¦‚æœæˆ‘ä»¬è¿˜æƒ³æ‹¥æœ‰æ‹¦æˆªä¹‹å‰çš„åŠŸèƒ½ï¼Œé‚£æˆ‘ä»¬å°±éœ€è¦ç”¨ Reflect åå°„å›å»ã€‚ 12345678910111213141516171819const obj = &#123; a: 1 &#125;;const p = new Proxy(obj, &#123; get(target, property, receiver) &#123; console.log(\"get\"); return Reflect.get(target, property, receiver); &#125;, set(target, property, value, receiver) &#123; console.log(\"set\"); return Reflect.set(target, property, receiver); &#125;, has(target, prop) &#123; console.log(\"has\"); return Reflect.has(target, prop); &#125;, deleteProperty(target, prop) &#123; console.log(\"deleteProperty\"); return Reflect.deleteProperty(target, prop); &#125;,&#125;); ä¸¾ä¸ªä¾‹å­ä»¥ä¸‹å…¨æ–‡æˆ‘ä»¬éƒ½ä¼šé€šè¿‡è¿™ä¸ªä¾‹å­æ¥è®²è¿° Vue3 å“åº”å¼çš„åŸç†ã€‚ 12345678910111213141516&lt;div id=\"app\"&gt;&lt;/div&gt;&lt;script&gt; // åˆ›å»ºä¸€ä¸ªå“åº”å¼å¯¹è±¡ const state = reactive(&#123; counter: 1 &#125;); // ç«‹å³è¿è¡Œä¸€ä¸ªå‡½æ•°ï¼Œå½“å“åº”å¼å¯¹è±¡çš„å±æ€§å‘ç”Ÿæ”¹å˜æ—¶é‡æ–°æ‰§è¡Œã€‚ effect(() =&gt; &#123; document.querySelector(\"#app\").innerHTML = state.counter; &#125;); // 2s åè§†å›¾æ›´æ–° setTimeout(() =&gt; &#123; state.counter += 1; &#125;, 2000);&lt;/script&gt; æˆ‘ä»¬ç”¨ reactive åˆ›å»ºäº†ä¸€ä¸ªå“åº”å¼å¯¹è±¡ stateï¼Œå¹¶è°ƒç”¨äº† effect æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ¥å—ä¸€ä¸ªå‰¯ä½œç”¨å‡½æ•°ï¼Œeffect çš„æ‰§è¡Œä¼šç«‹å³è°ƒç”¨å‰¯ä½œç”¨å‡½æ•°ï¼Œå¹¶å°† state.counter èµ‹å€¼ç»™ #app.innerHTMLï¼›ä¸¤ç§’åï¼Œstate.counter += 1ï¼Œæ­¤æ—¶ï¼Œeffect çš„å‰¯ä½œç”¨å‡½æ•°ä¼šé‡æ–°æ‰§è¡Œï¼Œé¡µé¢ä¹Ÿä¼šå˜æˆ 2. å†…éƒ¨çš„æ‰§è¡Œè¿‡ç¨‹å¤§æ¦‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š è°ƒç”¨ reactive() è¿”å›ä¸€ä¸ª Proxy ä»£ç†å¯¹è±¡ï¼Œå¹¶åŠ«æŒå¯¹è±¡çš„ get ä¸ set æ“ä½œ è°ƒç”¨ effect() æ–¹æ³•æ—¶ï¼Œä¼šè®¿é—®å±æ€§ state.counterï¼Œæ­¤æ—¶ä¼šè§¦å‘ proxy çš„ get æ“ä½œã€‚ get æ–¹æ³•ä¼šè°ƒç”¨ track() è¿›è¡Œä¾èµ–æ”¶é›†ï¼›å»ºç«‹ä¸€ä¸ªå¯¹è±¡ï¼ˆstateï¼‰ã€å±æ€§ï¼ˆcounterï¼‰ã€effect å‰¯ä½œç”¨å‡½æ•°çš„ä¾èµ–å…³ç³»ï¼› set æ–¹æ³•ä¼šè°ƒç”¨ trigger() è¿›è¡Œä¾èµ–æ›´æ–°ï¼›é€šè¿‡å¯¹è±¡ï¼ˆstateï¼‰ä¸å±æ€§ï¼ˆcoutnerï¼‰æ‰¾åˆ°å¯¹åº”çš„ effect å‰¯ä½œç”¨å‡½æ•°ï¼Œç„¶åé‡æ–°æ‰§è¡Œã€‚reactive reactivereactive ä¼šè¿”å›å¦‚ä¸‹ä¸€ä¸ª Proxy å¯¹è±¡ 123456789101112131415161718192021const reactive = (target) =&gt; &#123; return new Proxy(target, &#123; get(target, key, receiver) &#123; const res = Reflect.get(target, key, receiver); track(target, key); // æ”¶é›†ä¾èµ– if (isObject(res)) &#123; // å¦‚æœå½“å‰è·å–çš„å±æ€§å€¼æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œåˆ™ç»§ç»­å°†ä¸ºæ­¤å¯¹è±¡åˆ›å»º Proxy ä»£ç† return reactive(res); &#125; return res; &#125;, set(target, key, value, receiver) &#123; Reflect.set(target, key, value, receiver); trigger(target, key); // ä¾èµ–æ›´æ–° &#125;, &#125;);&#125;; effect123456789let activeEffect;function effect(fn) &#123; const _effect = function reactiveEffect() &#123; activeEffect = _effect; fn(); &#125;; _effect();&#125; é¦–å…ˆå®šä¹‰å…¨å±€çš„ activeEffectï¼Œå®ƒæ°¸è¿œæŒ‡å‘å½“å‰æ­£åœ¨æ‰§è¡Œçš„ effect å‰¯ä½œç”¨å‡½æ•°ã€‚effect ä¸º fn åˆ›å»ºä¸€ä¸ªå†…éƒ¨çš„å‰¯ä½œç”¨å‡½æ•°ï¼Œç„¶åç«‹å³æ‰§è¡Œï¼Œæ­¤æ—¶ä¼šè§¦å‘å¯¹è±¡çš„ get æ“ä½œï¼Œè°ƒç”¨ track() æ–¹æ³•ã€‚ 1234effect(() =&gt; &#123; // effect çš„ç«‹å³æ‰§è¡Œä¼šè®¿é—® state.counterï¼Œè§¦å‘äº†å¯¹è±¡çš„ get æ“ä½œã€‚ document.querySelector(\"#app\").innerHTML = state.counter;&#125;); tracktrack ä¼šå»ºç«‹ä¸€ä¸ª å¯¹è±¡ï¼ˆstateï¼‰ =&gt; å±æ€§ï¼ˆcounterï¼‰ =&gt; effect çš„ä¸€ä¸ªä¾èµ–å…³ç³» 1234567891011121314151617181920const targetMap = new WeakMap();function track(target, key) &#123; if (!activeEffect) &#123; return; &#125; let depsMap = targetMap.get(target); if (!depsMap) &#123; targetMap.set(target, (depsMap = new Map())); &#125; let dep = depsMap.get(key); if (!dep) &#123; depsMap.set(key, (dep = new Set())); &#125; if (!dep.has(activeEffect)) &#123; dep.add(activeEffect); &#125;&#125; æ‰§è¡Œå®Œæˆæˆåæˆ‘ä»¬å¾—åˆ°ä¸€ä¸ªå¦‚ä¸‹çš„æ•°æ®ç»“æ„ï¼š 12345678910111213[ // map é›†åˆ &#123; key: &#123;counter: 1&#125; // state å¯¹è±¡, value: [ // map é›†åˆ &#123; key: \"counter\", value: [ // set function reactiveEffect() &#123;&#125; // effect å‰¯ä½œç”¨å‡½æ•° ], &#125; ], &#125;,]; triggerå½“æˆ‘ä»¬ç»™ state.counter èµ‹å€¼çš„æ—¶å€™å°±ä¼šè§¦å‘ä»£ç†å¯¹è±¡çš„ set æ“ä½œï¼Œä»è€Œè°ƒç”¨ trigger æ–¹æ³• 123456789101112setTimeout(() =&gt; &#123; // ç»™ counter å±æ€§èµ‹å€¼ä¼šè§¦å‘ set æ“ä½œ state.counter += 1;&#125;, 2000);function trigger(target, key) &#123; const depsMap = targetMap.get(target); if (!depsMap) return; const effects = depsMap.get(key); effects &amp;&amp; effects.forEach((effect) =&gt; effect());&#125; vue3ä¸ºä»€ä¹ˆè¦ç”¨proxyå–ä»£definePropertyVue3ä½¿ç”¨Proxyå–ä»£definePropertyçš„åŸå› æ˜¯ï¼ŒProxyå¯ä»¥ç›´æ¥ä»£ç†å¯¹è±¡ï¼Œè€ŒdefinePropertyåªèƒ½åŠ«æŒå¯¹è±¡çš„å±æ€§ã€‚ç”±äºObject.definePropertyåªèƒ½å¯¹å±æ€§è¿›è¡ŒåŠ«æŒï¼Œéœ€è¦éå†å¯¹è±¡çš„æ¯ä¸ªå±æ€§ï¼Œå¦‚æœå±æ€§å€¼ä¹Ÿæ˜¯å¯¹è±¡ï¼Œåˆ™éœ€è¦æ·±åº¦éå†ã€‚è¿™æ ·çš„æ•ˆç‡æ¯”è¾ƒä½ï¼Œè€Œä¸”ä»£ç é‡ä¹Ÿæ¯”è¾ƒå¤§ã€‚è€ŒProxyå¯ä»¥ç›´æ¥åŠ«æŒæ•°ç»„ã€å¯¹è±¡çš„æ”¹å˜ï¼Œå¯ä»¥ç›´æ¥æ·»åŠ å¯¹è±¡å±æ€§ï¼Œå…¼å®¹æ€§ä¹Ÿæ¯”è¾ƒå¥½ã€‚æ¯”å¦‚ï¼šä¸‹é¢çš„ä¾‹å­ä½¿ç”¨getæ‹¦æˆªï¼Œå®ç°æ•°ç»„è¯»å–è´Ÿæ•°çš„ç´¢å¼•ã€‚ 123456789101112131415161718function createArray(...elements) &#123; let handler = &#123; get(target, propKey, receiver) &#123; let index = Number(propKey); if (index &lt; 0) &#123; propKey = String(target.length + index); &#125; return Reflect.get(target, propKey, receiver); &#125; &#125;; let target = []; target.push(...elements); return new Proxy(target, handler);&#125;let arr = createArray('a', 'b', 'c');arr[-1] // c ä¸Šé¢ä»£ç ä¸­ï¼Œæ•°ç»„çš„ä½ç½®å‚æ•°æ˜¯-1ï¼Œå°±ä¼šè¾“å‡ºæ•°ç»„çš„å€’æ•°ç¬¬ä¸€ä¸ªæˆå‘˜ã€‚ å› ä¸ºç›´æ¥å¯¹å¯¹è±¡åšçš„ä»£ç†æ‰€ä»¥è¿˜èƒ½å®ç°é“¾å¼æ“ä½œ 12345678910111213141516171819202122var pipe = function (value) &#123; var funcStack = []; var oproxy = new Proxy(&#123;&#125; , &#123; get : function (pipeObject, fnName) &#123; if (fnName === 'get') &#123; return funcStack.reduce(function (val, fn) &#123; return fn(val); &#125;,value); &#125; funcStack.push(window[fnName]); return oproxy; &#125; &#125;); return oproxy;&#125;var double = n =&gt; n * 2;var pow = n =&gt; n * n;var reverseInt = n =&gt; n.toString().split(\"\").reverse().join(\"\") | 0;pipe(3).double.pow.reverseInt.get; // 63","categories":[],"tags":[{"name":"vue3","slug":"vue3","permalink":"https://ashleyblog.xyz/tags/vue3/"}]},{"title":"Vue2å’ŒVue3åŒºåˆ«","slug":"Vue2å’ŒVue3åŒºåˆ«","date":"2021-04-16T02:30:44.000Z","updated":"2023-04-16T03:18:12.870Z","comments":true,"path":"2021/04/16/Vue2å’ŒVue3åŒºåˆ«/","link":"","permalink":"https://ashleyblog.xyz/2021/04/16/Vue2å’ŒVue3åŒºåˆ«/","excerpt":"","text":"å“åº”å¼åŸç†apiçš„æ”¹å˜Vue2å“åº”å¼åŸç†é‡‡ç”¨çš„æ˜¯definePropertyï¼Œè€Œvue3é€‰ç”¨çš„æ˜¯proxyã€‚è¿™ä¸¤è€…å‰è€…æ˜¯ä¿®æ”¹å¯¹è±¡å±æ€§çš„æƒé™æ ‡ç­¾ï¼Œåè€…æ˜¯ä»£ç†æ•´ä¸ªå¯¹è±¡ã€‚æ€§èƒ½ä¸Šproxyä¼šæ›´åŠ ä¼˜ç§€ã€‚ diffç®—æ³•ï¼Œæ¸²æŸ“ç®—æ³•çš„æ”¹å˜Vue3ä¼˜åŒ–diffç®—æ³•ã€‚ä¸å†åƒvue2é‚£æ ·æ¯”å¯¹æ‰€æœ‰domï¼Œè€Œé‡‡ç”¨äº†block treeçš„åšæ³•ã€‚æ­¤å¤–é‡æ–°æ¸²æŸ“çš„ç®—æ³•é‡Œä¹Ÿåšäº†æ”¹è¿›ï¼Œåˆ©ç”¨äº†é—­åŒ…æ¥è¿›è¡Œç¼“å­˜ã€‚è¿™ä½¿å¾—vue3çš„é€Ÿåº¦æ¯”vue2å¿«äº†6å€ã€‚ vue2çš„diffè¿‡ç¨‹vueåœ¨å†…éƒ¨é€šè¿‡ä¸€ä¸ªå«patchçš„å‡½æ•°å®Œæˆè¯¥è¿‡ç¨‹ åœ¨å¯¹æ¯”æ—¶ï¼Œvueé‡‡ç”¨æ·±åº¦ä¼˜å…ˆã€åŒå±‚æ¯”è¾ƒçš„æ–¹å¼è¿›è¡Œæ¯”å¯¹ã€‚ åœ¨åˆ¤æ–­ä¸¤ä¸ªèŠ‚ç‚¹æ˜¯å¦ç›¸åŒæ—¶ï¼Œvueæ˜¯é€šè¿‡è™šæ‹ŸèŠ‚ç‚¹çš„keyå’Œtagæ¥è¿›è¡Œåˆ¤æ–­çš„ å…·ä½“æ¥è¯´ï¼Œé¦–å…ˆå¯¹æ ¹èŠ‚ç‚¹è¿›è¡Œå¯¹æ¯”ï¼Œå¦‚æœç›¸åŒåˆ™å°†æ—§èŠ‚ç‚¹å…³è”çš„çœŸå®domçš„å¼•ç”¨æŒ‚åˆ°æ–°èŠ‚ç‚¹ä¸Šï¼Œç„¶åæ ¹æ®éœ€è¦æ›´æ–°å±æ€§åˆ°çœŸå®domï¼Œç„¶åå†å¯¹æ¯”å…¶å­èŠ‚ç‚¹æ•°ç»„ï¼›å¦‚æœä¸ç›¸åŒï¼Œåˆ™æŒ‰ç…§æ–°èŠ‚ç‚¹çš„ä¿¡æ¯é€’å½’åˆ›å»ºæ‰€æœ‰çœŸå®domï¼ŒåŒæ—¶æŒ‚åˆ°å¯¹åº”è™šæ‹ŸèŠ‚ç‚¹ä¸Šï¼Œç„¶åç§»é™¤æ‰æ—§çš„domã€‚ åœ¨å¯¹æ¯”å…¶å­èŠ‚ç‚¹æ•°ç»„æ—¶ï¼Œvueå¯¹æ¯ä¸ªå­èŠ‚ç‚¹æ•°ç»„ä½¿ç”¨äº†ä¸¤ä¸ªæŒ‡é’ˆï¼Œåˆ†åˆ«æŒ‡å‘å¤´å°¾ï¼Œç„¶åä¸æ–­å‘ä¸­é—´é æ‹¢æ¥è¿›è¡Œå¯¹æ¯”ï¼Œè¿™æ ·åšçš„ç›®çš„æ˜¯å°½é‡å¤ç”¨çœŸå®domï¼Œå°½é‡å°‘çš„é”€æ¯å’Œåˆ›å»ºçœŸå®domã€‚å¦‚æœå‘ç°ç›¸åŒï¼Œåˆ™è¿›å…¥å’Œæ ¹èŠ‚ç‚¹ä¸€æ ·çš„å¯¹æ¯”æµç¨‹ï¼Œå¦‚æœå‘ç°ä¸åŒï¼Œåˆ™ç§»åŠ¨çœŸå®domåˆ°åˆé€‚çš„ä½ç½®ã€‚ è¿™æ ·ä¸€ç›´é€’å½’çš„éå†ä¸‹å»ï¼Œç›´åˆ°æ•´æ£µæ ‘å®Œæˆå¯¹æ¯” reactçš„diff ä¼˜åŒ–ç‚¹ åªæ¯”è¾ƒåŒå±‚ åŒç«¯æ¯”è¾ƒï¼šå³åŒæ—¶ä»æ–°æ—§ VNode çš„å¤´éƒ¨å’Œå°¾éƒ¨å¼€å§‹æ¯”è¾ƒï¼Œç„¶åæ ¹æ®æƒ…å†µç§»åŠ¨æŒ‡é’ˆï¼Œç›´åˆ°æ‰¾åˆ°ä¸åŒçš„èŠ‚ç‚¹ä¸ºæ­¢ã€‚è¿™ç§ç­–ç•¥å¯ä»¥æœ€å¤§ç¨‹åº¦åœ°å‡å°‘æ¯”è¾ƒæ¬¡æ•°ï¼Œä»è€Œæé«˜ diff ç®—æ³•çš„æ•ˆç‡ã€‚ keyä¼˜åŒ–ï¼šå¦‚æœæ²¡æœ‰ç»™èŠ‚ç‚¹æ·»åŠ keyå€¼ï¼Œé‚£ä¹ˆVueä¼šè®¤ä¸ºè¿™äº›èŠ‚ç‚¹æ˜¯ç›¸åŒçš„ï¼Œä»è€Œå¯¹æ•´ä¸ªåˆ—è¡¨è¿›è¡Œé‡æ¸²æŸ“ã€‚è€Œå¦‚æœç»™èŠ‚ç‚¹æ·»åŠ äº†å”¯ä¸€çš„keyå€¼ï¼Œé‚£ä¹ˆVueå°±å¯ä»¥æ ¹æ®keyå€¼æ¥åˆ¤æ–­å“ªäº›èŠ‚ç‚¹æ˜¯ç›¸åŒçš„ï¼Œå“ªäº›èŠ‚ç‚¹æ˜¯ä¸åŒçš„ï¼Œä»è€Œåªå¯¹ä¸åŒçš„èŠ‚ç‚¹è¿›è¡Œæ›´æ–°ï¼Œæé«˜äº†æ€§èƒ½ã€‚ vue3çš„diff é™æ€èŠ‚ç‚¹ä¼˜åŒ–ï¼šé™æ€èŠ‚ç‚¹æŒ‡çš„æ˜¯ä¸ä¼šæ”¹å˜çš„èŠ‚ç‚¹ï¼Œå¦‚æ–‡æœ¬èŠ‚ç‚¹ã€‚åœ¨Vue2ä¸­ï¼Œæ¯æ¬¡é‡æ–°æ¸²æŸ“æ—¶ï¼Œéƒ½ä¼šé‡æ–°åˆ›å»ºè¿™äº›é™æ€èŠ‚ç‚¹ï¼Œè¿™æ ·ä¼šæµªè´¹å¾ˆå¤šæ—¶é—´ã€‚Vue3ä¸­ï¼Œé€šè¿‡é™æ€æå‡çš„æ–¹å¼ï¼Œå°†é™æ€èŠ‚ç‚¹æå‡åˆ°çˆ¶ç»„ä»¶çš„æ¸²æŸ“å‡½æ•°ä¸­ï¼Œåœ¨ç»„ä»¶æ›´æ–°æ—¶ï¼Œåªéœ€è¦å¯¹åŠ¨æ€èŠ‚ç‚¹è¿›è¡Œæ¯”è¾ƒï¼Œä»è€Œé¿å…äº†å¯¹é™æ€èŠ‚ç‚¹çš„é‡å¤æ¸²æŸ“ï¼Œæé«˜äº†æ€§èƒ½ ã€‚ å»ºç«‹æ•°æ® dataè¿™é‡Œå°±æ˜¯Vue2ä¸Vue3 æœ€å¤§çš„åŒºåˆ« â€” Vue2ä½¿ç”¨é€‰é¡¹ç±»å‹APIï¼ˆOptions APIï¼‰å¯¹æ¯”Vue3åˆæˆå‹APIï¼ˆComposition APIï¼‰æ—§çš„é€‰é¡¹å‹APIåœ¨ä»£ç é‡Œåˆ†å‰²äº†ä¸åŒçš„å±æ€§ï¼ˆpropertiesï¼‰ï¼šdataï¼Œcomputedå±æ€§ï¼Œmethodsï¼Œç­‰ç­‰ã€‚æ–°çš„åˆæˆå‹APIèƒ½è®©æˆ‘ä»¬ç”¨æ–¹æ³•ï¼ˆfunctionï¼‰æ¥åˆ†å‰²ï¼Œç›¸æ¯”äºæ—§çš„APIä½¿ç”¨å±æ€§æ¥åˆ†ç»„ï¼Œè¿™æ ·ä»£ç ä¼šæ›´åŠ ç®€ä¾¿å’Œæ•´æ´ã€‚ Vue3å¯¹TypeScriptçš„æ”¯æŒæ›´åŠ å‹å¥½","categories":[],"tags":[{"name":"vue","slug":"vue","permalink":"https://ashleyblog.xyz/tags/vue/"}]},{"title":"å¸¸è§ç™»å½•æ–¹æ¡ˆ","slug":"å¸¸è§ç™»å½•æ–¹æ¡ˆ","date":"2021-04-10T03:44:17.000Z","updated":"2023-04-16T03:23:42.010Z","comments":true,"path":"2021/04/10/å¸¸è§ç™»å½•æ–¹æ¡ˆ/","link":"","permalink":"https://ashleyblog.xyz/2021/04/10/å¸¸è§ç™»å½•æ–¹æ¡ˆ/","excerpt":"","text":"sessionSession æ˜¯ä¸€ç§å­˜å‚¨åœ¨æœåŠ¡å™¨ä¸Šçš„æ•°æ®ç»“æ„ï¼Œç”¨äºå­˜å‚¨æœ‰å…³ç”¨æˆ·çš„ä¿¡æ¯ã€‚Session æ•°æ®å­˜å‚¨åœ¨æœåŠ¡å™¨ä¸Šï¼Œå› æ­¤æ¯” Cookie æ›´åŠ å®‰å…¨ã€‚Session é€šå¸¸ä½¿ç”¨ Cookie æ¥è·Ÿè¸ªç”¨æˆ·ä¼šè¯ sessionæœºåˆ¶å½“æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚éœ€è¦åˆ›å»ºsessionå¯¹è±¡æ—¶ï¼Œé¦–å…ˆä¼šæ£€æŸ¥å®¢æˆ·ç«¯è¯·æ±‚ä¸­æ˜¯å¦åŒ…å«sessionidã€‚å¦‚æœæœ‰sessionidï¼ŒæœåŠ¡å™¨å°†æ ¹æ®è¯¥idè¿”å›å¯¹åº”sessionå¯¹è±¡ã€‚å¦‚æœå®¢æˆ·ç«¯è¯·æ±‚ä¸­æ²¡æœ‰sessionidï¼ŒæœåŠ¡å™¨ä¼šåˆ›å»ºæ–°çš„sessionå¯¹è±¡ï¼Œå¹¶æŠŠsessionidåœ¨æœ¬æ¬¡å“åº”ä¸­è¿”å›ç»™å®¢æˆ·ç«¯ã€‚é€šå¸¸ä½¿ç”¨cookieæ–¹å¼å­˜å‚¨sessionidåˆ°å®¢æˆ·ç«¯ï¼Œåœ¨äº¤äº’ä¸­æµè§ˆå™¨æŒ‰ç…§è§„åˆ™å°†sessionidå‘é€ç»™æœåŠ¡å™¨ã€‚æœåŠ¡å™¨æŒ‰ç…§è¯¥session IDæŸ¥æ‰¾å¯¹åº”çš„sessionä¿¡æ¯å¦‚æœæ²¡æ‰¾åˆ°è¯´æ˜æ²¡ç™»å½•æˆ–è€…ç™»é™†å¤±æ•ˆå¦‚æœç”¨æˆ·ç¦ç”¨cookieï¼Œåˆ™è¦ä½¿ç”¨URLé‡å†™ï¼Œå¯ä»¥é€šè¿‡response.encodeURL(url) è¿›è¡Œå®ç°ï¼›APIå¯¹encodeURLçš„ç»“æŸä¸ºï¼Œå½“æµè§ˆå™¨æ”¯æŒCookieæ—¶ï¼Œurlä¸åšä»»ä½•å¤„ç†ï¼›å½“æµè§ˆå™¨ä¸æ”¯æŒCookieçš„æ—¶å€™ï¼Œå°†ä¼šé‡å†™URLå°†SessionIDæ‹¼æ¥åˆ°è®¿é—®åœ°å€åã€‚sessionçš„ä¼˜åŠ¿ç›¸è¾ƒäº cookie æ¥è¯´ï¼Œsession å­˜å‚¨åœ¨æœåŠ¡ç«¯ï¼Œå®¢æˆ·ç«¯ä»…ä¿ç•™æ¢å– session çš„ç”¨æˆ·å‡­è¯ã€‚å› æ­¤ä¼ è¾“æ•°æ®é‡å°ï¼Œé€Ÿåº¦å¿«ã€‚session æ›´å®‰å…¨ï¼šæ£€éªŒã€ç”Ÿæˆã€éªŒè¯éƒ½æ˜¯åœ¨æœåŠ¡ç«¯æŒ‰ç…§æŒ‡å®šè§„åˆ™å®Œæˆï¼Œè€Œ cookie å¯èƒ½è¢«å®¢æˆ·ç«¯é€šè¿‡ js ä»£ç ç¯¡æ”¹ã€‚ session çš„åŠ£åŠ¿ æœåŠ¡å™¨æ˜¯æœ‰çŠ¶æ€çš„ã€‚å¤šå°åç«¯æœåŠ¡å™¨æ— æ³•å…±äº« sessionã€‚**è§£å†³æ–¹æ³•æ˜¯ï¼Œä¸“é—¨å‡†å¤‡ä¸€å° session æœåŠ¡å™¨ï¼Œå…³äº session çš„æ‰€æœ‰æ“ä½œéƒ½äº¤ç»™å®ƒæ¥è°ƒç”¨ã€‚è€ŒæœåŠ¡å™¨ä¹‹é—´çš„è°ƒç”¨ï¼Œå¯ä»¥èµ°å†…ç½‘ ipï¼Œèµ° RPC è°ƒç”¨ï¼ˆåç«¯ä¹‹é—´çš„æ¥å£è¯·æ±‚ï¼Œå‰ç«¯ä¸èƒ½è¯·æ±‚ï¼‰ï¼ˆä¸èµ° httpï¼‰ã€‚ Session ä¸€èˆ¬å¤±æ•ˆæ—¶é—´è¾ƒçŸ­ï¼Œå®¢æˆ·ç«¯å…³é—­ï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼‰æˆ–è€… Session è¶…æ—¶éƒ½ä¼šå¤±æ•ˆã€‚ ç”±äºå­˜æ”¾åœ¨cookieä¸­ï¼Œéœ€è¦é˜²æ­¢CSRFæ”»å‡»è§£å†³æ–¹æ¡ˆï¼šâ—‹ é˜»æ­¢ä¸æ˜å¤–åŸŸçš„è®¿é—®ï¼ŒåŒæºæ£€æµ‹ï¼ˆæ£€æŸ¥refererã€originï¼‰ã€é™åˆ¶ç¬¬ä¸‰æ–¹cookieï¼ˆsamesite=lax)â—‹ è¯·æ±‚æäº¤æ—¶é™„åŠ CSRF tokenï¼ˆåªè¦tokenä¸æ”¾åœ¨cookieé‡Œï¼Œæ”»å‡»è€…æ— æ³•ä¼ªé€ ï¼Œå¹¶ä¸”é¡µé¢æ²¡æœ‰XSSæ¼æ´æ³„æ¼tokenï¼ŒCSRFå°±æ— æ³•æˆåŠŸï¼‰ sessionä¸cookieçš„åŒºåˆ« ä½œç”¨èŒƒå›´ä¸åŒï¼ŒCookie ä¿å­˜åœ¨å®¢æˆ·ç«¯(æµè§ˆå™¨)ï¼ŒSession ä¿å­˜åœ¨æœåŠ¡å™¨ç«¯ã€‚ å­˜å–æ–¹å¼çš„ä¸åŒï¼ŒCookieåªèƒ½ä¿å­˜ ASCIIï¼ŒSessionå¯ä»¥å­˜ä»»æ„æ•°æ®ç±»å‹ï¼Œæ¯”å¦‚UserIdç­‰ã€‚ æœ‰æ•ˆæœŸä¸åŒï¼ŒCookieå¯è®¾ç½®ä¸ºé•¿æ—¶é—´ä¿æŒï¼Œæ¯”å¦‚é»˜è®¤ç™»å½•åŠŸèƒ½åŠŸèƒ½ï¼ŒSessionä¸€èˆ¬æœ‰æ•ˆæ—¶é—´è¾ƒçŸ­ï¼Œå®¢æˆ·ç«¯å…³é—­æˆ–è€…Sessionè¶…æ—¶éƒ½ä¼šå¤±æ•ˆã€‚ éšç§ç­–ç•¥ä¸åŒï¼ŒCookieå­˜å‚¨åœ¨å®¢æˆ·ç«¯ï¼Œä¿¡æ¯å®¹æ˜“è¢«çªƒå–;Sessionå­˜å‚¨åœ¨æœåŠ¡ç«¯ï¼Œç›¸å¯¹å®‰å…¨ä¸€äº›ã€‚ å­˜å‚¨å¤§å°ä¸åŒï¼Œ å•ä¸ªCookie ä¿å­˜çš„æ•°æ®ä¸èƒ½è¶…è¿‡ 4Kï¼ŒSessionå¯å­˜å‚¨æ•°æ®è¿œé«˜äºCookieã€‚ Session å¦‚ä½•å®ç°é€€å‡ºç™»å½•å‘¢ï¼Ÿéœ€è¦æ¸…é™¤æ‰ Session ä¸­çš„ç™»å½•çŠ¶æ€ï¼ŒåŒæ—¶ä¹Ÿéœ€è¦æ¸…é™¤æ‰ Cookie ä¸­çš„ SessionIdã€‚é‚£ä¹ˆå¦‚ä½•æ¸…é™¤ Cookie ä¸­çš„ SessionId å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥é€šè¿‡å°† Cookie çš„è¿‡æœŸæ—¶é—´è®¾ç½®ä¸ºä¸€ä¸ªè¿‡å»çš„æ—¶é—´æ¥å®ç°ã€‚ sessionçš„ç¼ºç‚¹ ä¾èµ–cookieï¼Œcookieè‡ªèº«å°±æœ‰å®‰å…¨æ¼æ´ï¼Œå¦‚æœcookieè¢«åŠ«æŒçš„è¯ï¼Œé»‘å®¢ä»ä¸­æ‹¿åˆ°äº†session IDï¼Œå†’å……ç”¨æˆ·ä¾æ—§æ˜¯ä¸ªæ¼æ´æ€ä¹ˆé¢„é˜²ï¼šâ—‹ ä½¿ç”¨ HTTPS åè®®åŠ å¯†ä¼ è¾“æ•°æ®ï¼Œå¯ä»¥æœ‰æ•ˆé˜²æ­¢ä¸­é—´äººæ”»å‡»å’Œé»‘å®¢çªƒå¬ã€‚â—‹ ç”Ÿæˆéšæœºä¸”å¤æ‚çš„ Session IDï¼Œå¹¶è®¾ç½®åˆç†çš„è¿‡æœŸæ—¶é—´ï¼Œé¿å…è¢«çŒœæµ‹æˆ–è€…é‡æ”¾æ”»å‡»ã€‚â—‹ ä¸è¦åœ¨ URL ä¸­ä½¿ç”¨ Session IDï¼Œé¿å…ä¼šè¯å›ºå®šæ”»å‡»ã€‚â—‹ å®šæœŸæ›´æ¢ Session IDï¼Œä»¥ä¿è¯ä¼šè¯å®‰å…¨æ€§ã€‚ ä¾èµ–cookieï¼Œå®¢æˆ·ç«¯å¯èƒ½ä¸æ”¯æŒcookieæ€ä¹ˆè§£å†³ï¼šâ—‹ URL é‡å†™ Sessionï¼Œæ˜¯ä¸€ç§åœ¨ URL ä¸­ä¼ é€’ Session ID çš„æ–¹å¼ï¼Œç¼ºç‚¹æ˜¯æ”¾åœ¨URLä¸­æ˜¯ä¸å®‰å…¨çš„ï¼Œä»¥ä¸ºæ˜¯æ˜æ–‡ä¼ è¾“ æœåŠ¡ç«¯ Session éœ€è¦åœ¨æœåŠ¡ç«¯ç»´æŠ¤ï¼Œéœ€è¦æ‰¾åœ°æ–¹ä¿å­˜å®ƒï¼Œåˆè¦è€ƒè™‘åˆ†å¸ƒå¼çš„é—®é¢˜ï¼Œç”šè‡³è¦å•ç‹¬ä¸ºäº†å®ƒå¯ç”¨ä¸€å¥— Redis é›†ç¾¤ã€‚ JWT Tokenä»€ä¹ˆæ˜¯jwt tokenä¸€ç§åŸºäº Token çš„èº«ä»½è®¤è¯æœºåˆ¶ï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯æ— çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä¸éœ€è¦åœ¨æœåŠ¡ç«¯ä¿å­˜ä¼šè¯ä¿¡æ¯ï¼Œä¹Ÿä¸éœ€è¦åœ¨å®¢æˆ·ç«¯ä¿å­˜ä¼šè¯çŠ¶æ€ã€‚è¿™é‡Œçš„JWT å°±æ˜¯ä¸€ä¸ªä»¤ç‰Œï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬åœ¨ä¼ é€’çš„ token å­—ç¬¦ä¸²ã€‚ æµç¨‹ é¦–å…ˆç”¨æˆ·é€šè¿‡è´¦å·å’Œå¯†ç å‘æœåŠ¡å™¨è¯·æ±‚ç™»å½•ã€‚ æœåŠ¡ç«¯æ ¡éªŒç”¨æˆ·èº«ä»½åï¼Œç”Ÿæˆä¸€ä¸ª Tokenï¼Œç„¶åå°† Token è¿”å›ç»™å®¢æˆ·ç«¯ã€‚ å®¢æˆ·ç«¯éœ€è¦åœ¨æœ¬åœ°ä¿å­˜è¿™ä¸ª Tokenï¼Œä»¥ä¾¿åç»­çš„è¯·æ±‚æºå¸¦ Tokenã€‚ å®¢æˆ·ç«¯å¯ä»¥åœ¨æœ¬åœ°å­˜å‚¨æˆ– sessionStorage ä¸­ä¿å­˜ Tokenï¼Œä¹Ÿå¯ä»¥åœ¨ Cookie ä¸­ä¿å­˜ Tokenã€‚ å®¢æˆ·ç«¯åœ¨åç»­è¯·æ±‚ä¸­ï¼Œéƒ½éœ€è¦å°† Token å‘é€ç»™æœåŠ¡å™¨éªŒè¯ã€‚ä¸€èˆ¬å°† Token æ”¾åœ¨ HTTP è¯·æ±‚å¤´çš„ Authorization å­—æ®µä¸­ï¼Œå‘é€ç»™æœåŠ¡å™¨ã€‚Bearer [Token] æœåŠ¡ç«¯åœ¨æ¥æ”¶åˆ°è¯·æ±‚åï¼Œä¼šä» Authorization å­—æ®µä¸­è·å– Tokenï¼Œå¹¶éªŒè¯ token æ˜¯å¦æœ‰æ•ˆï¼Œç­¾åæ˜¯å¦æ­£ç¡®ï¼Œæ˜¯å¦è¿‡æœŸç­‰ã€‚é€šè¿‡åï¼Œå†è¿›è¡Œå“åº”ã€‚ jwtçš„ç”Ÿæˆè¿‡ç¨‹jwtåˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼šheaderï¼ˆå¤´éƒ¨ï¼‰ã€payloadï¼ˆè½½è·ï¼‰å’Œ signatureï¼ˆç­¾åï¼‰header:å®šäº†ç”¨äºç”Ÿæˆç­¾åçš„ç®—æ³•payload:æ”¾äº†ä¸€äº›è¿‡æœŸæ—¶é—´ï¼Œç”¨æˆ·çš„ç›¸å…³ä¿¡æ¯æˆ–å…¶ä»–ä¸šåŠ¡éœ€è¦çš„å¿…è¦ä¿¡æ¯ï¼Œä½†ä¸å»ºè®®æ·»åŠ æ•æ„Ÿä¿¡æ¯ï¼Œå› ä¸ºè¯¥éƒ¨åˆ†åœ¨å®¢æˆ·ç«¯å¯è§£å¯†ã€‚signatureï¼šç„¶åç”¨headerä¸­æŒ‡å®šçš„ç®—æ³•å¯¹å‰ä¸¤éƒ¨åˆ†çš„base64+ç§é’¥ï¼ˆè¿™ä¸ªå¯†é’¥åªæœ‰æœåŠ¡å™¨æ‰èƒ½çŸ¥é“ï¼Œä¸èƒ½æ³„éœ²ç»™ç”¨æˆ·ï¼‰è¿›è¡Œç­¾å jwtå¦‚ä½•é˜²æ­¢è¢«ç¯¡æ”¹åœ¨æ•´ä¸ª JWT è®¤è¯æµç¨‹ä¸­ï¼ŒæœåŠ¡ç«¯åœ¨æ”¶åˆ°å®¢æˆ·ç«¯è¯·æ±‚å¤´ä¸­æºå¸¦çš„ token æ—¶ï¼Œä¼šä½¿ç”¨ç›¸åŒçš„å¯†é’¥å’Œç®—æ³•å¯¹tokenè¿›è¡Œè§£ç ï¼Œç„¶åä½¿ç”¨ç›¸åŒçš„ç®—æ³•ï¼Œå°† header å’Œ payload ä»¥åŠ secret ç§é’¥è¿›è¡Œç­¾åï¼Œç„¶åå’Œ token ä¸­åŸæœ‰çš„ç­¾åè¿›è¡Œå¯¹æ¯”ï¼Œå¦‚æœä¸€è‡´ï¼Œè¯´æ˜ token æ²¡æœ‰è¢«ç¯¡æ”¹ï¼Œå¦‚æœä¸ä¸€è‡´ï¼Œè¯´æ˜ token è¢«ç¯¡æ”¹äº†ã€‚ æ— è®ºåˆ«äººçŸ¥é“å¤šå°‘æˆ‘ä»¬åœ¨ä¼ è¾“çš„ä¿¡æ¯ï¼Œç¯¡æ”¹å’Œä¼ªé€ åéƒ½ä¸èƒ½é€šè¿‡æœåŠ¡å™¨çš„éªŒè¯ï¼Œæ˜¯å› ä¸ºæ— æ³•è·å–æœåŠ¡å™¨çš„å¯†é’¥ secretï¼ŒçœŸæ­£èƒ½ä¿è¯å®‰å…¨çš„å°±æ˜¯ secret jwtå¦‚ä½•é€€å‡ºç™»å½•åœ¨ç”¨æˆ·æ³¨é”€ç™»å½•åï¼Œä¼šæŠŠç”¨æˆ· token å­˜åˆ° token åˆ—è¡¨ä¸­ï¼Œå½“è¿™ä¸ª token å†æ¬¡è¢«ç”¨æ¥è¯·æ±‚æ—¶ï¼Œå°±ä¼šå‘½ä¸­é»‘åå•ï¼Œè€Œè¢«æ‹’ç»è¯·æ±‚ jwtå­˜å‚¨åœ¨å®¢æˆ·ç«¯å¦‚ä½•é˜²æ­¢æœªé€€å‡ºç™»å½•çš„æ—¶å€™è¢«åŠ«æŒè¿˜æ²¡æœ‰é€€å‡ºç™»å½• token ä»ç„¶æœ‰æ•ˆï¼Œå¦‚æœ token æ³„éœ²äº†ï¼Œæ”»å‡»è€…å¯ä»¥ç›—ç”¨è¿™ä¸ª tokenæ¥å†’ç”¨èº«ä»½ã€‚ä½†æ˜¯å¯ä»¥åœ¨ JWT payload éƒ¨åˆ†åŠ ä¸Š IP ä¹‹ç±»çš„æ¥å¢å¼º token çš„å®‰å…¨æ€§ã€‚åŒæ—¶æ›´å®‰å…¨çš„åšæ³•æ˜¯ä½¿ç”¨ https åè®®æ¥ä¼ è¾“ token å¦‚ä½•å®ç°æ— æ„Ÿåˆ·æ–°ï¼Ÿåœ¨ç”¨æˆ·ç™»å½•çš„æ—¶å€™ï¼ŒæœåŠ¡ç«¯è¿”å›ä¸¤ä¸ª token ä¸€ä¸ªæ˜¯ accessTokenï¼Œç”¨æ¥åšç”¨æˆ·çš„é‰´æƒï¼Œè¿‡æœŸæ—¶é—´æ¯”è¾ƒçŸ­ï¼Œæ¯”å¦‚ 1 å°æ—¶ ä¸€ä¸ªæ˜¯ refreshTokenï¼Œç”¨æ¥åˆ·æ–° accessTokenï¼Œè¿‡æœŸæ—¶é—´æ¯”è¾ƒé•¿ï¼Œæ¯”å¦‚ 7 å¤©å®¢æˆ·ç«¯æŠŠè¿™ä¸¤ä¸ª token éƒ½å­˜åœ¨æœ¬åœ°ï¼Œæ¯æ¬¡è®¿é—®éƒ½å°† accessToken ä¼ ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯æ ¡éªŒ accessToken æœ‰æ•ˆåï¼Œå“åº”ã€‚å¦‚æœæœåŠ¡ç«¯æ ¡éªŒ accessTokenè¿‡æœŸåï¼Œé‚£ä¹ˆå°±éœ€è¦å°† refreshToken ä¼ ç»™æœåŠ¡ç«¯ï¼Œå¦‚æœ refreshToken æ˜¯æœ‰æ•ˆçš„ï¼Œé‚£ä¹ˆæœåŠ¡ç«¯å°±ä¼šè¿”å›ä¸€ä¸ªæ–°çš„ accessTokenï¼Œå®¢æˆ·ç«¯å°±å¯ä»¥ä½¿ç”¨æ–°çš„ accessToken ç»§ç»­è®¿é—®ã€‚å®¢æˆ·ç«¯éœ€è¦æ›´æ–°æœ¬åœ°çš„ accessTokenï¼Œè¿™æ ·å°±å®ç°äº†æ— æ„Ÿåˆ·æ–°ã€‚è¿™é‡Œä¸€å…±ä¼šå‘é€ 2 æ¬¡çš„ HTTP è¯·æ±‚ï¼Œç¬¬ä¸€æ¬¡è¿‡æœŸè¢«æ‹’ç»ï¼Œç¬¬äºŒæ¬¡åˆ·æ–° token","categories":[],"tags":[{"name":"ç½‘ç»œ","slug":"ç½‘ç»œ","permalink":"https://ashleyblog.xyz/tags/ç½‘ç»œ/"}]},{"title":"reactæ€§èƒ½ä¼˜åŒ–","slug":"reactæ€§èƒ½ä¼˜åŒ–","date":"2020-02-23T15:17:51.000Z","updated":"2023-04-16T03:16:42.971Z","comments":true,"path":"2020/02/23/reactæ€§èƒ½ä¼˜åŒ–/","link":"","permalink":"https://ashleyblog.xyz/2020/02/23/reactæ€§èƒ½ä¼˜åŒ–/","excerpt":"","text":"å‡å°‘æ¸²æŸ“çš„èŠ‚ç‚¹/é™ä½æ¸²æŸ“è®¡ç®—é‡0ï¸âƒ£ ä¸è¦åœ¨æ¸²æŸ“å‡½æ•°é‡Œé¢è¿›è¡Œä¸å¿…è¦çš„è®¡ç®— 1ï¸âƒ£ å‡å°‘ä¸å¿…è¦çš„åµŒå¥—ä¸€èˆ¬ä¸å¿…è¦çš„èŠ‚ç‚¹åµŒå¥—éƒ½æ˜¯æ»¥ç”¨é«˜é˜¶ç»„ä»¶/RenderProps å¯¼è‡´çš„ æœ‰å¾ˆå¤šç§æ–¹å¼æ¥ä»£æ›¿é«˜é˜¶ç»„ä»¶/RenderPropsï¼Œä¾‹å¦‚ä¼˜å…ˆä½¿ç”¨ propsã€React Hooks 2ï¸âƒ£ è™šæ‹Ÿåˆ—è¡¨å®ç°æ–¹æ¡ˆï¼š1.intersectionobserveråªæ¸²æŸ“åœ¨å¯è§†åŒºçš„å†…å®¹åªè§‚å¯Ÿç¬¬ä¸€ä¸ªè·Ÿæœ€åä¸€ä¸ªå…ƒç´ ï¼Œæ¯”å¦‚ä¸€ä¸ªlistï¼Œå½“æœ€åä¸€ä¸ªå…ƒç´ è¿›å…¥å¯è§†åŒºçš„æ—¶å€™ï¼Œæ¸²æŸ“çš„ç¬¬ä¸€ä¸ªå…ƒç´ å˜æˆæœ€åä¸€ä¸ªå…ƒç´ çš„ä¸‹ä¸€ä¸ªå…ƒç´ 2.æ»šåŠ¨åŠ è½½ 3ï¸âƒ£ æƒ°æ€§åŠ è½½ ç²¾ç»†åŒ–æ¸²æŸ“ ç®€åŒ– propsâ‘  å¦‚æœä¸€ä¸ªç»„ä»¶çš„ props å¤ªå¤æ‚ä¸€èˆ¬æ„å‘³ç€è¿™ä¸ªç»„ä»¶å·²ç»è¿èƒŒäº†â€˜å•ä¸€èŒè´£â€™ï¼Œé¦–å…ˆåº”è¯¥å°è¯•å¯¹ç»„ä»¶è¿›è¡Œæ‹†è§£.â‘¡ å¦å¤–å¤æ‚çš„ props ä¹Ÿä¼šå˜å¾—éš¾ä»¥ç»´æŠ¤, æ¯”å¦‚ä¼šå½±å“shallowCompareæ•ˆç‡, è¿˜ä¼šè®©ç»„ä»¶çš„å˜åŠ¨å˜å¾—éš¾ä»¥é¢„æµ‹å’Œè°ƒè¯•. hooksä¼˜åŒ– useStateåˆå§‹åŒ–æƒ°æ€§å‡½æ•°12345function Table(props) &#123; // âš ï¸ createRows() æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šè¢«è°ƒç”¨ const [rows, setRows] = useState(createRows(props.count)); // ...&#125; ä¸ºé¿å…é‡æ–°åˆ›å»ºè¢«å¿½ç•¥çš„åˆå§‹ stateï¼Œæˆ‘ä»¬å¯ä»¥ä¼ ä¸€ä¸ª å‡½æ•° ç»™ useStateï¼š 12345function Table(props) &#123; // âœ… createRows() åªä¼šè¢«è°ƒç”¨ä¸€æ¬¡ const [rows, setRows] = useState(() =&gt; createRows(props.count)); // ...&#125; å½“initialStateä»¥å‡½æ•°å½¢å¼ä¼ å…¥æ—¶ï¼Œå®ƒåªä¼šåœ¨å‡½æ•°ç»„ä»¶åˆå§‹åŒ–çš„æ—¶å€™æ‰§è¡Œä¸€æ¬¡ï¼Œå‡½æ•°re-renderæ—¶ä¸ä¼šå†è¢«æ‰§è¡Œ ä»¥ä¸Šå°šå¾…è€ƒç©¶ï¼› 1useState(props.value) å¹¶ä¸ä¼šéšç€propsçš„å˜åŒ–è€Œå˜åŒ–ï¼Œåˆå§‹åŒ–å€¼åªä¼šåˆå§‹ä¸€æ¬¡,åŒæ ·çš„useRefä¹Ÿæ˜¯ä¸€æ · ä¼˜åŒ–keyé™¤äº†ä»¥ä¸‹çš„æƒ…å†µä¸ä½¿ç”¨indexä½œä¸ºkey:åˆ—è¡¨çš„é‡æ–°æ’åºï¼Œå¢åˆ ï¼Œè¿‡æ»¤ä¸ä¼šå‘ç”Ÿ å‡å°‘re-renderå“ªäº›åŸå› ä¼šå¯¼è‡´rerender çŠ¶æ€æ›´æ”¹ å½“ç»„ä»¶çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå®ƒå°†é‡æ–°æ¸²æŸ“è‡ªèº«ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç±»ç»„ä»¶çš„stateè¢«é‡å¤è®¾ç½®æˆåŒä¸€ä¸ªå€¼ä¼šå¯¼è‡´é‡æ–°æ¸²æŸ“ï¼Œä½†æ˜¯å‡½æ•°ç»„ä»¶ä¸ä¼šã€‚ çˆ¶çº§ï¼ˆæˆ–å­çº§ï¼‰é‡æ–°æ¸²æŸ“ æ³¨æ„æ˜¯çˆ¶ç»„ä»¶çš„é‡æ–°æ¸²æŸ“è§¦å‘äº†å­ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ï¼Œä¸å­ç»„ä»¶çš„ props æ˜¯å¦å˜åŒ–æ— å…³ã€‚åªæœ‰é‚£äº›ä½¿ç”¨äº† React.memo å’Œ useMemo çš„ç»„ä»¶ï¼Œprops çš„å˜åŒ–æ‰ä¼šè§¦å‘ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ã€‚ context å˜åŒ– hooks å˜åŒ–ã€‚ hooks å†…éƒ¨çš„çŠ¶æ€å˜åŒ–ä¼šè§¦å‘ç»„ä»¶çš„ re-render å¦‚æœ hooks ä½¿ç”¨äº† contextï¼Œå¹¶ä¸” context çš„å€¼å‘ç”Ÿäº†å˜åŒ–ï¼Œä¹Ÿä¼šè§¦å‘ç»„ä»¶çš„ re-render æ€ä¹ˆé¿å…re-render é¿å…åœ¨ render å‡½æ•°ä¸­åˆ›å»ºç»„ä»¶ï¼ŒåŸå› å¦‚ä¸‹ï¼šåœ¨æ¯æ¬¡é‡æ–°æ¸²æŸ“æ—¶ï¼ŒReact éƒ½ä¼šé‡æ–°è£…è½½è¿™ä¸ªç»„ä»¶ï¼ˆå³é”€æ¯å®ƒå¹¶ä»å¤´å¼€å§‹é‡æ–°åˆ›å»ºï¼‰ï¼Œè¿™æ¯”æ­£å¸¸çš„é‡æ–°æ¸²æŸ“è¦æ…¢å¾—å¤šã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜ä¼šå¯¼è‡´ä»¥ä¸‹é—®é¢˜ï¼š åœ¨é‡æ–°æ¸²æŸ“æœŸé—´å¯èƒ½å‡ºç°å†…å®¹ â€œé—ªçƒâ€ æ¯æ¬¡é‡æ–°æ¸²æŸ“æ—¶åœ¨ç»„ä»¶çš„çŠ¶æ€ä¼šè¢«é‡ç½® æ¯æ¬¡é‡æ–°æ¸²æŸ“æ—¶ä¸ä¼šè§¦å‘ä¾èµ–é¡¹çš„ useEffect å¦‚æœç»„ä»¶è¢«èšç„¦ï¼Œåˆ™ç„¦ç‚¹å°†ä¸¢å¤± state ä¸‹ç§»åˆ°å­ç»„ä»¶ä¸­ ç»„ä»¶ä½œä¸º props ä¸å‰é¢çš„æ¨¡å¼åŸºæœ¬ç›¸åŒï¼Œå°†çŠ¶æ€å°è£…åœ¨ä¸€ä¸ªè¾ƒå°çš„ç»„ä»¶ä¸­ï¼Œè€Œè¾ƒé‡çš„ç»„ä»¶ä½œä¸º props ä¼ é€’ç»™å®ƒã€‚props ä¸å— state å˜åŒ–çš„å½±å“ï¼Œå› æ­¤è¯¥è¾ƒé‡çš„ç»„ä»¶ä¸ä¼šè¢«é‡æ–°æ¸²æŸ“ ä½¿ç”¨ React.memo å¸¸è§è¯¯åŒº æ— ç”¨çš„ useMemo/useCallback propså°†å­ç»„ä»¶çš„ props åŒ…è£…æˆ memoize å€¼ï¼Œæ˜¯ä¸èƒ½é¿å…è¯¥å­ç»„ä»¶é‡æ–°æ¸²æŸ“çš„ã€‚åªè¦çˆ¶ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼Œé‚£ä¹ˆå­ç»„ä»¶å°±ä¼šè¢«é‡æ–°æ¸²æŸ“ï¼Œä¸ props æ²¡æœ‰å…³ç³»ã€‚è¿™ä¸ªæ—¶å€™å°±éœ€è¦ç”¨åˆ°React.Memoäº† é”™è¯¯åšæ³• æ­£ç¡®åšæ³• æ­£ç¡®ä½¿ç”¨keyå¦‚æœåˆ—è¡¨é¡¹æ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œçˆ¶ç»„ä»¶é‡æ–°æ¸²æŸ“äº†,ä»…ä»…è®¾ç½® key å€¼å¹¶ä¸ä¼šæé«˜åˆ—è¡¨çš„æ€§èƒ½ã€‚ä¸ºäº†é¿å…åˆ—è¡¨å…ƒç´ çš„é‡æ–°æ¸²æŸ“ï¼Œè¿˜è¦ç”¨ React.memo åŒ…è£…å®ƒä»¬ é¿å… Context å¼•èµ· re-render å°† Provider çš„å€¼åš memoize å¤„ç† å¦‚æœ Context Provider æ²¡æœ‰åœ¨é¡µé¢çš„æ ¹èŠ‚ç‚¹ä¸Šï¼Œé‚£ä¹ˆç¥–å…ˆèŠ‚ç‚¹çš„å˜åŒ–ä¹Ÿä¼šå¯¼è‡´å®ƒè¢«é‡æ–°æ¸²æŸ“ï¼Œæ‰€ä»¥å®ƒçš„å€¼ä¹Ÿåº”è¯¥è¢« memoizeã€‚ å¯¹æ•°æ®å’Œ API åšæ‹†åˆ† @rematch/coreä½¿ç”¨æ—¶ï¼šuseContextï¼Œæ— éœ€åœ¨æ ¹ç»„ä»¶åŒ…è£¹storeï¼Œåªéœ€è¦ 1init(&#123; models: &#123; global &#125; &#125;); ä½¿ç”¨createPortalåˆ›å»ºçš„ç»„ä»¶Aï¼Œæ’å…¥åˆ°ä¸€ä¸ªdomèŠ‚ç‚¹ï¼ŒdomèŠ‚ç‚¹æ‰€åœ¨çš„ç»„ä»¶è¢«é‡æ–°æ¸²æŸ“çš„è¯ï¼Œæ˜¯ä¸ä¼šå¼•å‘ç»„ä»¶Açš„é‡æ–°æ¸²æŸ“çš„ã€‚ contextä¼˜åŒ– æ‹†åˆ†context useMemo React.memoåšç¼“å­˜ å€Ÿé‰´reduxçš„å‘å¸ƒè®¢é˜…æ¨¡å¼ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354// providerconst Provider = (&#123; children &#125;) =&gt; &#123; const [store, dispatch] = useReducer(reducer, initState); const storeRef = useRef(null); storeRef.current = store; // è®¢é˜…æ‰€æœ‰å­ç»„ä»¶æ›´æ–°çš„å›è°ƒå‡½æ•° const subscribeRef = useRef([]); // storeå˜åŒ–çš„æ—¶å€™æ‰§è¡Œæ‰€æœ‰çš„ç›‘å¬å‡½æ•° useEffect(() =&gt; &#123; subscribeRef.current.forEach((sub) =&gt; sub()); &#125;, [store]); // ç¼“å­˜value åˆ©ç”¨refæ‹¿åˆ°æœ€æ–°çš„çŠ¶æ€ const value = useMemo( () =&gt; (&#123; dispatch, subscribe: (cb) =&gt; &#123; subscribeRef.current.push(cb); // return unsubscribe return () =&gt; &#123; subscribeRef.current = subscribeRef.current.filter( (item) =&gt; item !== cb ); &#125;; &#125;, getState: () =&gt; storeRef.current, &#125;), [] ); // valueæ­¤åéƒ½ä¸ä¼šå˜åŒ–äº† åªæœ‰storeå˜åŒ– storeå˜åŒ–çš„æ—¶å€™é€šçŸ¥æ‰€æœ‰çš„æ¶ˆè´¹è€… return &lt;MyContext.Provider value=&#123;value&#125; children=&#123;children&#125; /&gt;;&#125;;// useSelectorexport const useSelector = (selector) =&gt; &#123; const [, forceRender] = useReducer((s) =&gt; s + 1, 0); const store = useContext(Mycontext); // è·å–state const selectedStateRef = useRef(null); selectedStateRef.current = selector(store.getState()); // æ›´æ–°å›è°ƒ å¯¹æ¯”æ›´æ–°åçš„state const checkUpdates = useCallback(() =&gt; &#123; const newState = selector(store.getState()); if (newState !== selectedStateRef.current) &#123; forceRender(); &#125; &#125;, []); // mountedçš„æ—¶å€™è®¢é˜…store useEffect(() =&gt; &#123; const unsubscribe = store.subscribe(checkUpdates); // å¸è½½çš„æ—¶å€™å–æ¶ˆè®¢é˜… return unsubscribe; &#125;, [store, checkUpdates]); // è¿”å›æœ€æ–°çš„state return selectedStateRef.current;&#125;; useDispatchä½¿ç”¨ï¼š å‚è€ƒ (ä¸€ä»½è¯¦å°½çš„ React re-render æŒ‡å—)[https://mp.weixin.qq.com/s/SH7N2f5ZhUhysQ7_G2s9rQ]","categories":[],"tags":[{"name":"react","slug":"react","permalink":"https://ashleyblog.xyz/tags/react/"},{"name":"æ€§èƒ½ä¼˜åŒ–","slug":"æ€§èƒ½ä¼˜åŒ–","permalink":"https://ashleyblog.xyz/tags/æ€§èƒ½ä¼˜åŒ–/"}]},{"title":"webpackæ‰“åŒ…äº§ç‰©ä¼˜åŒ–","slug":"webpackæ‰“åŒ…äº§ç‰©ä¼˜åŒ–","date":"2020-02-15T09:23:18.000Z","updated":"2023-04-16T03:23:42.010Z","comments":true,"path":"2020/02/15/webpackæ‰“åŒ…äº§ç‰©ä¼˜åŒ–/","link":"","permalink":"https://ashleyblog.xyz/2020/02/15/webpackæ‰“åŒ…äº§ç‰©ä¼˜åŒ–/","excerpt":"","text":"ä½“ç§¯æ›´å° åˆç†åˆ†åŒ…ï¼Œä¸é‡å¤åŠ è½½ åŠ è½½é€Ÿåº¦æ›´å¿« å‡å°‘ä½“ç§¯å¼€å¯tree shaking ä»€ä¹ˆæ˜¯tree shakingï¼Ÿä»–ä¼šåœ¨æ‰“åŒ…è¿‡ç¨‹ä¸­é€šè¿‡é™æ€åˆ†ææ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»ä»è€Œç¡®å®šå“ªäº›æ¨¡å—å¯¼å‡º/å¼•å…¥çš„å€¼æ²¡æœ‰è¢«ä½¿ç”¨ï¼Œä»è€Œå°†å®ƒåˆ é™¤ï¼ŒWebpack 4ç”Ÿäº§ç¯å¢ƒå·²ç»é»˜è®¤å¼€å¯äº†è¿™ä¸ªåŠŸèƒ½ï¼Œæ— éœ€å…¶ä»–é…ç½®ã€‚ å‡å°‘Babelç¼–è¯‘åçš„äº§ç‰©ä½“ç§¯Babel ä¸ºç¼–è¯‘çš„æ¯ä¸ªæ–‡ä»¶éƒ½æ’å…¥äº†è¾…åŠ©ä»£ç ï¼Œä½¿ä»£ç ä½“ç§¯è¿‡å¤§ï¼Œä½ å¯ä»¥å°†è¿™äº›è¾…åŠ©ä»£ç ä½œä¸ºä¸€ä¸ªç‹¬ç«‹æ¨¡å—ï¼Œæ¥é¿å…é‡å¤å¼•å…¥ã€‚@babel/plugin-transform-runtimeçš„ä½œç”¨: ç¦ç”¨äº† Babel è‡ªåŠ¨å¯¹æ¯ä¸ªæ–‡ä»¶çš„ runtime æ³¨å…¥ï¼Œè€Œæ˜¯å¼•å…¥ @babel/plugin-transform-runtime å¹¶ä¸”ä½¿æ‰€æœ‰è¾…åŠ©ä»£ç ä»è¿™é‡Œå¼•ç”¨ æŒ‰éœ€åŠ è½½ä½¿ç”¨importæ–¹å¼æ‡’åŠ è½½ç»„ä»¶ 1234567// index.jssetTimeout(() =&gt; &#123; // ç›´æ¥ä½¿ç”¨importå¯¼å…¥å³å¯ï¼Œè¿™æ ·åŠ è½½çš„æ¨¡å—ï¼Œç›¸å½“äºä¸€ä¸ªç‹¬ç«‹çš„chunkå­˜åœ¨ import('./common/dynamicData.js').then(res =&gt; &#123; console.log(res.default.msg); &#125;)&#125;, 1000) æå–å…¬å…±ä»£ç åœ¨optimizationä¸­é…ç½®splitChunkså±æ€§ï¼Œè®¾ç½®cacheGroupsåˆ†ç»„ï¼Œä¸€èˆ¬åˆ†ä¸ºä¸¤ä¸ªç»„ï¼šverdorsï¼ˆç”¨äºæå–ç¬¬ä¸‰æ–¹åº“ï¼‰å’Œcommonï¼ˆç”¨äºæå–è‡ªå®šä¹‰çš„å…¬å…±æ¨¡å—ï¼‰é’ˆå¯¹ç¬¬ä¸‰æ–¹åº“ï¼Œå‡ ä¹ä¸ä¼šæ”¹å˜ï¼Œæå–å‡ºæ¥åï¼Œæ”¹åŠ¨ä¸šåŠ¡ä»£ç ä¸ä¼šåŠ¨åˆ°ç¬¬ä¸‰æ–¹åº“çš„æ‰“åŒ…æ–‡ä»¶ï¼Œè¿™æ ·ï¼Œå°±èƒ½å‘½ä¸­ç¼“å­˜ï¼ŒåŠ å¿«åŠ è½½é€Ÿåº¦é’ˆå¯¹å…¬å…±æ¨¡å—ï¼Œåªç”¨åŠ è½½ä¸€æ¬¡ï¼Œå°±å¯ä»¥åœ¨å¤šä¸ªæ¨¡å—ä¸­ä½¿ç”¨ 12345678910111213141516171819202122232425// webpack.prod.js optimization: &#123; splitChunks: &#123; chunks: 'all', // è¡¨ç¤ºè¦åˆ†å‰²çš„chunkç±»å‹ï¼šinitialåªå¤„ç†åŒæ­¥çš„; asyncåªå¤„ç†å¼‚æ­¥çš„ï¼›alléƒ½å¤„ç† // ç¼“å­˜åˆ†ç»„ cacheGroups: &#123; // ç¬¬ä¸‰æ–¹æ¨¡å— verdors: &#123; name: 'verdor', // chunkåç§° test: /node_modules/, // è®¾ç½®å‘½ä¸­ç›®å½•è§„åˆ™ priority: 1, // ä¼˜å…ˆçº§ï¼Œæ•°å€¼è¶Šå¤§ï¼Œä¼˜å…ˆçº§è¶Šé«˜ minSize: 0, // å°äºè¿™ä¸ªå¤§å°çš„æ–‡ä»¶ï¼Œä¸åˆ†å‰² minChunks: 1 // æœ€å°‘å¤ç”¨å‡ æ¬¡ï¼Œè¿™é‡Œæ„æ€æ˜¯åªè¦ç”¨è¿‡ä¸€æ¬¡å°±åˆ†å‰²å‡ºæ¥ &#125;, // å…¬å…±æ¨¡å— common: &#123; name: 'common', minChunks: 2, priority: 0, minSize: 0, minChunks: 2 // åªè¦å¼•ç”¨è¿‡2æ¬¡ï¼Œå°±åˆ†å‰²æˆå…¬å…±ä»£ç  &#125; &#125; &#125; &#125; å¿½ç•¥æŸäº›åº“ä¸éœ€è¦çš„æ¨¡å—æ¯”å¦‚å›½é™…åŒ–é¡¹ç›®æ‰€æœ‰åœ°åŒºè¯­è¨€åŒ…éƒ½ä¼šä¸æ ¸å¿ƒåº“ä¸€èµ·æ‰“åŒ…ï¼Œå¦‚æœæˆ‘ä»¬åªè¦å°‘æ•°å‡ ç§è¯­è¨€ï¼Œå¯ä»¥ä½¿ç”¨IgnorePluginå¿½ç•¥æ‰ä¸€äº›åœ°åŒºè¯­è¨€åŒ…, httpè¯·æ±‚ä¼˜åŒ– å°å›¾ç‰‡base64ç¼–ç é€šè¿‡è®¾ç½®url-loaderçš„é˜€å€¼æ¥æ§åˆ¶ï¼Œå°äºé˜€å€¼çš„å›¾ç‰‡ä½¿ç”¨base64ç¼–ç ï¼Œä»¥æ­¤æ¥å‡å°‘httpè¯·æ±‚ ä½¿ç”¨ CDN åŠ é€Ÿåœ¨è¾“å‡ºæ–‡ä»¶é…ç½®ä¸­å°†CDNè·¯å¾„æ·»åŠ è‡³publicPathä¸­ï¼ˆé’ˆå¯¹jså’Œcssæ–‡ä»¶ï¼‰ï¼›é’ˆå¯¹å›¾ç‰‡ï¼Œä¹Ÿå¯ä»¥åœ¨loaderçš„é…ç½®ä¸­æ·»åŠ publicPath 1234567891011121314151617181920212223242526 output: &#123; // filename: 'bundle.[chunkhash].js', // è¾“å‡ºæ–‡ä»¶åï¼Œä¸€èˆ¬è¦åŠ ä¸Šhash filename: '[name].[contenthash:8].js', path: distPath, // è¾“å‡ºç›®å½• publicPath: 'http://cdn.xxx.com' &#125;,// æˆ–è€…æ˜¯å°†å›¾ç‰‡æ”¾åˆ°cdnä¸­module: &#123; rules: [ &#123; test: /\\.(jpg|png|jpeg|gif)$/, use: &#123; loader:'url-loader', options: &#123; limit: 8 * 1024, //é™åˆ¶ 8kb ä»¥ä¸‹ä½¿ç”¨base64 esMoudle: false, name: '[name]-[hash:10].[ext]', // æ‰“åŒ…åˆ°/imagesç›®å½•ä¸‹ // outputPath: 'images', // æœ‰äº†publicPathï¼Œä¼šè‡ªåŠ¨å¿½ç•¥outputPathï¼Œè¿™æ˜¯é’ˆå¯¹æ”¾åœ¨é™æ€èµ„æºæœåŠ¡å™¨ä¸Šçš„ç›®å½• publicPath: 'http://cdn.xxx.com' &#125; &#125; &#125; ]&#125; å……åˆ†åˆ©ç”¨ç¼“å­˜bundle åŠ  hash å€¼ç»™äº§å‡ºçš„æ–‡ä»¶å¢åŠ hashå€¼ï¼Œå½“å†…å®¹æ²¡æœ‰å˜åŒ–æ—¶ï¼Œç”Ÿæˆçš„æ–‡ä»¶åå°†ä¸ä¼šå˜åŒ–ï¼Œæµè§ˆå™¨å°±ä¼šåº”ç”¨ç¼“å­˜ï¼Œä»è€Œæå‡åŠ è½½é€Ÿåº¦å°†æ¥å¼€å‘æ—¶æˆ‘ä»¬å¯¹é™æ€èµ„æºä¼šä½¿ç”¨ç¼“å­˜æ¥ä¼˜åŒ–ï¼Œè¿™æ ·æµè§ˆå™¨ç¬¬äºŒæ¬¡è¯·æ±‚èµ„æºå°±èƒ½è¯»å–ç¼“å­˜äº†ï¼Œé€Ÿåº¦å¾ˆå¿«ã€‚ä½†æ˜¯è¿™æ ·çš„è¯å°±ä¼šæœ‰ä¸€ä¸ªé—®é¢˜, å¦‚æœä¸è®¾ç½®hash:å› ä¸ºå‰åè¾“å‡ºçš„æ–‡ä»¶åæ˜¯ä¸€æ ·çš„ï¼Œä¸€æ—¦å°†æ¥å‘å¸ƒæ–°ç‰ˆæœ¬ï¼Œå› ä¸ºæ–‡ä»¶åæ²¡æœ‰å˜åŒ–å¯¼è‡´æµè§ˆå™¨ä¼šç›´æ¥è¯»å–ç¼“å­˜ï¼Œä¸ä¼šåŠ è½½æ–°èµ„æºï¼Œé¡¹ç›®ä¹Ÿå°±æ²¡æ³•æ›´æ–°äº†ã€‚ åœ¨360æ˜¯é€šè¿‡æ›¿æ¢èµ„æºå‰é¢çš„é“¾æ¥æ”¾ä¸€ä¸ªhashå€¼æ¥å®ç°çš„ã€‚hashæœ‰ä¸‰ç§ï¼š hashï¼ˆwebpack4 æ˜¯ hashï¼‰ æ¯æ¬¡ä¿®æ”¹ä»»ä½•ä¸€ä¸ªæ–‡ä»¶ï¼Œæ‰€æœ‰æ–‡ä»¶åçš„ hash è‡³éƒ½å°†æ”¹å˜ã€‚æ‰€ä»¥ä¸€æ—¦ä¿®æ”¹äº†ä»»ä½•ä¸€ä¸ªæ–‡ä»¶ï¼Œæ•´ä¸ªé¡¹ç›®çš„æ–‡ä»¶ç¼“å­˜éƒ½å°†å¤±æ•ˆã€‚ chunkhash chunkhashæ ¹æ®ä¸åŒçš„å…¥å£æ–‡ä»¶(entry)è¿›è¡Œä¾èµ–æ–‡ä»¶è§£æã€æ„å»ºå¯¹åº”çš„chunkï¼Œç”Ÿæˆå¯¹åº”çš„å“ˆå¸Œå€¼ã€‚å½“æŸä¸ªæ–‡ä»¶å†…å®¹å‘ç”Ÿå˜åŠ¨æ—¶ï¼Œå†æ¬¡æ‰§è¡Œæ‰“åŒ…ï¼Œåªæœ‰è¯¥æ–‡ä»¶ä»¥åŠä¾èµ–è¯¥æ–‡ä»¶çš„æ–‡ä»¶çš„æ‰“åŒ…ç»“æœ hash å€¼ä¼šå‘ç”Ÿæ”¹å˜ã€‚æ¯”å¦‚ï¼šåœ¨ index.js ä¸­å¼•ç”¨äº† index.css ï¼Œæ‰“åŒ…åä»–ä»¬å±äºä¸€ä¸ªæ¨¡å—ï¼Œhashå€¼ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚å½“JSæ–‡ä»¶å˜åŒ–çš„æ—¶å€™ï¼Œcssæ–‡ä»¶çš„hashä¹Ÿä¼šå˜åŒ– contenthash æ ¹æ®æ–‡ä»¶å†…å®¹ç”Ÿæˆ hash å€¼ï¼Œåªæœ‰æ–‡ä»¶å†…å®¹å˜åŒ–äº†ï¼Œhash å€¼æ‰ä¼šå˜åŒ–ã€‚æ‰€æœ‰æ–‡ä»¶ hash å€¼æ˜¯ç‹¬äº«ä¸”ä¸åŒçš„ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œæˆ‘ä»¬å¯¹ output ä¸­æ‰“åŒ…çš„æ–‡ä»¶åä¸€èˆ¬é‡‡ç”¨ chunkhashï¼Œå¯¹äº css ç­‰æ ·å¼æ–‡ä»¶ï¼Œé‡‡ç”¨ contenthashï¼Œè¿™æ ·å¯ä»¥ä½¿å¾—å„ä¸ªæ¨¡å—æœ€å°èŒƒå›´çš„æ”¹å˜æ‰“åŒ… hash å€¼ã€‚","categories":[],"tags":[{"name":"webpack","slug":"webpack","permalink":"https://ashleyblog.xyz/tags/webpack/"}]},{"title":"webpackæ„å»ºé€Ÿåº¦ä¼˜åŒ–","slug":"webpackæ„å»ºé€Ÿåº¦ä¼˜åŒ–","date":"2020-02-13T09:51:57.000Z","updated":"2023-04-16T03:23:42.010Z","comments":true,"path":"2020/02/13/webpackæ„å»ºé€Ÿåº¦ä¼˜åŒ–/","link":"","permalink":"https://ashleyblog.xyz/2020/02/13/webpackæ„å»ºé€Ÿåº¦ä¼˜åŒ–/","excerpt":"","text":"webpackæ‰“åŒ…åŸç†å›é¡¾ è§£æå…¥å£æ–‡ä»¶ï¼šWebpack ä¼šä»é…ç½®æ–‡ä»¶ä¸­è¯»å–å…¥å£æ–‡ä»¶çš„è·¯å¾„ï¼Œç„¶åè§£æå…¥å£æ–‡ä»¶ï¼Œå¦‚æœå…¥å£æ–‡ä»¶å¼•å…¥äº†åˆ«çš„æ–‡ä»¶ï¼Œwebpackå°±è¦å…ˆå°†è¿™äº›æ–‡ä»¶ä¸€ä¸ªä¸€ä¸ªçš„è¯»å–å®Œæ¯•ï¼Œå½“ç„¶è¯»å–çš„ä»£ç é‡Œé¢å¯èƒ½æœ‰htmlã€cssç­‰æ ¼å¼ï¼Œæ‰€ä»¥webpackä¼šåˆ©ç”¨ä¸€äº›loaderå°†è¿™äº›æ ¼å¼è½¬æ¢æˆjsæ ¼å¼ï¼Œç”Ÿæˆä¸€ä¸ªæŠ½è±¡è¯­æ³•æ ‘ åŠ è½½æ¨¡å—ï¼šWebpack ä¼šæ ¹æ®ä¾èµ–å›¾ä¸­çš„ä¿¡æ¯ï¼Œé€’å½’åœ°åŠ è½½æ‰€æœ‰éœ€è¦çš„æ¨¡å—ã€‚å¯¹äºæ¯ä¸ªæ¨¡å—ï¼ŒWebpack ä¼šæ ¹æ®å…¶ç±»å‹ï¼ˆä¾‹å¦‚ JavaScriptã€CSSã€å›¾ç‰‡ç­‰ï¼‰ä½¿ç”¨ç›¸åº”çš„ loader è¿›è¡Œè½¬æ¢å’Œå¤„ç†ã€‚ åˆ†ææ¨¡å—é—´çš„ä¾èµ–å…³ç³»ï¼šWebpack ä¼šåˆ†ææ¯ä¸ªæ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œå¹¶ç”Ÿæˆä¸€å¼ ä¾èµ–å›¾è°±ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼ŒWebpack ä¼šç¡®å®šæ¯ä¸ªæ¨¡å—çš„æ‰§è¡Œé¡ºåºï¼Œå¹¶åˆ›å»ºä¸€ä¸ª chunkã€‚ ç”Ÿæˆè¾“å‡ºæ–‡ä»¶ï¼šæœ€åï¼ŒWebpack ä¼šæ ¹æ® chunk çš„ä¿¡æ¯ï¼Œç”Ÿæˆä¸€ä¸ªæˆ–å¤šä¸ªè¾“å‡ºæ–‡ä»¶ã€‚è¾“å‡ºæ–‡ä»¶å¯ä»¥æ˜¯ JavaScript æ–‡ä»¶ã€CSS æ–‡ä»¶ã€å›¾ç‰‡æ–‡ä»¶ç­‰ã€‚å…³æ³¨åˆ°ä¸Šé¢çš„è¿‡ç¨‹ï¼Œå¯ä»¥å‘ç°ä¸»è¦ä¼˜åŒ–çš„å°±æ˜¯ç¬¬äºŒæ­¥ä»¥åŠç¬¬ä¸‰æ­¥æ‹†åˆ†å¤šå…¥å£webpackå¯¹äºå•å…¥å£æ–‡ä»¶ï¼Œæ¯ä¸ªå…¥å£æ–‡ä»¶æŠŠè‡ªå·±æ‰€ä¾èµ–çš„èµ„æºå…¨éƒ¨æ‰“åŒ…åˆ°ä¸€èµ·ï¼Œå³ä½¿ä¸€ä¸ªèµ„æºå¾ªç¯åŠ è½½çš„è¯ï¼Œä¹Ÿåªä¼šæ‰“åŒ…ä¸€ä»½ï¼Œå› æ­¤å¦‚æœæ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤§çš„åº”ç”¨çš„è¯ï¼Œå¯ä»¥æ‹†åˆ†æˆå¤šä¸ªå…¥å£ï¼Œè¿™é‡Œæ‹†åˆ†å¯ä»¥æ˜¯æŒ‰ç…§é¡µé¢æ‹†åˆ†æˆ–è€…ã€‚ã€‚ã€‚1234entry: &#123; minivideo: 'src/pages/miniVideo/index.jsx', minivideoHome: 'src/pages/home/index.jsx', &#125; æå–å…¬å…±åŒ…ä¸€ä¸ªå¤šé¡µé¢åº”ç”¨ï¼Œå¦‚æœæ‰€æœ‰çš„é¡µé¢éƒ½ä¾èµ–äºä¸€æ ·çš„åŸºç¡€åº“ï¼Œé‚£å¦‚æœæ‰€æœ‰çš„entryéƒ½åŒ…å«æœ‰åŸºç¡€åº“çš„ä»£ç å°±ä¼šé€ æˆæµªè´¹ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950// webpack.config.jsconst path = require(\"path\");const HtmlWebpackPlugin = require(\"html-webpack-plugin\");module.exports = &#123; // å•å…¥å£ // entry: './src/main.js', // å¤šå…¥å£ entry: &#123; main: \"./src/main.js\", app: \"./src/app.js\", &#125;, output: &#123; path: path.resolve(__dirname, \"./dist\"), // [name]æ˜¯webpackå‘½åè§„åˆ™ï¼Œä½¿ç”¨chunkçš„nameä½œä¸ºè¾“å‡ºçš„æ–‡ä»¶åã€‚ // ä»€ä¹ˆæ˜¯chunkï¼Ÿæ‰“åŒ…çš„èµ„æºå°±æ˜¯chunkï¼Œè¾“å‡ºå‡ºå»å«bundleã€‚ // chunkçš„nameæ˜¯å•¥å‘¢ï¼Ÿ æ¯”å¦‚ï¼š entryä¸­xxx: \"./src/xxx.js\", nameå°±æ˜¯xxxã€‚æ³¨æ„æ˜¯å‰é¢çš„xxxï¼Œå’Œæ–‡ä»¶åæ— å…³ã€‚ // ä¸ºä»€ä¹ˆéœ€è¦è¿™æ ·å‘½åå‘¢ï¼Ÿå¦‚æœè¿˜æ˜¯ä¹‹å‰å†™æ³•main.jsï¼Œé‚£ä¹ˆæ‰“åŒ…ç”Ÿæˆä¸¤ä¸ªjsæ–‡ä»¶éƒ½ä¼šå«åšmain.jsä¼šå‘ç”Ÿè¦†ç›–ã€‚(å®é™…ä¸Šä¼šç›´æ¥æŠ¥é”™çš„) filename: \"js/[name].js\", clean: true, &#125;, plugins: [ new HtmlWebpackPlugin(&#123; template: \"./public/index.html\", &#125;), ], mode: \"production\", optimization: &#123; // ä»£ç åˆ†å‰²é…ç½® splitChunks: &#123; chunks: \"all\", // å¯¹æ‰€æœ‰æ¨¡å—éƒ½è¿›è¡Œåˆ† // ä¿®æ”¹é…ç½® cacheGroups: &#123; // ç»„ï¼Œå“ªäº›æ¨¡å—è¦æ‰“åŒ…åˆ°ä¸€ä¸ªç»„ // defaultVendors: &#123; // ç»„å // test: /[\\\\/]node_modules[\\\\/]/, // éœ€è¦æ‰“åŒ…åˆ°ä¸€èµ·çš„æ¨¡å— // priority: -10, // æƒé‡ï¼ˆè¶Šå¤§è¶Šé«˜ï¼‰ // reuseExistingChunk: true, // å¦‚æœå½“å‰ chunk åŒ…å«å·²ä»ä¸» bundle ä¸­æ‹†åˆ†å‡ºçš„æ¨¡å—ï¼Œåˆ™å®ƒå°†è¢«é‡ç”¨ï¼Œè€Œä¸æ˜¯ç”Ÿæˆæ–°çš„æ¨¡å— // &#125;, default: &#123; // å…¶ä»–æ²¡æœ‰å†™çš„é…ç½®ä¼šä½¿ç”¨ä¸Šé¢çš„é»˜è®¤å€¼ minSize: 0, // æˆ‘ä»¬å®šä¹‰çš„æ–‡ä»¶ä½“ç§¯å¤ªå°äº†ï¼Œæ‰€ä»¥è¦æ”¹æ‰“åŒ…çš„æœ€å°æ–‡ä»¶ä½“ç§¯ minChunks: 2, priority: -20, reuseExistingChunk: true, &#125;, &#125;, &#125;, &#125;,&#125;; å‡å°‘ä¾èµ–å¤„ç†æ—¶é—´ CDNåˆ†åŒ…ä¹‹å‰å¯¹æ‰“åŒ…ä½“ç§¯è¿›è¡Œåˆ†æçš„æ—¶å€™ï¼Œå‘ç°react-domã€reactæ˜¯å æ®ä½“ç§¯éå¸¸å¤§çš„å‡ ä¸ªåŒ…ï¼Œåœ¨æ‰“åŒ…è¿™äº›åŒ…çš„æ—¶å€™å°±éå¸¸è€—æ—¶ã€‚cdnåˆ†åŒ…å¯ä»¥è®©æˆ‘ä»¬åœ¨æ‰“åŒ…è¿‡ç¨‹ä¸­å°†ç‰¹å®šåŒ…åˆ†ç¦»å‡ºæ¥ï¼Œä»è€Œæå‡æ‰“åŒ…é€Ÿåº¦ã€‚æ’é™¤éƒ¨åˆ†åº“çš„æ‰“åŒ…éœ€è¦å€ŸåŠ©html-webpack-externals-plugin æ’ä»¶å‡å°‘loaderè§£æè½¬æ¢æ—¶é—´ æ‰“åŒ…é€Ÿåº¦åˆ†æï¼š 1yarn add speed-measure-webpack-plugin -D æˆ‘ä»¬å€ŸåŠ© speed-measure-webpack-plugin æ’ä»¶ï¼Œå®ƒåˆ†æ webpack çš„æ€»æ‰“åŒ…è€—æ—¶ä»¥åŠæ¯ä¸ª plugin å’Œ loader çš„æ‰“åŒ…è€—æ—¶ï¼Œä»è€Œè®©æˆ‘ä»¬å¯¹æ‰“åŒ…æ—¶é—´è¾ƒé•¿çš„éƒ¨åˆ†è¿›è¡Œé’ˆå¯¹æ€§ä¼˜åŒ–ã€‚ å¤šè¿›ç¨‹æ„å»º å¯¹äºè€—æ—¶è¾ƒé•¿çš„æ¨¡å—ï¼ŒåŒæ—¶å¼€å¯å¤šä¸ª nodejs è¿›ç¨‹è¿›è¡Œæ„å»ºthread-loaderï¼šå°†åŸæœ‰çš„ webpack å¯¹ loader çš„æ‰§è¡Œè¿‡ç¨‹ä»å•ä¸€è¿›ç¨‹çš„å½¢å¼æ‰©å±•æˆå¤šè¿›ç¨‹æ¨¡å¼ï¼Œæ¥åŠ é€Ÿä»£ç æ„å»º ç¼©å°æ„å»ºèŒƒå›´ æ„å»ºè¿‡ç¨‹æ˜¯é»˜è®¤å…¨å±€æŸ¥æ‰¾ï¼Œè¿™éå¸¸çš„è€—æ—¶ã€‚é€šè¿‡æ‰‹åŠ¨é…ç½®rulesä¸­çš„æ–‡ä»¶æŸ¥æ‰¾èŒƒå›´testã€includeå¯ä»¥å‡å°‘æ‰“åŒ…çš„èŒƒå›´ï¼Œä»è€Œæå‡æ‰“åŒ…çš„é€Ÿåº¦ã€‚ 123456789101112module.exports = &#123; // ... module: &#123; rules: [ &#123; test: /\\.js$/, use: ['babel-loader'], exclude: /node_modules/, &#125;, ], &#125;,&#125;; ç¼“å­˜Eslint æ£€æŸ¥ å’Œ Babel ç¼–è¯‘ç»“æœ æ¯æ¬¡æ‰“åŒ…æ—¶ js æ–‡ä»¶éƒ½è¦ç»è¿‡ Eslint æ£€æŸ¥ å’Œ Babel ç¼–è¯‘ï¼Œé€Ÿåº¦æ¯”è¾ƒæ…¢ã€‚æˆ‘ä»¬å¯ä»¥ç¼“å­˜ä¹‹å‰çš„ Eslint æ£€æŸ¥ å’Œ Babel ç¼–è¯‘ç»“æœï¼Œè¿™æ ·ç¬¬äºŒæ¬¡æ‰“åŒ…æ—¶é€Ÿåº¦å°±ä¼šæ›´å¿«äº†ã€‚ 12345678910111213141516171819202122&#123; test: /\\.js$/, // exclude: /node_modules/, // æ’é™¤node_modulesä»£ç ä¸ç¼–è¯‘ include: path.resolve(__dirname, \"../src\"), // ä¹Ÿå¯ä»¥ç”¨åŒ…å« loader: \"babel-loader\", options: &#123; cacheDirectory: true, // å¼€å¯babelç¼–è¯‘ç¼“å­˜ cacheCompression: false, // ç¼“å­˜æ–‡ä»¶ä¸è¦å‹ç¼© &#125;, &#125;,// eslint new ESLintWebpackPlugin(&#123; // æŒ‡å®šæ£€æŸ¥æ–‡ä»¶çš„æ ¹ç›®å½• context: path.resolve(__dirname, \"../src\"), exclude: \"node_modules\", // é»˜è®¤å€¼ cache: true, // å¼€å¯ç¼“å­˜ // ç¼“å­˜ç›®å½• cacheLocation: path.resolve( __dirname, \"../node_modules/.cache/.eslintcache\" ), &#125;), é…ç½®oneOf ä½¿å¾—åŒ¹é…ä¸Šä¸€ä¸ª loader, å‰©ä¸‹çš„å°±ä¸å†åŒ¹é…äº†ï¼Œè§£å†³æ‰“åŒ…æ—¶æ¯ä¸ªæ–‡ä»¶éƒ½ä¼šç»è¿‡æ‰€æœ‰ loader å¤„ç†ï¼Œè™½ç„¶å› ä¸º test æ­£åˆ™åŸå› å®é™…æ²¡æœ‰å¤„ç†ä¸Šï¼Œä½†æ˜¯éƒ½è¦è¿‡ä¸€éã€‚æ¯”è¾ƒæ…¢çš„é—®é¢˜ 1234567891011121314151617181920212223242526272829303132333435363738const path = require(\"path\");const ESLintWebpackPlugin = require(\"eslint-webpack-plugin\");const HtmlWebpackPlugin = require(\"html-webpack-plugin\");module.exports = &#123; entry: \"./src/main.js\", output: &#123; path: undefined, // å¼€å‘æ¨¡å¼æ²¡æœ‰è¾“å‡ºï¼Œä¸éœ€è¦æŒ‡å®šè¾“å‡ºç›®å½• filename: \"static/js/main.js\", // å°† js æ–‡ä»¶è¾“å‡ºåˆ° static/js ç›®å½•ä¸­ // clean: true, // å¼€å‘æ¨¡å¼æ²¡æœ‰è¾“å‡ºï¼Œä¸éœ€è¦æ¸…ç©ºè¾“å‡ºç»“æœ &#125;, module: &#123; rules: [ &#123; oneOf: [ &#123; // ç”¨æ¥åŒ¹é… .css ç»“å°¾çš„æ–‡ä»¶ test: /\\.css$/, // use æ•°ç»„é‡Œé¢ Loader æ‰§è¡Œé¡ºåºæ˜¯ä»å³åˆ°å·¦ use: [\"style-loader\", \"css-loader\"], &#125;, &#123; test: /\\.(ttf|woff2?)$/, type: \"asset/resource\", generator: &#123; filename: \"static/media/[hash:8][ext][query]\", &#125;, &#125;, &#123; test: /\\.js$/, exclude: /node_modules/, // æ’é™¤node_modulesä»£ç ä¸ç¼–è¯‘ loader: \"babel-loader\", &#125;, ], &#125;, ], &#125;, ç¼“å­˜ç”Ÿæˆçš„ webpack æ¨¡å—å’Œ chunkwebpack5 å†…ç½®äº† cache æ¨¡å—ï¼Œç¼“å­˜ç”Ÿæˆçš„ webpack æ¨¡å—å’Œ chunkï¼Œæ¥æ”¹å–„æ„å»ºé€Ÿåº¦ã€‚å®ƒåœ¨å¼€å‘ç¯å¢ƒä¸‹ä¼šé»˜è®¤è®¾ç½®ä¸º type: &#39;memory&#39; è€Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¢«ç¦ç”¨ã€‚å¯ä»¥é€šè¿‡è®¾ç½® cache: { type: &#39;filesystem&#39; }æ¥å¼€æ”¾æ›´å¤šé…ç½®é¡¹æ¯”å¦‚æˆ‘åœ¨webpack.config.jsä¸­å¦‚ä¸‹é…ç½®ï¼š 1module.exports = &#123; cache: &#123; type: 'filesystem', &#125;, &#125;; é‚£ä¹ˆç¬¬ä¸€æ¬¡æ‰“åŒ…åï¼Œå°±ä¼šåœ¨node_modulesæ–‡ä»¶å¤¹ä¸‹é¢ç”Ÿæˆä¸€ä¸ªcacheæ–‡ä»¶å¤¹ï¼Œä»è€Œç¬¬äºŒæ¬¡æ‰“åŒ…é€Ÿåº¦æ˜¾è‘—æå‡ã€‚","categories":[],"tags":[{"name":"webpack","slug":"webpack","permalink":"https://ashleyblog.xyz/tags/webpack/"}]},{"title":"ç®—æ³•å¡«å‘","slug":"ç®—æ³•å¡«å‘","date":"2020-01-06T14:06:55.000Z","updated":"2023-04-02T14:00:30.296Z","comments":true,"path":"2020/01/06/ç®—æ³•å¡«å‘/","link":"","permalink":"https://ashleyblog.xyz/2020/01/06/ç®—æ³•å¡«å‘/","excerpt":"","text":"è´ªå¿ƒæ³•æ–¹æ³•æ˜¯ä»æŸä¸€èµ·ç‚¹å¼€å§‹ï¼Œåœ¨æ¯ä¸€ä¸ªè§£å†³é—®é¢˜æ­¥éª¤ä¸­ä½¿ç”¨è´ªå¿ƒåŸåˆ™ï¼Œå³é‡‡å–åœ¨å½“å‰çŠ¶æ€ä¸‹æœ€æœ‰åˆ©æˆ–è€…æ˜¯æœ€ä¼˜åŒ–çš„é€‰æ‹©ï¼Œè´ªå¿ƒæ³•å¸¸ç”¨äºæ‰¾å‡ºå›¾çš„æœ€å°ç”Ÿæˆæ ‘ï¼Œæœ€çŸ­è·¯å¾„ï¼Œå“ˆå¤«æ›¼ç¼–ç ç­‰ç­‰åº”ç”¨ï¼šåœ¨ä¸€å®šçš„æ—¶é—´ä¹‹å†…ä¸Šå®Œå°½é‡å¤šçš„è¯¾ç¨‹ç­–ç•¥ï¼šæ¯æ¬¡é€‰æ‹©æœ€æ—©ç»“æŸçš„è¯¾ç¨‹ 123456789101112131415161718192021# é¦–å…ˆå°†å·²é€‰è¯¾ç¨‹çš„åˆ—è¡¨åˆå§‹åŒ–ä¸ºç©ºï¼Œç„¶åæ‰§è¡Œè´ªå¿ƒç®—æ³•def executeSchedule(courses,selectionRule): selectedCourses = [] while len(courses) &gt; 0: selCourse = earliestFinishTime(courses) selectedCourses.append(selCourse) courses = removeConflictingCourses(selCourse,courses) return selectedCoursesdef earliestFinishTime(courses): earliestFinishTime = courses[0] for i in courses: if i[1] &lt; earliestFinishTime[1]: earliestFinishTime = i return earliestFinishTime# æ’é™¤å·²é€‰è¯¾ç¨‹ä¸­ä¸å½“å‰é€‰ä¸­çš„è¯¾ç¨‹å†²çªçš„è¯¾ç¨‹def removeConflictingCourses(selCourse,courses): noConflictingCourses = [] for s in courses: if s[1] &lt;= selCourse[0] or s[0] &gt;= selCourse[1]: noConflictingCourses.append(s) return noConflictingCourses åŠ¨æ€è§„åˆ’æ³•ä¹Ÿæ˜¯å°†ä¸€ä¸ªé—®é¢˜æ‹†è§£æˆè‹¥å¹²ä¸ªå­é—®é¢˜ï¼Œä½†æ˜¯è·Ÿåˆ†æ²»æ³•ä¸ä¸€æ ·çš„æ˜¯å®ƒä¼šå°†æ¯ä¸€ä¸ªå­é—®é¢˜çš„ç­”æ¡ˆå­˜å‚¨èµ·æ¥ï¼Œä»¥ä¾›ä¸‹æ¬¡æ±‚è§£çš„æ—¶å€™ä½¿ç”¨ï¼Œè¿™æ ·èƒ½å¤Ÿå‡å°‘è®¡ç®—çš„æ—¶é—´ å›æº¯ä¸€ç§å¯ä»¥æ‰¾å‡ºæ‰€æœ‰è§£æˆ–è€…æ˜¯ä¸€éƒ¨åˆ†è§£çš„ç®—æ³•ï¼Œä¸€æ—¦å‘ç°ä¸æ­£å¸¸çš„æ•°æ®å°±ä¸å†ç»§ç»­ï¼Œè€Œæ˜¯ä¼šå›åˆ°ä¸Šä¸€å±‚ é€’å½’åˆ†æ²»åº”ç”¨ï¼šä¸€å †çœŸå¸ä¸­æœ‰ä¸€ä¸ªæ˜¯å‡çš„ï¼Œå‡å¸çš„é‡äºçœŸçš„ï¼Œæ‰¾å‡ºå‡å¸ 123456789101112131415161718192021222324252627282930313233coinslist=[1,1,4,1,1,1]def coinComparison(coinslist): counter=0 currlist=coinslist while len(currlist) &gt; 1: group1,group2,group3 = splitCoins(currlist) currlist = findFakeGroup(group1,group2,group3) counter+=1 fake=currlist[0]def findFakeGroup(group1,group2,group3): resultland2 = compare(group1,group2) if resultland2 == 'left': fakeGroup = group1 elif resultland2 == 'right' fakeGroup = group2 elif resultland2 == 'equal' fakeGroup = group3 return fakeGroupdef compare(groupA,groupB): if sum(groupA)&gt;sum(groupB): result = 'left' elif sum(groupB)&gt;sum(groupA): result = 'right' else: result = 'equal' return resultdef splitCoins(coinslist): length = len(coinslist) group1=coinslist[0:length//3] group2=coinslist[length//3:length//3*2] group3=coinslist[length//3*2:length] return group1,group2,group3 è®°å¿†é€’å½’åº”ç”¨ï¼šæœ‰ä»¥ä¸‹çš„ç¡¬å¸ï¼Œéœ€è¦é€‰æ‹©éƒ¨åˆ†ç¡¬å¸ä½¿å¾—ä»–ä»¬çš„å’Œæœ€å¤§åŒ–ï¼Œå¹¶ä¸”ä¸èƒ½é€‰æ‹©ç›¸é‚»çš„ç¡¬å¸1 3 2 44 5 1234567891011121314151617def coins(row,memo): if len(row) == 0: memo[0] = 0 return 0,memo elif len(row) == 1: memo[1] = row[0] return row[0],memo try: retukrn (memo[len(row)],memo) except KeyError: # å¯¹åº”é€‰ä¸­ç¬¬ä¸€æšç¡¬å¸ pick = coins(row[2:],memo)[0]+row[0]) # å¯¹åº”è·³è¿‡ç¬¬ä¸€æšç¡¬å¸ skip = coins(row[1:],memo)[0] result = max(pick,skip) memo[len(row)] = result return (result,memo) å›¾çš„å¹¿åº¦ä¼˜å…ˆæœç´¢åº”ç”¨ï¼šå…­åº¦åˆ†éš”ï¼Œæ¯ä¸ªäººä¸å…¶ä»–ä»»ä½•äººéƒ½åªéœ€è¦ç»è¿‡å…­æ­¥ä»¥å†…çš„ä»‹ç»ï¼Œåˆ†éš”åº¦æŒ‡çš„æ˜¯æ¯ä¸€ä¸ªäººä¹‹é—´çš„æœ€å¤§åˆ†éš”åº¦ 12345678910111213141516171819202122232425262728small = &#123; &apos;A&apos;:[&apos;B&apos;,&apos;C&apos;], &apos;B&apos;:[&apos;A&apos;,&apos;C&apos;]&#125;def degreesOfSeparation(graph,start): if start not in graph: return -1 visited = set() frontier = set() degrees=0 visited.add(start) frontier.add(start) while len(frontier) &gt; 0: print(frontier,&apos;:&apos;,degrees) degrees += 1 newfront = set() for g in frontier: for next in graph[g]: if next not in visited: visited.add(next) newfront.add(next) # å°†å½“å‰å…ˆé”‹è®¾ç½®ä¸ºæ–°çš„å…ˆé”‹ frontier = newfront return degrees -=1degreesOfSeparation(small,&apos;A&apos;)# &#123;&apos;A&apos;&#125;:0# &#123;&apos;C&apos;,&apos;B&apos;&#125;:1# ...","categories":[],"tags":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://ashleyblog.xyz/tags/ç®—æ³•/"}]},{"title":"æ—¥å¸¸è®°å½•","slug":"è®°å½•","date":"2020-01-06T13:51:48.000Z","updated":"2023-04-02T14:00:30.288Z","comments":true,"path":"2020/01/06/è®°å½•/","link":"","permalink":"https://ashleyblog.xyz/2020/01/06/è®°å½•/","excerpt":"","text":"å¹´å‰çš„ç©ºæ¡£æœŸå»äº†æŸå‚æ¬ç –ï¼Œæ„Ÿæ…¨ç”Ÿæ´»çš„ä¸æ˜“çš„åŒæ—¶æ·±æ„Ÿé çŸ¥è¯†èµšé’±æ˜¯ä¸€ä»¶å¤šä¹ˆå¹¸ç¦çš„äº‹æƒ…ï¼Œçªç„¶æåº¦æ¸´æœ›è¿…é€Ÿæå‡è‡ªå·±çš„æŠ€æœ¯æ°´å¹³ï¼Œæ¸´æœ›ä¾é æŠ€æœ¯è€Œä¸æ˜¯æœºæ¢°æ€§çš„åŠ³åŠ¨èµšé’±ã€‚ è¿‡å®Œå¹´å°± 23 å²äº†ï¼Œèƒ½äº«å—å¹´è½»çš„æ—¥å­å·²ç»ä¸å¤šäº†ï¼Œä¸‰å¹´ä¹‹åå¼€å§‹è¡°è€ï¼Œä¸å†æ˜¯å°é²œè‚‰ï¼Œå¯èƒ½ä¸å†æœ‰å°‘å¹´çš„æ¿€æƒ…ï¼Œå¯èƒ½ä¼šå®‰äºç°çŠ¶ï¼Œä¸€å¿ƒåªæƒ³æ±‚ç¨³ï¼Œå¯èƒ½å›é¦–ä»Šå¤©ï¼Œä¼šè§‰å¾—è¿™æ ¹æœ¬æ²¡ä»€ä¹ˆå¤§ä¸äº†ï¼Œå› ä¸ºæˆ‘ç°åœ¨å·²ç»ç¨³å®šä¸‹æ¥äº†å‘€ã€‚ã€‚ã€‚æƒ³åˆ°è¿™äº›ï¼Œæ—¢è§‰å¾—å¾—åˆ°äº†å®‰æ…°åˆè§‰å¾—ç´¢ç„¶æ— å‘³ã€‚ æˆ‘åˆ°åº•æƒ³è¦è¿‡æ€æ ·çš„äººç”Ÿï¼Ÿæƒ³è¦èµ°ä»€ä¹ˆæ ·çš„èŒä¸šé“è·¯ï¼Ÿå…¶å®ç°åœ¨çš„æˆ‘ä¹Ÿä¸æ˜ç¡®ï¼Œæœªæ¥çš„æ—¥å­ï¼Œé“é˜»ä¸”é•¿ï¼Œå”¯ä¸€çš„æ„¿æœ›æ˜¯å¸Œæœ›è‡ªå·±å¯ä»¥å°‘ç•™é—æ†¾ï¼Œèƒ½ä¸€è·¯å‘å‰ä¸è¦å›å¤´å§ã€‚ã€‚ã€‚","categories":[],"tags":[{"name":"ç”Ÿæ´»","slug":"ç”Ÿæ´»","permalink":"https://ashleyblog.xyz/tags/ç”Ÿæ´»/"}]},{"title":"é¢è¯•ä¸­çš„ç¼–ç¨‹é¢˜","slug":"é¢è¯•ä¸­çš„ç¼–ç¨‹é¢˜ï½ä¸å®šæœŸæ›´æ–°","date":"2019-12-24T09:46:29.000Z","updated":"2023-04-15T13:43:26.337Z","comments":true,"path":"2019/12/24/é¢è¯•ä¸­çš„ç¼–ç¨‹é¢˜ï½ä¸å®šæœŸæ›´æ–°/","link":"","permalink":"https://ashleyblog.xyz/2019/12/24/é¢è¯•ä¸­çš„ç¼–ç¨‹é¢˜ï½ä¸å®šæœŸæ›´æ–°/","excerpt":"","text":"æ±‚å¤šä¸ªæ•°ç»„çš„äº¤é›† 12345678function jiaojiArr(a,b)&#123; return new Set([...a].filter(item=&gt;b.includes(item)))&#125;function getJiaoji(...arrs)&#123;return arrs.reduce((jiaoji,arr)=&gt;&#123;return Array.from(jiaojiArr(jiaoji,arr))&#125;)&#125; å®ç°indexof 12345678910111213Array.prototype.indexOf=function (target,start=0)&#123; let str=this.slice(start).join(',') let strArr=str.split(`$&#123;target&#125;,`) if(strArr.length===1)&#123; return -1 &#125; return strArr[0].split(',').length - 1+start&#125;String.prototype.indexOf=function(target,start=0)&#123; let str=this.slice(start) let result=str.replace(new RegExp(`$&#123;target&#125;\\\\w+`,'g'),'').length+start return result===this.length? -1 : result&#125; åˆ¤æ–­é“¾è¡¨ä¸­æ˜¯å¦å­˜åœ¨ç¯ æ€è·¯ï¼šè®¾ç½®ä¸€ä¸ª slow æŒ‡é’ˆ slow = slow-&gt;nextï¼Œä¸€ä¸ª fast æŒ‡é’ˆ fast = fast-&gt;next-&gt;nextã€‚å› ä¸º fast æŒ‡é’ˆç§»åŠ¨çš„æ¯” slow å¿«ï¼Œè¦æ˜¯æœ‰ç¯çš„è¯ä¸€å®šä¼šç›¸é‡ 12345678910111213141516171819202122232425262728293031function linknode(x)&#123;this.val=xthis.next=null&#125;class linklist()&#123;constructor(x)&#123; this.head=new linknode(x)&#125;append(x)&#123; const newnode=new linknode(x) let current=this.head while(current.next)&#123;current=current.next &#125; current.next=newnode&#125;judge()&#123; if(!this.head.next)&#123; return false &#125;let fast=this.head.next.nextlet low=this.head.nextwhile(fast.next)&#123; if(fast.next===low.next)&#123; return true &#125; fast=fast.next.next low=low.next&#125;&#125;&#125; ä»æ•°ç»„ä¸­å–å¾—éšæœºæ•°ä¸èƒ½æœ‰é‡å¤çš„ 12345678910111213function getRandomNumFromArr(arr, count) &#123; if (count &gt;= arr.length) &#123; return arr &#125; let result = [] while (result.length &lt; count) &#123; let random = Math.floor(Math.random() * (arr.length-1)) if (!result.includes(arr[random])) &#123; result.push(arr[random]) &#125; &#125; return result&#125; å®ç°addå‡½æ•° 1234567891011121314151617function add(n) &#123; let fn = function(m) &#123; return add(n + m) &#125; // valueOf åœ¨ ç®—æœ¯è¿ç®—æ—¶ç”Ÿæ•ˆå¦‚ +add(2)(3) fn.valueOf = function() &#123; return n &#125; // toString åœ¨ è½¬æ¢ä¸ºå­—ç¬¦ä¸²æ—¶è°ƒç”¨ add(2)(3) fn.toString = function() &#123; return '' + n &#125; return fn&#125;add(1); // 1add(1)(2); // 3add(1)(2)(3)ï¼› // 6 è·å¾—æ‰€æœ‰çˆ¶çº§çš„ID 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253const data = [ &#123; id: '1', name: 'test1', children: [ &#123; id: '11', name: 'test11', children: [ &#123; id: '111', name: 'test111' &#125; ] &#125;, &#123; id: '12', name: 'test12', children: [ &#123; id: '121', name: 'test121' &#125; ] &#125; ] &#125;]// æ­£åˆ™è¡¨è¾¾å¼ç‰ˆfunction getParentId(data) &#123; const str = JSON.stringify(data) const childReg = /\\&#123;[^&#123;&#125;]+\\&#125;/g const childCollects = str.match(chilReg) const idReg = /(?&lt;=id\\\":\\\")\\d+/g const childIdCollects = childCollects.map((child) =&gt; child.match(idReg)[0]) const totalIdCollects = str.match(idReg) return totalIdCollects.filter((item) =&gt; !childIdCollects.includes(item))&#125;// DFSfunction getParentId(data) &#123; let result = &#123;&#125; ;(function(data) &#123; const parents = data.filter((item) =&gt; 'children' in item) parents.reduce((obj, item) =&gt; &#123; obj[item.id] = Symbol() return obj &#125;, result) for (let k of parents) &#123; arguments.callee(k.children) &#125; &#125;)(data) return result&#125; æ·±åº¦åˆå¹¶ä¸¤ä¸ªå¯¹è±¡ 1234567891011121314151617function mergeDeep(target, obj) &#123; let result = &#123; ...target&#125; ;(function merge(origin, obj) &#123; for (let k in obj) &#123; if ( typeof origin[k] !== 'object' || typeof obj[k] !== 'object' || Array.isArray(origin[k]) !== Array.isArray(obj[k]) ) &#123; origin[k] = obj[k] &#125; else &#123; merge(origin[k], obj[k]) &#125; &#125; &#125;)(result, obj) return result&#125;","categories":[{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"https://ashleyblog.xyz/categories/é¢è¯•/"},{"name":"js","slug":"é¢è¯•/js","permalink":"https://ashleyblog.xyz/categories/é¢è¯•/js/"}],"tags":[]},{"title":"é¢ç»cssç¯‡","slug":"é¢ç»cssç¯‡","date":"2019-12-18T13:58:19.000Z","updated":"2023-04-02T14:00:30.292Z","comments":true,"path":"2019/12/18/é¢ç»cssç¯‡/","link":"","permalink":"https://ashleyblog.xyz/2019/12/18/é¢ç»cssç¯‡/","excerpt":"","text":"æ°´å¹³å‚ç›´å±…ä¸­çš„å„ç§å§¿åŠ¿ï¼Œè¡¥å…… girdå¸ƒå±€ 1234567div.parent &#123; display: grid;&#125;div.child &#123; justify-self: center; align-self: center;&#125; flex 123456div.parent&#123; display:flex;&#125;div.child&#123; margin:auto;&#125; link vs @importå½“ä¸€ä¸ªé¡µé¢è¢«åŠ è½½çš„æ—¶å€™ï¼ˆå°±æ˜¯è¢«æµè§ˆè€…æµè§ˆçš„æ—¶å€™ï¼‰ï¼Œlinkå¼•ç”¨çš„CSSä¼šåŒæ—¶è¢«åŠ è½½ï¼Œè€Œ@importå¼•ç”¨çš„CSS ä¼šç­‰åˆ°é¡µé¢å…¨éƒ¨è¢«ä¸‹è½½å®Œå†è¢«åŠ è½½ã€‚ line-height 2 ä¸200% çˆ¶å…ƒç´ è®¾ç½®line-height: 200%;å±æ€§æ—¶ çˆ¶å…ƒç´ è®¾ç½®è¿™ä¸ªå±æ€§åï¼Œå…¶æ‰€æœ‰å­å…ƒç´ çš„è¡Œé«˜éƒ½æ˜¯ä¸€ä¸ªå…·ä½“çš„å€¼ï¼Œå³ä»–ä»¬çˆ¶å…ƒç´ å­—ä½“å¤§å°çš„200%ã€‚ä¸‹ä¾‹å¯çœ‹å‡ºå­å…ƒç´ çš„è¡Œé«˜éƒ½ä¸€è‡´ï¼Œå³çˆ¶å…ƒç´ å­—ä½“å¤§å°çš„2å€ï¼Œ32pxã€‚ çˆ¶å…ƒç´ è®¾ç½®line-height: 2;å±æ€§æ—¶ çˆ¶å…ƒç´ è®¾ç½®è¿™ä¸ªå±æ€§åï¼Œå…¶æ‰€æœ‰å­å…ƒç´ çš„è¡Œé«˜éƒ½æ˜¯è‡ªèº«å­—ä½“å¤§å°çš„2å€ã€‚ä¸‹ä¾‹å¯çœ‹å‡ºå­å…ƒç´ çš„è¡Œé«˜éƒ½æ˜¯ä¸ä¸€è‡´çš„","categories":[{"name":"é¢ç»","slug":"é¢ç»","permalink":"https://ashleyblog.xyz/categories/é¢ç»/"},{"name":"css","slug":"é¢ç»/css","permalink":"https://ashleyblog.xyz/categories/é¢ç»/css/"}],"tags":[{"name":"css","slug":"css","permalink":"https://ashleyblog.xyz/tags/css/"}]},{"title":"é¢ç»æµè§ˆå™¨ç¯‡","slug":"é¢ç»è®¡ç®—æœºç½‘ç»œç¯‡","date":"2019-12-12T03:37:37.000Z","updated":"2023-04-02T14:00:30.298Z","comments":true,"path":"2019/12/12/é¢ç»è®¡ç®—æœºç½‘ç»œç¯‡/","link":"","permalink":"https://ashleyblog.xyz/2019/12/12/é¢ç»è®¡ç®—æœºç½‘ç»œç¯‡/","excerpt":"","text":"Httpè¯·æ±‚ä¸­çš„keep-aliveåœ¨httpæ—©æœŸï¼Œæ¯ä¸ªhttpè¯·æ±‚éƒ½è¦æ±‚æ‰“å¼€ä¸€ä¸ªtpc socketè¿æ¥ï¼Œå¹¶ä¸”ä½¿ç”¨ä¸€æ¬¡ä¹‹åå°±æ–­å¼€è¿™ä¸ªtcpè¿æ¥ã€‚ä½¿ç”¨keep-aliveå¯ä»¥æ”¹å–„è¿™ç§çŠ¶æ€ï¼Œå³åœ¨ä¸€æ¬¡TCPè¿æ¥ä¸­å¯ä»¥æŒç»­å‘é€å¤šä»½æ•°æ®è€Œä¸ä¼šæ–­å¼€è¿æ¥ã€‚é€šè¿‡ä½¿ç”¨keep-aliveæœºåˆ¶ï¼Œå¯ä»¥å‡å°‘tcpè¿æ¥å»ºç«‹æ¬¡æ•°ï¼Œä¹Ÿæ„å‘³ç€å¯ä»¥å‡å°‘TIME_WAITçŠ¶æ€è¿æ¥ï¼Œä»¥æ­¤æé«˜æ€§èƒ½å’Œæé«˜httpdæœåŠ¡å™¨çš„ååç‡(æ›´å°‘çš„tcpè¿æ¥æ„å‘³ç€æ›´å°‘çš„ç³»ç»Ÿå†…æ ¸è°ƒç”¨,socketçš„accept()å’Œclose()è°ƒç”¨)ã€‚ä½†æ˜¯ï¼Œkeep-aliveå¹¶ä¸æ˜¯å…è´¹çš„åˆé¤,é•¿æ—¶é—´çš„tcpè¿æ¥å®¹æ˜“å¯¼è‡´ç³»ç»Ÿèµ„æºæ— æ•ˆå ç”¨ã€‚é…ç½®ä¸å½“çš„keep-aliveï¼Œæœ‰æ—¶æ¯”é‡å¤åˆ©ç”¨è¿æ¥å¸¦æ¥çš„æŸå¤±è¿˜æ›´å¤§ã€‚æ‰€ä»¥ï¼Œæ­£ç¡®åœ°è®¾ç½®keep-alive timeoutæ—¶é—´éå¸¸é‡è¦ã€‚ æµè§ˆå™¨ä¸ºä»€ä¹ˆè¦é™åˆ¶getè¯·æ±‚çš„å‚æ•°çš„é•¿åº¦æ˜¯å› ä¸ºurlçš„é•¿åº¦ä¼šè¢«é™åˆ¶ HTTPS æ¡æ‰‹è¿‡ç¨‹ä¸­ï¼Œå®¢æˆ·ç«¯å¦‚ä½•éªŒè¯è¯ä¹¦çš„åˆæ³•æ€§ï¼ˆ1ï¼‰é¦–å…ˆæµè§ˆå™¨è¯»å–è¯ä¹¦ä¸­çš„è¯ä¹¦æ‰€æœ‰è€…ã€æœ‰æ•ˆæœŸç­‰ä¿¡æ¯è¿›è¡Œæ ¡éªŒï¼Œæ ¡éªŒè¯ä¹¦çš„ç½‘ç«™åŸŸåæ˜¯å¦ä¸è¯ä¹¦é¢å‘çš„åŸŸåä¸€è‡´ï¼Œæ ¡éªŒè¯ä¹¦æ˜¯å¦åœ¨æœ‰æ•ˆæœŸå†…ï¼ˆ2ï¼‰æµè§ˆå™¨å¼€å§‹æŸ¥æ‰¾æ“ä½œç³»ç»Ÿä¸­å·²å†…ç½®çš„å—ä¿¡ä»»çš„è¯ä¹¦å‘å¸ƒæœºæ„CAï¼Œä¸æœåŠ¡å™¨å‘æ¥çš„è¯ä¹¦ä¸­çš„é¢å‘è€…CAæ¯”å¯¹ï¼Œç”¨äºæ ¡éªŒè¯ä¹¦æ˜¯å¦ä¸ºåˆæ³•æœºæ„é¢å‘ï¼ˆ3ï¼‰å¦‚æœæ‰¾ä¸åˆ°ï¼Œæµè§ˆå™¨å°±ä¼šæŠ¥é”™ï¼Œè¯´æ˜æœåŠ¡å™¨å‘æ¥çš„è¯ä¹¦æ˜¯ä¸å¯ä¿¡ä»»çš„ã€‚ï¼ˆ4ï¼‰å¦‚æœæ‰¾åˆ°ï¼Œé‚£ä¹ˆæµè§ˆå™¨å°±ä¼šä»æ“ä½œç³»ç»Ÿä¸­å–å‡ºé¢å‘è€…CA çš„å…¬é’¥(å¤šæ•°æµè§ˆå™¨å¼€å‘å•†å‘å¸ƒç‰ˆæœ¬æ—¶ï¼Œä¼šäº‹å…ˆåœ¨å†…éƒ¨æ¤å…¥å¸¸ç”¨è®¤è¯æœºå…³çš„å…¬å¼€å¯†é’¥)ï¼Œç„¶åå¯¹æœåŠ¡å™¨å‘æ¥çš„è¯ä¹¦é‡Œé¢çš„ç­¾åè¿›è¡Œè§£å¯†ï¼ˆ5ï¼‰æµè§ˆå™¨ä½¿ç”¨ç›¸åŒçš„hashç®—æ³•è®¡ç®—å‡ºæœåŠ¡å™¨å‘æ¥çš„è¯ä¹¦çš„hashå€¼ï¼Œå°†è¿™ä¸ªè®¡ç®—çš„hashå€¼ä¸è¯ä¹¦ä¸­ç­¾ååšå¯¹æ¯”ï¼ˆ6ï¼‰å¯¹æ¯”ç»“æœä¸€è‡´ï¼Œåˆ™è¯æ˜æœåŠ¡å™¨å‘æ¥çš„è¯ä¹¦åˆæ³•ï¼Œæ²¡æœ‰è¢«å†’å…… getä¸poståœ¨ç¼“å­˜æ–¹é¢çš„åŒºåˆ«getè¯·æ±‚ç±»ä¼¼äºæŸ¥æ‰¾çš„è¿‡ç¨‹ï¼Œç”¨æˆ·è·å–æ•°æ®ï¼Œå¯ä»¥ä¸ç”¨æ¯æ¬¡éƒ½ä¸æ•°æ®åº“è¿æ¥ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ç¼“å­˜ã€‚postä¸åŒï¼Œpoståšçš„ä¸€èˆ¬æ˜¯ä¿®æ”¹å’Œåˆ é™¤çš„å·¥ä½œï¼Œæ‰€ä»¥å¿…é¡»ä¸æ•°æ®åº“äº¤äº’ï¼Œæ‰€ä»¥ä¸èƒ½ä½¿ç”¨ç¼“å­˜ã€‚å› æ­¤getè¯·æ±‚é€‚åˆäºè¯·æ±‚ç¼“å­˜ã€‚ å››ç§å­˜å‚¨ cookieçš„ç”Ÿå­˜æ—¶é—´å¦‚æœä¸è®¾ç½®è¿‡æœŸæ—¶é—´expiresï¼Œåˆ™è¡¨ç¤ºè¿™ä¸ª cookie ç”Ÿå‘½å‘¨æœŸä¸ºæµè§ˆå™¨ä¼šè¯æœŸé—´ï¼Œåªè¦å…³é—­æµè§ˆå™¨çª—å£ï¼Œcookie å°±æ¶ˆå¤±äº†ã€‚è¿™ç§ç”Ÿå‘½æœŸä¸ºæµè§ˆä¼šè¯æœŸçš„ cookie è¢«ç§°ä¸ºä¼šè¯ cookieã€‚ä¼šè¯ cookie ä¸€èˆ¬ä¸ä¿å­˜åœ¨ç¡¬ç›˜ä¸Šè€Œæ˜¯ä¿å­˜åœ¨å†…å­˜é‡Œã€‚ å¦‚æœè®¾ç½®äº†è¿‡æœŸæ—¶é—´ï¼Œæµè§ˆå™¨å°±ä¼šæŠŠ cookie ä¿å­˜åˆ°ç¡¬ç›˜ä¸Šï¼Œå…³é—­åå†æ¬¡æ‰“å¼€æµè§ˆå™¨ï¼Œè¿™äº› cookie ä¾ç„¶æœ‰æ•ˆç›´åˆ°è¶…è¿‡è®¾å®šçš„è¿‡æœŸæ—¶é—´ã€‚ session sessionçš„æœ¬è´¨ï¼šå°±æ˜¯å­˜å‚¨åœ¨æœåŠ¡å™¨ä¸Šçš„ä¸€ä¸ªå“ˆå¸Œè¡¨ã€‚ å°†sessionIDï¼ˆéšæœºæ•°ï¼‰ é€šè¿‡ Cookie å‘ç»™å®¢æˆ·ç«¯å®¢æˆ·ç«¯è®¿é—®æœåŠ¡å™¨æ—¶ï¼ŒæœåŠ¡å™¨è¯»å– sessionIDæœåŠ¡å™¨æœ‰ä¸€å—å†…å­˜ï¼ˆå“ˆå¸Œè¡¨ï¼‰ä¿å­˜äº†æ‰€æœ‰ sessioné€šè¿‡sessionID åå°å¯ä»¥å¾—åˆ°å¯¹åº”ç”¨æˆ·çš„éšç§ä¿¡æ¯ï¼Œå¦‚ idï¼Œemailè¿™å—å†…å­˜ï¼ˆå“ˆå¸Œè¡¨ï¼‰å°±æ˜¯æœåŠ¡å™¨ä¸Šçš„æ‰€æœ‰ session ä¸ºä»€ä¹ˆä¼šæœ‰ session? cookieèƒ½è¢«ç”¨æˆ·æˆªå– ä¸å®‰å…¨ä¹‹å‰çš„å†™æ³•ï¼šç›´æ¥å°†æ•°æ®æ”¾åˆ°cookieé‡Œé¢ï¼š1response.setHeader('Set-Cookie', `login_email=$&#123;email&#125;`) è¿™æ ·å†™ä¸€æ¥ä¼šæš´éœ²ç”¨æˆ·çš„ä¸ªäººä¿¡æ¯ï¼ŒäºŒæ¥ç”¨æˆ·å¯ä»¥ç›´æ¥é€šè¿‡æµè§ˆå™¨ä¿®æ”¹cookieï¼Œææœ‰å¯èƒ½è·å–åˆ°åˆ«äººçš„ç”¨æˆ·ä¿¡æ¯ï¼Œæä¸å®‰å…¨ã€‚å› æ­¤å‡ºç°äº†ä¸‹é¢çš„ä½¿ç”¨sessionçš„æ“ä½œï¼š 12345let sessions = &#123;&#125;let sessionId = Math.random() * 10000 // è®¾ç½®sessionId ä¸ºä¸€ä¸ªéšæœºæ•°sessions[sessionId] = &#123;login_email:email&#125; // å°†email å­˜å‚¨åœ¨sessionsè¿™ä¸ªå¯¹è±¡ä¸­response.setHeader('Set-Cookie', `sessionId = $&#123;sessionId&#125;`) // cookieä¸­å­˜å‚¨çš„æ˜¯ sessionId è¿™ä¸ªéšæœºæ•° é¦–å…ˆæ¥è§£é‡Šä¸€ä¸‹ä¸Šé¢çš„ä»£ç ï¼šå³è®¾ç½®cookieçš„ä¸­å­˜å‚¨çš„å€¼ä¸ºä¸€ä¸ªéšæœºæ•°ï¼Œå½“åå°è·å–åˆ°cookieæ—¶ï¼Œå°±å¯ä»¥è·å–åˆ°è¯¥éšæœºæ•°å¹¶åœ¨sessionsè¿™ä¸ªå¯¹è±¡ä¸­æŸ¥æ‰¾keyä¸ºè¿™ä¸ªéšæœºæ•°çš„valueï¼Œå³å¯çŸ¥é“ç”¨æˆ·çš„é‚®ç®±æ˜¯ä»€ä¹ˆ ã€‚ ä¸åŸºäºcookieèƒ½å¦å®ç°sessionåç«¯å¾…ç”¨æˆ·ç™»é™†åè®¾ç½®ä»–çš„sessionIDï¼Œä½†ä¸æŠŠå®ƒæ”¾åœ¨ cookie é‡Œï¼Œè€Œæ˜¯å°†ä¿¡æ¯é€šè¿‡å“åº”ä½“ä¼ JSONç»™å‰ç«¯ã€‚å‰ç«¯æ‹¿åˆ°å“åº”ä½“ä¸­çš„JSONåå°†å…¶è½¬æ¢æˆå¯¹è±¡ï¼ˆJSON.parseï¼‰å°†ä»JSONä¸­è·å–åˆ°çš„æ•°æ®ï¼ˆå¦‚ sessionIDï¼‰æ”¾åœ¨ localStorage é‡Œé¢ï¼ˆlocalStorageé‡Œçš„æ•°æ®ç›®å‰æš‚æ—¶ç”¨ä¸åˆ°ï¼‰ä»¥åè·³è½¬åˆ°å…¶ä»–é¡µé¢ï¼ˆå¦‚é¦–é¡µï¼‰æ—¶ï¼Œå°† sessionID æ”¾åœ¨ URL çš„æŸ¥è¯¢å‚æ•°é‡Œï¼ˆå¦‚ï¼šwindow.location.href = â€˜/?sessionId=object.sessionIdâ€™ï¼‰é‚£ä¹ˆè¿›å…¥é¦–é¡µåï¼Œè¯¥é¡µé¢çš„ URL çš„æŸ¥è¯¢å‚æ•°å°±å¸¦ä¸Šäº†ä½ çš„sessionIDåç«¯é€šè¿‡åœ¨ç”¨æˆ·è®¿é—®é¦–é¡µæ—¶ï¼Œä¼ åˆ°æœåŠ¡å™¨çš„ URL ï¼Œæ¥è·å–åˆ°æŸ¥è¯¢å‚æ•°ï¼Œä»è€Œè·å–åˆ°ç”¨æˆ·çš„ sessionIDï¼Œç„¶ååœ¨æ•°æ®åº“ä¸­æŸ¥åˆ°sessionIDå¯¹åº”çš„ä¿¡æ¯å°±å¯ä»¥çŸ¥é“ç”¨æˆ·æ˜¯è°ã€‚ ä¸ºä»€ä¹ˆé€šå¸¸åœ¨å‘é€æ•°æ®åŸ‹ç‚¹è¯·æ±‚çš„æ—¶å€™ä½¿ç”¨çš„æ˜¯ 1x1 åƒç´ çš„é€æ˜ gif å›¾ç‰‡ä½œç”¨ï¼šå·¥ä½œä¸­ï¼Œç”¨äºå‰ç«¯ç›‘æ§ï¼Œæ¯”å¦‚æ›å…‰ç­‰ç­‰ï¼Œè°·æ­Œå’Œç™¾åº¦çš„éƒ½æ˜¯ç”¨çš„1x1 åƒç´ çš„é€æ˜ gif å›¾ç‰‡ï¼›why? æ²¡æœ‰è·¨åŸŸé—®é¢˜ï¼Œä¸€èˆ¬è¿™ç§ä¸ŠæŠ¥æ•°æ®ï¼Œä»£ç è¦å†™é€šç”¨çš„ï¼›ï¼ˆæ’é™¤ajaxï¼‰ä¸ä¼šé˜»å¡é¡µé¢åŠ è½½ï¼Œå½±å“ç”¨æˆ·çš„ä½“éªŒï¼Œåªè¦new Imageå¯¹è±¡å°±å¥½äº†ï¼›ï¼ˆæ’é™¤JS/CSSæ–‡ä»¶èµ„æºæ–¹å¼ä¸ŠæŠ¥ï¼‰åœ¨æ‰€æœ‰å›¾ç‰‡ä¸­ï¼Œä½“ç§¯æœ€å°ï¼›ï¼ˆæ¯”è¾ƒPNG/JPGï¼‰ cookie å’Œ localStorage çš„åŒºåˆ«æ˜¯ä»€ä¹ˆç­”ï¼šcookie æ¯æ¬¡è¯·æ±‚ä¼šè¢«å¸¦ç»™æœåŠ¡å™¨ï¼Œè€Œ localStorageä¸ä¼šï¼›cookieçš„æœ€å¤§å‚¨å­˜é‡ä¸€èˆ¬åªæœ‰4kï¼Œè€ŒlocalStorage ä¸€èˆ¬æœ‰5Mb sessionstorageè·Ÿlocalstorageçš„åŒºåˆ«localStorage: åœ¨åŒä¸€ä¸ªæµè§ˆå™¨å†…ï¼ŒåŒæºæ–‡æ¡£ä¹‹é—´å…±äº« localStorage æ•°æ®ï¼Œå¯ä»¥äº’ç›¸è¯»å–ã€è¦†ç›–ã€‚sessionStorage: ä¸ localStorage ä¸€æ ·éœ€è¦åŒä¸€æµè§ˆå™¨åŒæºæ–‡æ¡£è¿™ä¸€æ¡ä»¶ã€‚ä¸ä»…å¦‚æ­¤ï¼ŒsessionStorage çš„ä½œç”¨åŸŸè¿˜è¢«é™å®šåœ¨äº†çª—å£ä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåªæœ‰åŒä¸€æµè§ˆå™¨ã€åŒä¸€çª—å£çš„åŒæºæ–‡æ¡£æ‰èƒ½å…±äº«æ•°æ®ã€‚ tcpçš„æµé‡æ§åˆ¶ä¸æ‹¥å¡æ§åˆ¶ æµé‡æ§åˆ¶ ï¼ˆå®ç°ï¼šä¸»è¦çš„æ–¹å¼å°±æ˜¯æ¥æ”¶æ–¹è¿”å›çš„ ACK ä¸­ä¼šåŒ…å«è‡ªå·±çš„æ¥æ”¶çª—å£çš„å¤§å°ï¼Œå¹¶ä¸”åˆ©ç”¨å¤§å°æ¥æ§åˆ¶å‘é€æ–¹çš„æ•°æ®å‘é€ã€‚ï¼‰å¦‚æœå‘é€è€…å‘é€æ•°æ®è¿‡å¿«ï¼Œæ¥æ”¶è€…æ¥ä¸åŠæ¥æ”¶ï¼Œé‚£ä¹ˆå°±ä¼šæœ‰åˆ†ç»„ä¸¢å¤±ã€‚ä¸ºäº†é¿å…åˆ†ç»„ä¸¢å¤±ï¼Œæ§åˆ¶å‘é€è€…çš„å‘é€é€Ÿåº¦ï¼Œä½¿å¾—æ¥æ”¶è€…æ¥å¾—åŠæ¥æ”¶ï¼Œè¿™å°±æ˜¯æµé‡æ§åˆ¶ã€‚æµé‡æ§åˆ¶æ ¹æœ¬ç›®çš„æ˜¯é˜²æ­¢åˆ†ç»„ä¸¢å¤±ï¼Œå®ƒæ˜¯æ„æˆTCPå¯é æ€§çš„ä¸€æ–¹é¢ã€‚ æµé‡æ§åˆ¶ä¸æ‹¥å¡æ§åˆ¶çš„åŒºåˆ«æ‹¥å¡æ§åˆ¶ï¼šæ‹¥å¡æ§åˆ¶æ˜¯ä½œç”¨äºç½‘ç»œçš„ï¼Œå®ƒæ˜¯é˜²æ­¢è¿‡å¤šçš„æ•°æ®æ³¨å…¥åˆ°ç½‘ç»œä¸­ï¼Œé¿å…å‡ºç°ç½‘ç»œè´Ÿè½½è¿‡å¤§çš„æƒ…å†µï¼›å¸¸ç”¨çš„æ–¹æ³•å°±æ˜¯ï¼šï¼ˆ 1 ï¼‰æ…¢å¼€å§‹ã€æ‹¥å¡é¿å…ï¼ˆ 2 ï¼‰å¿«é‡ä¼ ã€å¿«æ¢å¤ã€‚ æµé‡æ§åˆ¶ï¼šæµé‡æ§åˆ¶æ˜¯ä½œç”¨äºæ¥æ”¶è€…çš„ï¼Œå®ƒæ˜¯æ§åˆ¶å‘é€è€…çš„å‘é€é€Ÿåº¦ä»è€Œä½¿æ¥æ”¶è€…æ¥å¾—åŠæ¥æ”¶ï¼Œé˜²æ­¢åˆ†ç»„ä¸¢å¤±çš„ åŸŸåè§£æ1ã€æµè§ˆå™¨ä¸­è¾“å…¥æƒ³è¦è®¿é—®çš„ç½‘ç«™çš„åŸŸåï¼Œæ“ä½œç³»ç»Ÿä¼šå…ˆæ£€æŸ¥æœ¬åœ°çš„hostsæ–‡ä»¶æ˜¯å¦æœ‰è¿™ä¸ªç½‘å€æ˜ å°„å…³ç³»ï¼Œå¦‚æœæœ‰ï¼Œå°±å…ˆè°ƒç”¨è¿™ä¸ªIPåœ°å€æ˜ å°„ï¼Œå®ŒæˆåŸŸåè§£æã€‚2ã€å¦‚æœhostsé‡Œæ²¡æœ‰è¿™ä¸ªåŸŸåçš„æ˜ å°„ï¼Œå®¢æˆ·ç«¯ä¼šå‘æœ¬åœ°DNSæœåŠ¡å™¨å‘èµ·æŸ¥è¯¢ã€‚æœ¬åœ°DNSæœåŠ¡å™¨æ”¶åˆ°æŸ¥è¯¢æ—¶ï¼Œå¦‚æœè¦æŸ¥è¯¢çš„åŸŸååŒ…å«åœ¨æœ¬åœ°é…ç½®åŒºåŸŸèµ„æºä¸­ï¼Œåˆ™è¿”å›è§£æç»“æœç»™å®¢æˆ·æœºï¼Œå®ŒæˆåŸŸåè§£æã€‚3ã€å¦‚æœæœ¬åœ°DNSæœåŠ¡å™¨æœ¬åœ°åŒºåŸŸæ–‡ä»¶ä¸ç¼“å­˜è§£æéƒ½å¤±æ•ˆï¼Œåˆ™æ ¹æ®æœ¬åœ°DNSæœåŠ¡å™¨çš„è®¾ç½®ï¼Œé‡‡ç”¨é€’å½’æˆ–è€…è¿­ä»£æŸ¥è¯¢ï¼Œç›´è‡³è§£æå®Œæˆã€‚ é€’å½’æŸ¥è¯¢ è¿­ä»£æŸ¥è¯¢ æµè§ˆå™¨å®‰å…¨ CSRF çš„é˜²å¾¡ 1ã€å°½é‡ä½¿ç”¨ POSTï¼Œé™åˆ¶ GETGET æ¥å£å¤ªå®¹æ˜“è¢«æ‹¿æ¥åš CSRF æ”»å‡»ï¼Œçœ‹ä¸Šé¢ç¤ºä¾‹å°±çŸ¥é“ï¼Œåªè¦æ„é€ ä¸€ä¸ª img æ ‡ç­¾ï¼Œè€Œ img æ ‡ç­¾åˆæ˜¯ä¸èƒ½è¿‡æ»¤çš„æ•°æ®ã€‚æ¥å£æœ€å¥½é™åˆ¶ä¸º POST ä½¿ç”¨ï¼ŒGET åˆ™æ— æ•ˆï¼Œé™ä½æ”»å‡»é£é™©ã€‚å½“ç„¶ POST å¹¶ä¸æ˜¯ä¸‡æ— ä¸€å¤±ï¼Œæ”»å‡»è€…åªè¦æ„é€ ä¸€ä¸ª form å°±å¯ä»¥ï¼Œä½†éœ€è¦åœ¨ç¬¬ä¸‰æ–¹é¡µé¢åšï¼Œè¿™æ ·å°±å¢åŠ æš´éœ²çš„å¯èƒ½æ€§ã€‚2ã€å°† cookie è®¾ç½®ä¸º HttpOnlyCRSF æ”»å‡»å¾ˆå¤§ç¨‹åº¦ä¸Šæ˜¯åˆ©ç”¨äº†æµè§ˆå™¨çš„ cookieï¼Œä¸ºäº†é˜²æ­¢ç«™å†…çš„ XSS æ¼æ´ç›—å– cookie,éœ€è¦åœ¨ cookie ä¸­è®¾ç½®â€œHttpOnlyâ€å±æ€§ï¼Œè¿™æ ·é€šè¿‡ç¨‹åºï¼ˆå¦‚ JavaScript è„šæœ¬ã€Applet ç­‰ï¼‰å°±æ— æ³•è¯»å–åˆ° cookie ä¿¡æ¯ï¼Œé¿å…äº†æ”»å‡»è€…ä¼ªé€  cookie çš„æƒ…å†µå‡ºç°ã€‚åœ¨ Java çš„ Servlet çš„ API ä¸­è®¾ç½® cookie ä¸º HttpOnly çš„ä»£ç å¦‚ä¸‹ï¼šresponse.setHeader( â€œSet-Cookieâ€, â€œcookiename=cookievalue;HttpOnlyâ€);3ã€å¢åŠ  tokenCSRF æ”»å‡»ä¹‹æ‰€ä»¥èƒ½å¤ŸæˆåŠŸï¼Œæ˜¯å› ä¸ºæ”»å‡»è€…å¯ä»¥ä¼ªé€ ç”¨æˆ·çš„è¯·æ±‚ï¼Œè¯¥è¯·æ±‚ä¸­æ‰€æœ‰çš„ç”¨æˆ·éªŒè¯ä¿¡æ¯éƒ½å­˜åœ¨äº cookie ä¸­ï¼Œå› æ­¤æ”»å‡»è€…å¯ä»¥åœ¨ä¸çŸ¥é“ç”¨æˆ·éªŒè¯ä¿¡æ¯çš„æƒ…å†µä¸‹ç›´æ¥åˆ©ç”¨ç”¨æˆ·çš„ cookie æ¥é€šè¿‡å®‰å…¨éªŒè¯ã€‚ç”±æ­¤å¯çŸ¥ï¼ŒæŠµå¾¡ CSRF æ”»å‡»çš„å…³é”®åœ¨äºï¼šåœ¨è¯·æ±‚ä¸­æ”¾å…¥æ”»å‡»è€…æ‰€ä¸èƒ½ä¼ªé€ çš„ä¿¡æ¯ï¼Œå¹¶ä¸”è¯¥ä¿¡æ€»ä¸å­˜åœ¨äº cookie ä¹‹ä¸­ã€‚é‰´äºæ­¤ï¼Œç³»ç»Ÿå¼€å‘äººå‘˜å¯ä»¥åœ¨ HTTP è¯·æ±‚ä¸­ä»¥å‚æ•°çš„å½¢å¼åŠ å…¥ä¸€ä¸ªéšæœºäº§ç”Ÿçš„ tokenï¼Œå¹¶åœ¨æœåŠ¡ç«¯è¿›è¡Œ token æ ¡éªŒï¼Œå¦‚æœè¯·æ±‚ä¸­æ²¡æœ‰ token æˆ–è€… token å†…å®¹ä¸æ­£ç¡®ï¼Œåˆ™è®¤ä¸ºæ˜¯ CSRF æ”»å‡»è€Œæ‹’ç»è¯¥è¯·æ±‚ã€‚å‡è®¾è¯·æ±‚é€šè¿‡ POST æ–¹å¼æäº¤ï¼Œåˆ™å¯ä»¥åœ¨ç›¸åº”çš„è¡¨å•ä¸­å¢åŠ ä¸€ä¸ªéšè—åŸŸï¼štoken çš„å€¼é€šè¿‡æœåŠ¡ç«¯ç”Ÿæˆï¼Œè¡¨å•æäº¤å token çš„å€¼é€šè¿‡ POST è¯·æ±‚ä¸å‚æ•°ä¸€åŒå¸¦åˆ°æœåŠ¡ç«¯ï¼Œæ¯æ¬¡ä¼šè¯å¯ä»¥ä½¿ç”¨ç›¸åŒçš„ tokenï¼Œä¼šè¯è¿‡æœŸï¼Œåˆ™ token å¤±æ•ˆï¼Œæ”»å‡»è€…å› æ— æ³•è·å–åˆ° tokenï¼Œä¹Ÿå°±æ— æ³•ä¼ªé€ è¯·æ±‚ã€‚ note: 1ã€è¦ç¡®ä¿åŒä¸€é¡µé¢ä¸­æ¯ä¸ªè¡¨å•éƒ½å«æœ‰è‡ªå·±å”¯ä¸€çš„ä»¤ç‰Œ 2ã€éªŒè¯åéœ€è¦åˆ é™¤ç›¸åº”çš„éšæœºæ•° 3ã€Token ä¿å­˜åœ¨ Session ä¸­ã€‚å‡å¦‚ Token ä¿å­˜åœ¨ Cookie ä¸­ï¼Œç”¨æˆ·æµè§ˆå™¨å¼€äº†å¾ˆå¤šé¡µé¢ã€‚åœ¨ä¸€äº›é¡µé¢ Token è¢«ä½¿ç”¨æ¶ˆè€—æ‰åæ–°çš„Token ä¼šè¢«é‡æ–°ç§å…¥ï¼Œä½†é‚£äº›è€çš„ Tab é¡µé¢å¯¹åº”çš„ HTML é‡Œè¿˜æ˜¯è€ Tokenã€‚è¿™ä¼šè®©ç”¨æˆ·è§‰å¾—ä¸ºå•¥å‡ åˆ†é’Ÿå‰æ‰“å¼€çš„é¡µé¢ä¸èƒ½æ­£å¸¸æäº¤ï¼Ÿåœ¨ session ä¸­æ·»åŠ  token çš„å®ç°ä»£ç ï¼š 12345HttpSession session = request.getSession();Object token = session.getAttribute(\"_token\");if(token == null I I \"\".equals(token)) &#123; session.setAttribute(\"_token\", UUID.randomUUIDO .toString());&#125; 4ã€é€šè¿‡ Referer è¯†åˆ«æ ¹æ® HTTP åè®®ï¼Œåœ¨ HTTP å¤´ä¸­æœ‰ä¸€ä¸ªå­—æ®µå« Refererï¼Œå®ƒè®°å½•äº†è¯¥ HTTP è¯·æ±‚çš„æ¥æºåœ°å€ã€‚åœ¨é€šå¸¸æƒ…å†µä¸‹ï¼Œè®¿é—®ä¸€ä¸ªå®‰å…¨å—é™çš„é¡µé¢çš„è¯·æ±‚éƒ½æ¥è‡ªäºåŒä¸€ä¸ªç½‘ç«™ã€‚æ¯”å¦‚æŸé“¶è¡Œçš„è½¬è´¦æ˜¯é€šè¿‡ç”¨æˆ·è®¿é—®http://www.xxx.com/transfer.doé¡µé¢å®Œæˆçš„ï¼Œç”¨æˆ·å¿…é¡»å…ˆç™»å½•www.xxx.comï¼Œç„¶åé€šè¿‡å•å‡»é¡µé¢ä¸Šçš„æäº¤æŒ‰é’®æ¥è§¦å‘è½¬è´¦äº‹ä»¶ã€‚å½“ç”¨æˆ·æäº¤è¯·æ±‚æ—¶ï¼Œè¯¥è½¬è´¦è¯·æ±‚çš„Refererå€¼å°±ä¼šæ˜¯æäº¤æŒ‰é’®æ‰€åœ¨é¡µé¢çš„ URLï¼ˆæœ¬ä¾‹ä¸º www.xxx. com/transfer.doï¼‰ã€‚å¦‚æœæ”»å‡»è€…è¦å¯¹é“¶è¡Œç½‘ç«™å®æ–½ CSRF æ”»å‡»ï¼Œä»–åªèƒ½åœ¨å…¶ä»–ç½‘ç«™æ„é€ è¯·æ±‚ï¼Œå½“ç”¨æˆ·é€šè¿‡å…¶ä»–ç½‘ç«™å‘é€è¯·æ±‚åˆ°é“¶è¡Œæ—¶ï¼Œè¯¥è¯·æ±‚çš„ Referer çš„å€¼æ˜¯å…¶ä»–ç½‘ç«™çš„åœ°å€ï¼Œè€Œä¸æ˜¯é“¶è¡Œè½¬è´¦é¡µé¢çš„åœ°å€ã€‚å› æ­¤ï¼Œè¦é˜²å¾¡ CSRF æ”»å‡»ï¼Œé“¶è¡Œç½‘ç«™åªéœ€è¦å¯¹äºæ¯ä¸€ä¸ªè½¬è´¦è¯·æ±‚éªŒè¯å…¶ Referer å€¼å³å¯ï¼Œå¦‚æœæ˜¯ä»¥ www.xx.om åŸŸåå¼€å¤´çš„åœ°å€ï¼Œåˆ™è¯´æ˜è¯¥è¯·æ±‚æ˜¯æ¥è‡ªé“¶è¡Œç½‘ç«™è‡ªå·±çš„è¯·æ±‚ï¼Œæ˜¯åˆæ³•çš„ï¼›å¦‚æœ Referer æ˜¯å…¶ä»–ç½‘ç«™ï¼Œå°±æœ‰å¯èƒ½æ˜¯ CSRF æ”»å‡»ï¼Œåˆ™æ‹’ç»è¯¥è¯·æ±‚ã€‚å–å¾— HTTP è¯·æ±‚ Refererï¼šString referer = request.getHeader(â€œRefererâ€);5.ä½¿ç”¨éªŒè¯ç  xssæ”»å‡»æ–¹å¼ä»¥åŠé˜²å¾¡ ä¸­é—´äººæ”»å‡»ä¸­é—´äººæ”»å‡»è¿‡ç¨‹å¦‚ä¸‹ï¼š æœåŠ¡å™¨å‘å®¢æˆ·ç«¯å‘é€å…¬é’¥ã€‚æ”»å‡»è€…æˆªè·å…¬é’¥ï¼Œä¿ç•™åœ¨è‡ªå·±æ‰‹ä¸Šã€‚ç„¶åæ”»å‡»è€…è‡ªå·±ç”Ÿæˆä¸€ä¸ªã€ä¼ªé€ çš„ã€‘å…¬é’¥ï¼Œå‘ç»™å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯æ”¶åˆ°ä¼ªé€ çš„å…¬é’¥åï¼Œç”ŸæˆåŠ å¯†hashå€¼å‘ç»™æœåŠ¡å™¨ã€‚æ”»å‡»è€…è·å¾—åŠ å¯†hashå€¼ï¼Œç”¨è‡ªå·±çš„ç§é’¥è§£å¯†è·å¾—çœŸç§˜é’¥ã€‚åŒæ—¶ç”Ÿæˆå‡çš„åŠ å¯†hashå€¼ï¼Œå‘ç»™æœåŠ¡å™¨ã€‚æœåŠ¡å™¨ç”¨ç§é’¥è§£å¯†è·å¾—å‡ç§˜é’¥ã€‚æœåŠ¡å™¨ç”¨åŠ ç§˜é’¥åŠ å¯†ä¼ è¾“ä¿¡æ¯é˜²èŒƒæ–¹æ³•ï¼š æœåŠ¡ç«¯åœ¨å‘é€æµè§ˆå™¨çš„å…¬é’¥ä¸­åŠ å…¥CAè¯ä¹¦ï¼Œæµè§ˆå™¨å¯ä»¥éªŒè¯CAè¯ä¹¦çš„æœ‰æ•ˆæ€§å¼ºåˆ¶é¡µé¢ä½¿ç”¨https é˜²å¾¡ä¸­é—´äººæ”»å‡» 123function requestHandler(req, res)&#123; res.setHeader('Strict-Transport-Security','max-age=31536000; includeSubDomains; preload');&#125; æ·±å…¥äº†è§£æµè§ˆå™¨ç¼“å­˜æœºåˆ¶https://www.jianshu.com/p/54cc04190252è¡¥å……ï¼šå…³äºå¼ºç¼“å­˜å–èµ„æºçš„ä½ç½®å¦‚æœå¼€å¯äº†Service Workeré¦–å…ˆä¼šä»Service Workerä¸­æ‹¿å¦‚æœæ–°å¼€ä¸€ä¸ªä»¥å‰æ‰“å¼€è¿‡çš„é¡µé¢ç¼“å­˜ä¼šä»Disk Cacheä¸­æ‹¿ï¼ˆå‰ææ˜¯å‘½ä¸­å¼ºç¼“å­˜ï¼‰åˆ·æ–°å½“å‰é¡µé¢æ—¶æµè§ˆå™¨ä¼šæ ¹æ®å½“å‰è¿è¡Œç¯å¢ƒå†…å­˜æ¥å†³å®šæ˜¯ä» Memory Cache è¿˜æ˜¯ ä»Disk Cacheä¸­æ‹¿(å¯ä»¥çœ‹åˆ°ä¸‹å›¾æœ€åå‡ ä¸ªæ–‡ä»¶æœ‰æ—¶å€™æ˜¯ä» Memory Cacheä¸­æ‹¿æœ‰æ—¶å€™æ˜¯ä»Disk Cacheä¸­æ‹¿) 303ä¸302çš„åŒºåˆ«303 å¸¸ç”¨äºå°† POST è¯·æ±‚é‡å®šå‘åˆ° GET è¯·æ±‚ï¼Œæ¯”å¦‚ä½ ä¸Šä¼ äº†ä¸€ä»½ä¸ªäººä¿¡æ¯ï¼ŒæœåŠ¡å™¨å‘å›ä¸€ä¸ª 303 å“åº”ï¼Œå°†ä½ å¯¼å‘ä¸€ä¸ªâ€œä¸Šä¼ æˆåŠŸâ€é¡µé¢ã€‚ websoket httpä¹‹é—´çš„è”ç³» éƒ½æ˜¯ä¸€æ ·åŸºäºTCPçš„ï¼Œéƒ½æ˜¯å¯é æ€§ä¼ è¾“åè®®ã€‚ éƒ½æ˜¯åº”ç”¨å±‚åè®®ã€‚ WebSocketåœ¨å»ºç«‹æ¡æ‰‹æ—¶ï¼Œæ•°æ®æ˜¯é€šè¿‡HTTPä¼ è¾“çš„ã€‚ä½†æ˜¯å»ºç«‹ä¹‹åï¼Œåœ¨çœŸæ­£ä¼ è¾“æ—¶å€™æ˜¯ä¸éœ€è¦HTTPåè®®çš„ã€‚ WebSocketè¿æ¥çš„è¿‡ç¨‹æ˜¯ï¼š é¦–å…ˆï¼Œå®¢æˆ·ç«¯å‘èµ·httpè¯·æ±‚ï¼Œç»è¿‡3æ¬¡æ¡æ‰‹åï¼Œå»ºç«‹èµ·TCPè¿æ¥ï¼›httpè¯·æ±‚é‡Œå­˜æ”¾WebSocketæ”¯æŒçš„ç‰ˆæœ¬å·ç­‰ä¿¡æ¯ï¼Œå¦‚ï¼šUpgradeã€Connectionã€WebSocket-Versionç­‰ï¼›ç„¶åï¼ŒæœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯çš„æ¡æ‰‹è¯·æ±‚åï¼ŒåŒæ ·é‡‡ç”¨HTTPåè®®å›é¦ˆæ•°æ®ï¼›æœ€åï¼Œå®¢æˆ·ç«¯æ”¶åˆ°è¿æ¥æˆåŠŸçš„æ¶ˆæ¯åï¼Œå¼€å§‹å€ŸåŠ©äºTCPä¼ è¾“ä¿¡é“è¿›è¡Œå…¨åŒå·¥é€šä¿¡ã€‚ http keepaliveHttp keep-aliveåœ¨ HTTP 1.0 æ—¶æœŸï¼Œæ¯ä¸ª TCP è¿æ¥åªä¼šè¢«ä¸€ä¸ª HTTP Transactionï¼ˆè¯·æ±‚åŠ å“åº”ï¼‰ä½¿ç”¨ï¼Œè¯·æ±‚æ—¶å»ºç«‹ï¼Œè¯·æ±‚å®Œæˆé‡Šæ”¾è¿æ¥ã€‚å½“ç½‘é¡µå†…å®¹è¶Šæ¥è¶Šå¤æ‚ï¼ŒåŒ…å«å¤§é‡å›¾ç‰‡ã€CSS ç­‰èµ„æºä¹‹åï¼Œè¿™ç§æ¨¡å¼æ•ˆç‡å°±æ˜¾å¾—å¤ªä½äº†ã€‚æ‰€ä»¥ï¼Œåœ¨ HTTP 1.1 ä¸­ï¼Œå¼•å…¥äº† HTTP persistent connection çš„æ¦‚å¿µï¼Œä¹Ÿç§°ä¸º HTTP keep-aliveï¼Œç›®çš„æ˜¯å¤ç”¨TCPè¿æ¥ï¼Œåœ¨ä¸€ä¸ªTCPè¿æ¥ä¸Šè¿›è¡Œå¤šæ¬¡çš„HTTPè¯·æ±‚ä»è€Œæé«˜æ€§èƒ½ã€‚ tcp keepaliveåœ¨ä½¿ç”¨TCPé•¿è¿æ¥ï¼ˆå¤ç”¨å·²å»ºç«‹TCPè¿æ¥ï¼‰çš„åœºæ™¯ä¸‹ï¼Œéœ€è¦å¯¹TCPè¿æ¥è¿›è¡Œä¿æ´»ï¼Œé¿å…è¢«ç½‘å…³å¹²æ‰è¿æ¥ã€‚åœ¨åº”ç”¨å±‚ï¼Œå¯ä»¥é€šè¿‡å®šæ—¶å‘é€å¿ƒè·³åŒ…çš„æ–¹å¼å®ç°ã€‚ æ•°å­—ç­¾åå·¥ä½œåŸç†https://blog.51cto.com/winda/1968298 å‚è€ƒæ–‡ç«  æµè§ˆå™¨ç¼“å­˜æ§åˆ¶è¯¦è§£ï¼ˆcookieã€sessionã€localStorageã€Cache-Controlç­‰ å®‰å…¨|å¸¸è§çš„Webæ”»å‡»æ‰‹æ®µä¹‹CSRFæ”»å‡» å‰ç«¯ 100 é—®ï¼šèƒ½ææ‡‚80%çš„è¯·æŠŠç®€å†ç»™æˆ‘","categories":[{"name":"é¢ç»","slug":"é¢ç»","permalink":"https://ashleyblog.xyz/categories/é¢ç»/"},{"name":"æµè§ˆå™¨","slug":"é¢ç»/æµè§ˆå™¨","permalink":"https://ashleyblog.xyz/categories/é¢ç»/æµè§ˆå™¨/"}],"tags":[]},{"title":"ç§‹å­£å‰ç«¯é¢ç»è®°å½•","slug":"ç§‹å­£å‰ç«¯é¢ç»è®°å½•","date":"2019-12-11T09:16:23.000Z","updated":"2023-04-02T14:00:30.297Z","comments":true,"path":"2019/12/11/ç§‹å­£å‰ç«¯é¢ç»è®°å½•/","link":"","permalink":"https://ashleyblog.xyz/2019/12/11/ç§‹å­£å‰ç«¯é¢ç»è®°å½•/","excerpt":"","text":"é—®åˆ°sessionstorageè·Ÿlocalstorageçš„åŒºåˆ« ç­”å‰è€…åªåœ¨å½“å‰çª—å£æœ‰æ•ˆæ˜¯å¯¹çš„ å†é—®ä¸€éåˆä¸ç¡®å®šäº† è¯´æ˜åŸºç¡€ä¸ç‰¢å›ºå®¹æ˜“è¢«å¥—è·¯ å­˜å‚¨å¤§å°ï¼š éƒ½ä¸º 5MB å­˜å‚¨ä½ç½®ï¼š éƒ½åœ¨å®¢æˆ·ç«¯ï¼Œä¸äºˆæœåŠ¡å™¨è¿›è¡Œäº¤äº’é€šä¿¡ å­˜å‚¨å†…å®¹ç±»å‹ï¼š å­—ç¬¦ä¸²ï¼Œå¤æ‚çš„å¯¹è±¡å¯ä»¥ä½¿ç”¨ ECMAScript æä¾›çš„ JSON stringify å’Œ parse æ¥å¤„ç† è·å–æ–¹å¼ï¼šwindow.localStorage, window.sessionStorage åº”ç”¨åœºæ™¯ï¼š localStorage ç”¨äºé•¿æœŸç™»å½• and åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å·²ç™»å½•sessionStorage æ•æ„Ÿè´¦å·ä¸€æ¬¡æ€§ç™»å½• é¡µé¢å¡é¡¿ æ€ä¹ˆç›‘æµ‹åˆ°æ˜¯å“ªä¸€éƒ¨åˆ†çš„ä»£ç å‡ºç°äº†é—®é¢˜ç«ç„°å›¾(å¯ä»¥çœ‹åˆ°æ¯ä¸ªå‡½æ•°å æ®çš„å®½åº¦ï¼Œè¶Šå®½è¡¨ç¤ºæ‰§è¡Œçš„æ—¶é—´è¶Šé•¿) è¦æ˜¯ä¸ç”¨æ¡†æ¶çš„è¯ æ€ä¹ˆä¼˜åŒ–ä»£ç çš„ç»“æ„ï¼ŸMVVMåˆç§°çŠ¶æ€æœºåˆ¶ï¼ŒView å’Œ ViewModel æ˜¯è¿›è¡Œç»‘å®šçš„ï¼Œæ”¹å˜ ViewModel å°±ä¼šç›´æ¥ä½œç”¨åˆ° View è§†å›¾ä¸Šï¼Œè€Œ View ä¼šæŠŠäº‹ä»¶ä¼ é€’ç»™ ViewModel,ViewModel å»å¯¹ Model è¿›è¡Œæ“ä½œå¹¶æ¥å—æ›´æ–°ã€‚ Viewï¼šUI ç•Œé¢ ViewModelï¼šå®ƒæ˜¯ View çš„æŠ½è±¡ï¼Œè´Ÿè´£ View ä¸ Model ä¹‹é—´ä¿¡æ¯è½¬æ¢ï¼Œå°† View çš„ Command ä¼ é€åˆ° Modelï¼›æ¯”èµ· MVP ä¸­ View éœ€è¦è‡ªå·±æä¾› APIï¼ŒMVVM åœ¨ VM ä¸­æ„å»ºä¸€ç»„çŠ¶æ€æ•°æ®ï¼ˆstate dataï¼‰ï¼Œä½œä¸º View çŠ¶æ€çš„æŠ½è±¡ã€‚ç„¶åé€šè¿‡åŒå‘æ•°æ®ç»‘å®šï¼ˆdata bindingï¼‰ä½¿ VM ä¸­çš„çŠ¶æ€æ•°æ®ï¼ˆstate dataï¼‰ä¸ View ä¸­çš„æ˜¾ç¤ºçŠ¶æ€ï¼ˆscreen stateï¼‰ä¿æŒä¸€è‡´ã€‚è¿™æ ·ï¼ŒVM ä¸­çš„å±•ç¤ºé€»è¾‘åªéœ€è¦ä¿®æ”¹å¯¹åº”çš„çŠ¶æ€æ•°æ®ï¼Œå°±å¯ä»¥æ§åˆ¶ View çš„çŠ¶æ€ï¼Œä»è€Œé¿å…åœ¨ View ä¸Šå¼€å‘å¤§é‡çš„æ¥å£ Modelï¼šæ•°æ®è®¿é—®å±‚ ï¼Ÿä¸é€‚åˆ SEOï¼Ÿ ä¾‹å¦‚ï¼Œæˆ‘ä»¬å®šä¹‰å¥½ä¸€ä¸ª JavaScript å¯¹è±¡ä½œä¸º Modelï¼Œå¹¶ä¸”æŠŠè¿™ä¸ª Model çš„ä¸¤ä¸ªå±æ€§ç»‘å®šåˆ° DOM èŠ‚ç‚¹ä¸Šï¼š MVCView æŒæœ‰äº† Controllerï¼ŒæŠŠäº‹ä»¶ä¼ é€’ç»™ Controllerï¼ŒController ç”±æ­¤å»è§¦å‘ Model å±‚çš„äº‹ä»¶ï¼ŒModel æ›´æ–°å®Œæ•°æ®ï¼ˆç½‘ç»œæˆ–è€…æœ¬åœ°æ•°æ®ï¼‰ä¹‹åè§¦å‘ View çš„æ›´æ–°äº‹ä»¶ View è´Ÿè´£æ¸²æŸ“ç”¨æˆ·ç•Œé¢ï¼Œåº”è¯¥é¿å…åœ¨ View ä¸­æ¶‰åŠä¸šåŠ¡é€»è¾‘ Controller è´Ÿè´£æ¥æ”¶ç”¨æˆ·è¾“å…¥ï¼Œæ ¹æ®ç”¨æˆ·è¾“å…¥è°ƒç”¨ Model é€»è¾‘ï¼Œå°†äº§ç”Ÿçš„ç»“æœäº¤ç»™ View éƒ¨åˆ†ï¼Œè®© View æ¸²æŸ“å‡ºå¿…è¦çš„è¾“å‡º Model è´Ÿè´£ç®¡ç†æ•°æ®ï¼Œå¤§éƒ¨åˆ†ä¸šåŠ¡é€»è¾‘ä¹Ÿåº”è¯¥æ”¾åœ¨ Model ç¼ºç‚¹ï¼š ç”±äºåœ¨å®ç°çš„è¿‡ç¨‹ä¸­ï¼Œå¾€å¾€å‡ºç° View ä¸ Model ä¸ç»è¿‡ Controller é€šä¿¡çš„ç°è±¡ï¼Œé€ æˆæ•°æ®æµæ··ä¹±ï¼Œéš¾ä»¥ç»´æŠ¤å’Œå¢åŠ åŠŸèƒ½ mvc ä¸ mvvm çš„åŒºåˆ«MVVM ä¸ MVC æœ€å¤§çš„åŒºåˆ«å°±æ˜¯ï¼šå®ƒå®ç°äº† View å’Œ Model çš„è‡ªåŠ¨åŒæ­¥ï¼Œä¹Ÿå°±æ˜¯å½“ Model çš„å±æ€§æ”¹å˜æ—¶ï¼Œæˆ‘ä»¬ä¸ç”¨å†è‡ªå·±æ‰‹åŠ¨æ“ä½œ Dom å…ƒç´ ï¼Œæ¥æ”¹å˜ View çš„æ˜¾ç¤ºï¼Œè€Œæ˜¯æ”¹å˜å±æ€§åè¯¥å±æ€§å¯¹åº” View å±‚æ˜¾ç¤ºä¼šè‡ªåŠ¨æ”¹å˜ æ‹¿å…¸å‹çš„ MVVM æ¨¡å¼çš„ä»£è¡¨ï¼ŒVueï¼Œæ¥ä¸¾ä¾‹html éƒ¨åˆ†ç›¸å½“äº View å±‚ï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œçš„ View é€šè¿‡é€šè¿‡æ¨¡æ¿è¯­æ³•æ¥å£°æ˜å¼çš„å°†æ•°æ®æ¸²æŸ“è¿› DOM å…ƒç´ ï¼Œå½“ ViewModel å¯¹ Model è¿›è¡Œæ›´æ–°æ—¶ï¼Œé€šè¿‡æ•°æ®ç»‘å®šæ›´æ–°åˆ° Viewã€‚ Vue å®ä¾‹ä¸­çš„ data ç›¸å½“äº Model å±‚ï¼Œè€Œ ViewModel å±‚çš„æ ¸å¿ƒæ˜¯ Vue ä¸­çš„åŒå‘æ•°æ®ç»‘å®šï¼Œå³ Model å˜åŒ–æ—¶ VIew å¯ä»¥å®æ—¶æ›´æ–°ï¼ŒView å˜åŒ–ä¹Ÿèƒ½è®© Model å‘ç”Ÿå˜åŒ–ã€‚ è·¨åŸŸè¡¥å……ï¼š cra ç”Ÿæˆçš„é¡¹ç›®æ”¯æŒåœ¨package.jsonå­—æ®µè®¾ç½®proxyå¦‚ï¼šwill proxy your request to http://localhost:4000/api/todos as a fallback 1\"proxy\": \"http://localhost:4000\", æœ¬åœ°æµ‹è¯•ç”¨ é…ç½® hosts æ–‡ä»¶ å¦‚ï¼šâ€™127.0.0.1 xx.comâ€™æˆ–è€…æ˜¯é…ç½® switchyomega æ¯”å¦‚è¾“å…¥ test.xxx.com ä»£ç†åˆ° localhost è¿™æ ·å‘è¯·æ±‚çš„æ—¶å€™çš„ origin æ˜¯ test å°±ä¸ä¼šå‡ºç°è·¨åŸŸé”™è¯¯ ï¼ˆmidc æœ‰äº›æ¥å£æ˜¯èƒ½è·¨åŸŸçš„ï¼Œæ‰€ä»¥ origin æ˜¯ localhost çš„æ—¶å€™ä¹Ÿä¸ä¼šæŠ¥é”™ï¼‰ postmessage+iframe æ€§èƒ½ä¼˜åŒ– ï¼ˆä¸è¦ä¸€ç›´è¯´ reactï¼‰è™šæ‹Ÿ domå°±æ˜¯ä¸€ä¸ªæ™®é€šçš„ JavaScript å¯¹è±¡ï¼ŒåŒ…å«äº† tagã€propsã€children ä¸‰ä¸ªå±æ€§ã€‚ 1234567891011121314151617&#123; tag: 'div', props: &#123; id: 'app' &#125;, chidren: [ &#123; tag: 'p', props: &#123; className: 'text' &#125;, chidren: [ 'hello world!!!' ] &#125; ]&#125; ä¸»æµçš„è™šæ‹Ÿ DOM åº“ï¼ˆsnabbdomã€virtual-domï¼‰ï¼Œé€šå¸¸éƒ½æœ‰ä¸€ä¸ª h å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯ React ä¸­çš„ React.createElementï¼Œä»¥åŠ Vue ä¸­çš„ render æ–¹æ³•ä¸­çš„ createElementï¼Œå¦å¤– React æ˜¯é€šè¿‡ babel å°† jsx è½¬æ¢ä¸º h å‡½æ•°æ¸²æŸ“çš„å½¢å¼ï¼Œè€Œ Vue æ˜¯ä½¿ç”¨ vue-loader å°†æ¨¡ç‰ˆè½¬ä¸º h å‡½æ•°æ¸²æŸ“çš„å½¢å¼ï¼ˆä¹Ÿå¯ä»¥é€šè¿‡ babel-plugin-transform-vue-jsx æ’ä»¶åœ¨ vue ä¸­ä½¿ç”¨ jsxï¼Œæœ¬è´¨è¿˜æ˜¯è½¬æ¢ä¸º h å‡½æ•°æ¸²æŸ“å½¢å¼ï¼‰ã€‚ è™šæ‹Ÿ dom çš„ä¼˜åŠ¿å‡å°‘ JavaScript æ“ä½œçœŸå® DOM çš„å¸¦æ¥çš„æ€§èƒ½æ¶ˆè€—ã€‚è™½ç„¶è¿™ä¸€ä¸ªè™šæ‹Ÿ DOM å¸¦æ¥çš„ä¸€ä¸ªä¼˜åŠ¿ï¼Œä½†å¹¶ä¸æ˜¯å…¨éƒ¨ã€‚è™šæ‹Ÿ DOM æœ€å¤§çš„ä¼˜åŠ¿åœ¨äºæŠ½è±¡äº†åŸæœ¬çš„æ¸²æŸ“è¿‡ç¨‹ï¼Œå®ç°äº†è·¨å¹³å°çš„èƒ½åŠ›ï¼Œè€Œä¸ä»…ä»…å±€é™äºæµè§ˆå™¨çš„ DOMï¼Œå¯ä»¥æ˜¯å®‰å“å’Œ IOS çš„åŸç”Ÿç»„ä»¶ï¼Œå¯ä»¥æ˜¯è¿‘æœŸå¾ˆç«çƒ­çš„å°ç¨‹åºï¼Œä¹Ÿå¯ä»¥æ˜¯å„ç§ GUI æ·±æµ…æ‹·è´çš„åŒºåˆ« æ€ä¹ˆæ·±æ‹·è´ä¸€ä¸ªå‡½æ•° æµ…æ‹·è´â€”æµ…æ‹·è´æ˜¯æŒ‡å¤åˆ¶å¯¹è±¡çš„æ—¶å€™ï¼Œåªå¯¹ç¬¬ä¸€å±‚é”®å€¼å¯¹è¿›è¡Œç‹¬ç«‹çš„å¤åˆ¶ï¼Œå¦‚æœå¯¹è±¡å†…è¿˜æœ‰å¯¹è±¡ï¼Œåˆ™åªèƒ½å¤åˆ¶åµŒå¥—å¯¹è±¡çš„åœ°å€ 12// æµ…æ‹·è´æ•°ç»„a.slice() || a.concat() æ·±æ‹·è´â€”æ·±æ‹·è´æ˜¯æŒ‡å¤åˆ¶å¯¹è±¡çš„æ—¶å€™å®Œå…¨çš„æ‹·è´ä¸€ä»½å¯¹è±¡ï¼Œå³ä½¿åµŒå¥—äº†å¯¹è±¡ï¼Œä¸¤è€…ä¹Ÿç›¸äº’åˆ†ç¦»ï¼Œä¿®æ”¹ä¸€ä¸ªå¯¹è±¡çš„å±æ€§ï¼Œä¹Ÿä¸ä¼šå½±å“å¦ä¸€ä¸ªã€‚å…¶å®åªè¦é€’å½’ä¸‹å»ï¼ŒæŠŠé‚£äº›å±æ€§çš„å€¼ä»ç„¶æ˜¯å¯¹è±¡çš„å†æ¬¡è¿›å…¥å¯¹è±¡å†…éƒ¨ä¸€ ä¸€è¿›è¡Œå¤åˆ¶å³å¯ã€‚ note! JSON.parse(JSON.stringify(obj))çš„ç¼ºé™·æ˜¯ä¸èƒ½å¤Ÿæ‹·è´å‡½æ•° å› ä¸º JSON ä¸å…è®¸åŒ…å«å‡½æ•°ï¼ŒJSON.stringify() ä¼šåˆ é™¤ JavaScript å¯¹è±¡çš„å‡½æ•°ï¼ŒåŒ…æ‹¬ key å’Œ valueã€‚ è§£å†³JSON.stringifyä¸èƒ½æ‹·è´å‡½æ•°çš„é—®é¢˜ 123456789101112131415161718192021222324252627function deepClone(source, hash = new WeakMap()) &#123; let obj const Constructor = source.constructor switch (Constructor) &#123; case Date: obj = new Constructor(source.getTime()) break case RegExp: obj = new Constructor(source) break default: if (hash.has(source)) &#123; return hash.get(source) &#125; obj = new Constructor() hash.set(source, obj) break &#125; for (let key in source) &#123; obj[key] = isObject(source[key]) ? deepClone(source[key], hash) : source[key] &#125; return obj&#125; doctype çš„ä½œç”¨å£°æ˜äº†çš„è¯æµè§ˆå™¨å°±ä¼šä½¿ç”¨æ ‡å‡†æ¨¡å¼è§£æé¡µé¢ è¿™æ ·æ‰€æœ‰æµè§ˆå™¨æ˜¾ç¤ºçš„æ ·å¼å°±æ˜¯ä¸€æ ·çš„ ä½¿ç”¨symbolä¼šé‡åˆ°å“ªäº›é—®é¢˜ symbolçš„ç‰¹ç‚¹1.Symbol(â€˜keyâ€™) !== Symbol(â€˜keyâ€™) //true,è¿”å›ä¸åŒ2.Symbol(â€œknowâ€).name = 1; // TypeError,åªè¯»3.forâ€¦in ã€ Object.keys(obj) ã€Object.getOwnPropertyNames(obj)ä¼šå¿½ç•¥ Symbol,å³è‡ªèº«ä¸å¯æšä¸¾ 4.ä¸èƒ½ç”¨ obj.prop çš„å½¢å¼è®¿é—® symbolçš„ä½¿ç”¨åœºæ™¯ç¬¬ä¸€ä¸ªä½œç”¨æ˜¯ä½œä¸ºå±æ€§åé¿å…å±æ€§åå†²çªï¼Œç¬¬äºŒä¸ªä½œç”¨æ˜¯æ›¿ä»£ä»£ç ä¸­å¤šæ¬¡ä½¿ç”¨çš„å­—ç¬¦ä¸²ï¼ˆä¾‹å¦‚ï¼šabcï¼‰ï¼Œå¤šæ¬¡ä½¿ç”¨çš„å­—ç¬¦ä¸²åœ¨ä»£ç ä¸­ä¸æ˜“ç»´æŠ¤ï¼Œè€Œè¿™æ—¶å€™å®šä¹‰ä¸€ä¸ªå¯¹è±¡çš„å±æ€§ï¼ˆå±æ€§åç”¨ Symbol æ ¼å¼ï¼‰ï¼Œå€¼ä¸º abcï¼Œå°±å¯ä»¥ä½œä¸ºå…¨å±€å˜é‡æ¥ä½¿ç”¨äº†ã€‚ç¬¬ä¸‰ä¸ªï¼Œç”±äºä»¥ Symbol å€¼ä½œä¸ºåç§°çš„å±æ€§ï¼Œä¸ä¼šè¢«å¸¸è§„æ–¹æ³•éå†å¾—åˆ°ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œä¸ºå¯¹è±¡å®šä¹‰ä¸€äº›éç§æœ‰çš„ã€ä½†åˆå¸Œæœ›åªç”¨äºå†…éƒ¨çš„æ–¹æ³•ã€‚ç¬¬å››ä¸ªï¼Œè¿™ä¸ªæœ‰æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›é‡æ–°ä½¿ç”¨åŒä¸€ä¸ª Symbol å€¼ï¼ŒSymbol.for æ–¹æ³•å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ã€‚å®ƒæ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ï¼Œç„¶åæœç´¢æœ‰æ²¡æœ‰ä»¥è¯¥å‚æ•°ä½œä¸ºåç§°çš„ Symbol å€¼ã€‚å¦‚æœæœ‰ï¼Œå°±è¿”å›è¿™ä¸ª Symbol å€¼ï¼Œå¦åˆ™å°±æ–°å»ºå¹¶è¿”å›ä¸€ä¸ªä»¥è¯¥å­—ç¬¦ä¸²ä¸ºåç§°çš„ Symbol å€¼ã€‚ ç”Ÿæˆä¸€ä¸ªå”¯ä¸€å€¼ å› ä¸ºæˆ‘ä»¬åœ¨ä½¿ç”¨å®ƒçš„æ—¶å€™å±æ€§å€¼æ˜¯å¤šå°‘éƒ½æ— æ‰€è°“ 1234567var race = &#123; protoss: Symbol(), terran: Symbol(), zerg: Symbol()&#125;race.protoss !== race.terran // true åŸºæœ¬æ•°æ®ç±»å‹çš„åˆ¤æ–­ typeof Symbol() === â€˜symbolâ€™ reduxçš„åŸç†ï¼ˆè¦æ·±å…¥ ä¸­é—´ä»¶ï¼‰å…³äºä½¿ç”¨hookså®ç°reduxdispatch ä¸€ä¸ª action çš„æ—¶å€™å°† action ä¼ å…¥æ‰€æœ‰çš„ reducers,ç„¶åè¿”å›æ›´æ–°çš„ state åŒæ—¶è§¦å‘ä½¿ç”¨subscribeæ–¹æ³•æ³¨å†Œçš„æ‰€æœ‰ listener å‡½æ•°(ä¸ºä»€ä¹ˆåœ¨ hasChanged ä¸º true çš„æ—¶å€™è¿˜è¦æ¥ç€è°ƒç”¨åé¢çš„ reducers å‘¢ï¼Ÿ) ä¸ºä»€ä¹ˆreducerè¦æ˜¯ä¸€ä¸ªçº¯å‡½æ•° react æœ‰ä¸€ä¸ª shouldcomponentupdate äº‹ä»¶ä½œä¸ºä¼˜åŒ–ï¼Œå½“æˆ‘ä»¬é‡æ¸²æŸ“æ—¶ä¹Ÿå¸Œæœ›è®¢é˜…äº‹ä»¶èƒ½å·®å¼‚åŒ–æ›´æ–°ä»¥ä¼˜åŒ–æ€§èƒ½ï¼Œæ€ä¹ˆå®ç°ï¼Ÿæ¯”å¯¹ä¸€æ¬¡æ›´æ–°é‡Œçš„æ–°è€ stateå½“ reducer æ˜¯çº¯å‡½æ•°æ—¶ï¼Œç”Ÿæˆä¸€ä¸ªæ–° stateï¼Œæ–°è€å¯¹è±¡åœ°å€å¼•ç”¨ä¸ä¸€ï¼Œèƒ½å®ç°è‹¥ reducer æ˜¯å‰¯ä½œç”¨ï¼Œé‚£ä¹ˆè™½ç„¶å¯¹è±¡å†…å˜åŒ–ï¼Œæ–°è€å¯¹è±¡åœ°å€ä¸€è‡´ï¼Œä¸èƒ½å®ç°æ­¤å¤–åœ¨combinereducersä¸­åˆ¤æ–­haschangedä¹Ÿæ˜¯é€šè¿‡nextStateForKey !== previousStateForKey ç›´æ¥åˆ¤æ–­å¼•ç”¨è€Œä¸æ˜¯æ·±åº¦éå†æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡çš„å€¼ æ›´ç®€æ´ å¦‚æœä¸æ˜¯çº¯å‡½æ•° è¿”å›çš„ state å°±å…·æœ‰ä¸ç¡®å®šæ€§ é‚£ä¹ˆ UI æ‹¿åˆ°çš„æ•°æ®ä¹Ÿå…·æœ‰ä¸ç¡®å®šæ€§ redux ä¸­çš„è§‚å¯Ÿè€…æ¨¡å¼ store æä¾›æ•°æ®çš„ get é’©å­ï¼ˆstore.getStateï¼‰,ä¸ç›´æ¥æä¾›æ•°æ®çš„ setï¼Œæ‰€ä»¥å¿…é¡»é€šè¿‡ dispatchï¼ˆactionï¼‰æ¥ set æ•°æ®ã€‚ åˆ©ç”¨è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆsub/ pubï¼‰è¿æ¥ model å’Œ view çš„ä¸­é—´å¯¹è±¡ã€‚view å±‚é€šè¿‡è°ƒç”¨ store.dispatch æ–¹æ³•è§¦å‘ reducer æ”¹å˜ modelã€‚å¯¹åº” pubã€‚ model å±‚é€šè¿‡è°ƒç”¨ store.subscribe æ³¨å†Œè§†å›¾æ›´æ–°äº‹ä»¶ï¼ˆsetstateï¼‰ï¼Œè¯¥äº‹ä»¶ä¼šåœ¨æ•°æ®æ”¹å˜ä¹‹åè¢«è°ƒç”¨ã€‚å¯¹åº” subã€‚ è§‚å¯Ÿè€…æ¨¡å¼å’Œå‘å¸ƒè®¢é˜…æ¨¡å¼çš„åŒºåˆ« å…³äºæœ€è¿‘åšçš„é¡¹ç›®ï¼Œè‡ªæˆ‘ä»‹ç»ï¼Œé”™è¯¯ç›‘æ§ï¼Œå­¦äº†å“ªäº›æ–°æŠ€æœ¯ã€‚ã€‚ã€‚å…³äºå‡½æ•°ç»„ä»¶è·Ÿç±»å¼ç»„ä»¶çš„åŒºåˆ«propsæ˜¯ä¸å¯å˜æ•°æ®ï¼Œæ°¸è¿œä¸ä¼šæ”¹å˜ã€‚ä½†æ˜¯ï¼Œthiså´å§‹ç»ˆæ˜¯å¯å˜çš„ ã€‚æ‰€ä»¥é€šè¿‡thisæ‹¿åˆ°çš„æ°¸è¿œéƒ½æ˜¯æœ€æ–°çš„å€¼ 123456789101112131415161718192021222324class ProfilePage extends React.Component &#123; showMessage = () =&gt; &#123; alert('Followed ' + this.props.user) &#125; handleClick = () =&gt; &#123; setTimeout(this.showMessage, 3000) &#125; render() &#123; return &lt;button onClick=&#123;this.handleClick&#125;&gt;Follow&lt;/button&gt; &#125;&#125;function ProfilePage(props) &#123; const showMessage = () =&gt; &#123; alert('Followed ' + props.user) &#125; const handleClick = () =&gt; &#123; setTimeout(showMessage, 3000) &#125; return &lt;button onClick=&#123;handleClick&#125;&gt;Follow&lt;/button&gt;&#125; å½“ç‚¹å‡» follow ä¹‹åå†åˆ‡æ¢ç”¨æˆ·çš„åå­—ï¼Œä¸‰ç§’ä¹‹åå‡½æ•°ç»„ä»¶å¼¹å‡ºæ¥çš„ä¾æ—§æ˜¯ç‚¹å‡» follow çš„æ—¶å€™çš„ç”¨æˆ·çš„åå­—è€Œç±»ç»„ä»¶å¼¹å‡ºæ¥çš„å´æ˜¯åˆ‡æ¢ä¹‹åçš„åå­—ï¼Œæ˜¯å› ä¸ºå‡½æ•°ç»„ä»¶èƒ½æ•è·æŸä¸€æ—¶åˆ»çš„ props ä¸ stateï¼ˆhooks ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼‰ ç®—æ³•çº¢é»‘æ ‘æœ¬è´¨æ˜¯ä¸€ç§äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œä¹Ÿå°±æ˜¯å·¦è¾¹çš„å­èŠ‚ç‚¹çš„å€¼æ¯”æ ¹èŠ‚ç‚¹å°ï¼Œå³è¾¹çš„æ¯”æ ¹èŠ‚ç‚¹å¤§ï¼Œåœ¨æç«¯æƒ…å†µä¸‹ï¼Œæ¯”å¦‚è¿ç»­æ’å…¥ä¾æ¬¡é€’å¢æˆ–é€’å‡çš„èŠ‚ç‚¹ï¼ŒæŸ¥æ‰¾æ ‘å°†é€€åŒ–æˆé“¾è¡¨çº¢é»‘æ ‘é€šè¿‡å¦‚ä¸‹çš„æ€§è´¨å®šä¹‰å®ç°è‡ªå¹³è¡¡ï¼š èŠ‚ç‚¹æ˜¯çº¢è‰²æˆ–é»‘è‰²ã€‚æ ¹æ˜¯é»‘è‰²ã€‚æ‰€æœ‰å¶å­éƒ½æ˜¯é»‘è‰²ï¼ˆå¶å­æ˜¯ NIL èŠ‚ç‚¹ï¼‰ã€‚æ¯ä¸ªçº¢è‰²èŠ‚ç‚¹å¿…é¡»æœ‰ä¸¤ä¸ªé»‘è‰²çš„å­èŠ‚ç‚¹ã€‚ï¼ˆä»æ¯ä¸ªå¶å­åˆ°æ ¹çš„æ‰€æœ‰è·¯å¾„ä¸Šä¸èƒ½æœ‰ä¸¤ä¸ªè¿ç»­çš„çº¢è‰²èŠ‚ç‚¹ã€‚ï¼‰ä»ä»»ä¸€èŠ‚ç‚¹åˆ°å…¶æ¯ä¸ªå¶å­çš„æ‰€æœ‰ç®€å•è·¯å¾„éƒ½åŒ…å«ç›¸åŒæ•°ç›®çš„é»‘è‰²èŠ‚ç‚¹ï¼ˆç®€ç§°é»‘é«˜ï¼‰ å®ç°æ¨¡ç³Šæœç´¢ç»“æœçš„å…³é”®è¯é«˜äº®æ˜¾ç¤ºè€ƒè™‘èŠ‚æµã€ç¼“å­˜ã€‚å…¶å®è¿˜å¯ä»¥ä¸Šåˆ—è¡¨diff+å®šæ—¶æ¸…ç†ç¼“å­˜ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647function debounce(fn, timeout = 300) &#123; let t; return (...args) =&gt; &#123; if (t) &#123; clearTimeout(t); &#125; t = setTimeout(() =&gt; &#123; fn.apply(fn, args); &#125;, timeout); &#125; &#125;// dataåº”è¯¥æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æ•°ç»„ ä¸ºäº†å‡å°cacheå çš„å†…å­˜ ç¼“å­˜ç”¨æˆ·è¾“å…¥è¿‡çš„å…³é”®è¯ function memorize(fn) &#123; const cache = new Map(); return (name) =&gt; &#123; if (!name) &#123; container.innerHTML = ''; return; &#125; if (cache.get(name)) &#123; container.innerHTML = cache.get(name); return; &#125; const res = fn.call(fn, name).join(''); cache.set(name, res); container.innerHTML = res; &#125; &#125; function handleInput(value) &#123; const reg = new RegExp(`\\($&#123;value&#125;\\)`); const search = data.reduce((res, cur) =&gt; &#123; if (reg.test(cur)) &#123; const match = RegExp.$1; res.push(`&lt;li&gt;$&#123;cur.replace(match, '&lt;bdi&gt;$&amp;&lt;/bdi&gt;')&#125;&lt;/li&gt;`); &#125; return res; &#125;, []); return search; &#125; const data = [\"ä¸Šæµ·é‡ç”ŸåŠ¨ç‰©å›­\", \"ä¸Šé¥¶é‡ç”ŸåŠ¨ç‰©å›­\", \"åŒ—äº¬å··å­\", \"ä¸Šæµ·ä¸­å¿ƒ\", \"ä¸Šæµ·é»„åŸ”æ±Ÿ\", \"è¿ªå£«å°¼ä¸Šæµ·\", \"é™†å®¶å˜´ä¸Šæµ·ä¸­å¿ƒ\"] const container = document.querySelector('.container'); const memorizeInput = memorize(handleInput); document.querySelector('.inp').addEventListener('input', debounce(e =&gt; &#123; memorizeInput(e.target.value); &#125;)) å‚è€ƒæ–‡ç«  è™šæ‹Ÿ DOM åˆ°åº•æ˜¯ä»€ä¹ˆ MVC å’Œ MVVM çš„åŒºåˆ« React å‡½æ•°ç»„ä»¶å’Œç±»ç»„ä»¶çš„å·®å¼‚ â€œæ·±æ‹·è´â€ ä¸ â€œæµ…æ‹·è´â€ çš„åŒºåˆ«ï¼ŒJS å®ç°æ·±æµ…æ‹·è´çš„å‡ ç§æ–¹æ³• ã€Œæ¯æ—¥ä¸€é¢˜ã€JS ä¸­çš„ Symbol æ˜¯ä»€ä¹ˆï¼Ÿ å‰ç«¯ 100 é—®ï¼šèƒ½ææ‡‚ 80%çš„è¯·æŠŠç®€å†ç»™æˆ‘","categories":[{"name":"é¢ç»","slug":"é¢ç»","permalink":"https://ashleyblog.xyz/categories/é¢ç»/"}],"tags":[]},{"title":"é¢ç»é¡¹ç›®æ„å»ºç¯‡","slug":"é¢ç»é¡¹ç›®æ„å»ºç¯‡","date":"2019-12-11T02:58:38.000Z","updated":"2023-04-02T14:00:30.286Z","comments":true,"path":"2019/12/11/é¢ç»é¡¹ç›®æ„å»ºç¯‡/","link":"","permalink":"https://ashleyblog.xyz/2019/12/11/é¢ç»é¡¹ç›®æ„å»ºç¯‡/","excerpt":"","text":"æ€ä¹ˆçº¦æŸä»£ç è§„èŒƒï¼Ÿç»“åˆlint-stagedä¸husky å®ç°åœ¨æ¯æ¬¡æäº¤ä¹‹å‰ è‡ªåŠ¨ä¿®å¤æœ¬æ¬¡ä¿®æ”¹çš„ä»£ç  123456789101112131415161718&#123; \"scripts\": &#123; \"precommit\": \"lint-staged\" //è¿™ä¸ªé’©å­æ˜¯åœ¨å®‰è£…huskyä¹‹åæ‰æœ‰çš„ package.jsonä¸­åŸæœ‰çš„é’©å­:https://segmentfault.com/a/1190000008832423 &#125;, \"lint-staged\": &#123; \"src/**/*.js\": [\"eslint --fix\", \"git add\"] &#125;&#125;// æˆ–è€…ä½¿ç”¨ä¸‹é¢çš„é…ç½®ï¼Œè‡ªåŠ¨æ ¼å¼åŒ–ä»£ç ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰ï¼š&#123; \"scripts\": &#123; \"precommit\": \"lint-staged\" &#125;, \"lint-staged\": &#123; \"src/**/*.js\": [\"prettier --write\", \"git add\"] &#125;&#125; webpackæ‰“åŒ…ä¼˜åŒ– å®šä½ä½“ç§¯å¤§çš„æ¨¡å— - webpack-bundle-analyzer ç§»é™¤ä¸å¿…è¦çš„æ–‡ä»¶ä½¿ç”¨webpackè‡ªå¸¦çš„ä¸¤ä¸ªåº“ IgnorePlugin ContextReplacementPlugin 12345678910// æ’ä»¶é…ç½®plugins: [ // å¿½ç•¥moment.jsä¸­æ‰€æœ‰çš„localeæ–‡ä»¶ new webpack.IgnorePlugin(/^\\.\\/locale$/, /moment$/),],// ä½¿ç”¨æ–¹å¼const moment = require('moment');// å¼•å…¥zh-cn localeæ–‡ä»¶require('moment/locale/zh-cn');moment.locale('zh-cn'); æ¨¡å—åŒ–å¼•ç”¨ 1234import &#123;chain, cloneDeep&#125; from 'lodash';// å¯ä»¥æ”¹å†™ä¸ºimport chain from 'lodash/chain';import cloneDeep from 'lodash/cloneDeep'; é€šè¿‡CDNå¼•ç”¨ æœåŠ¡ç«¯å¼€å¯Gzipå‹ç¼©å¼€å¯gzipå‹ç¼©å¯ä»¥å‡å°‘HTTPä¼ è¾“çš„æ•°æ®é‡å’Œæ—¶é—´ï¼Œä»è€Œå‡å°‘å®¢æˆ·ç«¯è¯·æ±‚çš„å“åº”æ—¶é—´ splitChunksé…ç½®ä»£ç åˆ†å‰²æ­¤ç‰¹æ€§èƒ½å¤ŸæŠŠä»£ç åˆ†ç¦»åˆ°ä¸åŒçš„ bundle ä¸­ï¼Œç„¶åå¯ä»¥æŒ‰éœ€åŠ è½½æˆ–å¹¶è¡ŒåŠ è½½è¿™äº›æ–‡ä»¶ã€‚ä»£ç åˆ†ç¦»å¯ä»¥ç”¨äºè·å–æ›´å°çš„ bundleï¼Œä»¥åŠæ§åˆ¶èµ„æºåŠ è½½ä¼˜å…ˆçº§ï¼Œå¦‚æœä½¿ç”¨åˆç†ï¼Œä¼šæå¤§å½±å“åŠ è½½æ—¶é—´ã€‚ webpack çƒ­æ›´æ–°åŸç†åœ¨ webpack ä¸­ï¼Œéƒ½æ˜¯æ¨¡å—ä¸”æœ‰å”¯ä¸€æ ‡è¯†ã€‚åœ¨ webpack ç¼–è¯‘å®Œæˆåï¼Œå°†ä¿®æ”¹çš„æ¨¡å— hash å¯¹åº”çš„æ¨¡å—é‡æ–°æ‰§è¡Œã€‚å°±è¾¾åˆ°äº†å±€éƒ¨åˆ·æ–°çš„æ•ˆæœã€‚ è¿‡ç¨‹webpack-dev-middleware æ˜¯ç”¨æ¥å¤„ç†æ–‡ä»¶æ‰“åŒ…åˆ°å“ªé‡Œï¼Œåˆ°å†…å­˜è¯»å–é€Ÿåº¦æ›´å¿«ã€‚devServer åœ¨ç›‘å¬ compiler done åï¼Œåˆ©ç”¨ socket å‘Šè¯‰ devServer/client ä¿®æ”¹æ¨¡å—çš„ hashHMR.runtime åˆ©ç”¨ HTTP è¯·æ±‚ hash.hot-update.json è·å–æ›´æ–°æ¨¡å—åˆ—è¡¨ hotDownloadManifest{â€œhâ€:â€11ba55af05df7c2d3d13â€,â€câ€:{â€œindex-wrapâ€:true}}å†é€šè¿‡ HTTP (jsonp) è·å–æ›´æ–°æ¨¡å—çš„ jsindex-wrap.7466b9e256c084c8463f.hot-update.jsè¿”å›æ‰§è¡Œ 123webpackHotUpdate(\"index-wrap\", &#123; // ....&#125;) webpackHotUpdate åšäº†ä¸‰ä»¶äº‹æ‰¾åˆ°è¿‡æœŸçš„æ¨¡å—å’Œä¾èµ–å¹¶ä»ç¼“å­˜ä¸­åˆ é™¤ 12delete installedModules[moduleId];delete outdatedDependencies[moduleId]; éå†æ‰€æœ‰çš„ module.childrenï¼Œé‡æ–° installedModules æ‰€æœ‰çš„å­æ¨¡å—æœ€åå°†è‡ªèº«æ¨¡å—çš„å†…å®¹åšæ›¿æ¢ä¿®æ”¹ 1modules[moduleId] = appliedUpdate[moduleId] æœ€åä»£ç æ›¿æ¢ä¹‹åå¹¶æ²¡æœ‰é‡æ–°æ‰§è¡Œï¼Œéœ€è¦æ‰‹åŠ¨æ³¨å†Œéœ€è¦é‡æ–°æ‰§è¡Œçš„æ¨¡å—æ–¹æ³• 123456if (module.hot) &#123; module.hot.accept('./print.js', function() &#123; console.log('Accepting the updated printMe module!'); printMe(); &#125;) &#125; å›½é™…åŒ–æ–¹æ¡ˆåç«¯åœ¨cookieä¸­è®¾ç½®applocalå­—æ®µ å‰ç«¯å†å»æ‹¿ã€‚ã€‚ã€‚ å‚è€ƒæ–‡ç«  [ç”¨ husky å’Œ lint-staged æ„å»ºè¶…æºœçš„ä»£ç æ£€æŸ¥å·¥ä½œæµ](ç”¨ husky å’Œ lint-staged æ„å»ºè¶…æºœçš„ä»£ç æ£€æŸ¥å·¥ä½œæµ) Webpackæ‰“åŒ…ä¼˜åŒ– è½»æ¾ç†è§£webpackçƒ­æ›´æ–°åŸç†","categories":[],"tags":[{"name":"é…ç½®","slug":"é…ç½®","permalink":"https://ashleyblog.xyz/tags/é…ç½®/"}]},{"title":"é¢ç»jsç¯‡","slug":"é¢ç»jsç¯‡","date":"2019-12-10T10:48:35.000Z","updated":"2023-04-02T14:00:30.289Z","comments":true,"path":"2019/12/10/é¢ç»jsç¯‡/","link":"","permalink":"https://ashleyblog.xyz/2019/12/10/é¢ç»jsç¯‡/","excerpt":"","text":"åŸç”Ÿ jstypeofçš„åŸç†js åœ¨åº•å±‚å­˜å‚¨å˜é‡çš„æ—¶å€™ï¼Œä¼šåœ¨å˜é‡çš„æœºå™¨ç çš„ä½ä½ 1-3 ä½å­˜å‚¨å…¶ç±»å‹ä¿¡æ¯ ğŸ‘‰ 000ï¼šå¯¹è±¡010ï¼šæµ®ç‚¹æ•°100ï¼šå­—ç¬¦ä¸²110ï¼šå¸ƒå°”1ï¼šæ•´æ•° but, å¯¹äº undefined å’Œ null æ¥è¯´ï¼Œè¿™ä¸¤ä¸ªå€¼çš„ä¿¡æ¯å­˜å‚¨æ˜¯æœ‰ç‚¹ç‰¹æ®Šçš„ã€‚nullï¼šæ‰€æœ‰æœºå™¨ç å‡ä¸º 0undefinedï¼šç”¨ âˆ’2^30 æ•´æ•°æ¥è¡¨ç¤ºæ‰€ä»¥ï¼Œtypeof åœ¨åˆ¤æ–­ null çš„æ—¶å€™å°±å‡ºç°é—®é¢˜äº†ï¼Œç”±äº null çš„æ‰€æœ‰æœºå™¨ç å‡ä¸º 0ï¼Œå› æ­¤ç›´æ¥è¢«å½“åšäº†å¯¹è±¡æ¥çœ‹å¾…ã€‚ instanceofçš„åŸç†é€šè¿‡åˆ¤æ–­å³è¾¹çš„å˜é‡çš„prototypeæ˜¯å¦åœ¨å·¦è¾¹çš„å˜é‡çš„åŸå‹é“¾ä¸Š 123456789101112function myInstanceOf(leftVal, rightVal) &#123; let rightProto = rightVal.prototype let leftCopy = leftVal.__proto__ while (true) &#123; if (leftCopy === null) &#123; return false &#125; else if (leftCopy === rightProto) &#123; return true &#125; leftCopy = leftCopy.__proto__ &#125;&#125; ç”ŸæˆæŒ‡å®šèŒƒå›´å†…çš„éšæœºæ•°1234function RandomNum (min, max) &#123; let range = max - min return Math.round(Math.random()*range) + min&#125; null undefined çš„åŒºåˆ«å‰è€…æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å¯¹è±¡ ä¸ä¼šè¢«åƒåœ¾å›æ”¶æœºåˆ¶å›æ”¶ å‰è€…è½¬æ¢æˆæ•°å­—æ˜¯ 0 åè€…æ˜¯ NaN å‡½æ•°å‚æ•°æ˜¯æŒ‰å€¼ä¼ é€’ ä¸ºä»€ä¹ˆä¼ ä¸€ä¸ªå¯¹è±¡è¿›å» å‡½æ•°å†…éƒ¨çš„ä¿®æ”¹ä¼šå½±å“è¯¥å¯¹è±¡ä¼ çš„æ˜¯æ˜¯æ ˆå†…æ•°æ®çš„æ‹·è´ç®€å•æ•°æ®ç±»å‹ä¼ çš„æ˜¯ å€¼æœ¬èº« ï¼ˆå› ä¸ºç›´æ¥æŠŠå€¼å­˜åœ¨æ ˆå†…ï¼‰å¤æ‚æ•°æ®ç±»å‹ä¼ çš„æ˜¯ å¯¹è±¡åœ¨å†…å­˜é‡Œé¢çš„åœ°å€ ï¼ˆå› ä¸ºå¤æ‚å¯¹è±¡å­˜åœ¨å †å†…ï¼Œæ‰€ä»¥åœ¨æ ˆé‡Œå­˜å¯¹è±¡æ‰€åœ¨çš„å †åœ°å€ï¼‰ ä½ è§‰å¾—jQueryæˆ–zeptoæºç æœ‰å“ªäº›å†™çš„å¥½çš„åœ°æ–¹jqueryæºç å°è£…åœ¨ä¸€ä¸ªåŒ¿åå‡½æ•°çš„è‡ªæ‰§è¡Œç¯å¢ƒä¸­ï¼Œæœ‰åŠ©äºé˜²æ­¢å˜é‡çš„å…¨å±€æ±¡æŸ“ï¼Œç„¶åé€šè¿‡ä¼ å…¥windowå¯¹è±¡å‚æ•°ï¼Œå¯ä»¥ä½¿windowå¯¹è±¡ä½œä¸ºå±€éƒ¨å˜é‡ä½¿ç”¨ï¼Œå¥½å¤„æ˜¯å½“jqueryä¸­è®¿é—®windowå¯¹è±¡çš„æ—¶å€™ï¼Œå°±ä¸ç”¨å°†ä½œç”¨åŸŸé“¾é€€å›åˆ°é¡¶å±‚ä½œç”¨åŸŸäº†ï¼Œä»è€Œå¯ä»¥æ›´å¿«çš„è®¿é—®windowå¯¹è±¡ã€‚åŒæ ·ï¼Œä¼ å…¥undefinedå‚æ•°ï¼Œå¯ä»¥ç¼©çŸ­æŸ¥æ‰¾undefinedæ—¶çš„ä½œç”¨åŸŸé“¾ã€‚ 12345678910111213(function( window, undefined ) &#123; //ç”¨ä¸€ä¸ªå‡½æ•°åŸŸåŒ…èµ·æ¥ï¼Œå°±æ˜¯æ‰€è°“çš„æ²™ç®± //åœ¨è¿™é‡Œè¾¹varå®šä¹‰çš„å˜é‡ï¼Œå±äºè¿™ä¸ªå‡½æ•°åŸŸå†…çš„å±€éƒ¨å˜é‡ï¼Œé¿å…æ±¡æŸ“å…¨å±€ //æŠŠå½“å‰æ²™ç®±éœ€è¦çš„å¤–éƒ¨å˜é‡é€šè¿‡å‡½æ•°å‚æ•°å¼•å…¥è¿›æ¥ //åªè¦ä¿è¯å‚æ•°å¯¹å†…æä¾›çš„æ¥å£çš„ä¸€è‡´æ€§ï¼Œä½ è¿˜å¯ä»¥éšæ„æ›¿æ¢ä¼ è¿›æ¥çš„è¿™ä¸ªå‚æ•° window.jQuery = window.$ = jQuery;&#125;)( window ); è™šæ‹Ÿdom ä¸ºä»€ä¹ˆç›´æ¥æ“ä½œdomè€—æ—¶v8 bindingä¼šå°†åŸç”Ÿçš„domå¯¹è±¡ï¼ˆæ¯”å¦‚document.a)æ˜ å°„æˆåŒ…è£…çš„jså¯¹è±¡ï¼Œæ‰€ä»¥æ‰§è¡Œdocument.a=ã€‚ã€‚ã€‚å¾ˆå¿«ä½†æ˜¯document.title=ã€‚ã€‚ã€‚å¾ˆæ…¢æ˜¯å› ä¸ºä¿®æ”¹titleçš„æ—¶å€™åŒæ—¶ä¹Ÿä¿®æ”¹äº† DOM å¯¹è±¡çš„ attributesæ­¤å¤–å¾ˆå¤šæ—¶å€™æ“ä½œdoméƒ½ä¼šå¼•èµ·é‡ç»˜ä¸å›æµ å¹¶ä¸”å¾ˆå¤šdom apiçš„è¯»å†™éƒ½ä¼šè®¾è®¡é¡µé¢å¸ƒå±€çš„é‡æ–°è®¡ç®—ä»¥ç¡®ä¿è¿”å›å€¼çš„å‡†ç¡® è™šæ‹Ÿdomä¸å¿« ä¸ºä»€ä¹ˆreactå¿« React is fast because it only manipulates the DOM as much as it needs to,Updating changes is much faster than re-building the entire DOM tree from scratch. Itâ€™s able to do this because it keeps the virtual DOM representation from the last time we updated or rendered our component in memory. It then compares the two versions and updates the changes. React Virtual DOM is an object,when we create an webpage browser create dom in a tree manner. to find the changes in two different trees &gt;time complexity is O(n^3) but REACT DIFF algorithm can able to do it in O(n) time by using keys of each node.that is why react is faster ä¸ºä»€ä¹ˆè™šæ‹Ÿdomæ€§èƒ½æ›´å¥½ ä¼ ç»ŸMVCæ¡†æ¶,å¦‚backbone,å®ƒæ˜¯å°†æŸä¸ªæ¨¡æ¿ç¼–è¯‘æˆæ¨¡æ¿å‡½æ•°,éœ€è¦æ›´æ–°æ—¶,æ˜¯è‡ªå·±æ‰‹åŠ¨å°†æ•°æ®æ•´ä½“ä¼ å…¥æ¨¡æ¿å‡½æ•°, å¾—åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²,ä½¿ç”¨innerHTMLåˆ·æ–°æŸä¸ªå®¹å™¨!æ³¨æ„,è¿™é‡Œå…¶å®å¯ä»¥ä¼˜åŒ–,ä½†ç”±äºæ˜¯æ‰‹åŠ¨,æ˜¯ä½“åŠ›æ´»,éƒ½æ˜¯ä½¿ç”¨å¾ˆç²—æ”¾å‹çš„innerhTMLäº†äº‹ (ä½¿ç”¨jQueryçš„htmlæ–¹æ³•æ€§èƒ½ä¼šæ›´å·®,ä¸è¿‡å¥½å¤„æ˜¯å®ƒå¤„ç†äº†IEä¸‹çš„innerHTML BUGåŠå…¨å¹³å°çš„æ— æ³•æ‰§è¡Œå†…éƒ¨çš„scriptæ ‡ç­¾çš„BUG) ç”±äºæ•´ä½“æ›¿æ¢,ä¸€ä¸‹å­é”€æ¯è¿™ä¹ˆå¤šå…ƒç´ (æœ‰æ—¶è¿˜ç»‘ç€äº‹ä»¶,å¯èƒ½å¯¼è‡´GCå‡ºé—®é¢˜),åˆè¦æ’å…¥è¿™ä¹ˆå¤šå…ƒç´ ,å†é‡æ–°ç»‘å®šäº‹ä»¶(è¿™ä¸ªå¯ä»¥ä½¿ç”¨äº‹ä»¶ä»£ç†ç¼“è§£) å› æ­¤æ€§èƒ½éå¸¸å·® knockouté‚£æ ·, ä½¿ç”¨æ—¶è®©ç”¨æˆ·ç—›è‹¦ä¸€äº›,ä½¿ç”¨å¯åŒæ­¥è§†å›¾çš„ä¸œè¥¿ç”¨å‡½æ•°(wrapper)åŒ…è£¹èµ·æ¥, åˆ·æ–°è§†å›¾,å°±åªéœ€è¦é‡æ–°è°ƒç”¨è¿™ä¸ªwrapper.ç°åœ¨æ‰€æœ‰æ–°çš„MVVMéƒ½æ˜¯ä»koé‚£é‡Œå­¦åˆ°ä¾èµ–æ”¶é›†. è¿™ä¸ªwraperä¼šé€šçŸ¥å…¶ä¾èµ–çš„wrapper,é€šè¿‡æå…¶ç—›è‹¦æ™¦æ¶©çš„æ–¹å¼è¿›å…¥äº‹ä»¶æ€»çº¿, æ‰§è¡Œè§†å›¾åˆ·æ–°å‡½æ•°. knockoutæ˜¯ä½¿ç”¨é—­åŒ…ç”¨åˆ°æè‡´çš„åº“,æ˜¾ç„¶è¿™æ ·åšæ€§èƒ½ä¹Ÿå¾ˆå·®. æœ€åreact, é¦–å…ˆä½¿ç”¨ç¼–è¯‘æ‰‹æ®µ(jsxçš„è™šæ‹ŸDOMè½¬æ¢), å°†è¿™éƒ¨åˆ†æ¶ˆè€—èƒ½æå‰é‡Šæ”¾å‡ºå», ä¸è¿‡å°†å­—ç¬¦ä¸²(jsxæ¨¡æ¿)è½¬æ¢ä¸ºä¸€ä¸ªä¸ªJSå¯¹è±¡,ä¹Ÿå ä¸äº†å¤šå°‘å†…å­˜. ç„¶åæ˜¯æ•°æ®å‘ç”Ÿå˜åŠ¨æ—¶, ç”±äºæ•°æ®å˜åŠ¨éƒ½æ˜¯éœ€è¦ç”¨setStateæ–¹æ³•,å› æ­¤å…¼å®¹æ€§å¾ˆå¥½, å°‘äº†Object.definePropertyæˆ–wrapperçš„æ¶ˆè€—,ç„¶åå¯¹åº”æ•°æ®é€šè¿‡renderè½¬æ¢æˆå­—ç¬¦ä¸²,å­—ç¬¦ä¸²å†è½¬æ¢è™šæ‹ŸDOMæ ‘ å…ˆåè™šæ‹ŸDOMè¿›è¡Œæ¯”è¾ƒ, æ›´æ–°è§†å›¾. reactæ˜¯é¢å‘ç»„ä»¶è®¾è®¡, ä¸€ä¸ªç»„ä»¶å°±æ˜¯ä¸€ä¸ªå¯†å°èˆ±, å¾ˆå°‘ä¼šå¯¹æ‰€æœ‰è™šæ‹ŸDOMè¿›è¡Œæ¯”è¾ƒ, ç”±äºå¼ºåˆ¶ä½¿ç”¨å•å‘æµåŠ¨, å‡å°‘æ¯æ¬¡å˜åŠ¨éœ€è¦çš„diff. æ²¡æœ‰ç»‘å®šå¯¹è±¡ä¸wrapperçš„å†…å­˜å ç”¨é«˜çš„é—®é¢˜. å®ç°å‡½æ•°æŸ¯é‡ŒåŒ–123456789101112function curry(f) &#123; const context = this let args = [] return function(...arg) &#123; args = args.concat(arg) if (arg.length) &#123; return arguments.callee &#125; else &#123; return f.apply(context, arg) &#125; &#125;&#125; arguments.callee ä¸arguments.callerçš„åŒºåˆ«1234567function f() &#123; // arguments.callee : [Function:f] // arguments.caller : [Function:g]&#125;function g() &#123; f()&#125; ç±»æ•°ç»„å¯¹è±¡æœ‰å“ªäº›å…·æœ‰lengthå±æ€§çš„å¹¶ä¸”èƒ½ä½¿ç”¨ç´¢å¼•è®¿é—®çš„ æ¯”å¦‚arguments domç›¸å…³çš„æ•°æ®ç»“æ„ localstorage sesstionstorage.. å‡½æ•°æå‡è·Ÿå˜é‡æå‡å‡½æ•°å£°æ˜çš„ä¼˜å…ˆçº§æœ€é«˜ï¼Œä¼šè¢«æå‡è‡³å½“å‰ä½œç”¨åŸŸæœ€é¡¶ç«¯ å®ç°æ·±æ‹·è´å¾ªç¯é€’å½’å®ç°12345678910111213141516171819202122232425262728293031var a = &#123; name: 'mary', age: 20, friend: &#123; name: 'å“ˆå“ˆ', age: 19, hobby: 'eat' &#125;&#125;function deep(obj) &#123; var newobj = &#123;&#125; for (var key in obj) &#123; // æ­¤å¤„éå†çš„keyåŒ…æ‹¬äº†å®ä¾‹å¯¹è±¡å’Œå®ƒåŸå‹çš„å±æ€§ï¼Œæ‰€ä»¥è¦ç”¨hasOwnPropertyè¿›è¡Œç­›é€‰(nodeç¯å¢ƒä¸ä¼šï¼Œæµè§ˆå™¨ç¯å¢ƒä¼šåˆ—ä¸¾åŸå‹å±æ€§) if (obj.hasOwnProperty(key)) &#123; // å¦‚æœæ˜¯åŸºæœ¬ç±»å‹åˆ™è¿›è¡Œå¤åˆ¶ if ( typeof obj[key] === 'number' || typeof obj[key] === 'string' || typeof obj[key] === 'boolean' || obj[key] === undefined || obj[key] === null ) &#123; newobj[key] = obj[key] // å¦‚æœä¸æ˜¯åˆ™ä¸ºarrayæˆ–è€…object,ä»ç„¶éœ€è¦æ·±å±‚æ¬¡çš„é€’å½’å¤åˆ¶ &#125; else &#123; newobj[key] = deep(obj[key]) &#125; &#125; &#125; return newobj&#125; load äº‹ä»¶ä¸ DOMContentLoaded äº‹ä»¶,$(document).ready() å½“ DOMContentLoaded äº‹ä»¶è§¦å‘æ—¶ï¼Œä»…å½“ DOM åŠ è½½å®Œæˆï¼Œä¸åŒ…æ‹¬æ ·å¼è¡¨ï¼Œå›¾ç‰‡ã€‚ å½“ onload äº‹ä»¶è§¦å‘æ—¶ï¼Œé¡µé¢ä¸Šæ‰€æœ‰çš„ DOMï¼Œæ ·å¼è¡¨ï¼Œè„šæœ¬ï¼Œå›¾ç‰‡éƒ½å·²ç»åŠ è½½å®Œæˆäº†ã€‚ $(document).ready()æ˜¯DOMç»“æ„ç»˜åˆ¶å®Œæ¯•åå°±æ‰§è¡Œï¼Œä¸å¿…ç­‰åˆ°åŠ è½½å®Œæ¯• window.onloadä¸èƒ½åŒæ—¶ç¼–å†™å¤šä¸ªï¼Œå¦‚æœæœ‰å¤šä¸ªwindow.onloadæ–¹æ³•ï¼Œåªä¼šæ‰§è¡Œä¸€ä¸ªï¼Œ$(document).ready()å¯ä»¥åŒæ—¶ç¼–å†™å¤šä¸ªï¼Œå¹¶ä¸”éƒ½å¯ä»¥å¾—åˆ°æ‰§è¡Œ,$(document).ready(function(){})å¯ä»¥ç®€å†™æˆ$(function(){}) æ„é€ å‡½æ•°çš„è¿”å›å€¼ æ„é€ å‡½æ•°ä¸éœ€è¦æ˜¾ç¤ºçš„è¿”å›å€¼ã€‚ä½¿ç”¨ new æ¥åˆ›å»ºå¯¹è±¡(è°ƒç”¨æ„é€ å‡½æ•°)æ—¶ï¼Œå¦‚æœ return çš„æ˜¯éå¯¹è±¡(æ•°å­—ã€å­—ç¬¦ä¸²ã€å¸ƒå°”ç±»å‹ç­‰)ä¼šå¿½è€Œç•¥è¿”å›å€¼;å¦‚æœ return çš„æ˜¯å¯¹è±¡ï¼Œåˆ™è¿”å›è¯¥å¯¹è±¡(æ³¨ï¼šè‹¥ return null ä¹Ÿä¼šå¿½ç•¥è¿”å›å€¼ï¼‰ã€‚ å¤§æ•°æ±‚å’Œé‡‡ç”¨å°æ—¶ä¾¯å­¦åŠ æ³•æ—¶çš„æ‰‹åŠ¨è®¡ç®—çš„æ–¹æ³•ï¼Œä»æœ€ä½ä½ä¾æ¬¡ç›¸åŠ ï¼Œå¾—åˆ°æœ€åçš„ç»“æœå› ä¸ºå¯¹äºè¾ƒå¤§çš„æ•°jsä¼šè‡ªåŠ¨é‡‡ç”¨ç§‘å­¦è®°æ•°æ³•çš„æ–¹å¼è¡¨ç¤ºï¼Œæ‰€ä»¥å‚ä¸è®¡ç®—çš„å‚æ•°ç”¨å­—ç¬¦ä¸²è¡¨ç¤º 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758function getSum(d1, d2) &#123; // å¦‚æœç¬¬ä¸€ä¸ªæ•°è¾ƒå¤§åˆ™äº¤æ¢ä¸¤ä¸ªæ•° if (d1.length &lt; d2.length) &#123; [d1, d2] = [d2, d1]; &#125; // å°†ä¸¤ä¸ªæ•°è½¬ä¸ºæ•°ç»„å½¢å¼ let [arr1, arr2] = [[...d1].reverse(), [...d2].reverse()]; // numç”¨ä½œå½“å¯¹åº”ä½æ•°ç›¸åŠ å¤§äº10æ—¶åšè¿›ä½ let num = 0; // å¾ªç¯arr1.lengthæ¬¡æ±‚å’Œ for (let i = 0; i &lt; arr1.length; i++) &#123; if (arr2[i]) &#123; arr1[i] = Number.parseInt(arr1[i]) + Number.parseInt(arr2[i]) + num; &#125; else &#123; arr1[i] = Number.parseInt(arr1[i]) + num; &#125; if (arr1[i] &gt;= 10) &#123; [arr1[i], num] = [arr1[i] % 10, 1]; &#125; else &#123; num = 0; &#125; &#125; // å¦‚æœæœ€åè¿›ä½ä¸º1ï¼Œåˆ™ç»“æœå‰åº”åŠ 1ä¸º if (num === 1) &#123; arr1[arr1.length] = num; &#125; // è¿”å›ç»“æœå­—ç¬¦ä¸² return arr1.reverse().join('');&#125;args=args.concat(arg)``` ### generatorå‡½æ•°çš„ä½¿ç”¨åœºæ™¯* å¤šæ–‡ä»¶ä¸Šä¼  ä¸Šä¼ å®Œç¬¬ä¸€ç»„æ–‡ä»¶ä¹‹åæš‚åœæ‰§è¡Œ åšå…¶ä»–çš„äº‹æƒ… ä¹‹åå†ç»§ç»­ä¸Šä¼  é€šè¿‡è¿”å›å€¼doneå±æ€§æ˜¯å¦ä¸ºçœŸæ¥åˆ¤æ–­èƒ½å¦ç»§ç»­æ‰§è¡Œ* ç”Ÿæˆå…·æœ‰indexçš„enumerateç»“æ„ (è¿”å›çš„æ˜¯iteratorå¯¹è±¡ èƒ½ç›´æ¥ä½¿ç”¨for inéå†ï¼Œä¹Ÿèƒ½ä½œä¸ºArray.fromç­‰çš„å‚æ•°)### æ·±åº¦æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡1.é€šè¿‡json.parse(json.stringify)... ç›¸ç­‰ç›´æ¥è¿”å›true2.object.keys.lengthä¸ç›¸ç­‰ è¿”å›false3.éå† é‡åˆ°ä¸ºå¯¹è±¡çš„å±æ€§é€’å½’### å®ç° bind```js// å®šä¹‰è¿™ä¸ªæ–¹æ³•ä¸ºmyBindFunction.prototype.my_bind = function() &#123; var self = this, // ä¿å­˜åŸå‡½æ•° context = Array.prototype.shift.call(arguments), // ä¿å­˜éœ€è¦ç»‘å®šçš„thisä¸Šä¸‹æ–‡ // ä¸Šä¸€è¡Œç­‰ä»·äº context = [].shift.call(arguments); args = Array.prototype.slice.call(arguments) // å‰©ä½™çš„å‚æ•°è½¬ä¸ºæ•°ç»„ return function() &#123; // è¿”å›ä¸€ä¸ªæ–°å‡½æ•° self.apply( context, Array.prototype.concat.call(args, Array.prototype.slice.call(arguments)) ) &#125;&#125; promiseçš„æ„é€ å‡½æ•°è·Ÿä»–çš„thenæ–¹æ³•æ˜¯å¼‚æ­¥è¿˜æ˜¯åŒæ­¥promiseæ„é€ å‡½æ•°æ˜¯åŒæ­¥æ‰§è¡Œçš„ï¼Œthenæ–¹æ³•å› ä¸ºæ˜¯å¾®ä»»åŠ¡æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ æ¨¡å—åŒ– ä¸ºä»€ä¹ˆè¦æ¨¡å—åŒ–ä¸ºäº†é¿å…å…¨å±€æ±¡æŸ“ æ€ç»´å¯¼å›¾https://www.processon.com/view/link/5c8409bbe4b02b2ce492286a#map jsç±»å‹è½¬æ¢ å¼ºåˆ¶ç±»å‹è½¬æ¢é€šè¿‡ Number()ã€parseInt()ã€parseFloat()ã€toString()ã€String()ã€Boolean(),è¿›è¡Œå¼ºåˆ¶ç±»å‹è½¬æ¢ã€‚ éšå¼ç±»å‹è½¬æ¢é€»è¾‘è¿ç®—ç¬¦(&amp;&amp;ã€ ||ã€ !)ã€è¿ç®—ç¬¦(+ã€-ã€*ã€/)ã€å…³ç³»æ“ä½œç¬¦(&gt;ã€ &lt;ã€ &lt;= ã€&gt;=)ã€ç›¸ç­‰è¿ç®—ç¬¦(==)æˆ–è€… if/while çš„æ¡ä»¶ï¼Œå¯èƒ½ä¼šè¿›è¡Œéšå¼ç±»å‹è½¬æ¢ã€‚å…³äºvalueof tostringåœ¨æ•°å€¼è¿ç®—é‡Œï¼Œä¼šä¼˜å…ˆè°ƒç”¨valueOf() å­—ç¬¦ä¸²è¿ç®—ä¼˜å…ˆè°ƒç”¨åè€… å®ç°æ•°ç»„æ‰å¹³åŒ– æ–¹å¼ä¸€ 1;[].concat.apply([], [[1], [2], [3]]) // [1, 2, 3] chrome 69 åæ•°ç»„è‡ªå¸¦ flat æ–¹æ³• æ–¹å¼äºŒ 12345function flatten(arr) &#123; return arr.reduce(function(prev, item) &#123; return prev.concat(Array.isArray(item) ? flatten(item) : item) &#125;, [])&#125; æ–¹å¼ä¸‰ 123456function flatten(arr)&#123; while(arr.some(item=&gt;Array.isArray(item))&#123; arr = [].concat(...arr); &#125; return arr;&#125; å®ç°[1,2].mutiple() = [1,2,1,4]1234Array.prototype.mutiple = function() &#123; const tail = this.map((item) =&gt; item ** 2) return [...this, ...tail]&#125; å®ç°composeå‡½æ•°1234567891011121314export default function compose(...funcs) &#123; if (funcs.length === 0) &#123; return arg =&gt; arg &#125; if (funcs.length === 1) &#123; return funcs[0] &#125; const last = funcs[funcs.length - 1] const rest = funcs.slice(0, -1) // reduceright:å°†æ•°ç»„ä¸­æ¯ä¸€é¡¹ä»å³å‘å·¦è°ƒç”¨callback return (...args) =&gt; rest.reduceRight((composed, f) =&gt; f(composed), last(...args))&#125; var a3 = {name: â€œå‰ç«¯å¼€å‘â€}; var b3 = a3; a3 = null console.log(b3)?// {name: â€œå‰ç«¯å¼€å‘â€} äº‹ä»¶å§”æ‰˜çš„ä¼˜ç¼ºç‚¹ ä¼˜ç‚¹å‡å°‘äº‹ä»¶æ³¨å†Œ å‡å°å†…å­˜ ç¼ºç‚¹æœ‰çš„äº‹ä»¶ä¸æ”¯æŒå†’æ³¡ 0.1+0.2!=0.3åè¿›åˆ¶çš„ 0.1 å’Œ 0.2 éƒ½ä¼šè¢«è½¬æ¢æˆäºŒè¿›åˆ¶ï¼Œä½†ç”±äºæµ®ç‚¹æ•°ç”¨äºŒè¿›åˆ¶è¡¨è¾¾æ—¶æ˜¯æ— ç©·çš„ï¼Œä¾‹å¦‚ã€‚JavaScript ä»£ç :0.1 -&gt; 0.0001100110011001â€¦(æ— é™)0.2 -&gt; 0.0011001100110011â€¦(æ— é™)IEEE 754 æ ‡å‡†çš„ 64 ä½åŒç²¾åº¦æµ®ç‚¹æ•°çš„å°æ•°éƒ¨åˆ†æœ€å¤šæ”¯æŒ 53 ä½äºŒè¿›åˆ¶ä½ï¼Œæ‰€ä»¥ä¸¤è€…ç›¸åŠ ä¹‹åå¾—åˆ°äºŒè¿›åˆ¶ä¸ºï¼šJavaScript ä»£ç :0.0100110011001100110011001100110011001100110011001100å› æµ®ç‚¹æ•°å°æ•°ä½çš„é™åˆ¶è€Œæˆªæ–­çš„äºŒè¿›åˆ¶æ•°å­—ï¼Œå†è½¬æ¢ä¸ºåè¿›åˆ¶ï¼Œå°±æˆäº† 0.30000000000000004ã€‚æ‰€ä»¥åœ¨è¿›è¡Œç®—æœ¯è®¡ç®—æ—¶ä¼šäº§ç”Ÿè¯¯å·® æ€ä¹ˆè®¾ç½®å¯¹è±¡çš„å±æ€§ä¸èƒ½è¢«åˆ é™¤ï¼ŸdefineProppertyè®¾ç½®configurable falsewhy? https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/delete addeventListenerçš„ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå¯¹è±¡option,åŒ…æ‹¬capture, passive,onceé€‰é¡¹ ä¸æ”¯æŒè¿™ç§å†™æ³•çš„é»˜è®¤ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯usecapture å‡ ç§åˆ¤æ–­æ•°ç»„ç±»å‹çš„ä¼˜ç¼ºç‚¹instanceofä¸èƒ½æ£€æµ‹æ¥è‡ªiframeçš„æ•°ç»„ã€‚å°±æ˜¯window.frames[xx].Arrayæ„é€ å‡ºæ¥çš„æ•°ç»„Array.isArrayå…¼å®¹æ€§æ²¡é‚£ä¹ˆå¥½ ä¸ºä»€ä¹ˆè¡¨å•èƒ½è·¨åŸŸå› ä¸ºè¡¨å•çš„è¯·æ±‚ä¸€èˆ¬éƒ½æ˜¯æäº¤æ•°æ® å¹¶ä¸”ä¼ ç»Ÿformè¡¨å•æäº¤æµè§ˆå™¨ä¼šå‘ç”Ÿè·³è½¬ å¹¶ä¸”ä¸éœ€è¦è¿”å›å“åº”æ•°æ® æ˜¯å®‰å…¨çš„ ä¸ºä»€ä¹ˆç®­å¤´å‡½æ•°ä¸èƒ½ä½¿ç”¨newæ“ä½œç¬¦å› ä¸ºå®ƒæ²¡æœ‰è‡ªå·±çš„thisä¸prototype å±æ€§ ï¼Œè€Œ new å‘½ä»¤åœ¨æ‰§è¡Œæ—¶éœ€è¦å°†æ„é€ å‡½æ•°çš„ prototype èµ‹å€¼ç»™æ–°çš„å¯¹è±¡çš„ proto react ç›¸å…³React ä¸­ setState ä»€ä¹ˆæ—¶å€™æ˜¯åŒæ­¥çš„ï¼Œä»€ä¹ˆæ—¶å€™æ˜¯å¼‚æ­¥çš„åœ¨ React ä¸­ï¼Œå¦‚æœæ˜¯ç”± React å¼•å‘çš„äº‹ä»¶å¤„ç†ä¹Ÿå°±æ˜¯åˆæˆäº‹ä»¶ï¼ˆæ¯”å¦‚é€šè¿‡ onClick å¼•å‘çš„äº‹ä»¶å¤„ç†ï¼‰ï¼Œè°ƒç”¨ setState ä¸ä¼šåŒæ­¥æ›´æ–° this.stateï¼Œé™¤æ­¤ä¹‹å¤–çš„ setState è°ƒç”¨ä¼šåŒæ­¥æ‰§è¡Œ this.stateã€‚æ‰€è°“â€œé™¤æ­¤ä¹‹å¤–â€ï¼ŒæŒ‡çš„æ˜¯ç»•è¿‡ React é€šè¿‡ addEventListener ç›´æ¥æ·»åŠ çš„äº‹ä»¶å¤„ç†å‡½æ•°ä¹Ÿå°±æ˜¯åŸç”Ÿäº‹ä»¶ï¼Œè¿˜æœ‰é€šè¿‡ setTimeout/setInterval äº§ç”Ÿçš„å¼‚æ­¥è°ƒç”¨ã€‚ åŸå› ï¼šåœ¨ React çš„ setState å‡½æ•°å®ç°ä¸­ï¼Œä¼šæ ¹æ®ä¸€ä¸ªå˜é‡ isBatchingUpdates åˆ¤æ–­æ˜¯ç›´æ¥æ›´æ–° this.state è¿˜æ˜¯æ”¾åˆ°é˜Ÿåˆ—ä¸­å›å¤´å†è¯´ï¼Œè€Œ isBatchingUpdates é»˜è®¤æ˜¯ falseï¼Œä¹Ÿå°±è¡¨ç¤º setState ä¼šåŒæ­¥æ›´æ–° this.stateï¼Œä½†æ˜¯ï¼Œæœ‰ä¸€ä¸ªå‡½æ•° batchedUpdatesï¼Œè¿™ä¸ªå‡½æ•°ä¼šæŠŠ isBatchingUpdates ä¿®æ”¹ä¸º trueï¼Œè€Œå½“ React åœ¨è°ƒç”¨äº‹ä»¶å¤„ç†å‡½æ•°ä¹‹å‰å°±ä¼šè°ƒç”¨è¿™ä¸ª batchedUpdatesï¼Œé€ æˆçš„åæœï¼Œå°±æ˜¯ç”± React æ§åˆ¶çš„äº‹ä»¶å¤„ç†è¿‡ç¨‹ setState ä¸ä¼šåŒæ­¥æ›´æ–° this.stateã€‚ jsx è¯­æ³•ä¸ºä»€ä¹ˆ éœ€è¦ import react åŒ…JSX è¯­æ³•åªæ˜¯ä¸€ç§è¯­æ³•ç³–ï¼Œbabelè½¬è¯‘ä¹‹åå°±ä¼šå˜æˆReact.createElement react ç”Ÿå‘½å‘¨æœŸå˜æ›´çš„åŸå› åœ¨ fiber ä¸­ï¼Œæ›´æ–°æ˜¯åˆ†é˜¶æ®µçš„ï¼Œå…·ä½“åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼Œé¦–å…ˆæ˜¯ reconciliation çš„é˜¶æ®µï¼Œè¿™ä¸ªé˜¶æ®µåœ¨è®¡ç®—å‰å dom æ ‘çš„å·®å¼‚ï¼Œç„¶åæ˜¯ commit çš„é˜¶æ®µï¼Œè¿™ä¸ªé˜¶æ®µå°†æŠŠæ›´æ–°æ¸²æŸ“åˆ°é¡µé¢ä¸Šã€‚ç¬¬ä¸€ä¸ªé˜¶æ®µæ˜¯å¯ä»¥æ‰“æ–­çš„ï¼Œå› ä¸ºè¿™ä¸ªé˜¶æ®µè€—æ—¶å¯èƒ½ä¼šå¾ˆé•¿ï¼Œå› æ­¤éœ€è¦æš‚åœä¸‹æ¥å»æ‰§è¡Œå…¶ä»–æ›´é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡ï¼Œç¬¬äºŒä¸ªé˜¶æ®µåˆ™ä¸ä¼šè¢«æ‰“æ–­ï¼Œä¼šä¸€å£æ°”æŠŠæ›´æ–°æ¸²æŸ“åˆ°é¡µé¢ä¸Šã€‚ ç”±äº reconciliation çš„é˜¶æ®µä¼šè¢«æ‰“æ–­ï¼Œå¯èƒ½ä¼šå¯¼è‡´ commit å‰çš„è¿™äº›ç”Ÿå‘½å‘¨æœŸå‡½æ•°å¤šæ¬¡æ‰§è¡Œã€‚react å®˜æ–¹ç›®å‰å·²ç»æŠŠ componentWillMountã€componentWillReceiveProps å’Œ componetWillUpdate æ ‡è®°ä¸º unsafeï¼Œå¹¶ä½¿ç”¨æ–°çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•° getDerivedStateFromProps å’Œ getSnapshotBeforeUpdate è¿›è¡Œæ›¿æ¢ã€‚ ç»„ä»¶çš„æ¸²æŸ“è¢«åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼šç¬¬ä¸€ä¸ªé˜¶æ®µï¼ˆä¹Ÿå«åš render é˜¶æ®µï¼‰æ˜¯å¯ä»¥è¢« React æ‰“æ–­çš„ï¼Œä¸€æ—¦è¢«æ‰“æ–­ï¼Œè¿™é˜¶æ®µæ‰€åšçš„æ‰€æœ‰äº‹æƒ…éƒ½è¢«åºŸå¼ƒï¼Œå½“ React å¤„ç†å®Œç´§æ€¥çš„äº‹æƒ…å›æ¥ï¼Œä¾ç„¶ä¼šé‡æ–°æ¸²æŸ“è¿™ä¸ªç»„ä»¶ï¼Œè¿™æ—¶å€™ç¬¬ä¸€é˜¶æ®µçš„å·¥ä½œä¼šé‡åšä¸€éï¼›ç¬¬äºŒä¸ªé˜¶æ®µå«åš commit é˜¶æ®µï¼Œä¸€æ—¦å¼€å§‹å°±ä¸èƒ½ä¸­æ–­ï¼Œä¹Ÿå°±æ˜¯è¯´ç¬¬äºŒä¸ªé˜¶æ®µçš„å·¥ä½œä¼šç¨³ç¨³å½“å½“åœ°åšåˆ°è¿™ä¸ªç»„ä»¶çš„æ¸²æŸ“ç»“æŸã€‚ ä¸¤ä¸ªé˜¶æ®µçš„åˆ†ç•Œç‚¹ï¼Œå°±æ˜¯ render å‡½æ•°ã€‚render å‡½æ•°ä¹‹å‰çš„æ‰€æœ‰ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼ˆåŒ…æ‹¬ render)éƒ½å±äºç¬¬ä¸€é˜¶æ®µï¼Œä¹‹åçš„éƒ½å±äºç¬¬äºŒé˜¶æ®µã€‚render ä¹‹å‰çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼ˆä¹Ÿå°±æ˜¯ç¬¬ä¸€é˜¶æ®µç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼‰åŒ…æ‹¬è¿™äº›ï¼š componentWillReceivePropsshouldComponentUpdatecomponentWillUpdatecomponentWillMountrender getDerivedStateFromProps åº”è¯¥æ˜¯ä¸€ä¸ªçº¯å‡½æ•°ï¼ŒReact å°±æ˜¯é€šè¿‡è¦æ±‚è¿™ç§çº¯å‡½æ•°ï¼Œå¼ºåˆ¶å¼€å‘è€…ä»¬å¿…é¡»é€‚åº”å¼‚æ­¥æ¸²æŸ“ã€‚ reconciliation é˜¶æ®µè™šæ‹Ÿ dom çš„æ•°æ®å¯¹æ¯” commit é˜¶æ®µå°† change list æ›´æ–°åˆ° dom ä¸Š ä¸é€‚åˆæ‹†åˆ†æ˜¯å› ä¸ºä½¿ç”¨ vdom çš„æ„ä¹‰å°±æ˜¯ä¸ºäº†èŠ‚çœè€—æ—¶çš„ dom æ“ä½œ ç”Ÿå‘½å‘¨æœŸReact16.3 å¼€å¯å¼‚æ­¥æ¸²æŸ“ æ–°å¢çš„ä¸¤ä¸ª getDerivedStateFromPropsè§¦å‘æ—¶é—´(v16.4 ä¿®æ­£)ï¼šç»„ä»¶æ¯æ¬¡è¢« render çš„æ—¶å€™ï¼ŒåŒ…æ‹¬åœ¨ç»„ä»¶æ„å»ºä¹‹å(è™šæ‹Ÿ dom ä¹‹åï¼Œå®é™… dom æŒ‚è½½ä¹‹å‰)ï¼Œæ¯æ¬¡è·å–æ–°çš„ props æˆ– state ä¹‹åã€‚åœ¨ v16.3 ç‰ˆæœ¬æ—¶ï¼Œç»„ä»¶ state çš„æ›´æ–°ä¸ä¼šè§¦å‘è¯¥ç”Ÿå‘½å‘¨æœŸã€‚æ¯æ¬¡æ¥æ”¶æ–°çš„ props ä¹‹åéƒ½ä¼šè¿”å›ä¸€ä¸ªå¯¹è±¡ä½œä¸ºæ–°çš„ stateï¼Œè¿”å› null åˆ™è¯´æ˜ä¸éœ€è¦æ›´æ–° state.é…åˆ componentDidUpdateï¼Œå¯ä»¥è¦†ç›– componentWillReceiveProps çš„æ‰€æœ‰ç”¨æ³•getDerivedStateFromProps æ˜¯ä¸€ä¸ªé™æ€å‡½æ•°ï¼Œæ‰€ä»¥å‡½æ•°ä½“å†…ä¸èƒ½è®¿é—® thisï¼Œè¾“å‡ºå®Œå…¨ç”±è¾“å…¥å†³å®šã€‚ getSnapshotBeforeUpdate è§¦å‘æ—¶é—´: update å‘ç”Ÿçš„æ—¶å€™ï¼Œåœ¨ render ä¹‹åï¼Œåœ¨ç»„ä»¶ dom æ¸²æŸ“ä¹‹å‰ã€‚è¿”å›ä¸€ä¸ªå€¼ï¼Œä½œä¸º componentDidUpdate çš„ç¬¬ä¸‰ä¸ªå‚æ•°ã€‚é…åˆ componentDidUpdate, å¯ä»¥è¦†ç›– componentWillUpdate çš„æ‰€æœ‰ç”¨æ³• setStateå¯ä»¥æ¥å—å‡½æ•°ä¸ºå‚æ•°å—ï¼Ÿæœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ123this.setState((prevState, props) =&gt; (&#123; counter: prevState.counter + props.increment&#125;)); å…³äºcomponentDidCatchçš„è§¦å‘æ—¶æœºcomponentDidCatch()componentDidCatch(err, info)ä»»ä½•å­ç»„ä»¶åœ¨æ¸²æŸ“æœŸé—´ï¼Œç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¸­æˆ–è€…æ„é€ å‡½æ•° constructor å‘ç”Ÿé”™è¯¯æ—¶è°ƒç”¨ã€‚ é”™è¯¯è¾¹ç•Œä¸ä¼šæ•è·ä¸‹é¢çš„é”™è¯¯ï¼š äº‹ä»¶å¤„ç† (Event handlers) ï¼ˆå› ä¸ºäº‹ä»¶å¤„ç†ä¸å‘ç”Ÿåœ¨ React æ¸²æŸ“æ—¶ï¼ŒæŠ¥é”™ä¸å½±å“æ¸²æŸ“ï¼‰ å¼‚æ­¥ä»£ç  (Asynchronous code) (e.g. setTimeout or requestAnimationFrame callbacks) æœåŠ¡ç«¯æ¸²æŸ“ (Server side rendering) é”™è¯¯è¾¹ç•Œæœ¬èº«(è€Œä¸æ˜¯å­ç»„ä»¶)æŠ›å‡ºçš„é”™è¯¯ è¡¥å……ï¼šstatic getDerivedStateFromErroræ­¤ç”Ÿå‘½å‘¨æœŸä¼šåœ¨åä»£ç»„ä»¶æŠ›å‡ºé”™è¯¯åè¢«è°ƒç”¨ã€‚ å®ƒå°†æŠ›å‡ºçš„é”™è¯¯ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªå€¼ä»¥æ›´æ–° state,å¯ä»¥åœ¨æ­¤ç”Ÿå‘½å‘¨æœŸä¸­ æ›´æ–° state ä½¿ä¸‹ä¸€æ¬¡æ¸²æŸ“å¯ä»¥æ˜¾é™çº§ UIã€‚getDerivedStateFromError() ä¼šåœ¨æ¸²æŸ“é˜¶æ®µè°ƒç”¨ï¼Œå› æ­¤ä¸å…è®¸å‡ºç°å‰¯ä½œç”¨ã€‚ å¦‚é‡æ­¤ç±»æƒ…å†µï¼Œè¯·æ”¹ç”¨ componentDidCatch() note: UNSAFE_componentWillMount() åœ¨æŒ‚è½½ä¹‹å‰è¢«è°ƒç”¨ã€‚å®ƒåœ¨ render() ä¹‹å‰è°ƒç”¨ï¼Œå› æ­¤åœ¨æ­¤æ–¹æ³•ä¸­åŒæ­¥è°ƒç”¨ setState() ä¸ä¼šè§¦å‘é¢å¤–æ¸²æŸ“ã€‚é€šå¸¸ï¼Œæˆ‘ä»¬å»ºè®®ä½¿ç”¨ constructor() æ¥åˆå§‹åŒ– stateã€‚ react-router çš„åŸç†react-routerçš„å®ç°åŸç† createBrowserHistory: åˆ©ç”¨ HTML5 é‡Œé¢çš„ history createHashHistory: é€šè¿‡ hash æ¥å­˜å‚¨åœ¨ä¸åŒçŠ¶æ€ä¸‹çš„ history ä¿¡æ¯ createMemoryHistory: åœ¨å†…å­˜ä¸­è¿›è¡Œå†å²è®°å½•çš„å­˜å‚¨ linkç»„ä»¶è·Ÿaæ ‡ç­¾çš„åŒºåˆ«æœ‰onclické‚£å°±æ‰§è¡Œonclickclickçš„æ—¶å€™é˜»æ­¢aæ ‡ç­¾é»˜è®¤äº‹ä»¶ï¼ˆè¿™æ ·å­ç‚¹å‡»123å°±ä¸ä¼šè·³è½¬å’Œåˆ·æ–°é¡µé¢ï¼‰å†å–å¾—è·³è½¬hrefï¼ˆå³æ˜¯toï¼‰ï¼Œç”¨historyï¼ˆå‰ç«¯è·¯ç”±ä¸¤ç§æ–¹å¼ä¹‹ä¸€ï¼Œhistory &amp; hashï¼‰è·³è½¬ï¼Œæ­¤æ—¶åªæ˜¯é“¾æ¥å˜äº†ï¼Œå¹¶æ²¡æœ‰åˆ·æ–°é¡µé¢ ä¼ªä»£ç å®ç°1234567891011121314151617181920212223242526272829303132333435// createBrowserHistory(HTML5)ä¸­çš„å‰è¿›å®ç°function finishTransition(location) &#123; ... const historyState = &#123; key &#125;; ... if (location.action === 'PUSH') ) &#123; window.history.pushState(historyState, null, path); &#125; else &#123; window.history.replaceState(historyState, null, path) &#125;&#125;// createHashHistoryçš„å†…éƒ¨å®ç°function finishTransition(location) &#123; ... if (location.action === 'PUSH') ) &#123; window.location.hash = path; &#125; else &#123; window.location.replace( window.location.pathname + window.location.search + '#' + path ); &#125;&#125;// createMemoryHistoryçš„å†…éƒ¨å®ç°entries = [];function finishTransition(location) &#123; ... switch (location.action) &#123; case 'PUSH': entries.push(location); break; case 'REPLACE': entries[current] = location; break; &#125;&#125; vue ç›¸å…³ ä¸ºä»€ä¹ˆç»„ä»¶çš„ data å¿…é¡»æ˜¯ä¸€ä¸ªå‡½æ•°ä¸ºäº†è®©æ¯ä¸€ä¸ªå®ä¾‹ç»´æŠ¤ä¸€ä»½è¿”å›å¯¹è±¡çš„ç‹¬ç«‹çš„æ‹·è´ï¼Œè¿™æ ·å„ä¸ªç»„ä»¶çš„ data å˜åŒ–çš„æ—¶å€™äº’ä¸å½±å“ nodeç›¸å…³ nodeæ–‡ä»¶æŸ¥æ‰¾æœºåˆ¶æ€»ä½“æµç¨‹å…¶ä½™çš„ å‚è€ƒæ–‡ç«  æµ…è°ˆ instanceof å’Œ typeof çš„å®ç°åŸç† ä¸¤ä¸ªå¤§æ•°æ±‚å’Œ æ·±å…¥ setstate æœºåˆ¶ å¤§è¯ react ç”Ÿå‘½å‘¨æœŸ 2019ï¼šreact-v16.3 æ–°ç”Ÿå‘½å‘¨æœŸæ€»ç»“ react-router çš„å®ç°åŸç† ç¤¾æ‹›ä¸­çº§å‰ç«¯ç¬”è¯•é¢è¯•é¢˜æ€»ç»“ Why is Reactâ€™s virtual DOM so much faster than the real DOM? å‰ç«¯ 100 é—®ï¼šèƒ½ææ‡‚80%çš„è¯·æŠŠç®€å†ç»™æˆ‘","categories":[{"name":"é¢ç»","slug":"é¢ç»","permalink":"https://ashleyblog.xyz/categories/é¢ç»/"},{"name":"js","slug":"é¢ç»/js","permalink":"https://ashleyblog.xyz/categories/é¢ç»/js/"}],"tags":[{"name":"js","slug":"js","permalink":"https://ashleyblog.xyz/tags/js/"}]},{"title":"2019å¹´åº¦æ€»ç»“","slug":"2019å¹´åº¦æ€»ç»“","date":"2019-12-10T01:45:37.000Z","updated":"2023-04-02T14:00:30.300Z","comments":true,"path":"2019/12/10/2019å¹´åº¦æ€»ç»“/","link":"","permalink":"https://ashleyblog.xyz/2019/12/10/2019å¹´åº¦æ€»ç»“/","excerpt":"","text":"å†™ç»™è‡ªå·±çš„å‡†åˆ™ ä¸ç®¡æ”¹åŠ¨çš„æ–‡ä»¶å†å¤šï¼Œéƒ½è¦ä¸€ä¸ªä¸ªæ£€æŸ¥ï¼Œçœ‹æœ‰æ²¡æœ‰è¯¯æ”¹çš„åœ°æ–¹ï¼Œè‡ªå·±çš„æ”¹åŠ¨æœ‰æ²¡æœ‰å½±å“å…¶ä»–çš„åŠŸèƒ½ å†™ä»£ç å‰ï¼Œè¯·ä¸‰æ€ï¼Œè¯·ä¸‰æ€ï¼Œè¯·ä¸‰æ€ï¼Œä¸è¦æ€¥äºåŠ¨æ‰‹ ä¸è¦ç›¸ä¿¡æµ‹è¯•ï¼Œä¸€å®šè¦åœ¨ä¸Šçº¿ä¹‹å‰ç”¨å„ç§è®¾å¤‡ï¼Œå„ç§å¤§å°çš„å±å¹•ï¼Œå„ç§æµè§ˆå™¨ï¼Œæµ‹è¯•ä¸€éæ‰€æœ‰ç›¸å…³çš„åŠŸèƒ½ï¼Œæ‰€æœ‰å¯èƒ½å‡ºç°çš„æƒ…å†µ ä¸€ä¸ªåŠŸèƒ½ä¸€ä¸ªåˆ†æ”¯ï¼Œæ—¶åˆ»ä¿æŒä¸çº¿ä¸ŠåŒæ­¥ å¤šç ”ç©¶ç ”ç©¶å„ç§åº”ç”¨ï¼Œç«™åœ¨ç”¨æˆ·çš„è§’åº¦å»æµ‹è¯•è€Œä¸æ˜¯è‡ªå·±çš„è§’åº¦ ä¸æ˜ç™½çš„ï¼Œå®¹æ˜“è®°æ··çš„çŸ¥è¯†ç‚¹è¦è‡ªå·±å½’çº³æ€»ç»“ï¼Œå¤šåŠ¨æ‰‹ï¼Œä¸è¦ä»Šå¤©çœ‹å‡ ç¯‡æ–‡ç« æ˜å¤©åˆå¿˜äº† æ™šä¸Šè¦ç¡å¥½ï¼Œé¿å…ç¬¬äºŒå¤©æ‰“çŒç¡ å†™ç»™2020å¹´çš„è‡ªå·± å¤šåŠ¨æ‰‹å†™ä»£ç ï¼Œå¤šç‚¹å·¥ä½œä¹‹å¤–çš„è¾“å‡ºï¼Œå·©å›ºjsåŸºç¡€ï¼Œå¸Œæœ›æˆ‘èƒ½åœ¨è¿™æ¡è·¯è¶Šèµ°è¶Šè¿œå§ã€‚ã€‚ã€‚","categories":[{"name":"æˆé•¿","slug":"æˆé•¿","permalink":"https://ashleyblog.xyz/categories/æˆé•¿/"}],"tags":[]},{"title":"webpackå¸¸ç”¨é…ç½®é€ŸæŸ¥","slug":"webpackå¸¸ç”¨é…ç½®é€ŸæŸ¥","date":"2019-12-08T12:54:46.000Z","updated":"2023-04-02T14:00:30.291Z","comments":true,"path":"2019/12/08/webpackå¸¸ç”¨é…ç½®é€ŸæŸ¥/","link":"","permalink":"https://ashleyblog.xyz/2019/12/08/webpackå¸¸ç”¨é…ç½®é€ŸæŸ¥/","excerpt":"","text":"ç”Ÿäº§ç¯å¢ƒå¸¸ç”¨æ’ä»¶imagemin-webpack-plugin - å›¾ç‰‡å‹ç¼©æ’ä»¶123456789101112//å¼•å…¥æ’ä»¶var ImageminPlugin = require('imagemin-webpack-plugin').default;//é…ç½®plugins: [ new ImageminPlugin(&#123; disable: process.env.NODE_ENV !== 'production', // å¼€å‘æ—¶ä¸å¯ç”¨ pngquant: &#123;//å›¾ç‰‡è´¨é‡ quality: ... &#125; &#125;)] mini-css-extract-plugin - ä¾æ®æ¯ä¸ªentryç”Ÿæˆå•ä¸ªcssæ–‡ä»¶ï¼ˆå°†cssä»jsä¸­æå–å‡ºæ¥ï¼‰12345678910111213// å°†style-loaderæ¢æˆmini-css-extract.. use: [ &#123; loader: MiniCssExtractPlugin.loader &#125;, 'css-loader' ... ] ... new MiniCssExtractPlugin(&#123; filename: 'static/css/[name].[contenthash:8].css', chunkFilename: 'static/css/[name].[contenthash:8].chunk.css' // import() dynamically import &#125;) cleanwebpackpluginåœ¨webpackä¸­æ‰“åŒ…çš„æ–‡ä»¶é€šå¸¸æ˜¯é€šè¿‡hashç”Ÿæˆçš„ï¼Œå¦‚æœæ–‡ä»¶æ”¹åŠ¨ï¼Œé‚£ä¹ˆæ‰“åŒ…çš„æ–‡ä»¶å°±ä¼šè¶Šæ¥è¶Šå¤š,è¿™ä¸ªæ’ä»¶ç”¨æ¥æ¸…é™¤ä¹‹å‰çš„æ–‡ä»¶ postcss-loaderç®€ä»‹èƒ½å¤Ÿåƒlessä¸€æ ·çš„è‡ªåŠ¨è¡¥å…¨æµè§ˆå™¨å‰ç¼€ï¼Œéœ€è¦ä¸autoprefixerä¸€èµ·ä½¿ç”¨,PostCSSçš„ä¸€å¤§ç‰¹ç‚¹æ˜¯ï¼Œå…è®¸ä½¿ç”¨æœ€æ–°çš„CSSç‰¹æ€§ï¼Œåœ¨ä½ çš„CSSé‡Œæä¾›ç»Ÿè®¡æ•°æ®ï¼Œæˆ–è€…æ˜¯å…è®¸ä½ ä½¿ç”¨ Sassï¼ŒLessæˆ–æ˜¯Stylusç­‰CSSé¢„å¤„ç†å™¨ã€‚ postcssçš„ç”Ÿæ€åœˆæä¾›äº†ä¸Šç™¾ç§æ’ä»¶Autoprefixer æ ¹æ®ç”¨æˆ·çš„ä½¿ç”¨åœºæ™¯æ¥è§£æCSSå’Œæ·»åŠ vendor prefixesï¼ˆå‰æ–‡æ³¨2ï¼‰ã€‚ PostCSS Focus ä¸€ç§åˆ©ç”¨é”®ç›˜æ“ä½œä¸ºæ¯ä¸ª:hoveræ·»åŠ :focusé€‰æ‹©å™¨çš„PostCSSæ’ä»¶ã€‚ PreCSS ä¸€ä¸ªå…è®¸ä½ åœ¨ä»£ç ä¸­ä½¿ç”¨ç±»ä¼¼Sassæ ‡è®°çš„æ’ä»¶ã€‚ Stylelint ä¸€ç§å¼ºå¤§çš„ï¼Œå…ˆè¿›çš„å¯ä»¥ä½¿ä½ åœ¨CSSæ ·å¼ä¸­ä¿æŒä¸€è‡´æ€§ï¼Œé¿å…é”™è¯¯çš„CSS linterå·¥å…·ã€‚ PostCSS CSSnext ä¸€ç§å¯ä»¥è®©ä½ ä½¿ç”¨CSSæœ€æ–°ç‰¹æ€§çš„æ’ä»¶ã€‚å®ƒé€šè¿‡å°†æœ€æ–°çš„CSSç‰¹æ€§è½¬å˜ä¸ºç°é˜¶æ®µæµè§ˆå™¨æ‰€å…¼å®¹çš„ç‰¹æ€§ï¼Œè¿™æ ·ä½ ä¸ç”¨å†ç­‰å¾…æµè§ˆå™¨å¯¹æŸä¸€ç‰¹å®šæ–°ç‰¹æ€§çš„æ”¯æŒã€‚ â€¦ ä½¿ç”¨éœ€è¦ç»“åˆpostcss.config.js 12345678910111213141516171819202122// postcss.config.jsmodule.exports = &#123; plugins: [ require('precss'), require('autoprefixer') ]&#125;// webpack.config.js test: /\\.scss$/,&#123; loader: require.resolve('postcss-loader'), options: &#123; ident: 'postcss', plugins: () =&gt; [ require('postcss-flexbugs-fixes'), require('postcss-preset-env')(&#123; autoprefixer: &#123; flexbox: 'no-2009' &#125;, stage: 3 &#125;) ] terser-webpack-plugin - jså‹ç¼©æ’ä»¶ä½¿ç”¨123456789101112131415optimization: &#123; ... minimize: true, minimizer: [ new TerserJSPlugin(&#123; terserOptions: &#123; output: &#123; comments: false &#125; &#125;, extractComments: false &#125;), new OptimizeCSSAssetsPlugin(&#123;&#125;) ] &#125; progress-bar-webpack-pluginç®€ä»‹æ˜¾ç¤ºbuildè¿›åº¦ 123plugins: [ new ProgressBarPlugin()] optimize-css-assets-webpack-plugin - csså‹ç¼©æ’ä»¶1234567891011plugins:[ ... new OptimizeCssAssetsPlugin(&#123; assetNameRegExp: /\\.optimize\\.css$/g, cssProcessor: require('cssnano'), cssProcessorPluginOptions: &#123; preset: ['default', &#123; discardComments: &#123; removeAll: true &#125; &#125;], &#125;, canPrint: true &#125;)] webpack-bundle-analyzerç®€ä»‹å¯ä»¥çœ‹åˆ°æ‰“åŒ…ä¹‹åå„ä¸ªæ–‡ä»¶çš„å¤§å° ä¹‹åå¯ä»¥åšä¸€äº›ä¼˜åŒ– 1234567const BundleAnalyzerPlugin = require('webpack-bundle-analyzer').BundleAnalyzerPlugin; module.exports = &#123; plugins: [ new BundleAnalyzerPlugin() ]&#125; å¼€å‘ç¯å¢ƒå¸¸ç”¨æ’ä»¶HotModuleReplacementPlugin123plugins:...new webpack.HotModuleReplacementPlugin() friendly-errors-webpack-plugin - å‹å¥½çš„webpacké”™è¯¯æç¤º123456789new FriendlyErrorsPlugin(&#123; compilationSuccessInfo: &#123; messages: ['You application is running here http://localhost:3000'], notes: ['Some additionnal notes to be displayed unpon successful compilation'] &#125;, onErrors: function (severity, errors) &#123; // You can listen to errors transformed and prioritized by the plugin // severity can be 'error' or 'warning' &#125; åŸºç¡€é…ç½®htmlwebpackpluginhttps://juejin.im/post/5ce96ad7e51d455a2f2201e1 12345678910111213141516171819202122new HtmlWebpackPlugin(&#123; inject: true, excludeAssets: [...], chunks: [page.toLowerCase()].concat( isEnvProduction ? ['assets', 'vendors'...] : [] ), templateParameters: ..., minify: isEnvProduction &amp;&amp; &#123; removeComments: true, collapseWhitespace: true, removeRedundantAttributes: true, useShortDoctype: true, removeEmptyAttributes: true, removeStyleLinkTypeAttributes: true, keepClosingSlash: true, minifyJS: true, minifyCSS: true, minifyURLs: true &#125;, filename: ... template: ... &#125;) å‚è€ƒæ–‡ç«  å…³äº PostCSS æ™®åŠçš„ä¸€ç‚¹å¾®å°çš„å·¥ä½œ","categories":[{"name":"é…ç½®","slug":"é…ç½®","permalink":"https://ashleyblog.xyz/categories/é…ç½®/"}],"tags":[{"name":"webpack","slug":"webpack","permalink":"https://ashleyblog.xyz/tags/webpack/"}]},{"title":"webpacké…ç½®å¤šé¡µé¢å›½é™…åŒ–åº”ç”¨","slug":"é…ç½®å¤šé¡µé¢å›½é™…åŒ–åº”ç”¨","date":"2019-11-15T13:36:17.000Z","updated":"2023-04-16T03:13:51.195Z","comments":true,"path":"2019/11/15/é…ç½®å¤šé¡µé¢å›½é™…åŒ–åº”ç”¨/","link":"","permalink":"https://ashleyblog.xyz/2019/11/15/é…ç½®å¤šé¡µé¢å›½é™…åŒ–åº”ç”¨/","excerpt":"","text":"å¤šå…¥å£é…ç½®é€šè¿‡è¯»å–æ–‡ä»¶ç»“æ„æ¥åŠ¨æ€ç”Ÿæˆå…¥å£ã€‚åŠ¡å¿…ä½¿ç”¨å¯¹è±¡å†™æ³•ï¼Œé”®åè¡¨ç¤º chunkName 1234567891011121314151617181920module.exports = &#123; entry: collectEntries()&#125;function collectEntries() &#123; const pagesDir = path.resolve(__dirname, '../src/pages') return fs .readdirSync(pagesDir) .map((pageName) =&gt; (&#123; chunkName: pageName, entryFile: path.join(pagesDir, pageName, 'index.jsx') &#125;)) .reduce( (entries, item) =&gt; (&#123; ...entries, [item.chunkName]: item.entryFile &#125;), &#123;&#125; )&#125; å¤š html æ–‡ä»¶è¾“å‡ºplugins æ·»åŠ å¤šä¸ª HtmlWebpackPlugin å®ä¾‹ï¼Œæ·»åŠ  chunks é…ç½®å°†åªåœ¨é¡µé¢æ³¨å…¥å½“å‰é¡µé¢çš„ä»£ç å—ï¼Œä¸è®¾ç½® chunks ä¼šæ³¨å…¥æ‰€æœ‰é¡µé¢ä»£ç å— 1234567891011121314151617181920module.exports = &#123; plugins: [ ...collectHtmls() // ... ]&#125;function collectHtmls() &#123; const pagesDir = path.resolve(__dirname, '../src/pages') const templatesDir = path.resolve(__dirname, '../public/templates') const templateOutputsDir = path.resolve(__dirname, '../dist') return fs.readdirSync(pagesDir).map((pageName) =&gt; &#123; return new HtmlWebpackPlugin(&#123; inject: true, chunks: [pageName], filename: path.join(templateOutputsDir, `$&#123;pageName&#125;.html`), template: path.join(templatesDir, `$&#123;pageName&#125;.html`) &#125;) &#125;)&#125; devServer é…ç½®å¤šå›½å®¶ç½‘ç«™åœ°å€ä¸€èˆ¬ä¸º https://www.xxx.com/locale, å‚è€ƒè‹¹æœå®˜ç½‘ (opens new window)å’Œ å¾®è½¯å®˜ç½‘ (opens new window)ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦å¤„ç†ä¸€ä¸‹é‡å®šå‘ï¼Œä¹Ÿå°±æ˜¯ devServer çš„ historyApiFallback é¡¹ï¼Œéœ€æå‰é…ç½®æ”¯æŒçš„å›½å®¶ã€‚ 123456789101112131415161718module.exports = &#123; devServer: &#123; historyApiFallback: &#123; rewrites: collectRewrites() &#125; &#125;&#125;const avalibleLocales = '(cn|us|ru|id)'function collectRewrites() &#123; return fs .readdirSync(path.resolve(__dirname, '../src/pages')) .map((page) =&gt; (&#123; from: new RegExp(`^/$&#123;avalibleLocales&#125;/$&#123;page&#125;/?$`, 'i'), to: `/$&#123;page&#125;.html` &#125;))&#125; ä½¿ç”¨ react-router æ—¶ basename éœ€è¦é…ç½®ä¸ºå½“å‰å›½å®¶ 123const App = () =&gt; &#123; return &lt;Router basename=&#123;`/$&#123;locale&#125;`&#125;&gt;&#123;/*...*/&#125;&lt;/Router&gt;&#125; å¤šè¯­è¨€é…ç½®ä½¿ç”¨ React-Intlé…ç½®å¤šå›½è¯­è¨€åŒ…ã€‚ä¸ºé˜²æ­¢ bundle ä½“ç§¯è¿‡å¤§ï¼Œè¯­è¨€åŒ…ç”¨ code spliting åˆ†å‰²ã€‚æ³¨æ„è¯­è¨€åŒ…æœªåŠ è½½æ—¶ä¸è¦æ˜¾ç¤ºé¡µé¢å†…å®¹ï¼Œå¦åˆ™é¡µé¢ä¼šæœ‰é—ªçƒã€‚ 123456789101112const Intl = (&#123; children &#125;) =&gt; &#123; const [messages, setMessages] = useState() const loadLocaleData = useCallback(() =&gt; &#123; import(`@/languages/$&#123;locale&#125;.json`).then(setMessages) &#125;, [language]) useEffect(loadLocaleData, []) return messages ? ( &lt;IntlProvider messages=&#123;messages&#125; locale=&#123;locale&#125;&gt; &#123;children&#125; &lt;/IntlProvider&gt; ) : null&#125;","categories":[],"tags":[{"name":"webpack","slug":"webpack","permalink":"https://ashleyblog.xyz/tags/webpack/"}]},{"title":"å‰ç«¯æ€§èƒ½ä¼˜åŒ–","slug":"å‰ç«¯æ€§èƒ½ä¼˜åŒ–","date":"2019-11-07T04:09:10.000Z","updated":"2023-04-02T14:00:30.290Z","comments":true,"path":"2019/11/07/å‰ç«¯æ€§èƒ½ä¼˜åŒ–/","link":"","permalink":"https://ashleyblog.xyz/2019/11/07/å‰ç«¯æ€§èƒ½ä¼˜åŒ–/","excerpt":"","text":"å‰ç«¯æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µé’ˆå¯¹ spa çš„æ€§èƒ½ä¼˜åŒ– ä¼˜åŒ–é¦–å±æ¸²æŸ“ å°†æ‰€æœ‰ç”¨äºé¦–å±æ¸²æŸ“çš„ css æ–‡ä»¶æ•´åˆæˆä¸€ä¸ªå†…åµŒåˆ° head æ ‡ç­¾ï¼Œç”±äº http æ•°æ®åŒ…çš„é™åˆ¶ï¼Œæ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡ 14kbhttp/2 èƒ½è®© css æ–‡ä»¶ä½¿ç”¨å•ä¸ªæ–‡ä»¶å­˜å‚¨ï¼Œé€šè¿‡æœåŠ¡å™¨æ¨é€ css æ–‡ä»¶çš„ä¼ è¾“æ–¹å¼å‡å°‘ html æ–‡ä»¶æ•°æ®é‡ éª¨æ¶å± é¢„åŠ è½½ å¼‚æ­¥è·¯ç”± è·¯ç”±æ‹†åˆ†,å‡å°‘åˆå§‹åŠ è½½ä½“ç§¯: åˆ©ç”¨å¼‚æ­¥åŠ è½½æ–¹å¼ï¼Œä»…åœ¨éœ€è¦è¿›å…¥å¯¹åº”è·¯ç”±æ—¶ï¼Œå¯¹åº”ç»„ä»¶æ‰ä¼šè¢«åŠ è½½è¿›æ¥ã€‚ 1234route(&#123; Home: () =&gt; import('@/coms/home'), About: () =&gt; import('@/coms/about')&#125;) æœåŠ¡ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰ ç®€å•çš„æ¥è®²ï¼Œå°±æ˜¯æµè§ˆå™¨å‘é€è¯·æ±‚åˆ°æœåŠ¡å™¨ç«¯ï¼ŒæœåŠ¡å™¨ç«¯å¤„ç†è¯·æ±‚ï¼Œå¡«å……æ•°æ®ï¼Œç”Ÿæˆ html è¿”å›ç»™æµè§ˆå™¨ ,æœåŠ¡ç«¯å¿…é¡»æ˜¯ node.js æˆ–è€…ä¸“é—¨è·‘ä¸ª node.js æ¥æ”¯æŒä¼˜åŠ¿ï¼šæ›´å¥½çš„ SEOï¼› é¦–å±æ€§èƒ½å¥½ï¼Œä¸éœ€è¦å…ˆä¸‹è½½ä¸€å † js å’Œ css åæ‰èƒ½çœ‹åˆ°é¡µé¢åŠ£åŠ¿ï¼šä¸èƒ½å®ç°éƒ¨åˆ†æ›´æ–°ã€‚å³ä½¿åªæœ‰ä¸€éƒ¨åˆ†å˜åŠ¨ï¼Œä¹Ÿéœ€è¦åç«¯é‡æ–°è¿”å›æ•´ä¸ªé¡µé¢ç»™æµè§ˆå™¨ã€‚ å…¶ä»–é‡ç»˜ å›æµçš„æ¦‚å¿µ repaintï¼Œå°±æ˜¯æµè§ˆå™¨å¾—çŸ¥å…ƒç´ äº§ç”Ÿäº†ä¸å½±å“æ’ç‰ˆçš„æƒ…å†µä¸‹åå¯¹è¿™ä¸ªå…ƒç´ è¿›è¡Œé‡æ–°ç»˜åˆ¶çš„è¿‡ç¨‹ã€‚ä¾‹å¦‚æˆ‘ä»¬æ”¹å˜äº†å…ƒç´ çš„é¢œè‰²ï¼ŒåŠ ä¸ªä¸‹åˆ’çº¿ç­‰ã€‚ reflow, æµè§ˆå™¨å¾—çŸ¥å…ƒç´ äº§ç”Ÿäº†å¯¹æ–‡æ¡£æ ‘æ’ç‰ˆæœ‰å½±å“çš„æ ·å¼å˜åŒ–ï¼Œå¯¹æ‰€æœ‰å—å½±å“çš„domèŠ‚ç‚¹è¿›è¡Œé‡æ–°æ’ç‰ˆå·¥ä½œ* å‡å°‘å›æµ å›æµçš„å‘ç”Ÿï¼š1ã€DOM æ ‘çš„ç»“æ„å˜åŒ–ï¼Œå¦‚æ·»åŠ æˆ–åˆ é™¤å…ƒç´ ã€‚ï¼ˆå½“æ–°å¢å¤šä¸ªå…ƒç´ çš„æ—¶å€™ä½¿ç”¨æ–‡æ¡£ç¢ç‰‡ï¼‰åŒ…æ‹¬è®¾ç½® display:none è®¾ç½® visibility åªä¼šè§¦å‘é‡ç»˜2ã€å…ƒç´ çš„å‡ ä½•å±æ€§çš„æ”¹å˜ï¼ˆå¦‚ marginã€paddingã€widthã€heightã€border ç­‰ï¼‰ã€‚3ã€é¡µé¢åˆå§‹åŒ–æ¸²æŸ“ã€‚4ã€è·å–æŸäº›å±æ€§ï¼Œæµè§ˆå™¨ä¸ºå–å¾—å‡†ç¡®çš„å€¼ä¹Ÿä¼šè§¦å‘å›æµï¼ˆoffsetTopã€clientTopã€scrollTopã€getComputedSyle()ç­‰ç­‰ï¼‰ã€‚5ã€æµè§ˆå™¨çª—å£å°ºå¯¸çš„æ”¹å˜ ä¸ºä»€ä¹ˆè·å–æŸäº›å±æ€§ä¼šè§¦å‘å›æµï¼Ÿç”±äºæ¯æ¬¡é‡æ’éƒ½ä¼šé€ æˆé¢å¤–çš„è®¡ç®—æ¶ˆè€—ï¼Œå› æ­¤å¤§å¤šæ•°æµè§ˆå™¨éƒ½ä¼šé€šè¿‡é˜Ÿåˆ—åŒ–ä¿®æ”¹å¹¶æ‰¹é‡æ‰§è¡Œæ¥ä¼˜åŒ–é‡æ’è¿‡ç¨‹ã€‚æµè§ˆå™¨ä¼šå°†ä¿®æ”¹æ“ä½œæ”¾å…¥åˆ°é˜Ÿåˆ—é‡Œï¼Œç›´åˆ°è¿‡äº†ä¸€æ®µæ—¶é—´æˆ–è€…æ“ä½œè¾¾åˆ°äº†ä¸€ä¸ªé˜ˆå€¼ï¼Œæ‰æ¸…ç©ºé˜Ÿåˆ—ã€‚ä½†æ˜¯ï¼å½“ä½ è·å–å¸ƒå±€ä¿¡æ¯çš„æ“ä½œçš„æ—¶å€™ï¼Œä¼šå¼ºåˆ¶é˜Ÿåˆ—åˆ·æ–°ï¼Œæ¯”å¦‚å½“ä½ è®¿é—®ä»¥ä¸‹å±æ€§æˆ–è€…ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ï¼š offsetTopã€offsetLeftã€offsetWidthã€offsetHeight scrollTopã€scrollLeftã€scrollWidthã€scrollHeight clientTopã€clientLeftã€clientWidthã€clientHeight getComputedStyle() getBoundingClientRect ä»¥ä¸Šå±æ€§å’Œæ–¹æ³•éƒ½éœ€è¦è¿”å›æœ€æ–°çš„å¸ƒå±€ä¿¡æ¯ï¼Œå› æ­¤æµè§ˆå™¨ä¸å¾—ä¸æ¸…ç©ºé˜Ÿåˆ—ï¼Œè§¦å‘å›æµé‡ç»˜æ¥è¿”å›æ­£ç¡®çš„å€¼ã€‚ æ€ä¹ˆé¿å… å¯¹äºå¤æ‚çš„åŠ¨ç”»æ•ˆæœï¼Œè®©å…¶ç»å¯¹å®šä½ é¿å…å¤šæ¬¡è®¿é—®ä¸Šè¿°çš„å±æ€§ ä½¿ç”¨ç±»å ä½¿ç”¨ csstext å½“æ·»åŠ æ’å…¥å¤§é‡çš„å…ƒç´ çš„æ—¶å€™ ä½¿ç”¨æ–‡æ¡£ç¢ç‰‡æˆ–è€…æ˜¯åœ¨çˆ¶å…ƒç´ åœ¨è¢«æ’å…¥ä¹‹å‰è®¾ç½®display:noneè®©å…¶è„±ç¦»æ–‡æ¡£æµ ä¹‹åå†å¸¦å›æ–‡æ¡£æµ ç¡¬ä»¶åŠ é€Ÿï¼Œä½¿ç”¨ css3 ç¡¬ä»¶åŠ é€Ÿï¼Œå¯ä»¥è®© transformã€opacityã€filters è¿™äº›åŠ¨ç”»ä¸ä¼šå¼•èµ·å›æµé‡ç»˜ ã€‚ä½†æ˜¯å¯¹äºåŠ¨ç”»çš„å…¶å®ƒå±æ€§ï¼Œæ¯”å¦‚ background-color è¿™äº›ï¼Œè¿˜æ˜¯ä¼šå¼•èµ·å›æµé‡ç»˜çš„ï¼Œä¸è¿‡å®ƒè¿˜æ˜¯å¯ä»¥æå‡è¿™äº›åŠ¨ç”»çš„æ€§èƒ½ å¸¸è§çš„è§¦å‘ç¡¬ä»¶åŠ é€Ÿçš„ css å±æ€§ï¼štransform,opacity,filters,Will-change ä½¿ç”¨æ§åˆ¶å°çš„performanceç›‘æµ‹é¡µé¢çš„æ€§èƒ½ï¼ˆåŸæ¥çš„ timelineï¼‰ä½¿ç”¨æŒ‡å—ï¼šhttps://www.cnblogs.com/xiaohuochai/p/9182710.html å…¶ä»– å¤æ‚çš„è®¡ç®—ä½¿ç”¨web workers äº‹ä»¶å§”æ‰˜ æ­£åˆ™è¡¨è¾¾å¼ä¸è¦è¿‡äºå¤æ‚ ä½¿ç”¨ webpack ä¼˜åŒ– ä¼˜åŒ–å›¾ç‰‡ - ä½¿ç”¨url-loader è®¾ç½®limit å¤§çš„å›¾è½¬æˆbase64 ä½¿ç”¨å„ç§æ’ä»¶å‹ç¼©ä»£ç  tree-shakingæ˜¯ä»€ä¹ˆï¼Ÿç”¨äºæè¿°ç§»é™¤ JavaScript ä¸Šä¸‹æ–‡ä¸­çš„æœªå¼•ç”¨ä»£ç æ€ä¹ˆåšï¼Ÿ ä½¿ç”¨ ES2015 æ¨¡å—è¯­æ³•ï¼ˆå³ import å’Œ exportï¼‰ã€‚ç¡®ä¿æ²¡æœ‰ compiler å°† ES2015 æ¨¡å—è¯­æ³•è½¬æ¢ä¸º CommonJS æ¨¡å—ï¼ˆè¿™ä¹Ÿæ˜¯æµè¡Œçš„ Babel preset ä¸­ @babel/preset-env çš„é»˜è®¤è¡Œä¸º \\ 123456789101112// é…ç½® Babel è®©å…¶ä¿ç•™ ES6 æ¨¡å—åŒ–è¯­å¥ // babelrc&#123; \"presets\": [ [ \"env\", &#123; \"modules\": false &#125; ] ]&#125; åœ¨é¡¹ç›® package.json æ–‡ä»¶ä¸­ï¼Œæ·»åŠ ä¸€ä¸ª â€œsideEffectsâ€ å±æ€§ã€‚æ¯”å¦‚polyfillç­‰ åªè¦å¼•å…¥ å°±ä¼šäº§ç”Ÿå‰¯ä½œç”¨ å½“è¯¥å±æ€§è®¾ç½®ä¸ºfalseçš„æ—¶å€™ä¼šåˆ é™¤æ‰€æœ‰æœªå¼•ç”¨çš„æ–‡ä»¶ æ‰€ä»¥polyfilléœ€è¦å£°æ˜sideeffects,true æ˜¯é»˜è®¤å€¼ï¼Œå¦‚æœä¸æŒ‡å®šå…¶ä»–å€¼çš„è¯ã€‚è¿™æ„å‘³ç€æ‰€æœ‰çš„æ–‡ä»¶éƒ½æœ‰å‰¯ä½œç”¨ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰ä¸€ä¸ªæ–‡ä»¶å¯ä»¥ tree-shakingã€‚ 123456789101112131415// æ‰€æœ‰æ–‡ä»¶éƒ½æœ‰å‰¯ä½œç”¨ï¼Œå…¨éƒ½ä¸å¯ tree-shaking&#123; \"sideEffects\": true&#125;// æ²¡æœ‰æ–‡ä»¶æœ‰å‰¯ä½œç”¨ï¼Œå…¨éƒ½å¯ä»¥ tree-shaking&#123; \"sideEffects\": false&#125;// åªæœ‰è¿™äº›æ–‡ä»¶æœ‰å‰¯ä½œç”¨ï¼Œæ‰€æœ‰å…¶ä»–æ–‡ä»¶éƒ½å¯ä»¥ tree-shakingï¼Œä½†ä¼šä¿ç•™è¿™äº›æ–‡ä»¶&#123; \"sideEffects\": [ \"./src/file1.js\", \"./src/file2.js\" ]&#125; é€šè¿‡å°† mode é€‰é¡¹è®¾ç½®ä¸º productionï¼Œå¯ç”¨ minification(ä»£ç å‹ç¼©) å’Œ tree shakingã€‚å¼€å¯ optimization.usedExports,ç¼–è¯‘æ—¶å¯ä»¥åˆ†æå‡ºè§£æ„å†™æ³•å¼•å…¥çš„esmæ¨¡å—ï¼Œå“ªäº›exportç”¨åˆ°äº†ï¼Œå“ªäº›æ¨¡å—æ²¡æœ‰ç”¨åˆ°ã€‚ç„¶åå°±éœ€è¦åˆ†åˆ«è¿›è¡Œæ ‡è®°,æ ‡è®°å¦‚ä¸‹ å¹¶ä½¿ç”¨å‹ç¼©æ’ä»¶å‹ç¼©ä»£ç  webpack4 modeä¸ºproductionæ—¶å€™é»˜è®¤å°±æœ‰è¿™ä¸¤ä¸ªè®¾ç½® 123/* harmony export (immutable) */ __webpack_exports__[\"xxx\"] = xxxx;/* unused harmony export xxx */ æ ‡è®°ä¸ºè¿™ä¸ªå°±æ˜¯éœ€è¦åˆ æ‰çš„ ä»¥ä¸Šè¿°æ–¹å¼å£°æ˜sideeffectsä¼šå‡ºç°çš„é—®é¢˜ï¼šä»¥import &#39;xxx.cssç›´æ¥å¯¼å…¥åˆ° JavaScript æ–‡ä»¶ä¸­çš„æ ·å¼è¡¨éƒ½å°†ä»è¾“å‡ºä¸­åˆ é™¤è§£å†³åŠæ³•æ˜¯ï¼šwebpackçš„é…ç½®æ–‡ä»¶ä¸­ 123456789module: &#123; rules: [ &#123; test: /...css.../, use: [loaders], sideEffects: true &#125; ]&#125; å¼•å…¥çš„æ—¶å€™ä½¿ç”¨è§£æ„èµ‹å€¼ ä¸ç”¨çš„ä¾èµ–åŠæ—¶åˆ é™¤ external æŠŠæˆ‘ä»¬çš„ä¾èµ–ç”³æ˜ä¸ºä¸€ä¸ªå¤–éƒ¨ä¾èµ–ï¼Œå¤–éƒ¨ä¾èµ–é€šè¿‡ &lt; script&gt; å¤–é“¾è„šæœ¬å¼•å…¥ã€‚ optimization é…ç½®ç»†èŠ‚https://imweb.io/topic/5b66dd601402769b60847149 alias å’Œ noParseå½“éœ€è¦å°†è¿™ä¸ªå¤–éƒ¨ä¾èµ–æ‰“åŒ…è¿›å…¥åˆ°ä½ çš„ bundle çš„æ—¶å€™ 1234567891011121314module.exports = function(webpackConfig) &#123; ...+ webpackConfig.resolve.alias = &#123;+ 'react': 'react/dist/react.min'+ &#125;+ webpackConfig.module.noParse.push(+ /react.min/+ ) ... return webpackConfig;&#125;; å…¶ä»– - ä¼˜åŒ–SEOé‡è¦çš„å†…å®¹æ”¾åœ¨é¦–é¡µ å› ä¸ºçˆ¬è™«ä¼šå…ˆä»é¦–é¡µå¼€å§‹çˆ¬æäº¤sitemapåŠ å¿«é¡µé¢åŠ è½½é€Ÿåº¦ æå‡æœç´¢å¼•æ“æ’åâ€¦ å‚è€ƒæ–‡ç«  ä½ çœŸçš„äº†è§£å›æµå’Œé‡ç»˜å— Webpack æ„å»ºæ€§èƒ½ä¼˜åŒ–æ¢ç´¢","categories":[{"name":"æ€§èƒ½ä¼˜åŒ–","slug":"æ€§èƒ½ä¼˜åŒ–","permalink":"https://ashleyblog.xyz/categories/æ€§èƒ½ä¼˜åŒ–/"}],"tags":[]},{"title":"cssä¸­å®½é«˜çš„æ–°å€¼å¤ä¹ ","slug":"cssä¸­å®½é«˜çš„æ–°å€¼å¤ä¹ ","date":"2019-10-17T13:50:15.000Z","updated":"2023-04-02T14:00:30.295Z","comments":true,"path":"2019/10/17/cssä¸­å®½é«˜çš„æ–°å€¼å¤ä¹ /","link":"","permalink":"https://ashleyblog.xyz/2019/10/17/cssä¸­å®½é«˜çš„æ–°å€¼å¤ä¹ /","excerpt":"","text":"fill-available å‡ºç°fill-availableå…³é”®å­—å€¼çš„ä»·å€¼åœ¨äºï¼Œå¯ä»¥è®©å…ƒç´ çš„100%è‡ªåŠ¨å¡«å……ç‰¹æ€§ä¸ä»…ä»…åœ¨blockæ°´å¹³å…ƒç´ ä¸Šï¼Œä¹Ÿå¯ä»¥åº”ç”¨åœ¨å…¶ä»–å…ƒç´ åˆ©ç”¨å®ƒå®ç°ç­‰é«˜å¸ƒå±€ 123456789101112131415&lt;style&gt;.inner&#123; width:100px; height:-webkit-fill-available; margin:0 10px; display: inline-block; vertical-align: middle; background-color: pink;&#125;&lt;/style&gt;&lt;div style=\"height: 100px;\"&gt; &lt;div class=\"inner\"&gt;HTML&lt;/div&gt; &lt;div class=\"inner\"&gt;CSS&lt;/div&gt; &lt;div class=\"inner\"&gt;JS&lt;br&gt;jQyery&lt;br&gt;Vue&lt;/div&gt;&lt;/div&gt; max-contentfit-content uses max-content, unless available &lt; max-content, then it uses available. Unless available &lt; min-content, then it uses min-content. 12345678910&lt;style&gt;.outer&#123; width:-webkit-max-content; border:1px solid black;&#125;&lt;/style&gt;&lt;div class=\"outer\"&gt; &lt;div style=\"height:10px;width:100px;background:lightgreen\"&gt;&lt;/div&gt; &lt;div style=\"background-color: pink;\"&gt;æµ‹è¯•æµ‹è¯•æµ‹è¯•æµ‹è¯•æµ‹è¯•æµ‹ hi æ˜¯æµ‹è¯•æµ‹è¯•æµ‹è¯•æµ‹ä½ æµ‹è¯•æµ‹è¯•æµ‹è¯•æµ‹è¯•&lt;/div&gt;&lt;/div&gt; æ¯æ—¥å°çŸ¥è¯†ç‚¹ å…³äºä¸‹è½½çš„æ–‡ä»¶çš„åç¼€ä½ åœ¨ç½‘ä¸Šä¸‹è½½ä¸€ä¸ªå¾ˆå¤§çš„æ–‡ä»¶ï¼Œä¸‹è½½è¿‡ç¨‹ä¸­ä½ æ€ä¹ˆçŸ¥é“è‡ªå·±ä¸‹è½½çš„å¯¹ä¸å¯¹å‘¢ï¼Ÿæ‰€ä»¥MD5 å°±æ˜¯ä¸ºäº†è¿™ç§æƒ…æ™¯è€Œç”Ÿçš„ã€‚å³ç½‘ä¸Šçš„æ–‡ä»¶é™¤äº†æœ‰èµ„æºæœ¬èº«å¤–ï¼Œè¿˜ä¼šæœ‰ä¸€ä¸ªMD5å€¼ï¼Œç„¶åä½ ä¸‹è½½åˆ°æœ¬åœ°åçš„æ–‡ä»¶ä¹Ÿå¯ä»¥ç®—å‡ºä¸€ä¸ªMD5 å€¼ï¼Œç„¶åäºŒè€…å¯¹æ¯”ï¼Œå¦‚æœå®Œå…¨ç›¸åŒåˆ™è¯´æ˜ä¸‹çš„æ–‡ä»¶æ˜¯æ­£ç¡®çš„ã€‚ å‚è€ƒæ–‡ç«  æµè§ˆå™¨ç¼“å­˜æ§åˆ¶è¯¦è§£ï¼ˆcookieã€sessionã€localStorageã€Cache-Controlç­‰","categories":[],"tags":[{"name":"css","slug":"css","permalink":"https://ashleyblog.xyz/tags/css/"}]},{"title":"æ§åˆ¶reactçš„stateä¸ºåˆæ³•çŠ¶æ€","slug":"æ§åˆ¶reactçš„stateä¸ºåˆæ³•çŠ¶æ€","date":"2019-10-14T14:58:27.000Z","updated":"2023-04-02T14:00:30.292Z","comments":true,"path":"2019/10/14/æ§åˆ¶reactçš„stateä¸ºåˆæ³•çŠ¶æ€/","link":"","permalink":"https://ashleyblog.xyz/2019/10/14/æ§åˆ¶reactçš„stateä¸ºåˆæ³•çŠ¶æ€/","excerpt":"","text":"12345678910111213141516171819202122232425262728293031const zipList = initialArray =&gt; &#123; const [initialActive, ...restOfTabs] = initialArray const zip = &#123; previous: [], current: initialActive, next: restOfTabs, &#125; const setActive = zip =&gt; newActive =&gt; &#123; // TODO: fill this in const newZip = zip return apiForZip(newZip) &#125; const apiForZip = zip =&gt; (&#123; asArray: () =&gt; [...zip.previous, zip.current, ...zip.next], isActive: tab =&gt; zip.current === tab, setActive: setActive(zip), activeTab: () =&gt; zip.current, &#125;) return apiForZip(zip)&#125;const [tabs, setTabs] = React.useState( zipList([ &#123; title: 'Tab One', content: 'This is tab one' &#125;, &#123; title: 'Tab Two', content: 'This is tab two' &#125;, &#123; title: 'Tab Three', content: 'This is tab three' &#125;, ])) æ¯æ—¥å°çŸ¥è¯†ç‚¹ å­—ä½“çš„æ—‹è½¬å°†å­—ä½“è®¾ç½®æˆdisplay:blockå³å¯ run buildæ–‡ä»¶å¤¹ï¼ˆä¸ºäº†æ›´æ¥è¿‘çº¿ä¸Šçš„æ•ˆæœï¼‰ä½¿ç”¨http-serverå·¥å…· æ‰§è¡Œå‘½ä»¤: ï¼ˆåŸç†æ˜¯puputeeræŠ“å–buildä¸‹çš„èµ„æº ç„¶åã€‚ã€‚ 1http-server build/ project name å°½é‡ä¸è¦ä½¿ç”¨pushè·³è½¬è·¯ç”± å› ä¸ºè¿™ç§åŠ¨æ€çš„æ–¹å¼ä¸åˆ©äºssr git config -list æŸ¥çœ‹å½“å‰é¡¹ç›®çš„gité…ç½® è¯·æ±‚è¢«é‡å®šå‘ ï¼ˆnetworkå‡ºç°â€¦htmlâ€¦å¾ˆé•¿çš„è·¯å¾„ å¹¶è¢«canceledï¼‰ å¯èƒ½æ˜¯åç«¯æ­£åœ¨éƒ¨ç½²åˆ°æ–°çš„æœåŠ¡å™¨ æ¯æ—¥bugè®°å½• è¯·æ±‚è¿”å›500 å‘ç°æ˜¯ä¼ çš„å‚æ•°çš„æ ¼å¼ä¸å¯¹ åº”è¯¥æ˜¯formè¡¨å•çš„å½¢å¼ è€Œä¸æ˜¯application/jsonæ ¼å¼ è™½ç„¶APIæ–‡æ¡£ä¸­æ²¡æœ‰æ ‡å‡º ä½†æ˜¯ä¹Ÿè¦æ³¨æ„ å‘ç°é‡æ–°è¿›å…¥é¡µé¢åŠ è½½æ•°æ®çš„æ—¶å€™æ²¡æœ‰å‡ºç°loading æ˜¯å› ä¸ºæ•°æ®å­˜å‚¨åœ¨mobxä¸­ æ²¡æœ‰åˆ·æ–°è¢«æ¸…é™¤ æ‰€ä»¥è¦åœ¨æ¯æ¬¡è¯·æ±‚ä¹‹å‰æ¸…é™¤ä¸€æ¬¡æˆ–è€…æ˜¯ä¸èµ°mobxæµç¨‹ çˆ¶å±‚å ä¸Šä¸‹æ–‡ä¸­çš„å­å±‚å ä¸Šä¸‹æ–‡ 12345678...position:relative /* çˆ¶ */...position:absolutez-index:2 /*å­*/...position:absolutez-index:1 /* å”å” */ æœ€åè¿˜æ˜¯å”å”æ˜¾ç¤ºåœ¨å­èŠ‚ç‚¹çš„ä¸Šé¢ å› ä¸ºå­å±‚å ä¸Šä¸‹æ–‡å±äºçˆ¶å±‚å ä¸Šä¸‹æ–‡ table è®¾ç½®flexå¸ƒå±€ tdå…ƒç´ ä¸ä¼šè‡ªåŠ¨å¡«å……æ»¡tbody node execä¸æ‰§è¡Œå›è°ƒå‡½æ•° 1234var exec = require('child_process').exec;exec(\"&#123;COMMAND&#125; &gt; results.log\", function (error, stdout, stderr) &#123; console.log('callback called!'); // this never gets called.&#125;); æ˜¯å› ä¸ºé‡å®šå‘åˆ°äº†å¦ä¸€ä¸ªæ–‡ä»¶ *","categories":[],"tags":[]},{"title":"tså°çŸ¥è¯†ç‚¹","slug":"tså°çŸ¥è¯†ç‚¹","date":"2019-10-11T12:28:00.000Z","updated":"2023-04-02T14:00:30.291Z","comments":true,"path":"2019/10/11/tså°çŸ¥è¯†ç‚¹/","link":"","permalink":"https://ashleyblog.xyz/2019/10/11/tså°çŸ¥è¯†ç‚¹/","excerpt":"","text":"ç”¨ keyof æ¥çº¦å®šæ–¹æ³•çš„å‚æ•° 123456789101112export type keys = &#123; name: string; appId: number; config: object;&#125;class Application &#123; // å‚æ•°å’Œå€¼çº¦æŸèŒƒå›´ set&lt;T extends keyof keys&gt;(key: T, val: keys[T]) get&lt;T extends keyof keys&gt;(key: T): keys[T]&#125;---- interface vs typeæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ in æ¥çº¦æŸå±æ€§åå¿…é¡»ä¸ºä¸‰å®¶è¿è¥å•†ä¹‹ä¸€ï¼š 123456789101112type ChinaMobilePhones = '10086' | '10010' | '10000'interface ChinaMobile &#123; name: string; website: string;&#125;// åªèƒ½ type ä½¿ç”¨ï¼Œ interface æ— æ³•ä½¿ç”¨type ChinaMobileList = &#123; // éå†å±æ€§ [phone in ChinaMobilePhones]: ChinaMobile&#125; ç±»å‹å®šä¹‰æ–‡ä»¶åœ¨ TypeScript ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆç®€å•çš„ï¼Œåœ¨ä»£ç ç¼–å†™ä¸­å®šä¹‰ç±»å‹ï¼š 123456interface IBaseModel &#123; say(keys: string[] | null): object&#125;class User implements IBaseModel &#123; name: string ä½†æ˜¯ä¸»æµçš„åº“éƒ½æ˜¯ JavaScript ç¼–å†™çš„ï¼ŒTypeScript èº«ä¸º JavaScript çš„è¶…é›†ï¼Œè‡ªç„¶éœ€è¦è€ƒè™‘åˆ°å¦‚ä½•è®© JS åº“ä¹Ÿèƒ½å®šä¹‰é™æ€ç±»å‹ã€‚ TypeScript ç»è¿‡äº†ä¸€ç³»åˆ—çš„æ‘¸ç´¢ï¼Œå…ˆåæå‡ºäº† tsd(å·²åºŸå¼ƒ)ã€typings(å·²åºŸå¼ƒ)ï¼Œæœ€ç»ˆåœ¨ TypeScript 2.0 çš„æ—¶å€™é‡æ–°æ•´ç†äº†ç±»å‹å®šä¹‰ï¼Œæå‡ºäº† DefinitelyTypedã€‚ DefinitelyTyped å°±æ˜¯è®©ä½ æŠŠ â€œç±»å‹å®šä¹‰æ–‡ä»¶(*.d.ts)â€ï¼Œå‘å¸ƒåˆ° npm ä¸­ï¼Œé…åˆç¼–è¾‘å™¨(æˆ–æ’ä»¶)ï¼Œå°±èƒ½å¤Ÿæ£€æµ‹åˆ° JS åº“ä¸­çš„é™æ€ç±»å‹ã€‚ ç±»å‹å®šä¹‰æ–‡ä»¶çš„ä»¥ .d.ts ç»“å°¾ï¼Œé‡Œé¢ä¸»è¦ç”¨æ¥å®šä¹‰ç±»å‹ã€‚æ¯”å¦‚ï¼š å› ä¸ºè¿™å‡ ä¸ªåº“æ˜¯ js çš„ï¼Œæ²¡æœ‰ ts çš„ç±»å‹å£°æ˜ä¹Ÿæ²¡æœ‰å¥½çš„@types/å¯¹åº”çš„åº“ 123declare module 'classnames';declare module 'htmr';declare module 'showdown-katex'; å†…ç½®ç±»å‹å®šä¹‰å°±æ˜¯æŠŠä½ çš„ç±»å‹å®šä¹‰æ–‡ä»¶å’Œ npm åŒ…ä¸€èµ·å‘å¸ƒ 123456789// pageage.json&#123; \"name\": \"demo\", \"author\": \"demo project\", \"version\": \"1.0.0\", \"main\": \"./lib/main.js\", // å®šä¹‰ä¸»ç±»å‹å®šä¹‰æ–‡ä»¶ \"types\": \"./lib/main.d.ts\"&#125; å®šä¹‰æ•°ç»„çš„ç±»å‹ä¸ºç¬¬ä¸€é¡¹æ˜¯å‡½æ•° å…¶ä½™çš„æ˜¯å¯¹è±¡ 12345678910interface Arglist &#123; [index: number]: object 0: Function&#125;const a1: Arglist = [func]const a2: Arglist = [22] // failsconst a3: Arglist = [func, 'foo']// æ–¹å¼äºŒtype FAs = [Function, &#123;&#125;] ç»§æ‰¿çš„æ—¶å€™æ’é™¤çˆ¶æ¥å£ä¸­çš„ä¸€éƒ¨åˆ†å±æ€§ 123export type Omit&lt;T, K extends keyof T&gt; = Pick&lt;T, Exclude&lt;keyof T, K&gt;&gt;export interface ICollapseProps extends Omit&lt;React.HTMLAttributes&lt;HTMLUListElement&gt;,\"title\"&gt; react.cloneElementçš„æ­£ç¡®ç”¨æ³• 123cloneElement(children as React.ReactElement&lt;any&gt;, &#123; ref, type: hasError ? 'error' : 'default', index signature ç´¢å¼•ç­¾åé€‚ç”¨äºæ— æ³•ç¡®å®šå±æ€§åç§°çš„åœºæ™¯123interface NetCache &#123; [propName: string]: string;&#125; useImmperativeHandle ç»“åˆ éœ€è¦å®šä¹‰é™æ€å±æ€§çš„ç»„ä»¶ ç»„ä»¶çš„å®šä¹‰åº”è¯¥å¦‚ä¸‹ 123456export interface IMessage extends React.ForwardRefExoticComponent&lt;IMessageProps &amp; React.RefAttributes&lt;HTMLDivElement | refType&gt;&gt; &#123;// ä½¿ç”¨ const ref = createRef&lt;refType &amp; HTMLDivElement&gt;() &lt;Message ref=&#123;ref&#125;/&gt; Using a forwardRef component with children in TypeScript 1234567891011121314import * as React from 'react'type ButtonProps = React.HTMLProps&lt;HTMLButtonElement&gt; or React.ComponentPropsWithoutRef&lt;'button'&gt;const FancyButton = React.forwardRef&lt;HTMLButtonElement, ButtonProps&gt;((props, ref) =&gt; ( &lt;button type=\"button\" ref=&#123;ref&#125; className=\"FancyButton\"&gt; &#123;props.children&#125; &lt;/button&gt;))// You can now get a ref directly to the DOM button:const ref = React.createRef&lt;HTMLButtonElement&gt;()&lt;FancyButton ref=&#123;ref&#125;&gt;Click me!&lt;/FancyButton&gt; ç»“è®ºå½“æŠ¥é”™çš„æ—¶å€™ä¸€å®šè¦ä»”ç»†çœ‹é”™è¯¯ ç„¶åå¤šè¯•ä¸€è¯•","categories":[{"name":"ts","slug":"ts","permalink":"https://ashleyblog.xyz/categories/ts/"}],"tags":[{"name":"ts","slug":"ts","permalink":"https://ashleyblog.xyz/tags/ts/"}]},{"title":"sassä¸­çš„mapå’Œlist","slug":"sassä¸­çš„map","date":"2019-10-11T12:28:00.000Z","updated":"2023-04-02T14:00:30.297Z","comments":true,"path":"2019/10/11/sassä¸­çš„map/","link":"","permalink":"https://ashleyblog.xyz/2019/10/11/sassä¸­çš„map/","excerpt":"","text":"mapç®€ä»‹ç±»ä¼¼äº js ä¸­çš„ map æ•°æ®ç»“æ„ ä¸»è¦å‡½æ•° å‡½æ•° åŠŸèƒ½ ç¤ºä¾‹ map-keys(map) è¿”å› map é‡Œé¢æ‰€æœ‰çš„ key(list) map-keys((â€œfooâ€: 1, â€œbarâ€: 2)) =&gt; â€œfooâ€, â€œbarâ€ map-values(map) è¿”å› map é‡Œé¢æ‰€æœ‰çš„ value(list) map-values((â€œfooâ€: 1, â€œbarâ€: 2)) =&gt; 1, 2 map-get(map,key) è¿”å› map é‡Œé¢æŒ‡å®šå¯ä»¥çš„ value map-get((â€œfooâ€: 1, â€œbarâ€: 2), â€œfooâ€) =&gt; 1 map-has-key(map,key) è¿”å› map é‡Œé¢æ˜¯å¦å«æœ‰æŒ‡å®šçš„ key map-has-key((â€œfooâ€: 1, â€œbarâ€: 2), â€œfooâ€) =&gt; true map-merge(map1,map2) åˆå¹¶ map(map) map-merge((â€œfooâ€: 1), (â€œbarâ€: 2)) =&gt; (â€œfooâ€: 1, â€œbarâ€: 2) map-remove(map,keys) åˆ é™¤æŒ‡å®š map ä¸­çš„æŒ‡å®š key(map) map-remove((â€œfooâ€: 1, â€œbarâ€: 2), â€œbarâ€) =&gt; (â€œfooâ€: 1) keywords(args) è¿”å›ä¸€ä¸ªå‡½æ•°å‚æ•°ç»„æˆçš„ map(map) @mixin foo(argsâ€¦){@debug keywords($args); //=&gt; (arg1: val, arg2: val)} listç®€ä»‹ç±»ä¼¼jsä¸­çš„æ•°ç»„ 12345$list: ( (\"item-1.1\", \"item-1.2\", \"item-1.3\"), (\"item-2.1\", \"item-2.2\", \"item-2.3\"), (\"item-3.1\", \"item-3.2\", \"item-3.3\") ); æ–¹æ³• length æ£€æµ‹å…¶é•¿åº¦ï¼š 1length($a) =&gt; 1 nth è·å–ç¬¬né¡¹ï¼š 1nth($a,1) =&gt; test index($list,$value)ï¼šè¿”å›$valueåœ¨$listä¸­çš„ä½ç½® append($list,$value[,$separator])ï¼šä½¿ç”¨$separatoråˆ†éš”ç¬¦å°†$valueåˆ—è¡¨é¡¹æ·»åŠ åˆ°$listæœ€åï¼ˆå¦‚æœæ²¡æœ‰æ˜¾å¼æŒ‡å®š $separatoråˆ†éš”ç¬¦ï¼Œä¼šä»¥å½“å‰åˆ†éš”ç¬¦åˆ†éš”ï¼‰ join($list-1,$list-2[,$separator]):ä½¿ç”¨$separatoråˆ†éš”ç¬¦å°†$list-2é™„åŠ åˆ°$list-1ï¼ˆå¦‚æœæ²¡æœ‰æ˜¾å¼æŒ‡å®šåˆ†éš”ç¬¦ï¼Œå°†å¯¹* $list-1ä¸­çš„åˆ†éš”ç¬¦ï¼‰ zip($lists):å°†å¤šä¸ª$listç»„åˆåœ¨ä¸€èµ·æˆä¸ºä¸€ä¸ªå¤šç»´åˆ—è¡¨ã€‚å¦‚æœåˆ—è¡¨æºé•¿åº¦å¹¶ä¸æ˜¯æ‰€æœ‰éƒ½ç›¸åŒï¼Œç»“æœåˆ—è¡¨é•¿åº¦å°†ä»¥æœ€çŸ­çš„ä¸€ä¸ªä¸ºå‡† reject($list,$value)ï¼šè¿™æ˜¯Compassä¸­çš„ä¸€ä¸ªå‡½æ•°ï¼Œå°†$valueå€¼ä»$listä¸­åˆ é™¤ compact(*$args)ï¼šCompasså‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªåˆ é™¤éçœŸå€¼çš„æ–°åˆ—è¡¨ liståº”ç”¨ æ‰©å±•é€‰æ‹©å™¨ å¦‚:1234.home .nav-home,.about .nav-about,.products .nav-products,.contact .nav-contact 12345678$pages: home,about,products,contact;$selector:();@each $item in $pages &#123; //æˆ‘ä»¬åˆ›å»º$selector&#125;#&#123;$selector&#125;&#123; //æ ·å¼å†™åœ¨è¿™é‡Œ&#125; è‡ªå®šä¹‰å‡½æ•°123456789//å®šä¹‰first()å‡½æ•°ï¼Œè·å–åˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªåˆ—è¡¨é¡¹@function first($list)&#123; @return nth($list,1);&#125;//å®šä¹‰last()å‡½æ•°ï¼Œè·å–åˆ—è¡¨ä¸­çš„æœ€åä¸€ä¸ªåˆ—è¡¨é¡¹@function last($list)&#123; @return nth($list,length($list));&#125; æ¯æ—¥å°çŸ¥è¯†ç‚¹ unquote ç”¨æ¥å»é™¤å­—ç¬¦ä¸²ä¸­çš„å¼•å· quote ç»™å­—ç¬¦ä¸²å¢åŠ å¼•å· ä¼ é€’å†…å®¹å—åˆ° mixin: @content 12345678910@mixin apply-to-ie6-only &#123; * html &#123; @content; &#125;&#125;@include apply-to-ie6-only &#123; #logo &#123; background-image: url(/logo.gif); &#125;&#125; target ä¼ªç±»å¯ä»¥åœ¨ä¸æ–°å¢ç±»åçš„æ—¶å€™ç›´æ¥å®ç°æ ‡ç­¾é¡µçš„æ•ˆæœåŸç†ï¼š ä¹Ÿå°±æ˜¯ç»™ä¸€ä¸ªå…ƒç´  A è®¾å®š idï¼Œå¦ä¸€ä¸ªå…ƒç´  B æŒ‡å®šè·³è½¬åˆ°è¿™ä¸ª idï¼Œç„¶åå°±å‘ a:hover é‚£æ ·ï¼Œåœ¨ css ä¸­è®¾å®š â€œå…ƒç´ ï¼štargetâ€å¹¶æ”¹å˜æ ·å¼ï¼Œé‚£ä¹ˆç‚¹å‡» B å…ƒç´ ï¼Œå°±ä¼šæ ¹æ®ä½ çš„è®¾å®šæ”¹å˜ A çš„æ ·å¼ã€‚ 123456789101112&lt;div class=\"swiper-box\"&gt; &lt;div class=\"swiper-cont\"&gt; &lt;div class=\"swiper1\" id=\"swiper1\"&gt;&lt;/div&gt; &lt;div class=\"swiper2\" id=\"swiper2\"&gt;&lt;/div&gt; &lt;div class=\"swiper3\" id=\"swiper3\"&gt;&lt;/div&gt; &lt;/div&gt; &lt;div class=\"swiper-num\"&gt; &lt;a href=\"#swiper1\"&gt;1&lt;/a&gt; &lt;a href=\"#swiper2\"&gt;2&lt;/a&gt; &lt;a href=\"#swiper3\"&gt;3&lt;/a&gt; &lt;/div&gt;&lt;/div&gt; focus:within ä¼ªç±» åº”ç”¨äºå½“å­å…ƒç´ ä¸­å‡ºç°è·å¾—ç„¦ç‚¹çš„å…ƒç´ æ—¶å€™ 123&lt;div&gt; &lt;input /&gt;&lt;/div&gt; 12div:focus:within &#123;&#125; css ä¼ªç±»ä¸ä¼ªå…ƒç´ css ä¼ªç±»css ä¼ªç±»ç”¨äºå‘æŸäº›é€‰æ‹©å™¨æ·»åŠ ç‰¹æ®Šçš„æ•ˆæœã€‚:link, :visited, :hover, :focus, :active, :first-child, :langcss3 æ–°å¢çš„ä¼ªç±»ï¼š:last-child, :only-child, :first-of-type, :last-of-type, :only-of-type, :nth-child(n), :nth-last-child(n), :nth-of-type(n), :nth-last-of-type(n), :root, :empty, :target, :enabled, :disabled, :checked, :not(selector), css ä¼ªå…ƒç´ css ä¼ªå…ƒç´ ç”¨äºå‘æŸäº›é€‰æ‹©å™¨è®¾ç½®ç‰¹æ®Šæ•ˆæœã€‚::first-letter, ::first-line, ::before, ::aftercss3 æ–°å¢çš„ä¼ªå…ƒç´ ::selection é€šè¿‡ first-letter text-transform: uppercase text-transform: lowercaseæ§åˆ¶å¤§å°å†™ æ¯æ—¥ bug è®°å½• max-height è®¾ç½® transition çš„æ—¶å€™ä¸ç”Ÿæ•ˆ æ˜¯å› ä¸º max-height è®¾ç½®äº†ä¸€ä¸ªå¾ˆå¤§çš„èŒƒå›´ æ¯”å¦‚ä» 0 åˆ° 1000 è€Œå®é™…çš„å†…å®¹é«˜åº¦åªæœ‰ 100 é‚£ä¹ˆå‰©ä¸‹çš„æ—¶é—´å¤§éƒ½æ˜¯åœ¨æ»šåŠ¨è¿™ 900 ä½¿ç”¨ js è®¾ç½®å…ƒç´ çš„è¡Œå†…æ ·å¼å¯ä»¥åº”ç”¨æ ·å¼è¡¨ä¸­çš„ transition git å†²çªçš„ç†è§£åªæœ‰å½“åŒæ—¶ä¿®æ”¹äº†æŸä¸ªæ–‡ä»¶çš„æ—¶å€™æ‰ä¼šå‡ºç°å†²çª è¦æ˜¯æœ¬åœ°çš„çŠ¶æ€æ˜¯ nothing commit git pull çš„æ—¶å€™ä¼šç›´æ¥è¦†ç›–æ‰æœ¬åœ°çš„æ–‡ä»¶ git merge çš„ç†è§£ä»çˆ¶åˆ†æ”¯åˆ‡å‡ºå­åˆ†æ”¯ å­åˆ†æ”¯ pull çˆ¶åˆ†æ”¯ å­åˆ†æ”¯ä¸Šçš„ä»£ç ä¼šä¸çˆ¶åˆ†æ”¯ä¿æŒä¸€è‡´ ä½†æ˜¯çˆ¶åˆ†æ”¯ merge å­åˆ†æ”¯ çˆ¶åˆ†æ”¯çš„å†…å®¹ä¸ä¸€å®šè¦ä¸å­åˆ†æ”¯ä¿æŒä¸€è‡´ åœ¨ä¸€ä¸ªhooksé‡Œé¢ç»´æŠ¤ä¸€ä»½state ç„¶ååœ¨å¦ä¸€ä¸ªç»„ä»¶ä¸­setState ä¸€ä¸ªç»„ä»¶ä¸­è·å–state ä¸¤ä¸ªç»„ä»¶çš„stateå¹¶ä¸ä¼šåŒæ­¥","categories":[{"name":"sass","slug":"sass","permalink":"https://ashleyblog.xyz/categories/sass/"}],"tags":[{"name":"sass css","slug":"sass-css","permalink":"https://ashleyblog.xyz/tags/sass-css/"}]},{"title":"2019æ˜¥æ‹›å›é¡¾","slug":"é¢è¯•é¢˜å›é¡¾æ˜¥æ‹›","date":"2019-08-14T14:38:11.000Z","updated":"2023-04-02T14:00:30.299Z","comments":true,"path":"2019/08/14/é¢è¯•é¢˜å›é¡¾æ˜¥æ‹›/","link":"","permalink":"https://ashleyblog.xyz/2019/08/14/é¢è¯•é¢˜å›é¡¾æ˜¥æ‹›/","excerpt":"","text":"ä½¿ç”¨ Linux å‘½ä»¤æ¨¡æ‹Ÿå‘èµ·ä¸€ä¸ªè¯·æ±‚1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162ä¸€ã€getè¯·æ±‚ï¼š 1ã€ä½¿ç”¨curlå‘½ä»¤ï¼š// åœ¨ç»ˆç«¯æ•²ä¸‹è¯¥å‘½ä»¤ä¹‹åå›è½¦ä¼šå‡ºç°å“åº”å†…å®¹ curl â€œhttp://www.baidu.comâ€ å¦‚æœè¿™é‡Œçš„URLæŒ‡å‘çš„æ˜¯ä¸€ä¸ªæ–‡ä»¶æˆ–è€…ä¸€å¹…å›¾éƒ½å¯ä»¥ç›´æ¥ä¸‹è½½åˆ°æœ¬åœ° curl -i â€œhttp://www.baidu.comâ€ æ˜¾ç¤ºå…¨éƒ¨ä¿¡æ¯ curl -l â€œhttp://www.baidu.comâ€ åªæ˜¾ç¤ºå¤´éƒ¨ä¿¡æ¯ curl -v â€œhttp://www.baidu.comâ€ æ˜¾ç¤ºgetè¯·æ±‚å…¨è¿‡ç¨‹è§£æ 2ã€ä½¿ç”¨wgetå‘½ä»¤ï¼š wget â€œhttp://www.baidu.comâ€ä¹Ÿå¯ä»¥äºŒã€postè¯·æ±‚ 1ã€ä½¿ç”¨curlå‘½ä»¤ï¼ˆé€šè¿‡-då‚æ•°ï¼ŒæŠŠè®¿é—®å‚æ•°æ”¾åœ¨é‡Œé¢ï¼‰ï¼š curl -d â€œparam1=value1Â¶m2=value2â€ â€œhttp://www.baidu.comâ€ 2ã€ä½¿ç”¨wgetå‘½ä»¤ï¼šï¼ˆ--post-dataå‚æ•°æ¥å®ç°ï¼‰ wget --post-data â€˜user=foo&amp;password=barâ€™ http://www.baidu.com ä»¥ä¸Šå°±æ˜¯Linuxæ¨¡æ‹ŸHttpçš„getæˆ–postè¯·æ±‚çš„æ–¹æ³•äº†ï¼Œè¿™æ ·ä¸€æ¥Linuxç³»ç»Ÿä¹Ÿèƒ½å‘è¿œç¨‹æœåŠ¡å™¨å‘é€æ¶ˆæ¯äº†ã€‚## é˜²æŠ–èŠ‚æµ# Throttle and debounce## Throttle ï¼ˆå‡½æ•°èŠ‚æµï¼‰### Throttle å®šä¹‰å°±æ˜¯æŒ‡è¿ç»­è§¦å‘äº‹ä»¶ååœ¨ n ç§’å†…å‡½æ•°åªèƒ½æ‰§è¡Œä¸€æ¬¡å¦‚æœå°†æ°´é¾™å¤´æ‹§ç´§ç›´åˆ°æ°´æ˜¯ä»¥æ°´æ»´çš„å½¢å¼æµå‡ºï¼Œé‚£ä½ ä¼šå‘ç°æ¯éš”ä¸€æ®µæ—¶é—´ï¼Œå°±ä¼šæœ‰ä¸€æ»´æ°´æµå‡ºã€‚ä¹Ÿå°±æ˜¯ä¼šè¯´é¢„å…ˆè®¾å®šä¸€ä¸ªæ‰§è¡Œå‘¨æœŸï¼Œå½“è°ƒç”¨åŠ¨ä½œçš„æ—¶åˆ»å¤§äºç­‰äºæ‰§è¡Œå‘¨æœŸåˆ™æ‰§è¡Œè¯¥åŠ¨ä½œï¼Œç„¶åè¿›å…¥ä¸‹ä¸€ä¸ªæ–°å‘¨æœŸ```js/** * é¢‘ç‡æ§åˆ¶ è¿”å›å‡½æ•°è¿ç»­è°ƒç”¨æ—¶ï¼Œaction æ‰§è¡Œé¢‘ç‡é™å®šä¸º æ¬¡ / delay * @param delay &#123;number&#125; å»¶è¿Ÿæ—¶é—´ï¼Œå•ä½æ¯«ç§’ * @param action &#123;function&#125; è¯·æ±‚å…³è”å‡½æ•°ï¼Œå®é™…åº”ç”¨éœ€è¦è°ƒç”¨çš„å‡½æ•° * @return &#123;function&#125; è¿”å›å®¢æˆ·è°ƒç”¨å‡½æ•° */var throttle = function(delay, action) &#123; var last = 0; return function() &#123; var curr = +new Date(); if (curr - last &gt; delay) &#123; action.apply(this, arguments); last = curr; &#125; &#125;;&#125;; ç‰ˆæœ¬äºŒï¼š 1234567891011121314151617181920function throttle(fun, delay) &#123; let last, deferTimer; return function(args) &#123; let that = this; let _args = arguments; let now = +new Date(); if (last &amp;&amp; now &lt; last + delay) &#123; clearTimeout(deferTimer); // ä¿è¯ä¸€å®šä¼šæ‰§è¡Œä¸€æ¬¡ è¿™å°±æ˜¯è·Ÿé˜²æŠ–ä¸ä¸€æ ·çš„åœ°æ–¹ deferTimer = setTimeout(function() &#123; last = now; fun.apply(that, _args); &#125;, delay); &#125; else &#123; // ç¬¬ä¸€æ¬¡æˆ–è€…å½“æ—¶é—´é—´éš”è¾¾åˆ°è¦æ±‚çš„æ—¶å€™ä¼šæ‰§è¡Œå‡½æ•° last = now; fun.apply(that, _args); &#125; &#125;;&#125; æ¯”å¦‚æœç´¢æ¡† å½“ç”¨æˆ·è¾“å…¥é¢‘ç¹çš„æ—¶å€™ Debounce (å‡½æ•°å»æŠ–)Debounce å®šä¹‰å°±æ˜¯æŒ‡è§¦å‘äº‹ä»¶ååœ¨ n ç§’å†…å‡½æ•°åªèƒ½æ‰§è¡Œä¸€æ¬¡ï¼ˆæœ€åä¸€æ¬¡ï¼‰ï¼Œå¦‚æœåœ¨ n ç§’å†…åˆè§¦å‘äº†äº‹ä»¶ï¼Œåˆ™ä¼šé‡æ–°è®¡ç®—å‡½æ•°æ‰§è¡Œæ—¶é—´ã€‚ å¦‚æœç”¨æ‰‹æŒ‡ä¸€ç›´æŒ‰ä½ä¸€ä¸ªå¼¹ç°§ï¼Œå®ƒå°†ä¸ä¼šå¼¹èµ·ç›´åˆ°ä½ æ¾æ‰‹ä¸ºæ­¢ã€‚ ä¹Ÿå°±æ˜¯è¯´å½“è°ƒç”¨åŠ¨ä½œ n æ¯«ç§’åï¼Œæ‰ä¼šæ‰§è¡Œè¯¥åŠ¨ä½œï¼Œè‹¥åœ¨è¿™ n æ¯«ç§’å†…åˆè°ƒç”¨æ­¤åŠ¨ä½œåˆ™å°†é‡æ–°è®¡ç®—æ‰§è¡Œæ—¶é—´ 123456789101112131415161718/** * ç©ºé—²æ§åˆ¶ è¿”å›å‡½æ•°è¿ç»­è°ƒç”¨æ—¶ï¼Œç©ºé—²æ—¶é—´å¿…é¡»å¤§äºæˆ–ç­‰äº idleï¼Œaction æ‰ä¼šæ‰§è¡Œ * @param idle &#123;number&#125; ç©ºé—²æ—¶é—´ï¼Œå•ä½æ¯«ç§’ * @param action &#123;function&#125; è¯·æ±‚å…³è”å‡½æ•°ï¼Œå®é™…åº”ç”¨éœ€è¦è°ƒç”¨çš„å‡½æ•° * @return &#123;function&#125; è¿”å›å®¢æˆ·è°ƒç”¨å‡½æ•° */var debounce = function(idle, action) &#123; var last; return function() &#123; var ctx = this, args = arguments; clearTimeout(last); last = setTimeout(function() &#123; action.apply(ctx, args); &#125;, idle); &#125;;&#125;; åŒºåˆ« debouncesearch æœç´¢è”æƒ³ï¼Œç”¨æˆ·åœ¨ä¸æ–­è¾“å…¥å€¼æ—¶ï¼Œç”¨é˜²æŠ–æ¥èŠ‚çº¦è¯·æ±‚èµ„æºã€‚window è§¦å‘ resize çš„æ—¶å€™ï¼Œä¸æ–­çš„è°ƒæ•´æµè§ˆå™¨çª—å£å¤§å°ä¼šä¸æ–­çš„è§¦å‘è¿™ä¸ªäº‹ä»¶ï¼Œç”¨é˜²æŠ–æ¥è®©å…¶åªè§¦å‘ä¸€æ¬¡ throttleé¼ æ ‡ä¸æ–­ç‚¹å‡»è§¦å‘ï¼Œmousedown(å•ä½æ—¶é—´å†…åªè§¦å‘ä¸€æ¬¡)ç›‘å¬æ»šåŠ¨äº‹ä»¶ï¼Œæ¯”å¦‚æ˜¯å¦æ»‘åˆ°åº•éƒ¨è‡ªåŠ¨åŠ è½½æ›´å¤šï¼Œç”¨ throttle æ¥åˆ¤æ–­ vue çš„è·¯ç”±å¦‚ä½•å®ç°ï¼Œæœ€åæåˆ°äº†æœåŠ¡å™¨ç«¯æ¸²æŸ“ï¼Œè§£é‡Šå…¶è¿‡ç¨‹ å‰ç«¯è·¯ç”±å®ç°çš„å°±æ˜¯åŒ¹é…ä¸åŒçš„ url è·¯å¾„ï¼Œè¿›è¡Œè§£æï¼Œç„¶ååŠ¨æ€çš„æ¸²æŸ“å‡ºåŒºåŸŸ html å†…å®¹ hash æ¨¡å¼ã€‚hash å€¼å˜åŒ–ï¼Œæµè§ˆå™¨ä¸å‘å‡ºè¯·æ±‚ï¼Œä½†æ˜¯ä¼šè§¦å‘ hashchange è¿™ä¸ªäº‹ä»¶ï¼Œ é€šè¿‡è¿™ä¸ªäº‹ä»¶æˆ‘ä»¬å°±å¯ä»¥çŸ¥é“ hash å€¼å‘ç”Ÿäº†å“ªäº›å˜åŒ–ï¼Œæ¥æ›´æ–°é¡µé¢å†…å®¹ 1234function matchAndUpdate() &#123; // todo åŒ¹é… hash åš dom æ›´æ–°æ“ä½œ&#125;window.addEventListener(\"hashchange\", matchAndUpdate); history æ¨¡å¼. pushState å’Œ replaceState åˆ†åˆ«å¯ä»¥æ·»åŠ å’Œä¿®æ”¹å†å²è®°å½•æ¡ç›®,é€šè¿‡è¿™ä¸¤ä¸ª API å¯ä»¥æ”¹å˜ url åœ°å€ä¸”ä¸ä¼šå‘é€è¯·æ±‚,å½“ç”¨æˆ·åˆ·æ–°é¡µé¢ä¹‹ç±»çš„æ“ä½œæ—¶ï¼Œæµè§ˆå™¨è¿˜æ˜¯ä¼šç»™æœåŠ¡å™¨å‘é€è¯·æ±‚ã€‚ä¸ºäº†é¿å…å‡ºç°è¿™ç§æƒ…å†µï¼Œæ‰€ä»¥è¿™ä¸ªå®ç°éœ€è¦æœåŠ¡å™¨çš„æ”¯æŒï¼Œéœ€è¦æŠŠæ‰€æœ‰è·¯ç”±éƒ½é‡å®šå‘åˆ°æ ¹é¡µé¢ã€‚å½“å¤„äºæ¿€æ´»çŠ¶æ€çš„å†å²è®°å½•æ¡ç›®å‘ç”Ÿå˜åŒ–æ—¶,popstate äº‹ä»¶å°±ä¼šåœ¨å¯¹åº” window å¯¹è±¡ä¸Šè§¦å‘ animation transitionçš„åŒºåˆ« transition åŠ¨ç”»å¯ä»¥é€šè¿‡äº‹ä»¶ç›‘å¬å¯åŠ¨å’Œå®Œæˆtransitionstartã€transitionrunã€transitionend,transition åŠ¨ç”»æœ‰å‡ ä¸ªå±€é™ï¼š éœ€è¦é€šè¿‡ç”¨æˆ·çš„è¡Œä¸ºï¼ˆå¦‚ç‚¹å‡»ï¼Œæ‚¬æµ®ç­‰ï¼‰è§¦å‘ï¼Œæ‰€ä»¥æ²¡æ³•åœ¨ç½‘é¡µåŠ è½½æ—¶è‡ªåŠ¨å‘ç”Ÿ æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œä¸èƒ½é‡å¤å‘ç”Ÿ åªèƒ½å®šä¹‰å¼€å§‹çŠ¶æ€å’Œç»“æŸçŠ¶æ€ï¼Œä¸èƒ½å®šä¹‰ä¸­é—´çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯è¯´åªæœ‰ä¸¤ä¸ªçŠ¶æ€ã€‚ keyframes: å…³é”®å¸§ keyframe è‡ªå®šä¹‰åŠ¨ç”»,èƒ½å¤Ÿè‡ªå®šä¹‰ä»»æ„é˜¶æ®µçš„åŠ¨ç”»åŠ¨ä½œã€‚ animation åœ¨ä¸éœ€è¦è§¦å‘äº‹ä»¶çš„æƒ…å†µä¸‹ï¼Œä¹Ÿå¯ä»¥éšæ—¶é—´å˜åŒ–æ¥æ”¹å˜å…ƒç´  CSS å±æ€§ã€‚ å¯ä»¥æŒ‡å®šåŠ¨ç”»å…·ä½“æ’­æ”¾çš„æ¬¡æ•° å¯ä»¥æŒ‡å®šå„ä¸ªé˜¶æ®µçš„çŠ¶æ€ï¼Œè€Œä¸æ˜¯åªæœ‰å¼€å§‹å’Œç»“å°¾ã€‚ ä»‹ç» requestAnimateFrameï¼Œä¸ setInterval æˆ– setTimeout çš„åŒºåˆ« setTimeout: seTimeout å®ç°çš„åŠ¨ç”»å®¹æ˜“å‡ºç°å¡é¡¿ã€æŠ–åŠ¨çš„ç°è±¡ï¼Œæœ‰ä¸¤ä¸ªåŸå› å¯èƒ½ä¼šå¯¼è‡´ä¸¢å¸§ï¼š setTimeout çš„æ‰§è¡Œæ—¶é—´å¹¶ä¸æ˜¯ç¡®å®šçš„, setTimeout ä»»åŠ¡è¢«æ”¾è¿›äº†å¼‚æ­¥é˜Ÿåˆ—ä¸­ï¼Œåªæœ‰å½“ä¸»çº¿ç¨‹ä¸Šçš„ä»»åŠ¡æ‰§è¡Œå®Œä»¥åï¼Œæ‰ä¼šå»æ£€æŸ¥è¯¥é˜Ÿåˆ—é‡Œçš„ä»»åŠ¡æ˜¯å¦éœ€è¦å¼€å§‹æ‰§è¡Œï¼Œæ‰€ä»¥ setTimeout çš„å®é™…æ‰§è¡Œæ—¶æœºä¸€èˆ¬è¦æ¯”å…¶è®¾å®šçš„æ—¶é—´æ™šä¸€äº›ã€‚ åˆ·æ–°é¢‘ç‡å— å±å¹•åˆ†è¾¨ç‡ å’Œ å±å¹•å°ºå¯¸ çš„å½±å“ï¼Œä¸åŒè®¾å¤‡çš„å±å¹•ç»˜åˆ¶é¢‘ç‡å¯èƒ½ä¼šä¸åŒï¼Œè€Œ setTimeout åªèƒ½è®¾ç½®ä¸€ä¸ªå›ºå®šçš„æ—¶é—´é—´éš”ï¼Œè¿™ä¸ªæ—¶é—´ä¸ä¸€å®šå’Œå±å¹•çš„åˆ·æ–°æ—¶é—´ç›¸åŒã€‚ requestAnimateFrameï¼šè¯·æ±‚æµè§ˆå™¨åœ¨ä¸‹ä¸€æ¬¡é‡ç»˜ä¹‹å‰è°ƒç”¨æŒ‡å®šçš„å‡½æ•°æ¥æ›´æ–°åŠ¨ç”»,å›è°ƒçš„æ¬¡æ•°é€šå¸¸æ˜¯æ¯ç§’ 60 æ¬¡,è¿”å›ä¸€ä¸ª long æ•´æ•°ï¼Œè¯·æ±‚ IDï¼Œå¯ä»¥ä¼ è¿™ä¸ªå€¼ç»™ window.cancelAnimationFrame() ä»¥å–æ¶ˆå›è°ƒå‡½æ•°. æœ€å¤§çš„ä¼˜åŠ¿æ˜¯rAF çš„æ‰§è¡Œæ­¥ä¼è·Ÿç€æµè§ˆå™¨çš„ç»˜åˆ¶é¢‘ç‡èµ°ï¼Œè¿™æ ·å°±ä¸ä¼šå¼•èµ·ä¸¢å¸§ç°è±¡ï¼Œä¹Ÿä¸ä¼šå¯¼è‡´åŠ¨ç”»å‡ºç°å¡é¡¿çš„é—®é¢˜ã€‚ js ä¸ºä»€ä¹ˆè¦å•çº¿ç¨‹çš„ åœ¨å¤šçº¿ç¨‹æ“ä½œçš„æƒ…å†µä¸‹å¯ä»¥å®ç°åº”ç”¨çš„å¹¶è¡Œå¤„ç†ï¼Œè€Œæé«˜æ•´ä¸ªåº”ç”¨ç¨‹åºçš„æ€§èƒ½å’Œååé‡ï¼Œæ›´å¤§ç²’åº¦çš„æ¦¨å–æœ¬æœºçš„ CPU åˆ©ç”¨ç‡ï¼Œç‰¹åˆ«æ˜¯ç°ä»£å¾ˆå¤šè¯­è¨€éƒ½æ”¯æŒäº†å¤šæ ¸å¹¶è¡Œå¤„ç†æŠ€æœ¯ã€‚JavaScript æ˜¯å•çº¿ç¨‹æ‰§è¡Œï¼Œå› ä¸ºå¦‚æœ JavaScript æ˜¯å¤šçº¿ç¨‹çš„æ–¹å¼æ¥æ“ä½œ UIï¼Œåˆ™å¯èƒ½å‡ºç° UI æ“ä½œçš„å†²çª, å¦‚æœå¼•å…¥ä¸€äº›é”çš„æœºåˆ¶æ¥è§£å†³è¿™äº›å†²çªï¼Œåˆ™å®¹æ˜“å¼•å…¥æ›´å¤§çš„å¤æ‚æ€§ï¼Œæ‰€ä»¥ JavaScript ä»å¼€å§‹å°±é€‰æ‹©äº†å•çº¿ç¨‹æ‰§è¡Œã€‚ ## åŒæ­¥ä¸éåŒæ­¥ é˜»å¡éé˜»å¡ å¹¶å‘å¹¶è¡Œçš„åŒºåˆ«ç”¨æ™®é€šçš„æ°´å£¶çƒ§ï¼Œäººåœ¨è¾¹ä¸Šçœ‹ç€ï¼Œæ°´å¼€äº†å†å»çœ‹çƒã€‚ï¼ˆåŒæ­¥ï¼Œé˜»å¡ï¼‰è¿™ä¸ªæ˜¯å¸¸è§„åšæ³•ï¼Œä½†æ˜¯æˆ‘çœ‹çƒä¸çˆ½äº†ã€‚ç”¨æ™®é€šæ°´å£¶çƒ§ï¼Œäººå»çœ‹çƒï¼Œéš”å‡ åˆ†é’Ÿå»å¨æˆ¿çœ‹çœ‹ã€‚ï¼ˆåŒæ­¥ï¼Œéé˜»å¡ï¼‰è¿™ä¸ªåˆå¤§é—®é¢˜ï¼Œä¸‡ä¸€åœ¨æˆ‘ç¦»å¼€çš„å‡ åˆ†é’Ÿæ°´å¼€äº†ï¼Œæˆ‘å°±éº»çƒ¦äº†ã€‚ç”¨ä¼šå«çš„æ°´å£¶ï¼Œäººåœ¨è¾¹ä¸Šçœ‹ç€ã€‚ï¼ˆå¼‚æ­¥ï¼Œé˜»å¡ï¼‰è¿™ä¸ªæ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯æˆ‘å¤ªå‚»äº†ã€‚ç”¨ä¼šå«çš„æ°´å£¶ï¼Œäººå»çœ‹çƒï¼Œå¬è§æ°´å£¶å«äº†å†å»çœ‹ã€‚ï¼ˆå¼‚æ­¥ï¼Œéé˜»å¡ï¼‰è¿™ä¸ªåº”è¯¥æ˜¯æœ€å¥½çš„ã€‚ç­‰ç€çœ‹çƒçš„æˆ‘ï¼šé˜»å¡ çœ‹ç€ç”µè§†çš„æˆ‘ï¼šéé˜»å¡ æ™®é€šæ°´å£¶ï¼šåŒæ­¥ ä¼šå«çš„æ°´å£¶ï¼šå¼‚æ­¥ (å†…æ ¸ä¼šé€šçŸ¥) åŒæ­¥è¿‡ç¨‹ä¸­è¿›ç¨‹è§¦å‘ IO æ“ä½œå¹¶ç­‰å¾…æˆ–è€…è½®è¯¢çš„å»æŸ¥çœ‹ IO æ“ä½œæ˜¯å¦å®Œæˆã€‚å¼‚æ­¥è¿‡ç¨‹ä¸­è¿›ç¨‹è§¦å‘ IO æ“ä½œä»¥åï¼Œç›´æ¥è¿”å›ï¼Œåšè‡ªå·±çš„äº‹æƒ…ï¼ŒIO äº¤ç»™å†…æ ¸æ¥å¤„ç†ï¼Œå®Œæˆåå†…æ ¸é€šçŸ¥è¿›ç¨‹ IO å®Œæˆã€‚ é˜»å¡ é˜»å¡çš„æ¦‚å¿µå¾€å¾€ä¼´éšç€çº¿ç¨‹ã€‚é˜»å¡ä¸€èˆ¬æ˜¯æŒ‡ï¼šåœ¨è°ƒç”¨ç»“æœè¿”å›ä¹‹å‰ï¼Œå½“å‰çº¿ç¨‹ä¼šè¢«æŒ‚èµ·ã€‚è°ƒç”¨çº¿ç¨‹åªæœ‰åœ¨å¾—åˆ°ç»“æœä¹‹åæ‰ä¼šè¢«å”¤é†’æ‰§è¡Œåç»­çš„æ“ä½œã€‚ éé˜»å¡ é‚£ä¹ˆéé˜»å¡ï¼Œæ¯«æ— ç–‘é—®æ˜¯é˜»å¡çš„åå‘æ“ä½œã€‚éé˜»å¡å¼çš„è°ƒç”¨æŒ‡ï¼šåœ¨ç»“æœæ²¡æœ‰è¿”å›ä¹‹å‰ï¼Œè¯¥è°ƒç”¨ä¸ä¼šé˜»å¡ä½å½“å‰çº¿ç¨‹ã€‚ å¹¶å‘ï¼šå½“æœ‰å¤šä¸ªçº¿ç¨‹åœ¨æ“ä½œæ—¶ï¼Œå¦‚æœç³»ç»Ÿåªæœ‰ä¸€ä¸ª CPUï¼Œæ“ä½œç³»ç»Ÿåªèƒ½æŠŠ CPU è¿è¡Œæ—¶é—´åˆ’åˆ†æˆè‹¥å¹²ä¸ªæ—¶é—´æ®µ,å†å°†æ—¶é—´æ®µåˆ†é…ç»™å„ä¸ªçº¿ç¨‹æ‰§è¡Œï¼Œåœ¨ä¸€ä¸ªæ—¶é—´æ®µçš„å¿«é€Ÿçš„åˆ‡æ¢ä¸åŒçš„çº¿ç¨‹ä»£ç è¿è¡Œã€‚ å¹¶è¡Œï¼šå½“ç³»ç»Ÿæœ‰å¤šä¸ª CPU æ—¶ï¼Œå¯ä»¥å­˜åœ¨å½“ä¸€ä¸ª CPU æ‰§è¡Œä¸€ä¸ªçº¿ç¨‹æ—¶ï¼Œå¦ä¸€ä¸ª CPU å¯ä»¥æ‰§è¡Œå¦ä¸€ä¸ªçº¿ç¨‹ï¼Œä¸¤ä¸ªçº¿ç¨‹äº’ä¸æŠ¢å  CPU èµ„æºï¼Œå¯ä»¥åŒæ—¶è¿›è¡Œã€‚ nodejs ä¸­çš„é˜»å¡éé˜»å¡é˜»å¡ï¼Œè¯»å–æ–‡ä»¶åŒæ­¥ I/O æ“ä½œï¼Œç­‰å¾…æ–‡ä»¶è¯»å–å®Œå†è¿›è¡Œå…¶ä»–æ“ä½œã€‚ éé˜»å¡ï¼Œè¯»å–æ–‡ä»¶æ˜¯å¼‚æ­¥å›è°ƒï¼Œåœ¨ç­‰å¾…æ–‡ä»¶è¯»å–æ—¶å¯ä»¥è¿›è¡Œå…¶ä»–æ“ä½œï¼Œè¿™å°±å¤§å¤§æé«˜äº† Node.js çš„æ€§èƒ½ï¼Œå¯ä»¥å¤„ç†å¤§é‡çš„å¹¶å‘è¯·æ±‚ã€‚ react çš„ filber ï¼ˆ16.3ä¹‹åå¼€å¯å¼‚æ­¥æ¸²æŸ“) åœ¨ fiber ä¸­ï¼Œæ›´æ–°æ˜¯åˆ†é˜¶æ®µçš„ï¼Œå…·ä½“åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼Œé¦–å…ˆæ˜¯ reconciliation çš„é˜¶æ®µï¼Œè¿™ä¸ªé˜¶æ®µåœ¨è®¡ç®—å‰å dom æ ‘çš„å·®å¼‚ï¼Œç„¶åæ˜¯ commit çš„é˜¶æ®µï¼Œè¿™ä¸ªé˜¶æ®µå°†æŠŠæ›´æ–°æ¸²æŸ“åˆ°é¡µé¢ä¸Šã€‚ç¬¬ä¸€ä¸ªé˜¶æ®µæ˜¯å¯ä»¥æ‰“æ–­çš„ï¼Œå› ä¸ºè¿™ä¸ªé˜¶æ®µè€—æ—¶å¯èƒ½ä¼šå¾ˆé•¿ï¼Œå› æ­¤éœ€è¦æš‚åœä¸‹æ¥å»æ‰§è¡Œå…¶ä»–æ›´é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡ï¼Œç¬¬äºŒä¸ªé˜¶æ®µåˆ™ä¸ä¼šè¢«æ‰“æ–­ï¼Œä¼šä¸€å£æ°”æŠŠæ›´æ–°æ¸²æŸ“åˆ°é¡µé¢ä¸Šã€‚ ç”±äº reconciliation çš„é˜¶æ®µä¼šè¢«æ‰“æ–­ï¼Œå¯èƒ½ä¼šå¯¼è‡´ commit å‰çš„è¿™äº›ç”Ÿå‘½å‘¨æœŸå‡½æ•°å¤šæ¬¡æ‰§è¡Œã€‚react å®˜æ–¹ç›®å‰å·²ç»æŠŠ componentWillMountã€componentWillReceiveProps å’Œ componetWillUpdate æ ‡è®°ä¸º unsafeï¼Œå¹¶ä½¿ç”¨æ–°çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•° getDerivedStateFromProps å’Œ getSnapshotBeforeUpdate è¿›è¡Œæ›¿æ¢ã€‚ ç»„ä»¶çš„æ¸²æŸ“è¢«åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼šç¬¬ä¸€ä¸ªé˜¶æ®µï¼ˆä¹Ÿå«åš render é˜¶æ®µï¼‰æ˜¯å¯ä»¥è¢« React æ‰“æ–­çš„ï¼Œä¸€æ—¦è¢«æ‰“æ–­ï¼Œè¿™é˜¶æ®µæ‰€åšçš„æ‰€æœ‰äº‹æƒ…éƒ½è¢«åºŸå¼ƒï¼Œå½“ React å¤„ç†å®Œç´§æ€¥çš„äº‹æƒ…å›æ¥ï¼Œä¾ç„¶ä¼šé‡æ–°æ¸²æŸ“è¿™ä¸ªç»„ä»¶ï¼Œè¿™æ—¶å€™ç¬¬ä¸€é˜¶æ®µçš„å·¥ä½œä¼šé‡åšä¸€éï¼›ç¬¬äºŒä¸ªé˜¶æ®µå«åš commit é˜¶æ®µï¼Œä¸€æ—¦å¼€å§‹å°±ä¸èƒ½ä¸­æ–­ï¼Œä¹Ÿå°±æ˜¯è¯´ç¬¬äºŒä¸ªé˜¶æ®µçš„å·¥ä½œä¼šç¨³ç¨³å½“å½“åœ°åšåˆ°è¿™ä¸ªç»„ä»¶çš„æ¸²æŸ“ç»“æŸã€‚ ä¸¤ä¸ªé˜¶æ®µçš„åˆ†ç•Œç‚¹ï¼Œå°±æ˜¯ render å‡½æ•°ã€‚render å‡½æ•°ä¹‹å‰çš„æ‰€æœ‰ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼ˆåŒ…æ‹¬ render)éƒ½å±äºç¬¬ä¸€é˜¶æ®µï¼Œä¹‹åçš„éƒ½å±äºç¬¬äºŒé˜¶æ®µã€‚render ä¹‹å‰çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼ˆä¹Ÿå°±æ˜¯ç¬¬ä¸€é˜¶æ®µç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼‰åŒ…æ‹¬è¿™äº›ï¼š componentWillReceiveProps shouldComponentUpdate componentWillUpdate componentWillMount render getDerivedStateFromProps åº”è¯¥æ˜¯ä¸€ä¸ªçº¯å‡½æ•°ï¼ŒReact å°±æ˜¯é€šè¿‡è¦æ±‚è¿™ç§çº¯å‡½æ•°ï¼Œå¼ºåˆ¶å¼€å‘è€…ä»¬å¿…é¡»é€‚åº”å¼‚æ­¥æ¸²æŸ“ã€‚ reconciliation é˜¶æ®µè™šæ‹Ÿ dom çš„æ•°æ®å¯¹æ¯” commit é˜¶æ®µå°† change list æ›´æ–°åˆ° dom ä¸Š ä¸é€‚åˆæ‹†åˆ†æ˜¯å› ä¸ºä½¿ç”¨ vdom çš„æ„ä¹‰å°±æ˜¯ä¸ºäº†èŠ‚çœè€—æ—¶çš„ dom æ“ä½œ linuxå¸¸è§å‘½ä»¤ åˆ›å»ºç¬¦å·é“¾æ¥ï¼ˆç±»ä¼¼windowsçš„å¿«æ·æ–¹å¼) ln -s source_file symbolic_link æ‰“å¼€æ–‡ä»¶è·³åˆ°ç¬¬ä¸€ä¸ªåŒ¹é…çš„è¡Œ $ vim +/search-term filename.txt grepç›¸å…³ 1.åœ¨æ–‡ä»¶ä¸­æŸ¥æ‰¾å­—ç¬¦ä¸²ä¸åŒºåˆ†å¤§å°å†™ $ grep -i â€œtheâ€ demo_file2.åœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­é€’å½’æŸ¥è¯¢åŒ…å«æŒ‡å®šå­—ç¬¦ä¸²çš„æ–‡ä»¶$ grep -r â€œrameshâ€ * æŸ¥æ‰¾æŒ‡å®šæ–‡ä»¶åçš„æ–‡ä»¶(ä¸åŒºåˆ†å¤§å°å†™) find -iname â€˜..â€™ ç™»å½•åˆ°è¿œç¨‹ä¸»æœº $ ssh -l jsmith remotehost.example.com ps 1.æŸ¥çœ‹å½“å‰æ­£åœ¨è¿è¡Œçš„æ‰€æœ‰è¿›ç¨‹ $ ps -ef | more2.ä»¥æ ‘çŠ¶ç»“æ„æ˜¾ç¤ºå½“å‰æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ï¼ŒHé€‰é¡¹è¡¨ç¤ºæ˜¾ç¤ºè¿›ç¨‹çš„å±‚æ¬¡ç»“æ„$ ps -efH | more æ˜¾ç¤ºå½“å‰ç³»ç»Ÿä¸­å ç”¨èµ„æºæœ€å¤šçš„ä¸€äº›è¿›ç¨‹top æŸ¥çœ‹æ‰€æœ‰ç½‘ç»œæ¥å£åŠå…¶çŠ¶æ€ $ ifconfig -a ä½¿ç”¨upå’Œdownå‘½ä»¤å¯åŠ¨æˆ–åœæ­¢æŸä¸ªæ¥å£ $ ifconfig eth0 up $ ifconfig eth0 down æŸ¥æ‰¾æŸä¸ªå‘½ä»¤çš„ä½ç½® $ whereis cmd ä¸åŠ è½½æ•´ä¸ªæ–‡ä»¶çš„å‰æä¸‹æ˜¾ç¤ºæ–‡ä»¶å†…å®¹ (æŸ¥çœ‹å¤§å‹æ—¥å¿—æ–‡ä»¶çš„æ—¶å€™) $ less è®¾ç½®ç¯å¢ƒå˜é‡ $ export â€¦ catè¿½åŠ aå†…å®¹åˆ°æ–‡ä»¶bçš„æœ«å°¾ $ cat a &gt; b catè¦†ç›–åŸæœ‰æ–‡ä»¶çš„å†…å®¹ $ cat a &gt;&gt; b curlå‘½ä»¤ç›¸å…³ 1.æ¨¡ä»¿æµè§ˆå™¨ $ curl -A â€œMozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.0)â€ http://www.linux.com2.ä¼ªé€ refererï¼ˆç›—é“¾ï¼‰$ curl -e â€œwww.linux.com&quot; http://mail.linux.com3.åˆ©ç”¨curlä¸‹è½½æ–‡ä»¶ä½¿ç”¨å†…ç½®optionï¼š-o(å°å†™)$ curl -o dodo1.jpg http:www.linux.com/dodo1.JPG4.ä½¿ç”¨curlå‘é€POSTè¯·æ±‚$ curl -d â€œuser=admin&amp;passwd=12345678â€ http://127.0.0.1:8080/login å‰ç«¯æ¨¡å—åŒ–CommonJsç”¨åœ¨æœåŠ¡å™¨ç«¯ï¼ŒAMDå’ŒCMDç”¨åœ¨æµè§ˆå™¨ç¯å¢ƒAMD:æå‰æ‰§è¡Œï¼ˆå¼‚æ­¥åŠ è½½ï¼šä¾èµ–å…ˆæ‰§è¡Œï¼‰+å»¶è¿Ÿæ‰§è¡ŒCMD:å»¶è¿Ÿæ‰§è¡Œï¼ˆè¿è¡Œåˆ°éœ€åŠ è½½ï¼Œæ ¹æ®é¡ºåºæ‰§è¡Œï¼‰ ç§»åŠ¨ç«¯ç›¸å…³ç§»åŠ¨ç«¯ç‚¹å‡» 300ms å»¶è¿Ÿæ˜¯ä»€ä¹ˆï¼Ÿæ€æ ·æ¶ˆé™¤ï¼Ÿä¸ºäº†åŒå‡»ç¼©æ”¾ï¼Œé¡µé¢ç‚¹å‡»ä¼šæœ‰ 300ms å»¶è¿Ÿè§£å†³æ–¹æ³•ï¼Œç¦ç”¨ç¼©æ”¾ï¼Œæ›´æ”¹é»˜è®¤çš„è§†å£å®½åº¦&lt;meta name=â€viewportâ€ content=â€user-scalable=no, initial-scale=1,maximum-scale=1, width=device-widthâ€&gt;","categories":[],"tags":[{"name":"é¢ç»","slug":"é¢ç»","permalink":"https://ashleyblog.xyz/tags/é¢ç»/"}]},{"title":"å‰ç«¯æ–‡ä»¶ä¸Šä¼ ","slug":"å‰ç«¯æ–‡ä»¶ä¸Šä¼ ","date":"2019-06-14T13:28:11.000Z","updated":"2023-04-02T14:00:30.293Z","comments":true,"path":"2019/06/14/å‰ç«¯æ–‡ä»¶ä¸Šä¼ /","link":"","permalink":"https://ashleyblog.xyz/2019/06/14/å‰ç«¯æ–‡ä»¶ä¸Šä¼ /","excerpt":"","text":"ä¸Šä¼ æ–‡ä»¶çš„å‡ ç§æ–¹å¼ æ™®é€šè¡¨å•ä¸Šä¼ ä½¿ç”¨ PHP æ¥å±•ç¤ºå¸¸è§„çš„è¡¨å•ä¸Šä¼ æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚é¦–å…ˆæ„å»ºæ–‡ä»¶ä¸Šä¼ çš„è¡¨å•ï¼Œå¹¶æŒ‡å®šè¡¨å•çš„æäº¤å†…å®¹ç±»å‹ä¸º enctype=â€multipart/form-dataâ€ï¼Œè¡¨æ˜è¡¨å•éœ€è¦ä¸Šä¼ äºŒè¿›åˆ¶æ•°æ®ã€‚ 1234&lt;form action=\"/index.php\" method=\"POST\" enctype=\"multipart/form-data\"&gt; &lt;input type=\"file\" name=\"myfile\"&gt; &lt;input type=\"submit\"&gt;&lt;/form&gt; æ–‡ä»¶ç¼–ç ä¸Šä¼ ç¬¬ä¸€ä¸ªæ€è·¯æ˜¯å°†æ–‡ä»¶è¿›è¡Œç¼–ç ï¼Œç„¶ååœ¨æœåŠ¡ç«¯è¿›è¡Œè§£ç ï¼Œä¹‹å‰å†™è¿‡ä¸€ç¯‡åœ¨å‰ç«¯å®ç°å›¾ç‰‡å‹ç¼©ä¸Šä¼ çš„åšå®¢ï¼Œå…¶ä¸»è¦å®ç°åŸç†å°±æ˜¯å°†å›¾ç‰‡è½¬æ¢æˆ base64 è¿›è¡Œä¼ é€’var imgURL = URL.createObjectURL(file);ctx.drawImage(imgURL, 0, 0);// è·å–å›¾ç‰‡çš„ç¼–ç ï¼Œç„¶åå°†å›¾ç‰‡å½“åšæ˜¯ä¸€ä¸ªå¾ˆé•¿çš„å­—ç¬¦ä¸²è¿›è¡Œä¼ é€’var data = canvas.toDataURL(â€œimage/jpegâ€, 0.5); é™¤äº†è¿›è¡Œ base64 ç¼–ç ï¼Œè¿˜å¯ä»¥åœ¨å‰ç«¯ç›´æ¥è¯»å–æ–‡ä»¶å†…å®¹åä»¥äºŒè¿›åˆ¶æ ¼å¼ä¸Šä¼  12345678910111213141516// è¯»å–äºŒè¿›åˆ¶æ–‡ä»¶function readBinary(text) &#123; var data = new ArrayBuffer(text.length) var ui8a = new Uint8Array(data, 0) for (var i = 0; i &lt; text.length; i++) &#123; ui8a[i] = text.charCodeAt(i) &amp; 0xff &#125; console.log(ui8a)&#125;var reader = new FileReader()reader.onload = function() &#123; readBinary(this.result) // è¯»å–resultæˆ–ç›´æ¥ä¸Šä¼ &#125;// æŠŠä»inputé‡Œè¯»å–çš„æ–‡ä»¶å†…å®¹ï¼Œæ”¾åˆ°fileReaderçš„resultå­—æ®µé‡Œreader.readAsBinaryString(file) æ–‡ä»¶ä¸Šä¼ 123456789101112131415161718192021222324252627282930313233343536373839404142434445function uploadAndSubmit() &#123;var form = document.forms[\"demoForm\"];if (form[\"file\"].files.length &gt; 0) &#123;// å¯»æ‰¾è¡¨å•åŸŸä¸­çš„ &lt;input type=\"file\" ... /&gt; æ ‡ç­¾var file = form[\"file\"].files[0];// try sendingvar reader = new FileReader();reader.onloadstart = function() &#123;// è¿™ä¸ªäº‹ä»¶åœ¨è¯»å–å¼€å§‹æ—¶è§¦å‘console.log(\"onloadstart\");document.getElementById(\"bytesTotal\").textContent = file.size;&#125;reader.onprogress = function(p) &#123;// è¿™ä¸ªäº‹ä»¶åœ¨è¯»å–è¿›è¡Œä¸­å®šæ—¶è§¦å‘console.log(\"onprogress\");document.getElementById(\"bytesRead\").textContent = p.loaded;&#125;reader.onload = function() &#123; // è¿™ä¸ªäº‹ä»¶åœ¨è¯»å–æˆåŠŸç»“æŸåè§¦å‘console.log(\"load complete\");&#125;reader.onloadend = function() &#123; // è¿™ä¸ªäº‹ä»¶åœ¨è¯»å–ç»“æŸåï¼Œæ— è®ºæˆåŠŸæˆ–è€…å¤±è´¥éƒ½ä¼šè§¦å‘if (reader.error) &#123;console.log(reader.error);&#125; else &#123;document.getElementById(\"bytesRead\").textContent = file.size;// æ„é€  XMLHttpRequest å¯¹è±¡ï¼Œå‘é€æ–‡ä»¶ Binary æ•°æ®var xhr = new XMLHttpRequest();xhr.open(/* method */ \"POST\",/* target url */ \"upload.jsp?fileName=\" + file.name/*, async, default to true */);// äºŒè¿›åˆ¶æµ// æŒ‡å®šä¸€ä¸ªMIMEç±»å‹ç”¨äºæ›¿ä»£æœåŠ¡å™¨æŒ‡å®šçš„ç±»å‹ï¼Œä½¿æœåŠ¡ç«¯å“åº”ä¿¡æ¯ä¸­ä¼ è¾“çš„æ•°æ®æŒ‰ç…§è¯¥æŒ‡å®šMIMEç±»å‹å¤„ç†xhr.overrideMimeType(\"application/octet-stream\");xhr.sendAsBinary(reader.result);xhr.onreadystatechange = function() &#123;if (xhr.readyState == 4) &#123;if (xhr.status == 200) &#123;console.log(\"upload complete\");console.log(\"response: \" + xhr.responseText); formData å¼‚æ­¥ä¸Šä¼ FormData å¯¹è±¡ä¸»è¦ç”¨æ¥ç»„è£…ä¸€ç»„ç”¨ XMLHttpRequest å‘é€è¯·æ±‚çš„é”®/å€¼å¯¹ï¼Œå¯ä»¥æ›´åŠ çµæ´»åœ°å‘é€ Ajax è¯·æ±‚ã€‚å¯ä»¥ä½¿ç”¨ FormData æ¥æ¨¡æ‹Ÿè¡¨å•æäº¤ã€‚ 1234let files = e.target.files // è·å– input çš„ file å¯¹è±¡let formData = new FormData()formData.append('file', file)axios.post(url, formData) å¤§æ–‡ä»¶ä¸Šä¼ å¤§æ–‡ä»¶ä¸Šä¼ æœ€ä¸»è¦çš„é—®é¢˜å°±åœ¨äºï¼šåœ¨åŒä¸€ä¸ªè¯·æ±‚ä¸­ï¼Œè¦ä¸Šä¼ å¤§é‡çš„æ•°æ®ï¼Œå¯¼è‡´æ•´ä¸ªè¿‡ç¨‹ä¼šæ¯”è¾ƒæ¼«é•¿ï¼Œä¸”å¤±è´¥åéœ€è¦é‡å¤´å¼€å§‹ä¸Šä¼ ã€‚è¯•æƒ³ï¼Œå¦‚æœæˆ‘ä»¬å°†è¿™ä¸ªè¯·æ±‚æ‹†åˆ†æˆå¤šä¸ªè¯·æ±‚ï¼Œæ¯ä¸ªè¯·æ±‚çš„æ—¶é—´å°±ä¼šç¼©çŸ­ï¼Œä¸”å¦‚æœæŸä¸ªè¯·æ±‚å¤±è´¥ï¼Œåªéœ€è¦é‡æ–°å‘é€è¿™ä¸€æ¬¡è¯·æ±‚å³å¯ï¼Œæ— éœ€ä»å¤´å¼€å§‹ï¼Œè¿™æ ·æ˜¯å¦å¯ä»¥è§£å†³å¤§æ–‡ä»¶ä¸Šä¼ çš„é—®é¢˜å‘¢ï¼Ÿ æ–‡ä»¶åˆ‡ç‰‡å‚è€ƒï¼š å¤§æ–‡ä»¶åˆ‡å‰²ä¸Šä¼ ç¼–ç æ–¹å¼ä¸Šä¼ ä¸­ï¼Œåœ¨å‰ç«¯æˆ‘ä»¬åªè¦å…ˆè·å–æ–‡ä»¶çš„äºŒè¿›åˆ¶å†…å®¹ï¼Œç„¶åå¯¹å…¶å†…å®¹è¿›è¡Œæ‹†åˆ†ï¼Œæœ€åå°†æ¯ä¸ªåˆ‡ç‰‡ä¸Šä¼ åˆ°æœåŠ¡ç«¯å³å¯ã€‚åœ¨ JavaScript ä¸­ï¼Œæ–‡ä»¶ FIle å¯¹è±¡æ˜¯ Blob å¯¹è±¡çš„å­ç±»ï¼ŒBlob å¯¹è±¡åŒ…å«ä¸€ä¸ªé‡è¦çš„æ–¹æ³• sliceï¼Œé€šè¿‡è¿™ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¯¹äºŒè¿›åˆ¶æ–‡ä»¶è¿›è¡Œæ‹†åˆ†ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªæ‹†åˆ†æ–‡ä»¶çš„ç¤ºä¾‹ 123456789101112131415161718192021222324252627function slice(file, piece = 1024 * 1024 * 5) &#123; let totalSize = file.size; // æ–‡ä»¶æ€»å¤§å° let start = 0; // æ¯æ¬¡ä¸Šä¼ çš„å¼€å§‹å­—èŠ‚ let end = start + piece; // æ¯æ¬¡ä¸Šä¼ çš„ç»“å°¾å­—èŠ‚ let chunks = [] while (start &lt; totalSize) &#123; // æ ¹æ®é•¿åº¦æˆªå–æ¯æ¬¡éœ€è¦ä¸Šä¼ çš„æ•°æ® // Fileå¯¹è±¡ç»§æ‰¿è‡ªBlobå¯¹è±¡ï¼Œå› æ­¤åŒ…å«sliceæ–¹æ³• let blob = file.slice(start, end); chunks.push(blob) start = end; end = start + piece; &#125; return chunks&#125;å°†æ–‡ä»¶æ‹†åˆ†æˆpieceå¤§å°çš„åˆ†å—ï¼Œç„¶åæ¯æ¬¡è¯·æ±‚åªéœ€è¦ä¸Šä¼ è¿™ä¸€ä¸ªéƒ¨åˆ†çš„åˆ†å—å³å¯let file = document.querySelector(\"[name=file]\").files[0];const LENGTH = 1024 * 1024 * 0.1;let chunks = slice(file, LENGTH); // é¦–å…ˆæ‹†åˆ†åˆ‡ç‰‡chunks.forEach(chunk=&gt;&#123; let fd = new FormData(); fd.append(\"file\", chunk); post('/mkblk.php', fd)&#125;) æ–­ç‚¹ç»­ä¼ å³ä½¿å°†å¤§æ–‡ä»¶æ‹†åˆ†æˆåˆ‡ç‰‡ä¸Šä¼ ï¼Œæˆ‘ä»¬ä»éœ€ç­‰å¾…æ‰€æœ‰åˆ‡ç‰‡ä¸Šä¼ å®Œæ¯•ï¼Œåœ¨ç­‰å¾…è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½å‘ç”Ÿä¸€ç³»åˆ—å¯¼è‡´éƒ¨åˆ†åˆ‡ç‰‡ä¸Šä¼ å¤±è´¥çš„æƒ…å½¢ï¼Œå¦‚ç½‘ç»œæ•…éšœã€é¡µé¢å…³é—­ç­‰ã€‚ç”±äºåˆ‡ç‰‡æœªå…¨éƒ¨ä¸Šä¼ ï¼Œå› æ­¤æ— æ³•é€šçŸ¥æœåŠ¡ç«¯åˆæˆæ–‡ä»¶ã€‚è¿™ç§æƒ…å†µä¸‹å¯ä»¥é€šè¿‡æ–­ç‚¹ç»­ä¼ æ¥è¿›è¡Œå¤„ç†ã€‚æ–­ç‚¹ç»­ä¼ æŒ‡çš„æ˜¯ï¼šå¯ä»¥ä»å·²ç»ä¸Šä¼ éƒ¨åˆ†å¼€å§‹ç»§ç»­ä¸Šä¼ æœªå®Œæˆçš„éƒ¨åˆ†ï¼Œè€Œæ²¡æœ‰å¿…è¦ä»å¤´å¼€å§‹ä¸Šä¼ ï¼ŒèŠ‚çœä¸Šä¼ æ—¶é—´ã€‚ç”±äºæ•´ä¸ªä¸Šä¼ è¿‡ç¨‹æ˜¯æŒ‰åˆ‡ç‰‡ç»´åº¦è¿›è¡Œçš„ï¼Œä¸” mkfile æ¥å£æ˜¯åœ¨æ‰€æœ‰åˆ‡ç‰‡ä¸Šä¼ å®Œæˆåç”±å®¢æˆ·ç«¯ä¸»åŠ¨è°ƒç”¨çš„ï¼Œå› æ­¤æ–­ç‚¹ç»­ä¼ çš„å®ç°ä¹Ÿååˆ†ç®€å•ï¼š åœ¨åˆ‡ç‰‡ä¸Šä¼ æˆåŠŸåï¼Œä¿å­˜å·²ä¸Šä¼ çš„åˆ‡ç‰‡ä¿¡æ¯å½“ä¸‹æ¬¡ä¼ è¾“ç›¸åŒæ–‡ä»¶æ—¶ï¼Œéå†åˆ‡ç‰‡åˆ—è¡¨ï¼Œåªé€‰æ‹©æœªä¸Šä¼ çš„åˆ‡ç‰‡è¿›è¡Œä¸Šä¼ æ‰€æœ‰åˆ‡ç‰‡ä¸Šä¼ å®Œæ¯•åï¼Œå†è°ƒç”¨ mkfile æ¥å£é€šçŸ¥æœåŠ¡ç«¯è¿›è¡Œæ–‡ä»¶åˆå¹¶ å› æ­¤é—®é¢˜å°±è½åœ¨äº†å¦‚ä½•ä¿å­˜å·²ä¸Šä¼ åˆ‡ç‰‡çš„ä¿¡æ¯äº†ï¼Œä¿å­˜ä¸€èˆ¬æœ‰ä¸¤ç§ç­–ç•¥ å¯ä»¥é€šè¿‡ locaStorage ç­‰æ–¹å¼ä¿å­˜åœ¨å‰ç«¯æµè§ˆå™¨ä¸­ï¼Œè¿™ç§æ–¹å¼ä¸ä¾èµ–äºæœåŠ¡ç«¯ï¼Œå®ç°èµ·æ¥ä¹Ÿæ¯”è¾ƒæ–¹ä¾¿ï¼Œç¼ºç‚¹åœ¨äºå¦‚æœç”¨æˆ·æ¸…é™¤äº†æœ¬åœ°æ–‡ä»¶ï¼Œä¼šå¯¼è‡´ä¸Šä¼ è®°å½•ä¸¢å¤±æœåŠ¡ç«¯æœ¬èº«çŸ¥é“å“ªäº›åˆ‡ç‰‡å·²ç»ä¸Šä¼ ï¼Œå› æ­¤å¯ä»¥ç”±æœåŠ¡ç«¯é¢å¤–æä¾›ä¸€ä¸ªæ ¹æ®æ–‡ä»¶ context æŸ¥è¯¢å·²ä¸Šä¼ åˆ‡ç‰‡çš„æ¥å£ï¼Œåœ¨ä¸Šä¼ æ–‡ä»¶å‰è°ƒç”¨è¯¥æ–‡ä»¶çš„å†å²ä¸Šä¼ è®°å½•ä¸‹é¢è®©æˆ‘ä»¬é€šè¿‡åœ¨æœ¬åœ°ä¿å­˜å·²ä¸Šä¼ åˆ‡ç‰‡è®°å½•ï¼Œæ¥å®ç°æ–­ç‚¹ä¸Šä¼ çš„åŠŸèƒ½ 12345678910111213141516171819202122232425262728293031323334353637383940 // è·å–å·²ä¸Šä¼ åˆ‡ç‰‡è®°å½•function getUploadSliceRecord(context)&#123; let record = localStorage.getItem(context) if(!record)&#123; return [] &#125;else &#123; try&#123; return JSON.parse(record) &#125;catch(e)&#123;&#125; &#125;&#125;// ä¿å­˜å·²ä¸Šä¼ åˆ‡ç‰‡function saveUploadSliceRecord(context, sliceIndex)&#123; let list = getUploadSliceRecord(context) list.push(sliceIndex) localStorage.setItem(context, JSON.stringify(list))&#125;// ç„¶åå¯¹ä¸Šä¼ é€»è¾‘ç¨ä½œä¿®æ”¹ï¼Œä¸»è¦æ˜¯å¢åŠ ä¸Šä¼ å‰æ£€æµ‹æ˜¯å·²ç»ä¸Šä¼ ã€ä¸Šä¼ åä¿å­˜è®°å½•çš„é€»è¾‘let context = createContext(file);// è·å–ä¸Šä¼ è®°å½•let record = getUploadSliceRecord(context);let tasks = [];chunks.forEach((chunk, index) =&gt; &#123; // å·²ä¸Šä¼ çš„åˆ‡ç‰‡åˆ™ä¸å†é‡æ–°ä¸Šä¼  if(record.includes(index))&#123; return &#125; let fd = new FormData(); fd.append(\"file\", chunk); fd.append(\"context\", context); fd.append(\"chunk\", index + 1); let task = post(\"/mkblk.php\", fd).then(res=&gt;&#123; // ä¸Šä¼ æˆåŠŸåä¿å­˜å·²ä¸Šä¼ åˆ‡ç‰‡è®°å½• saveUploadSliceRecord(context, index) record.push(index) &#125;) tasks.push(task);&#125;); æ­¤æ—¶ä¸Šä¼ æ—¶åˆ·æ–°é¡µé¢æˆ–è€…å…³é—­æµè§ˆå™¨ï¼Œå†æ¬¡ä¸Šä¼ ç›¸åŒæ–‡ä»¶æ—¶ï¼Œä¹‹å‰å·²ç»ä¸Šä¼ æˆåŠŸçš„åˆ‡ç‰‡å°±ä¸ä¼šå†é‡æ–°ä¸Šä¼ äº†ã€‚æœåŠ¡ç«¯å®ç°æ–­ç‚¹ç»­ä¼ çš„é€»è¾‘åŸºæœ¬ç›¸ä¼¼ï¼Œåªè¦åœ¨ getUploadSliceRecord å†…éƒ¨è°ƒç”¨æœåŠ¡ç«¯çš„æŸ¥è¯¢æ¥å£è·å–å·²ä¸Šä¼ åˆ‡ç‰‡çš„è®°å½•å³å¯ï¼Œå› æ­¤è¿™é‡Œä¸å†å±•å¼€ã€‚æ­¤å¤–æ–­ç‚¹ç»­ä¼ è¿˜éœ€è¦è€ƒè™‘åˆ‡ç‰‡è¿‡æœŸçš„æƒ…å†µï¼šå¦‚æœè°ƒç”¨äº† mkfile æ¥å£ï¼Œåˆ™ç£ç›˜ä¸Šçš„åˆ‡ç‰‡å†…å®¹å°±å¯ä»¥æ¸…é™¤æ‰äº†ï¼Œå¦‚æœå®¢æˆ·ç«¯ä¸€ç›´ä¸è°ƒç”¨ mkfile çš„æ¥å£ï¼Œæ”¾ä»»è¿™äº›åˆ‡ç‰‡ä¸€ç›´ä¿å­˜åœ¨ç£ç›˜æ˜¾ç„¶æ˜¯ä¸å¯é çš„ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåˆ‡ç‰‡ä¸Šä¼ éƒ½æœ‰ä¸€æ®µæ—¶é—´çš„æœ‰æ•ˆæœŸï¼Œè¶…è¿‡è¯¥æœ‰æ•ˆæœŸï¼Œå°±ä¼šè¢«æ¸…é™¤æ‰ã€‚åŸºäºä¸Šè¿°åŸå› ï¼Œæ–­ç‚¹ç»­ä¼ ä¹Ÿå¿…é¡»åŒæ­¥åˆ‡ç‰‡è¿‡æœŸçš„å®ç°é€»è¾‘ã€‚ ä¸Šä¼ è¿›åº¦å’Œæš‚åœé€šè¿‡ xhr.upload ä¸­çš„ progress æ–¹æ³•å¯ä»¥å®ç°ç›‘æ§æ¯ä¸€ä¸ªåˆ‡ç‰‡ä¸Šä¼ è¿›åº¦ã€‚ä¸Šä¼ æš‚åœçš„å®ç°ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œé€šè¿‡ xhr.abort å¯ä»¥å–æ¶ˆå½“å‰æœªå®Œæˆä¸Šä¼ åˆ‡ç‰‡çš„ä¸Šä¼ ï¼Œå®ç°ä¸Šä¼ æš‚åœçš„æ•ˆæœï¼Œæ¢å¤ä¸Šä¼ å°±è·Ÿæ–­ç‚¹ç»­ä¼ ç±»ä¼¼ï¼Œå…ˆè·å–å·²ä¸Šä¼ çš„åˆ‡ç‰‡åˆ—è¡¨ï¼Œç„¶åé‡æ–°å‘é€æœªä¸Šä¼ çš„åˆ‡ç‰‡ã€‚ 123456xhr.upload.onprogress = function(event) &#123; if (event.lengthComputable) &#123; var percentComplete = (event.loaded / event.total) * 100 // å¯¹è¿›åº¦è¿›è¡Œå¤„ç† &#125;&#125; å…¶ä¸­äº‹ä»¶çš„ lengthComputable å±æ€§ä»£è¡¨æ–‡ä»¶æ€»å¤§å°æ˜¯å¦å¯çŸ¥ã€‚å¦‚æœ lengthComputable å±æ€§çš„å€¼æ˜¯ falseï¼Œé‚£ä¹ˆæ„å‘³ç€æ€»å­—èŠ‚æ•°æ˜¯æœªçŸ¥å¹¶ä¸” total çš„å€¼ä¸ºé›¶ã€‚ å¦‚æœæ˜¯ç°ä»£æµè§ˆå™¨ï¼Œå¯ä»¥ç›´æ¥é…åˆ HTML5 æä¾›çš„ å›¾ç‰‡é¢„è§ˆ12345678910111213141516function handleImageFile(file) &#123; var previewArea = document.getElementById('previewArea') var img = document.createElement('img') var fileInput = document.getElementById('myFile') var file = fileInput.files[0] img.file = file previewArea.appendChild(img) var reader = new FileReader() reader.onload = (function(aImg) &#123; return function(e) &#123; aImg.src = e.target.result &#125; &#125;)(img) reader.readAsDataURL(file)&#125; è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ FileReader æ¥å¤„ç†å›¾ç‰‡çš„å¼‚æ­¥åŠ è½½ã€‚åœ¨åˆ›å»ºæ–°çš„ FileReader å¯¹è±¡ä¹‹åï¼Œæˆ‘ä»¬å»ºç«‹äº† onload å‡½æ•°ï¼Œç„¶åè°ƒç”¨ readAsDataURL()å¼€å§‹åœ¨åå°è¿›è¡Œè¯»å–æ“ä½œã€‚å½“å›¾åƒæ–‡ä»¶åŠ è½½åï¼Œè½¬æ¢æˆä¸€ä¸ª data: URLï¼Œå¹¶ä¼ é€’åˆ° onload å›è°ƒå‡½æ•°ä¸­è®¾ç½®ç»™ img çš„ srcã€‚è¯¥å‡½æ•°å¯ä»¥å¸®åŠ©å®ç°é¢„è§ˆä»¥åŠå‹ç¼©å›¾ç‰‡çš„åŠŸèƒ½ 123456789å¦å¤–æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ä½¿ç”¨å¯¹è±¡URLæ¥å®ç°é¢„è§ˆvar img = document.createElement('img')img.src = window.URL.createObjectURL(file)img.onload = function() &#123; // æ˜ç¡®åœ°é€šè¿‡è°ƒç”¨é‡Šæ”¾ window.URL.revokeObjectURL(this.src)&#125;previewArea.appendChild(img) å¤šæ–‡ä»¶æ”¯æŒ12345678910&lt;input id=\"myFile\" type=\"file\" multiple&gt;// æˆ‘ä»¬å°±èƒ½åœ¨æ‰“å¼€çš„æ–‡ä»¶é€‰æ‹©å¯¹è¯æ¡†ä¸­é€‰ä¸­å¤šä¸ªæ–‡ä»¶äº†ã€‚ç„¶åä½ åœ¨ä»£ç é‡Œæ‹¿åˆ°çš„FileUploadå¯¹è±¡çš„fileså±æ€§å°±æ˜¯ä¸€ä¸ªé€‰ä¸­çš„å¤šæ–‡ä»¶çš„æ•°ç»„äº†ã€‚var fileInput = document.getElementById(\"myFile\");var files = fileInput.files;var formData = new FormData();for(var i = 0; i &lt; files.length; i++) &#123;var file = files[i];formData.append('files[]', file, file.name);&#125; FormDataçš„appendæ–¹æ³•æä¾›ç¬¬ä¸‰ä¸ªå¯é€‰å‚æ•°ç”¨äºæŒ‡å®šæ–‡ä»¶åï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªè¡¨å•é¡¹åï¼Œç„¶åç”¨æ–‡ä»¶ååŒºåˆ†ä¸Šä¼ çš„å¤šä¸ªæ–‡ä»¶ã€‚è¿™æ ·ä¹Ÿæ–¹ä¾¿å‰åå°çš„å¾ªç¯æ“ä½œã€‚ å›¾ç‰‡å‹ç¼©ä½¿ç”¨filereaderè¯»å–åˆ°å›¾ç‰‡ä¹‹åä½¿ç”¨canvaså‹ç¼©å›¾ç‰‡çš„å°ºå¯¸ 12345678910111213141516171819202122232425262728293031323334compress (data, callback) &#123; /** * å‹ç¼©å›¾ç‰‡ * @param data fileæ–‡ä»¶ æ•°æ®ä¼šä¸€ç›´å‘ä¸‹ä¼ é€’ * @param callback ä¸‹ä¸€æ­¥å›è°ƒ */ const &#123;compressionRatio&#125; = this.props; const imgFile = data.file; const img = new window.Image(); img.src = data.dataUrl; img.onload = function () &#123; const canvas = document.createElement('canvas'); const ctx = canvas.getContext('2d'); canvas.width = img.width; canvas.height = img.height; ctx.drawImage(img, 0, 0, canvas.width, canvas.height); let compressedDataUrl; if(data.compress)&#123; compressedDataUrl = canvas.toDataURL(imgFile.type, (compressionRatio / 100)); &#125; else &#123; compressedDataUrl = canvas.toDataURL(imgFile.type, 1); &#125; data.compressedDataUrl = compressedDataUrl; callback(data); &#125; &#125; ç»“åˆ xhr çš„ progress äº‹ä»¶å®ç°ä¸Šä¼ è¿›åº¦æ¡12345678910111213141516171819202122uploadImg (data, formData) &#123; // å¼€å§‹å‘é€è¯·æ±‚ä¸Šä¼  const _this = this; const xhr = new XMLHttpRequest(); const &#123;uploadUrl&#125; = this.props; // è¿›åº¦ç›‘å¬ xhr.upload.addEventListener('progress', _this.handleProgress.bind(_this, data.uuid), false);... xhr.open('POST', uploadUrl , true); xhr.send(formData); &#125; handleProgress (id, e) &#123; // ç›‘å¬ä¸Šä¼ è¿›åº¦ æ“ä½œDOM æ˜¾ç¤ºè¿›åº¦ const number = Number.parseInt((e.loaded / e.total) * 100) + \"%\"; const text = document.querySelector('#text-'+id); const progress = document.querySelector('#progress-'+id); text.innerHTML = number; progress.style.width = number; &#125; ä¸Šä¼ å¤šä¸ªæ–‡ä»¶12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273*uploadGenerator (uploadQueue) &#123; /** * å¤šå¼ å›¾ç‰‡å¹¶å‘ä¸Šä¼ æ§åˆ¶è§„åˆ™ * ä¸Šä¼ 1-maxæ•°é‡çš„å›¾ç‰‡ * è®¾ç½®ä¸€ä¸ªæœ€å¤§ä¸Šä¼ æ•°é‡ * ä¿è¯æœ€å¤§åªæœ‰è¿™ä¸ªæ•°é‡çš„ä¸Šä¼ è¯·æ±‚ * */ // æœ€å¤šåªæœ‰ä¸‰ä¸ªè¯·æ±‚åœ¨ä¸Šä¼  const maxUploadSize = 3; if(uploadQueue.length &gt; maxUploadSize)&#123; const result = []; for(let i = 0; i &lt; uploadQueue.length; i++)&#123; // ç¬¬ä¸€æ¬¡return maxUploadSizeæ•°é‡çš„å›¾ç‰‡ if(i &lt; maxUploadSize)&#123; result.push(uploadQueue[i]); if(i === maxUploadSize - 1)&#123; yield result; &#125; &#125; else &#123; yield [uploadQueue[i]]; &#125; &#125; &#125; else &#123; yield uploadQueue.map((item)=&gt;(item)); &#125; &#125;// è°ƒç”¨// é€šè¿‡è¯¥å‡½æ•°è·å–æ¯æ¬¡è¦ä¸Šä¼ çš„æ•°ç»„ this.uploadGen = this.uploadGenerator(uploadQueue); // ç¬¬ä¸€æ¬¡è¦ä¸Šä¼ çš„æ•°é‡ const firstUpload = this.uploadGen.next(); // çœŸæ­£å¼€å§‹ä¸Šä¼ æµç¨‹ firstUpload.value.map((item)=&gt;&#123; /** * å›¾ç‰‡ä¸Šä¼ åˆ†æˆ5æ­¥ * å›¾ç‰‡è½¬dataUrl * å‹ç¼© * å¤„ç†æ•°æ®æ ¼å¼ * å‡†å¤‡æ•°æ®ä¸Šä¼  * ä¸Šä¼  * * å‰ä¸¤æ­¥æ˜¯å›è°ƒçš„å½¢å¼ åé¢æ˜¯åŒæ­¥çš„å½¢å¼ */ this.transformFileToDataUrl(item, this.compress, this.processData); &#125;);// ä¸Šä¼ ä¸‹ä¸€ä¸ª function uploadImgxhr.onreadystatechange = function () &#123; if (xhr.readyState === 4) &#123; if (xhr.status === 200 || xhr.status === 201) &#123; // ä¸Šä¼ æˆåŠŸ _this.handleUploadEnd(data, 2); &#125; else &#123; // ä¸Šä¼ å¤±è´¥ _this.handleUploadEnd(data, 3); &#125; &#125; &#125;;// function handleuploadend const nextUpload = this.uploadGen.next(); if(!nextUpload.done)&#123; nextUpload.value.map((item)=&gt;&#123; _this.transformFileToDataUrl(item, _this.compress, _this.processData); &#125;); &#125; ç§»åŠ¨ç«¯ä¸Šä¼ æ–‡ä»¶çš„å…¼å®¹æ€§é—®é¢˜éƒ¨åˆ†å®‰å“å¾®ä¿¡æµè§ˆå™¨æ— æ³•è§¦å‘ onchange äº‹ä»¶ï¼ˆç¬¬ä¸€æ­¥å°±ç‰¹ä¹ˆé‡åˆ°é—®é¢˜ï¼‰è¿™å…¶å®å®‰å“å¾®ä¿¡çš„ä¸€ä¸ªé—ç•™é—®é¢˜ã€‚ æŸ¥çœ‹è®¨è®º è§£å†³åŠæ³•ä¹Ÿå¾ˆç®€å•ï¼šinput æ ‡ç­¾ &lt;input type=â€œfileâ€ name=â€imageâ€ accept=â€image/gif, image/jpeg, image/pngâ€&gt;è¦å†™æˆå°±æ²¡é—®é¢˜äº†ã€‚éƒ¨åˆ†å®‰å“å¾®ä¿¡ä¸æ”¯æŒ Blob å¯¹è±¡éƒ¨åˆ† Blob å¯¹è±¡ append è¿› FormData ä¸­å‡ºç°é—®é¢˜iOS 8 ä¸æ”¯æŒ new File Constructorï¼Œä½†æ˜¯æ”¯æŒ input é‡Œçš„ file å¯¹è±¡ã€‚iOS ä¸Šç»è¿‡å‹ç¼©åçš„å›¾ç‰‡å¯ä»¥ä¸Šä¼ æˆåŠŸ ä½†æ˜¯ size æ˜¯ 0 æ— æ³•æ‰“å¼€ã€‚éƒ¨åˆ†æ‰‹æœºå‡ºç°å›¾ç‰‡ä¸Šä¼ è½¬æ¢é—®é¢˜ï¼Œè¯·ç§»æ­¥ã€‚å®‰å“æ‰‹æœºä¸æ”¯æŒå¤šé€‰ï¼ŒåŸå› åœ¨äº multiple å±æ€§æ ¹æœ¬å°±ä¸æ”¯æŒã€‚å¤šå¼ å›¾ç‰‡è½¬ base64 æ—¶å€™å¡é¡¿ï¼Œå› ä¸ºè°ƒç”¨äº† cpu è¿›è¡Œäº†è®¡ç®—ã€‚ä¸Šä¼ å›¾ç‰‡å¯ä»¥ä½¿ç”¨ base64 ä¸Šä¼ æˆ–è€… formData ä¸Šä¼  è§£å†³å¯¹ç­– å‚è€ƒæ–‡ç«  ç§»åŠ¨ç«¯ H5 å®ç°å›¾ç‰‡ä¸Šä¼  æ¯æ—¥å°çŸ¥è¯†ç‚¹ é€‰å–ç¬¬ä¸€ä¸ªåˆ°å€’æ•°ç¬¬äºŒä¸ªå…ƒç´  aaa.slice(0,-1)","categories":[],"tags":[{"name":"åŸºç¡€æŠ€èƒ½","slug":"åŸºç¡€æŠ€èƒ½","permalink":"https://ashleyblog.xyz/tags/åŸºç¡€æŠ€èƒ½/"}]}]}