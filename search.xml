<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>æ¨¡å—è”é‚¦åœ¨å¾®å‰ç«¯æ¶æ„ä¸­çš„å®è·µ</title>
      <link href="/ashley271017.github.io/2023/04/23/%E6%A8%A1%E5%9D%97%E8%81%94%E9%82%A6%E5%9C%A8%E5%BE%AE%E5%89%8D%E7%AB%AF%E6%9E%B6%E6%9E%84%E4%B8%AD%E7%9A%84%E5%AE%9E%E8%B7%B5/"/>
      <url>/ashley271017.github.io/2023/04/23/%E6%A8%A1%E5%9D%97%E8%81%94%E9%82%A6%E5%9C%A8%E5%BE%AE%E5%89%8D%E7%AB%AF%E6%9E%B6%E6%9E%84%E4%B8%AD%E7%9A%84%E5%AE%9E%E8%B7%B5/</url>
      
        <content type="html"><![CDATA[<h3 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h3><p>æˆ‘ä»¬æœ‰ä¸€ä¸ªç”¨Reactç¼–å†™çš„ç®¡ç†é¢æ¿ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬è·Ÿè¸ªå’Œç®¡ç†Trendyol GOï¼ˆHÄ±zlÄ± Marketå’ŒTrendyol Yemekï¼‰ä¸­æ‰€æœ‰é˜¶æ®µçš„è®¢å•ã€‚å•ä¸€ä»“åº“å¾ˆå¥½åœ°æ»¡è¶³äº†æˆ‘ä»¬çš„æœŸæœ›ï¼Œå› ä¸ºä¸€å¼€å§‹æˆ‘ä»¬æ˜¯å”¯ä¸€çš„å›¢é˜Ÿï¼Œå‘˜å·¥æ•°é‡ä¸å¤šã€‚</p><p>å•ä¸€çš„ä»“åº“å¹¶ä¸æ€»æ˜¯åçš„ã€‚å¦‚æœå®ƒèƒ½æ»¡è¶³ä½ çš„æœŸæœ›ï¼Œå¦‚æœå®ƒä¸ä¼šç»™ä½ å¸¦æ¥è´Ÿé¢å½±å“ï¼Œé‚£ä¹ˆä½ å¯ä»¥ä½¿ç”¨å„ç§æ–¹æ³•ã€‚é‡è¦çš„æ˜¯ï¼›æ‰¾åˆ°ä»¥æœ€æœ‰æ•ˆçš„æ–¹å¼è¾¾åˆ°ä½ çš„ç›®æ ‡çš„æ–¹æ³•ã€‚</p><p>å¤§çº¦1.5å¹´åï¼Œå½“æˆ‘ä»¬çš„é˜Ÿå‹äººæ•°å˜å¾—è¶³å¤Ÿå¤šæ—¶ï¼Œæˆ‘ä»¬ä»¥é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDDDï¼‰çš„ç†å¿µå°†æˆ‘ä»¬çš„å›¢é˜Ÿåˆ’åˆ†ä¸ºå¤šä¸ªå°å›¢é˜Ÿã€‚åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œæˆ‘ä»¬å¿…é¡»è®¾è®¡å¾®å‰ç«¯çš„ç»“æ„ï¼Œä½¿æ¯ä¸ªå›¢é˜Ÿå¯ä»¥ç‹¬ç«‹å¼€å‘åº”ç”¨ã€‚</p><p>æˆ‘ä¹‹å‰åœ¨å‡ ä¸ªä¸åŒçš„é¡¹ç›®ä¸­æœ‰è¿‡å¾®å‰ç«¯çš„ç»éªŒã€‚æˆ‘ä¹Ÿæ›¾è‡ªå·±è®¾è®¡è¿‡ä¸€ä¸ªå¾®å‰ç«¯æ¶æ„ï¼Œä½†ç ”ç©¶æ‰€æœ‰å…¶ä»–çš„æ›¿ä»£æ–¹æ¡ˆå¹¶é€‰æ‹©æœ€èƒ½æ»¡è¶³æˆ‘ä»¬éœ€æ±‚çš„æ–¹æ¡ˆæ˜¯æ›´åˆç†çš„ã€‚æˆ‘ä»¬æ¢ç´¢äº†æ‰€æœ‰çš„æ›¿ä»£æ–¹æ¡ˆï¼Œæƒè¡¡äº†æ¯ä¸ªæ–¹æ¡ˆçš„åˆ©å¼Šï¼ˆæˆ‘ä¸ä¼šåœ¨è¿™ç¯‡æ–‡ç« ä¸­è°ˆè®ºæ‰€æœ‰çš„æ›¿ä»£æ–¹æ¡ˆï¼Œå› ä¸ºé‚£æ˜¯å¦ä¸€ä¸ªè¯é¢˜ã€‚ï¼‰ï¼Œåœ¨è¯„ä¼°çš„æœ€åï¼Œæˆ‘ä»¬å‘ç°Webpack æ¨¡å—è”é‚¦å¯ä»¥å¾ˆå¥½åœ°æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ã€‚</p><h3 id="ä¸ºä»€ä¹ˆæ˜¯Webpackæ¨¡å—è”é‚¦ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆæ˜¯Webpackæ¨¡å—è”é‚¦ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆæ˜¯Webpackæ¨¡å—è”é‚¦ï¼Ÿ"></a>ä¸ºä»€ä¹ˆæ˜¯Webpackæ¨¡å—è”é‚¦ï¼Ÿ</h3><p>å½“æˆ‘ä»¬ç ”ç©¶äº†æ‰€æœ‰çš„æ›¿ä»£æ–¹æ¡ˆåï¼Œå‡ºäºä»¥ä¸‹åŸå› ï¼Œé€‰æ‹©Webpackæ¨¡å—è”é‚¦æ›´æœ‰æ„ä¹‰ã€‚</p><ul><li>æ²¡æœ‰ç»´æŠ¤æˆæœ¬ï¼ˆå¦‚æœä½ è‡ªå·±å»ºç«‹ä¸€ä¸ªæ¶æ„ï¼Œä¼šæœ‰ç»´æŠ¤æˆæœ¬ï¼‰</li><li>æ²¡æœ‰å›¢é˜Ÿç‰¹å®šçš„å­¦ä¹ æˆæœ¬ï¼ˆå¦‚æœä½ è‡ªå·±å»ºç«‹ä¸€ä¸ªæ¶æ„ï¼Œä¼šæœ‰å­¦ä¹ æˆæœ¬ï¼‰</li><li>å‘æ¨¡å—è”é‚¦è¿‡æ¸¡çš„æˆæœ¬å¾ˆå°</li><li>ä¸éœ€è¦å¯¹æ¯ä¸ªé¡¹ç›®è¿›è¡Œé‡æ–°æ¶æ„</li><li>æ‰€æœ‰çš„éœ€æ±‚éƒ½åœ¨æ„å»ºæ—¶å¾—åˆ°æ»¡è¶³</li><li>åœ¨è¿è¡Œæ—¶ä¸éœ€è¦é¢å¤–çš„å·¥ä½œ</li><li>åˆ†äº«ä¾èµ–çš„æˆæœ¬ä½</li><li>åº“/æ¡†æ¶ç‹¬ç«‹</li><li>ä½ ä¸éœ€è¦å¤„ç†æ‰€æœ‰çš„å‹ç¼©å’Œç¼“å­˜é—®é¢˜</li><li>ä½ ä¸éœ€è¦å¤„ç†è·¯ç”±é—®é¢˜</li><li>Shellå’ŒMicro Appsä¸æ˜¯ç´§è€¦åˆçš„ï¼Œè€Œæ˜¯æ¾è€¦åˆçš„</li></ul><h3 id="æ€ä¹ˆä½¿ç”¨æ¨¡å—è”é‚¦"><a href="#æ€ä¹ˆä½¿ç”¨æ¨¡å—è”é‚¦" class="headerlink" title="æ€ä¹ˆä½¿ç”¨æ¨¡å—è”é‚¦"></a>æ€ä¹ˆä½¿ç”¨æ¨¡å—è”é‚¦</h3><p>æœ‰ä»¥ä¸‹ä¸‰ç§å½¢å¼ï¼š<br><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c89068c356144bf589969d20075c9920~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p><ol><li>åŸŸå</li></ol><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä½ å¯ä»¥åˆ›å»ºå°½å¯èƒ½å¤šçš„å¾®å‹å‰ç«¯ï¼ˆåº”ç”¨ç¨‹åºï¼‰ï¼Œå¹¶é€šè¿‡Shell Appç®¡ç†å®Œå…¨ç‹¬ç«‹çš„åŸŸã€‚ä¾‹å¦‚ï¼Œæƒ³è±¡ä¸€ä¸‹ï¼Œåœ¨Shell Appä¸­æœ‰ä¸€ä¸ªèœå•ï¼Œå½“é“¾æ¥è¢«ç‚¹å‡»æ—¶ï¼Œå®ƒå°†åœ¨å³è¾¹å¸¦å‡ºç›¸å…³çš„åº”ç”¨ç¨‹åºã€‚</p><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/eaa5805591af4ed6aaee48060f696170~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p><p>2.å¾®ä»¶</p><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä½ å¯ä»¥ä»ä»»ä½•åº”ç”¨ç¨‹åºä¸­æ·»åŠ ä»»ä½•å¾®ä»¶/ç»„ä»¶ï¼ˆå³ä¸€å°æ®µä»£ç ï¼‰åˆ°ä»»ä½•åº”ç”¨ç¨‹åºã€‚ä½ å¯ä»¥åœ¨äº§å“åº”ç”¨ä¸­çš„ç”¨æˆ·åº”ç”¨ä¸­å…¬å¼€UserDetailç»„ä»¶ã€‚</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f8aac1a33666430bb823aab7ae0c1e80~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p><ol start="3"><li>æ··åˆå‹</li></ol><p>ä½ å¯ä»¥åŒæ—¶ä½¿ç”¨ç¬¬ä¸€å’Œç¬¬äºŒç§æ–¹å¼ã€‚</p><h3 id="å¼€å§‹å®è·µ"><a href="#å¼€å§‹å®è·µ" class="headerlink" title="å¼€å§‹å®è·µ"></a>å¼€å§‹å®è·µ</h3><p>é¦–å…ˆåˆ›å»ºä¸€ä¸ªapp å‘½åä¸ºshellï¼Œå¹¶ä¸”ä»¥ç›¸åŒçš„æ–¹å¼åˆ›å»ºåº”ç”¨product &amp; user</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx create-react-app shellcd shellyarn add webpack webpack-cli webpack-server html-webpack-plugin css-loader style-loader babel-loader webpack-dev-server</span><br></pre></td></tr></table></figure><h4 id="ç¬¬ä¸€æ­¥ï¼šåˆå§‹åŒ–é¡¹ç›®"><a href="#ç¬¬ä¸€æ­¥ï¼šåˆå§‹åŒ–é¡¹ç›®" class="headerlink" title="ç¬¬ä¸€æ­¥ï¼šåˆå§‹åŒ–é¡¹ç›®"></a>ç¬¬ä¸€æ­¥ï¼šåˆå§‹åŒ–é¡¹ç›®</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import React from &apos;react&apos;;</span><br><span class="line">import ReactDOM from &apos;react-dom&apos;;</span><br><span class="line">import App from &apos;./App&apos;;ReactDOM.render(</span><br><span class="line">  &lt;App /&gt;,</span><br><span class="line">  document.getElementById(&apos;root&apos;)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h4 id="ç¬¬äºŒæ­¥ï¼šé…ç½®webpack"><a href="#ç¬¬äºŒæ­¥ï¼šé…ç½®webpack" class="headerlink" title="ç¬¬äºŒæ­¥ï¼šé…ç½®webpack"></a>ç¬¬äºŒæ­¥ï¼šé…ç½®webpack</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">const HtmlWebpackPlugin = require(&apos;html-webpack-plugin&apos;);</span><br><span class="line">const ModuleFederationPlugin = require(&apos;webpack/lib/container/ModuleFederationPlugin&apos;);</span><br><span class="line">const deps = require(&apos;./package.json&apos;).dependencies;</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">  mode: &apos;development&apos;,</span><br><span class="line">  devServer: &#123;</span><br><span class="line">    port: 3001,</span><br><span class="line">  &#125;,</span><br><span class="line">  module: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: /.js?$/,</span><br><span class="line">        exclude: /node_modules/,</span><br><span class="line">        loader: &apos;babel-loader&apos;,</span><br><span class="line">        options: &#123;</span><br><span class="line">          presets: [</span><br><span class="line">            &apos;@babel/preset-env&apos;,</span><br><span class="line">            &apos;@babel/preset-react&apos;,</span><br><span class="line">          ],</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: /.css$/i,</span><br><span class="line">        use: [&quot;style-loader&quot;, &quot;css-loader&quot;],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    new ModuleFederationPlugin(</span><br><span class="line">      &#123;</span><br><span class="line">        name: &apos;SHELL&apos;,</span><br><span class="line">        filename: &apos;remoteEntry.js&apos;,</span><br><span class="line">        shared: [</span><br><span class="line">          &#123;</span><br><span class="line">            ...deps,</span><br><span class="line">            react: &#123; requiredVersion: deps.react, singleton: true &#125;,</span><br><span class="line">            &apos;react-dom&apos;: &#123;</span><br><span class="line">              requiredVersion: deps[&apos;react-dom&apos;],</span><br><span class="line">              singleton: true,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;</span><br><span class="line">    ),</span><br><span class="line">    new HtmlWebpackPlugin(&#123;</span><br><span class="line">      template:</span><br><span class="line">        &apos;./public/index.html&apos;,</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­å…³äºæ¨¡å—è”é‚¦çš„é…ç½®é¡¹ï¼Œè§£é‡Šå¦‚ä¸‹ï¼š</p><ul><li>name: æˆ‘ä»¬ç”¨å®ƒæ¥ç¡®å®šåº”ç”¨ç¨‹åºçš„åç§°ã€‚æˆ‘ä»¬å°†é€šè¿‡è¿™ä¸ªåç§°ä¸å…¶ä»–åº”ç”¨ç¨‹åºè¿›è¡Œäº¤æµã€‚</li><li>filename: æˆ‘ä»¬ç”¨å®ƒä½œä¸ºä¸€ä¸ªå…¥å£æ–‡ä»¶ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå…¶ä»–åº”ç”¨ç¨‹åºå°†èƒ½å¤Ÿé€šè¿‡è¾“å…¥ â€œSHELL@<a href="http://localhost:3001/remoteEntry.js" target="_blank" rel="noopener">http://localhost:3001/remoteEntry.js</a> â€œè®¿é—®SHELLåº”ç”¨ç¨‹åºã€‚</li><li>sharedï¼ˆå…±äº«ï¼‰ã€‚æˆ‘ä»¬ç”¨å®ƒæ¥æŒ‡å®šè¿™ä¸ªåº”ç”¨ç¨‹åºå°†ä¸å…¶ä»–åº”ç”¨ç¨‹åºå…±äº«å“ªäº›ä¾èµ–ã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ <code>&quot;singleton: true&quot;</code>ã€‚å¦‚æœä½ ä¸å†™ <code>&quot;singleton: true&quot;</code>ï¼Œæ¯ä¸ªåº”ç”¨ç¨‹åºå°†åœ¨ä¸€ä¸ªå•ç‹¬çš„Reactå®ä¾‹ä¸Šè¿è¡Œ</li></ul><p>æŠŠåŒæ ·çš„æ–‡ä»¶å¤åˆ¶åˆ°<code>User</code>å’Œ <code>Product</code>é¡¹ç›®ï¼Œä½†ä¸è¦å¿˜è®°å¢åŠ ç«¯å£å’Œæ”¹å˜åç§°å­—æ®µã€‚</p><h4 id="ç¬¬ä¸‰æ­¥ï¼šè®¾è®¡"><a href="#ç¬¬ä¸‰æ­¥ï¼šè®¾è®¡" class="headerlink" title="ç¬¬ä¸‰æ­¥ï¼šè®¾è®¡"></a>ç¬¬ä¸‰æ­¥ï¼šè®¾è®¡</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// app.js</span><br><span class="line">import React from &apos;react&apos;;</span><br><span class="line">import &apos;./App.css&apos;;const App = () =&gt; (</span><br><span class="line">  &lt;div className=&quot;shell-app&quot;&gt;</span><br><span class="line">    &lt;h2&gt;Hi from Shell App&lt;/h2&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">);export default App;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// app.css</span><br><span class="line">.shell-app &#123;  </span><br><span class="line">margin: 5px;  </span><br><span class="line">text-align: center;  </span><br><span class="line">background: #FFF3E0;  </span><br><span class="line">border: 1px dashed #FFB74D;  </span><br><span class="line">border-radius: 5px;  </span><br><span class="line">color: #FFB74D;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä¸¤ä¸ªæ–‡ä»¶éƒ½æ”¾åˆ°srcä¸‹ï¼Œ<strong>Product</strong> ä»¥åŠ <strong>User</strong> é¡¹ç›®ä¹ŸåšåŒæ ·çš„æ›´æ”¹ï¼Œåªæ˜¯å°†srcå‘½åä¸ºshellã€‚<br>ä¸‰ä¸ªé¡¹ç›®ä¾æ¬¡è¿è¡Œä»¥ä¸‹çš„å‘½ä»¤</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn webpack server</span><br></pre></td></tr></table></figure><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b6cee64b353844d792e4a5e27221c166~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p><p>ç°åœ¨ï¼Œæˆ‘ä»¬æ‰€æœ‰çš„åº”ç”¨ç¨‹åºéƒ½ä¸ºMicro Frontendsæ¶æ„åšå¥½äº†å‡†å¤‡ï¼Œå¹¶ä¸”å¯ä»¥ç›¸äº’ç‹¬ç«‹è¿è¡Œã€‚ğŸ‰</p><h4 id="ç¬¬å››æ­¥ï¼šæ•´åˆ"><a href="#ç¬¬å››æ­¥ï¼šæ•´åˆ" class="headerlink" title="ç¬¬å››æ­¥ï¼šæ•´åˆ"></a>ç¬¬å››æ­¥ï¼šæ•´åˆ</h4><p>æ˜¯æ—¶å€™æåˆ°æ¨¡å—è”é‚¦çš„ä¸¤ä¸ªä¼Ÿå¤§çš„åŠŸèƒ½äº† :)</p><p><strong>expose</strong>ï¼šå®ƒå…è®¸ä½ ä»ä»»ä½•åº”ç”¨ç¨‹åºåˆ°å¦ä¸€ä¸ªåº”ç”¨ç¨‹åº<strong>å…±äº«ä¸€ä¸ªç»„ä»¶ã€ä¸€ä¸ªé¡µé¢æˆ–æ•´ä¸ªåº”ç”¨ç¨‹åº</strong>ã€‚ä½ æ‰€æš´éœ²çš„ä¸€åˆ‡éƒ½è¢«åˆ›å»ºä¸ºä¸€ä¸ªå•ç‹¬çš„æ„å»ºï¼Œä»è€Œåˆ›é€ äº†ä¸€ä¸ªè‡ªç„¶çš„<code>tree shaking</code>ã€‚<strong>æ¯ä¸ªæ„å»ºéƒ½ä»¥æ–‡ä»¶çš„MD5å“ˆå¸Œå€¼å‘½åï¼Œæ‰€ä»¥ä½ ä¸å¿…æ‹…å¿ƒç¼“å­˜çš„é—®é¢˜ã€‚</strong></p><p><strong>remoteï¼š</strong> å®ƒå†³å®šäº†ä½ å°†ä»å“ªäº›åº”ç”¨ç¨‹åºæ¥æ”¶ä¸€ä¸ªç»„ä»¶ã€ä¸€ä¸ªé¡µé¢æˆ–åº”ç”¨ç¨‹åºæœ¬èº«ã€‚<br>æ¯ä¸ªåº”ç”¨ç¨‹åºéƒ½å¯ä»¥åŒæ—¶æš´éœ²å’Œå®šä¹‰ä¸€ä¸ªè¿œç¨‹ï¼Œå¹¶å¤šæ¬¡è¿›è¡Œã€‚</p><p>ç°åœ¨è®©æˆ‘ä»¬æŠŠ<code>Product</code>åº”ç”¨æš´éœ²ç»™<code>Shell</code>åº”ç”¨ï¼Œè®©æˆ‘ä»¬åšç¬¬ä¸€ä¸ªå¾®å‰ç«¯è¿æ¥ã€‚</p><p>è®©æˆ‘ä»¬æ‰“å¼€äº§å“ repo ä¸­çš„ <code>webpack.config.js</code> æ–‡ä»¶ï¼Œå¹¶æ”¹å˜å…¶ä¸­ä¼ ç»™<code>ModuleFederationPlugin</code>ä¸­çš„å¯¹è±¡ï¼Œå¦‚ä¸‹ã€‚exposeså¯¹è±¡ä¸­çš„å€¼å†³å®šäº†å®ƒåœ¨repoä¸­å…±äº«å“ªä¸ªç»„ä»¶ï¼Œè€Œå¯¹è±¡ä¸­çš„keyå†³å®šäº†å…¶ä»–åº”ç”¨ç¨‹åºå¯ä»¥è®¿é—®è¿™ä¸ªç»„ä»¶çš„åç§°ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">new ModuleFederationPlugin(</span><br><span class="line">  &#123;</span><br><span class="line">    name: &apos;PRODUCT&apos;,</span><br><span class="line">    filename: &apos;remoteEntry.js&apos;,</span><br><span class="line">    exposes: &#123;</span><br><span class="line">      &apos;./App&apos;: &apos;./src/App&apos;,</span><br><span class="line">    &#125;,</span><br><span class="line">    shared: [</span><br><span class="line">      &#123;</span><br><span class="line">        ...deps,</span><br><span class="line">        react: &#123; requiredVersion: deps.react, singleton: true &#125;,</span><br><span class="line">        &apos;react-dom&apos;: &#123;</span><br><span class="line">          requiredVersion: deps[&apos;react-dom&apos;],</span><br><span class="line">          singleton: true,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;</span><br><span class="line">),</span><br></pre></td></tr></table></figure><p>è®©æˆ‘ä»¬æ‰“å¼€<code>shell repo</code>ä¸­çš„<code>webpack.config.js</code>æ–‡ä»¶ï¼Œå°†å…¶ä¸­ä¼ ç»™<code>ModuleFederationPlugin</code>æ–¹æ³•çš„å¯¹è±¡åšå¦‚ä¸‹ä¿®æ”¹ã€‚remoteså¯¹è±¡ä¸­çš„å€¼å†³å®šäº†å¦‚ä½•è®¿é—®<code>Product</code>ï¼ˆ@ç¬¦å·å‰çš„åç§°å¿…é¡»ä¸<code>Product</code>åº“ä¸­<code>Webpack config</code>ä¸­çš„åç§°ç›¸åŒï¼‰ï¼Œå¯¹è±¡ä¸­çš„keyå…è®¸æˆ‘ä»¬åªç”¨åç§°æ¥è®¿é—®<code>Product</code>ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">new ModuleFederationPlugin(</span><br><span class="line">  &#123;</span><br><span class="line">    name: &apos;SHELL&apos;,</span><br><span class="line">    filename: &apos;remoteEntry.js&apos;,</span><br><span class="line">    remotes: &#123;</span><br><span class="line">      PRODUCT: &apos;PRODUCT@http://localhost:3002/remoteEntry.js&apos;</span><br><span class="line">    &#125;,</span><br><span class="line">    shared: [</span><br><span class="line">      &#123;</span><br><span class="line">        ...deps,</span><br><span class="line">        react: &#123; requiredVersion: deps.react, singleton: true &#125;,</span><br><span class="line">        &apos;react-dom&apos;: &#123;</span><br><span class="line">          requiredVersion: deps[&apos;react-dom&apos;],</span><br><span class="line">          singleton: true,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;</span><br><span class="line">),</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å·²ç»å°†2ä¸ªåº”ç”¨ç¨‹åºè¿æ¥åœ¨ä¸€èµ·ã€‚ç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•åœ¨<code>Shell</code>åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨<code>Product</code>ã€‚è®©æˆ‘ä»¬åœ¨<code>shell</code>èµ„æºåº“ä¸­æ‰“å¼€App.jså¹¶åšå¦‚ä¸‹ä¿®æ”¹ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">import React from &apos;react&apos;;</span><br><span class="line">import &apos;./App.css&apos;;</span><br><span class="line"></span><br><span class="line">const ProductApp = React.lazy(</span><br><span class="line">  () =&gt; import(&apos;PRODUCT/App&apos;)</span><br><span class="line">);</span><br><span class="line">const App = () =&gt; (</span><br><span class="line">  &lt;div className=&quot;App&quot;&gt;</span><br><span class="line">    &lt;h2&gt;Hi from Shell App&lt;/h2&gt;&lt;React.Suspense fallback=&apos;Loading...&apos;&gt;</span><br><span class="line">      &lt;ProductApp /&gt;</span><br><span class="line">    &lt;/React.Suspense&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">);</span><br><span class="line">export default App;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å·²ç»å®šä¹‰äº†åä¸º â€œApp â€œçš„ç»„ä»¶ï¼Œè¯¥ç»„ä»¶é€šè¿‡Reactçš„lazyæ–¹æ³•ä»<code>Product</code>ä¸­æš´éœ²å‡ºæ¥ï¼Œåˆ°æˆ‘ä»¬åä¸º<code>ProductApp</code>çš„å˜é‡ã€‚æˆ‘ä»¬éœ€è¦å¯¹æˆ‘ä»¬å°†ä»ä¸åŒçš„å¾®å‰ç«¯è·å¾—çš„ç»„ä»¶ä½¿ç”¨lazyå‡½æ•°ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨Suspenseåœ¨æ¨¡æ¿éƒ¨åˆ†ä½¿ç”¨å®ƒï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥ç¡®ä¿æ‰€æœ‰çš„ä¸œè¥¿éƒ½åŠ è½½åˆ°é¡µé¢ä¸Šã€‚</p><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3e7e5454795240bab62482869607afff~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"><br>å¦‚æœä½ ç°åœ¨æƒ³ï¼Œä½ å¯ä»¥åœ¨Useråº”ç”¨ç¨‹åºä¸­æ·»åŠ ä¸€ä¸ªç»„ä»¶ï¼Œå¹¶å°è¯•åœ¨äº§å“åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨è¿™ä¸ªç»„ä»¶:) ä½ å¯ä»¥ä½¿ç”¨<code>expose</code>å’Œ<code>remotes</code>å…±äº«ä½ æƒ³è¦çš„ç»„ä»¶ã€‚<br>åˆ›å»ºæ¨¡å—è”é‚¦çš„Zack Jacksonæœ‰ä¸€ä¸ªGithub repoï¼Œå«åš<a href="https://github.com/module-federation/module-federation-examples" target="_blank" rel="noopener">module-federation-examples</a>ã€‚åœ¨è¿™ä¸ªRepoä¸­ï¼Œæœ‰è®¸å¤šçš„ç¤ºä¾‹ï¼Œå¦‚Reactã€Vueã€Angularã€æœåŠ¡å™¨ç«¯æ¸²æŸ“ã€å…±äº«è·¯ç”±ï¼Œå¦‚æœä½ æƒ³çš„è¯ï¼Œä½ å¯ä»¥æŸ¥çœ‹å®ƒä»¬ã€‚</p><h3 id="éœ€è¦è§£å†³çš„é—®é¢˜"><a href="#éœ€è¦è§£å†³çš„é—®é¢˜" class="headerlink" title="éœ€è¦è§£å†³çš„é—®é¢˜"></a>éœ€è¦è§£å†³çš„é—®é¢˜</h3><h4 id="è·¯ç”±"><a href="#è·¯ç”±" class="headerlink" title="è·¯ç”±"></a>è·¯ç”±</h4><p>å…¶ä¸­ä¸€ä¸ªé‡è¦çš„é—®é¢˜æ˜¯ï¼Œå¾®å‰ç«¯ç®¡ç†è‡ªå·±çš„è·¯ç”±ï¼Œä»¥ä¿æŒå®ƒä»¬ä¸Shellçš„æ¾æ•£è€¦åˆå…³ç³»ã€‚</p><p>åœ¨æˆ‘ä»¬å»ºç«‹çš„é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å€¾å‘äºåœ¨Shellçš„è·¯ç”±å®‰è£…å¾®å‰ç«¯æ¨¡å—ã€‚å½“åˆ°è¾¾/mf-aè·¯å¾„æ—¶ï¼ŒShellä¼šæ‡’åŠ è½½<code>Micro-Frontend-A</code>åº”ç”¨ç¨‹åºï¼Œå½“ç”¨æˆ·åˆ°è¾¾/mf-bè·¯å¾„æ—¶ï¼Œå®ƒä»¥åŒæ ·çš„æ–¹å¼åŠ è½½<code>Micro-Frontend-B</code>ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">// shell/src/Shell.jsimport ...const MicroFrontendA = lazy(() =&gt; import(&apos;MicroFrontendA/MicroFrontendARoutes&apos;));</span><br><span class="line">const MicroFrontendB = lazy(() =&gt; import(&apos;MicroFrontendB/MicroFrontendBRoutes&apos;));</span><br><span class="line">const Shell = () =&gt; &#123;</span><br><span class="line">  return (</span><br><span class="line">      &lt;Router&gt;</span><br><span class="line">        &lt;Menu /&gt;</span><br><span class="line">        &lt;main&gt;</span><br><span class="line">          &lt;Suspense fallback=&#123;&lt;div&gt;YÃ¼kleniyor...&lt;/div&gt;&#125;&gt;</span><br><span class="line">            &lt;Switch&gt;</span><br><span class="line">              &lt;Route exact path=&quot;/&quot;&gt;</span><br><span class="line">                &lt;Redirect to=&quot;/mf-a&quot; /&gt;</span><br><span class="line">              &lt;/Route&gt;</span><br><span class="line">              &lt;Route path=&quot;/mf-a&quot;&gt;</span><br><span class="line">                &lt;MicroFrontendA /&gt;</span><br><span class="line">              &lt;/Route&gt;</span><br><span class="line">              &lt;Route path=&quot;/mf-b&quot;&gt;</span><br><span class="line">                &lt;MicroFrontendB /&gt;</span><br><span class="line">              &lt;/Route&gt;</span><br><span class="line">            &lt;/Switch&gt;</span><br><span class="line">          &lt;/Suspense&gt;</span><br><span class="line">        &lt;/main&gt;</span><br><span class="line">      &lt;/Router&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line">export default Shell;</span><br></pre></td></tr></table></figure><p>ä¹‹åï¼Œæ§åˆ¶æƒè½¬ç§»åˆ°å¾®å‰ç«¯ã€‚å¾®å‰ç«¯-Aå¤„ç†è‡ªå·±çš„å­æ¨¡å—ï¼Œå¹¶å¯¹å…¶è¿›è¡Œè·¯ç”±è®¾ç½®ã€‚ä¸ä¸Šé¢çš„ä¾‹å­æœ‰å…³ï¼Œå½“å¯¼èˆªåˆ°/mf-açš„è·¯å¾„æ—¶ï¼ŒPageAè¢«åŠ è½½ï¼Œå½“è·¯å¾„æ˜¯/mf-a/page-bæ—¶ï¼ŒPageBè¢«åŠ è½½ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// micro-frontend-a/src/pages/MicroFrontendARoutes.jsimport React, &#123; lazy &#125; from 'react';</span></span><br><span class="line"><span class="keyword">import</span> &#123; Switch, Route, useRouteMatch &#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> withPermissions <span class="keyword">from</span> <span class="string">'Shell/hoc/withPermissions'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> PageA = lazy(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'pages/pageA/PageA'</span>));</span><br><span class="line"><span class="keyword">const</span> PageB = lazy(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'pages/pageB/PageB'</span>));</span><br><span class="line"><span class="keyword">const</span> MicroFrontendARoutes = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; path &#125; = useRouteMatch();<span class="keyword">return</span> (</span><br><span class="line">    &lt;Switch&gt;</span><br><span class="line">      &lt;Route</span><br><span class="line">        exact</span><br><span class="line">        path=&#123;path&#125;</span><br><span class="line">        render=&#123;() =&gt; withPermissions([<span class="string">'VIEW_PAGE_A'</span>])(PageA)&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">      &lt;Route</span><br><span class="line">        exact</span><br><span class="line">        path=&#123;<span class="string">`<span class="subst">$&#123;path&#125;</span>/page-b`</span>&#125;</span><br><span class="line">        render=&#123;() =&gt; withPermissions([<span class="string">'VIEW_PAGE_B'</span>])(PageB)&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">    &lt;<span class="regexp">/Switch&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp">export default MicroFrontendARoutes;</span></span><br></pre></td></tr></table></figure><h4 id="å…±äº«çŠ¶æ€ä»¥åŠhooks"><a href="#å…±äº«çŠ¶æ€ä»¥åŠhooks" class="headerlink" title="å…±äº«çŠ¶æ€ä»¥åŠhooks"></a>å…±äº«çŠ¶æ€ä»¥åŠhooks</h4><p>å®é™…ä¸Šï¼Œåœ¨æ¨¡å—è”é‚¦ä¸­å…±äº«è¿™äº›æ˜¯éå¸¸å®¹æ˜“çš„ï¼›ä½†å®ƒç›®å‰æœ‰ä¸€ä¸ªæœ‰è¶£çš„è§£å†³æ–¹æ¡ˆã€‚</p><p>å¦‚æœä½ çœ‹çœ‹æˆ‘ä¸ºShellçš„<code>webpack.config.js</code>æ‰€ä¸¾çš„ä¾‹å­ï¼Œåœ¨å…±äº«æ–¹é¢æœ‰ä¸€ä¸ªå¾®å¦™çš„æ¥è§¦ã€‚ä¸€ä¸ªæ¶ˆè€—å…¬å…±çŠ¶æ€çš„hooksä¹Ÿåœ¨åº“ä¸‹å…±äº«ã€‚ç”±äºåº”ç”¨ç¨‹åºæ€»æ˜¯åœ¨Shellä¸‹æ¸²æŸ“ï¼Œæ‰€æœ‰çš„contextéƒ½ä»¥æ­£ç¡®çš„é¡ºåºåŠ è½½ï¼Œå½“æˆ‘ä»¬åƒä¾‹å­ä¸­é‚£æ ·å…±äº« hooksæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å¾®å‰ç«¯ä¸­ä½¿ç”¨é€šç”¨contextè€Œä¸ä¼šæœ‰ä»»ä½•é”™è¯¯ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// shell/webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> &#123; <span class="attr">dependencies</span>: deps &#125; = <span class="built_in">require</span>(<span class="string">'./package.json'</span>);</span><br><span class="line"><span class="keyword">const</span> moduleFederationOptions = &#123;</span><br><span class="line">  ...exposes: &#123;</span><br><span class="line">    ...    <span class="string">'./hooks/useToastr'</span>: <span class="string">'./src/hooks/useToastr'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  shared: [</span><br><span class="line">    &#123;</span><br><span class="line">      ...</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">'./src/hooks/useToastr'</span>, <span class="comment">// Here!</span></span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="çƒ­é‡è½½"><a href="#çƒ­é‡è½½" class="headerlink" title="çƒ­é‡è½½"></a>çƒ­é‡è½½</h4><p>ä¸¾ä¾‹è¯´æ˜æˆ‘ä»¬é‡åˆ°çš„é—®é¢˜ã€‚å¦‚æœæˆ‘ä»¬é€šè¿‡Shellè®¿é—®åº”ç”¨ç¨‹åºï¼Œæˆ‘ä»¬åœ¨Micro-Frontend-Aä¸­åšçš„ä¸€ä¸ªæ”¹å˜ä¸ä¼šè§¦å‘çƒ­é‡è½½ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åœ¨å¼€å‘çš„æ—¶å€™ä¼šæ…¢ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨æ¯æ¬¡æ”¹å˜ååˆ·æ–°ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ¨¡å—è”é‚¦å›¢é˜Ÿå¼€å‘äº†<code>@module-federation/fmr</code>åŒ…ã€‚å½“å®ƒä½œä¸ºæ’ä»¶è¢«åŒ…å«åœ¨Webpacké…ç½®ä¸­æ—¶ï¼Œä½ çš„æ¨¡å—è”é‚¦ç»“æ„çš„ä»»ä½•å˜åŒ–éƒ½ä¼šè‡ªåŠ¨è¿è¡ŒLive Reloadã€‚</p><h4 id="éƒ¨ç½²"><a href="#éƒ¨ç½²" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h4><p>åœ¨ä½¿åº”ç”¨ç¨‹åºä¸Šçº¿çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬é‡åˆ°äº†ä¸¤ä¸ªä¸»è¦é—®é¢˜ã€‚</p><p>åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°è®¾ç½®<code>publicPath</code>ã€‚<br>å½“ç”¨æ¨¡å—è”é‚¦åˆ›å»ºä¸€ä¸ªå¤æ‚çš„åº”ç”¨ç¨‹åºæ—¶ï¼Œä¼šå‡ºç°è¿™ç±»é—®é¢˜ã€‚Shellå°†ä»å“ªé‡Œè·å¾—å¾®å‰ç«¯çš„å…±äº«æ–‡ä»¶ï¼Ÿå±äºShellçš„æ–‡ä»¶å°†æ¥è‡ªå¾®å‰ç«¯çš„å“ªäº›è·¯å¾„ï¼Ÿè®¸å¤šæ–‡ä»¶è·¯å¾„éœ€è¦è¢«è®¾ç½®ã€‚æˆ‘ä»¬é€šè¿‡æ­£ç¡®æŒ‡å®špublicPathé€‰é¡¹æ¥æ§åˆ¶è¿™äº›ã€‚</p><p>åœ¨Trendyol GOä¸­ï¼Œæˆ‘ä»¬å°†åº”ç”¨ç¨‹åºä½œä¸ºDockeré•œåƒåˆ›å»ºä¸€æ¬¡ï¼Œç„¶åæˆ‘ä»¬ä½¿å®ƒä»¬åœ¨ä¸åŒçš„ç¯å¢ƒä¸­é€šè¿‡ç¯å¢ƒå˜é‡æ¥å—ä¸åŒçš„è®¾ç½®ã€‚å¦‚æœpublicPathæ˜¯åœ¨æ„å»ºæ—¶è®¾ç½®çš„ï¼Œæˆ‘ä»¬å°±å¿…é¡»è§£å†³å¤§çš„é…ç½®æ–‡ä»¶é—®é¢˜ï¼Œè¿™ä¸æ˜¯ä¸€ä¸ªä¼˜åŒ–çš„è§£å†³æ–¹æ¡ˆã€‚</p><p>æˆ‘ä»¬ç¨å¾®ä¿®æ”¹äº†Zack Jacksonåœ¨è¿™ç¯‡æ–‡ç« ä¸­æåˆ°çš„æ–¹æ³•ï¼Œä½¿å…¶éå¸¸ç®€å•åœ°åœ¨è¿è¡Œæ—¶åˆ†é…åŠ¨æ€publicPathã€‚</p><p>åœ¨æˆ‘ä»¬ä½¿ç”¨çš„æ–¹æ³•ä¸­ï¼Œæœ‰ä¸€ä¸ªå«åšsetPublicPath.jsçš„æ–‡ä»¶ã€‚å…¶å†…å®¹çš„æ ¼å¼å¦‚ä¸‹ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// shell/src/setPublicPath.js</span><br><span class="line">__webpack_public_path__ = `$&#123;new URL(document.currentScript.src).origin&#125;/`;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬é€šè¿‡åœ¨æ„å»ºæ—¶æ“ä½œWebpackè®¾ç½®ä¸­çš„entry</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// shell/webpack.config.js</span></span><br><span class="line">entry: &#123;</span><br><span class="line">  Shell: <span class="string">'./src/setPublicPath'</span>,</span><br><span class="line">  main: <span class="string">'./src/index'</span>,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>åœ¨è¿è¡Œæ—¶ï¼ŒåŠ¨æ€è®¾ç½®æ¨¡å—è”é‚¦è®¾ç½®ä¸­åˆ†é…çš„è¿œç¨‹URLã€‚æˆ‘ä»¬ç”¨<code>External Remotes Plugin</code>æ¥å®ç°</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// shell/webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> moduleFederationOptions = &#123;</span><br><span class="line">  ...remotes: &#123;</span><br><span class="line">    MicroFrontendA: <span class="string">'MicroFrontendA@[window.MF_A_URL]/remoteEntry.js'</span>,</span><br><span class="line">    MicroFrontendB: <span class="string">'MicroFrontendB@[window.MF_B_URL]/remoteEntry.js'</span>,</span><br><span class="line">  &#125;,  ...</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å¦‚ä½•åœ¨è¿è¡Œæ—¶è®¾ç½®window.MF_A_URL and window.MF_B_URL</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// shell/src/index.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> config <span class="keyword">from</span> <span class="string">'config'</span>; <span class="comment">// dynamic vars. from an .env file e.g.</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">window</span>.MF_A_URL = config.MF_A_URL;</span><br><span class="line"><span class="built_in">window</span>.MF_B_URL = config.MF_B_URL;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span>(<span class="string">'./bootstrap'</span>);</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªè¿‡ç¨‹çš„æœ€åï¼Œæˆ‘ä»¬å®ç°äº†ä¸€ä¸ªç¨³å®šçš„åº”ç”¨ç¨‹åºã€‚è™½ç„¶åœ¨æˆ‘ä»¬é¢å‰è¿˜æœ‰è®¸å¤šä¸åŒçš„æ”¹è¿›ï¼Œä½†ä»ç°åœ¨å¼€å§‹ï¼Œæ¯ä¸ªå›¢é˜Ÿå¯ä»¥å¼€å‘è‡ªå·±çš„æ¨¡å—ï¼Œè€Œä¸å¿…ä¾èµ–å…¶ä»–å›¢é˜Ÿã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> webpack </tag>
            
            <tag> æ¨¡å—è”é‚¦ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vue-routeræµ…æåŸç†</title>
      <link href="/ashley271017.github.io/2023/04/16/vue-router%E6%B5%85%E6%9E%90%E5%8E%9F%E7%90%86/"/>
      <url>/ashley271017.github.io/2023/04/16/vue-router%E6%B5%85%E6%9E%90%E5%8E%9F%E7%90%86/</url>
      
        <content type="html"><![CDATA[<p>è¿‘æœŸè¢«é—®åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œåœ¨ä½ ä»¬é¡¹ç›®ä¸­ä½¿ç”¨çš„æ˜¯Vueçš„SPAï¼ˆå•é¡µé¢ï¼‰è¿˜æ˜¯Vueçš„å¤šé¡µé¢è®¾è®¡ï¼Ÿ</p><p>è¿™ç¯‡æ–‡ç« ä¸»è¦å›´ç»•Vueçš„SPAå•é¡µé¢è®¾è®¡å±•å¼€ã€‚</p><h2 id="vue-routerå®ç°åŸç†"><a href="#vue-routerå®ç°åŸç†" class="headerlink" title="vue-routerå®ç°åŸç†"></a>vue-routerå®ç°åŸç†</h2><p>SPA(single page application):å•ä¸€é¡µé¢åº”ç”¨ç¨‹åºï¼Œæœ‰ä¸”åªæœ‰ä¸€ä¸ªå®Œæ•´çš„é¡µé¢ï¼›å½“å®ƒåœ¨åŠ è½½é¡µé¢çš„æ—¶å€™ï¼Œä¸ä¼šåŠ è½½æ•´ä¸ªé¡µé¢çš„å†…å®¹ï¼Œè€Œåªæ›´æ–°æŸä¸ªæŒ‡å®šçš„å®¹å™¨ä¸­å†…å®¹ã€‚<br>å•é¡µé¢åº”ç”¨(SPA)çš„æ ¸å¿ƒä¹‹ä¸€æ˜¯:</p><p>1.æ›´æ–°è§†å›¾è€Œä¸é‡æ–°è¯·æ±‚é¡µé¢;</p><p>2.vue-routeråœ¨å®ç°å•é¡µé¢å‰ç«¯è·¯ç”±æ—¶ï¼Œæä¾›äº†ä¸‰ç§æ–¹å¼ï¼šHashæ¨¡å¼ã€Historyæ¨¡å¼ã€abstractæ¨¡å¼ï¼Œæ ¹æ®modeå‚æ•°æ¥å†³å®šé‡‡ç”¨å“ªä¸€ç§æ–¹å¼ã€‚</p><h2 id="è·¯ç”±æ¨¡å¼"><a href="#è·¯ç”±æ¨¡å¼" class="headerlink" title="è·¯ç”±æ¨¡å¼"></a>è·¯ç”±æ¨¡å¼</h2><p>vue-router æä¾›äº†ä¸‰ç§è¿è¡Œæ¨¡å¼ï¼š</p><ul><li>hash: ä½¿ç”¨ URL hash å€¼æ¥ä½œè·¯ç”±ã€‚é»˜è®¤æ¨¡å¼ã€‚</li><li>history: ä¾èµ– HTML5 History API å’ŒæœåŠ¡å™¨é…ç½®ã€‚æŸ¥çœ‹ HTML5 History æ¨¡å¼ã€‚</li><li>abstract: æ”¯æŒæ‰€æœ‰ JavaScript è¿è¡Œç¯å¢ƒï¼Œå¦‚ Node.js æœåŠ¡å™¨ç«¯ã€‚</li></ul><h3 id="hash"><a href="#hash" class="headerlink" title="hash"></a>hash</h3><p>hashè™½ç„¶å‡ºç°åœ¨urlä¸­ï¼Œä½†ä¸ä¼šè¢«åŒ…æ‹¬åœ¨httpè¯·æ±‚ä¸­ï¼Œå®ƒæ˜¯ç”¨æ¥æŒ‡å¯¼æµè§ˆå™¨åŠ¨ä½œçš„ï¼Œå¯¹æœåŠ¡å™¨ç«¯æ²¡å½±å“ï¼Œå› æ­¤ï¼Œæ”¹å˜hashä¸ä¼šé‡æ–°åŠ è½½é¡µé¢ã€‚</p><p>å¯ä»¥ä¸ºhashçš„æ”¹å˜æ·»åŠ ç›‘å¬äº‹ä»¶ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">"hashchange"</span>,funcRef,<span class="literal">false</span>)</span><br></pre></td></tr></table></figure><p>push()æ–¹æ³•æœ€ä¸»è¦çš„æ˜¯å¯¹windowçš„hashè¿›è¡Œäº†ç›´æ¥èµ‹å€¼ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pushHash</span> (<span class="params">path</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">window</span>.location.hash = path</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>hashçš„æ”¹å˜ä¼šè‡ªåŠ¨æ·»åŠ åˆ°æµè§ˆå™¨çš„è®¿é—®å†å²è®°å½•ä¸­ã€‚ é‚£ä¹ˆè§†å›¾çš„æ›´æ–°æ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Œçœ‹ä¸‹ transitionTo()æ–¹æ³•ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">History.prototype.transitionTo = <span class="function"><span class="keyword">function</span> <span class="title">transitionTo</span> (<span class="params">location, onComplete, onAbort</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="keyword">this</span>$<span class="number">1</span> = <span class="keyword">this</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> route = <span class="keyword">this</span>.router.match(location, <span class="keyword">this</span>.current);</span><br><span class="line">    <span class="keyword">this</span>.confirmTransition(route, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>$<span class="number">1.</span>updateRoute(route);</span><br><span class="line">        ...</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">History.prototype.updateRoute = <span class="function"><span class="keyword">function</span> <span class="title">updateRoute</span> (<span class="params">route</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> prev = <span class="keyword">this</span>.current;</span><br><span class="line">    <span class="keyword">this</span>.current = route;</span><br><span class="line">    <span class="keyword">this</span>.cb &amp;&amp; <span class="keyword">this</span>.cb(route);</span><br><span class="line">    <span class="keyword">this</span>.router.afterHooks.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">hook</span>) </span>&#123;</span><br><span class="line">        hook &amp;&amp; hook(route, prev);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">History.prototype.listen = <span class="function"><span class="keyword">function</span> <span class="title">listen</span> (<span class="params">cb</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.cb = cb;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œå½“_routeå€¼æ”¹å˜æ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨Vueå®ä¾‹çš„render()æ–¹æ³•ï¼Œæ›´æ–°è§†å›¾ã€‚</p><h4 id="HashHistory-replace"><a href="#HashHistory-replace" class="headerlink" title="HashHistory.replace()"></a>HashHistory.replace()</h4><p>replace()æ–¹æ³•ä¸push()æ–¹æ³•ä¸åŒä¹‹å¤„åœ¨äºï¼Œå®ƒå¹¶ä¸æ˜¯å°†æ–°è·¯ç”±æ·»åŠ åˆ°æµè§ˆå™¨è®¿é—®å†å²æ ˆé¡¶ï¼Œè€Œæ˜¯æ›¿æ¢æ‰å½“å‰çš„è·¯ç”±ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">HashHistory.prototype.replace = <span class="function"><span class="keyword">function</span> <span class="title">replace</span> (<span class="params">location, onComplete, onAbort</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="keyword">this</span>$<span class="number">1</span> = <span class="keyword">this</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> ref = <span class="keyword">this</span>;</span><br><span class="line">    <span class="keyword">var</span> fromRoute = ref.current;</span><br><span class="line">    <span class="keyword">this</span>.transitionTo(location, <span class="function"><span class="keyword">function</span> (<span class="params">route</span>) </span>&#123;</span><br><span class="line">      replaceHash(route.fullPath);</span><br><span class="line">      handleScroll(<span class="keyword">this</span>$<span class="number">1.</span>router, route, fromRoute, <span class="literal">false</span>);</span><br><span class="line">      onComplete &amp;&amp; onComplete(route);</span><br><span class="line">    &#125;, onAbort);</span><br><span class="line">&#125;;</span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">replaceHash</span> (<span class="params">path</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> i = <span class="built_in">window</span>.location.href.indexOf(<span class="string">'#'</span>)</span><br><span class="line">    <span class="comment">// ç›´æ¥è°ƒç”¨ replace å¼ºåˆ¶æ›¿æ¢ ä»¥é¿å…äº§ç”Ÿâ€œå¤šä½™â€çš„å†å²è®°å½•</span></span><br><span class="line">    <span class="comment">// ä¸»è¦æ˜¯ç”¨æˆ·åˆæ¬¡è·³å…¥ ä¸”hashå€¼ä¸æ˜¯ä»¥ / å¼€å¤´çš„æ—¶å€™ç›´æ¥æ›¿æ¢</span></span><br><span class="line">    <span class="comment">// å…¶ä½™æ—¶å€™å’Œpushæ²¡å•¥åŒºåˆ« æµè§ˆå™¨æ€»æ˜¯è®°å½•hashè®°å½•</span></span><br><span class="line">    <span class="built_in">window</span>.location.replace(</span><br><span class="line">        <span class="built_in">window</span>.location.href.slice(<span class="number">0</span>, i &gt;= <span class="number">0</span> ? i : <span class="number">0</span>) + <span class="string">'#'</span> + path</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡ºï¼Œå®ƒä¸push()çš„å®ç°ç»“æ„åŸºæœ¬ç›¸ä¼¼ï¼Œä¸åŒç‚¹å®ƒä¸æ˜¯ç›´æ¥å¯¹window.location.hashè¿›è¡Œèµ‹å€¼ï¼Œè€Œæ˜¯è°ƒç”¨<code>window.location.replace</code>æ–¹æ³•å°†è·¯ç”±è¿›è¡Œæ›¿æ¢ã€‚</p><h3 id="history"><a href="#history" class="headerlink" title="history"></a>history</h3><p>History interfaceæ˜¯æµè§ˆå™¨å†å²è®°å½•æ ˆæä¾›çš„æ¥å£ï¼Œåœ¨è¿‡å»æ—¶æœŸï¼Œé€šè¿‡back()ï¼Œforward()ï¼Œgo()ï¼Œæ‰“å¼€æœ¬æ ‡ç­¾æ–°åœ°å€ç­‰æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥æ”¹å˜æµè§ˆå™¨å†å²è®°å½•æ ˆçš„ä¿¡æ¯ï¼Œè¿›è¡Œå„ç§åœ°å€è·³è½¬æ“ä½œï¼ˆå…¶å®å°±æ˜¯æ§åˆ¶æµè§ˆå™¨çš„å‰è¿›åé€€é”®ï¼‰ï¼Œæµè§ˆå™¨å°±ä¼šæŒ‰ç…§åœ°å€å‘æœåŠ¡ç«¯å‘é€èµ„æºè¯·æ±‚ï¼ŒæœåŠ¡å™¨ä¼šè¿”å›å¯¹åº”çš„é¡µé¢htmlæ–‡ä»¶ï¼Œæµè§ˆå™¨æ‹¿åˆ°åå†è¿›è¡Œæ¸²æŸ“ã€‚</p><p>å¦‚ä½•å®ç°çš„æ— åˆ·æ–°è·³è½¬ï¼špushState<br>çŠ¹å¤§åœ¨ä½¿ç”¨pushStateå°†urlæ”¹å˜ä¹‹å‰ï¼Œ<strong>å…ˆåšäº†é¡µé¢ç»„ä»¶çš„åˆ·æ–°ï¼Œä¹Ÿå°±æ¨¡æ‹Ÿå‡ºäº†é¡µé¢è·³è½¬çš„æ ·å­</strong>ã€‚<br><img src="https://upload-images.jianshu.io/upload_images/14243841-a7a6abf7e78becf3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1148/format/webp" alt="image"></p><p>é‚£ä¹ˆï¼Œå¦‚æœæˆ‘åˆ·æ–°é¦–é¡µï¼Œåˆæˆ–è€…å‰è¿›åé€€ï¼Œæ€ä¹ˆå†æ›´æ–°é¡µé¢ç»„å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯ä½¿ç”¨popstateæ¥åšäº‹ä»¶ç›‘å¬ï¼Œå½“ç”¨æˆ·é¦–æ¬¡è®¿é—®ï¼Œè¿›æˆ–åé€€çš„æ—¶å€™ï¼Œéƒ½ä¼šè§¦å‘popstateäº‹ä»¶ï¼Œå†ç”±popstateæ¥å½“å‰é¡µï¼Œä¸Šä¸€é¡µç­‰é¡µé¢çš„è®°å½•å’Œç»˜åˆ¶ã€‚</p><p><img src="https://upload-images.jianshu.io/upload_images/14243841-b0d885ef36805e3f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1088/format/webp" alt="image"></p><h4 id="historyæ¨¡å¼çš„404é—®é¢˜"><a href="#historyæ¨¡å¼çš„404é—®é¢˜" class="headerlink" title="historyæ¨¡å¼çš„404é—®é¢˜"></a>historyæ¨¡å¼çš„404é—®é¢˜</h4><p>ä½¿ç”¨historyæ¨¡å¼æ—¶ï¼Œç”¨æˆ·ç‚¹å‡»é¡µé¢é“¾æ¥ç¡®å®èƒ½â€œè·³è½¬â€åˆ°ä¸åŒé¡µé¢ï¼Œä¹Ÿä¼šå‘ç°æµè§ˆå™¨åœ°å€æ è·¯å¾„å‘ç”Ÿäº†è§†è§‰ä¸Šçš„å˜åŒ–ã€‚ä½†åœ¨å­é¡µé¢åˆ·æ–°æ—¶å¦‚æœåç«¯æœªåšé…ç½®ä¼šå‡ºç°é—®é¢˜ã€‚</p><p>æ¯”å¦‚ åˆå§‹urlæ˜¯ <a href="http://localhost:8080" target="_blank" rel="noopener">http://localhost:8080</a> ï¼Œå½“ç”¨æˆ·ç‚¹å‡»é“¾æ¥æ—¶ï¼Œurlå˜æˆ <a href="http://localhost:8080/a" target="_blank" rel="noopener">http://localhost:8080/a</a> ã€‚ ç”¨æˆ·ç¡®å®èƒ½çœ‹åˆ°/a è·¯å¾„ç›¸å¯¹åº”çš„é¡µé¢(åŒºåŸŸ/ç»„ä»¶)ï¼Œä½†å½“åœ¨è¯¥é“¾æ¥ä¸‹åˆ·æ–°æ—¶ï¼Œå‘æœåŠ¡ç«¯å‘é€è¯·æ±‚çš„çš„è·¯å¾„æ˜¯ <a href="http://localhost:8080/a" target="_blank" rel="noopener">http://localhost:8080/a</a> ï¼Œè€ŒæœåŠ¡ç«¯å¹¶æœªåš/açš„é…ç½®ï¼Œä¼šå¯¼è‡´è¯·æ±‚å¤±è´¥ã€‚æ‰€ä»¥ä½¿ç”¨historyæ¨¡å¼éœ€è¦æœåŠ¡ç«¯åšå“åº”çš„é…ç½®ã€‚è€Œ<a href="http://oursite.com/#/user/id" target="_blank" rel="noopener">http://oursite.com/#/user/id</a> //å¦‚è¯·æ±‚ï¼Œåªä¼šå‘é€<a href="http://oursite.com/" target="_blank" rel="noopener">http://oursite.com/</a><br>æ‰€ä»¥hashæ¨¡å¼ä¸‹é‡åˆ°æ ¹æ®urlè¯·æ±‚é¡µé¢ä¸ä¼šæœ‰é—®é¢˜</p>]]></content>
      
      
      
        <tags>
            
            <tag> vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ’¸ä¸€ä¸ªç»„ä»¶åº“</title>
      <link href="/ashley271017.github.io/2023/04/16/%E6%92%B8%E4%B8%80%E4%B8%AA%E7%BB%84%E4%BB%B6%E5%BA%93/"/>
      <url>/ashley271017.github.io/2023/04/16/%E6%92%B8%E4%B8%80%E4%B8%AA%E7%BB%84%E4%BB%B6%E5%BA%93/</url>
      
        <content type="html"><![CDATA[<p><a href="https://blog.csdn.net/mjzhang1993/article/details/86712439" target="_blank" rel="noopener">ç»„ä»¶åº“çš„å¼€å‘</a></p><h2 id="ç»„ä»¶åº“çš„è¦æ±‚ï¼š"><a href="#ç»„ä»¶åº“çš„è¦æ±‚ï¼š" class="headerlink" title="ç»„ä»¶åº“çš„è¦æ±‚ï¼š"></a>ç»„ä»¶åº“çš„è¦æ±‚ï¼š</h2><h3 id="tree-shakingï¼ˆtree-shakingï¼‰"><a href="#tree-shakingï¼ˆtree-shakingï¼‰" class="headerlink" title="tree shakingï¼ˆtree shakingï¼‰"></a>tree shakingï¼ˆtree shakingï¼‰</h3><h4 id="æ€ä¹ˆå®ç°ï¼Ÿ"><a href="#æ€ä¹ˆå®ç°ï¼Ÿ" class="headerlink" title="æ€ä¹ˆå®ç°ï¼Ÿ"></a>æ€ä¹ˆå®ç°ï¼Ÿ</h4><p>é’ˆå¯¹æ”¯æŒESMæ¨¡å—çš„å‰ç«¯é¡¹ç›®ï¼šç”ŸæˆESMæ ¼å¼ å³å¯é…åˆ<code>webpack5 tree shaking</code><br>é’ˆå¯¹ä¸æ”¯æŒESMçš„ï¼šä½¿ç”¨ï¼š<code>babel-plugin-import</code> ï¼Œå®ƒä¸ä»…èƒ½è®©ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åŸå§‹ä»£ç </span></span><br><span class="line"><span class="keyword">import</span> &#123; Button &#125; <span class="keyword">from</span> <span class="string">'vant'</span>;</span><br><span class="line">â€‹</span><br><span class="line"><span class="comment">// ç¼–è¯‘åä»£ç </span></span><br><span class="line"><span class="keyword">import</span> Button <span class="keyword">from</span> <span class="string">'vant/es/button'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'vant/es/button/style'</span>;</span><br></pre></td></tr></table></figure><p>ä¸ä½¿ç”¨ ESM çš„åº“ä¹Ÿèƒ½åšåˆ°ä¸Šé¢è¿™æ ·çš„è½¬æ¢</p><h3 id="ç”ŸæˆUMDæ ¼å¼"><a href="#ç”ŸæˆUMDæ ¼å¼" class="headerlink" title="ç”ŸæˆUMDæ ¼å¼"></a>ç”ŸæˆUMDæ ¼å¼</h3><p>ä»¥æ›´å¥½çš„æ”¯æŒå‰ç«¯é¡¹ç›®åš externalï¼Œå‡å°‘æ„å»ºæ—¶é•¿ï¼Œç”ŸæˆESMæ ¼å¼ï¼ˆJS æ ‡å‡†ï¼Œ Tree Shaking å‹å¥½ï¼Œä¼˜å…ˆè€ƒè™‘ä½¿ç”¨è¯¥æ¨¡å—ï¼‰ä»¥åŠCJSï¼ˆæ¨¡å—åŒæ—¶è·‘åœ¨å‰åç«¯é¡¹ç›®ï¼Œéœ€è¦å…¼å®¹ï¼‰</p><h4 id="äº§ç‰©è¦æ±‚å“ªå‡ ç§æ ¼å¼ï¼Ÿ"><a href="#äº§ç‰©è¦æ±‚å“ªå‡ ç§æ ¼å¼ï¼Ÿ" class="headerlink" title="äº§ç‰©è¦æ±‚å“ªå‡ ç§æ ¼å¼ï¼Ÿ"></a>äº§ç‰©è¦æ±‚å“ªå‡ ç§æ ¼å¼ï¼Ÿ</h4><ul><li>ESM:  JS æ ‡å‡†æ¨¡å—æ ¼å¼ï¼Œ å¯¹Tree Shaking å‹å¥½ï¼Œä¼˜å…ˆè€ƒè™‘ä½¿ç”¨è¯¥æ¨¡å—</li><li>CJSï¼šå¦‚æœæ¨¡å—åŒæ—¶è·‘åœ¨å‰åç«¯é¡¹ç›®ï¼Œéœ€è¦å…¼å®¹</li><li>UMDï¼šç”¨ä»¥æ”¯æŒæ”¯æŒå¤šç§å¼•å…¥æ–¹å¼ï¼Œè‡ªåŠ¨åˆ¤æ–­ç°åœ¨çš„ç¯å¢ƒæ¥å†³å®šä»£ç çš„å¯¼å‡ºæ–¹å¼ã€‚æ¯”å¦‚ç”¨ script æ ‡ç­¾å¼•å…¥çš„è¯ï¼Œä»£ç ä¼šè¢«æŒ‚è½½åˆ° window å¯¹è±¡ï¼Œ require æ–¹å¼çš„è¯ä¼šä»¥ module.<code>exports</code> çš„æ–¹å¼å¯¼å‡ºç­‰,å¹¶ä¸”è¿˜èƒ½æ”¯æŒ<code>externals</code>ã€‚<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpackæ‰“åŒ…ç”Ÿæˆ umd</span></span><br><span class="line">output: &#123;</span><br><span class="line">  path: config.build.assetsRoot,</span><br><span class="line">  filename: utils.assetsPath(<span class="string">'js/[name].min.js'</span>),</span><br><span class="line">  library: <span class="string">'skel'</span>,</span><br><span class="line">  libraryTarget: <span class="string">'umd</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="æŒ‰éœ€åŠ è½½"><a href="#æŒ‰éœ€åŠ è½½" class="headerlink" title="æŒ‰éœ€åŠ è½½"></a>æŒ‰éœ€åŠ è½½</h3><p>æ¯ä¸ªç»„ä»¶åœ¨æ‰“åŒ…äº§ç‰©ä¸­æœ‰ä¸€ä¸ªå¯¹åº”çš„æ–‡ä»¶å¤¹</p><ul><li><p>webpacké…ç½® æŒ‡å®šå¤šä¸ªå…¥å£å³å¯</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">entry: &#123;</span><br><span class="line">        popup: <span class="string">'./src/popup'</span>,</span><br><span class="line">        background: <span class="string">'./src/background'</span>,</span><br><span class="line">        contentScripts: <span class="string">'./src/content-scripts'</span>,</span><br><span class="line">        demo: <span class="string">'./src/view/demo'</span></span><br><span class="line">        ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>vite åŠ å‡ ä¸ªé…ç½®é¡¹è®©æ‰“åŒ…ç›®å½•å’Œæˆ‘ä»¬ç›®å½•å¯¹åº”å³å¯</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">output: [</span><br><span class="line">  &#123;</span><br><span class="line">    format: <span class="string">'es'</span>,</span><br><span class="line">    <span class="comment">// file:'./dist/index.esm.js',</span></span><br><span class="line">    entryFileNames: <span class="string">'[name].js'</span>,</span><br><span class="line">    <span class="comment">//è®©æ‰“åŒ…ç›®å½•å’Œæˆ‘ä»¬ç›®å½•å¯¹åº”</span></span><br><span class="line">    preserveModules: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">// æ‰“åŒ…æ ¹ç›®å½•</span></span><br><span class="line">    dir: <span class="string">'es'</span>,</span><br><span class="line">    <span class="comment">// Put preserved modules under this path at root level</span></span><br><span class="line">    preserveModulesRoot: <span class="string">`packages/360kuai_ui/src/components`</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    format: <span class="string">'cjs'</span>,</span><br><span class="line">    entryFileNames: <span class="string">'[name].js'</span>,</span><br><span class="line">    <span class="comment">//è®©æ‰“åŒ…ç›®å½•å’Œæˆ‘ä»¬ç›®å½•å¯¹åº”</span></span><br><span class="line">    preserveModules: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">// æ‰“åŒ…æ ¹ç›®å½•</span></span><br><span class="line">    dir: <span class="string">'lib'</span>,</span><br><span class="line">    <span class="comment">// Put preserved modules under this path at root level</span></span><br><span class="line">    preserveModulesRoot: <span class="string">`packages/360kuai_ui/src/components`</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure></li></ul><h3 id="package-json-æŒ‡å®šæ¨¡å—çš„å…¥å£æ–‡ä»¶"><a href="#package-json-æŒ‡å®šæ¨¡å—çš„å…¥å£æ–‡ä»¶" class="headerlink" title="package.json æŒ‡å®šæ¨¡å—çš„å…¥å£æ–‡ä»¶"></a>package.json æŒ‡å®šæ¨¡å—çš„å…¥å£æ–‡ä»¶</h3><p>package.jsonæ–‡ä»¶æœ‰ä¸¤ä¸ªå­—æ®µå¯ä»¥æŒ‡å®šæ¨¡å—çš„å…¥å£æ–‡ä»¶ï¼š<code>main</code>å’Œ<code>exports</code></p><h4 id="main"><a href="#main" class="headerlink" title="main"></a>main</h4><p>å½“æˆ‘ä»¬ä»æ¨¡å—ä¸­importä¸€ä¸ªXXXçš„æ—¶å€™ï¼ŒNode.js å°±ä¼šåˆ°./<code>node_modules</code>ç›®å½•ä¸‹é¢ï¼Œæ‰¾åˆ°æ¨¡å—ï¼Œç„¶åæ ¹æ®è¯¥æ¨¡å—package.jsonçš„mainå­—æ®µå»æ‰§è¡Œå…¥å£æ–‡ä»¶ã€‚</p><h4 id="exports"><a href="#exports" class="headerlink" title="exports"></a>exports</h4><p>exportså­—æ®µçš„ä¼˜å…ˆçº§é«˜äºmainå­—æ®µã€‚å®ƒæœ‰å¤šç§ç”¨æ³•ã€‚</p><ul><li><p>è¦†ç›–mainå­—æ®µå£°æ˜ä¸»å…¥å£<br>æœ‰ä¸¤ç§å†™æ³•ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"exports"</span>: &#123;</span><br><span class="line">    <span class="string">"."</span>: <span class="string">"./main.js"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç­‰åŒäº</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"exports"</span>: <span class="string">"./main.js"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>ä¸ºä¸åŒçš„æ¨¡å—æ ¼å¼æŒ‡å®šä¸ä¸€æ ·çš„å…¥å£<br>//  requireæ¡ä»¶æŒ‡å®šrequire()å‘½ä»¤çš„å…¥å£æ–‡ä»¶ï¼ˆå³ CommonJS çš„å…¥å£ï¼‰ï¼Œ<br>// defaultæ¡ä»¶æŒ‡å®šå…¶ä»–æƒ…å†µçš„å…¥å£ï¼ˆå³ ES6 çš„å…¥å£ï¼‰ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"exports"</span>: &#123;</span><br><span class="line">    <span class="string">"require"</span>: <span class="string">"./main.cjs"</span>,</span><br><span class="line">    <span class="string">"default"</span>: <span class="string">"./main.js"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>æŒ‡å®šè„šæœ¬æˆ–å­ç›®å½•çš„åˆ«åã€‚<br>æŒ‡å®š/es/react/index.jsçš„åˆ«åä¸º/react</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">"exports": &#123;</span><br><span class="line">   "./react": &#123;</span><br><span class="line">     "import": "./es/react/index.js",</span><br><span class="line">     "require": "./lib/react/index.cjs",</span><br><span class="line">     "default": "./dist/react/index.js"</span><br><span class="line">   &#125;,</span><br><span class="line">   "./vue": &#123;</span><br><span class="line">     "import": "./es/vue/index.js",</span><br><span class="line">     "require": "./lib/vue/index.cjs",</span><br><span class="line">     "default": "./dist/vue/index.js"</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;,</span><br></pre></td></tr></table></figure></li></ul><h3 id="ä¾èµ–å¤„ç†ï¼š"><a href="#ä¾èµ–å¤„ç†ï¼š" class="headerlink" title="ä¾èµ–å¤„ç†ï¼š"></a>ä¾èµ–å¤„ç†ï¼š</h3><p>å¯èƒ½éœ€è¦å£°æ˜ç»„ä»¶åº“çš„å®¿ä¸»ä¾èµ–ï¼ˆ<code>peerDependencies</code> è¡¨ç¤ºåŒç‰ˆæœ¬ä¾èµ–ï¼‰ï¼š<code>peerDependencies</code>ï¼šå®¿ä¸»ä¾èµ–ï¼ŒæŒ‡å®šäº†å½“å‰æ¨¡å—åŒ…åœ¨ä½¿ç”¨å‰éœ€è¦å®‰è£…çš„ä¾èµ–ï¼Œæ¯”å¦‚è¯´æˆ‘ä»¬ç›®å‰æ­£åœ¨å­¦ä¹ çš„ Element Plus ç»„ä»¶åº“ï¼Œå®ƒéœ€è¦å®¿ä¸»ç¯å¢ƒæä¾›æŒ‡å®šçš„ Vue ç‰ˆæœ¬æ¥æ­é…ä½¿ç”¨ï¼Œå¦‚æœåœ¨ä¸€ä¸ª npm åŒ…çš„ dependencies ä¸­å®šä¹‰ä¾èµ–ï¼Œæ‰§è¡Œ <code>npm install</code> æ—¶å½“å­ä¾èµ–çš„ä¾èµ–ç‰ˆæœ¬åœ¨å·²ç»æ„å»ºçš„ä¾èµ–æ ‘ä¸­åŒ¹é…ä¸åˆ°æ—¶ï¼Œå°±ä¼šé‡å¤ä¸‹è½½ã€‚è€Œ peerDependencies åˆ™å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåœ¨ peerDependencies ä¸­å®šä¹‰çš„ä¾èµ–ï¼Œä¸ä¼šé‡å¤ä¸‹è½½ï¼Œä½†ä¼šè¦æ±‚å®¿ä¸»ç¯å¢ƒæä¾› peer ä¾èµ–ä¸€è‡´çš„ç‰ˆæœ¬ï¼Œå¦åˆ™åœ¨å®‰è£…çš„æ—¶å€™æç¤ºè­¦æŠ¥äº¦æˆ–æŠ¥é”™ä¸­æ–­å‘½ä»¤çš„æ‰§è¡Œã€‚</p><h4 id="å®æ—¶é¢„è§ˆæ–‡æ¡£"><a href="#å®æ—¶é¢„è§ˆæ–‡æ¡£" class="headerlink" title="å®æ—¶é¢„è§ˆæ–‡æ¡£"></a>å®æ—¶é¢„è§ˆæ–‡æ¡£</h4><h3 id="ä»£ç æ ¼å¼åŒ–å’Œè§„èŒƒæ£€æµ‹"><a href="#ä»£ç æ ¼å¼åŒ–å’Œè§„èŒƒæ£€æµ‹" class="headerlink" title="ä»£ç æ ¼å¼åŒ–å’Œè§„èŒƒæ£€æµ‹"></a>ä»£ç æ ¼å¼åŒ–å’Œè§„èŒƒæ£€æµ‹</h3><ul><li>å•æµ‹</li><li>æ”¯æŒtypescript</li><li>æ ·å¼éš”ç¦»<br>å› ä¸ºç»„ä»¶åº“çš„æ ·å¼éœ€è¦èƒ½è¢«ç”¨æˆ·è‡ªå®šä¹‰çš„æ ·å¼è¦†ç›–ï¼Œæ‰€ä»¥ä¸èƒ½é€‰ç”¨<code>css In modules</code>ï¼ˆæ‰“åŒ…æ—¶ä¼šè‡ªåŠ¨å°† id å’Œ class æ··æ·†æˆå…¨å±€å”¯ä¸€çš„ hash å€¼ï¼‰ç­‰åšæ³•ï¼Œè¿™é‡Œå‚è€ƒçš„antdç›´æ¥ç»™æ¯ä¸ªå…ƒç´ åŠ ä¸Šä¸€ä¸ªå…¨å±€çš„ç±»åï¼Œè¿™é‡Œå¯ä»¥ç”¨<code>postcss</code>æ’ä»¶ï¼š<code>autoprefixer</code></li><li>ç‰ˆæœ¬å·ç®¡ç†<br>ä½¿ç”¨changesetè‡ªåŠ¨æ›´æ–°åŒ…çš„versionå’Œç”Ÿæˆchangelogã€‚</li></ul><h3 id="é‡åˆ°çš„é—®é¢˜"><a href="#é‡åˆ°çš„é—®é¢˜" class="headerlink" title="é‡åˆ°çš„é—®é¢˜"></a>é‡åˆ°çš„é—®é¢˜</h3><ul><li>å°†æ ·å¼æ–‡ä»¶å•ç‹¬æ‹†åˆ†åˆ°æ¯ä¸ªç»„ä»¶<br>å¦‚æœä¸åšå¤„ç†ï¼Œæœ€åç”Ÿæˆäº†ä¸€ä¸ªå•ä¸ªçš„style.cssæ–‡ä»¶ï¼Œæˆ‘ä»¬æƒ³è¦å°†æ ·å¼æ–‡ä»¶å•ç‹¬æ‹†åˆ†åˆ°æ¯ä¸ªç»„ä»¶ä¸‹æ€ä¹ˆåŠ</li><li>externalæ‰scssï¼Œé¿å…viteå»å¤„ç†æˆ‘ä»¬çš„cssæ–‡ä»¶</li><li>å†™ä¸€ä¸ªè„šæœ¬å°†scssæ–‡ä»¶å¤åˆ¶åˆ°æ‰“åŒ…åç›®å½•</li><li>å°†æ‰€æœ‰çš„sassæ–‡ä»¶ä½¿ç”¨sass.compileæ‰‹åŠ¨ç¼–è¯‘ä¸€ä¸‹ï¼Œç„¶åå°†sassæ–‡ä»¶ä¸­å¼•å…¥çš„sassæ–‡ä»¶éƒ½æ”¹æˆcssåç¼€</li><li>æœ€åè‡ªå®šä¹‰ä¸€ä¸ªviteæ’ä»¶ï¼ŒgenerateBundleæ‹¿åˆ°æ‰“åŒ…ä¹‹åçš„ä»£ç å°†JSæ–‡ä»¶ä¸­çš„<code>import xx.scss</code>æ›¿æ¢æˆ<code>import xx.css</code></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> vite </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆæˆäº‹ä»¶</title>
      <link href="/ashley271017.github.io/2023/04/15/%E5%90%88%E6%88%90%E4%BA%8B%E4%BB%B6/"/>
      <url>/ashley271017.github.io/2023/04/15/%E5%90%88%E6%88%90%E4%BA%8B%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<p>å¤§å®¶éƒ½çŸ¥é“ React æœ‰ä¸€å¥—è‡ªå·±çš„äº‹ä»¶æœºåˆ¶ï¼Œå¦‚å®˜æ–¹æ–‡æ¡£æ‰€è¿°ï¼š</p><blockquote><p>SyntheticEvent å®ä¾‹å°†è¢«ä¼ é€’ç»™ä½ çš„äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œå®ƒæ˜¯æµè§ˆå™¨çš„åŸç”Ÿäº‹ä»¶çš„è·¨æµè§ˆå™¨åŒ…è£…å™¨ã€‚é™¤å…¼å®¹æ‰€æœ‰æµè§ˆå™¨å¤–ï¼Œå®ƒè¿˜æ‹¥æœ‰å’Œæµè§ˆå™¨åŸç”Ÿäº‹ä»¶ç›¸åŒçš„æ¥å£ï¼ŒåŒ…æ‹¬ stopPropagation() å’Œ preventDefault()ã€‚<br>å¦‚æœå› ä¸ºæŸäº›åŸå› ï¼Œå½“ä½ éœ€è¦ä½¿ç”¨æµè§ˆå™¨çš„åº•å±‚äº‹ä»¶æ—¶ï¼Œåªéœ€è¦ä½¿ç”¨ nativeEvent å±æ€§æ¥è·å–å³å¯ã€‚åˆæˆäº‹ä»¶ä¸æµè§ˆå™¨çš„åŸç”Ÿäº‹ä»¶ä¸åŒï¼Œä¹Ÿä¸ä¼šç›´æ¥æ˜ å°„åˆ°åŸç”Ÿäº‹ä»¶ã€‚ä¾‹å¦‚ï¼Œåœ¨ onMouseLeave äº‹ä»¶ä¸­ event.nativeEvent å°†æŒ‡å‘ mouseout äº‹ä»¶ã€‚æ¯ä¸ª SyntheticEvent å¯¹è±¡éƒ½åŒ…å«ä»¥ä¸‹å±æ€§ï¼š</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">boolean bubbles</span><br><span class="line">boolean cancelable</span><br><span class="line">DOMEventTarget currentTarget</span><br><span class="line">boolean defaultPrevented</span><br><span class="line">number eventPhase</span><br><span class="line">boolean isTrusted</span><br><span class="line">DOMEvent nativeEvent</span><br><span class="line"><span class="keyword">void</span> preventDefault()</span><br><span class="line">boolean isDefaultPrevented()</span><br><span class="line"><span class="keyword">void</span> stopPropagation()</span><br><span class="line">boolean isPropagationStopped()</span><br><span class="line"><span class="keyword">void</span> persist()</span><br><span class="line">DOMEventTarget target</span><br><span class="line">number timeStamp</span><br><span class="line">string type</span><br></pre></td></tr></table></figure><h3 id="Reactä½¿ç”¨åˆæˆäº‹ä»¶çš„åŸå› ï¼š"><a href="#Reactä½¿ç”¨åˆæˆäº‹ä»¶çš„åŸå› ï¼š" class="headerlink" title="Reactä½¿ç”¨åˆæˆäº‹ä»¶çš„åŸå› ï¼š"></a>Reactä½¿ç”¨åˆæˆäº‹ä»¶çš„åŸå› ï¼š</h3><ul><li>è¿›è¡Œæµè§ˆå™¨å…¼å®¹</li><li>é¿å…åƒåœ¾å›æ”¶</li><li>æ–¹ä¾¿äº‹ä»¶ç»Ÿä¸€ç®¡ç†å’Œäº‹åŠ¡æœºåˆ¶<br>ä¸‹é¢å¯¹æ¯”DOM2åŸç”Ÿäº‹ä»¶ï¼Œæ¼”ç¤ºå‡ ä¸ªDemoæ–¹ä¾¿æ›´å¥½çš„ç†è§£ï¼ŒDemo ä½¿ç”¨ â€œreactâ€: â€œ^16.14.0â€ æ¥æ¼”ç¤º</li></ul><h4 id="çˆ¶ç»„ä»¶ç›‘å¬ä¸¤ä¸ªåŸç”Ÿäº‹ä»¶"><a href="#çˆ¶ç»„ä»¶ç›‘å¬ä¸¤ä¸ªåŸç”Ÿäº‹ä»¶" class="headerlink" title="çˆ¶ç»„ä»¶ç›‘å¬ä¸¤ä¸ªåŸç”Ÿäº‹ä»¶"></a>çˆ¶ç»„ä»¶ç›‘å¬ä¸¤ä¸ªåŸç”Ÿäº‹ä»¶</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    <span class="built_in">document</span>.addEventListener(<span class="string">"click"</span>, () =&gt; &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"document"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">window</span>.addEventListener(<span class="string">"click"</span>, () =&gt; &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"window"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div className=<span class="string">"black-box"</span>&gt;</span><br><span class="line">        &lt;Demo /&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="1ã€åŸç”Ÿäº‹ä»¶"><a href="#1ã€åŸç”Ÿäº‹ä»¶" class="headerlink" title="1ã€åŸç”Ÿäº‹ä»¶"></a>1ã€åŸç”Ÿäº‹ä»¶</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Component &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">"./index.css"</span>;</span><br><span class="line"><span class="keyword">const</span> getDom = <span class="function">(<span class="params">className</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">document</span>.querySelector(<span class="string">`.<span class="subst">$&#123;className&#125;</span>`</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// å†’æ³¡/æ•è·</span></span><br><span class="line"><span class="keyword">const</span> BUBBLING = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;&#125;;</span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    <span class="keyword">const</span> c1 = getDom(<span class="string">"demo1-content1"</span>);</span><br><span class="line">    <span class="keyword">const</span> c2 = getDom(<span class="string">"demo1-content2"</span>);</span><br><span class="line">    <span class="keyword">const</span> c3 = getDom(<span class="string">"demo1-content3"</span>);</span><br><span class="line">    c1.addEventListener(</span><br><span class="line">      <span class="string">"click"</span>,</span><br><span class="line">      () =&gt; &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">      &#125;,</span><br><span class="line">      BUBBLING</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    c2.addEventListener(</span><br><span class="line">      <span class="string">"click"</span>,</span><br><span class="line">      () =&gt; &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="number">2</span>);</span><br><span class="line">      &#125;,</span><br><span class="line">      BUBBLING</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    c3.addEventListener(</span><br><span class="line">      <span class="string">"click"</span>,</span><br><span class="line">      () =&gt; &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="number">3</span>);</span><br><span class="line">      &#125;,</span><br><span class="line">      BUBBLING</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div className=<span class="string">"black"</span> &#123;...this.props&#125;&gt;</span><br><span class="line">        &lt;h3</span><br><span class="line">          onClick=&#123;() =&gt; &#123;</span><br><span class="line">            <span class="keyword">this</span>.setState(&#123; <span class="attr">show</span>: !<span class="keyword">this</span>.state.show &#125;);</span><br><span class="line">          &#125;&#125;</span><br><span class="line">          id=<span class="string">"black-1"</span></span><br><span class="line">        &gt;</span><br><span class="line">          demo1 åŸç”Ÿäº‹ä»¶</span><br><span class="line">        &lt;<span class="regexp">/h3&gt;</span></span><br><span class="line"><span class="regexp">        &lt;div className="demo1-content1"&gt;</span></span><br><span class="line"><span class="regexp">          1</span></span><br><span class="line"><span class="regexp">          &lt;div className="demo1-content2"&gt;</span></span><br><span class="line"><span class="regexp">            2&lt;div className="demo1-content3"&gt;3&lt;/</span>div&gt;</span><br><span class="line">          &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>div&gt;</span><br><span class="line">        &#123;<span class="keyword">this</span>.state.show &amp;&amp; <span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>3-2-1-document-window<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>&#125;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœæ˜¯æ˜¾è€Œæ˜“è§çš„ï¼Œå¦‚å›¾ï¼š<br><img src="https://mmbiz.qpic.cn/mmbiz_jpg/cAd6ObKOzECibQYm9hpPF91HuNQQXwd6aIVicazbHIRxRGYBoYMC8R19CVl3JkwLQRCTbmUD1OdeCBagJ6icm9sbw/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1" alt="image"></p><h4 id="2ã€åˆæˆäº‹ä»¶"><a href="#2ã€åˆæˆäº‹ä»¶" class="headerlink" title="2ã€åˆæˆäº‹ä»¶"></a>2ã€åˆæˆäº‹ä»¶</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Component &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">"./index.css"</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;&#125;;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div className=<span class="string">"black"</span>&gt;</span><br><span class="line">        &lt;h3</span><br><span class="line">          onClick=&#123;() =&gt; &#123;</span><br><span class="line">            <span class="keyword">this</span>.setState(&#123; <span class="attr">show</span>: !<span class="keyword">this</span>.state.show &#125;);</span><br><span class="line">          &#125;&#125;</span><br><span class="line">        &gt;</span><br><span class="line">          demo2 åˆæˆäº‹ä»¶</span><br><span class="line">        &lt;<span class="regexp">/h3&gt;</span></span><br><span class="line"><span class="regexp">        &lt;div</span></span><br><span class="line"><span class="regexp">          className="demo2-content1 yellow"</span></span><br><span class="line"><span class="regexp">          onClick=&#123;() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">            console.log(1);</span></span><br><span class="line"><span class="regexp">          &#125;&#125;</span></span><br><span class="line"><span class="regexp">        &gt;</span></span><br><span class="line"><span class="regexp">          1</span></span><br><span class="line"><span class="regexp">          &lt;div</span></span><br><span class="line"><span class="regexp">            className="demo2-content2 yellow"</span></span><br><span class="line"><span class="regexp">            onClick=&#123;() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">              console.log(2);</span></span><br><span class="line"><span class="regexp">            &#125;&#125;</span></span><br><span class="line"><span class="regexp">          &gt;</span></span><br><span class="line"><span class="regexp">            2</span></span><br><span class="line"><span class="regexp">            &lt;div</span></span><br><span class="line"><span class="regexp">              className="demo2-content3 yellow"</span></span><br><span class="line"><span class="regexp">              onClick=&#123;() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">                console.log(3);</span></span><br><span class="line"><span class="regexp">              &#125;&#125;</span></span><br><span class="line"><span class="regexp">            &gt;</span></span><br><span class="line"><span class="regexp">              3</span></span><br><span class="line"><span class="regexp">            &lt;/</span>div&gt;</span><br><span class="line">          &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>div&gt;</span><br><span class="line">        &#123;<span class="keyword">this</span>.state.show &amp;&amp; <span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>3-2-1-document-window<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>&#125;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š<br><img src="https://mmbiz.qpic.cn/mmbiz_jpg/cAd6ObKOzECibQYm9hpPF91HuNQQXwd6aXyfggetyjdUBo31wyTp6TiaGMCH3OFwJXPwzPicwicK1TbwxV1yicT1TBA/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1" alt="image"></p><h4 id="3ã€åŸç”Ÿäº‹ä»¶å’Œåˆæˆäº‹ä»¶æ··åˆä½¿ç”¨"><a href="#3ã€åŸç”Ÿäº‹ä»¶å’Œåˆæˆäº‹ä»¶æ··åˆä½¿ç”¨" class="headerlink" title="3ã€åŸç”Ÿäº‹ä»¶å’Œåˆæˆäº‹ä»¶æ··åˆä½¿ç”¨"></a>3ã€åŸç”Ÿäº‹ä»¶å’Œåˆæˆäº‹ä»¶æ··åˆä½¿ç”¨</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Component &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">"./index.css"</span>;</span><br><span class="line"><span class="keyword">const</span> getDom = <span class="function">(<span class="params">className</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">document</span>.querySelector(<span class="string">`.<span class="subst">$&#123;className&#125;</span>`</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// å†’æ³¡/æ•è·</span></span><br><span class="line"><span class="keyword">const</span> BUBBLING = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;&#125;;</span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    <span class="keyword">const</span> c1 = getDom(<span class="string">"demo3-content1"</span>);</span><br><span class="line">    <span class="keyword">const</span> c3 = getDom(<span class="string">"demo3-content3"</span>);</span><br><span class="line">    c1.addEventListener(</span><br><span class="line">      <span class="string">"click"</span>,</span><br><span class="line">      () =&gt; &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">      &#125;,</span><br><span class="line">      BUBBLING</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    c3.addEventListener(</span><br><span class="line">      <span class="string">"click"</span>,</span><br><span class="line">      () =&gt; &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="number">3</span>);</span><br><span class="line">      &#125;,</span><br><span class="line">      BUBBLING</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div className=<span class="string">"black"</span>&gt;</span><br><span class="line">        &lt;h3</span><br><span class="line">          onClick=&#123;() =&gt; &#123;</span><br><span class="line">            <span class="keyword">this</span>.setState(&#123; <span class="attr">show</span>: !<span class="keyword">this</span>.state.show &#125;);</span><br><span class="line">          &#125;&#125;</span><br><span class="line">        &gt;</span><br><span class="line">          demo3 æ··åˆä½¿ç”¨</span><br><span class="line">        &lt;<span class="regexp">/h3&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">        &lt;div className="demo3-content1"&gt;</span></span><br><span class="line"><span class="regexp">          1</span></span><br><span class="line"><span class="regexp">          &lt;div</span></span><br><span class="line"><span class="regexp">            className="demo3-content2 yellow"</span></span><br><span class="line"><span class="regexp">            onClick=&#123;() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">              console.log(2);</span></span><br><span class="line"><span class="regexp">            &#125;&#125;</span></span><br><span class="line"><span class="regexp">          &gt;</span></span><br><span class="line"><span class="regexp">            2&lt;div className="demo3-content3"&gt;3&lt;/</span>div&gt;</span><br><span class="line">          &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>div&gt;</span><br><span class="line">        &#123;<span class="keyword">this</span>.state.show &amp;&amp; (</span><br><span class="line">          &lt;p&gt;</span><br><span class="line">            <span class="number">3</span><span class="number">-1</span><span class="number">-2</span>-<span class="built_in">document</span>-<span class="built_in">window</span></span><br><span class="line">            &lt;br /&gt;</span><br><span class="line">          &lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">        )&#125;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><blockquote><p>é»„è‰²çš„æ•°å­—2æ‰€åœ¨åŒºåŸŸæ˜¯reactäº‹ä»¶ï¼Œ1å’Œ3æ˜¯åŸç”Ÿäº‹ä»¶</p></blockquote><p><img src="https://mmbiz.qpic.cn/mmbiz_png/cAd6ObKOzECibQYm9hpPF91HuNQQXwd6aibEqgTkL7QR1ibCL6C2MlBq7UOv4AKeMekiabda7KINiaJGojzXqCDCbtA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1" alt="image"></p><p>åˆ°è¿™é‡Œçš„ç–‘æƒ‘æ˜¯ï¼Œä¸ºä»€ä¹ˆ1æ¯”2å…ˆæ‰“å°å‡ºæ¥ï¼Ÿ</p><p>ç®€å•çš„æ¥è¯´ï¼Œå…¶å®æ˜¯<strong>React(v16)æ‰€æœ‰äº‹ä»¶æœ€åéƒ½æ˜¯ä»£ç†åˆ° document ä¸Šé¢</strong>ï¼Œé€šè¿‡å†’æ³¡æœºåˆ¶å…ˆè¾“å‡º3å’Œ1ï¼Œç„¶åè§¦å‘documentä¸Šçš„äº‹ä»¶ æ‰“å°2ã€‚documentä¸ŠæŒ‚è½½çš„ä¸¤ä¸ªäº‹ä»¶ï¼Œç¬¬ä¸€ä¸ªæ˜¯æˆ‘ä»¬åœ¨ <app> ç»„ä»¶é‡Œæ³¨å†Œçš„ï¼Œç¬¬äºŒä¸ªæ˜¯ React æŒ‚è½½çš„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚<br><img src="https://mmbiz.qpic.cn/mmbiz_png/cAd6ObKOzECibQYm9hpPF91HuNQQXwd6aPcoDLfhicgP0iaOQwAmlcee8Iucrib8gzgsmCX3NozlVKFB1peJQdkCGA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1" alt="image"></app></p><h4 id="4ã€åŸç”Ÿäº‹ä»¶é˜»æ­¢å†’æ³¡"><a href="#4ã€åŸç”Ÿäº‹ä»¶é˜»æ­¢å†’æ³¡" class="headerlink" title="4ã€åŸç”Ÿäº‹ä»¶é˜»æ­¢å†’æ³¡"></a>4ã€åŸç”Ÿäº‹ä»¶é˜»æ­¢å†’æ³¡</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Component &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">"./index.css"</span>;</span><br><span class="line"><span class="keyword">const</span> getDom = <span class="function">(<span class="params">className</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">document</span>.querySelector(<span class="string">`.<span class="subst">$&#123;className&#125;</span>`</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// å†’æ³¡/æ•è·</span></span><br><span class="line"><span class="keyword">const</span> BUBBLING = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;&#125;;</span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    <span class="keyword">const</span> c1 = getDom(<span class="string">"demo5-content1"</span>);</span><br><span class="line">    <span class="keyword">const</span> c2 = getDom(<span class="string">"demo5-content2"</span>);</span><br><span class="line">    <span class="keyword">const</span> c3 = getDom(<span class="string">"demo5-content3"</span>);</span><br><span class="line">    c1.addEventListener(</span><br><span class="line">      <span class="string">"click"</span>,</span><br><span class="line">      () =&gt; &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">      &#125;,</span><br><span class="line">      BUBBLING</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    c2.addEventListener(</span><br><span class="line">      <span class="string">"click"</span>,</span><br><span class="line">      (e) =&gt; &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="number">2</span>, <span class="string">"é˜»æ­¢åŸç”Ÿäº‹ä»¶å†’æ³¡"</span>);</span><br><span class="line">        <span class="comment">// é˜»æ­¢å†’æ³¡æˆ–æ•è·</span></span><br><span class="line">        e.stopPropagation();</span><br><span class="line">      &#125;,</span><br><span class="line">      BUBBLING</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    c3.addEventListener(</span><br><span class="line">      <span class="string">"click"</span>,</span><br><span class="line">      () =&gt; &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="number">3</span>);</span><br><span class="line">      &#125;,</span><br><span class="line">      BUBBLING</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div className=<span class="string">"black"</span>&gt;</span><br><span class="line">        &lt;h3</span><br><span class="line">          onClick=&#123;() =&gt; &#123;</span><br><span class="line">            <span class="keyword">this</span>.setState(&#123; <span class="attr">show</span>: !<span class="keyword">this</span>.state.show &#125;);</span><br><span class="line">          &#125;&#125;</span><br><span class="line">        &gt;</span><br><span class="line">          demo4 åŸç”Ÿé˜»æ­¢å†’æ³¡</span><br><span class="line">        &lt;<span class="regexp">/h3&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">        &lt;div className="demo5-content1"&gt;</span></span><br><span class="line"><span class="regexp">          1</span></span><br><span class="line"><span class="regexp">          &lt;div className="demo5-content2 stop"&gt;</span></span><br><span class="line"><span class="regexp">            2&lt;div className="demo5-content3"&gt;3&lt;/</span>div&gt;</span><br><span class="line">          &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>div&gt;</span><br><span class="line">        &#123;<span class="keyword">this</span>.state.show &amp;&amp; (</span><br><span class="line">          &lt;p&gt;</span><br><span class="line">            <span class="number">3</span><span class="number">-2</span></span><br><span class="line">            &lt;br /&gt;</span><br><span class="line">            e.stopPropagation();</span><br><span class="line">          &lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">        )&#125;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¹Ÿä¸éš¾ç†è§£ï¼Œçº¢è‰²è™šçº¿ä¸ºé˜»æ­¢äº†å†’æ³¡<br><img src="https://mmbiz.qpic.cn/mmbiz_png/cAd6ObKOzECibQYm9hpPF91HuNQQXwd6ao96neiaLRbh8B9pSlUibt3gQXXlRld7ZNnbGdK6LXquIdg6oxkDox2uw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1" alt="image"></p><h4 id="5ã€åˆæˆäº‹ä»¶é˜»æ­¢å†’æ³¡"><a href="#5ã€åˆæˆäº‹ä»¶é˜»æ­¢å†’æ³¡" class="headerlink" title="5ã€åˆæˆäº‹ä»¶é˜»æ­¢å†’æ³¡"></a>5ã€åˆæˆäº‹ä»¶é˜»æ­¢å†’æ³¡</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Component &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">"./index.css"</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;&#125;;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div className=<span class="string">"black"</span>&gt;</span><br><span class="line">        &lt;h3</span><br><span class="line">          onClick=&#123;() =&gt; &#123;</span><br><span class="line">            <span class="keyword">this</span>.setState(&#123; <span class="attr">show</span>: !<span class="keyword">this</span>.state.show &#125;);</span><br><span class="line">          &#125;&#125;</span><br><span class="line">        &gt;</span><br><span class="line">          demo5 åˆæˆé˜»æ­¢å†’æ³¡</span><br><span class="line">        &lt;<span class="regexp">/h3&gt;</span></span><br><span class="line"><span class="regexp">        &lt;div</span></span><br><span class="line"><span class="regexp">          className="demo6-content1 yellow"</span></span><br><span class="line"><span class="regexp">          onClick=&#123;() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">            console.log(1);</span></span><br><span class="line"><span class="regexp">          &#125;&#125;</span></span><br><span class="line"><span class="regexp">        &gt;</span></span><br><span class="line"><span class="regexp">          1</span></span><br><span class="line"><span class="regexp">          &lt;div</span></span><br><span class="line"><span class="regexp">            className="demo6-content2 yellow stop"</span></span><br><span class="line"><span class="regexp">            onClick=&#123;(e) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">              e.stopPropagation();</span></span><br><span class="line"><span class="regexp">              console.log(2);</span></span><br><span class="line"><span class="regexp">            &#125;&#125;</span></span><br><span class="line"><span class="regexp">          &gt;</span></span><br><span class="line"><span class="regexp">            2</span></span><br><span class="line"><span class="regexp">            &lt;div</span></span><br><span class="line"><span class="regexp">              className="demo6-content3 yellow"</span></span><br><span class="line"><span class="regexp">              onClick=&#123;() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">                console.log(3);</span></span><br><span class="line"><span class="regexp">              &#125;&#125;</span></span><br><span class="line"><span class="regexp">            &gt;</span></span><br><span class="line"><span class="regexp">              3</span></span><br><span class="line"><span class="regexp">            &lt;/</span>div&gt;</span><br><span class="line">          &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>div&gt;</span><br><span class="line">        &#123;<span class="keyword">this</span>.state.show &amp;&amp; (</span><br><span class="line">          &lt;p&gt;</span><br><span class="line">            <span class="number">3</span><span class="number">-2</span>-<span class="built_in">document</span></span><br><span class="line">            &lt;br /&gt;</span><br><span class="line">            e.stopPropagation();</span><br><span class="line">          &lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">        )&#125;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/cAd6ObKOzECibQYm9hpPF91HuNQQXwd6aLJoEhyibYCz0hargKIBA8ox85FIDc6Mib05e7INtuib5xOhLcAfwOBibrg/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1" alt="image"></p><p>è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œçš„ç¡®æ˜¯é˜»æ­¢äº†Reactäº‹ä»¶çš„å†’æ³¡ï¼Œåªè¾“å‡ºäº†3å’Œ2ã€‚ä½†æ˜¯ä¹Ÿæœ‰ä¸¤ä¸ªé—®é¢˜ã€‚</p><p>ç¬¬ä¸€ï¼Œä¸ºä½•windowä¸Šçš„åŸç”Ÿäº‹ä»¶ä¹Ÿè¢«é˜»æ­¢äº†ï¼Ÿ<br>ç¬¬äºŒï¼Œä¸ºä½•documentä¸Šçš„åŸç”Ÿäº‹ä»¶æ²¡è¢«é˜»æ­¢?<br>æˆ‘ä»¬çŸ¥é“ï¼Œä¸Šé¢è°ƒç”¨çš„e.stopPropagation()ï¼Œå…¶å®æ˜¯Reactäº‹ä»¶æœ¬èº«å¤„ç†è¿‡çš„ã€‚åŸç”Ÿçš„äº‹ä»¶éœ€è¦é€šè¿‡ nativeEvent è·å–ã€‚æ¥ç®€å•çœ‹ä¸€ä¸‹ä¸‹é¢çš„ä»£ç ï¼ŒReactæ˜¯å¦‚ä½•åšçš„ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">stopPropagation: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// åŸç”Ÿäº‹ä»¶</span></span><br><span class="line">  <span class="keyword">var</span> event = <span class="keyword">this</span>.nativeEvent;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!event) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (event.stopPropagation) &#123;</span><br><span class="line">    <span class="comment">// åŸç”Ÿäº‹ä»¶é˜»æ­¢å†’æ³¡</span></span><br><span class="line">    event.stopPropagation();</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> event.cancelBubble !== <span class="string">'unknown'</span>) &#123;</span><br><span class="line">    <span class="comment">// The ChangeEventPlugin registers a "propertychange" event for</span></span><br><span class="line">    <span class="comment">// IE. This event does not support bubbling or cancelling, and</span></span><br><span class="line">    <span class="comment">// any references to cancelBubble throw "Member not found".  A</span></span><br><span class="line">    <span class="comment">// typeof check of "unknown" circumvents this issue (and is also</span></span><br><span class="line">    <span class="comment">// IE specific).</span></span><br><span class="line">    event.cancelBubble = <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// è¿™é‡Œåº”è¯¥æ˜¯é˜»æ­¢ Reactåˆæˆäº‹ä»¶å†’æ³¡çš„åœ°æ–¹(å¾…æ±‚è¯)</span></span><br><span class="line">  <span class="keyword">this</span>.isPropagationStopped = functionThatReturnsTrue;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>å½“è°ƒç”¨ Reactäº‹ä»¶æœ¬èº«çš„e.stopPropagation()çš„æ—¶å€™ï¼ŒReact è°ƒç”¨äº†ä¸€æ¬¡åŸç”Ÿäº‹ä»¶ä¸Šçš„stopPropagation()ï¼Œä»è€Œé˜»æ­¢äº†windowä¸Šçš„äº‹ä»¶ã€‚</p><h4 id="åŸç”Ÿäº‹ä»¶ä¸åˆæˆäº‹ä»¶æ··ç”¨"><a href="#åŸç”Ÿäº‹ä»¶ä¸åˆæˆäº‹ä»¶æ··ç”¨" class="headerlink" title="åŸç”Ÿäº‹ä»¶ä¸åˆæˆäº‹ä»¶æ··ç”¨"></a>åŸç”Ÿäº‹ä»¶ä¸åˆæˆäº‹ä»¶æ··ç”¨</h4><p>å¦‚ä½•é˜»æ­¢å†’æ³¡</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">e.nativeEvent.stopImmediatePropagation();</span><br><span class="line">             e.stopPropagation();</span><br></pre></td></tr></table></figure><p>è°ƒç”¨ e.nativeEvent.stopImmediatePropagation()ï¼Œé˜»æ­¢documentä¸Šæ³¨å†Œçš„å…¶å®ƒåŸç”Ÿäº‹ä»¶ã€‚React å¯èƒ½æ˜¯åŸºäºè®¾è®¡æ–¹é¢è€ƒè™‘ï¼Œæ²¡æœ‰å®ç°è¿™ä¸ªæ–¹æ³•ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> react </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å·¨çŸ³é¡¹ç›®æ”¹é€ æ¢ç©¶.md</title>
      <link href="/ashley271017.github.io/2023/04/03/%E5%B7%A8%E7%9F%B3%E9%A1%B9%E7%9B%AE%E6%94%B9%E9%80%A0%E6%96%B9%E6%A1%88%E6%8E%A2%E7%A9%B6/"/>
      <url>/ashley271017.github.io/2023/04/03/%E5%B7%A8%E7%9F%B3%E9%A1%B9%E7%9B%AE%E6%94%B9%E9%80%A0%E6%96%B9%E6%A1%88%E6%8E%A2%E7%A9%B6/</url>
      
        <content type="html"><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>å…¬å¸æœ‰ä¸€ä¸ªå†å²æ‚ ä¹…ã€ä½“ç§¯åºå¤§çš„è€é¡¹ç›®ï¼Œé™¤äº†ä¼ ç»Ÿè€æ—§é¡¹ç›®å­˜åœ¨çš„ç‰¹ç‚¹ï¼Œè¯¥é¡¹ç›®å¼ºä¾èµ–åç«¯æ¨¡æ¿ï¼Œä¸”æ¯ä¸€ä¸ªé¡µé¢éƒ½å¯¹åº”ä¸€ä¸ªæ¨¡æ¿ï¼Œå¯åŠ¨ä¾æ‰˜äºdockerï¼Œéšç€é¡¹ç›®ä¸æ–­æ›´æ–°è¿­ä»£ï¼Œé¡¹ç›®ç»“æ„è¶Šæ¥è¶Šå¤æ‚ï¼Œç»´æŠ¤æˆæœ¬è¶Šæ¥è¶Šé«˜ï¼Œè¿›è€Œå¼•å‘ä¸€ç³»åˆ—çš„é—®é¢˜â€¦</p><h2 id="å·¨çŸ³åº”ç”¨å­˜åœ¨çš„é—®é¢˜"><a href="#å·¨çŸ³åº”ç”¨å­˜åœ¨çš„é—®é¢˜" class="headerlink" title="å·¨çŸ³åº”ç”¨å­˜åœ¨çš„é—®é¢˜"></a>å·¨çŸ³åº”ç”¨å­˜åœ¨çš„é—®é¢˜</h2><ul><li>é¡¹ç›®ä½“ç§¯è¿‡å¤§ï¼Œcloneæ—¶é—´é•¿</li><li>ç»“æ„æ··ä¹±ï¼Œé«˜åº¦è€¦åˆï¼Œéš¾ä»¥ç»´æŠ¤</li><li>éœ€è¦è§£å†³æ„å»ºæ—¶é—´é•¿çš„é—®é¢˜ï¼Œéœ€è¦ç»´æŠ¤å¤æ‚çš„webpacké…ç½®</li><li>å¤šäººå¼€å‘åŒä¸€ä¸ªé¡¹ç›®ï¼Œå‘å¸ƒéƒ¨ç½²å®¹æ˜“æ··ä¹±</li><li>æŠ€æœ¯æ ˆè¿­ä»£æˆæœ¬é«˜æ˜‚</li></ul><h2 id="å¦‚ä½•æ‹†åˆ†ï¼Ÿ"><a href="#å¦‚ä½•æ‹†åˆ†ï¼Ÿ" class="headerlink" title="å¦‚ä½•æ‹†åˆ†ï¼Ÿ"></a>å¦‚ä½•æ‹†åˆ†ï¼Ÿ</h2><p>æ—¢ç„¶æ˜¯å·¨çŸ³åº”ç”¨ï¼Œå¾ˆå®¹æ˜“æƒ³åˆ°çš„æ”¹é€ æ–¹æ¡ˆå°±æ˜¯æ‹†åˆ†æˆå¤šä¸ªå­åº”ç”¨ï¼Œåˆ†è€Œæ²»ä¹‹ï¼Œé€šå¸¸æ¥è¯´æœ‰ä»¥ä¸‹å‡ ç§æ‹†åˆ†æ–¹æ¡ˆï¼š</p><ul><li>æŒ‰æŠ€æœ¯æ‹†åˆ†</li><li>æŒ‰ç…§ä¸šåŠ¡æˆ–è€…é¡µé¢æ‹†åˆ†</li><li>æŒ‰ç…§æƒé™æ‹†åˆ†</li><li>æŒ‰ç…§å˜æ›´çš„é¢‘ç‡æ‹†åˆ†<br>æˆ‘ä»¬çš„é¡¹ç›®ä¸å­˜åœ¨æƒé™é™åˆ¶ä»¥åŠæŠ€æœ¯æ ˆä¸ç»Ÿä¸€çš„é—®é¢˜,æ˜¾ç„¶è¿™ä¸¤ç§æ‹†åˆ†æ–¹å¼éƒ½ä¸åˆé€‚ï¼Œåœ¨æˆ‘ä»¬çš„ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œä¸€ä¸ªé¡¹ç›®æ˜¯ç”±å¤šä¸ªé¡µé¢ç»„æˆçš„ï¼Œæ¯ä¸ªé¡µé¢ä¹‹å‰çš„çŠ¶æ€ç›¸äº’ç‹¬ç«‹ï¼Œæ˜¾è€Œæ˜“è§çš„ç›´æ¥æŒ‰ç…§ä¸šåŠ¡æ‹†åˆ†å³å¯ï¼Œè¿™é‡Œæ¨è<a href="https://www.npmjs.com/package/madge" target="_blank" rel="noopener">madge</a>å·¥å…·ï¼Œå®ƒå¯æ ¹æ®ä½ æŒ‡å®šçš„å…¥å£è‡ªåŠ¨ä¸ºä½ æ‰¾åˆ°å…¥å£çš„ä¾èµ–ï¼Œå¹¶å°†å…¶ä»ä¸»é¡¹ç›®ä¸­å‰¥ç¦»å‡ºæ¥ï¼Œæ‹†åˆ†å®Œæˆä¹‹åï¼Œåˆè¯¥é‡‡ç”¨å“ªç§æ¶æ„æ–¹å¼å‘¢ï¼Ÿ</li></ul><h2 id="ä¼ ç»Ÿè§£å†³æ–¹æ¡ˆ"><a href="#ä¼ ç»Ÿè§£å†³æ–¹æ¡ˆ" class="headerlink" title="ä¼ ç»Ÿè§£å†³æ–¹æ¡ˆ"></a>ä¼ ç»Ÿè§£å†³æ–¹æ¡ˆ</h2><h3 id="muti-repo"><a href="#muti-repo" class="headerlink" title="muti repo"></a>muti repo</h3><p>ä¹Ÿå°±æ˜¯ç›´æ¥å°†å…¶æ‹†åˆ†æˆå¤šä¸ªä»“åº“ï¼Œç®€å•ç²—æš´ä½†å­˜åœ¨ä¸å°‘é—®é¢˜ï¼š</p><h4 id="ç®¡ç†ã€è°ƒè¯•å›°éš¾"><a href="#ç®¡ç†ã€è°ƒè¯•å›°éš¾" class="headerlink" title="ç®¡ç†ã€è°ƒè¯•å›°éš¾"></a>ç®¡ç†ã€è°ƒè¯•å›°éš¾</h4><p>å¤šä¸ª git ä»“åº“ç®¡ç†èµ·æ¥å¤©ç„¶æ˜¯éº»çƒ¦çš„ã€‚å¯¹äºåŠŸèƒ½ç±»ä¼¼çš„æ¨¡å—ï¼Œå¦‚æœæ‹†æˆäº†å¤šä¸ªä»“åº“ï¼Œæ— è®ºå¯¹äºå¤šäººåä½œè¿˜æ˜¯ç‹¬ç«‹å¼€å‘ï¼Œéƒ½éœ€è¦æ‰“å¼€å¤šä¸ªä»“åº“ã€‚<br>è™½ç„¶ vscode é€šè¿‡ Workspaces è§£å†³å¤šä»“åº“ç®¡ç†çš„é—®é¢˜ï¼Œä½†åœ¨å¤šäººåä½œçš„åœºæ™¯ä¸‹ï¼Œæ— æ³•ä¿è¯æ¯ä¸ªäººçš„ç¯å¢ƒé…ç½®ä¸€è‡´ã€‚  </p><h4 id="åˆ†æ”¯ç®¡ç†æ··ä¹±"><a href="#åˆ†æ”¯ç®¡ç†æ··ä¹±" class="headerlink" title="åˆ†æ”¯ç®¡ç†æ··ä¹±"></a>åˆ†æ”¯ç®¡ç†æ··ä¹±</h4><p>å‡å¦‚ä¸€ä¸ªä»“åº“æä¾›ç»™ Aã€B ä¸¤ä¸ªé¡¹ç›®ç”¨ï¼Œè€Œ B é¡¹ç›®ä¼˜å…ˆå¼€å‘äº†åŠŸèƒ½ bï¼Œæ— æ³•ä¸ A é¡¹ç›®å…¼å®¹ï¼Œæ­¤æ—¶å°±è¦åœ¨è¿™ä¸ªä»“åº“å¼€ä¸€ä¸ª feature/b çš„åˆ†æ”¯æ”¯æŒè¿™ä¸ªåŠŸèƒ½ï¼Œå¹¶ä¸”åœ¨æœªæ¥åˆå¹¶åˆ°ä¸»å¹²åŒæ­¥åˆ°é¡¹ç›® Aã€‚<br>ä¸€æ—¦éœ€è¦å¼€åˆ†æ”¯çš„ç»„ä»¶å˜å¤šäº†ï¼Œä¸”ä¹‹é—´å‡ºæ¥ä¾èµ–å…³è”ï¼Œåˆ†æ”¯ç®¡ç†å¤æ‚åº¦å°±ä¼šå‘ˆæŒ‡æ•°ä¸Šå‡ã€‚</p><h4 id="ä¾èµ–å…³ç³»å¤æ‚"><a href="#ä¾èµ–å…³ç³»å¤æ‚" class="headerlink" title="ä¾èµ–å…³ç³»å¤æ‚"></a>ä¾èµ–å…³ç³»å¤æ‚</h4><p>ç‹¬ç«‹ä»“åº“é—´ç»„ä»¶ç‰ˆæœ¬å·çš„ç»´æŠ¤éœ€è¦æ‰‹åŠ¨æ“ä½œï¼Œå› ä¸ºæºä»£ç ä¸åœ¨ä¸€èµ·ï¼Œæ‰€ä»¥æ²¡æœ‰åŠæ³•æ•´ä½“åˆ†æä¾èµ–ï¼Œè‡ªåŠ¨åŒ–ç®¡ç†ç‰ˆæœ¬å·çš„ä¾èµ–ã€‚ä¸‰æ–¹ä¾èµ–ç‰ˆæœ¬å¯èƒ½ä¸ä¸€è‡´:ä¸€ä¸ªç‹¬ç«‹çš„åŒ…æ‹¥æœ‰ä¸€å¥—ç‹¬ç«‹çš„å¼€å‘ç¯å¢ƒï¼Œéš¾ä»¥ä¿è¯å­æ¨¡å—çš„ç‰ˆæœ¬å’Œä¸»é¡¹ç›®å®Œå…¨ä¸€ç›´ï¼Œå°±å­˜åœ¨è¿è¡Œç»“æœä¸ä¸€è‡´çš„é£é™©ã€‚</p><h4 id="å ç”¨æ€»ç©ºé—´å¤§"><a href="#å ç”¨æ€»ç©ºé—´å¤§" class="headerlink" title="å ç”¨æ€»ç©ºé—´å¤§"></a>å ç”¨æ€»ç©ºé—´å¤§</h4><p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œä¸€ä¸ªå…¬å¸çš„ä¸šåŠ¡é¡¹ç›®åªæœ‰ä¸€ä¸ªä¸»å¹²ï¼Œå¤š git repo çš„æ–¹å¼æµªè´¹äº†å¤§é‡å­˜å‚¨ç©ºé—´é‡å¤å®‰è£…æ¯”å¦‚ React ç­‰å¤§å‹æ¨¡å—ï¼Œæ—¶é—´ä¹…äº†å¯èƒ½ä¼šå ç”¨å‡ å GB çš„é¢å¤–ç©ºé—´ï¼Œå¯¹äºæ²¡æœ‰å¤–æ¥ç¡¬ç›˜çš„åŒå­¦æ¥è¯´ï¼Œå®šæœŸæ¸…ç†ä¸ç”¨çš„é¡¹ç›®ä¸‹ node_modules ä¹Ÿæ˜¯ä¸€ä»¶éº»çƒ¦äº‹ã€‚</p><h4 id="ä¸åˆ©äºå›¢é˜Ÿåä½œ"><a href="#ä¸åˆ©äºå›¢é˜Ÿåä½œ" class="headerlink" title="ä¸åˆ©äºå›¢é˜Ÿåä½œ"></a>ä¸åˆ©äºå›¢é˜Ÿåä½œ</h4><p>ä¸€ä¸ªå¤§é¡¹ç›®å¯èƒ½ä¼šç”¨åˆ°æ•°ç™¾ä¸ªäºŒæ–¹åŒ…ï¼Œä¸åŒäºŒæ–¹åŒ…çš„ç»´æŠ¤é¢‘ç‡ä¸åŒï¼Œæƒé™ä¸åŒï¼Œä»“åº“ä½ç½®ä¹Ÿä¸åŒï¼Œä¸»ä»“åº“å¯¹å®ƒä»¬çš„ä¾èµ–æ–¹å¼ä¹Ÿä¸åŒã€‚ä¸€æ—¦å…¶ä¸­ä¸€ä¸ªåŒ…è¿›è¡Œäº†éæ­£å¸¸æ”¹åŠ¨ï¼Œå°±ä¼šå½±å“åˆ°æ•´ä¸ªé¡¹ç›®ï¼Œè€Œæˆ‘ä»¬ç²¾åŠ›æœ‰é™ï¼Œåªç›¯ç€ä¸»ä»“åº“ï¼Œå¾€å¾€ä¼šæ ½åœ¨ä¸èµ·çœ¼çš„äºŒæ–¹åŒ…å‘å¸ƒä¸Šã€‚</p><h4 id="ä»£ç æ— æ³•å¤ç”¨"><a href="#ä»£ç æ— æ³•å¤ç”¨" class="headerlink" title="ä»£ç æ— æ³•å¤ç”¨"></a>ä»£ç æ— æ³•å¤ç”¨</h4><p>ä¹‹å‰æˆ‘ä»¬è¯´è¿‡æˆ‘ä»¬çš„é¡¹ç›®å¼ºä¾èµ–äºåç«¯ï¼Œå¦‚æœç›´æ¥äº†å½“çš„æ‹†åˆ†æˆå¤šä¸ªé¡¹ç›®çš„è¯ï¼Œåç«¯ä»£ç ä¹Ÿä¼šå­˜åœ¨äºå¤šä¸ªä»“åº“ï¼Œä½†æ˜¯ç”±äºæ•´ä¸ªçš„æ”¹é€ æˆ‘ä»¬ä»…ä»…åªæƒ³é’ˆå¯¹äºå‰ç«¯ï¼Œéœ€è¦å¯¹åç«¯åŒå­¦æ˜¯æ— æ„ŸçŸ¥çš„ï¼Œæ˜¾ç„¶è¿™ç§æ–¹å¼æ— æ³•åšåˆ°</p><h2 id="ç°ä»£åŒ–è§£å†³æ–¹æ¡ˆ"><a href="#ç°ä»£åŒ–è§£å†³æ–¹æ¡ˆ" class="headerlink" title="ç°ä»£åŒ–è§£å†³æ–¹æ¡ˆ"></a>ç°ä»£åŒ–è§£å†³æ–¹æ¡ˆ</h2><h3 id="monorepo"><a href="#monorepo" class="headerlink" title="monorepo"></a>monorepo</h3><p>æ˜¯ç®¡ç†é¡¹ç›®ä»£ç çš„ä¸€ä¸ªæ–¹å¼ï¼ŒæŒ‡åœ¨ä¸€ä¸ªé¡¹ç›®ä»“åº“ (repo) ä¸­ç®¡ç†å¤šä¸ªæ¨¡å—/åŒ… (package)ï¼Œä¸åŒäºå¸¸è§çš„æ¯ä¸ªæ¨¡å—å»ºä¸€ä¸ª repoã€‚</p><h4 id="ä¼˜åŠ¿ï¼š"><a href="#ä¼˜åŠ¿ï¼š" class="headerlink" title="ä¼˜åŠ¿ï¼š"></a>ä¼˜åŠ¿ï¼š</h4><ul><li>å¤šä¸ªé¡¹ç›®ä¸€å¥—é…ç½®ä½†æ˜¯å¯ä»¥åˆ†æ‰¹æ„å»ºåˆ†å¼€å‘å¸ƒ</li><li>å¼€å‘é˜¶æ®µä¸ç”¨æ¥å›åˆ‡æ¢é¡¹ç›®</li><li>å¯ä»¥å…±ç”¨ä»£ç  åŒæ—¶ä¸ç”¨å‘å¸ƒå³å¯æœ¬åœ°è°ƒè¯•å…¬å…±åŒ…</li><li>ç®€åŒ–çš„ä¾èµ–ç®¡ç†ï¼Œæ— éœ€ä¸ºä¾èµ–é¡¹æŒ‡å®šç‰ˆæœ¬å·ï¼Œå› ä¸ºæ‰€æœ‰é¡¹ç›®åªæœ‰ä¸€ä¸ªé€šç”¨ç‰ˆæœ¬å·ã€‚</li><li>ä¾èµ–å¯å¤ç”¨</li></ul><h4 id="åŠ£åŠ¿ï¼š"><a href="#åŠ£åŠ¿ï¼š" class="headerlink" title="åŠ£åŠ¿ï¼š"></a>åŠ£åŠ¿ï¼š</h4><ul><li>ä»“åº“ä½“ç§¯è¾ƒå¤§</li><li>æäº¤è®°å½•å®¹æ˜“æ··ä¹±</li><li>å› ä¸ºæ˜¯ä¸€ä¸ªä»“åº“ï¼Œä¸å¥½å¯¹å­é¡¹ç›®åšå•ç‹¬çš„æƒé™å¤„ç†</li><li>ä¸é€‚åˆåšè‡ªåŠ¨åŒ–å‘å¸ƒ å¤šä¸ªé¡¹ç›®ä¸€èˆ¬éƒ½æ˜¯ç‹¬ç«‹çš„å‘å¸ƒä¸å¥½ç»Ÿä¸€</li><li>éœ€è¦è‡ªå·±ç®¡ç†ä¾èµ–å…³ç³»</li><li>æäº¤å†å²å®¹æ˜“æ··ä¹±ï¼Œéœ€è¦è‡ªå·±ç®¡ç†</li></ul><h4 id="é€‚ç”¨åœºæ™¯ï¼š"><a href="#é€‚ç”¨åœºæ™¯ï¼š" class="headerlink" title="é€‚ç”¨åœºæ™¯ï¼š"></a>é€‚ç”¨åœºæ™¯ï¼š</h4><p>é€‚åˆå†…èšæ€§æ¯”è¾ƒå¼ºçš„å·¥å…·ç±»ã€æ¡†æ¶ç±»å·¥ç¨‹ï¼Œä¾‹å¦‚reactç›¸å…³ã€ Angularç›¸å…³ï¼Œä¸€èˆ¬å‘å¸ƒä¼šæœ‰ä¸€ç³»åˆ—çš„ä¾èµ–åŒæ­¥æ›´æ–°ï¼›åŒæ—¶è¿™ç§å·¥ç¨‹å‘å±•æ˜¯å¯æ§çš„ï¼Œä¸ä¼šéšæ„è†¨èƒ€ï¼Œæ‰€ä»¥åº“çš„ä½“ç§¯ä¹Ÿæ˜¯å¯æ§çš„ã€‚</p><h4 id="ä¸é€‚ç”¨åœºæ™¯ï¼š"><a href="#ä¸é€‚ç”¨åœºæ™¯ï¼š" class="headerlink" title="ä¸é€‚ç”¨åœºæ™¯ï¼š"></a>ä¸é€‚ç”¨åœºæ™¯ï¼š</h4><ul><li>ä½“ç§¯ä¸å¯æ§çš„é¡¹ç›®</li><li>éœ€è¦åšæƒé™ç®¡ç†çš„é¡¹ç›®</li><li>ä¸é€‚ç”¨å­é¡¹ç›®æŠ€æœ¯æ ˆå·®å¼‚å¤§çš„åœºæ™¯</li></ul><p>å›åˆ°æˆ‘ä»¬çš„ä¸šåŠ¡åœºæ™¯ï¼Œç”±äºå„ä¸ªå­åº”ç”¨ä¹‹é—´çš„æ„å»ºå­˜åœ¨å·®å¼‚æ²¡å¿…è¦å…±ç”¨ä¸€å¥—æ„å»ºé…ç½®ï¼Œä¸”å­˜åœ¨é¡¹ç›®ä½“ç§¯ä¸å¯æ§ã€ç›®å‰åªæ”¯æŒå…¨é‡å‘å¸ƒç­‰å› ç´ ï¼Œå› æ­¤æœªé‡‡ç”¨æ”¹æ–¹æ¡ˆ</p><h3 id="git-submodules-muti-repo"><a href="#git-submodules-muti-repo" class="headerlink" title="git submodules + muti repo"></a>git submodules + muti repo</h3><h4 id="ä»€ä¹ˆæ˜¯git-submodules"><a href="#ä»€ä¹ˆæ˜¯git-submodules" class="headerlink" title="ä»€ä¹ˆæ˜¯git submodules?"></a>ä»€ä¹ˆæ˜¯git submodules?</h4><p>å…è®¸æ‚¨å°† Git å­˜å‚¨åº“ä¿ç•™ä¸ºå¦ä¸€ä¸ª Git å­˜å‚¨åº“çš„å­ç›®å½•ï¼Œè¿™ä½¿æ‚¨å¯ä»¥å°†å¦ä¸€ä¸ªå­˜å‚¨åº“å…‹éš†åˆ°æ‚¨çš„é¡¹ç›®ä¸­ï¼Œå¹¶å°†æ‚¨çš„æäº¤åˆ†å¼€ï¼Œå­ä»“åº“åŒ…å«äº†ä¸€æ•´ä¸ªå®Œæ•´çš„gitä»“åº“,ç”šè‡³åŒ…å«äº†.gitç›®å½•ã€‚<br>æˆ‘å¸é‡‡ç”¨çš„ä¹Ÿæ˜¯è¯¥æ–¹æ¡ˆï¼Œåœ¨æˆ‘ä»¬çš„åœºæ™¯ä¸­å¯ä»¥å°†å·¨çŸ³é¡¹ç›®ä¸­çš„å„ä¸ªé¡µé¢æ‹†åˆ†æˆä¸€ä¸ªç‹¬ç«‹çš„é¡¹ç›®ï¼Œç„¶åå°†æ‰€æœ‰é¡µé¢éƒ½ä¾èµ–çš„åº•å±‚æœåŠ¡ä»¥åŠå…¬å…±ç»„ä»¶ã€å…¬å…±æ–¹æ³•ç­‰æŠ½ç¦»å‡ºæ¥ä½œä¸ºå­ä»“åº“ï¼Œä¿®æ”¹å­ä»“åº“çš„æ—¶å€™æ— éœ€åˆ‡æ¢é¡¹ç›®åªéœ€<code>cd ${å­ä»“åº“ç›®å½•}</code>å³å¯ã€‚</p><h4 id="ä¼˜åŠ¿"><a href="#ä¼˜åŠ¿" class="headerlink" title="ä¼˜åŠ¿"></a>ä¼˜åŠ¿</h4><ul><li>ä»£ç å¯å¤ç”¨ï¼Œè°ƒè¯•æˆæœ¬ä½ï¼šæ‹†åˆ†å‡ºå­æ¨¡å—ä¹‹åï¼Œä¹Ÿèƒ½åšåˆ°å¯ä»¥å…±ç”¨ä¸€å¥—å…¬å…±ä»£ç è€Œæ— éœ€å®‰è£…npmåŒ…å¹¶ä¸”å¯ä»¥ç›´æ¥æœ¬åœ°è°ƒè¯•</li><li>å¯ä»¥ç›´æ¥åœ¨æ‹†å‡ºæ¥çš„é¡¹ç›®ä¸­ï¼Œè¿è¡Œsubmoduleçš„ä»£ç ï¼šå› æ­¤å¯ä»¥åœ¨submoduleä¸­æ”¾ä¸€äº›å…¬å…±æœåŠ¡ï¼Œé€‚ç”¨äºä¾èµ–äºdockeræˆ–è€…æ˜¯å‰åç«¯æœªå®Œå…¨åˆ†ç¦»ä¹‹ç±»çš„é¡¹ç›®ï¼Œæ¯”å¦‚åœ¨æˆ‘ä»¬çš„ä¸šåŠ¡ä¸­ï¼Œåªéœ€å­ä»“åº“ç»´æŠ¤ä¸€å¥—åç«¯æ¨¡æ¿ä¸dockeré…ç½®ï¼Œè¿è¡Œå­ä»“åº“çš„å®¿ä¸»ä»“åº“çš„æ—¶å€™åªéœ€<code>cd ${å­ä»“åº“ç›®å½•}</code>è¿è¡Œå®¹å™¨ï¼Œç„¶åå°†å®¿ä¸»ä»“åº“çš„ç«¯å£ä»£ç†åˆ°å®¹å™¨è¿è¡Œçš„8083ç«¯å£å³å¯ï¼Œåœ¨å‘æŒ¥äº†å¤šä»“åº“ä¼˜åŠ¿çš„åŒæ—¶ä¿è¯äº†åŸºç¡€æœåŠ¡ï¼ˆåç«¯ä»£ç ï¼‰çš„å”¯ä¸€æ€§</li></ul><h4 id="åŠ£åŠ¿"><a href="#åŠ£åŠ¿" class="headerlink" title="åŠ£åŠ¿"></a>åŠ£åŠ¿</h4><ul><li>cloneçš„æ—¶å€™éœ€è¦é¢å¤–cloneä¸€ä¸‹å­é¡¹ç›®ï¼Œå¦‚æœå­ä»“åº“ä½“ç§¯è¿‡å¤§å°±ä¼šé€ æˆcloneæ—¶é—´è¿‡é•¿</li><li>ä¿®æ”¹å­é¡¹ç›®çš„æ—¶å€™éœ€è¦åˆ‡æ¢åˆ°å­é¡¹ç›®çš„ä»“åº“</li><li>ç›¸æ¯”npmåŒ…çš„å½¢å¼ï¼Œåªè¦ä¿®æ”¹äº†submoduleä¸­çš„ä»£ç å°±ä¼šç‰µä¸€å‘è€ŒåŠ¨å…¨èº«ï¼Œå­˜åœ¨é£é™©</li><li>åªæ˜¯å¯¹å¤ç”¨ä»£ç æä¾›äº†è§£å†³æ–¹æ¡ˆï¼Œå…¶ä»–ä¼ ç»Ÿå¤šä»“åº“çš„é—®é¢˜è¿˜æ˜¯å­˜åœ¨</li></ul><h3 id="webpack5æ¨¡å—è”é‚¦ï¼ˆModule-Federationï¼‰"><a href="#webpack5æ¨¡å—è”é‚¦ï¼ˆModule-Federationï¼‰" class="headerlink" title="webpack5æ¨¡å—è”é‚¦ï¼ˆModule Federationï¼‰"></a>webpack5æ¨¡å—è”é‚¦ï¼ˆModule Federationï¼‰</h3><p>ä¹Ÿæ˜¯ä¸€ç§æå–å…¬å…±æ¨¡å—çš„æ–¹æ¡ˆï¼Œ æ¯ä¸ªå­åº”ç”¨å•ç‹¬æ„å»ºï¼Œä¸»åº”ç”¨åœ¨è¿è¡Œæ—¶é€šè¿‡å®¹å™¨åŠ è½½è¿œç¨‹æ¨¡å—å³å­åº”ç”¨çš„æ„å»ºã€‚ä¸»åº”ç”¨è‡ªåŠ¨ä½¿ç”¨å­åº”ç”¨å½“å‰ç‰ˆæœ¬çš„æœ€æ–°èµ„æºï¼Œä¸€å¥è¯æ¦‚æ‹¬å°±æ˜¯ï¼šå®ƒèƒ½å…è®¸ä¸€ä¸ªçº¿ä¸Šéƒ¨ç½²çš„é¡¹ç›®åœ¨è¿è¡Œæ—¶åŠ è½½å…¶ä»–çº¿ä¸Šéƒ¨ç½²é¡¹ç›®ä¸­çš„ç»„ä»¶ã€‚</p><h4 id="åŸºæœ¬åŸç†"><a href="#åŸºæœ¬åŸç†" class="headerlink" title="åŸºæœ¬åŸç†"></a>åŸºæœ¬åŸç†</h4><p>è®¾æƒ³ä¸€ä¸‹ï¼Œåœ¨ webpack ä¸­å¯ä»¥å°†ä¸€äº›åç»­åŠ è½½çš„æ¨¡å—æ‰“æˆ chunk åŒ…ï¼Œç„¶ååœ¨ä½¿ç”¨åˆ°è¿™ä¸ªæ¨¡å—çš„æ—¶å€™å†æ‡’åŠ è½½ï¼Œè¿™ç§æƒ…å½¢ä¸€èˆ¬æ˜¯åœ¨åŒä¸€ä¸ªé¡¹ç›®ä¸­è¿›è¡Œã€‚<br>é‚£ä¹ˆæˆ‘ä»¬æ˜¯å¦ä¹Ÿå¯ä»¥åœ¨ A é¡¹ç›®ä¸­æŠŠä¸€ä¸ªç»„ä»¶åŠå…¶ä¾èµ–æ‰“åŒ…æˆ chunk åŒ…ï¼Œè€Œåœ¨ B é¡¹ç›®ä¸­æŒ‰çº¦å®šçš„åœ°å€å¼‚æ­¥ import åˆšæ‰é‚£ä¸ª A é¡¹ç›®çš„ chunk åŒ…ï¼Œå¹¶è¿è¡Œä½¿ç”¨å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯ Module Federationã€‚</p><h4 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h4><ul><li>è¿œç¨‹ç»„ä»¶æä¾›æ–¹ç§°ä¸º remote ç«¯ï¼Œè¿œç¨‹ç»„ä»¶ä½¿ç”¨æ–¹ç§°ä¸º host ç«¯ã€‚</li><li>ä¸€ä¸ªé¡¹ç›®æ—¢å¯ä»¥ä¸º remote ç«¯ï¼Œä¹Ÿå¯ä»¥ä¸º host ç«¯ï¼Œå¯ä»¥ä½¿ç”¨æ•°ä¸ªä¸åŒå…¶ä»–é¡¹ç›®çš„ç»„ä»¶ï¼Œä¹Ÿå¯ä»¥ä¸ºæ•°ä¸ªå…¶ä»–é¡¹ç›®æä¾›ä¸åŒçš„ç»„ä»¶ã€‚</li></ul><h4 id="å…·ä½“æ€ä¹ˆå·¥ä½œï¼Ÿ"><a href="#å…·ä½“æ€ä¹ˆå·¥ä½œï¼Ÿ" class="headerlink" title="å…·ä½“æ€ä¹ˆå·¥ä½œï¼Ÿ"></a>å…·ä½“æ€ä¹ˆå·¥ä½œï¼Ÿ</h4><p>ä¾‹å­ï¼šé¡¹ç›®è¦å¼•å…¥ä¸€ä¸ªå·¥å•å·¥ä½œå°çš„é¡µé¢ï¼Œå¦‚ä¸‹ï¼š<br><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dbafec2d54ae4533a17652dd21445966~tplv-k3u1fbpfcp-zoom-1.image" alt><br>å·¥å•å·¥ä½œå°ä½œä¸º remote ç«¯çš„é…ç½®</p><h5 id="remoteç«¯ï¼ˆå·¥å•å·¥ä½œå°ï¼‰"><a href="#remoteç«¯ï¼ˆå·¥å•å·¥ä½œå°ï¼‰" class="headerlink" title="remoteç«¯ï¼ˆå·¥å•å·¥ä½œå°ï¼‰"></a>remoteç«¯ï¼ˆå·¥å•å·¥ä½œå°ï¼‰</h5><p>(1) ç”±äºæˆ‘ä»¬ä¸¤ä¸ªé¡¹ç›®éƒ½ä½¿ç”¨çš„æ˜¯ vue3 + vite æ–¹æ¡ˆï¼Œæ‰€ä»¥ä½¿ç”¨ vite-plugin-federation æ’ä»¶æ˜¯æˆ‘ä»¬æœ€ä½³çš„é€‰æ‹©ã€‚é¦–å…ˆéœ€è¦åœ¨ host ç«¯å’Œ remote ç«¯å®‰è£…æ’ä»¶ï¼Œå¦‚ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add @originjs/vite-plugin-federation -D</span><br></pre></td></tr></table></figure><p>(2) åœ¨æ’ä»¶å†…æ³¨å†Œéœ€è¦æä¾›çš„ç»„ä»¶,å¹¶ä¸”æä¾›éœ€è¦å…±äº«çš„ä¸‰æ–¹ä¾èµ–<br><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cd6c5e87e78140f18e712fd41236de19~tplv-k3u1fbpfcp-zoom-1.image" alt></p><p>(3) é…ç½®å®Œæˆåæ‰“åŒ…<br>åœ¨ remote ç«¯æ‰“åŒ…åä¼šç”Ÿæˆå¯¹åº”çš„å…¥å£æ–‡ä»¶ï¼Œchunk æ–‡ä»¶åŠä¾èµ–åŒ…æ–‡ä»¶<br><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d73e59fb9af745769a86ba6d5d94c283~tplv-k3u1fbpfcp-zoom-1.image" alt></p><h5 id="hostç«¯ï¼ˆIM-å’Œç”µè¯å·¥ä½œå°ï¼‰"><a href="#hostç«¯ï¼ˆIM-å’Œç”µè¯å·¥ä½œå°ï¼‰" class="headerlink" title="hostç«¯ï¼ˆIM å’Œç”µè¯å·¥ä½œå°ï¼‰"></a>hostç«¯ï¼ˆIM å’Œç”µè¯å·¥ä½œå°ï¼‰</h5><p>(1) æ’ä»¶é…ç½®ï¼Œè®¾ç½®è¿œç¨‹åŒ…åœ°å€<br><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/827da6c768164d719481726cf89131b3~tplv-k3u1fbpfcp-zoom-1.image" alt></p><p>(2) å¼•ç”¨åŠæ³¨å†Œç»„ä»¶ï¼Œmain.ts æ–‡ä»¶å¦‚ä¸‹<br><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7565703a6c3f425b8914f5e453c148e8~tplv-k3u1fbpfcp-zoom-1.image" alt><br>è¿™æ—¶éœ€è¦æ³¨æ„ï¼Œticket-share ä¸º host ä¾§åœ¨ vite æ’ä»¶ä¸­æ³¨å†Œçš„åŒ…åï¼ŒDetail ä¸º remote ç«¯æš´éœ²(exposes å­—æ®µ)å£°æ˜çš„ç»„ä»¶åã€‚é™¤äº†åœ¨å…¨å±€æ³¨å†Œï¼Œè¿˜å¯ä»¥åœ¨ä»»æ„éœ€è¦å¼•ç”¨çš„åœ°æ–¹å¼•ç”¨ã€‚<br>(3) ç»„ä»¶çš„ä½¿ç”¨<br>åœ¨éœ€è¦çš„åœ°æ–¹å¼•å…¥ä½¿ç”¨ï¼Œå¹¶æ ¹æ®ä¸šåŠ¡æƒ…å†µä¼ é€’ propsï¼Œprops çš„ä½¿ç”¨æ–¹å¼ä¸æ™®é€šç»„ä»¶æ— å¼‚ã€‚<br><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/01ae1c7f1d7541b3be60c10263958702~tplv-k3u1fbpfcp-zoom-1.image" alt><br>æ­¤æ—¶æˆ‘ä»¬å·²ç»å®Œæˆäº†å…¨éƒ¨é…ç½®ï¼Œæ­¤åæˆ‘ä»¬åªè¦æ‰“åŒ…ä¸Šçº¿è¿è¡Œå³å¯ã€‚</p><h5 id="çº¿ä¸Šå¦‚ä½•è°ƒè¯•"><a href="#çº¿ä¸Šå¦‚ä½•è°ƒè¯•" class="headerlink" title="çº¿ä¸Šå¦‚ä½•è°ƒè¯•"></a>çº¿ä¸Šå¦‚ä½•è°ƒè¯•</h5><p>ä½¿ç”¨<a href="https://einaregilsson.com/redirector/" target="_blank" rel="noopener">Redirector</a> æµè§ˆå™¨æ‰©å±•ï¼š<br>å‡è®¾å¾®åº”ç”¨ç¨‹åºçš„è¿œç¨‹å…¥å£æ–‡ä»¶åœ¨<a href="https://my-federated-app.com/federated/my-micro-app/remoteEntry.js" target="_blank" rel="noopener">https://my-federated-app.com/federated/my-micro-app/remoteEntry.js</a>. ç„¶åï¼Œå¦‚æœæˆ‘æƒ³ä½¿ç”¨æœ¬åœ°å¼€å‘æœåŠ¡å™¨å¤„ç†æ­¤åº”ç”¨ç¨‹åºï¼Œæˆ‘å¯ä»¥å°†åŒ…å«è¯¥æ¨¡å¼çš„ä»»ä½•è¯·æ±‚é‡å®šå‘/federated/my-micro-app/åˆ°<a href="http://localhost:3000è¿è¡Œå¼€å‘æœåŠ¡å™¨çš„ä½ç½®" target="_blank" rel="noopener">http://localhost:3000è¿è¡Œå¼€å‘æœåŠ¡å™¨çš„ä½ç½®</a><br><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6f7ba34d0ab548e4923b9a2d8b1df0fd~tplv-k3u1fbpfcp-zoom-1.image" alt></p><h4 id="ä¼˜åŠ¿-1"><a href="#ä¼˜åŠ¿-1" class="headerlink" title="ä¼˜åŠ¿"></a>ä¼˜åŠ¿</h4><ul><li>æ›´æ–°æˆæœ¬ä½ï¼šå¼•å…¥å…¬å…±åŒ…ä¸éœ€è¦æ‰“åŒ…å†å‘å¸ƒï¼Œç›¸æ¯”npmåŒ…ï¼Œä¸éœ€è¦æŒ¨ä¸ªå‡çº§ä½¿ç”¨è¯¥åŒ…çš„é¡¹ç›®çš„ä¾èµ–ç‰ˆæœ¬ï¼Œä»–ä¹Ÿé€‚ç”¨äºå¤æ‚åº¦é«˜çš„ï¼Œä¸šåŠ¡å…³è”æ€§é«˜ï¼Œæ›´æ–°é¢‘æ¬¡é«˜çš„ä¸‰é«˜é¡µé¢çº§ç»„ä»¶</li><li>æŠ€æœ¯æˆæœ¬ä½ï¼šåªéœ€è¦ä¿®æ”¹ä¸€ä¸‹webpacké…ç½®å³å¯</li><li>æ”¯æŒå»¶è¿ŸåŠ è½½ï¼š bundleä»¥ä»…åœ¨å¿…è¦æ—¶åŠ è½½æ¨¡å—ï¼Œä»è€Œæé«˜ Web æ€§èƒ½ã€‚</li><li>å‡å°‘é‡å¤æ€§ä¾èµ–ï¼šå¼•å…¥çš„å…¬å…±ä»£ç å¯ä»¥ç›´æ¥ä½¿ç”¨å®¿ä¸»ç¯å¢ƒçš„ä¾èµ–</li><li>çµæ´»æ‹†åˆ†ï¼Œç»†ç²’åŒ–ç¨‹åº¦é«˜ï¼šç›¸æ¯”git submodulesï¼Œå¯ä»¥é¢—ç²’åŒ–åˆ°å•é¡µåº”ç”¨æˆ–è€…ç»„ä»¶ã€‚ä¹Ÿå°±æ˜¯è¯´ä»–ä¹Ÿå¯ä»¥ä»£æ›¿iframe</li></ul><h4 id="åŠ£åŠ¿-1"><a href="#åŠ£åŠ¿-1" class="headerlink" title="åŠ£åŠ¿"></a>åŠ£åŠ¿</h4><ul><li>æ²¡æœ‰æ ·å¼éš”ç¦»æœºåˆ¶ï¼Œå®¹æ˜“é€ æˆä¸»å­åº”ç”¨æ ·å¼æ±¡æŸ“</li><li>æœ¬åœ°å¼€å‘éœ€è¦å¼€å¯å¤šä¸ªç«¯å£çš„æœåŠ¡ï¼Œæ¯”è¾ƒéº»çƒ¦</li><li>å…±äº«åŒ…çš„ç»´æŠ¤æˆæœ¬é«˜ï¼šéœ€è¦å°†ç»„ä»¶å…±äº«çš„åŒ…éƒ½æ‰¾å‡ºæ¥ï¼Œå…±äº«æœ‰æ—¶æ˜¯å¼ºåˆ¶çš„ï¼Œå¦‚æœæ¼äº†æŸäº›åŒ…ï¼Œå¯èƒ½ä¼šå¯¼è‡´é¡µé¢æŠ¥é”™æˆ–å´©æºƒï¼ŒåŒä¸€ä¸ªåº“ï¼Œæœ‰æ—¶éœ€è¦ç»´æŠ¤åœ¨çº¦å®šçš„ç‰ˆæœ¬èŒƒå›´å†…ï¼Œæœ‰æ—¶ä¸€ä¸ªåŒ…å¤ªè€æˆ–å¤ªæ–°ä¹Ÿä¼šåœ¨åŠ è½½æ—¶æŠ¥é”™ï¼ˆä¸è¿‡æ˜¯å¦éœ€è¦å…±äº«å¯ä¾›ç”¨æˆ·é€‰æ‹©ï¼‰</li><li><del>éœ€è¦åˆç†è§„åˆ’chunkæ‹†åˆ†ï¼Œå¦‚æœæ‹†åˆ†chunkè¿‡å¤šä¼šå¯¼è‡´è¯·æ±‚Chunkæ•°é‡è¿‡å¤šï¼Œå¹¶å‘é‡è¿‡å¤§ï¼Œå¦‚æœå¤šä¸ªæ¨¡å—å…±ç”¨ä¸€ä¸ª<code>remoteEntry</code>åˆæ— æ³•å¯¹å…¶ä¸­åŒ…å«çš„æ¨¡å—çš„ç‰ˆæœ¬åšå•ç‹¬ç®¡ç†</del>ï¼ˆæ”¹åŠ¨é¢‘ç¹çš„åˆ’åˆ†åˆ°ä¸€èµ·ï¼Œå¦‚ä½•åƒnpmåŒ…ä¸€æ ·åšç‰ˆæœ¬ç®¡ç†ï¼Ÿexternal-remote-plugin å¯ä»¥è®©ç‰ˆæœ¬å·ç”±JSåŠ¨æ€æ³¨å…¥ï¼Œè¿™é‡Œå¯ä»¥ç»“åˆäº‘æ§é…ç½®ï¼‰</li></ul><p>å›åˆ°æˆ‘ä»¬çš„ä¸šåŠ¡åœºæ™¯ï¼Œç”±äºæ¨¡å—è”é‚¦åªèƒ½å¤ç”¨JS chunkï¼Œå¯¹äºæˆ‘ä»¬ä¾èµ–çš„åç«¯æœåŠ¡æ— æ³•å¤ç”¨ï¼Œå› æ­¤æ— æ³•ä½œä¸ºåŸºå±‚è§£å†³æ–¹æ¡ˆï¼Œä½†æ˜¯ä»–èƒ½è§£å†³ç›®å‰ä»£ç å¤ç”¨æ–¹å¼å­˜åœ¨çš„é—®é¢˜ï¼šç”±äºæˆ‘ä»¬çš„å„ä¸ªå­é¡¹ç›®éƒ½ä¾èµ–äº†<code>submodule</code>ä¸­çš„å…¬å…±ç»„ä»¶ã€å…¬å…±æ–¹æ³•ï¼Œæ¯å½“ä¿®æ”¹ä¸€æ¬¡è¿™äº›å…¬å…±ç»„ä»¶ã€æ–¹æ³•çš„æ—¶å€™ï¼Œæ— è®ºå­åº”ç”¨éœ€ä¸éœ€è¦ä¿®æ”¹è°ƒç”¨æ–¹å¼ï¼Œéƒ½éœ€è¦åœ¨æ¯ä¸ªåº”ç”¨åˆ°è¿™äº›å…¬å…±ç»„ä»¶ã€æ–¹æ³• çš„åº”ç”¨é‡æ–°ç¼–è¯‘æ‰“åŒ…ï¼Œæ˜¾ç„¶å½±å“åˆ°äº†æ•ˆç‡ï¼Œåˆ©ç”¨æ¨¡å—è”é‚¦çš„ç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¿è¯ä¿®æ”¹æ— å‰¯ä½œç”¨çš„å‰æä¸‹ï¼Œç›´æ¥ä¸Šçº¿<code>submodule</code>çš„å†…å®¹ï¼Œå¯¹äºå­åº”ç”¨æ˜¯æ— æ„ŸçŸ¥çš„ï¼Œåªæ˜¯cdné“¾æ¥æŒ‡å‘çš„<code>Js chunk</code>çš„å†…å®¹å˜äº†è€Œå·²</p><h3 id="å¾®å‰ç«¯"><a href="#å¾®å‰ç«¯" class="headerlink" title="å¾®å‰ç«¯"></a>å¾®å‰ç«¯</h3><p>å¾®å‰ç«¯æ˜¯ä¸€ç§ç±»ä¼¼äºå¾®æœåŠ¡çš„æ¶æ„ï¼Œå®ƒå°†å¾®æœåŠ¡çš„ç†å¿µåº”ç”¨äºæµè§ˆå™¨ç«¯ï¼Œå³å°† Web åº”ç”¨ç”±å•ä¸€çš„å•ä½“åº”ç”¨è½¬å˜ä¸ºå¤šä¸ªå°å‹å‰ç«¯åº”ç”¨èšåˆä¸ºä¸€çš„åº”ç”¨ã€‚å¾®å‰ç«¯æ¶æ„ä¸æ¡†æ¶æ— å…³ï¼Œæ¯ä¸ªå¾®åº”ç”¨éƒ½å¯ä»¥ç‹¬ç«‹å¼€å‘ã€ç‹¬ç«‹è¿è¡Œã€ç‹¬ç«‹éƒ¨ç½²ã€‚</p><h4 id="qiankun"><a href="#qiankun" class="headerlink" title="qiankun"></a>qiankun</h4><p>ä¹¾å¤æ˜¯å¸‚é¢ä¸Šå¸¸è§çš„å¾®å‰ç«¯æ¡†æ¶ï¼Œä»¥æ­¤ä¸ºä¾‹è¯´è¯´ä»–çš„ç‰¹æ€§ï¼š<br>qiankuné‡‡ç”¨<code>HTML Entry</code> æ–¹å¼è¿›è¡Œäº†æ›¿ä»£ä¼˜åŒ–ã€‚</p><p><strong>ä»€ä¹ˆæ˜¯HTML Entry?</strong></p><p>å°±æ˜¯ç›´æ¥å°†å­åº”ç”¨æ‰“å‡ºæ¥ HTML ä½œä¸ºå…¥å£ï¼Œä¸»æ¡†æ¶å¯ä»¥é€šè¿‡ fetch html çš„æ–¹å¼è·å–å­åº”ç”¨çš„é™æ€èµ„æºï¼ŒåŒæ—¶å°† HTML document ä½œä¸ºå­èŠ‚ç‚¹å¡åˆ°ä¸»æ¡†æ¶çš„å®¹å™¨ä¸­ã€‚</p><p>ä½¿ç”¨qiankunè¿›è¡Œå¾®å‰ç«¯æ”¹é€ åï¼Œé¡µé¢è¢«æ‹†åˆ†ä¸ºä¸€ä¸ªåŸºåº§åº”ç”¨å’Œå¤šä¸ªå­åº”ç”¨ï¼Œæ¯ä¸ªå­åº”ç”¨éƒ½è¿è¡Œåœ¨ç‹¬ç«‹çš„æ²™ç®±ç¯å¢ƒä¸­ã€‚</p><p>å…·æœ‰å¦‚ä¸‹ç‰¹ç‚¹ï¼š</p><ul><li>ç‹¬ç«‹æ€§ï¼šå¾®å‰ç«¯çš„ä¸»åº”ç”¨ä»¥åŠå„ä¸ªå­åº”ç”¨ç‹¬ç«‹å¼€å‘ã€ç‹¬ç«‹éƒ¨ç½²ï¼Œå¹¶ä¸”åœ¨ä¸€å®šç¨‹åº¦ä¸Šå¾®å‰ç«¯å­åº”ç”¨å¯ä»¥ç‹¬ç«‹äºä¸»åº”ç”¨å•ç‹¬è¿è¡Œï¼›</li><li>æ²™ç®±éš”ç¦»ï¼šå­åº”ç”¨æœ‰è‡ªå·±å•ç‹¬çš„è¿è¡Œæ—¶ï¼Œå„ä¸ªå­åº”ç”¨ä¹‹é—´çš„çŠ¶æ€ä¸è¢«å…±äº«ï¼Œä¹Ÿå°±æ˜¯å„ä¸ªå­åº”ç”¨ä¹‹é—´ï¼šCSSä¸JSéƒ½æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œä¸ä¼šè¢«åˆ«çš„å­åº”ç”¨æ‰€æ±¡æŸ“ã€‚</li><li>æ¡†æ¶æ— å…³ï¼šå­åº”ç”¨å®Œå…¨å¯ä»¥é‡‡å–ä¸åŒçš„æ¡†æ¶è¿›è¡Œå¼€å‘ï¼Œå› ä¸ºç°æœ‰å¾®å‰ç«¯æ¡†æ¶å®ç°ä¸­ï¼Œä¸»åº”ç”¨ä»…æ˜¯åŠ è½½å­åº”ç”¨æ„å»ºåçš„ bundleï¼›</li><li>çŠ¶æ€å…±äº«ï¼šå­åº”ç”¨å¯å…±äº«ä¸»åº”ç”¨çš„çŠ¶æ€</li></ul><p>å¯ä»¥çœ‹å‡ºä»–ç›¸æ¯”åˆ«çš„æ–¹æ¡ˆæœ€å¤§çš„ä¼˜åŠ¿æ˜¯æ²™ç®±éš”ç¦»ä¸æ¡†æ¶æ— å…³</p><h5 id="é€‚ç”¨åœºæ™¯"><a href="#é€‚ç”¨åœºæ™¯" class="headerlink" title="é€‚ç”¨åœºæ™¯"></a>é€‚ç”¨åœºæ™¯</h5><ul><li>å½“å·¨çŸ³åº”ç”¨ä¸­æŸä¸€éƒ¨åˆ†éœ€è¦åœ¨æŠ€æœ¯æ ˆä¸Šåšå¢é‡å‡çº§æˆ–è€…é‡æ„çš„æ—¶å€™</li><li>éœ€è¦å®ç°å‰ç«¯åº”ç”¨çš„åŠ¨æ€åŠ è½½å’Œå¸è½½ä»¥æé«˜ç”¨æˆ·ä½“éªŒè·Ÿèµ„æºåˆ©ç”¨ç‡</li><li>éœ€è¦ä¿è¯å„ä¸ªå‰ç«¯åº”ç”¨ä¹‹é—´çš„æ ·å¼éš”ç¦»ä»¥åŠjsæ²™ç®±</li><li>éœ€è¦å°†å¤šä¸ªå‰ç«¯åº”ç”¨æ•´åˆä¸ºä¸€ä¸ªæ•´ä½“ä½†æ˜¯åˆä¸æƒ³ç‰ºç‰²å„è‡ªçš„æŠ€æœ¯æ ˆè·Ÿå¼€å‘æ–¹å¼</li></ul><h5 id="ä¸é€‚ç”¨åœºæ™¯"><a href="#ä¸é€‚ç”¨åœºæ™¯" class="headerlink" title="ä¸é€‚ç”¨åœºæ™¯"></a>ä¸é€‚ç”¨åœºæ™¯</h5><p>å‰ç«¯å¤æ‚åº¦è¾ƒä½ï¼Œæ²¡å¿…è¦<br>å„ä¸ªåº”ç”¨ä¹‹é—´æœ‰å¾ˆå¼ºçš„ä¸šåŠ¡è€¦åˆæˆ–è€…æ•°æ®ä¾èµ–ã€éœ€è¦é¢‘ç¹é€šä¿¡æˆ–è€…æ˜¯å…±äº«çŠ¶æ€</p><p>ç”±äºæˆ‘ä»¬çš„é¡¹ç›®æœ¬èº«å°±æ˜¯ä¸€ä¸ªå¤šé¡µé¢é¡¹ç›®ï¼Œå¤©ç„¶æ”¯æŒHTML Entryï¼ŒåŠ ä¸Šæˆ‘ä»¬æ˜¯å°†å·¨çŸ³åº”ç”¨æ‹†åˆ†æˆå¤šä¸ªå°åº”ç”¨è€Œä¸æ˜¯èšåˆå¤šä¸ªå°åº”ç”¨å› æ­¤ä¸å­˜åœ¨æŠ€æœ¯æ ˆä¸ç»Ÿä¸€çš„é—®é¢˜ï¼Œä¸è¿™ä¸ªæ–¹æ¡ˆå¹¶ä¸æ˜¯å¾ˆåŒ¹é…</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æ— è®ºæ˜¯å“ªä¸€ç§æ–¹æ¡ˆéƒ½ä¸æ˜¯å®Œç¾çš„ï¼Œå…·ä½“åº”ç”¨å“ªä¸€ç§è¿˜æ˜¯éœ€è¦ç»“åˆä¸šåŠ¡åœºæ™¯ã€åˆ‡èº«å®è·µé€‰æ‹©</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://xie.infoq.cn/article/cab16528dc0ecf3514fdfd492" target="_blank" rel="noopener">https://xie.infoq.cn/article/cab16528dc0ecf3514fdfd492</a></li><li><a href="https://www.burhanuday.com/blog/2023/03/devx-and-deployments-in-a-module-federated-micro-frontend" target="_blank" rel="noopener">https://www.burhanuday.com/blog/2023/03/devx-and-deployments-in-a-module-federated-micro-frontend</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> æ¶æ„ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ‹¯æ•‘åŠ¨ç”»å¡é¡¿ä¹‹FLIP</title>
      <link href="/ashley271017.github.io/2023/03/20/%E6%8B%AF%E6%95%91%E5%8A%A8%E7%94%BB%E5%8D%A1%E9%A1%BF%E4%B9%8BFLIP/"/>
      <url>/ashley271017.github.io/2023/03/20/%E6%8B%AF%E6%95%91%E5%8A%A8%E7%94%BB%E5%8D%A1%E9%A1%BF%E4%B9%8BFLIP/</url>
      
        <content type="html"><![CDATA[<h2 id="å‰ç½®çŸ¥è¯†"><a href="#å‰ç½®çŸ¥è¯†" class="headerlink" title="å‰ç½®çŸ¥è¯†"></a>å‰ç½®çŸ¥è¯†</h2><h3 id="ä»€ä¹ˆæ˜¯FPS"><a href="#ä»€ä¹ˆæ˜¯FPS" class="headerlink" title="ä»€ä¹ˆæ˜¯FPS"></a>ä»€ä¹ˆæ˜¯FPS</h3><p><code>FPS</code>æ˜¯æµè§ˆå™¨çš„æ¯ç§’çš„æ¸²æŸ“å¸§æ•°ï¼Œä¹Ÿå°±æ˜¯æµè§ˆå™¨åˆ‡æ¢ç”»é¢çš„æ¬¡æ•°ï¼Œå¤§å¤šæ•°è®¾å¤‡çš„åˆ·æ–°ç‡éƒ½æ˜¯60<code>FPS</code>ï¼Œä¸€èˆ¬æ¥è¯´<code>FPS</code>è¶Šä½é¡µé¢å°±ä¼šè¶Šå¡é¡¿ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯åƒç´ ç®¡é“ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯åƒç´ ç®¡é“ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯åƒç´ ç®¡é“ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯åƒç´ ç®¡é“ï¼Ÿ</h3><p>åƒç´ ç®¡é“æ˜¯æµè§ˆå™¨å•ä¸ªå¸§çš„æ¸²æŸ“æµæ°´çº¿ï¼Œå¦‚æœå…¶ä¸­æœ‰æŸäº›ç¯èŠ‚æ‰§è¡Œè¿‡ç¨‹è¿‡é•¿å°±ä¼šå¯¼è‡´å¡é¡¿</p><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ee5166bbe70e4e878853b2cc4b0bfba0~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p><ul><li>JavaScriptã€‚é€šå¸¸æ¥è¯´ï¼Œé˜»å¡çš„å‘èµ·éƒ½æ˜¯æ¥è‡ªäº JS ï¼Œè¿™ä¸æ˜¯è¯´ä¸ç”¨ JSï¼Œè€Œæ˜¯è¦æ­£ç¡®çš„ä½¿ç”¨ JS ã€‚é¦–å…ˆï¼ŒJS çº¿ç¨‹çš„è¿è¡Œæœ¬èº«å°±æ˜¯é˜»å¡ UI çº¿ç¨‹çš„ï¼ˆæš‚ä¸è€ƒè™‘ Web Workerï¼‰ã€‚ä»çº¯ç²¹çš„æ•°å­¦è§’åº¦è€Œè¨€ï¼Œæ¯å¸§çš„é¢„ç®—çº¦ä¸º 16.7 æ¯«ç§’ï¼ˆ1000 æ¯«ç§’ / 60 å¸§ = 16.66 æ¯«ç§’/å¸§ï¼‰ã€‚ä½†å› ä¸ºæµè§ˆå™¨éœ€è¦èŠ±è´¹æ—¶é—´å°†æ–°å¸§ç»˜åˆ¶åˆ°å±å¹•ä¸Šï¼Œåªæœ‰ ~10 æ¯«ç§’æ¥æ‰§è¡Œ JS ä»£ç ï¼Œè¿‡é•¿æ—¶é—´çš„åŒæ­¥æ‰§è¡Œ JS ä»£ç è‚¯å®šä¼šå¯¼è‡´è¶…è¿‡ 10ms è¿™ä¸ªé˜ˆå€¼ï¼Œå…¶æ¬¡ï¼Œé¢‘ç¹æ‰§è¡Œä¸€äº›ä»£ç ä¹Ÿä¼šè¿‡é•¿çš„å ç”¨æ¯å¸§æ¸²æŸ“çš„æ—¶é—´ã€‚æ­¤å¤–ï¼Œç”¨ JS å»è·å–ä¸€äº›æ ·å¼è¿˜ä¼šå¯¼è‡´<strong>å¼ºåˆ¶åŒæ­¥å¸ƒå±€</strong>ã€‚</li><li>æ ·å¼è®¡ç®—ï¼ˆStyleï¼‰ã€‚æ­¤è¿‡ç¨‹æ˜¯æ ¹æ®åŒ¹é…é€‰æ‹©å™¨ï¼ˆä¾‹å¦‚ <code>.headline</code> æˆ– <code>.nav &gt; .nav__item</code>ï¼‰è®¡ç®—å‡ºå“ªäº›å…ƒç´ åº”ç”¨å“ªäº› CSS è§„åˆ™çš„è¿‡ç¨‹ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸ä»…åŒ…æ‹¬è®¡ç®—å±‚å æ ·å¼è¡¨ä¸­çš„æƒé‡æ¥ç¡®å®šæ ·å¼ï¼Œä¹ŸåŒ…æ‹¬å†…è”çš„æ ·å¼ï¼Œæ¥è®¡ç®—æ¯ä¸ªå…ƒç´ çš„æœ€ç»ˆæ ·å¼ã€‚</li><li>å¸ƒå±€ï¼ˆLayoutï¼‰ã€‚åœ¨çŸ¥é“å¯¹ä¸€ä¸ªå…ƒç´ åº”ç”¨å“ªäº›è§„åˆ™ä¹‹åï¼Œæµè§ˆå™¨å³å¯å¼€å§‹è®¡ç®—è¯¥å…ƒç´ è¦å æ®çš„ç©ºé—´å¤§å°åŠå…¶åœ¨å±å¹•çš„ä½ç½®ã€‚ç½‘é¡µçš„å¸ƒå±€æ¨¡å¼æ„å‘³ç€ä¸€ä¸ªå…ƒç´ å¯èƒ½å½±å“å…¶ä»–å…ƒç´ ï¼Œä¸€èˆ¬æ¥è¯´å¦‚æœä¿®æ”¹äº†æŸä¸ªå…ƒç´ çš„å¤§å°æˆ–è€…ä½ç½®ï¼Œåˆ™éœ€è¦æ£€æŸ¥å…¶ä»–æ‰€æœ‰å…ƒç´ å¹¶é‡æ’ï¼ˆre-flowï¼‰æ•´ä¸ªé¡µé¢ã€‚</li><li>ç»˜åˆ¶ï¼ˆPaintï¼‰ã€‚ç»˜åˆ¶æ˜¯å¡«å……åƒç´ çš„è¿‡ç¨‹ã€‚å®ƒæ¶‰åŠç»˜å‡ºæ–‡æœ¬ã€é¢œè‰²ã€å›¾åƒã€è¾¹æ¡†å’Œé˜´å½±ï¼ŒåŸºæœ¬ä¸ŠåŒ…æ‹¬å…ƒç´ çš„æ¯ä¸ªå¯è§†éƒ¨åˆ†ã€‚ç»˜åˆ¶ä¸€èˆ¬æ˜¯åœ¨å¤šä¸ªè¡¨é¢ï¼ˆé€šå¸¸ç§°ä¸ºå±‚ï¼‰ä¸Šå®Œæˆçš„ï¼Œç»˜åˆ¶åŒ…æ‹¬ä¸¤ä¸ªæ­¥éª¤ï¼š 1) åˆ›å»ºç»˜å›¾è°ƒç”¨çš„åˆ—è¡¨ï¼Œ 2) å¡«å……åƒç´ ï¼Œåè€…ä¹Ÿè¢«ç§°ä½œæ …æ ¼åŒ–ã€‚</li><li>åˆæˆï¼ˆCompositeï¼‰ã€‚ç”±äºé¡µé¢çš„å„éƒ¨åˆ†å¯èƒ½è¢«ç»˜åˆ¶åˆ°å¤šä¸ªå±‚ä¸Šï¼Œå› æ­¤å®ƒä»¬éœ€è¦æŒ‰æ­£ç¡®é¡ºåºç»˜åˆ¶åˆ°å±å¹•ä¸Šï¼Œæ‰èƒ½æ­£ç¡®åœ°æ¸²æŸ“é¡µé¢ã€‚å°¤å…¶å¯¹äºä¸å¦ä¸€å…ƒç´ é‡å çš„å…ƒç´ æ¥è¯´ï¼Œè¿™ç‚¹ç‰¹åˆ«é‡è¦ï¼Œå› ä¸ºä¸€ä¸ªé”™è¯¯å¯èƒ½ä½¿ä¸€ä¸ªå…ƒç´ é”™è¯¯åœ°å‡ºç°åœ¨å¦ä¸€ä¸ªå…ƒç´ çš„ä¸Šå±‚ã€‚</li></ul><p>ä¸Šè¿°çš„äº”ä¸ªé˜¶æ®µå¹¶ä¸æ˜¯ä¸€å®šéƒ½ä¼šæ‰§è¡Œåˆ°çš„ï¼Œè¿™äº”ä¸ªé˜¶æ®µä¸­æ¶‰åŠåˆ°äº†è€ç”Ÿå¸¸è°ˆçš„ä¸¤ä¸ªæ¦‚å¿µï¼šé‡æ’è·Ÿé‡ç»˜ï¼Œè™½ç„¶åˆæ¬¡æ¸²æŸ“å¸ƒå±€è·Ÿç»˜åˆ¶å¿…ä¸å¯å°‘ï¼Œä½†æ˜¯åæœŸæˆ‘ä»¬å¯ä»¥æ§åˆ¶é¿å…é€šè¿‡è¿™ä¸¤ä¸ªç®¡é“ï¼š<br>ä»¥ä¸‹æ˜¯å½“æˆ‘ä»¬ä¿®æ”¹ä¸åŒçš„æ ·å¼å±æ€§æ—¶ï¼Œä¼šè§¦å‘çš„å‡ ç§å¸§æµç¨‹ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/07f513086a434ad08c7697cf30e78f5e~tplv-k3u1fbpfcp-zoom-1.image" alt="image.png"></p><p>ä»ä¸Šå›¾ä¸­èƒ½çœ‹åˆ°JSé˜¶æ®µä»¥åŠStyle å’Œ Compositeé˜¶æ®µ æ˜¯ä¸å¯é¿å…çš„ï¼Œå› ä¸ºéœ€è¦ JS æ¥å¼•å‘æ ·å¼çš„æ”¹å˜ï¼ŒStyle æ¥è®¡ç®—æ›´æ”¹åæœ€ç»ˆçš„æ ·å¼ï¼ŒComposite æ¥åˆæˆå„ä¸ªå±‚æœ€ç»ˆè¿›è¡Œæ˜¾ç¤ºï¼Œèƒ½è·³è¿‡çš„æ­¥éª¤åªæœ‰å¸ƒå±€è·Ÿç»˜åˆ¶ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œæ‰§è¡Œçš„é˜¶æ®µè¶Šå°‘ï¼Œè€—æ—¶å°±è¶Šå°‘ï¼Œæ¯ç§’çš„æ¸²æŸ“å¸§æ•°å°±ä¼šè¶Šé«˜ï¼Œé‚£ä¹ˆèƒ½ä¸èƒ½ç›´æ¥è·³è¿‡è¿™ä¸¤ä¸ªæ­¥éª¤ç›´æ¥åˆ°åˆæˆå‘¢ï¼Ÿ<br>ç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œå¦‚ä¸‹çš„å±æ€§åªä¼šè§¦å‘åˆæˆé˜¶æ®µï¼š<br>transformã€opacityã€pointer-eventsã€perspective ï¼ˆé€è§†æ•ˆæœï¼‰ã€curosrã€orphansè®¾ç½®å½“å…ƒç´ å†…éƒ¨å‘ç”Ÿåˆ†é¡µæ—¶å¿…é¡»åœ¨é¡µé¢åº•éƒ¨ä¿ç•™çš„æœ€å°‘è¡Œæ•°ï¼ˆç”¨äºæ‰“å°æˆ–æ‰“å°é¢„è§ˆï¼‰ã€widowsï¼ˆè®¾ç½®å½“å…ƒç´ å†…éƒ¨å‘ç”Ÿåˆ†é¡µæ—¶å¿…é¡»åœ¨é¡µé¢é¡¶éƒ¨ä¿ç•™çš„æœ€å°‘è¡Œæ•°ï¼ˆç”¨äºæ‰“å°æˆ–æ‰“å°é¢„è§ˆï¼‰ï¼‰ã€‚</p><h2 id="FLIP"><a href="#FLIP" class="headerlink" title="FLIP"></a>FLIP</h2><p>ç»¼ä¸Šæ‰€è¿°ï¼Œå½“æˆ‘ä»¬å†™åŠ¨ç”»çš„æ—¶å€™å¦‚æœç”¨<code>height</code> <code>margin</code> <code>padding</code> <code>left</code>ç­‰ä¼šè§¦å‘é‡æ’çš„å±æ€§ï¼Œç›¸è¾ƒäºåªç”¨<code>transform</code>æˆ–è€…<code>opacity</code>ä¼šå¸¦æ¥æ›´å¤šçš„æ€§èƒ½å¼€é”€ï¼Œä¸€æ—¦è¿™ä¸ªè®¡ç®—æ—¶é•¿è¶…è¿‡1ä¸ªåŠ¨ç”»å¸§(ä¸€èˆ¬æ˜¯60å¸§æ¯ç§’,ä¹Ÿå°±æ˜¯è¯´è¶…è¿‡16.7ms), é‚£ä¹ˆè¿™å¸§åŠ¨ç”»å°†ä¸ä¼šç»˜åˆ¶ï¼Œäº§ç”Ÿé¡µé¢å¡é¡¿ã€‚<br><code>FLIP</code>æŠ€æœ¯ï¼Œå°±æ˜¯ä¸€ç§è®©åŠ¨ç”»åªåˆ©ç”¨åˆ°<code>transform</code>æˆ–è€…<code>opacity</code>çš„æŠ€å·§ï¼ŒFLIPæ˜¯ <strong>F</strong>irst, <strong>L</strong>ast, <strong>I</strong>nvert, <strong>P</strong>layçš„ç®€ç§°ã€‚</p><h3 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h3><h4 id="First"><a href="#First" class="headerlink" title="First"></a>First</h4><p>å¯¹åº”åŠ¨ç”»çš„Starté˜¶æ®µï¼Œç”¨ <code>element.getBoundingClientRect()</code>è®°å½•åˆå§‹ä½ç½®ã€‚</p><h4 id="Last"><a href="#Last" class="headerlink" title="Last"></a>Last</h4><p>å¯¹åº”åŠ¨ç”»çš„Endé˜¶æ®µï¼Œå…ˆæ‰§è¡Œè§¦å‘layoutå˜åŠ¨çš„ä»£ç ï¼ŒåŒæ ·çš„ç”¨<code>element.getBoundingClientRect()</code>è®°å½•å…ƒç´ çš„ç»ˆæ­¢ä½ç½®ã€‚</p><h4 id="Invert"><a href="#Invert" class="headerlink" title="Invert"></a>Invert</h4><p>ç°åœ¨å…ƒç´ å¤„äºEndä½ç½®ï¼Œåˆ©ç”¨ <code>transform</code> åšä¸€ä¸ªé€†è¿ç®—ï¼Œè®©æ·»åŠ äº† <code>transform</code> çš„å…ƒç´ å›å½’åˆ°åˆå§‹ä½ç½®ã€‚</p><h4 id="Play"><a href="#Play" class="headerlink" title="Play"></a>Play</h4><p>çœŸæ­£éœ€è¦æ‰§è¡ŒåŠ¨ç”»æ—¶ï¼Œå°† <code>transform</code> ç½®ä¸º None</p><p>ä¸Šè¿°é˜¶æ®µå¯èƒ½æœ‰äººä¼šå›°æƒ‘ï¼Œ<code>getBoundingClientRect</code>ä¸æ˜¯ä¹Ÿä¼šè§¦å‘é‡æ’å—ï¼Ÿä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯æˆ‘ä»¬çš„é‡å¿ƒæ˜¯åœ¨åŠ¨ç”»é˜¶æ®µï¼Œè¦ä¿éšœçš„æ˜¯åŠ¨ç”»é˜¶æ®µçš„æµç•…ï¼Œæ›´ä½•å†µç”¨æˆ·åœ¨ç½‘é¡µä¸Šè¿›è¡Œäº¤äº’æ—¶ï¼Œæ¯”å¦‚clickï¼Œtouchï¼Œä»äº¤äº’ç»“æŸåˆ°æ„ŸçŸ¥åˆ°ç¨‹åºçš„ç›¸åº”å¤§çº¦éœ€è¦100msçš„ç”Ÿç†ååº”æ—¶é—´ã€‚æˆ‘ä»¬åœ¨ç”¨æˆ·äº¤äº’åè¦åš100mså†…å‡†å¤‡å¥½åŠ¨ç”»å°±å¥½äº†ï¼Œè¿™äº›åŠ¨ç”»å‡†å¤‡è®¡ç®—å°±æ˜¯getBoundingClientRect(æˆ–getComputedStyle)ç­‰çš„è®¡ç®—ã€‚</p><h3 id="å®è·µ"><a href="#å®è·µ" class="headerlink" title="å®è·µ"></a>å®è·µ</h3><p>ç°åœ¨å®ç°ä¸€ä¸ªç®€å•çš„ä»å·¦åˆ°å³çš„å¾ªç¯æ»šåŠ¨åŠ¨ç”»</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> playAnimate = <span class="function">(<span class="params">el</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!el) <span class="keyword">return</span>;</span><br><span class="line">    <span class="comment">// è®°å½•åˆå§‹ä½ç½®ï¼Œå¯¹åº” FLIPçš„FIRST</span></span><br><span class="line">    <span class="keyword">const</span> pos = tagWrapperRef.current?.getBoundingClientRect();</span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="attr">left</span>: initLeft &#125; = pos;</span><br><span class="line">   <span class="comment">// è®¾ç½®å…ƒç´ æ ·å¼ä¸ºåŠ¨ç”»ç»“æŸæ—¶çš„ç›®æ ‡ä½ç½®</span></span><br><span class="line">   tagWrapperRef.current.classList.add(<span class="string">'scroll-to-end'</span>);</span><br><span class="line">   <span class="comment">// è®°å½•ç»ˆæ­¢ä½ç½® å¯¹åº”FLIPçš„LAST</span></span><br><span class="line">    <span class="keyword">const</span> endPos = tagWrapperRef.current?.getBoundingClientRect();</span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="attr">left</span>: endLeft &#125; = endPos;</span><br><span class="line">    <span class="comment">// è®¡ç®—åˆå§‹ä½ç½®è·Ÿç»ˆæ­¢ä½ç½®çš„åå·®</span></span><br><span class="line">    <span class="keyword">const</span> deltaLeft = initLeft - endLeft;</span><br><span class="line">    tagWrapperRef.current.animate(</span><br><span class="line">      [</span><br><span class="line">      <span class="comment">// åŠ¨ç”»å¼€å§‹æ—¶ï¼Œåˆ©ç”¨ `transform` åšä¸€ä¸ªé€†è¿ç®—ï¼Œè®©æ·»åŠ äº† `transform` çš„å…ƒç´ å›å½’åˆ°åˆå§‹ä½ç½®ã€‚</span></span><br><span class="line">        &#123;</span><br><span class="line">          transform: <span class="string">`translate(<span class="subst">$&#123;deltaLeft&#125;</span>px,0)`</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          transform: <span class="string">'none'</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">      &#123;</span><br><span class="line">        duration: totalTime * <span class="number">1000</span>,</span><br><span class="line">        easing: <span class="string">'linear'</span>,</span><br><span class="line">        iterations: <span class="literal">Infinity</span>,</span><br><span class="line">      &#125;</span><br><span class="line">    );</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure> <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.scroll-to-end</span>&#123;</span><br><span class="line">  <span class="attribute">left</span>:<span class="number">100%</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p> é‡‡ç”¨<code>FLIP</code>çš„å½¢å¼æˆåŠŸçš„é¿å¼€äº†åŠ¨ç”»è¿‡ç¨‹ä¸­æ›´æ”¹<code>left</code>ã€‚<br>æˆ‘ä»¬æ³¨æ„åˆ°ï¼šæˆ‘ä»¬å¯ä»¥åœ¨åŠ¨ç”»å¼€å§‹å‰é¢„å…ˆç”¨APIè®¡ç®—å…ƒç´ åœ¨åŠ¨ç”»ç»ˆæ­¢æ—¶å€™çš„ä½ç½®ï¼Œåªè¦çŸ¥é“äº†ç»ˆæ€è·Ÿåˆå§‹çŠ¶æ€ï¼Œå°±èƒ½è¿…é€Ÿè®¡ç®—å‡ºè¦è¾¾åˆ°ç»ˆæ€è¯¥æ€ä¹ˆç§»åŠ¨ï¼Œç”±æ­¤é¿å¼€ä¸€äº›å¤æ‚çš„è®¡ç®—ï¼Œç”±æ­¤æˆ‘ä»¬ä¹Ÿå¯ä»¥å¾—å‡ºï¼š é™¤äº†ç”¨æ¥åšæ€§èƒ½ä¼˜åŒ–ä¹‹å¤–ï¼Œ<code>FLIP</code>ä¹Ÿèƒ½ç”¨äºç®€åŒ–æŸäº›åœºæ™¯ä¸‹åŠ¨ç”»çš„å®ç°è¿‡ç¨‹ï¼Œå¦‚ä»¥ä¸‹å‡ ä¸ªåœºæ™¯ï¼š</p><ul><li>å…ƒç´ å®¿ä¸»å…ƒç´ çš„å˜åŒ–ï¼Œæ¯”å¦‚å°†å…ƒç´ ä»Aç§»åŠ¨åˆ°B</li><li>å®¹å™¨å¤§å°å˜åŒ–</li><li>å›¾ç‰‡å±•å¼€å’Œæ”¶ç¼©æ•ˆæœ</li><li>é¡¹ç›®åˆ é™¤å’Œæ·»åŠ æ—¶å¡«å……ç©ºç™½åŒºåŸŸçš„æ•ˆæœ</li><li>ç½‘æ ¼é¡¹çš„é‡æ–°æ’åº<br>ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚ç¬¬ä¸‰ä¸ªåœºæ™¯ï¼Œå¦‚è‹¥æ·»åŠ æˆ–è€…åˆ é™¤çš„å¡ç‰‡çš„å¤§å°æ˜¯æœªçŸ¥çš„ï¼Œå¦‚æœç”¨å¸¸è§„çš„æ–¹å¼ç§»åŠ¨å…¶ä»–å¡ç‰‡å°†å˜å¾—å›°éš¾ï¼Œè€Œå¦‚æœä½¿ç”¨<code>FLIP</code>ï¼Œé—®é¢˜å°†è¿åˆƒè€Œè§£<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Last</span></span><br><span class="line"><span class="keyword">if</span> (updateType === <span class="number">0</span>) &#123; </span><br><span class="line"><span class="comment">// å¢åŠ å¡ç‰‡ </span></span><br><span class="line">newListData = <span class="keyword">this</span>.state.listData.slice(<span class="number">0</span>, activeIndex).concat(&#123; <span class="attr">index</span>: cardIndex++ </span><br><span class="line">&#125;, <span class="keyword">this</span>.state.listData.slice(activeIndex)) </span><br><span class="line">&#125; <span class="keyword">else</span> &#123; </span><br><span class="line"><span class="comment">// åˆ é™¤å¡ç‰‡ </span></span><br><span class="line">newListData = <span class="keyword">this</span>.state.listData.filter(<span class="function">(<span class="params">value, index</span>) =&gt;</span> index !== activeIndex)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Invert</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 0 å¢åŠ  1 åˆ é™¤</span></span><br><span class="line"><span class="keyword">const</span> updateIndex = updateType === <span class="number">0</span> ? <span class="number">1</span> : <span class="number">0</span></span><br><span class="line">activeList.forEach(<span class="function">(<span class="params">item, index</span>) =&gt;</span> &#123;</span><br><span class="line">  rect = item.getBoundingClientRect()</span><br><span class="line">  invertArr[index + updateIndex][<span class="number">0</span>] = invertArr[index + updateIndex][<span class="number">0</span>] - rect.left</span><br><span class="line">   invertArr[index + updateIndex][<span class="number">1</span>] = invertArr[index + updateIndex][<span class="number">1</span>] - rect.top</span><br><span class="line"> ...</span><br></pre></td></tr></table></figure></li></ul><h3 id="ä½¿ç”¨FLIPå½¢å¼éœ€è¦æ³¨æ„ä»€ä¹ˆ"><a href="#ä½¿ç”¨FLIPå½¢å¼éœ€è¦æ³¨æ„ä»€ä¹ˆ" class="headerlink" title="ä½¿ç”¨FLIPå½¢å¼éœ€è¦æ³¨æ„ä»€ä¹ˆ"></a>ä½¿ç”¨FLIPå½¢å¼éœ€è¦æ³¨æ„ä»€ä¹ˆ</h3><ul><li><code>FLIP</code>ä¸­çš„å‰ä¸‰ä¸ªé˜¶æ®µä¹Ÿå°±æ˜¯å‰æœŸçš„å‡†å¤‡å·¥ä½œéœ€è¦åœ¨<code>ç»˜åˆ¶</code>è¿™ä¸ªæ­¥éª¤ä¹‹å‰ï¼Œä¹Ÿå°±æ˜¯æ—¶é—´éœ€è¦å°½å¯èƒ½çš„æ§åˆ¶åœ¨ä¹‹å‰æåˆ°çš„100msä»¥å†…ï¼Œå¦åˆ™çš„è¯ æ¸²æŸ“çš„è¿‡ç¨‹ä¸­å¯èƒ½å‡ºç°é—ªçƒï¼Œä½†æ˜¯æˆ‘ä»¬æ€ä¹ˆæ‰èƒ½æŠ“ä½<code>ç»˜åˆ¶å‰</code>è¿™ä¸ªæ—¶æœºå‘¢ï¼Ÿæœ¬äººç”¨Reactæ¯”è¾ƒå¤šï¼Œä»¥Reactä¸ºä¾‹ï¼šç­”æ¡ˆæ˜¯<code>useLayoutEffect</code>ï¼Œå®ƒæ¥å—ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ä¼šåœ¨<code>dom</code>æ›´æ–°åã€é‡ç»˜ä¹‹å‰åŒæ­¥çš„æ‰§è¡Œ</li></ul><p>æ¯”å¦‚ï¼Œæˆ‘ä»¬å®ç°ä¸€ä¸ªç‚¹å‡»æ–¹å—äº’æ¢ä½ç½®çš„åŠ¨ç”»ï¼ˆè¯¦è§<a href="https://codepen.io/jlkiri/pen/oNjaMrK" target="_blank" rel="noopener">https://codepen.io/jlkiri/pen/oNjaMrK</a>)</p><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/82156349d1774cfb8622f88518d3018a~tplv-k3u1fbpfcp-watermark.image?" alt="pos.png"></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Flipper = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [ids, setIds] = React.useState([<span class="string">"square-1"</span>, <span class="string">"square-2"</span>]);</span><br><span class="line">  <span class="keyword">const</span> rects = React.useRef(<span class="keyword">new</span> <span class="built_in">Map</span>()).current;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> swap = <span class="function">(<span class="params">[a, b]</span>) =&gt;</span> [b, a];</span><br><span class="line"></span><br><span class="line">  React.useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> squares = <span class="built_in">document</span>.querySelectorAll(<span class="string">".square"</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Cache position and size once on initial render</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> square <span class="keyword">of</span> squares) &#123;</span><br><span class="line">      rects.set(square.id, square.getBoundingClientRect());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  React.useLayoutEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> squares = <span class="built_in">document</span>.querySelectorAll(<span class="string">".square"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> square <span class="keyword">of</span> squares) &#123;</span><br><span class="line">      <span class="comment">// Get previous size and position from cache</span></span><br><span class="line">      <span class="keyword">const</span> cachedRect = rects.get(square.id);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (cachedRect) &#123;</span><br><span class="line">        <span class="keyword">const</span> nextRect = square.getBoundingClientRect();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Invert</span></span><br><span class="line">        <span class="keyword">const</span> translateX = cachedRect.x - nextRect.x;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Cache the next size and position</span></span><br><span class="line">        rects.set(square.id, nextRect);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Play</span></span><br><span class="line">        square.animate(</span><br><span class="line">          [</span><br><span class="line">            &#123; <span class="attr">transform</span>: <span class="string">`translateX(<span class="subst">$&#123;translateX&#125;</span>px)`</span> &#125;,</span><br><span class="line">            &#123; <span class="attr">transform</span>: <span class="string">`translateX(0px)`</span> &#125;</span><br><span class="line">          ],</span><br><span class="line">          <span class="number">1000</span></span><br><span class="line">        );</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, ids);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">"container"</span>&gt;</span><br><span class="line">      &#123;ids.map(<span class="function">(<span class="params">id, i</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">          &lt;div id=&#123;id&#125; onClick=&#123;() =&gt; setIds(swap(ids))&#125; className=&#123;<span class="string">`square`</span>&#125;&gt;</span><br><span class="line">            &#123;id&#125;</span><br><span class="line">          &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        );</span></span><br><span class="line"><span class="regexp">      &#125;)&#125;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">Flipper</span> /&gt;</span>, document.querySelector("#root"));</span></span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šå¯ä»¥ç”¨å¦‚ä¸‹çš„æµç¨‹å›¾æ¦‚æ‹¬ï¼š<br><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/94a4646334764017bc71c1fc8085d93f~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"><br>è™½ç„¶<code>useEffect</code>æ€»æ˜¯åœ¨<code>useLayoutEffect</code>ä»¥åŠæµè§ˆå™¨ç»˜åˆ¶ä¹‹åæ‰§è¡Œï¼Œä½†æ˜¯æ³¨æ„åˆ°è¿™é‡Œæˆ‘ä»¬ä»…ä»…åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“ä¹‹åæ‰§è¡Œäº†ï¼Œè€Œè¿™é‡Œçš„<code>useLayoutEffect</code>åœ¨ä¹‹åçš„æ¯ä¸€æ¬¡æ¸²æŸ“ä¹‹åéƒ½ä¼šæ‰§è¡Œã€‚</p><ul><li>é¿å…å¤šæ¬¡è§¦å‘é‡æ’<br>å¯èƒ½ä¼šæœ‰çš„äººâ€œè¯»â€â€œå†™â€ä¸€èµ·è¿›è¡Œã€‚</li></ul><p>é”™è¯¯çš„åšæ³•ï¼š<br>å¾ªç¯éå†å…ƒç´ å¹¶ä½¿ç”¨ getBoundingClientRect è¯»å–å®ƒä»¬çš„ä½ç½®ï¼Œç„¶åç«‹å³ä½¿ç”¨ animate ä¸ºå®ƒä»¬è®¾ç½®åŠ¨ç”»ã€‚</p><p>æ­£ç¡®çš„åšæ³•ï¼š<br>æ‰¹é‡çš„è¯»å–ä¸å†™å…¥</p><h2 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h2><p><code>Invert</code>è¿™ä¸€æ­¥éª¤å¯èƒ½æœ‰äº›è®¸éº»çƒ¦ï¼Œä»Šå¹´5æœˆä»½ä½œè€…æä¾›äº†æ’ä»¶<br><a href="https://greensock.com/docs/v3/Plugins/Flip/" target="_blank" rel="noopener">Flip Plugin</a></p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://aerotwist.com/blog/flip-your-animations/" target="_blank" rel="noopener">FLIP Your Animations</a></li><li><a href="https://css-tricks.com/animating-layouts-with-the-flip-technique/" target="_blank" rel="noopener">Animating Layouts with the FLIP Technique</a></li><li><a href="https://github.com/fi3ework/blog/issues/9" target="_blank" rel="noopener">å‰ç«¯æ€§èƒ½ä¼˜åŒ–ä¹‹æµè§ˆå™¨æ¸²æŸ“ä¼˜åŒ– â€”â€” æ‰“é€ 60FPSé¡µé¢</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> css </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>a2hs debugè®°å½•</title>
      <link href="/ashley271017.github.io/2023/03/15/debug%E8%AE%B0%E5%BD%95/"/>
      <url>/ashley271017.github.io/2023/03/15/debug%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<h3 id="beforeInstallPromptäº‹ä»¶ä¸è§¦å‘"><a href="#beforeInstallPromptäº‹ä»¶ä¸è§¦å‘" class="headerlink" title="beforeInstallPromptäº‹ä»¶ä¸è§¦å‘"></a>beforeInstallPromptäº‹ä»¶ä¸è§¦å‘</h3><p>å¦‚æœé¡µé¢æ˜¯å¯å®‰è£…çš„è¯ï¼Œå°†åœ¨é¡µé¢åŠ è½½åä¸ä¹…è§¦å‘ã€‚</p><p>æ²¡è§¦å‘çš„åŸå› ï¼Ÿ</p><ul><li>PWA å¿…é¡»å°šæœªå®‰è£… ï¼ˆchrome://appsæŸ¥çœ‹å·²ç»å®‰è£…çš„åº”ç”¨ï¼‰</li></ul><!----><ul><li>æ»¡è¶³ç”¨æˆ·å‚ä¸å¯å‘å¼ï¼ˆä»¥å‰ï¼Œç”¨æˆ·å¿…é¡»ä¸åŸŸäº¤äº’è‡³å°‘ 30 ç§’ï¼Œè¿™ä¸å†æ˜¯è¦æ±‚ï¼‰ã€‚</li><li>æ‚¨çš„ Web åº”ç”¨ç¨‹åºå¿…é¡»åŒ…å« Web åº”ç”¨ç¨‹åºæ¸…å•ã€‚</li><li>æ‚¨çš„ Web åº”ç”¨ç¨‹åºå¿…é¡»é€šè¿‡å®‰å…¨çš„ HTTPS è¿æ¥æä¾›æœåŠ¡ã€‚(æˆ–è€…æ˜¯localhost)å¦‚æœè¯ä¹¦è¿‡æœŸäº†è¯ä¹¦æœ‰é—®é¢˜ä¹Ÿä¼šæœ‰é—®é¢˜</li></ul><p>è¿™é‡Œå¯ä»¥ç›´æ¥ç”¨<code>chrome://flags/#unsafely-treat-insecure-origin-as-secure</code>è®¾ç½®ä¸€ä¸‹ æ³¨æ„æœ¬åœ°éœ€è¦å¯httpæœåŠ¡ï¼Œå¦‚æœæ˜¯HTTPSä¼šä¸ç”Ÿæ•ˆï¼Œå¦‚æœæ˜¯ä¸ä»…ä»…åœ¨Chromeæµ‹è¯•ï¼Œæ¨è<code>webpack-mkcert</code>æœ¬åœ°å°±èƒ½å¯åŠ¨https è¯ä¹¦æœ‰æ•ˆ</p><ul><li>å·²ä½¿ç”¨ fetch äº‹ä»¶å¤„ç†ç¨‹åºæ³¨å†Œäº†ä¸€ä¸ªæœåŠ¡å·¥ä½œè€…ã€‚</li><li>manifest.jsonç¼–å†™æœ‰é—®é¢˜ï¼Œï¼ˆæ³¨æ„è¿™é‡Œä¹Ÿå¯ä»¥æ˜¯jsonåç¼€ï¼‰ å¦‚ä¸‹</li></ul><ol><li>start_urlæœ‰é—®é¢˜æˆ–è€…æ˜¯æ²¡è®¾ç½®scopeï¼Œå½“è®¾ç½®çš„æ˜¯ç›¸å¯¹è·¯å¾„çš„æ—¶å€™ï¼Œæ˜¯ç›¸å¯¹äºå½“å‰jsonæ–‡ä»¶æ‰€åœ¨çš„è·¯å¾„ï¼Œå¦‚æœJSONæ–‡ä»¶æ˜¯ä¸€ä¸ªå¤–é“¾æ–‡ä»¶çš„è¯ï¼Œè¿™é‡Œçš„start_urléœ€è¦æ˜¯ç»å¯¹è·¯å¾„ï¼ŒåŒæ—¶scope ä¹Ÿå¿…é¡»è®¾ç½®æˆç»å¯¹è·¯å¾„</li><li>iconsçš„srcæœ‰é—®é¢˜ï¼Œå›¾ç‰‡å¿…é¡»è·Ÿè®¾ç½®çš„sizesæ˜¯åŒä¸€å®½é«˜æ¯”ï¼Œæ­¤å¤–ä¼¼ä¹åªæ”¯æŒpng jpegæ ¼å¼</li><li>iconsçš„srcæ²¡è®¾ç½®type</li></ol><h3 id="æ€ä¹ˆdebug-ï¼Ÿ"><a href="#æ€ä¹ˆdebug-ï¼Ÿ" class="headerlink" title="æ€ä¹ˆdebug ï¼Ÿ"></a>æ€ä¹ˆdebug ï¼Ÿ</h3><ul><li>devtoolçš„lighthouseå¯ä»¥æ£€æµ‹ä½ çš„pwaå­˜åœ¨å“ªäº›é—®é¢˜ ä¸ºä»€ä¹ˆä¸ç”Ÿæ•ˆï¼Œä½†æ˜¯å¥½åƒä¸å‡†ç¡®</li><li>éªŒè¯è¯¥æµè§ˆå™¨æ˜¯å¦æ”¯æŒï¼Ÿ</li></ul><p><a href="https://fe-examples.github.io/pwa-examples/a2hs/" target="_blank" rel="noopener">demo</a>(<a href="https://sourcegraph.com/github.com/fe-examples/pwa-examples@master/-/blob/a2hs/index.js" target="_blank" rel="noopener">æºç </a>)</p><h3 id="æ€ä¹ˆåŠ¨æ€è®¾ç½®start-url"><a href="#æ€ä¹ˆåŠ¨æ€è®¾ç½®start-url" class="headerlink" title="æ€ä¹ˆåŠ¨æ€è®¾ç½®start_url?"></a>æ€ä¹ˆåŠ¨æ€è®¾ç½®start_url?</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> manifestJson <span class="keyword">from</span> <span class="string">'./manifests.json'</span>;</span><br><span class="line"> <span class="keyword">const</span> manifestContent = &#123;</span><br><span class="line">      ...manifestJson,</span><br><span class="line">      name,</span><br><span class="line">      start_url: <span class="built_in">window</span>.location.href,</span><br><span class="line">      scope: <span class="string">`<span class="subst">$&#123;<span class="built_in">window</span>.location.origin&#125;</span><span class="subst">$&#123;<span class="built_in">window</span>.location.pathname&#125;</span>`</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">const</span> imgType = cover.replace(<span class="regexp">/\?.*/</span>, <span class="string">''</span>).split(<span class="string">'.'</span>).slice(<span class="number">-1</span>)[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">const</span> &#123;icons&#125; = manifestContent;</span><br><span class="line">    icons[<span class="number">0</span>].src = cover;</span><br><span class="line">    icons[<span class="number">0</span>].type = <span class="string">`image/<span class="subst">$&#123;imgType&#125;</span>`</span>;</span><br><span class="line">    <span class="keyword">const</span> linkDom = <span class="built_in">document</span>.querySelector(<span class="string">'#manifest'</span>);</span><br><span class="line">    <span class="keyword">const</span> stringManifest = <span class="built_in">JSON</span>.stringify(manifestContent);</span><br><span class="line">    <span class="keyword">if</span> (linkDom) &#123;</span><br><span class="line">      linkDom.setAttribute(<span class="string">'href'</span>, <span class="string">'data:application/json;charset=utf-8,'</span> + <span class="built_in">encodeURIComponent</span>(stringManifest));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> link = <span class="built_in">document</span>.createElement(<span class="string">'link'</span>);</span><br><span class="line">      link.id = <span class="string">'manifest'</span>;</span><br><span class="line">      link.rel = <span class="string">'manifest'</span>;</span><br><span class="line">      link.setAttribute(<span class="string">'href'</span>, <span class="string">'data:application/json;charset=utf-8,'</span> + <span class="built_in">encodeURIComponent</span>(stringManifest));</span><br><span class="line">      <span class="built_in">document</span>.head.appendChild(link);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šæµ‹è¯•ç»“æœæ¥æºäºchrome, 360æµè§ˆå™¨, Safariä¸æ”¯æŒ<code>beforeInstallPrompt</code></p>]]></content>
      
      
      
        <tags>
            
            <tag> a2hs </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>gitlab ci  ä»å…¥é—¨åˆ°å®è·µ</title>
      <link href="/ashley271017.github.io/2023/03/02/%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%AE%9E%E8%B7%B5/"/>
      <url>/ashley271017.github.io/2023/03/02/%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%AE%9E%E8%B7%B5/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ã€Gitlab-CI-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#ä¸€ã€Gitlab-CI-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="ä¸€ã€Gitlab CI æ˜¯ä»€ä¹ˆï¼Ÿ"></a>ä¸€ã€Gitlab CI æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>ç°ä»£æŒç»­çš„è½¯ä»¶å¼€å‘å¯¼è‡´äº†å¼€å‘è€…éœ€è¦æŒç»­çš„build, test å’Œ deploy é‡å¤çš„ä»£ç æ›´æ”¹ï¼Œè¿™äº›é‡å¤çš„è¿‡ç¨‹éå¸¸çš„ç¹çï¼Œä½†æ˜¯å¯¹ä¿è¯ä»£ç æŒç»­æ›´æ–°è¿­ä»£æ¥è¯´åˆéå¸¸çš„é‡è¦ã€‚æ­¤æ—¶ä¾¿éœ€è¦ä¸€ç§éäººä¸ºæ‰‹åŠ¨çš„æ–¹æ³•æ¥å¸®åŠ©æˆ‘ä»¬è‡ªåŠ¨å®Œæˆè¿™äº›é‡å¤çš„å·¥ä½œã€‚<br>è¿™ä¸ªè‡ªåŠ¨å®Œæˆå·¥ä½œçš„ç†å¿µè¢«ç§°ä¸ºCI/CD. åœ¨è¿™é‡ŒGitlab CI/CDå°±æ˜¯Gitlabå®˜æ–¹å‘å¸ƒçš„ä¸€ç§è‡ªåŠ¨æµæ°´çº¿å¸®åŠ©å¼€å‘è€…å®Œæˆé‡å¤æ€§å·¥ä½œçš„ä¸€ä¸ªæœåŠ¡ã€‚</p><h2 id="äºŒã€å¦‚ä½•ä½¿ç”¨ï¼Ÿ"><a href="#äºŒã€å¦‚ä½•ä½¿ç”¨ï¼Ÿ" class="headerlink" title="äºŒã€å¦‚ä½•ä½¿ç”¨ï¼Ÿ"></a>äºŒã€å¦‚ä½•ä½¿ç”¨ï¼Ÿ</h2><h3 id="Gitlab-CIçš„ä½¿ç”¨ä¸»è¦éœ€è¦2å¤§æ­¥éª¤"><a href="#Gitlab-CIçš„ä½¿ç”¨ä¸»è¦éœ€è¦2å¤§æ­¥éª¤" class="headerlink" title="Gitlab CIçš„ä½¿ç”¨ä¸»è¦éœ€è¦2å¤§æ­¥éª¤"></a>Gitlab CIçš„ä½¿ç”¨ä¸»è¦éœ€è¦2å¤§æ­¥éª¤</h3><h4 id="æ­¥éª¤ä¸€ï¼šé…ç½®runner"><a href="#æ­¥éª¤ä¸€ï¼šé…ç½®runner" class="headerlink" title="æ­¥éª¤ä¸€ï¼šé…ç½®runner"></a>æ­¥éª¤ä¸€ï¼šé…ç½®runner</h4><p>æˆ‘ä»¬å¯ä»¥ç®€å•çš„æŠŠ<strong>Gitlab runnerç»™ç†è§£æˆ.gitlab-ci.yml æ–‡ä»¶å†…å®¹çš„*æ‰§è¡Œè€…ï¼Œ.gitlab-ci.yml å‘Šè¯‰äº†Gitlab runnerå»åšä»€ä¹ˆã€‚</strong><br>Gitlab runnerä¸æ˜¯ä¸€ä¸ªé…ç½®é¡¹ï¼Œå®ƒæ˜¯éœ€è¦ä¸“é—¨éƒ¨ç½²çš„ï¼Œæ¯”å¦‚ç”¨dockeréƒ¨ç½²ä¸€ä¸ªrunneré•œåƒåˆ°å¯ä»¥è¿æ¥å†…ç½‘çš„å®¹å™¨ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨å…¬å¸å†…é…å¥½çš„shared runners.</p><ul><li><p>ä½¿ç”¨shared runnerï¼š<br>æ— éœ€å¤šä½™æ“ä½œï¼Œè¯·ç¡®ä¿shared runneré€‰é¡¹è¢«enableäº†å³å¯ç›´æ¥ä½¿ç”¨å…¬å…±runnerã€‚ï¼ˆå¦‚ä¸‹ï¼‰<br><img src="https://mmbiz.qpic.cn/mmbiz_png/ndgH50E7pIoRXDjYFOUuibFpiaKhVqZicjibSgmib5mxkiceJzOQGQibWcOWusRnWJxJxpHuiawLMrxmrSrSugKzNF3ZQg/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1" alt="image"></p></li><li><p>è‡ªå·±é…ç½®runnerï¼š<br>éƒ¨ç½²Gitlab runnerå®˜æ–¹æ–‡æ¡£ï¼šRun GitLab Runner in a container | GitLab[1]</p></li></ul><p>å…³è”runneråˆ°gitlabå®˜æ–¹æ–‡æ¡£ï¼šRegistering runners | GitLab[2]</p><p><strong>A. å®‰è£…docker:</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ brew install --cask docker</span><br></pre></td></tr></table></figure><p><strong>B. å¯åŠ¨Gitlab runner container:</strong><br>èµ·ä¸€ä¸ªdocker containeræ¥æ‰§è¡ŒGitlab Runneré•œåƒ</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name gitlab-runner --restart always \</span><br><span class="line">   -v /Users/Shared/gitlab-runner/config:/etc/gitlab-runner \</span><br><span class="line">   -v /var/run/docker.sock:/var/run/docker.sock \</span><br><span class="line">   gitlab/gitlab-runner:latest</span><br></pre></td></tr></table></figure><p><strong>C. æ³¨å†Œrunneråˆ°Gitlab:</strong><br>åªç”¨dockerèµ·ä¸€ä¸ªgitlab runnerä¸èƒ½å°†æˆ‘ä»¬å½“å‰ä½¿ç”¨çš„gitlab repositoryå’Œä¸Šä¸€æ­¥åˆ›å»ºçš„runnerè¿›è¡Œå…³è”ã€‚åœ¨æ­¤éœ€è¦å°†å…¶è¿›è¡Œç›¸äº’å…³è”ï¼Œå°†runneræ³¨å†Œåˆ°æˆ‘ä»¬çš„gitlab repository<br><img src="https://mmbiz.qpic.cn/mmbiz_png/ndgH50E7pIoRXDjYFOUuibFpiaKhVqZicjibOluT9IR1O3uiciccrB2MRQ9hw9K8iaU31O1YVV3tibe0wDBEI7ojXqaBkw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1" alt="image"></p><p>ä½¿ç”¨ä¸Šå›¾å¾—åˆ°çš„URLå’Œtokenå»æ›¿æ¢ä¸‹é¢æŒ‡ä»¤çš„â€“urlå’Œâ€“registration-token</p><p>â€“tag-list ä¸ºå½“å‰runnerçš„æ ‡ç­¾ï¼Œåœ¨é…ç½®æµæ°´çº¿jobçš„æ—¶å€™ä½¿ç”¨ï¼Œåœ¨æ­¤å¯éšæ„é…ç½®ä¸åŒçš„æ ‡ç­¾å</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">docker run --rm -v /Users/Shared/gitlab-runner/config:/etc/gitlab-runner gitlab/gitlab-runner register \</span><br><span class="line"> --non-interactive \</span><br><span class="line"> --executor <span class="string">"docker"</span> \</span><br><span class="line"> --docker-image alpine:latest \</span><br><span class="line"> --url <span class="string">"https://gitlab.com/"</span> \</span><br><span class="line"> --registration-token <span class="string">"wc-Reg7qUpGRB4Lw3q9Y"</span> \</span><br><span class="line"> --description <span class="string">"gitlabâ€”cicd-runner"</span> \</span><br><span class="line"> --tag-list <span class="string">"yehanli,liyehan"</span> \</span><br><span class="line"> --run-untagged=<span class="string">"true"</span> \</span><br><span class="line"> --locked=<span class="string">"false"</span> \</span><br><span class="line"> --access-level=<span class="string">"not_protected"</span></span><br></pre></td></tr></table></figure><p>è‡³æ­¤ï¼ŒGitlab runnerå’Œé…ç½®å‡å·²æˆåŠŸï¼Œæ‰“å¼€setting/CICDé¡µé¢å¯ä»¥çœ‹åˆ°å¦‚ä¸‹æç¤ºï¼š<br><img src="https://mmbiz.qpic.cn/mmbiz_png/ndgH50E7pIoRXDjYFOUuibFpiaKhVqZicjibLAkviaQUfbFOUxiaF4rR8kyAuTZf9LhKzJX2dscgfAGFKuEc6Nf9bmEQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1" alt="image"></p><h4 id="æ­¥éª¤äºŒï¼šåˆ›å»º-gitlab-ci-ymlæ–‡ä»¶"><a href="#æ­¥éª¤äºŒï¼šåˆ›å»º-gitlab-ci-ymlæ–‡ä»¶" class="headerlink" title="æ­¥éª¤äºŒï¼šåˆ›å»º.gitlab-ci.ymlæ–‡ä»¶"></a>æ­¥éª¤äºŒï¼šåˆ›å»º.gitlab-ci.ymlæ–‡ä»¶</h4><p>åœ¨mono repoçš„æ ¹ç›®å½•åˆ›å»ºä¸€ä¸ªæ–‡ä»¶, å‘½åä¸º.gitlab-ci.yml, å¹¶å°†å…¶pushåˆ°masteråˆ†æ”¯ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git add .gitlab-ci.yml</span><br><span class="line">git commit -m <span class="string">"Add .gitlab-ci.yml"</span></span><br><span class="line">git push origin master</span><br></pre></td></tr></table></figure><p>åœ¨è¾ƒä½gitlabç‰ˆæœ¬(æ¯”å¦‚11.4)ï¼Œå¦‚æœåœ¨masterä¸»åˆ†æ”¯ä¸‹æ²¡æœ‰.gitlab-ci.ymlçš„è¯ï¼Œåœ¨Gitlabå·¦ä¾§çš„å¯¼èˆªæ ä¸ä¼šæœ‰Gitlab Runnerè¿™ä¸ªtabã€‚<br><img src="https://mmbiz.qpic.cn/mmbiz_png/ndgH50E7pIoRXDjYFOUuibFpiaKhVqZicjibur1E6Hsb7f3WkfodBiajO9cATicZlhBhczEU5wXVb5v10I5W5khK1klg/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1" alt="image"></p><p>åœ¨é¡¹ç›®çš„setting/CI/CD/General pipelinesä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰è®¾ç½®CIè®¾ç½®æ–‡ä»¶çš„è·¯å¾„ï¼Œé»˜è®¤å¦‚ä¸‹<br><img src="https://mmbiz.qpic.cn/mmbiz_png/ndgH50E7pIoRXDjYFOUuibFpiaKhVqZicjib8TEX9O87T4SWBhia6LV6KGiawSGdWSnlm5zbZy5zKLEiaYdmgN7PQS8ibA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1" alt="image"></p><h4 id="ä¸‰ã€å¦‚ä½•ç¼–å†™-gitlab-ci-ymlæ–‡ä»¶ï¼Ÿ"><a href="#ä¸‰ã€å¦‚ä½•ç¼–å†™-gitlab-ci-ymlæ–‡ä»¶ï¼Ÿ" class="headerlink" title="ä¸‰ã€å¦‚ä½•ç¼–å†™.gitlab-ci.ymlæ–‡ä»¶ï¼Ÿ"></a>ä¸‰ã€å¦‚ä½•ç¼–å†™.gitlab-ci.ymlæ–‡ä»¶ï¼Ÿ</h4><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬å…ˆæ¥ç†Ÿæ‚‰ä¸‹yamlçš„å¸¸è§å†™æ³•ï¼Œä»¥åŠå¯¹æ¯”ä¸‹å®ƒä¸jsonæœ‰ä»€ä¹ˆä¸åŒã€‚</p><p>Yaml Syntaxå†™æ³•è¯¦æƒ…å…·ä½“è¯·è§ =&gt; YAML Syntax â€’ Ansible Documentation[3]</p><p><strong>YAMLè¯­æ³•ï¼š</strong><br>æ•°ç»„å†™æ³•ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"array"</span>: [<span class="string">"red"</span>, <span class="string">"blue"</span>, <span class="string">"yellow"</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è½¬åŒ–ä¸ºyamlä¸º</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">array:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">red</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">blue</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">yellow</span></span><br></pre></td></tr></table></figure><p>å¯¹è±¡å†™æ³•ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"student1"</span>: &#123;</span><br><span class="line">    <span class="string">"name"</span>: <span class="string">"å°æ˜"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"array"</span>: [<span class="string">"red"</span>, <span class="string">"blue"</span>, <span class="string">"yellow"</span>],</span><br><span class="line">  <span class="string">"student2"</span>: &#123;</span><br><span class="line">    <span class="string">"name"</span>: <span class="string">"å°æ˜"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è½¬åŒ–ä¸ºyamlä¸º</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æˆ‘æ˜¯æ³¨é‡Š</span></span><br><span class="line"><span class="attr">student1:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">å°æ˜</span></span><br><span class="line"><span class="attr">array:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">red</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">blue</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">yellow</span></span><br><span class="line"><span class="attr">student2:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">å°æ˜</span></span><br></pre></td></tr></table></figure><p>yamlä¸­ä¸åƒjsoné‚£æ ·æ— æ³•æ³¨é‡Šï¼Œæˆ‘ä»¬å¯ä»¥ç”¨#è¿›è¡Œæ³¨é‡Š</p><h4 id="æµæ°´çº¿ç¯èŠ‚æ¢³ç†"><a href="#æµæ°´çº¿ç¯èŠ‚æ¢³ç†" class="headerlink" title="æµæ°´çº¿ç¯èŠ‚æ¢³ç†:"></a>æµæ°´çº¿ç¯èŠ‚æ¢³ç†:</h4><p>æµæ°´çº¿çš„æµç¨‹ï¼Œæ ¹æ®é…ç½®çš„.gitlab-ci.ymlæ–‡ä»¶å¯ä»¥åˆ†ä¸ºå¦‚ä¸‹å‡ ä¸ªç¯èŠ‚ï¼š</p><p>åœ¨å•ä¸ªçš„æµæ°´çº¿ä»»åŠ¡æ‰§è¡Œä¹‹å‰è¿›è¡Œé…ç½®<br>å®šä¹‰å•ä¸ªæµæ°´çº¿ä»»åŠ¡(job)ï¼Œå¹¶å¯¹æ­¤ä»»åŠ¡è¿›è¡Œé’ˆå¯¹é…ç½®</p><p>å•ä¸ªæµæ°´çº¿ä»»åŠ¡çš„å½¢å¼å¯ä»¥å‚è€ƒå¦‚ä¸‹ç¤ºä¾‹ï¼Œå…·ä½“å­—æ®µé‡Šä¹‰å¯ä»¥æš‚æ—¶å¿½ç•¥ï¼Œä¼šåœ¨ä¹‹åè¯¦è§£ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿™ä¸ªmy_jobçš„ä»»åŠ¡åæ˜¯å¯ä»¥è‡ªå®šä¹‰èµ·çš„</span></span><br><span class="line"><span class="attr">my_job:</span></span><br><span class="line"><span class="attr">  only:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">master</span>    </span><br><span class="line"><span class="attr">  tags:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">yehanli</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">echo</span> <span class="string">'job ========= å®Œæˆ'</span></span><br><span class="line"><span class="attr">  stage:</span> <span class="string">build</span></span><br><span class="line"><span class="attr">  retry:</span> <span class="number">2</span></span><br></pre></td></tr></table></figure><h4 id="Gitlab-CI-å…³é”®å­—ï¼š"><a href="#Gitlab-CI-å…³é”®å­—ï¼š" class="headerlink" title="Gitlab-CI å…³é”®å­—ï¼š"></a>Gitlab-CI å…³é”®å­—ï¼š</h4><p>Gitlab CIçš„å…³é”®å­—æœ‰å¾ˆå¤šï¼Œä½†å®é™…å¸¸ç”¨çš„åªæœ‰è¾ƒå°ä¸€éƒ¨åˆ†ã€‚åœ¨æ­¤éƒ¨åˆ†ä¼šå¯¹å¸¸ç”¨å…³é”®å­—è¿›è¡Œè¯¦è§£ã€‚</p><ul><li><p>script<br>éœ€è¦è¢«è¿è¡Œçš„è„šæœ¬ã€‚ä»¥æ•°ç»„å½¢å¼é…ç½®ã€‚</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">pipeline_job:</span></span><br><span class="line">  <span class="string">......</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">cd</span> <span class="string">&lt;æ–‡ä»¶å¤¹ç›®å½•è·¯å¾„&gt;</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">npm</span> <span class="string">install</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">npm</span> <span class="string">build</span></span><br><span class="line">  <span class="string">......</span></span><br></pre></td></tr></table></figure></li><li><p>before_script<br>åœ¨æ‰€æœ‰çš„æµæ°´çº¿ä»»åŠ¡æ‰§è¡Œä¹‹å‰éœ€è¦æ‰§è¡Œçš„è„šæœ¬ï¼Œæˆ–è€…å•ä¸ªæµæ°´çº¿ä»»åŠ¡ä¸­çš„scriptæ‰§è¡Œä¹‹å‰æ‰§è¡ŒæŸäº›scrip</p></li><li><p>variableså˜é‡<br>åœ¨Gitlab-CIä¸­ï¼Œå˜é‡å¤§è‡´å¯åˆ†ä¸ºä¸‰ç±»ï¼š</p><ul><li><p>Gitlabç»™æˆ‘ä»¬é¢„å…ˆå®šä¹‰çš„å˜é‡ï¼Œæ¯”å¦‚CI_COMMIT_BRANCH.</p></li><li><p>Setting =&gt; Gitlab CI/CD =&gt; variablesä¸­å®šä¹‰çš„å˜é‡<br><img src="https://mmbiz.qpic.cn/mmbiz_png/ndgH50E7pIoRXDjYFOUuibFpiaKhVqZicjibX3IMZFddiboM0vk3libTHSBpLD5iaOqia6ibiavqrqs19NDQIPp967AvYKEg/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1" alt="image"></p></li><li><p>åœ¨.gitlab-ci.ymlä¸­å®šä¹‰çš„å˜é‡(å¦‚ä¸‹ç¤ºä¾‹)</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">variables:</span></span><br><span class="line"><span class="attr">  TEST_VAR:</span> <span class="string">"All jobs can use this variable's value"</span></span><br><span class="line"></span><br><span class="line"><span class="attr">job1:</span></span><br><span class="line"><span class="attr">  variables:</span></span><br><span class="line"><span class="attr">    TEST_VAR_JOB:</span> <span class="string">"Only job1 can use this variable's value"</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">echo</span> <span class="string">"$TEST_VAR"</span></span><br><span class="line">  <span class="string">......</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>image<br>CIæµæ°´çº¿è¿è¡Œç¯å¢ƒçš„dockeré•œåƒ(ä»»ä½•ç›¸å…³çš„ä»£ç è¿è¡Œç¯å¢ƒé•œåƒçš†å¯),æ¯”è¾ƒå¸¸ç”¨çš„æœ‰ï¼šnode, python, java, etcâ€¦</p></li><li><p>stages<br>Gitlab CIå…è®¸æˆ‘ä»¬è¿›è¡Œè‡ªå®šä¹‰çš„æµæ°´çº¿é˜¶æ®µé…ç½®ï¼Œæˆ‘ä»¬å¯ä»¥å°†è‡ªå·±çš„æµæ°´çº¿è‡ªæˆ‘åˆ’åˆ†ä¸ºè‹¥å¹²stagesï¼Œç„¶ååœ¨ä¸åŒçš„stageæ¥åšä¸åŒçš„äº‹ã€‚ï¼ˆç¨åä¼šæœ‰ç¤ºä¾‹ï¼‰(å¯¹åº”gitlabä¸Šçš„é‚£ä¸€æ’åœ†åœˆåœˆ)<br>stagesä¼šä¾æ¬¡æ‰§è¡Œï¼Œå¦‚æœå‰ä¸€ä¸ªstageçš„ä»»åŠ¡æ²¡æœ‰è¿è¡Œå®Œï¼Œåé¢çš„stageä¸ä¼šè¢«è§¦å‘ã€‚</p></li></ul><p>ä¸€æ—¦æœ‰ä¸€ä¸ªstageä¸­çš„ä»»åŠ¡failæ‰äº†ï¼Œä¸‹ä¸€ä¸ªstageçš„ä»»åŠ¡ä¾¿ä¸ä¼šæ‰§è¡Œã€‚å¦‚æœå½“å‰stageå®šä¹‰äº†å¤šä¸ªä»»åŠ¡ï¼Œé‚£ä¹ˆå…¶ä¸­ä¸€ä¸ªä»»åŠ¡å¤±è´¥ï¼Œå¦å¤–ä¸€ä¸ªä»»åŠ¡è¿˜æ˜¯ä¼šè¢«ç»§ç»­æ‰§è¡Œã€‚<br>ä»¥ä¸‹ä¸ºè‡ªå®šä¹‰çš„stagesï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">stages:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">first_stage</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">second_stage</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">third_stage</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">fourth_stage</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">fifth_stage</span></span><br></pre></td></tr></table></figure><p>å¦‚æœæ²¡æœ‰è‡ªå®šä¹‰stagesï¼Œé‚£ä¹ˆé»˜è®¤çš„stagesä¸º<code>.pre =&gt; build =&gt; test =&gt; deploy =&gt; .post</code>(è‡ªå®šä¹‰stagesä¼šé‡å†™é™¤äº†.pre, .postä¹‹å¤–æ‰€æœ‰çš„é»˜è®¤stages)</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">stages:</span> </span><br><span class="line"><span class="bullet">  -</span> <span class="string">.pre</span> <span class="comment"># æ‰§è¡Œåœ¨æ‰€æœ‰çš„stagesä¹‹å‰</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">build</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">test</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">deploy</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">.post</span> <span class="comment"># æ‰§è¡Œåœ¨æ‰€æœ‰çš„stagesä¹‹å</span></span><br></pre></td></tr></table></figure><ul><li><p>stage<br>stageä¸ºstagesçš„ä¸€ä¸ªå­é¡¹ï¼Œåœ¨æˆ‘ä»¬è‡ªå®šä¹‰å•ä¸ªæµæ°´çº¿ä»»åŠ¡æ—¶å¯ä»¥é…ç½®</p></li><li><p>cache:<br>ç¼“å­˜å¤šä¸ªæµæ°´çº¿ä»»åŠ¡ä¹‹é—´å…±ç”¨çš„æ–‡ä»¶ï¼Œç›®å½•ï¼Œ etcâ€¦</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">cache:</span></span><br><span class="line"><span class="attr">  key:</span> <span class="string">cache-node-modules</span></span><br><span class="line">  <span class="comment"># åœ¨è¿™é‡Œå†™å‡ºéœ€è¦ç¼“å­˜çš„æ–‡ä»¶çš„è·¯å¾„ï¼Œåœ¨æ­¤ä¸ºnode_modules</span></span><br><span class="line"><span class="attr">  paths:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">node_modules</span></span><br></pre></td></tr></table></figure></li><li><p>retry:<br>ä¸€ä¸ªjobå¯ä»¥è¢«é‡æ–°æ‰§è¡Œçš„æœ€å¤§æ•°é‡ã€‚å¿…é¡»æ˜¯ä¸ªæ­£æ•´æ•°, 0-2, 2ä¸ºæœ€å¤§å€¼</p><ul><li>whenå¯è®¾ç½®åœ¨ç‰¹å®šå¤±è´¥åŸå› çš„æƒ…å†µä¸‹æ‰§è¡Œ<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">job:</span></span><br><span class="line"><span class="attr">  script:</span> <span class="string">rspec</span></span><br><span class="line"><span class="attr">  retry:</span></span><br><span class="line"><span class="attr">    max:</span> <span class="number">2</span></span><br><span class="line"><span class="attr">    when:</span> <span class="string">runner_system_failure</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>only &amp; except</p><ul><li>only: è®¾ç½®æµæ°´çº¿ä»»åŠ¡æ‰§è¡Œæ—¶æœº</li><li>except: è®¾ç½®æµæ°´çº¿ä»»åŠ¡ä¸æ‰§è¡Œæ—¶æœº<br>å¯é…ç½®é€‰é¡¹ï¼ˆå¸¸ç”¨çš„å‡ ä¸ªï¼‰ï¼š<br>pushesï¼š    git pushæ—¶è§¦å‘ï¼Œé€‚ç”¨äºæ‰€æœ‰åˆ†æ”¯<br>merge_requestsï¼š    MRè¢«åˆ›å»ºæ—¶è§¦å‘ï¼Œé€‚ç”¨äºæ‰€æœ‰åˆ†æ”¯<br>webï¼š    æ‰‹åŠ¨åœ¨Gitlab Runner/pipelineé‡Œé¢ç‚¹å‡»run pipelineæ—¶è§¦å‘</li></ul></li></ul><p>é…ç½®branchåç§°æ¥è§„å®šè§¦å‘ä»»åŠ¡çš„åˆ†æ”¯(å¦‚ä¸‹)</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">myjob:</span></span><br><span class="line"><span class="attr">  only:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">master</span></span><br><span class="line"><span class="comment"># ä»¥ä¸Šå†™æ³•ç­‰åŒäº</span></span><br><span class="line"><span class="attr">myjob:</span></span><br><span class="line"><span class="attr">  only:</span></span><br><span class="line"><span class="attr">    variables:</span></span><br><span class="line">    <span class="comment"># $CI_COMMIT_REF_NAMEæ˜¯ä¸€ä¸ªgitlabçš„é¢„è®¾å˜é‡ï¼Œä»£è¡¨å½“å‰commitç»™å“ªä¸ªbranchä¸Šäº†</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">$CI_COMMIT_REF_NAME</span> <span class="string">==</span> <span class="string">"master"</span></span><br></pre></td></tr></table></figure><ul><li>rules:if<br>æ­¤å­—æ®µå¯ä»¥åœ¨å•ä¸ªæµæ°´çº¿jobæˆ–è€…workflowå­—æ®µä¸‹è¿›è¡Œé…ç½®ã€‚</li></ul><p>ruleså…³é”®è¯ä¸‹å¯ä»¥è¿›è¡Œifè¯­å¥é…ç½®ï¼Œå¦‚æœifæ»¡è¶³çš„è¯å¯æ‰§è¡ŒæŸäº›è‡ªå®šä¹‰é…ç½®</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rules:</span></span><br><span class="line"><span class="attr">  - if:</span> <span class="string">$CI_COMMIT_REF_NAME</span> <span class="string">=~</span> <span class="string">/feature/</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„: only &amp; exceptå’Œrules:iféƒ½æ˜¯ç”¨æ¥å†³å®šå•ä¸ªjobæ‰§è¡Œæ—¶æœºçš„ï¼Œåœ¨é…ç½®æ—¶åªèƒ½å­˜åœ¨ä¸€ä¸ªï¼Œå¦åˆ™ä¼šæŠ¥é”™</p><ul><li>workflow<br>éœ€è¦å’Œrulesé…åˆç”¨æ¥æ§åˆ¶æ•´ä¸ªpipelineçš„è¡Œä¸ºï¼Œæ¯”å¦‚æ•´ä¸ªæµæ°´çº¿æ‰§è¡Œä¸å¦ã€‚æ•´ä¸ªæµæ°´çº¿æ­£å¸¸è¿è¡Œçš„å‰ææ˜¯å…¶rulesé…ç½®ä¸­çš„ifè¯­å¥è‡³å°‘éœ€è¦è§¦å‘ä¸€ä¸ª.</li></ul><p>åœ¨å„ä¸ªæµæ°´çº¿ä»»åŠ¡çš„å¤–å±‚è¿›è¡Œé…ç½®</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">variables:</span></span><br><span class="line"><span class="attr">  IS_FEATURE:</span> <span class="string">"false"</span></span><br><span class="line"><span class="attr">workflow:</span></span><br><span class="line"><span class="attr">  rules:</span></span><br><span class="line"><span class="attr">    - if:</span> <span class="string">$CI_COMMIT_REF_NAME</span> <span class="string">=~</span> <span class="string">/feature/</span></span><br><span class="line"><span class="attr">      variables:</span></span><br><span class="line"><span class="attr">        IS_FEATURE:</span> <span class="string">"true"</span></span><br><span class="line"><span class="attr">    - when:</span> <span class="string">always</span> <span class="comment"># Run the pipeline in other cases</span></span><br></pre></td></tr></table></figure><ul><li>when<br>è¿™ä¸ªå…³é”®å­—å’Œstageéœ€è¦é…åˆä½¿ç”¨ã€‚å¦‚æœä¸€ä¸ªstage failæ‰äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬åº”è¯¥æœŸå¾…ä¸‹ä¸ªstageæ€ä¹ˆåŠå‘¢ï¼Ÿ</li></ul><p>(When to run a job?)</p><p>on_success(default): æ‰€æœ‰ä¹‹å‰stageçš„ä»»åŠ¡éƒ½æ‰§è¡ŒæˆåŠŸäº†æ‰æ‰§è¡Œå½“å‰stageçš„ä»»åŠ¡ï¼Œæˆ–è€…ä¹‹å‰failçš„ä»»åŠ¡æœ‰é…ç½®äº†allow_failure: true<br>on_failure ï¼šåªæœ‰åœ¨ä¹‹å‰çš„æµæ°´çº¿ä»»åŠ¡æœ‰è‡³å°‘ä¸€æ¬¡çš„failä¹‹ä¸‹æ‰æ‰§è¡Œå½“å‰ä»»åŠ¡ã€‚<br>alwaysï¼šæ— è®ºä¹‹å‰çš„stageçš„æµæ°´çº¿çš„ä»»åŠ¡çŠ¶æ€å¦‚ä½•ï¼Œå½“å‰çš„ä»»åŠ¡éƒ½ä¼šè§¦å‘ã€‚<br>neverï¼šä¸è¿è¡Œå½“å‰ä»»åŠ¡<br>manualï¼šæµæ°´çº¿æ‰‹åŠ¨è§¦å‘,ç‚¹å‡»playï¼Œå¦‚ä¸‹å›¾</p><ul><li>tags<br>è¿™ä¸ªæ˜¯è®¾å®šGitlab åœ¨æ‰§è¡Œè„šæœ¬æ—¶ä½¿ç”¨å“ªä¸ªrunner</li></ul><p><strong>æ³¨æ„äº‹é¡¹:</strong><br>é…ç½®æ—¶æœ‰äº›å…³é”®å­—æ¯”å¦‚workflowï¼Œrulesä»€ä¹ˆçš„ä¼šæ˜¾ç¤ºæŠ¥é”™ XXX config conatins unknown keys.</p><p>è¿™ä¸ªæ˜¯å› ä¸ºå…¬å¸çš„Gitlabç‰ˆæœ¬è¾ƒæ—§ï¼ŒGitlab 12.5ä¹‹åæ‰æ”¯æŒè¿™äº›é…ç½®ã€‚</p><h3 id="å®è·µ"><a href="#å®è·µ" class="headerlink" title="å®è·µ"></a>å®è·µ</h3><p>é¡¹ç›®èƒŒæ™¯ï¼šå­é¡¹ç›®ï¼Œä¾èµ–äº360kuaiä»“åº“ï¼Œæ¯æ¬¡ç¼–è¯‘éœ€è¦æ‹‰å–è¯¥ä»“åº“ä»£ç ç„¶åè¿›è¡Œç¼–è¯‘ï¼Œä¹‹åå°†æ‰“åŒ…åçš„æ–‡ä»¶cpåˆ°360kuaiçš„publicç›®å½•ä¸‹å¯¹åº”çš„è¯¥ä»“åº“çš„æ‰“åŒ…æ–‡ä»¶ç›®å½•</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">stages:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">compile</span></span><br><span class="line"></span><br><span class="line"><span class="attr">image:</span> <span class="string">xxx/node-git:0.0.1</span></span><br><span class="line"></span><br><span class="line"><span class="attr">variables:</span></span><br><span class="line">  <span class="comment"># GIT_SUBMODULE_STRATEGY: normal</span></span><br><span class="line"><span class="attr">  NPM_CONFIG_CACHE:</span> <span class="string">'$CI_PROJECT_DIR/.npm'</span></span><br><span class="line"></span><br><span class="line"><span class="attr">cache:</span></span><br><span class="line"><span class="attr">  key:</span></span><br><span class="line"><span class="attr">    files:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">package-lock.json</span></span><br><span class="line"><span class="attr">  paths:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">$&#123;NPM_CONFIG_CACHE&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">compile:</span></span><br><span class="line"><span class="attr">  stage:</span> <span class="string">compile</span></span><br><span class="line"><span class="attr">  only:</span></span><br><span class="line"><span class="attr">    refs:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">merge_requests</span></span><br><span class="line"><span class="attr">    variables:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">$TARGET_BRANCH_NAME</span> <span class="string">==</span> <span class="string">"master"</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">ls</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">rm</span> <span class="bullet">-rf</span> <span class="number">360</span><span class="string">kuai</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">git</span> <span class="string">submodule</span> <span class="string">update</span> <span class="bullet">--init</span> <span class="bullet">--recursive</span> <span class="bullet">--remote</span> <span class="bullet">--depth=1</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">npm</span> <span class="string">ci</span> <span class="bullet">--prefer-offline</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">npm</span> <span class="string">run</span> <span class="string">compile</span></span><br><span class="line"><span class="attr">  after_script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">ls</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">rm</span> <span class="bullet">-rf</span> <span class="number">360</span><span class="string">kuai</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">git</span> <span class="string">clone</span> <span class="bullet">-b</span> <span class="string">xxx/360kuai.git</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">git</span> <span class="string">config</span> <span class="bullet">--global</span> <span class="string">user.email</span> <span class="string">"xxx"</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">git</span> <span class="string">config</span> <span class="bullet">--global</span> <span class="string">user.name</span> <span class="string">"xxx"</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">cd</span> <span class="number">360</span><span class="string">kuai</span></span><br><span class="line">    <span class="comment"># - git checkout master</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">cp</span> <span class="bullet">-r</span> <span class="string">../public/static/css/supmodule</span> <span class="string">public/static/css</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">cp</span> <span class="bullet">-r</span> <span class="string">../public/static/js/supmodule</span> <span class="string">public/static/js</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">cp</span> <span class="bullet">-r</span> <span class="string">../public/static/img/supmodule</span> <span class="string">public/static/img</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">git</span> <span class="string">status</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">git</span> <span class="string">add</span> <span class="string">.</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">git</span> <span class="string">commit</span> <span class="bullet">--author="xxx</span> <span class="string">&lt;xxx@360&gt;"</span> <span class="bullet">-m</span> <span class="string">"æ›´æ–°"</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">git</span> <span class="string">log</span> <span class="bullet">-1</span></span><br><span class="line">    <span class="comment"># - git push</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> cicd </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>webpackæ‰“åŒ…äº§ç‰©ä¼˜åŒ–</title>
      <link href="/ashley271017.github.io/2023/02/15/webpack%E6%89%93%E5%8C%85%E4%BA%A7%E7%89%A9%E4%BC%98%E5%8C%96/"/>
      <url>/ashley271017.github.io/2023/02/15/webpack%E6%89%93%E5%8C%85%E4%BA%A7%E7%89%A9%E4%BC%98%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<ul><li>ä½“ç§¯æ›´å°</li><li>åˆç†åˆ†åŒ…ï¼Œä¸é‡å¤åŠ è½½</li><li>åŠ è½½é€Ÿåº¦æ›´å¿«</li></ul><h3 id="å‡å°‘ä½“ç§¯"><a href="#å‡å°‘ä½“ç§¯" class="headerlink" title="å‡å°‘ä½“ç§¯"></a>å‡å°‘ä½“ç§¯</h3><p>å¼€å¯tree shaking</p><h4 id="ä»€ä¹ˆæ˜¯tree-shakingï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯tree-shakingï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯tree shakingï¼Ÿ"></a>ä»€ä¹ˆæ˜¯tree shakingï¼Ÿ</h4><p>ä»–ä¼šåœ¨æ‰“åŒ…è¿‡ç¨‹ä¸­é€šè¿‡é™æ€åˆ†ææ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»ä»è€Œç¡®å®šå“ªäº›æ¨¡å—å¯¼å‡º/å¼•å…¥çš„å€¼æ²¡æœ‰è¢«ä½¿ç”¨ï¼Œä»è€Œå°†å®ƒåˆ é™¤ï¼ŒWebpack 4ç”Ÿäº§ç¯å¢ƒå·²ç»é»˜è®¤å¼€å¯äº†è¿™ä¸ªåŠŸèƒ½ï¼Œæ— éœ€å…¶ä»–é…ç½®ã€‚</p><h4 id="å‡å°‘Babelç¼–è¯‘åçš„äº§ç‰©ä½“ç§¯"><a href="#å‡å°‘Babelç¼–è¯‘åçš„äº§ç‰©ä½“ç§¯" class="headerlink" title="å‡å°‘Babelç¼–è¯‘åçš„äº§ç‰©ä½“ç§¯"></a>å‡å°‘Babelç¼–è¯‘åçš„äº§ç‰©ä½“ç§¯</h4><p>Babel ä¸ºç¼–è¯‘çš„æ¯ä¸ªæ–‡ä»¶éƒ½æ’å…¥äº†è¾…åŠ©ä»£ç ï¼Œä½¿ä»£ç ä½“ç§¯è¿‡å¤§ï¼Œä½ å¯ä»¥å°†è¿™äº›è¾…åŠ©ä»£ç ä½œä¸ºä¸€ä¸ªç‹¬ç«‹æ¨¡å—ï¼Œæ¥é¿å…é‡å¤å¼•å…¥ã€‚<br><code>@babel/plugin-transform-runtime</code>çš„ä½œç”¨: ç¦ç”¨äº† Babel è‡ªåŠ¨å¯¹æ¯ä¸ªæ–‡ä»¶çš„ runtime æ³¨å…¥ï¼Œè€Œæ˜¯å¼•å…¥ <code>@babel/plugin-transform-runtime</code> å¹¶ä¸”ä½¿æ‰€æœ‰è¾…åŠ©ä»£ç ä»è¿™é‡Œå¼•ç”¨</p><h4 id="æŒ‰éœ€åŠ è½½"><a href="#æŒ‰éœ€åŠ è½½" class="headerlink" title="æŒ‰éœ€åŠ è½½"></a>æŒ‰éœ€åŠ è½½</h4><p>ä½¿ç”¨importæ–¹å¼æ‡’åŠ è½½ç»„ä»¶</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ç›´æ¥ä½¿ç”¨importå¯¼å…¥å³å¯ï¼Œè¿™æ ·åŠ è½½çš„æ¨¡å—ï¼Œç›¸å½“äºä¸€ä¸ªç‹¬ç«‹çš„chunkå­˜åœ¨</span></span><br><span class="line">  <span class="keyword">import</span>(<span class="string">'./common/dynamicData.js'</span>).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res.default.msg);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;, <span class="number">1000</span>)</span><br></pre></td></tr></table></figure><h4 id="æå–å…¬å…±ä»£ç "><a href="#æå–å…¬å…±ä»£ç " class="headerlink" title="æå–å…¬å…±ä»£ç "></a>æå–å…¬å…±ä»£ç </h4><p>åœ¨<code>optimization</code>ä¸­é…ç½®<code>splitChunks</code>å±æ€§ï¼Œè®¾ç½®<code>cacheGroups</code>åˆ†ç»„ï¼Œä¸€èˆ¬åˆ†ä¸ºä¸¤ä¸ªç»„ï¼š<code>verdors</code>ï¼ˆç”¨äºæå–ç¬¬ä¸‰æ–¹åº“ï¼‰å’Œ<code>common</code>ï¼ˆç”¨äºæå–è‡ªå®šä¹‰çš„å…¬å…±æ¨¡å—ï¼‰<br>é’ˆå¯¹ç¬¬ä¸‰æ–¹åº“ï¼Œå‡ ä¹ä¸ä¼šæ”¹å˜ï¼Œæå–å‡ºæ¥åï¼Œæ”¹åŠ¨ä¸šåŠ¡ä»£ç ä¸ä¼šåŠ¨åˆ°ç¬¬ä¸‰æ–¹åº“çš„æ‰“åŒ…æ–‡ä»¶ï¼Œè¿™æ ·ï¼Œå°±èƒ½å‘½ä¸­ç¼“å­˜ï¼ŒåŠ å¿«åŠ è½½é€Ÿåº¦<br>é’ˆå¯¹å…¬å…±æ¨¡å—ï¼Œåªç”¨åŠ è½½ä¸€æ¬¡ï¼Œå°±å¯ä»¥åœ¨å¤šä¸ªæ¨¡å—ä¸­ä½¿ç”¨</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.prod.js</span></span><br><span class="line">  optimization: &#123;</span><br><span class="line">    splitChunks: &#123;</span><br><span class="line">      chunks: <span class="string">'all'</span>, <span class="comment">// è¡¨ç¤ºè¦åˆ†å‰²çš„chunkç±»å‹ï¼šinitialåªå¤„ç†åŒæ­¥çš„; asyncåªå¤„ç†å¼‚æ­¥çš„ï¼›alléƒ½å¤„ç†</span></span><br><span class="line">      <span class="comment">// ç¼“å­˜åˆ†ç»„</span></span><br><span class="line">      cacheGroups: &#123;</span><br><span class="line">        <span class="comment">// ç¬¬ä¸‰æ–¹æ¨¡å—</span></span><br><span class="line">        verdors: &#123;</span><br><span class="line">          name: <span class="string">'verdor'</span>, <span class="comment">// chunkåç§°</span></span><br><span class="line">          test: <span class="regexp">/node_modules/</span>,  <span class="comment">// è®¾ç½®å‘½ä¸­ç›®å½•è§„åˆ™</span></span><br><span class="line">          priority: <span class="number">1</span>, <span class="comment">// ä¼˜å…ˆçº§ï¼Œæ•°å€¼è¶Šå¤§ï¼Œä¼˜å…ˆçº§è¶Šé«˜</span></span><br><span class="line">          minSize: <span class="number">0</span>, <span class="comment">// å°äºè¿™ä¸ªå¤§å°çš„æ–‡ä»¶ï¼Œä¸åˆ†å‰²</span></span><br><span class="line">          minChunks: <span class="number">1</span> <span class="comment">// æœ€å°‘å¤ç”¨å‡ æ¬¡ï¼Œè¿™é‡Œæ„æ€æ˜¯åªè¦ç”¨è¿‡ä¸€æ¬¡å°±åˆ†å‰²å‡ºæ¥</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// å…¬å…±æ¨¡å—</span></span><br><span class="line">        common: &#123;</span><br><span class="line">          name: <span class="string">'common'</span>,</span><br><span class="line">          minChunks: <span class="number">2</span>,</span><br><span class="line">          priority: <span class="number">0</span>,</span><br><span class="line">          minSize: <span class="number">0</span>,</span><br><span class="line">          minChunks: <span class="number">2</span>  <span class="comment">// åªè¦å¼•ç”¨è¿‡2æ¬¡ï¼Œå°±åˆ†å‰²æˆå…¬å…±ä»£ç </span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h4 id="å¿½ç•¥æŸäº›åº“ä¸éœ€è¦çš„æ¨¡å—"><a href="#å¿½ç•¥æŸäº›åº“ä¸éœ€è¦çš„æ¨¡å—" class="headerlink" title="å¿½ç•¥æŸäº›åº“ä¸éœ€è¦çš„æ¨¡å—"></a>å¿½ç•¥æŸäº›åº“ä¸éœ€è¦çš„æ¨¡å—</h4><p>æ¯”å¦‚å›½é™…åŒ–é¡¹ç›®æ‰€æœ‰åœ°åŒºè¯­è¨€åŒ…éƒ½ä¼šä¸æ ¸å¿ƒåº“ä¸€èµ·æ‰“åŒ…ï¼Œå¦‚æœæˆ‘ä»¬åªè¦å°‘æ•°å‡ ç§è¯­è¨€ï¼Œå¯ä»¥ä½¿ç”¨<code>IgnorePlugin</code>å¿½ç•¥æ‰ä¸€äº›åœ°åŒºè¯­è¨€åŒ…,</p><h4 id="httpè¯·æ±‚ä¼˜åŒ–"><a href="#httpè¯·æ±‚ä¼˜åŒ–" class="headerlink" title="httpè¯·æ±‚ä¼˜åŒ–"></a>httpè¯·æ±‚ä¼˜åŒ–</h4><ul><li><p>å°å›¾ç‰‡base64ç¼–ç <br>é€šè¿‡è®¾ç½®<code>url-loader</code>çš„é˜€å€¼æ¥æ§åˆ¶ï¼Œå°äºé˜€å€¼çš„å›¾ç‰‡ä½¿ç”¨base64ç¼–ç ï¼Œä»¥æ­¤æ¥å‡å°‘httpè¯·æ±‚</p></li><li><p>ä½¿ç”¨ CDN åŠ é€Ÿ<br>åœ¨è¾“å‡ºæ–‡ä»¶é…ç½®ä¸­å°†CDNè·¯å¾„æ·»åŠ è‡³publicPathä¸­ï¼ˆé’ˆå¯¹jså’Œcssæ–‡ä»¶ï¼‰ï¼›<br>é’ˆå¯¹å›¾ç‰‡ï¼Œä¹Ÿå¯ä»¥åœ¨loaderçš„é…ç½®ä¸­æ·»åŠ publicPath</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">  output: &#123;</span><br><span class="line">    <span class="comment">// filename: 'bundle.[chunkhash].js',  // è¾“å‡ºæ–‡ä»¶åï¼Œä¸€èˆ¬è¦åŠ ä¸Šhash</span></span><br><span class="line">    filename: <span class="string">'[name].[contenthash:8].js'</span>,</span><br><span class="line">    path: distPath,  <span class="comment">// è¾“å‡ºç›®å½•</span></span><br><span class="line">    publicPath: <span class="string">'http://cdn.xxx.com'</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line"><span class="comment">// æˆ–è€…æ˜¯å°†å›¾ç‰‡æ”¾åˆ°cdnä¸­</span></span><br><span class="line"><span class="built_in">module</span>: &#123; </span><br><span class="line">  rules: [</span><br><span class="line">    &#123;</span><br><span class="line">        test: <span class="regexp">/\.(jpg|png|jpeg|gif)$/</span>,</span><br><span class="line">        use: &#123;</span><br><span class="line">          loader:<span class="string">'url-loader'</span>,</span><br><span class="line">          options: &#123;</span><br><span class="line">            limit: <span class="number">8</span> * <span class="number">1024</span>,    <span class="comment">//é™åˆ¶ 8kb ä»¥ä¸‹ä½¿ç”¨base64</span></span><br><span class="line">            esMoudle: <span class="literal">false</span>,</span><br><span class="line">            name: <span class="string">'[name]-[hash:10].[ext]'</span>,</span><br><span class="line">            <span class="comment">// æ‰“åŒ…åˆ°/imagesç›®å½•ä¸‹</span></span><br><span class="line">            <span class="comment">// outputPath: 'images', // æœ‰äº†publicPathï¼Œä¼šè‡ªåŠ¨å¿½ç•¥outputPathï¼Œè¿™æ˜¯é’ˆå¯¹æ”¾åœ¨é™æ€èµ„æºæœåŠ¡å™¨ä¸Šçš„ç›®å½•</span></span><br><span class="line">            publicPath: <span class="string">'http://cdn.xxx.com'</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="å……åˆ†åˆ©ç”¨ç¼“å­˜"><a href="#å……åˆ†åˆ©ç”¨ç¼“å­˜" class="headerlink" title="å……åˆ†åˆ©ç”¨ç¼“å­˜"></a>å……åˆ†åˆ©ç”¨ç¼“å­˜</h4><p>bundle åŠ  hash å€¼<br>ç»™äº§å‡ºçš„æ–‡ä»¶å¢åŠ <code>hash</code>å€¼ï¼Œå½“å†…å®¹æ²¡æœ‰å˜åŒ–æ—¶ï¼Œç”Ÿæˆçš„æ–‡ä»¶åå°†ä¸ä¼šå˜åŒ–ï¼Œæµè§ˆå™¨å°±ä¼šåº”ç”¨ç¼“å­˜ï¼Œä»è€Œæå‡åŠ è½½é€Ÿåº¦<br>å°†æ¥å¼€å‘æ—¶æˆ‘ä»¬å¯¹é™æ€èµ„æºä¼šä½¿ç”¨ç¼“å­˜æ¥ä¼˜åŒ–ï¼Œè¿™æ ·æµè§ˆå™¨ç¬¬äºŒæ¬¡è¯·æ±‚èµ„æºå°±èƒ½è¯»å–ç¼“å­˜äº†ï¼Œé€Ÿåº¦å¾ˆå¿«ã€‚<br>ä½†æ˜¯è¿™æ ·çš„è¯å°±ä¼šæœ‰ä¸€ä¸ªé—®é¢˜, å¦‚æœä¸è®¾ç½®hash:å› ä¸ºå‰åè¾“å‡ºçš„æ–‡ä»¶åæ˜¯ä¸€æ ·çš„ï¼Œä¸€æ—¦å°†æ¥å‘å¸ƒæ–°ç‰ˆæœ¬ï¼Œå› ä¸ºæ–‡ä»¶åæ²¡æœ‰å˜åŒ–å¯¼è‡´æµè§ˆå™¨ä¼šç›´æ¥è¯»å–ç¼“å­˜ï¼Œä¸ä¼šåŠ è½½æ–°èµ„æºï¼Œé¡¹ç›®ä¹Ÿå°±æ²¡æ³•æ›´æ–°äº†ã€‚ åœ¨360æ˜¯é€šè¿‡æ›¿æ¢èµ„æºå‰é¢çš„é“¾æ¥æ”¾ä¸€ä¸ªhashå€¼æ¥å®ç°çš„ã€‚<br>hashæœ‰ä¸‰ç§ï¼š</p><ul><li>hashï¼ˆwebpack4 æ˜¯ hashï¼‰</li></ul><p>æ¯æ¬¡ä¿®æ”¹ä»»ä½•ä¸€ä¸ªæ–‡ä»¶ï¼Œæ‰€æœ‰æ–‡ä»¶åçš„ hash è‡³éƒ½å°†æ”¹å˜ã€‚æ‰€ä»¥ä¸€æ—¦ä¿®æ”¹äº†ä»»ä½•ä¸€ä¸ªæ–‡ä»¶ï¼Œæ•´ä¸ªé¡¹ç›®çš„æ–‡ä»¶ç¼“å­˜éƒ½å°†å¤±æ•ˆã€‚</p><ul><li>chunkhash</li></ul><p>chunkhashæ ¹æ®ä¸åŒçš„å…¥å£æ–‡ä»¶(entry)è¿›è¡Œä¾èµ–æ–‡ä»¶è§£æã€æ„å»ºå¯¹åº”çš„chunkï¼Œç”Ÿæˆå¯¹åº”çš„å“ˆå¸Œå€¼ã€‚å½“æŸä¸ªæ–‡ä»¶å†…å®¹å‘ç”Ÿå˜åŠ¨æ—¶ï¼Œå†æ¬¡æ‰§è¡Œæ‰“åŒ…ï¼Œåªæœ‰è¯¥æ–‡ä»¶ä»¥åŠä¾èµ–è¯¥æ–‡ä»¶çš„æ–‡ä»¶çš„æ‰“åŒ…ç»“æœ hash å€¼ä¼šå‘ç”Ÿæ”¹å˜ã€‚<br>æ¯”å¦‚ï¼šåœ¨ index.js ä¸­å¼•ç”¨äº† index.css ï¼Œæ‰“åŒ…åä»–ä»¬å±äºä¸€ä¸ªæ¨¡å—ï¼Œhashå€¼ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚<br>å½“JSæ–‡ä»¶å˜åŒ–çš„æ—¶å€™ï¼Œcssæ–‡ä»¶çš„hashä¹Ÿä¼šå˜åŒ–</p><ul><li>contenthash</li></ul><p>æ ¹æ®æ–‡ä»¶å†…å®¹ç”Ÿæˆ hash å€¼ï¼Œåªæœ‰æ–‡ä»¶å†…å®¹å˜åŒ–äº†ï¼Œhash å€¼æ‰ä¼šå˜åŒ–ã€‚æ‰€æœ‰æ–‡ä»¶ hash å€¼æ˜¯ç‹¬äº«ä¸”ä¸åŒçš„ã€‚<br>åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œæˆ‘ä»¬å¯¹ output ä¸­æ‰“åŒ…çš„æ–‡ä»¶åä¸€èˆ¬é‡‡ç”¨ chunkhashï¼Œå¯¹äº css ç­‰æ ·å¼æ–‡ä»¶ï¼Œé‡‡ç”¨ contenthashï¼Œè¿™æ ·å¯ä»¥ä½¿å¾—å„ä¸ªæ¨¡å—æœ€å°èŒƒå›´çš„æ”¹å˜æ‰“åŒ… hash å€¼ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ·±å…¥react hooks</title>
      <link href="/ashley271017.github.io/2023/01/21/hooks/"/>
      <url>/ashley271017.github.io/2023/01/21/hooks/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸ºä»€ä¹ˆä¼šå‡ºç°hooks"><a href="#ä¸ºä»€ä¹ˆä¼šå‡ºç°hooks" class="headerlink" title="ä¸ºä»€ä¹ˆä¼šå‡ºç°hooks?"></a>ä¸ºä»€ä¹ˆä¼šå‡ºç°hooks?</h2><ul><li>ç±»ç»„ä»¶é€æ¸è¢«å‡½æ•°å¼ç»„ä»¶å®Œå…¨å–ä»£<ul><li><strong>å‡½æ•°å¼ç»„ä»¶æ•è·äº†æ¸²æŸ“æ‰€ç”¨çš„å€¼ã€‚</strong></li><li><strong>å‡½æ•°ç»„ä»¶æ›´åŠ ç¬¦åˆè®¾è®¡ç†å¿µã€ä¹Ÿæ›´æœ‰åˆ©äºé€»è¾‘æ‹†åˆ†å’Œå¤ç”¨</strong></li><li>ç›¸æ¯”ç±»ç»„ä»¶ï¼Œå‡½æ•°ç»„ä»¶ç¼–å†™æ›´è½»ä¾¿ï¼Œç”Ÿæˆçš„ä»£ç ä¹Ÿæ›´å°‘<br>hooksæ˜¯å®Œå…¨ä¸ºå‡½æ•°ç»„ä»¶è®¾è®¡çš„ï¼Œå®ƒèƒ½è®©å‡½æ•°ç»„ä»¶æ‹¥æœ‰ç±»ç»„ä»¶çš„èƒ½åŠ›ï¼Œå¹¶ä¸”ä¿ç•™è½»é‡ã€ä¼˜é›…çš„ç‰¹æ€§ã€‚<br>æ¢è®¨åŸç†ä¹‹å‰å…ˆçœ‹çœ‹å¦‚ä¸‹å‡ ä¸ªé—®é¢˜ï¼Ÿ</li></ul></li><li>1 åœ¨æ— çŠ¶æ€ç»„ä»¶æ¯ä¸€æ¬¡å‡½æ•°ä¸Šä¸‹æ–‡æ‰§è¡Œçš„æ—¶å€™ï¼Œ<code>react</code>ç”¨ä»€ä¹ˆæ–¹å¼è®°å½•äº†<code>hooks</code>çš„çŠ¶æ€ï¼Ÿ</li><li>2 å¤šä¸ª<code>react-hooks</code>ç”¨ä»€ä¹ˆæ¥è®°å½•æ¯ä¸€ä¸ª<code>hooks</code>çš„é¡ºåºçš„ ï¼Ÿ æ¢ä¸ªé—®æ³•ï¼ä¸ºä»€ä¹ˆä¸èƒ½æ¡ä»¶è¯­å¥ä¸­ï¼Œå£°æ˜<code>hooks</code>? <code>hooks</code>å£°æ˜ä¸ºä»€ä¹ˆåœ¨ç»„ä»¶çš„æœ€é¡¶éƒ¨ï¼Ÿ</li><li>3 <code>function</code>å‡½æ•°ç»„ä»¶ä¸­çš„<code>useState</code>ï¼Œå’Œ <code>class</code>ç±»ç»„ä»¶ <code>setState</code>æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</li><li>4 <code>react</code> æ˜¯æ€ä¹ˆæ•è·åˆ°<code>hooks</code>çš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œæ˜¯åœ¨å‡½æ•°ç»„ä»¶å†…éƒ¨çš„ï¼Ÿ</li><li>5 <code>useEffect</code>,<code>useMemo</code> ä¸­ï¼Œä¸ºä»€ä¹ˆ<code>useRef</code>ä¸éœ€è¦ä¾èµ–æ³¨å…¥ï¼Œå°±èƒ½è®¿é—®åˆ°æœ€æ–°çš„æ”¹å˜å€¼ï¼Ÿ</li><li>6 <code>useMemo</code>æ˜¯æ€ä¹ˆå¯¹å€¼åšç¼“å­˜çš„ï¼Ÿå¦‚ä½•åº”ç”¨å®ƒä¼˜åŒ–æ€§èƒ½ï¼Ÿ</li><li>7 ä¸ºä»€ä¹ˆä¸¤æ¬¡ä¼ å…¥<code>useState</code>çš„å€¼ç›¸åŒï¼Œå‡½æ•°ç»„ä»¶ä¸æ›´æ–°?</li></ul><h2 id="functionç»„ä»¶å’Œclassç»„ä»¶æœ¬è´¨çš„åŒºåˆ«"><a href="#functionç»„ä»¶å’Œclassç»„ä»¶æœ¬è´¨çš„åŒºåˆ«" class="headerlink" title="functionç»„ä»¶å’Œclassç»„ä»¶æœ¬è´¨çš„åŒºåˆ«"></a><strong>functionç»„ä»¶å’Œclassç»„ä»¶æœ¬è´¨çš„åŒºåˆ«</strong></h2><p>é¦–å…ˆå›é¡¾ä¸€ä¸‹functionç»„ä»¶å’Œclassç»„ä»¶çš„åŒºåˆ«</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">// classç»„ä»¶</span><br><span class="line">class Index extends React.Component&lt;any,any&gt;&#123;</span><br><span class="line">    constructor(props)&#123;</span><br><span class="line">        super(props)</span><br><span class="line">        this.state=&#123;</span><br><span class="line">            number:0</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    handerClick=()=&gt;&#123;</span><br><span class="line">       for(let i = 0 ;i&lt;5;i++)&#123;</span><br><span class="line">           setTimeout(()=&gt;&#123;</span><br><span class="line">               this.setState(&#123; number:this.state.number+1 &#125;)</span><br><span class="line">               console.log(this.state.number) // 12345</span><br><span class="line">           &#125;,1000)</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render()&#123;</span><br><span class="line">        return &lt;div&gt;</span><br><span class="line">            &lt;button onClick=&#123; this.handerClick &#125; &gt;num++&lt;/button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">// å‡½æ•°ç»„ä»¶</span><br><span class="line"></span><br><span class="line">function Index()&#123;</span><br><span class="line">    const [ num ,setNumber ] = React.useState(0)</span><br><span class="line">    const handerClick=()=&gt;&#123;</span><br><span class="line">        for(let i=0; i&lt;5;i++ )&#123;</span><br><span class="line">           setTimeout(() =&gt; &#123;</span><br><span class="line">                setNumber(num+1)</span><br><span class="line">                console.log(num) // 00000</span><br><span class="line">           &#125;, 1000)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return &lt;button onClick=&#123; handerClick &#125; &gt;&#123; num &#125;&lt;/button&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿä¸¤ç§ä¸ä¸€æ ·çš„ç»“æœï¼Ÿ<br>ç¬¬ä¸€ä¸ªç±»ç»„ä»¶ä¸­ï¼Œç”±äºæ‰§è¡Œä¸Š<code>setState</code>æ²¡æœ‰åœ¨<code>react</code>æ­£å¸¸çš„å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ä¸Šæ‰§è¡Œï¼Œè€Œæ˜¯<code>setTimeout</code>ä¸­æ‰§è¡Œçš„ï¼Œ<strong>æ‰¹é‡æ›´æ–°</strong>æ¡ä»¶è¢«ç ´åã€‚æ‰€ä»¥å¯ä»¥ç›´æ¥è·å–åˆ°å˜åŒ–åçš„<code>state</code>ã€‚</p><p><strong>è¿™é‡Œçš„æ‰¹å¤„ç†æ¡ä»¶æ˜¯å•¥ï¼Ÿ</strong></p><p>ã€Reactçš„æ›´æ–°æœºåˆ¶ã€‘</p><p>ç”Ÿå‘½å‘¨æœŸå‡½æ•°å’Œåˆæˆäº‹ä»¶ä¸­ï¼š</p><ol><li>æ— è®ºè°ƒç”¨å¤šå°‘æ¬¡setStateï¼Œéƒ½ä¸ä¼šç«‹å³æ‰§è¡Œæ›´æ–°ã€‚è€Œæ˜¯å°†è¦æ›´æ–°çš„stateå­˜å…¥â€™_pendingStateQueneâ€™,å°†è¦æ›´æ–°çš„ç»„ä»¶å­˜å…¥â€™dirtyComponentâ€™;</li><li>å½“æ ¹ç»„ä»¶didMountåï¼Œæ‰¹å¤„ç†æœºåˆ¶æ›´æ–°ä¸ºfalseã€‚æ­¤æ—¶å†å–å‡ºâ€™_pendingStateQueneâ€™å’Œâ€™dirtyComponentâ€™ä¸­çš„stateå’Œç»„ä»¶è¿›è¡Œåˆå¹¶æ›´æ–°ï¼›</li></ol><p>åŸç”Ÿäº‹ä»¶å’Œå¼‚æ­¥ä»£ç ä¸­ï¼š</p><ol><li>åŸç”Ÿäº‹ä»¶ä¸ä¼šè§¦å‘reactçš„æ‰¹å¤„ç†æœºåˆ¶ï¼Œå› è€Œè°ƒç”¨setStateä¼šç›´æ¥æ›´æ–°ï¼›</li><li>å¼‚æ­¥ä»£ç ä¸­è°ƒç”¨setStateï¼Œç”±äºjsçš„å¼‚æ­¥å¤„ç†æœºåˆ¶ï¼Œå¼‚æ­¥ä»£ç ä¼šæš‚å­˜ï¼Œç­‰å¾…åŒæ­¥ä»£ç æ‰§è¡Œå®Œæ¯•å†æ‰§è¡Œï¼Œæ­¤æ—¶reactçš„æ‰¹å¤„ç†æœºåˆ¶å·²ç»ç»“æŸï¼Œå› è€Œç›´æ¥æ›´æ–°</li></ol><p>åœ¨è§£é‡Š<code>react-hooks</code>åŸç†çš„ä¹‹å‰ï¼Œæˆ‘ä»¬è¦åŠ æ·±ç†è§£ä¸€ä¸‹ï¼Œ <strong>å‡½æ•°ç»„ä»¶å’Œç±»ç»„ä»¶åˆ°åº•æœ‰ä»€ä¹ˆåŒºåˆ«</strong><br><em>å‡½æ•°å¼ç»„ä»¶æ•è·äº†æ¸²æŸ“æ‰€ä½¿ç”¨çš„å€¼*</em>ï¼Œå¹¶ä¸”æˆ‘ä»¬è¿˜èƒ½è¿›ä¸€æ­¥æ„è¯†åˆ°ï¼š<strong>å‡½æ•°ç»„ä»¶çœŸæ­£å°†æ•°æ®å’Œæ¸²æŸ“ç´§ç´§çš„ç»‘å®šåˆ°ä¸€èµ·äº†</strong>ã€‚<br><strong>Reactæœ‰ä¸€ä¸ªç»å…¸å…¬å¼ï¼šui=f(data),å³åŒæ ·çš„è¾“å…¥å¿…å®šæœ‰åŒæ ·çš„ ç»“æœï¼Œå‡½æ•°å¼ç»„ä»¶æ•è·äº†æ¸²æŸ“æ—¶æ‰€ç”¨çš„å€¼ï¼Œå› æ­¤ç»„ä»¶æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½ä¼šæœ‰è‡ªå·±çš„propså’Œstateã€‚æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½ä¼šæœ‰ è‡ªå·±çš„äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œè€Œè¿™é‡Œæ¯æ¬¡æ¸²æŸ“éƒ½æœ‰ç‹¬ç«‹çš„ state ä¸Šä¸‹æ–‡</strong></p><p><strong>ä¸ºä»€ä¹ˆä¼šå‡ºç°hooksï¼Ÿ</strong></p><p>å¯¹äº<code>class</code>ç»„ä»¶ï¼Œæˆ‘ä»¬åªéœ€è¦å®ä¾‹åŒ–ä¸€æ¬¡ï¼Œå®ä¾‹ä¸­ä¿å­˜äº†ç»„ä»¶çš„<code>state</code>ç­‰çŠ¶æ€ã€‚å¯¹äºæ¯ä¸€æ¬¡æ›´æ–°åªéœ€è¦è°ƒç”¨<code>render</code>æ–¹æ³•å°±å¯ä»¥ã€‚ä½†æ˜¯åœ¨<code>function</code>ç»„ä»¶ä¸­ï¼Œæ¯ä¸€æ¬¡æ›´æ–°éƒ½æ˜¯ä¸€æ¬¡æ–°çš„å‡½æ•°æ‰§è¡Œ,ä¸ºäº†ä¿å­˜ä¸€äº›çŠ¶æ€,æ‰§è¡Œä¸€äº›å‰¯ä½œç”¨é’©å­,<code>react-hooks</code>åº”è¿è€Œç”Ÿï¼Œå»å¸®åŠ©è®°å½•ç»„ä»¶çš„çŠ¶æ€ï¼Œå¤„ç†ä¸€äº›é¢å¤–çš„å‰¯ä½œç”¨ã€‚</p><h2 id="ä¸€"><a href="#ä¸€" class="headerlink" title="ä¸€"></a><strong>ä¸€</strong></h2><h1 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h1><h2 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h2><h3 id="Hooksé“¾è¡¨"><a href="#Hooksé“¾è¡¨" class="headerlink" title="Hooksé“¾è¡¨"></a>Hooksé“¾è¡¨</h3><p>æ— è®ºæ˜¯åˆæ¬¡æŒ‚è½½è¿˜æ˜¯æ›´æ–°ï¼Œæ¯è°ƒç”¨ä¸€æ¬¡hookså‡½æ•°ï¼Œéƒ½ä¼šäº§ç”Ÿä¸€ä¸ªhookå¯¹è±¡ä¸ä¹‹å¯¹åº”ã€‚ä»¥ä¸‹æ˜¯hookå¯¹è±¡çš„ç»“æ„ã€‚</p><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f0c0001228d240299526f551c8b76a86~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"><br>äº§ç”Ÿçš„hookå¯¹è±¡ä¾æ¬¡æ’åˆ—ï¼Œå½¢æˆé“¾è¡¨å­˜å‚¨åˆ°fiber.memoizedStateä¸Šã€‚<br>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæœ‰ä¸ªååˆ†é‡è¦çš„æŒ‡é’ˆï¼šworkInProgressHookï¼Œå®ƒé€šè¿‡è®°å½•å½“å‰ç”Ÿæˆï¼ˆæ›´æ–°ï¼‰çš„hookå¯¹è±¡ï¼Œå¯ä»¥é—´æ¥åæ˜ åœ¨ç»„ä»¶ä¸­å½“å‰è°ƒç”¨åˆ°å“ªä¸ªhookå‡½æ•°äº†ã€‚æ¯è°ƒç”¨ä¸€æ¬¡hookå‡½æ•°ï¼Œå°±å°†è¿™ä¸ªæŒ‡é’ˆçš„æŒ‡å‘ç§»åˆ°è¯¥hookå‡½æ•°äº§ç”Ÿçš„hookå¯¹è±¡ä¸Šã€‚ä¾‹å¦‚ï¼š</p><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c0b61ab97fe146039be2557b322b6551~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p><p>é‚£ä¹ˆæ„å»ºhooké“¾è¡¨çš„è¿‡ç¨‹ï¼Œå¯ä»¥æ¦‚æ‹¬ä¸ºä¸‹é¢è¿™æ ·<br>è°ƒç”¨useState(â€˜Aâ€™)ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/72ffe5ab6d2f400180638934d07fb30c~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"><br>è°ƒç”¨useEffectï¼š</p><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/143b9f3e81ec4076bce33047fcf43300~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p><h3 id="memorizedState"><a href="#memorizedState" class="headerlink" title="memorizedState"></a>memorizedState</h3><p><strong>memorizedState å°±æ˜¯ä¿å­˜ hooks æ•°æ®çš„åœ°æ–¹ã€‚å®ƒæ˜¯ä¸€ä¸ªé€šè¿‡ next ä¸²è”çš„é“¾è¡¨ã€‚ä¸æˆ‘ä»¬è°ƒç”¨çš„hooksæ˜¯æŒ‰ç…§è°ƒç”¨hooksçš„é¡ºåºå¯¹åº”èµ·æ¥çš„ã€‚</strong></p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/74e2a41924584b9bad3003fbee5d5d0d~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"><br>è¿™å°±æ˜¯ hooks å­˜å–æ•°æ®çš„åœ°æ–¹ï¼Œæ‰§è¡Œçš„æ—¶å€™å„è‡ªåœ¨è‡ªå·±çš„é‚£ä¸ª memorizedState ä¸Šå­˜å–æ•°æ®ï¼Œå®Œæˆå„ç§é€»è¾‘ã€‚</p><h4 id="è¿™ä¸ª-memorizedState-é“¾è¡¨æ˜¯ä»€ä¹ˆæ—¶å€™åˆ›å»ºçš„å‘¢"><a href="#è¿™ä¸ª-memorizedState-é“¾è¡¨æ˜¯ä»€ä¹ˆæ—¶å€™åˆ›å»ºçš„å‘¢" class="headerlink" title="è¿™ä¸ª memorizedState é“¾è¡¨æ˜¯ä»€ä¹ˆæ—¶å€™åˆ›å»ºçš„å‘¢?"></a>è¿™ä¸ª memorizedState é“¾è¡¨æ˜¯ä»€ä¹ˆæ—¶å€™åˆ›å»ºçš„å‘¢?</h4><p>å¥½é—®é¢˜ï¼Œç¡®å®æœ‰ä¸ªé“¾è¡¨åˆ›å»ºçš„è¿‡ç¨‹ï¼Œä¹Ÿå°±æ˜¯ mountXxxã€‚é“¾è¡¨åªéœ€è¦åˆ›å»ºä¸€æ¬¡ï¼ˆæ­¤æ—¶ä¼šè°ƒç”¨ountWorkInProgressHookï¼‰ï¼Œåé¢åªéœ€è¦ updateï¼ˆæ­¤æ—¶ä¼šè°ƒç”¨updateWorkInProgressHookï¼‰ã€‚<br>æ¯”å¦‚ç¬¬ä¸€æ¬¡è°ƒç”¨ useState ä¼šæ‰§è¡Œ mountStateï¼Œåé¢å†è°ƒç”¨ useState ä¼šæ‰§è¡Œ updateStateã€‚</p><h4 id="åˆ›å»º-memorizedState-é“¾è¡¨çš„è¿‡ç¨‹"><a href="#åˆ›å»º-memorizedState-é“¾è¡¨çš„è¿‡ç¨‹" class="headerlink" title="åˆ›å»º memorizedState é“¾è¡¨çš„è¿‡ç¨‹"></a>åˆ›å»º memorizedState é“¾è¡¨çš„è¿‡ç¨‹</h4><p>mountXxx æ˜¯åˆ›å»º memorizedState é“¾è¡¨çš„è¿‡ç¨‹ï¼Œæ¯ä¸ª hooks api éƒ½æ˜¯è¿™æ ·çš„ï¼š</p><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/21fb0572a8c74fa4a8017ad02edc7174~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"><br>å…¶ä¸­mountXXXçš„è¿‡ç¨‹å°±æ˜¯åˆ›å»ºå¯¹åº”çš„ memorizedState å¯¹è±¡ï¼Œç„¶åç”¨ next ä¸²è”èµ·æ¥ã€‚</p><h3 id="useRef"><a href="#useRef" class="headerlink" title="useRef"></a>useRef</h3><p>æ¯ä¸ª useXxx çš„ hooks éƒ½æœ‰ mountXxx å’Œ updateXxx ä¸¤ä¸ªé˜¶æ®µï¼Œæ¯”å¦‚ ref å°±æ˜¯ mountRef å’Œ updateRefã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">useRef&lt;T&gt;(initialValue: T): &#123;|current: T|&#125; &#123;</span><br><span class="line">     currentHookNameInDev = <span class="string">'useRef'</span>;</span><br><span class="line">     mountHookTypesDev();</span><br><span class="line">     <span class="keyword">return</span> mountRef(initialValue);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/315d6156f3344aaba2943f125dc5a356~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p><p>å…¶ä¸­ï¼š<strong>mountWorkInProgressHook ï¼šåˆ›å»ºå¹¶è¿”å› memorizedState é“¾è¡¨</strong><br><strong>updateWorkInProgressHookï¼šæ›´æ–°ã€‚</strong></p><p><strong>Object.freeze vs Object.seal</strong><br>Object.seal:åªè¦æ˜¯å¯å†™çš„ï¼Œå°±å¯ä»¥æ›´æ”¹å®ƒä»¬çš„å€¼ã€‚</p><h4 id="useRefçš„åŸç†"><a href="#useRefçš„åŸç†" class="headerlink" title="useRefçš„åŸç†"></a>useRefçš„åŸç†</h4><p><strong>åœ¨memorizedStateä¸ŠæŒ‚è½½äº†æœ‰ current å±æ€§çš„å¯¹è±¡ï¼Œå†»ç»“äº†ä¸€ä¸‹ï¼Œåé¢ update çš„æ—¶å€™ï¼Œæ²¡æœ‰åšä»»ä½•å¤„ç†ï¼Œç›´æ¥è¿”å›è¿™ä¸ªå¯¹è±¡ã€‚</strong><br>æ‰€ä»¥ï¼šuseRef å¯ä»¥ä¿å­˜ä¸€ä¸ªæ•°æ®çš„å¼•ç”¨ï¼Œè¿™ä¸ªå¼•ç”¨ä¸å¯å˜ã€‚</p><h4 id="useRefè·Ÿç›´æ¥åœ¨ç»„ä»¶æ–‡ä»¶é¡¶å±‚å®šä¹‰ä¸€ä¸ªå¯¹è±¡çš„åŒºåˆ«"><a href="#useRefè·Ÿç›´æ¥åœ¨ç»„ä»¶æ–‡ä»¶é¡¶å±‚å®šä¹‰ä¸€ä¸ªå¯¹è±¡çš„åŒºåˆ«" class="headerlink" title="useRefè·Ÿç›´æ¥åœ¨ç»„ä»¶æ–‡ä»¶é¡¶å±‚å®šä¹‰ä¸€ä¸ªå¯¹è±¡çš„åŒºåˆ«"></a>useRefè·Ÿç›´æ¥åœ¨ç»„ä»¶æ–‡ä»¶é¡¶å±‚å®šä¹‰ä¸€ä¸ªå¯¹è±¡çš„åŒºåˆ«</h4><p>å‰è€…åœ¨ç»„ä»¶å¸è½½çš„æ—¶å€™ä¼šé‡Šæ”¾ï¼Œåè€…ä¸ä¼šï¼Œå½“ä»ç»„ä»¶Aåˆ‡æ¢åˆ°ç»„ä»¶Bçš„æ—¶å€™å‡å¦‚<code>import ç»„ä»¶A</code>è¿™ä¸€å¥è¿˜åœ¨ï¼Œé‚£ä¹ˆåè€…å ç”¨çš„å†…å­˜ä¾æ—§å­˜åœ¨ï¼ŒåŸå› æ˜¯ï¼šES6 module æ¯ä¸ªæ¨¡å—çš„ä½œç”¨åŸŸéƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œä¸å±äºå…¨å±€ä½œç”¨åŸŸ<br>åˆ‡æ¢åˆ°ç»„ä»¶Bä¹‹åï¼Œç»„ä»¶Açš„å¼•ç”¨è¿˜åœ¨ï¼Œå®ƒæ‰€å½¢æˆçš„å±€éƒ¨ä½œç”¨åŸŸå¹¶æœªè¢«é”€æ¯ã€‚</p><p><strong>é‚£å¦‚æœåœ¨å‡½æ•°ç»„ä»¶å†…éƒ¨å®šä¹‰ä¸€ä¸ªå˜é‡å‘¢ï¼Ÿ</strong><br>è¿™æ ·çš„æ¯æ¬¡functioné‡æ–°æ‰§è¡Œçš„æ—¶å€™å®ƒéƒ½ä¼šé‡æ–°åˆ›å»ºä¸€æ¬¡ï¼Œå®ƒçš„å¼•ç”¨ä¸€ç›´éƒ½ä¼šå˜åŒ–ï¼Œç›¸æ¯”ä¹‹ä¸‹ useRefæ˜¯ä¸ä¼šçš„ã€‚</p><h3 id="useCallback"><a href="#useCallback" class="headerlink" title="useCallback"></a>useCallback</h3><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a5235a75234242a5b751d7858198dc69~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p><h4 id="useCallbackçš„åŸç†"><a href="#useCallbackçš„åŸç†" class="headerlink" title="useCallbackçš„åŸç†"></a>useCallbackçš„åŸç†</h4><p><strong>useCallback åœ¨ memorizedState ä¸Šæ”¾äº†ä¸€ä¸ªæ•°ç»„ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯ä¼ å…¥çš„å›è°ƒå‡½æ•°ï¼Œç¬¬äºŒä¸ªæ˜¯ä¼ å…¥çš„ä¾èµ–ã€‚<br>æ›´æ–°çš„æ—¶å€™æŠŠä¹‹å‰çš„é‚£ä¸ª memorizedState å–å‡ºæ¥ï¼Œå’Œæ–°ä¼ å…¥çš„ deps åšä¸‹å¯¹æ¯”ï¼Œå¦‚æœæ²¡å˜ï¼Œé‚£å°±è¿”å›ä¹‹å‰çš„å›è°ƒå‡½æ•°ï¼Œä¹Ÿå°±æ˜¯ <code>prevState[0]</code>ã€‚ å¦‚æœå˜äº†ï¼Œé‚£å°±åˆ›å»ºä¸€ä¸ªæ–°çš„æ•°ç»„ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯ä¼ å…¥çš„å›è°ƒå‡½æ•°ï¼Œç¬¬äºŒä¸ªæ˜¯ä¼ å…¥çš„ deps</strong>ã€‚ æ‰€ä»¥ï¼ŒuseCallback çš„åŠŸèƒ½ä¹Ÿå°±å‘¼ä¹‹æ¬²å‡ºäº†ï¼šuseCallback å¯ä»¥å®ç°å‡½æ•°çš„ç¼“å­˜ï¼Œå¦‚æœ deps æ²¡å˜å°±ä¸ä¼šåˆ›å»ºæ–°çš„ï¼Œå¦åˆ™æ‰ä¼šè¿”å›æ–°ä¼ å…¥çš„å‡½æ•°</p><h3 id="useMemo"><a href="#useMemo" class="headerlink" title="useMemo"></a>useMemo</h3><p><strong>è·ŸuseCallbackç±»ä¼¼ï¼Œåªæ˜¯å‡½æ•°å˜æˆå€¼ã€‚</strong><br>useMemo ä¹Ÿåœ¨ memorizedState ä¸Šæ”¾äº†ä¸ªæ•°ç»„ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯ä¼ å…¥å‡½æ•°çš„æ‰§è¡Œç»“æœï¼Œç¬¬äºŒä¸ªå…ƒç´ æ˜¯ä¾èµ–ã€‚<br>æ›´æ–°çš„æ—¶å€™ä¹Ÿæ˜¯å–å‡ºä¹‹å‰çš„ memorizedStateï¼Œå’Œæ–°ä¼ å…¥çš„ deps åšä¸‹å¯¹æ¯”ï¼Œå¦‚æœæ²¡å˜ï¼Œå°±è¿”å›ä¹‹å‰çš„å€¼ï¼Œä¹Ÿå°±æ˜¯ prevState[0]ã€‚</p><p>å¦‚æœå˜äº†ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„æ•°ç»„æ”¾åœ¨ memorizedStateï¼Œç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯æ–°ä¼ å…¥å‡½æ•°çš„æ‰§è¡Œç»“æœï¼Œç¬¬äºŒä¸ªå…ƒç´ æ˜¯ä¾èµ–ã€‚</p><h3 id="è‡ªå®šä¹‰hooks"><a href="#è‡ªå®šä¹‰hooks" class="headerlink" title="è‡ªå®šä¹‰hooks"></a>è‡ªå®šä¹‰hooks</h3><p>å…¶å®å°±æ˜¯ä¸ªå‡½æ•°è°ƒç”¨ï¼Œæ²¡å•¥ç¥å¥‡çš„ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä¸Šé¢çš„ hooks æ”¾åˆ° xxx å‡½æ•°é‡Œï¼Œç„¶ååœ¨ function ç»„ä»¶é‡Œè°ƒç”¨ï¼Œå¯¹åº”çš„ hook é“¾è¡¨æ˜¯ä¸€æ ·çš„ã€‚<br><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f7537d3744dd48f7b4d6f52d536aea1c~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p><p>å› æ­¤è‡ªå®šä¹‰hooksåœ¨ä¸åŒçš„ç»„ä»¶ä¹‹é—´è°ƒç”¨ä¸å¯èƒ½å…±äº«stateè¿™äº›ã€‚</p><h3 id="useStateè·ŸuseEffectçš„åŸç†"><a href="#useStateè·ŸuseEffectçš„åŸç†" class="headerlink" title="useStateè·ŸuseEffectçš„åŸç†"></a>useStateè·ŸuseEffectçš„åŸç†</h3><p>æœ¬è´¨ä¸Šå°±æ˜¯é—­åŒ…åŠ ä¸Šæ•°ç»„<br> <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> MyReact = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">   <span class="keyword">let</span> hooks = [],</span><br><span class="line">     currentHook = <span class="number">0</span> <span class="comment">// hooksæ•°ç»„, å’Œä¸€ä¸ªiterator!</span></span><br><span class="line">   <span class="keyword">return</span> &#123;</span><br><span class="line">     <span class="comment">// æ³¨æ„è¿™é‡Œçš„renderç›¸å½“äºReactDOMçš„renderè€Œä¸æ˜¯rerender!æ‰€ä»¥è¦å¤ä½</span></span><br><span class="line">     render(Component) &#123;</span><br><span class="line">       <span class="comment">// rerenderæ˜¯ä¸ä¼šé‡æ–°æ‰§è¡Œç»„ä»¶çš„</span></span><br><span class="line">       <span class="keyword">const</span> Comp = Component() <span class="comment">// è¿è¡Œ effects</span></span><br><span class="line">       Comp.render()</span><br><span class="line">       currentHook = <span class="number">0</span> <span class="comment">// å¤ä½ï¼Œä¸ºä¸‹ä¸€æ¬¡renderåšå‡†å¤‡</span></span><br><span class="line">       <span class="keyword">return</span> Comp</span><br><span class="line">     &#125;,</span><br><span class="line">     <span class="comment">// æ³¨æ„è¿™é‡Œåªæ˜¯callbackä¸ä¼šæ¯æ¬¡rerenderçš„æ—¶å€™è¿è¡Œï¼ŒuseEffectè¿˜æ˜¯ä¼šçš„ï¼Œ</span></span><br><span class="line">     <span class="comment">// æ‰€ä»¥æ¯æ¬¡çš„depArrayéƒ½æ˜¯å½“å‰ä¾èµ–æœ€æ–°çš„å€¼</span></span><br><span class="line">     useEffect(callback, depArray) &#123;</span><br><span class="line">       <span class="keyword">const</span> hasNoDeps = !depArray</span><br><span class="line">       <span class="comment">// é—­åŒ…å˜é‡æ¥å•¦ï¼Œå®ƒè®°å½•çš„æ˜¯åˆå§‹åŒ–æˆ–è€…ä¸Šä¸€æ¬¡ä¾èµ–å˜åŒ–æ—¶å€™ä¾èµ–çš„å€¼</span></span><br><span class="line">       <span class="keyword">const</span> deps = hooks[currentHook] <span class="comment">// type: array | undefined</span></span><br><span class="line">       <span class="comment">// console.log('deps::: ', deps,depArray);</span></span><br><span class="line">       <span class="keyword">const</span> hasChangedDeps = deps ? !depArray.every(<span class="function">(<span class="params">el, i</span>) =&gt;</span> el === deps[i]) : <span class="literal">true</span></span><br><span class="line">       <span class="comment">// å¦‚æœæ˜¯åˆå§‹åŒ–æˆ–è€…æ˜¯ä¾èµ–å˜äº† æ‰§è¡Œå›è°ƒå‡½æ•°</span></span><br><span class="line">       <span class="keyword">if</span> (hasNoDeps || hasChangedDeps) &#123;</span><br><span class="line">         callback()</span><br><span class="line">         hooks[currentHook] = depArray</span><br><span class="line">       &#125;</span><br><span class="line">       currentHook++ <span class="comment">// æœ¬hookè¿è¡Œç»“æŸ</span></span><br><span class="line">     &#125;,</span><br><span class="line">     useState(initialValue) &#123;</span><br><span class="line">       <span class="comment">// ä¸Šä¸€æ¬¡è°ƒç”¨useState currentHook++äº†ï¼Œæ‰€ä»¥ç¬¬äºŒè°ƒç”¨çš„æ—¶å€™ï¼Œå¾€hooksé‡Œpushæ–°çš„[0] -&gt; [0,'foo']</span></span><br><span class="line">       <span class="comment">// hooks[currentHook] = hooks[currentHook] || initialValue // type: any</span></span><br><span class="line">       <span class="comment">// currentHook++ä¸èƒ½æ”¾åœ¨è¿™é‡Œåªèƒ½æ”¾åœ¨æœ€åä¸€è¡Œï¼Œå› ä¸ºå¦‚æœæ”¾åœ¨è¿™é‡Œå°±æ˜¯ï¼šhooks[0]=initvalue ä½†æ˜¯è¿”å›çš„å´æ˜¯[hooks[1]]</span></span><br><span class="line">       hooks[currentHook]=initialValue</span><br><span class="line">       <span class="keyword">const</span> setStateHookIndex = currentHook <span class="comment">// ç»™setStateçš„é—­åŒ…å‡†å¤‡çš„å˜é‡!å› ä¸ºè¿™é‡Œçš„useStateåªæ‰§è¡Œä¸€æ¬¡ï¼Œæ‰€ä»¥è¿™é‡Œçš„</span></span><br><span class="line">       <span class="comment">// setStateHookIndexæ°¸è¿œç­‰äºè¯¥useStateçš„å€¼åœ¨hooksä¸­å¯¹åº”çš„ä½ç½®ï¼Œå¦åˆ™çš„è¯æ¯æ¬¡renderçš„æ—¶å€™currentHookéƒ½ä¼šå˜åŒ–ï¼Œå¯¼è‡´setStateä¿®æ”¹é”™ä½ç½®</span></span><br><span class="line">       <span class="keyword">const</span> setState = <span class="function"><span class="params">newState</span> =&gt;</span> &#123;</span><br><span class="line">         <span class="built_in">console</span>.log(<span class="string">'newState::: '</span>, setStateHookIndex,newState,currentHook,hooks);</span><br><span class="line">         <span class="keyword">return</span> (hooks[setStateHookIndex] = newState)</span><br><span class="line">       &#125;</span><br><span class="line">        <span class="comment">// è°ƒç”¨useStateç¬¬ä¸€æ¬¡ï¼š[0] è°ƒç”¨ç¬¬äºŒæ¬¡ [0,'foo]</span></span><br><span class="line">       <span class="built_in">console</span>.log(hooks,currentHook)</span><br><span class="line">       <span class="comment">// æ³¨æ„è¿™é‡Œæ˜¯currentHook++è€Œä¸æ˜¯++currentHook,æ‰€ä»¥ç¬¬ä¸€æ¬¡currentHook++=0</span></span><br><span class="line">       <span class="keyword">return</span> [hooks[currentHook++], setState]</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;)()</span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">function</span> <span class="title">Counter</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">   <span class="keyword">const</span> [count, setCount] = MyReact.useState(<span class="number">0</span>)</span><br><span class="line">   <span class="keyword">const</span> [text, setText] = MyReact.useState(<span class="string">'foo'</span>) <span class="comment">// ç¬¬äºŒä¸ª state hook!</span></span><br><span class="line">   <span class="comment">// MyReact.useEffect(() =&gt; &#123;</span></span><br><span class="line">   <span class="comment">//   console.log('effect', count, text)</span></span><br><span class="line">   <span class="comment">// &#125;, [count, text])</span></span><br><span class="line">   <span class="keyword">return</span> &#123;</span><br><span class="line">     click: <span class="function"><span class="params">()</span> =&gt;</span> setCount(count + <span class="number">1</span>),</span><br><span class="line">     type: <span class="function"><span class="params">txt</span> =&gt;</span> setText(txt),</span><br><span class="line">     noop: <span class="function"><span class="params">()</span> =&gt;</span> setCount(count),</span><br><span class="line">     render:<span class="function"><span class="params">()</span>=&gt;</span>&#123;&#125;</span><br><span class="line">     <span class="comment">// render: () =&gt; console.log('render', &#123; count, text &#125;)</span></span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">let</span> App</span><br><span class="line"> App = MyReact.render(Counter)</span><br><span class="line"> <span class="comment">// effect 0 foo</span></span><br><span class="line"> <span class="comment">// render &#123;count: 0, text: 'foo'&#125;</span></span><br><span class="line"> App.click()</span><br><span class="line"> App = MyReact.render(Counter)</span><br><span class="line"> <span class="comment">// effect 1 foo</span></span><br><span class="line"> <span class="comment">// render &#123;count: 1, text: 'foo'&#125;</span></span><br><span class="line"> App.type(<span class="string">'bar'</span>)</span><br><span class="line"> <span class="comment">// App.type('ss')</span></span><br><span class="line"> <span class="comment">// App = MyReact.render(Counter)</span></span><br><span class="line"> <span class="comment">// // effect 1 bar</span></span><br><span class="line"> <span class="comment">// // render &#123;count: 1, text: 'bar'&#125;</span></span><br><span class="line"> <span class="comment">// App.noop()</span></span><br><span class="line"> <span class="comment">// App = MyReact.render(Counter)</span></span><br><span class="line"> <span class="comment">// // // no effect run</span></span><br><span class="line"> <span class="comment">// // render &#123;count: 1, text: 'bar'&#125;</span></span><br><span class="line"> <span class="comment">// App.click()</span></span><br><span class="line"> <span class="comment">// App = MyReact.render(Counter)</span></span><br></pre></td></tr></table></figure></p><p>  æ€»ç»“ï¼š<br>  ä»¥ä¸‹çš„ç§æœ‰é—­åŒ…å˜é‡å°±æ˜¯è¯´å†…å±‚å‡½æ•°å˜é‡<br>  å®ƒç›¸å½“äºè¿™ä¸ªå†…å±‚å‡½æ•°çš„ç§æœ‰å˜é‡ï¼Œå¤šæ¬¡å†…å±‚å‡½æ•°è°ƒç”¨ï¼Œæ¯æ¬¡çš„ç§æœ‰å˜é‡ç›¸äº’ç‹¬ç«‹ã€‚</p><ol><li>é—­åŒ…å¥—é—­åŒ…ï¼Œç¬¬ä¸€ä¸ªé—­åŒ…è®°ä½hooksä»¬è¦ç”¨åˆ°çš„çŠ¶æ€ï¼Œå­˜æ”¾åœ¨hooksæ•°ç»„ä¸­ï¼Œä»¥é¿å…æ¯æ¬¡rerenderä¹‹åä¸¢å¤±ï¼Œè¿™é‡Œçš„hooksæ•°ç»„æŒ‰ç…§è°ƒç”¨useEffect useStateç­‰é’©å­çš„é¡ºåºå­˜æ”¾stateæˆ–è€…æ˜¯useEffectçš„ä¾èµ–é¡¹çš„å€¼</li><li>useStateä¸­åˆ©ç”¨ç§æœ‰é—­åŒ…å˜é‡è®°ä½è‡ªå·±åœ¨hooksæ•°ç»„ä¸­çš„ä½ç½®ï¼Œç„¶åæ¯æ¬¡æ›´æ–°çš„æ—¶å€™ç”¨è¿™ä¸ªé—­åŒ…å˜é‡ä½œä¸ºç´¢å¼•å»æ‰¾åˆ°è‡ªå·±åœ¨æ•°ç»„ä¸­çš„ä½ç½®ç„¶åæ›´æ–°</li><li>useeffectä¸­åˆ©ç”¨ç§æœ‰é—­åŒ…å˜é‡è®°ä½è‡ªå·±çš„ä¾èµ–é¡¹çš„å€¼ï¼Œæ¯æ¬¡æ›´æ–°çš„æ—¶å€™è°ƒç”¨ä¸€æ¬¡useEffectï¼Œæ³¨æ„æ˜¯è°ƒç”¨useEffectè€Œä¸æ˜¯å®ƒçš„å›è°ƒå‡½æ•°ï¼Œç„¶åæ¯”è¾ƒä¸€ä¸‹æœ€æ–°çš„ä¾èµ–çš„å€¼è·Ÿä¹‹å‰çš„ä¾èµ–é¡¹çš„å€¼ï¼Œå¦‚æœä¸ä¸€æ ·å°±æ›´æ–°é—­åŒ…å˜é‡è®°å½•çš„å½“å‰ä¾èµ–é¡¹çš„å€¼ä»¥ä¾›ä¸‹æ¬¡ä½¿ç”¨ï¼Œå¹¶ä¸”æ‰§è¡Œå›è°ƒå‡½æ•°ã€‚</li></ol><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>React æ”¯æŒ class å’Œ function ä¸¤ç§å½¢å¼çš„ç»„ä»¶ï¼Œclass æ”¯æŒ state å±æ€§å’Œç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼Œè€Œ function ç»„ä»¶ä¹Ÿé€šè¿‡ hooks api å®ç°äº†ç±»ä¼¼çš„åŠŸèƒ½ã€‚<br>fiber æ¶æ„æ˜¯ React åœ¨ 16 ä»¥åå¼•å…¥çš„ï¼Œä¹‹å‰æ˜¯ jsx -&gt; render function -&gt; vdom ç„¶åç›´æ¥é€’å½’æ¸²æŸ“ vdomï¼Œç°åœ¨åˆ™æ˜¯å¤šäº†ä¸€æ­¥ vdom è½¬ fiber çš„ reconcileï¼Œåœ¨ reconcile çš„è¿‡ç¨‹ä¸­åˆ›å»º dom å’Œåš diff å¹¶æ‰“ä¸Šå¢åˆ æ”¹çš„ effectTagï¼Œç„¶åä¸€æ¬¡æ€§ commitã€‚è¿™ä¸ª reconcile æ˜¯å¯è¢«æ‰“æ–­çš„ï¼Œå¯ä»¥è°ƒåº¦ï¼Œä¹Ÿå°±æ˜¯ fiber çš„ scheduleã€‚<br>hooks çš„å®ç°å°±æ˜¯åŸºäº fiber çš„ï¼Œä¼šåœ¨ fiber èŠ‚ç‚¹ä¸Šæ”¾ä¸€ä¸ªé“¾è¡¨ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„ memorizedState å±æ€§ä¸Šå­˜æ”¾äº†å¯¹åº”çš„æ•°æ®ï¼Œç„¶åä¸åŒçš„ hooks api ä½¿ç”¨å¯¹åº”çš„æ•°æ®æ¥å®Œæˆä¸åŒçš„åŠŸèƒ½ã€‚å…¶ä¸­è¿™é‡ŒmemorizedStateé“¾è¡¨çš„ç»´æŠ¤æ ¹æ®æ˜¯å¦æ˜¯åˆæ¬¡æ¸²æŸ“åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼šåˆæ¬¡æ¸²æŸ“ä¸ºmountedé˜¶æ®µï¼Œåç»­ä¸ºupdateé˜¶æ®µ<br>mounted é˜¶æ®µï¼š<br>æˆ‘ä»¬æ¥æ€»ç»“ä¸€ä¸‹åˆå§‹åŒ–é˜¶æ®µ,react-hooksåšçš„äº‹æƒ…ï¼Œåœ¨ä¸€ä¸ªå‡½æ•°ç»„ä»¶ç¬¬ä¸€æ¬¡æ¸²æŸ“æ‰§è¡Œä¸Šä¸‹æ–‡è¿‡ç¨‹ä¸­ï¼Œæ¯ä¸ªreact-hooksæ‰§è¡Œï¼Œéƒ½ä¼šäº§ç”Ÿä¸€ä¸ªhookå¯¹è±¡ï¼Œå¹¶å½¢æˆé“¾è¡¨ç»“æ„ï¼Œç»‘å®šåœ¨workInProgressçš„memoizedStateå±æ€§ä¸Šï¼Œç„¶åreact-hooksä¸Šçš„çŠ¶æ€ï¼Œç»‘å®šåœ¨å½“å‰hookså¯¹è±¡çš„memoizedStateå±æ€§ä¸Šã€‚å¯¹äºeffectå‰¯ä½œç”¨é’©å­ï¼Œä¼šç»‘å®šåœ¨workInProgress.updateQueueä¸Šï¼Œç­‰åˆ°commité˜¶æ®µï¼Œdomæ ‘æ„å»ºå®Œæˆï¼Œå†æ‰§è¡Œæ¯ä¸ª effect å‰¯ä½œç”¨é’©å­ã€‚<br>updateé˜¶æ®µï¼š<br>åœ¨ç»„ä»¶æ›´æ–°æ—¶ï¼Œä¼šåœ¨å»ºå¥½çš„hooksé“¾è¡¨ä¸Šç”¨updateWorkInProgressHookå–å‡ºä¹‹å‰ä¿å­˜çš„hookså¯¹è±¡åšå¯¹åº”çš„æ“ä½œï¼ŒåŒæ—¶æ–°çš„hookå¯¹è±¡ä¹Ÿèƒ½åŸºäºå®ƒåˆ›å»ºï¼Œæœ€åæ›´æ–°å®Œæˆã€‚</p><h1 id="å¸¸è§é—®é¢˜"><a href="#å¸¸è§é—®é¢˜" class="headerlink" title="å¸¸è§é—®é¢˜"></a>å¸¸è§é—®é¢˜</h1><h3 id="ä¸ºä»€ä¹ˆä¸èƒ½å°†hooksæ”¾åœ¨æ¡ä»¶è¯­å¥"><a href="#ä¸ºä»€ä¹ˆä¸èƒ½å°†hooksæ”¾åœ¨æ¡ä»¶è¯­å¥" class="headerlink" title="ä¸ºä»€ä¹ˆä¸èƒ½å°†hooksæ”¾åœ¨æ¡ä»¶è¯­å¥"></a>ä¸ºä»€ä¹ˆä¸èƒ½å°†hooksæ”¾åœ¨æ¡ä»¶è¯­å¥</h3><p>åœ¨ç»„ä»¶ç¬¬ä¸€æ¬¡æ¸²æŸ“çš„æ—¶å€™ï¼Œä¸ºæ¯ä¸ªhookséƒ½åˆ›å»ºäº†ä¸€ä¸ªå¯¹è±¡</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">type Hook = &#123;</span><br><span class="line">  memoizedState: any,</span><br><span class="line">  baseState: any,</span><br><span class="line">  baseUpdate: Update&lt;any, any&gt; | <span class="literal">null</span>,</span><br><span class="line">  queue: UpdateQueue&lt;any, any&gt; | <span class="literal">null</span>,</span><br><span class="line">  next: Hook | <span class="literal">null</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>æœ€ç»ˆå½¢æˆäº†ä¸€ä¸ªé“¾è¡¨</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6311aab76aa0402993f2e576e102e71a~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"><br>memoizedStateå±æ€§å°±æ˜¯ç”¨æ¥å­˜å‚¨ç»„ä»¶ä¸Šä¸€æ¬¡æ›´æ–°åçš„ <code>state</code>,<code>next</code>æŒ‡å‘ä¸‹ä¸€ä¸ªhookå¯¹è±¡ã€‚åœ¨ç»„ä»¶æ›´æ–°çš„è¿‡ç¨‹ä¸­ï¼Œhookså‡½æ•°æ‰§è¡Œçš„é¡ºåºæ˜¯ä¸å˜çš„,å¦‚æœæ”¾åˆ°æ¡ä»¶è¯­å¥ä¸­å¯èƒ½ä¼šå¯¼è‡´é¡ºåºé”™ä¹±ï¼Œå¯¼è‡´å½“å‰hooksæ‹¿åˆ°çš„ä¸æ˜¯è‡ªå·±å¯¹åº”çš„Hookå¯¹è±¡ã€‚</p><h3 id="ä¸ºä»€ä¹ˆuseState-useEffectè¿™é‡Œè¦ä½¿ç”¨é—­åŒ…"><a href="#ä¸ºä»€ä¹ˆuseState-useEffectè¿™é‡Œè¦ä½¿ç”¨é—­åŒ…" class="headerlink" title="ä¸ºä»€ä¹ˆuseState useEffectè¿™é‡Œè¦ä½¿ç”¨é—­åŒ…"></a>ä¸ºä»€ä¹ˆuseState useEffectè¿™é‡Œè¦ä½¿ç”¨é—­åŒ…</h3><p>é¦–å…ˆå›é¡¾ä¸€ä¸‹é—­åŒ…çš„ç‰¹æ€§</p><p><strong>1.å‡½æ•°å†…å†åµŒå¥—å‡½æ•°</strong><br><strong>2.å†…éƒ¨å‡½æ•°å¯ä»¥å¼•ç”¨å¤–å±‚çš„å‚æ•°å’Œå˜é‡</strong><br><strong>3.å‚æ•°å’Œå˜é‡ä¸ä¼šè¢«åƒåœ¾å›æ”¶æœºåˆ¶å›æ”¶</strong></p><p>å¦‚æœè¿™é‡Œè¿™æ ·å†™useState:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">useState(initialValue) &#123;</span><br><span class="line">        <span class="keyword">var</span> _val = initialValue</span><br><span class="line">        <span class="comment">// ä¸ä½¿ç”¨state()å‡½æ•°</span></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">setState</span>(<span class="params">newVal</span>) </span>&#123;</span><br><span class="line">          _val = newVal</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> [_val, setState] <span class="comment">// ç›´æ¥å¯¹å¤–æš´éœ²_val</span></span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure><p> é‚£ä¹ˆæ¯æ¬¡rerenderçš„æ—¶å€™éƒ½ä¼šèµ°ä¸€éï¼š<br> <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> _val = initialValue</span><br></pre></td></tr></table></figure></p><p> è¿™æ ·çš„è¯æ¯æ¬¡rerenderä¹‹åï¼Œstateçš„å€¼éƒ½å˜æˆåˆå§‹å€¼äº†ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¦ç”¨åˆ°é—­åŒ…å˜é‡hooksçš„åŸç†</p><h3 id="é—­åŒ…é™·é˜±"><a href="#é—­åŒ…é™·é˜±" class="headerlink" title="é—­åŒ…é™·é˜±"></a>é—­åŒ…é™·é˜±</h3><h4 id="å›é¡¾é—­åŒ…"><a href="#å›é¡¾é—­åŒ…" class="headerlink" title="å›é¡¾é—­åŒ…"></a>å›é¡¾é—­åŒ…</h4><p>é—­åŒ…æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å¯¹è±¡å®ƒç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼Œæ‰§è¡Œä¸Šä¸‹æ–‡Aä»¥åŠåœ¨Aä¸­åˆ›å»ºçš„å‡½æ•°Bã€‚å½“Bæ‰§è¡Œæ—¶ï¼Œå¦‚æœè®¿é—®äº†Aä¸­çš„å˜é‡å¯¹è±¡ï¼Œé‚£ä¹ˆé—­åŒ…å°±ä¼šäº§ç”Ÿã€‚å› æ­¤é—­åŒ…å…¶å®ä¸å±€é™äºæˆ‘ä»¬å¸¸è§çš„è¿™ç§å½¢å¼ï¼š<br><img src="https://p3.ssl.qhimg.com/t01566e685bf8b8dc0b.png" alt="image"><br>ä¼šè½¬æ¢æˆï¼š<br><img src="https://p0.ssl.qhimg.com/t01bdc2b37e598424ff.png" alt="image"><br>ä¹Ÿå°±æ˜¯è¿™æ ·ä¹Ÿä¼šäº§ç”Ÿé—­åŒ…</p><p>æˆ‘ä»¬å°†ä¸Šé¢é—­åŒ…å®šä¹‰çš„Aï¼ŒBç”¨æœ¬ä¾‹ä¸­çš„åç§°æ›¿æ¢ä¸€ä¸‹ï¼šè‡ªæ‰§è¡Œå‡½æ•°AppModuleä»¥åŠåœ¨AppModuleä¸­åˆ›å»ºçš„å‡½æ•°Appã€‚å½“Appåœ¨render ä¸­æ‰§è¡Œæ—¶ï¼Œè®¿é—®äº†AppModuleä¸­çš„å˜é‡å¯¹è±¡(å®šä¹‰äº†å˜é‡Counter)ï¼Œé‚£ä¹ˆé—­åŒ…å°±ä¼šäº§ç”Ÿã€‚æ ¹æ®é—­åŒ…çš„ç”Ÿæˆæ¡ä»¶ä¸å®è·µåœºæ™¯ï¼Œæˆ‘ä»¬ä¼šå‘ ç°ï¼Œæ¨¡å—ä¸­ï¼Œéå¸¸å®¹æ˜“ç”Ÿæˆé—­åŒ…,ES6 module æ¯ä¸ªæ¨¡å—çš„ä½œç”¨åŸŸéƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œä¸å±äºå…¨å±€ä½œç”¨åŸŸ .æ¯ä¸€ä¸ªJSæ¨¡å—éƒ½å¯ä»¥è®¤ä¸ºæ˜¯ä¸€ä¸ªç‹¬ ç«‹çš„ä½œç”¨åŸŸï¼Œå½“ä»£ç æ‰§è¡Œæ—¶ï¼Œè¯¥è¯æ³•ä½œç”¨åŸŸåˆ›å»ºæ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œå¦‚æœåœ¨æ¨¡å—å†…éƒ¨ï¼Œåˆ›å»ºäº†å¯ä¾›å¤–éƒ¨å¼•ç”¨è®¿é—® çš„å‡½æ•°æ—¶ï¼Œå°±ä¸ºé—­åŒ…çš„äº§ç”Ÿæä¾›äº†æ¡ä»¶ï¼Œåªè¦è¯¥å‡½æ•°åœ¨å¤–éƒ¨æ‰§è¡Œè®¿é—®äº†è¯¥JSæ¨¡å—å†…éƒ¨çš„å…¶ä»–å˜é‡ï¼Œé—­åŒ…å°±ä¼šäº§ç”Ÿã€‚</p><p><strong>é—­åŒ…é™·é˜±ä¸€</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useEffect, useState &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">"react-dom"</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = useState(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> clickCb = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// è¿™é‡Œæ‹¿åˆ°çš„countå§‹ç»ˆæ˜¯åˆå§‹å€¼</span></span><br><span class="line">    setCount(count + <span class="number">1</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">document</span>.addEventListener(<span class="string">"click"</span>, clickCb);</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">document</span>.removeEventListener(<span class="string">"click"</span>, clickCb);</span><br><span class="line">  &#125;, []);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;&gt;</span><br><span class="line">      &lt;button&gt;+<span class="number">1</span>&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">      &lt;span&gt;count:&#123;count&#125;&lt;/</span>span&gt;</span><br><span class="line">    &lt;<span class="regexp">/&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">ReactDOM.render(&lt;App /</span>&gt;, <span class="built_in">document</span>.getElementById(<span class="string">"root"</span>));</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„é—­åŒ…é™·é˜±æ‰€è¯´çš„é—­åŒ…å®é™…ä¸Šæ˜¯äº‹ä»¶ç›‘å¬å™¨çš„å›è°ƒå‡½æ•°æ‰€å½¢æˆçš„é—­åŒ…ï¼Œè€Œé—­åŒ…æœ€å¤§çš„ç‰¹ç‚¹ï¼Œå°±æ˜¯å®ƒå¯ä»¥â€œè®°ä½â€è¯ç”Ÿçš„ç¯å¢ƒï¼Œå› ä¸ºuseEffectçš„å›è°ƒåªæ‰§è¡Œäº†ä¸€æ¬¡ï¼Œè¿™ä¸ªå›è°ƒå‡½æ•°ä½œç”¨åŸŸä¸­çš„é—­åŒ…æ°¸è¿œå¼•ç”¨ç€Appå‡½æ•°ç¬¬ä¸€æ¬¡æ‰§è¡Œæ—¶åˆ›å»ºçš„ä½œç”¨åŸŸã€‚</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/89f4fa356ac342baa92d197ceecb1201~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p><h4 id="æ€ä¹ˆè§£å†³"><a href="#æ€ä¹ˆè§£å†³" class="headerlink" title="æ€ä¹ˆè§£å†³"></a>æ€ä¹ˆè§£å†³</h4><p>æ–¹å¼ä¸€ï¼šuseLayoutEffect + useRef</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = useState(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> countRef = useRef(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> handleBtnClick = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    setCount(count + <span class="number">1</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">const</span> clickCb = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"clickCb countRef.current"</span>, countRef.current);</span><br><span class="line">  &#125;;</span><br><span class="line">  useLayoutEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;       <span class="comment">// +</span></span><br><span class="line">    countRef.current = count;   <span class="comment">// + è¿™é‡Œæ˜¯æ¯å½“countæ”¹å˜è‡ªåŠ¨åŒæ­¥æ›´æ–°countRefçš„å€¼</span></span><br><span class="line">  &#125;, [count]);                  <span class="comment">// +</span></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  </span><br><span class="line">    <span class="built_in">document</span>.addEventListener(<span class="string">"click"</span>, clickCb);</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">document</span>.removeEventListener(<span class="string">"click"</span>, clickCb);</span><br><span class="line">  &#125;, []);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;&gt;</span><br><span class="line">      &lt;button onClick=&#123;handleBtnClick&#125;&gt;+<span class="number">1</span>&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">      &lt;span&gt;count:&#123;count&#125;&lt;/</span>span&gt;</span><br><span class="line">    &lt;<span class="regexp">/&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><h5 id="ä¸ºä»€ä¹ˆä¸æ˜¯useEFfect"><a href="#ä¸ºä»€ä¹ˆä¸æ˜¯useEFfect" class="headerlink" title="ä¸ºä»€ä¹ˆä¸æ˜¯useEFfect?"></a>ä¸ºä»€ä¹ˆä¸æ˜¯useEFfect?</h5><h6 id="useEffectçš„æ‰§è¡Œæ—¶æœº-vs-useEffectLayout"><a href="#useEffectçš„æ‰§è¡Œæ—¶æœº-vs-useEffectLayout" class="headerlink" title="useEffectçš„æ‰§è¡Œæ—¶æœº vs useEffectLayout"></a>useEffectçš„æ‰§è¡Œæ—¶æœº vs useEffectLayout</h6><p>useEffect åœ¨æ¯è½®æ¸²æŸ“ä¹‹åæ‰§è¡Œ<br>useEffectç¡®å®ç›¸å½“äºå¼‚æ­¥æ‰§è¡Œï¼Œå®ƒæ˜¯æ·±åº¦ä¼˜å…ˆï¼Œä¸”ä»æœ€åº•å±‚çš„å­ç»„ä»¶å¼€å§‹æ‰§è¡Œï¼Œå†’æ³¡åˆ°æœ€çˆ¶çº§ç»„ä»¶ï¼Œä½†æ˜¯ä¹Ÿä¸æ˜¯å®Œå…¨çš„å¼‚æ­¥ã€‚æ¯ä¸ªç»„ä»¶å†…çš„useEffectä¹Ÿæ˜¯æŒ‰é¡ºæ‰§è¡Œã€‚<br>useLayoutEffectç±»ä¼¼äºuseEffectï¼Œæ·±åº¦ä¼˜å…ˆï¼Œä½†æ‰§è¡Œä¼˜å…ˆçº§é«˜äºuseEffectï¼Œè€Œä¸”æ²¡æœ‰é˜»å¡dom render ã€‚<br><strong>useLayoutEffectçš„æ˜¯åœ¨æ¸²æŸ“å™¨æ‰§è¡Œå½“å‰æ¸²æŸ“ç•Œé¢ä»»åŠ¡æ—¶ï¼ŒåŒæ­¥æ‰§è¡Œã€‚<br>åœ¨å½“å‰ä¸€è½®çš„Reconcilerä»»åŠ¡è°ƒåº¦è¿‡ç¨‹ä¸­ï¼Œåœ¨æ¸²æŸ“å™¨æ‰§è¡Œå®Œå½“å‰ä»»åŠ¡åï¼Œæ‰ä¼šå¼‚æ­¥è°ƒç”¨useEffectã€‚<br>useLayoutEffectå…ˆäºuseEffectæ‰§è¡Œï¼Œå¹¶ä¸”å­ç»„ä»¶ä¼˜å…ˆæ‰§è¡Œã€‚</strong><br>å¦‚æœæ˜¯useEffectçš„è¯ï¼Œè¿˜æ²¡æ‰§è¡Œå®ƒå°±è§¦å‘äº†clickäº‹ä»¶æ‰“å°äº†å€¼</p><p>æ–¹å¼äºŒï¼šç›´æ¥åœ¨å¤–é¢æ›´æ–°useRefçš„å€¼</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">useLatest</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> ref = useRef(value);</span><br><span class="line">  ref.current = value;</span><br><span class="line">  <span class="keyword">return</span> ref;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = useState(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> latestCountRef = useLatest(count);</span><br><span class="line">  <span class="keyword">const</span> handleBtnClick = <span class="function"><span class="params">()</span> =&gt;</span> setCount(count + <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">const</span> clickCb = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"clickCb latestCountRef"</span>, latestCountRef.current);</span><br><span class="line">  &#125;;</span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">document</span>.addEventListener(<span class="string">"click"</span>, clickCb);</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">document</span>.removeEventListener(<span class="string">"click"</span>, clickCb);</span><br><span class="line">  &#125;, []);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;&gt;</span><br><span class="line">      &lt;button onClick=&#123;handleBtnClick&#125;&gt;+<span class="number">1</span>&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">      &lt;span&gt;count:&#123;count&#125;&lt;/</span>span&gt;</span><br><span class="line">    &lt;<span class="regexp">/&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">ReactDOM.render(&lt;App /</span>&gt;, <span class="built_in">document</span>.getElementById(<span class="string">"root"</span>));</span><br></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆæ˜¯useRef?<br>countRefå¯¹è±¡å’Œå‡½æ•°Appå¤šæ¬¡é‡æ–°renderæ—¶æ“ä½œçš„countRefå¯¹è±¡æ˜¯åŒä¸€ä¸ªå†…å­˜åœ°å€(useRefåœ¨hook.memoizedStateä¿å­˜ç€)ï¼Œæ‰€ä»¥æ˜¯å¯ä»¥è·å–åˆ°é¢„æœŸçš„å€¼çš„ã€‚<br>æ–¹å¼ä¸‰ï¼šç›´æ¥ä¿®æ”¹stateä¸ºå¯¹è±¡ï¼Œç„¶åæ›´æ”¹stateçš„æ—¶å€™ï¼š</p><p>æ–¹å¼å››ï¼šå¢åŠ ä¾èµ–é¡¹ï¼šcountè®©å›è°ƒå‡½æ•°é‡æ–°æ‰§è¡Œ</p><p><a href="https://www.yuque.com/kongliyuan/kb/qav38iavad20p55l/edit" target="_blank" rel="noopener">useEffect</a></p><p>** é—­åŒ…é™·é˜±äºŒ **<br>ä»£ç æè¿°ï¼šä¸€ä¸ªå¡ç‰‡ä¸Šæœ‰å¤šä¸ªä¸‹è½½æŒ‰é’®ï¼Œç‚¹å‡»å<br>è¯·æ±‚æ–‡ä»¶åœ°å€ã€‚<br>é—®é¢˜æè¿°ï¼šæµ‹è¯•æ—¶å‘ç°é—®é¢˜ï¼šå¦‚æœè¿ç»­ç‚¹å‡» a å’Œ b<br> æŒ‰é’®ï¼Œå½“ b ä¸‹è½½ç»“æŸæ—¶ï¼Œa æŒ‰é’®ä¼šè¢«é‡ç½®ä¸ºâ€ä¸‹è½½ä¸­â€ã€‚</p><p><img src="https://p0.ssl.qhimg.com/t0175443ec20d7befd0.png" alt="image"></p><p>åŸå› ï¼šæ€»ç»“å…¶å®å°±æ˜¯handle clickä¸­å»¶è¿Ÿ3ç§’ä¹‹åé‚£é‡Œæ‹¿åˆ°çš„å¹¶ä¸æ˜¯æœ€ æ–°çš„stateå€¼ï¼Œæ‰€ä»¥æ¯æ¬¡éƒ½è®¾ç½®äº†é”™è¯¯çš„stateã€‚ä¸¤æ¬¡æŒ‰é’®ç‚¹å‡» äº§ç”Ÿäº† 4 æ¬¡ setStateï¼Œå› æ­¤å¯¼è‡´ 4 æ¬¡ re-renderï¼Œç®—ä¸Šåˆå§‹ åŒ–çš„ renderï¼ŒApp å…±æ‰§è¡Œäº† 5 æ¬¡ã€‚<br>ä¸ºä»€ä¹ˆï¼Ÿå›é¡¾æˆ‘ä»¬ä¹‹å‰æ‰€è¯´çš„é—­åŒ…ç†å¿µï¼Œè¿™é‡Œç”¨åˆ°useStateå®é™…ä¸Šä¹Ÿæ˜¯å½¢æˆäº†ä¸€ä¸ªé—­åŒ…ï¼Œè¿™é‡Œçš„useStateå¯¹åº”æˆ‘ä»¬<br>ä¹‹å‰æ‰€è¯´çš„JSæ¨¡å—ï¼Œè€Œä¸”æˆ‘ä»¬æ°å·§åœ¨å¦ä¸€ä¸ªå‡½æ•°å†…éƒ¨ç”¨åˆ°äº†ä»–æä¾›çš„stateã€‚<br>å®é™…ä¸Šçœ‹ä¼¼æ˜¯bugçš„é—®é¢˜æ˜¯ç¬¦åˆReactçš„è®¾è®¡ç†å¿µçš„, Reactæœ‰ä¸€ä¸ªç»å…¸å…¬å¼ï¼šui=f(data),å³åŒæ ·çš„è¾“å…¥å¿…å®šæœ‰åŒæ ·çš„<br>ç»“æœï¼Œ<strong>å‡½æ•°å¼ç»„ä»¶æ•è·äº†æ¸²æŸ“æ—¶æ‰€ç”¨çš„å€¼ï¼Œå› æ­¤ç»„ä»¶æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½ä¼šæœ‰è‡ªå·±çš„propså’Œstateã€‚æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½ä¼šæœ‰<br>è‡ªå·±çš„äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œè€Œè¿™é‡Œæ¯æ¬¡æ¸²æŸ“éƒ½æœ‰ç‹¬ç«‹çš„ state ä¸Šä¸‹æ–‡ã€‚</strong></p><h3 id="Hooks-æ˜¯å¦å› ä¸ºåœ¨æ¸²æŸ“ä¸­åˆ›å»ºå‡½æ•°è€Œå˜æ…¢ï¼Ÿ"><a href="#Hooks-æ˜¯å¦å› ä¸ºåœ¨æ¸²æŸ“ä¸­åˆ›å»ºå‡½æ•°è€Œå˜æ…¢ï¼Ÿ" class="headerlink" title="Hooks æ˜¯å¦å› ä¸ºåœ¨æ¸²æŸ“ä¸­åˆ›å»ºå‡½æ•°è€Œå˜æ…¢ï¼Ÿ"></a>Hooks æ˜¯å¦å› ä¸ºåœ¨æ¸²æŸ“ä¸­åˆ›å»ºå‡½æ•°è€Œå˜æ…¢ï¼Ÿ</h3><p>ä¸ä¼šã€‚åœ¨ç°ä»£æµè§ˆå™¨ä¸­ï¼Œé™¤äº†åœ¨æç«¯æƒ…å†µä¸‹ï¼Œé—­åŒ…çš„åŸå§‹æ€§èƒ½ä¸ç±»ç›¸æ¯”æ²¡æœ‰æ˜¾ç€å·®å¼‚ã€‚</p><p>æ­¤å¤–ï¼Œè€ƒè™‘åˆ° Hooks çš„è®¾è®¡åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢æ›´é«˜æ•ˆï¼š</p><ul><li>æŒ‚é’©é¿å…äº†ç±»æ‰€éœ€çš„å¤§é‡å¼€é”€ï¼Œä¾‹å¦‚åœ¨æ„é€ å‡½æ•°ä¸­åˆ›å»ºç±»å®ä¾‹å’Œç»‘å®šäº‹ä»¶å¤„ç†ç¨‹åºçš„æˆæœ¬ã€‚</li><li>ä½¿ç”¨ Hooks çš„æƒ¯ç”¨ä»£ç ä¸éœ€è¦åœ¨<strong>ä½¿ç”¨é«˜é˜¶ç»„ä»¶ã€æ¸²æŸ“é“å…·å’Œä¸Šä¸‹æ–‡çš„ä»£ç åº“ä¸­æ™®éå­˜åœ¨çš„æ·±å±‚ç»„ä»¶æ ‘åµŒå¥—ã€‚ä½¿ç”¨æ›´å°çš„ç»„ä»¶æ ‘ï¼ŒReact è¦åšçš„å·¥ä½œæ›´å°‘</strong>ã€‚</li></ul><h3 id="å¦‚ä½•æµ‹é‡-DOM-èŠ‚ç‚¹ï¼Ÿ"><a href="#å¦‚ä½•æµ‹é‡-DOM-èŠ‚ç‚¹ï¼Ÿ" class="headerlink" title="å¦‚ä½•æµ‹é‡ DOM èŠ‚ç‚¹ï¼Ÿ"></a>å¦‚ä½•æµ‹é‡ DOM èŠ‚ç‚¹ï¼Ÿ</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MeasureExample</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [height, setHeight] = useState(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> measuredRef = useCallback(<span class="function"><span class="params">node</span> =&gt;</span> &#123;    <span class="keyword">if</span> (node !== <span class="literal">null</span>) &#123;      setHeight(node.getBoundingClientRect().height);    &#125;  &#125;, []);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;&gt;</span><br><span class="line">      &lt;h1 ref=&#123;measuredRef&#125;&gt;Hello, world&lt;<span class="regexp">/h1&gt;      &lt;h2&gt;The above header is &#123;Math.round(height)&#125;px tall&lt;/</span>h2&gt;</span><br><span class="line">    &lt;<span class="regexp">/&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><ul><li><a href="https://zhuanlan.zhihu.com/p/66923924" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/66923924</a></li><li><a href="https://www.51cto.com/article/704138.html" target="_blank" rel="noopener">https://www.51cto.com/article/704138.html</a></li><li><a href="https://cooperhu.com/2020/09/03/useEffect-componentDidMount/" target="_blank" rel="noopener">https://cooperhu.com/2020/09/03/useEffect-componentDidMount/</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> react </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>çº¿ä¸Šå¦‚ä½•åƒæœ¬åœ°ä¸€æ ·debug</title>
      <link href="/ashley271017.github.io/2022/09/23/%E7%BA%BF%E4%B8%8A%E5%A6%82%E4%BD%95%E5%83%8F%E6%9C%AC%E5%9C%B0%E4%B8%80%E6%A0%B7debug/"/>
      <url>/ashley271017.github.io/2022/09/23/%E7%BA%BF%E4%B8%8A%E5%A6%82%E4%BD%95%E5%83%8F%E6%9C%AC%E5%9C%B0%E4%B8%80%E6%A0%B7debug/</url>
      
        <content type="html"><![CDATA[<p>æˆ‘ä¹‹å‰çŠ¯äº†ä¸€ä¸ªæ„šè ¢çš„é”™è¯¯ï¼šæ¯”å¦‚æˆ‘æƒ³åƒåœ¨æœ¬åœ°debugä¸€æ ·debugçº¿ä¸Šçš„é¡µé¢ï¼Œç›´æ¥å†™ä¸Šä»£ç†å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.360kuai.com http://dev.360kuai.com:57824</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™æ ·è·Ÿ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.360kuai.com  www.baidu.com</span><br></pre></td></tr></table></figure><p>æœ‰å•¥åŒºåˆ«ï¼Ÿ</p><p>åŸæœ¬çš„æ–¹æ¡ˆï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// devServer</span></span><br><span class="line">writeToDisk(curPath) &#123;</span><br><span class="line"><span class="keyword">return</span> onlineDebug ? <span class="literal">true</span> : ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// webpack plugin è¿™é‡Œè™½ç„¶æœ‰ç°æˆçš„é…ç½®å¯ç”¨ ä½†æ˜¯ä¸çŸ¥é“ä¸ºä»€ä¹ˆæ— è®ºæ€ä¹ˆé…ç½® æ€»æ˜¯ä¼šåœ¨åŸæ¥çš„åŸºç¡€ä¸Šç”Ÿæˆä¸€ä¸ªæ–°çš„sourcemappingUrl ä¸¤ä¸ªURLå¹¶å­˜æ ¹æœ¬æ²¡ç”¨</span></span><br><span class="line"><span class="keyword">const</span> ReplacePlugin=<span class="built_in">require</span>(<span class="string">'./replace_sourcemap_url'</span>);</span><br><span class="line"><span class="keyword">new</span> ReplacePlugin()</span><br><span class="line"></span><br><span class="line"><span class="comment">// replace_sourcemap_url æŠŠç”Ÿæˆçš„sourceMappingURLæ”¹ä¸ºæœ¬åœ°çš„åœ°å€</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> RawSource = <span class="built_in">require</span>(<span class="string">'webpack-sources'</span>).RawSource;</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> fs=<span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> pathPrefix = <span class="string">`file://<span class="subst">$&#123;path.resolve(__dirname, <span class="string">'../public/static'</span>)&#125;</span>`</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="class"><span class="keyword">class</span> <span class="title">ReplacePlugin</span> </span>&#123;</span><br><span class="line">  apply(compiler) &#123;</span><br><span class="line">    compiler.hooks.emit.tap(<span class="string">'ReplacePlugin'</span>, (compilation, cb) =&gt; &#123;</span><br><span class="line">      <span class="keyword">const</span> reg = <span class="regexp">/sourceMappingURL=[^/]+.map$/</span>;</span><br><span class="line">      <span class="keyword">const</span> files = compilation.getAssets();</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">const</span> file <span class="keyword">of</span> files) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (<span class="regexp">/.js$/</span>.test(file.name)) &#123;</span><br><span class="line">            <span class="keyword">const</span> _path = <span class="string">`sourceMappingURL=<span class="subst">$&#123;pathPrefix&#125;</span>/<span class="subst">$&#123;file.name&#125;</span>.map`</span>;</span><br><span class="line">            <span class="keyword">if</span>(pathPrefix.includes(<span class="string">'jenkins/workspace'</span>))&#123;</span><br><span class="line">              <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">const</span> content=file.source.source();</span><br><span class="line">            compilation.updateAsset(</span><br><span class="line">              file.name,</span><br><span class="line">              <span class="keyword">new</span> RawSource(content.replace(reg, _path))</span><br><span class="line">            );</span><br><span class="line">          &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(err, <span class="string">'err'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘æŠŠçº¿ä¸Šæºæ–‡ä»¶çš„<code>sourceMappingURL</code>æ”¹æˆäº†æœ¬åœ°çš„mapæ–‡ä»¶æ‰€åœ¨çš„åœ°å€ï¼Œä»¥ä¸ºè¿™æ ·æ—¢èƒ½åšåˆ°åˆ©ç”¨äº†source mapåŠŸèƒ½åˆä¸ä¼šè®©åˆ«äººçœ‹åˆ°ï¼Œä½†å®é™…ä¸Šæ˜¯ï¼Œè¿™æ ·åšåªèƒ½å¯¹è‡ªå·±æœ‰ç”¨ï¼Œå› ä¸ºè·¯å¾„éƒ½æ˜¯è‡ªå·±ç”µè„‘ä¸Šçš„ï¼Œå¯¹åˆ«çš„åŒäº‹å°±æ²¡ç”¨äº†ã€‚<br>è™½ç„¶ä½†æ˜¯ï¼Œå¯ä»¥æŠŠè·¯å¾„æ”¹æˆä»…ä»…å†…ç½‘å¯è®¿é—®çš„å§ï¼š<br>æ€»ç»“å°±æ˜¯ï¼š</p><ul><li>sourcemapä¸Šä¼ åˆ°ä»…ä»…å†…ç½‘å¯è®¿é—®çš„cdn</li><li>ç”Ÿæˆçš„sourcemapurlåŠ ä¸Špublicpathä¸ºè¯¥cdn<br>ä½†æ˜¯è¿™æ ·çš„è¯æ€ä¹ˆèƒ½åœ¨æœ¬åœ°è¾¹æ”¹ï¼Œè¾¹åŒæ­¥çº¿ä¸Šå‘¢ï¼Ÿ<code>writetodisk</code>ä¹Ÿæ²¡æ„ä¹‰äº†ã€‚ã€‚ã€‚æƒ³è¾¹æ”¹è¾¹çœ‹è¿˜æ˜¯å¾—é <code>whistle</code>ã€‚ã€‚ã€‚<br>æˆ–è€…è¯´sourceMapçš„æ˜ å°„ä¿®æ”¹åº”è¯¥æ”¾åœ¨æµè§ˆå™¨å‘èµ·è¯·æ±‚çš„æ—¶å€™è€Œä¸æ˜¯æ‰“åŒ…çš„æ—¶å€™ã€‚</li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> debug </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vueå“åº”å¼åŸç†</title>
      <link href="/ashley271017.github.io/2022/09/10/vue%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8E%9F%E7%90%86/"/>
      <url>/ashley271017.github.io/2022/09/10/vue%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8E%9F%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h3 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h3><ul><li>Dep</li></ul><p><del>ç®¡ç†ä¾èµ–çš„ï¼Œæ¯ä¸€ä¸ªä¾èµ–å°±æ˜¯ä¸€ä¸ªè§‚å¯Ÿè€…ï¼Œå½“è§‚å¯Ÿçš„ç›®æ ‡å˜åŒ–çš„æ—¶å€™å°±ä¼šåšå‡ºååº”ï¼Œæ‰®æ¼”è§‚å¯Ÿç›®æ ‡çš„è§’è‰²ï¼Œæ¯ä¸€ä¸ªæ•°æ®éƒ½ä¼šæœ‰Depç±»å®ä¾‹ï¼Œå®ƒéƒ¨æœ‰ä¸ªè®¢é˜…è€…é˜Ÿåˆ—ï¼Œä¿å­˜ç€ä¾èµ–æœ¬æ•°æ®çš„è§‚å¯Ÿè€…ï¼Œå½“æœ¬æ•°æ®å˜æ›´æ—¶ï¼Œè°ƒç”¨dep.notify()é€šçŸ¥è§‚å¯Ÿè€…</del></p><p>Depæ˜¯ä¸€ä¸ªç®€å•çš„è®¢é˜…å‘å¸ƒæ¨¡å¼çš„å®ç°ã€‚Depç±»æ˜¯ä¸€ä¸ªå¯è§‚å¯Ÿå¯¹è±¡ï¼Œå¯ä»¥æœ‰å¤šä¸ªæŒ‡ä»¤è®¢é˜…å®ƒã€‚å½“å®ƒçš„notify()æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œæ‰€æœ‰è®¢é˜…è€…éƒ½ä¼šè¢«é€šçŸ¥ã€‚åœ¨Vue.jsä¸­ï¼Œæ¯ä¸ªæ•°æ®å±æ€§éƒ½æœ‰ä¸€ä¸ªDepå®ä¾‹ï¼Œå½“æ•°æ®å±æ€§è¢«ä¿®æ”¹æ—¶ï¼Œä¼šé€šçŸ¥Depå®ä¾‹ï¼Œç„¶åDepå®ä¾‹ä¼šé€šçŸ¥æ‰€æœ‰è®¢é˜…å®ƒçš„æŒ‡ä»¤æ›´æ–°è§†å›¾ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å½“æœ¬æ•°æ®å˜æ›´æ—¶ï¼Œè°ƒç”¨dep.notify()é€šçŸ¥è§‚å¯Ÿè€… - Watcherï¼šæ‰®æ¼”è§‚å¯Ÿè€…çš„è§’è‰²ï¼Œè¿›è¡Œè§‚å¯Ÿè€…å‡½æ•°çš„åŒ…è£…å¤„ç†ã€‚å¦‚render()å‡½æ•°ï¼Œä¼šè¢«è¿›è¡ŒåŒ…è£…æˆä¸€ä¸ªWatcherå®ä¾‹ - Observerï¼šè¾…åŠ©çš„å¯è§‚æµ‹ç±»ï¼Œæ•°ç»„/å¯¹è±¡é€šè¿‡å®ƒçš„è½¬åŒ–ï¼Œå¯æˆä¸ºå¯è§‚æµ‹æ•°æ®</span></span><br><span class="line"><span class="keyword">let</span> uid = <span class="number">0</span>; </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dep</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> target = <span class="literal">null</span>;  <span class="comment">// å·§å¦™çš„è®¾è®¡ï¼</span></span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">this</span>.id = uid++;</span><br><span class="line">        <span class="comment">// æ¯ä¸€ä¸ªæ•°æ®éƒ½ä¼šæœ‰Depç±»å®ä¾‹ï¼Œå®ƒå†…éƒ¨æœ‰ä¸ªsubsé˜Ÿåˆ—ï¼Œsubså°±æ˜¯subscribersçš„æ„æ€ï¼Œä¿å­˜ç€ä¾èµ–æœ¬æ•°æ®çš„è§‚å¯Ÿè€…</span></span><br><span class="line">        <span class="keyword">this</span>.subs = [];</span><br><span class="line">    &#125;</span><br><span class="line">    addSub(sub) &#123;</span><br><span class="line">        <span class="comment">// å…¶ä¸­å­˜æ”¾çš„æ˜¯å¤šä¸ªwatcher</span></span><br><span class="line">        <span class="keyword">this</span>.subs.push(sub);</span><br><span class="line">    &#125;</span><br><span class="line">    removeSub(sub) &#123;</span><br><span class="line">        <span class="keyword">this</span>.subs.$remove(sub);</span><br><span class="line">    &#125;</span><br><span class="line">    depend() &#123;</span><br><span class="line">    <span class="comment">// ç”±äºJavaScriptæ˜¯å•çº¿ç¨‹æ¨¡å‹ï¼Œæ‰€ä»¥è™½ç„¶æœ‰å¤šä¸ªè§‚å¯Ÿè€…å‡½æ•°ï¼Œä½†æ˜¯ä¸€ä¸ªæ—¶åˆ»å†…ï¼Œå°±åªä¼šæœ‰ä¸€ä¸ªè§‚å¯Ÿè€…å‡½æ•°åœ¨æ‰§è¡Œï¼Œé‚£ä¹ˆæ­¤åˆ»æ­£åœ¨æ‰§è¡Œçš„é‚£ä¸ªè§‚å¯Ÿè€…å‡½æ•°ï¼Œæ‰€å¯¹åº”çš„Watcherå®ä¾‹ï¼Œä¾¿ä¼šè¢«èµ‹ç»™Dep.targetè¿™ä¸€ç±»å˜é‡ï¼Œä»è€Œåªè¦è®¿é—®Dep.targetå°±èƒ½çŸ¥é“å½“å‰çš„è§‚å¯Ÿè€…æ˜¯è°ã€‚ åœ¨åç»­çš„ä¾èµ–æ”¶é›†å·¥ä½œé‡Œï¼Œgetteré‡Œä¼šè°ƒç”¨dep.depend()ï¼Œè€Œsetteré‡Œåˆ™ä¼šè°ƒç”¨dep.notify()</span></span><br><span class="line">        Dep.target.addDep(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    notify() &#123;</span><br><span class="line">        <span class="keyword">const</span> subs = <span class="keyword">this</span>.subs.slice();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, l = subs.length; i &lt; l; i++) &#123;</span><br><span class="line">            subs[i].update();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>Watcher<br>æ‰®æ¼”è§‚å¯Ÿè€…çš„è§’è‰²ï¼Œè¿›è¡Œè§‚å¯Ÿè€…å‡½æ•°çš„åŒ…è£…å¤„ç†ã€‚å¦‚render()å‡½æ•°ï¼Œä¼šè¢«è¿›è¡ŒåŒ…è£…æˆä¸€ä¸ªWatcherå®ä¾‹ - Observerï¼šè¾…åŠ©çš„å¯è§‚æµ‹ç±»ï¼Œæ•°ç»„/è±¡é€šè¿‡å®ƒçš„è½¬åŒ–ï¼Œå¯æˆä¸ºå¯è§‚æŸ¥æ•°æ®ã€‚<br>ä¸€ä¸ªç»„ä»¶é‡Œå¯ä»¥æœ‰å¤šä¸ªWatcherç±»å®ä¾‹,åŒæ—¶æ¯ä¸ªç»„ä»¶å®ä¾‹éƒ½æœ‰ç›¸åº”çš„watcherå®ä¾‹ - æ¸²æŸ“ç»„ä»¶çš„è¿‡ç¨‹ï¼Œä¼šæŠŠå±æ€§è®°å½•ä¸ºä¾èµ– - å½“æˆ‘ä»¬æ“çºµä¸€ä¸ªæ•°æ®æ—¶ï¼Œä¾èµ–é¡¹çš„setterä¼šè¢«è°ƒç”¨ï¼Œä»è€Œé€šçŸ¥watcheré‡æ–°è®¡ç®—ï¼Œä»è€Œè‡´ä½¿ä¸ä¹‹ç›¸å…³è”çš„ç»„ä»¶å¾—ä»¥æ›´æ–°</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨åˆå§‹å‡†å¤‡å·¥ä½œé‡Œï¼Œä¼šå°†å½“å‰Watcherå®ä¾‹èµ‹ç»™Dep.target</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Watcher</span>(<span class="params">vm, node, name, type</span>) </span>&#123;</span><br><span class="line">    Dep.target = <span class="keyword">this</span>;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">    <span class="keyword">this</span>.node = node;</span><br><span class="line">    <span class="keyword">this</span>.vm = vm;</span><br><span class="line">    <span class="keyword">this</span>.type = type;</span><br><span class="line">    <span class="comment">// å½“æŸä¸ªæ•°æ®æ›´æ–°æ—¶ï¼Œç”±äºè¿›è¡Œäº†setteræ‹¦æˆªï¼Œæ‰€ä»¥ä¼šå¯¹è¯¥æ•°æ®çš„dep.subsè¿™ä¸€è§‚å¯Ÿè€…é˜Ÿåˆ—é‡Œçš„watchersè¿›è¡Œé€šçŸ¥ï¼Œä»è€Œæ‰§è¡Œwatcher.update()æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">this</span>.update();</span><br><span class="line">    Dep.target = <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="depä¸watcherä¹‹é—´çš„å…³ç³»"><a href="#depä¸watcherä¹‹é—´çš„å…³ç³»" class="headerlink" title="depä¸watcherä¹‹é—´çš„å…³ç³»"></a>depä¸watcherä¹‹é—´çš„å…³ç³»</h3><p>Depæ˜¯ä¸€ä¸ªä¾èµ–æ”¶é›†å™¨ï¼Œå®ƒç”¨äºæ”¶é›†ä¾èµ–äºæ•°æ®çš„æ‰€æœ‰Watcherå®ä¾‹ã€‚å½“æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒDepä¼šé€šçŸ¥æ‰€æœ‰Watcherå®ä¾‹è¿›è¡Œæ›´æ–°ã€‚è€ŒWatcheråˆ™æ˜¯ä¸€ä¸ªè§‚å¯Ÿè€…ï¼Œå®ƒä¼šè§‚å¯Ÿæ•°æ®çš„å˜åŒ–ï¼Œå¹¶åœ¨æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶æ‰§è¡Œå›è°ƒå‡½æ•°1ã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œå½“ä¸€ä¸ªç»„ä»¶è¢«æ¸²æŸ“æ—¶ï¼ŒVue.jsä¼šä¸ºè¿™ä¸ªç»„ä»¶åˆ›å»ºä¸€ä¸ªWatcherå®ä¾‹ã€‚è¿™ä¸ªWatcherå®ä¾‹ä¼šè§‚å¯Ÿç»„ä»¶ä¸­æ‰€æœ‰å“åº”å¼æ•°æ®çš„å˜åŒ–ï¼Œå¹¶å°†è‡ªå·±æ·»åŠ åˆ°è¿™äº›æ•°æ®çš„Depä¸­ã€‚å½“æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒDepä¼šé€šçŸ¥æ‰€æœ‰Watcherå®ä¾‹è¿›è¡Œæ›´æ–°ï¼Œä»è€Œæ›´æ–°ç»„ä»¶ä¸­çš„DOM1ã€‚</p><h3 id="Observerï¼šè¾…åŠ©çš„å¯è§‚æµ‹ç±»ï¼Œæ•°ç»„-å¯¹è±¡é€šè¿‡å®ƒçš„è½¬åŒ–ï¼Œå¯æˆä¸ºå¯è§‚æŸ¥æ•°æ®"><a href="#Observerï¼šè¾…åŠ©çš„å¯è§‚æµ‹ç±»ï¼Œæ•°ç»„-å¯¹è±¡é€šè¿‡å®ƒçš„è½¬åŒ–ï¼Œå¯æˆä¸ºå¯è§‚æŸ¥æ•°æ®" class="headerlink" title="Observerï¼šè¾…åŠ©çš„å¯è§‚æµ‹ç±»ï¼Œæ•°ç»„/å¯¹è±¡é€šè¿‡å®ƒçš„è½¬åŒ–ï¼Œå¯æˆä¸ºå¯è§‚æŸ¥æ•°æ®"></a>Observerï¼šè¾…åŠ©çš„å¯è§‚æµ‹ç±»ï¼Œæ•°ç»„/å¯¹è±¡é€šè¿‡å®ƒçš„è½¬åŒ–ï¼Œå¯æˆä¸ºå¯è§‚æŸ¥æ•°æ®</h3><p>Observerç±»çš„å®ä¾‹è¢«æŒ‚è½½åœ¨<strong>ob</strong>å±æ€§ä¸Šï¼Œæä¾›åç»­è§‚æµ‹æ•°æ®ä½¿ç”¨ï¼Œä»¥åŠé¿å…è¢«é‡å¤å®ä¾‹åŒ–</p><h4 id="å¯¹è±¡ä»¥åŠæ•°ç»„çš„ç›‘æµ‹"><a href="#å¯¹è±¡ä»¥åŠæ•°ç»„çš„ç›‘æµ‹" class="headerlink" title="å¯¹è±¡ä»¥åŠæ•°ç»„çš„ç›‘æµ‹"></a>å¯¹è±¡ä»¥åŠæ•°ç»„çš„ç›‘æµ‹</h4><p> å¦‚æœvalueæ˜¯ä¸ªå¯¹è±¡ï¼Œå°±éå†å¯¹è±¡ï¼ˆwalk()ï¼‰æŠŠæ¯ä¸€é¡¹æ•°æ®éƒ½å˜ä¸ºå¯è§‚æµ‹æ•°æ®ï¼ˆè°ƒç”¨defineReactiveæ–¹æ³•å¤„ç†ï¼‰ - å¦‚æœvalueæ˜¯ä¸ªæ•°ç»„ï¼Œå°±æ‰§è¡ŒobserveArray()è¿‡ç¨‹ï¼Œé€’å½’åœ°å¯¹æ•°ç»„å…ƒç´ è°ƒç”¨observe()ï¼Œä»¥ä¾¿èƒ½å¤Ÿå¯¹å…ƒç´ è¿˜æ˜¯æ•°ç»„çš„æƒ…å†µè¿›è¡Œå¤„ç†</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">walk(obj) &#123;</span><br><span class="line">       <span class="keyword">var</span> keys = <span class="built_in">Object</span>.keys(obj)</span><br><span class="line">       <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, l = keys.length; i &lt; l; i++) &#123;</span><br><span class="line">           <span class="keyword">this</span>.convert(keys[i], obj[keys[i]])</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">convert(key, val) &#123;</span><br><span class="line">       defineReactive(<span class="keyword">this</span>.value, key, val)</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> data = &#123;</span><br><span class="line">    arr: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">defineReactive</span>(<span class="params">obj, key, val</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> property = <span class="built_in">Object</span>.getOwnPropertyDescriptor(obj, key);</span><br><span class="line">    <span class="keyword">if</span> (property &amp;&amp; property.configurable === <span class="literal">false</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> getter = property &amp;&amp; property.get;</span><br><span class="line">    <span class="keyword">const</span> setter = property &amp;&amp; property.set;</span><br><span class="line">    <span class="built_in">Object</span>.defineProperty(obj, key, &#123;</span><br><span class="line">        enumerable: <span class="literal">true</span>,</span><br><span class="line">        configurable: <span class="literal">true</span>,</span><br><span class="line">        <span class="keyword">get</span>() &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'å–å€¼è¿‡ç¨‹è¢«æ‹¦æˆªäº†'</span>);</span><br><span class="line">            <span class="keyword">const</span> value = getter ? getter.call(obj) : val;</span><br><span class="line">            <span class="keyword">return</span> value;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="keyword">set</span>(newval) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">`æ–°çš„å€¼æ˜¯<span class="subst">$&#123;newval&#125;</span>`</span>)</span><br><span class="line">            <span class="keyword">if</span> (setter) &#123;</span><br><span class="line">                setter.call(obj, newval);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                val = newval;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">defineReactive(data, <span class="string">'arr'</span>, data.arr);</span><br><span class="line">data.arr.reverse(); <span class="comment">// å–å€¼è¿‡ç¨‹è¢«æ‹¦æˆªäº†</span></span><br><span class="line">data.arr = [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>] <span class="comment">// æ–°çš„å€¼æ˜¯4,5,6</span></span><br></pre></td></tr></table></figure><p><code>defineProperty</code>ä¸ºä»€ä¹ˆä¸èƒ½ç›‘æµ‹åˆ°æ•°ç»„ï¼Ÿé™¤äº†å¯¹arré‡æ–°èµ‹å€¼ä¸€ä¸ªæ•°ç»„å¤–ï¼Œå…¶ä»–çš„æ“ä½œéƒ½ä¸ä¼šè¢«setteræ£€æµ‹åˆ°è€Œæ˜¯è¢«getæ‹¦æˆªäº†<br>å› æ­¤å¯¹äºæ•°ç»„ï¼šå¦‚æœvalueæ˜¯ä¸ªæ•°ç»„ï¼Œå°±æ‰§è¡ŒobserveArray()è¿‡ç¨‹ï¼Œé€’å½’åœ°å¯¹æ•°ç»„å…ƒç´ è°ƒç”¨observe()ï¼Œå½“è°ƒç”¨æ•°ç»„çš„push()ã€pop()ã€shift()ã€unshift()ã€splice()ã€sort()å’Œreverse()ç­‰æ–¹æ³•æ—¶ï¼Œè¿™äº›æ–¹æ³•ä¼šè¢«é‡å†™ï¼Œä»è€Œè§¦å‘è§†å›¾æ›´æ–°ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å‡çº§Babel7è¸©å‘</title>
      <link href="/ashley271017.github.io/2022/08/23/%E5%8D%87%E7%BA%A7Babel7%E8%B8%A9%E5%9D%91/"/>
      <url>/ashley271017.github.io/2022/08/23/%E5%8D%87%E7%BA%A7Babel7%E8%B8%A9%E5%9D%91/</url>
      
        <content type="html"><![CDATA[<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ul><li><code>npx babel-upgrade --write</code>è‡ªåŠ¨æ›´æ¢ä¾èµ–ä¸­çš„Babelç‰ˆæœ¬</li><li>æ›´æ¢<code>babelrc</code>é…ç½®</li><li>æ›´æ¢<code>eslint</code>é…ç½®</li></ul><h4 id="åŸå§‹é…ç½®"><a href="#åŸå§‹é…ç½®" class="headerlink" title="åŸå§‹é…ç½®"></a>åŸå§‹é…ç½®</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// .babelrc</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"presets"</span>: [</span><br><span class="line">  <span class="comment">// ç”¨æ¥åœ¨vueä¸­å†™jsxçš„</span></span><br><span class="line">    [<span class="string">"@vue/babel-preset-jsx"</span>], <span class="comment">// @babel/transform-vue-jsx æ”¯æŒçš„æ˜¯Babel6+</span></span><br><span class="line">    [</span><br><span class="line">      <span class="string">"@babel/env"</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"targets"</span>: &#123;</span><br><span class="line">          <span class="string">"chrome"</span>: <span class="number">52</span>,</span><br><span class="line">          <span class="string">"browsers"</span>: [<span class="string">"last 2 versions"</span>, <span class="string">"safari 7"</span>]</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"modules"</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">"useBuiltIns"</span>: <span class="string">"usage"</span> <span class="comment">// polyfill ç”±äº@babel/polyfillå·²ç»å¿«è¢«åºŸå¼ƒï¼Œè¯¥é€‰é¡¹ä¾èµ–babel/polyfill,æ‰€ä»¥ä¸å»ºè®®ç”¨æ­¤é€‰é¡¹</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  ],</span><br><span class="line">  <span class="string">"sourceType"</span>: <span class="string">"unambiguous"</span>, <span class="comment">// é¡¹ç›®ä¸­æœ‰äº›åœ°æ–¹importè·Ÿmodule.exportsæ··ç”¨äº†ï¼Œwebpack2ä¸æ”¯æŒ ä½†æ˜¯é…ç½®äº†è¿˜æ˜¯æ— æ•ˆ</span></span><br><span class="line">  <span class="string">"plugins"</span>: [</span><br><span class="line">    [</span><br><span class="line">      <span class="string">"@babel/plugin-transform-runtime"</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"corejs"</span>: <span class="literal">false</span>, <span class="comment">// corejs æ˜¯ä¸€ä¸ªç»™ä½ç‰ˆæœ¬çš„æµè§ˆå™¨æä¾›æ¥å£çš„åº“ï¼Œå¦‚ Promise, map, set ç­‰ã€‚è®¾ç½®falseä¸ä¼šå¯¹polyfillè¿›è¡Œå¤„ç† å¦‚æœä¸æ˜¯å¼€å‘jsåº“ å¸¸è§„çš„ä¸šåŠ¡è®¾ç½®false</span></span><br><span class="line">        <span class="string">"helpers"</span>: <span class="literal">true</span>, <span class="comment">// è¾…åŠ©å‡½æ•°æ˜¯å¦æŠ½å–å‡ºæ¥ï¼Œé¿å…é‡å¤</span></span><br><span class="line">        <span class="string">"regenerator"</span>: <span class="literal">true</span>, <span class="comment">// åŒbabel-plugin-transform</span></span><br><span class="line">        <span class="string">"useESModules"</span>: <span class="literal">true</span> <span class="comment">// ä½¿ç”¨ es modules helpers, å‡å°‘ commonJS è¯­æ³•ä»£ç </span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    [<span class="string">"@babel/plugin-syntax-dynamic-import"</span>],</span><br><span class="line">    [<span class="string">"@babel/plugin-transform-modules-commonjs"</span>], <span class="comment">// è§£å†³importè·Ÿmodule.exportsæ··ç”¨çš„é—®é¢˜</span></span><br><span class="line">    [<span class="string">"@babel/plugin-proposal-nullish-coalescing-operator"</span>] å‘çˆ¹ï¼Œè™½ç„¶å®˜æ–¹è¯´babel-preset-envæ”¯æŒäº† ä½†æ˜¯å…¶å®å¹¶ä¸ </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// As I know so far that babel preset-env won't support stage-x plugin. This </span></span><br><span class="line">    <span class="comment">// babel/plugin-proposal-nullish-coalescing-operator seems to be at stage-4</span></span><br><span class="line">    <span class="comment">// for now which means you have to keep using this as plugin.</span></span><br><span class="line">    </span><br><span class="line">  ],</span><br><span class="line">  <span class="string">"comments"</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="string">"env"</span>: &#123;</span><br><span class="line">    <span class="string">"test"</span>: &#123;</span><br><span class="line">      <span class="string">"plugins"</span>: [<span class="string">"istanbul"</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// eslintrc.js</span></span><br><span class="line">  parserOptions: &#123;</span><br><span class="line">    <span class="comment">// eslint7æ‰æ”¯æŒes2020 7.5æ”¯æŒéç©ºè¿ç®—ç¬¦</span></span><br><span class="line">    ecmaVersion: <span class="number">2020</span>,</span><br><span class="line">    <span class="string">"sourceType"</span>: <span class="string">"module"</span>,</span><br><span class="line">    ecmaFeatures: &#123;</span><br><span class="line">      experimentalObjectRestSpread: <span class="literal">true</span></span><br><span class="line">      <span class="comment">//jsx: true</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ­£ç‰ˆæœ¬"><a href="#ä¿®æ­£ç‰ˆæœ¬" class="headerlink" title="ä¿®æ­£ç‰ˆæœ¬"></a>ä¿®æ­£ç‰ˆæœ¬</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"presets"</span>: [</span><br><span class="line">    [</span><br><span class="line">      <span class="string">"@babel/preset-env"</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"targets"</span>: &#123;</span><br><span class="line">          <span class="string">"chrome"</span>: <span class="number">52</span>,</span><br><span class="line">          <span class="string">"browsers"</span>: [<span class="string">"&gt; 1%"</span>, <span class="string">"last 2 versions"</span>, <span class="string">"not ie &lt;= 8"</span>]</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"modules"</span>: <span class="literal">false</span>,</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  ],</span><br><span class="line">  <span class="string">"plugins"</span>: [</span><br><span class="line">    [</span><br><span class="line">      <span class="string">"@babel/plugin-transform-runtime"</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"corejs"</span>: &#123;</span><br><span class="line">          <span class="string">"version"</span>: <span class="number">3</span>,</span><br><span class="line">          <span class="string">"proposals"</span>: <span class="literal">true</span> <span class="comment">// å¼•å…¥æ‰€æœ‰è¯¥ç‰ˆæœ¬çš„ææ¡ˆ æ³¨æ„æ˜¯ææ¡ˆï¼ˆå»ºè®®ï¼‰ä¸æ˜¯æ ‡å‡†</span></span><br><span class="line">        &#125;, <span class="comment">// å…³é—­å…¶å¯¹polyfillçš„å¤„ç† </span></span><br><span class="line">        <span class="string">"helpers"</span>: <span class="literal">true</span>, <span class="comment">// è¾…åŠ©å‡½æ•°æ˜¯å¦æå–</span></span><br><span class="line">        <span class="string">"regenerator"</span>: <span class="literal">true</span>, <span class="comment">// åŒbabel-plugin-transform</span></span><br><span class="line">        <span class="string">"useESModules"</span>: <span class="literal">true</span> <span class="comment">// ä½¿ç”¨ es modules helpers, å‡å°‘ commonJS è¯­æ³•ä»£ç </span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="è¸©å‘"><a href="#è¸©å‘" class="headerlink" title="è¸©å‘"></a>è¸©å‘</h4><p>1.å¯é€‰é“¾æ’ä»¶éœ€è¦å‡çº§Babel7æ‰èƒ½ç”¨ã€‚ã€‚<br>2.å‡çº§çš„æ—¶å€™å¦‚æœé¡¹ç›®å­˜åœ¨<code>stage-xxx</code> è‡ªåŠ¨å‡çº§ä¼šå®‰è£…ä¸€å †è¯¥é˜¶æ®µçš„è¯­æ³•æ’ä»¶<br>3.usebuiltInså·²ç»ä¸è¢«æ¨èäº†,å¦‚æœä½¿ç”¨å®ƒéœ€è¦ç»“åˆé…ç½®core-js</p>]]></content>
      
      
      
        <tags>
            
            <tag> babel </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>react18æ–°ç‰¹æ€§è§£è¯»</title>
      <link href="/ashley271017.github.io/2022/08/16/react18/"/>
      <url>/ashley271017.github.io/2022/08/16/react18/</url>
      
        <content type="html"><![CDATA[<h2 id="å¹¶å‘"><a href="#å¹¶å‘" class="headerlink" title="å¹¶å‘"></a>å¹¶å‘</h2><h3 id="ä»€ä¹ˆæ˜¯å¹¶å‘"><a href="#ä»€ä¹ˆæ˜¯å¹¶å‘" class="headerlink" title="ä»€ä¹ˆæ˜¯å¹¶å‘"></a>ä»€ä¹ˆæ˜¯å¹¶å‘</h3><p>å¹¶å‘æ˜¯åªè¦ä¸€æ®µæ—¶é—´å†…åŒæ—¶å‘ç”Ÿå¤šä»¶äº‹æƒ…å°±è¡Œã€‚</p><h3 id="å¹¶å‘æ¸²æŸ“æœºåˆ¶"><a href="#å¹¶å‘æ¸²æŸ“æœºåˆ¶" class="headerlink" title="å¹¶å‘æ¸²æŸ“æœºåˆ¶"></a>å¹¶å‘æ¸²æŸ“æœºåˆ¶</h3><p><del>react18ä¸ºä¼˜åŒ–æ€§èƒ½åšçš„åŸºäºä¼˜å…ˆçº§çš„å¯æ‰“æ–­çš„æ¸²æŸ“æµç¨‹ã€‚ä¸»è¦ç›®æ ‡æ˜¯æ ¹æ®ç”¨æˆ·çš„è®¾å¤‡æ€§èƒ½å’Œç½‘é€Ÿå¯¹æ¸²æŸ“è¿‡ç¨‹è¿›è¡Œé€‚å½“çš„è°ƒæ•´ï¼Œå¸®åŠ©åº”ç”¨å§‹ç»ˆä¿æŒå¯å“åº”ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒèƒ½å¤Ÿä¿è¯ React åº”ç”¨åœ¨é•¿æ—¶é—´çš„æ¸²æŸ“è¿‡ç¨‹ä¸­ä¾æ—§ä¿æŒå¯äº¤äº’æ€§ï¼Œèƒ½ä¼˜å…ˆæ‰§è¡Œé«˜ä¼˜å…ˆçº§å˜æ›´ï¼Œé¿å…é¡µé¢å‡ºç°å¡é¡¿æˆ–æ— å“åº”çš„æƒ…å†µï¼Œä»è€Œæå‡ç”¨æˆ·ä½“éªŒã€‚</del></p><p>Fiber æ ‘çš„æ›´æ–°æµç¨‹åˆ†ä¸º render é˜¶æ®µä¸ commit é˜¶æ®µï¼Œrender é˜¶æ®µä¼šæ”¶é›† Fiber æ ‘ä¸­éœ€è¦æ›´æ–°çš„éƒ¨åˆ†ï¼Œä»£è¡¨ç€å¯¹äºæœ¬æ¬¡æ›´æ–°ï¼Œæˆ‘ä»¬éœ€è¦åšå“ªäº›å…·ä½“å˜æ›´ã€‚commit é˜¶æ®µæ˜¯å°†å˜æ›´åº”ç”¨åˆ°çœŸå®çš„å®¿ä¸»ç¯å¢ƒä¸­</p><p>render é˜¶æ®µæ˜¯æ²¡æœ‰å‰¯ä½œç”¨çš„ï¼ˆåªæ˜¯æ”¶é›† Fiber æ ‘ä¸­éœ€è¦æ›´æ–°çš„éƒ¨åˆ†ï¼‰ï¼Œæ„å‘³ç€å¯ä»¥è¢«æ‹†åˆ†ï¼Œåœ¨é˜»å¡æ¨¡å¼ä¸‹ï¼Œrender é˜¶æ®µä¸€æ¬¡æ€§æ‰§è¡Œå®Œæˆï¼Œ<strong>è€Œåœ¨å¹¶å‘æ¸²æŸ“æ¨¡å¼ä¸‹ï¼Œrender é˜¶æ®µå¯ä»¥è¢«æ‹†è§£</strong></p><h3 id="å¦‚ä½•å¼€å¯"><a href="#å¦‚ä½•å¼€å¯" class="headerlink" title="å¦‚ä½•å¼€å¯"></a>å¦‚ä½•å¼€å¯</h3><p>åœ¨ React 18 ä¸­ï¼Œæä¾›äº†æ–°çš„ root apiï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠ render å‡çº§æˆ <code>createRoot(root).render(&lt;App /&gt;)</code> å°±å¯ä»¥å¼€å¯å¹¶å‘æ¨¡å¼äº†ã€‚</p><h3 id="ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ä¹ˆä¸€å¥—æœºåˆ¶"><a href="#ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ä¹ˆä¸€å¥—æœºåˆ¶" class="headerlink" title="ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ä¹ˆä¸€å¥—æœºåˆ¶"></a>ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ä¹ˆä¸€å¥—æœºåˆ¶</h3><p>å¹¶å‘æ¸²æŸ“å‡ºç°ä¹‹å‰ï¼šä¸€æ—¦å®ƒä»¬å¼€å§‹æ¸²æŸ“ä¸€æ¬¡æ›´æ–°ï¼Œå®ƒä»¬ä¸èƒ½ä¸­æ–­åŒ…æ‹¬åˆ›å»ºæ–°çš„ DOM èŠ‚ç‚¹å’Œè¿è¡Œç»„ä»¶ä¸­ä»£ç åœ¨å†…çš„å·¥ä½œã€‚æˆ‘ä»¬ç§°è¿™ç§æ–¹å¼ä¸º â€œé˜»å¡æ¸²æŸ“â€ã€‚<strong>å¦‚æœæ¸²æŸ“è¿‡ç¨‹è€—æ—¶æ¯”è¾ƒé•¿çš„è¯ï¼Œå°±å¯èƒ½å¯¼è‡´ UI çº¿ç¨‹æŒ‚èµ·å’Œäº‹ä»¶å¾—ä¸åˆ°å“åº”ï¼Œè¿›è€Œå‡ºç°é¡µé¢å¡é¡¿</strong>ã€‚<br>æ¯”å¦‚å½“ä¸¤ä¸ªset StateåŒæ—¶è§¦å‘çš„æ—¶å€™ï¼ˆæ¯”å¦‚state2ä¼šåœ¨state1æ›´æ–°çš„æ—¶å€™ä¹Ÿè§¦å‘æ›´æ–°ï¼‰ä¼šå‡ºç°ä»€ä¹ˆï¼ŸåŒæ­¥æ¨¡å¼ä¸‹ä¹Ÿå°±ä¼šæŒ‰ç…§é¡ºåºä¾æ¬¡æ‰§è¡Œã€‚<br>ä½†å¦‚æœè¿™ä¸ªæ¸²æŸ“æµç¨‹ä¸­å¤„ç†çš„ fiber èŠ‚ç‚¹æ¯”è¾ƒå¤šï¼Œæ¸²æŸ“ä¸€æ¬¡å°±æ¯”è¾ƒæ…¢ï¼Œè¿™æ—¶å€™ç”¨æˆ·è¾“å…¥çš„å†…å®¹å¯èƒ½å°±ä¸èƒ½åŠæ—¶çš„æ¸²æŸ“å‡ºæ¥ï¼Œç”¨æˆ·å°±ä¼šæ„Ÿè§‰å¡ï¼Œä½“éªŒä¸å¥½ã€‚ï¼ˆæ³¨æ„ä¹‹å‰æ‰€è¯´çš„æ‰¹å¤„ç†æœºåˆ¶æ˜¯é’ˆå¯¹åŒä¸€ä¸ªstateçš„ï¼‰</p><p>å¹¶å‘æ¸²æŸ“æœºåˆ¶åšçš„å°±æ˜¯æŒ‡å®šè¿™ä¸¤ä¸ªstateçš„ä¼˜å…ˆçº§ï¼Œæ¯”å¦‚ï¼šç”¨æˆ·è¾“å…¥çš„ setState çš„æ›´æ–°é‡è¦ç¨‹åº¦æ›´é«˜ï¼Œå¦‚æœæœ‰è¿™ç§æ›´æ–°å°±æŠŠåˆ«çš„å…ˆæš‚åœï¼Œæ‰§è¡Œè¿™æ¬¡æ›´æ–°ï¼Œæ‰§è¡Œå®Œä¹‹åå†ç»§ç»­å¤„ç†ã€‚<br>å¹¶å‘æ¸²æŸ“ ç¤ºä¾‹<br>React ä¼šæŠŠ vdom æ ‘è½¬æˆ fiber é“¾è¡¨ï¼Œå› ä¸º vdom é‡Œåªæœ‰ childrenï¼Œæ²¡æœ‰ parentã€sibling ä¿¡æ¯ï¼Œè€Œ fiber èŠ‚ç‚¹é‡Œæœ‰ï¼Œè¿™æ ·å°±ç®—æ‰“æ–­äº†ä¹Ÿå¯ä»¥æ‰¾åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ç»§ç»­å¤„ç†ã€‚fiber ç»“æ„å°±æ˜¯ä¸ºå®ç°å¹¶å‘è€Œå‡†å¤‡çš„ã€‚<br>æ¯”å¦‚ï¼šé’ˆå¯¹ä¸Šé¢ä¸¤ä¸ªsetStateåŒæ—¶è§¦å‘çš„åœºæ™¯ï¼Œå¦‚æœç¬¬äºŒä¸ªsetStatekçš„ä¼˜å…ˆçº§æ¯”è¾ƒé«˜çš„è¯ï¼šç¬¬ä¸€ä¸ªsetStateè§¦å‘çš„fiberèŠ‚ç‚¹å˜æ›´ä¼šè¢«æ‰“æ–­ï¼Œå…ˆæ‰§è¡Œç¬¬äºŒä¸ªçš„fiberèŠ‚ç‚¹å¤„ç†ï¼Œå®Œæˆä¹‹åå†å›æ¥ç»§ç»­ç¬¬ä¸€ä¸ªã€‚<br>å¹¶å‘æ˜¯é€šè¿‡äº¤æ›¿æ‰§è¡Œæ¥å®ç°çš„<br>ä¸Šé¢æ˜¯ä¸¤ä¸ª setState å¼•èµ·çš„ä¸¤ä¸ªæ¸²æŸ“æµç¨‹ï¼Œå…ˆå¤„ç†ä¸Šé¢é‚£æ¬¡æ¸²æŸ“çš„ 1ã€2ã€3 çš„ fiber èŠ‚ç‚¹ï¼Œç„¶åå¤„ç†ä¸‹é¢é‚£æ¬¡æ¸²æŸ“çš„ 1ã€2ã€3ã€4ã€5ã€6 çš„ fiber èŠ‚ç‚¹ï¼Œä¹‹åç»§ç»­å¤„ç†ä¸Šé¢é‚£æ¬¡æ¸²æŸ“çš„ 4ã€5ã€6 çš„ fiber èŠ‚ç‚¹ã€‚<br><strong>reactçš„å¹¶å‘ä¹Ÿå°±æ˜¯åœ¨å¾ªç¯å¤„ç†é‡æ–°æ¸²æŸ“æ¶‰åŠçš„fiberèŠ‚ç‚¹é‡Œå¤šäº†ä¸ªæ‰“æ–­å’Œæ¢å¤çš„æœºåˆ¶</strong></p><h3 id="æ‰“æ–­ä¸æ¢å¤æœºåˆ¶çš„æµç¨‹"><a href="#æ‰“æ–­ä¸æ¢å¤æœºåˆ¶çš„æµç¨‹" class="headerlink" title="æ‰“æ–­ä¸æ¢å¤æœºåˆ¶çš„æµç¨‹"></a>æ‰“æ–­ä¸æ¢å¤æœºåˆ¶çš„æµç¨‹</h3><h4 id="åŸºäºæ—¶é—´åˆ†ç‰‡çš„æœºåˆ¶å®ç°è°ƒåº¦"><a href="#åŸºäºæ—¶é—´åˆ†ç‰‡çš„æœºåˆ¶å®ç°è°ƒåº¦" class="headerlink" title="åŸºäºæ—¶é—´åˆ†ç‰‡çš„æœºåˆ¶å®ç°è°ƒåº¦"></a>åŸºäºæ—¶é—´åˆ†ç‰‡çš„æœºåˆ¶å®ç°è°ƒåº¦</h4><p>å¹¶å‘æ¸²æŸ“æœºåˆ¶çš„å®ç°åŸç†ï¼šæ—¶é—´åˆ†ç‰‡</p><h5 id="æ˜¯ä»€ä¹ˆ"><a href="#æ˜¯ä»€ä¹ˆ" class="headerlink" title="æ˜¯ä»€ä¹ˆ"></a>æ˜¯ä»€ä¹ˆ</h5><p>æ—¶é—´åˆ†ç‰‡å…¶å®å°±æ˜¯ä¸€ä¸ªå›ºå®šè€Œè¿ç»­ä¸”æœ‰é—´éš”çš„æ—¶é—´åŒºé—´<br>å›ºå®šï¼šæ¯å¤©å›ºå®šå·¥ä½œ8å°æ—¶<br>è¿ç»­ï¼šæ¯å¤©éƒ½è¦ä¸Šç­<br>æœ‰é—´éš”ï¼šæ˜å¤©ä¸Šç­å‰ä¼šä¼‘æ¯ä¸€æ®µæ—¶é—´</p><h5 id="ä¸ºä»€ä¹ˆä¼šå‡ºç°æ—¶é—´åˆ†ç‰‡"><a href="#ä¸ºä»€ä¹ˆä¼šå‡ºç°æ—¶é—´åˆ†ç‰‡" class="headerlink" title="ä¸ºä»€ä¹ˆä¼šå‡ºç°æ—¶é—´åˆ†ç‰‡"></a>ä¸ºä»€ä¹ˆä¼šå‡ºç°æ—¶é—´åˆ†ç‰‡</h5><p>JSæ˜¯å•çº¿ç¨‹çš„ï¼Œæµè§ˆå™¨æ˜¯å¤šçº¿ç¨‹çš„ï¼Œé™¤äº†JSçº¿ç¨‹è¿˜æœ‰äº‹ä»¶å¤„ç†çº¿ç¨‹ä»¥åŠå®šæ—¶å™¨çº¿ç¨‹ã€ç½‘ç»œè¯·æ±‚çº¿ç¨‹ã€UIçº¿ç¨‹ç­‰ï¼Œå…¶ä¸­JSçº¿ç¨‹è·ŸGUIæ¸²çº¿ç¨‹æ˜¯äº’æ–¥çš„ï¼Œå› ä¸ºå¦‚æœæ“ä½œdomçš„åŒæ—¶ä¸€è¾¹æ¸²æŸ“ä¼šé€ æˆé¡µé¢çš„é”™ä¹±ã€‚<br>å› ä¸ºå‡å¦‚ä¸€ä¸ªsetStateæ¶‰åŠåˆ°å¤§é‡çš„domèŠ‚ç‚¹å˜åŒ–ï¼Œå¦‚æœæŒ‰ç…§ä¹‹å‰åŒæ­¥æ¸²æŸ“çš„æ–¹å¼ï¼Œéœ€è¦å°†æ‰€æœ‰çš„domèŠ‚ç‚¹æ›´æ–°éƒ½å¤„ç†å®Œæˆï¼Œå°±ä¼šå¯¼è‡´Jsçº¿ç¨‹ä¸€ç›´è¢«å ç”¨ï¼ŒGUIæ¸²æŸ“çº¿ç¨‹è¢«æŒ‚èµ·ï¼Œå°±ä¼šé€ æˆé¡µé¢çš„å¡æ–­ï¼Œæ‰€ä»¥å¼•å…¥äº†æ—¶é—´åˆ†ç‰‡çš„æœºåˆ¶ï¼Œéå†ä¸€ä¼šï¼Œä¼‘é—²ä¸€ä¼šï¼Œä¼‘æ¯çš„æ—¶å€™å°†æ§åˆ¶æƒäº¤è¿˜ç»™æµè§ˆå™¨ï¼Œè¿™æ ·å°±èƒ½åŠæ—¶å“åº”ç”¨æˆ·äº‹ä»¶é¿å…é€ æˆå¡é¡¿</p><h5 id="æ—¶é—´åˆ†ç‰‡æ˜¯æ€ä¹ˆåšçš„"><a href="#æ—¶é—´åˆ†ç‰‡æ˜¯æ€ä¹ˆåšçš„" class="headerlink" title="æ—¶é—´åˆ†ç‰‡æ˜¯æ€ä¹ˆåšçš„"></a>æ—¶é—´åˆ†ç‰‡æ˜¯æ€ä¹ˆåšçš„</h5><p>æ€»ç»“å°±æ˜¯æŠŠä¸€ä¸ªè€—æ—¶é•¿çš„ä»»åŠ¡æŒ‰ç…§ä¼˜å…ˆçº§æ’åºåˆ†æˆå¾ˆå¤šå°ç‰‡ï¼Œæ¯ä¸€ä¸ªå°ç‰‡çš„è¿è¡Œæ—¶é—´å¾ˆçŸ­ï¼Œè¿™é‡Œçš„è¿è¡Œæ—¶é—´é•¿çŸ­ä¼šæ ¹æ®ä»»åŠ¡çš„ä¼˜å…ˆçº§è¿›è¡Œè°ƒæ•´ ä¸€èˆ¬æ˜¯5æ¯«ç§’ï¼Œå¦‚æœè¶…è¿‡è¿™ä¸ªè§„å®šçš„æ—¶é—´è¿˜æ²¡æ‰§è¡Œå®Œæˆçš„è¯å°±ä¼šè¢«æ‰“æ–­ï¼Œåœ¨æ¯ä¸ªå°ç‰‡æ‰§è¡Œå®Œä¹‹åï¼Œå½“ç¬¬ä¸€ä¸ªå°ä»»åŠ¡å®Œæˆåï¼Œå…ˆåˆ¤æ–­è¿™ä¸€å¸§æ˜¯å¦è¿˜æœ‰ç©ºé—²æ—¶é—´ï¼Œæ²¡æœ‰å°±æŒ‚èµ·ä¸‹ä¸€ä¸ªä»»åŠ¡çš„æ‰§è¡Œï¼Œå°†å…¶æ·»åŠ åˆ°å®ä»»åŠ¡ï¼Œè®°ä½å½“å‰æŒ‚èµ·çš„èŠ‚ç‚¹ï¼Œè®©å‡ºæ§åˆ¶æƒç»™æµè§ˆå™¨æ‰§è¡Œæ›´é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡ï¼Œä¹‹åä¸ºä»€ä¹ˆè¿˜èƒ½æ‰¾åˆ°è¿™ä¸ªæŒ‚èµ·çš„èŠ‚ç‚¹å‘¢ï¼Ÿä¸»è¦æ˜¯å¾—ç›Šäºfiber ç»“æ„ï¼Œå¦åˆ™ç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡æ¯”å¦‚äº‹ä»¶å¤„ç†ï¼ˆç”¨æˆ·è¾“å…¥ç”¨æˆ·ç‚¹å‡»ç­‰ï¼‰ï¼Œã€‚<br>è¿™é‡Œçš„ä¼˜å…ˆçº§reactæœ‰è‡ªå·±çš„ä¸€å¥—æœºåˆ¶ï¼Œæ¯”å¦‚ä¸€èˆ¬æ˜¯ç”¨æˆ·è¾“å…¥ ç‚¹å‡»äº‹ä»¶çš„ä¼˜å…ˆçº§æ›´é«˜ï¼Œç„¶åæ˜¯æ»šåŠ¨ æ‹–æ‹½ é¼ æ ‡hoverç­‰<br>ä¸ºä»€ä¹ˆè¿™é‡Œæ˜¯å®ä»»åŠ¡ï¼Ÿ<br>å› ä¸ºä¸€è½®äº‹ä»¶å¾ªç¯ï¼Œæ˜¯å…ˆæ‰§è¡Œä¸€ä¸ªå®ä»»åŠ¡ï¼Œç„¶åå†æ¸…ç©ºå¾®ä»»åŠ¡é˜Ÿåˆ—é‡Œé¢çš„ä»»åŠ¡ï¼Œå¦‚æœåœ¨æ¸…ç©ºå¾®ä»»åŠ¡é˜Ÿåˆ—çš„è¿‡ç¨‹ä¸­ï¼Œä¾ç„¶æœ‰æ–°ä»»åŠ¡æ’å…¥åˆ°å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„è¯ï¼Œè¿˜æ˜¯æŠŠè¿™äº›ä»»åŠ¡æ‰§è¡Œå®Œæ¯•æ‰ä¼šé‡Šæ”¾ä¸»çº¿ç¨‹ã€‚æ‰€ä»¥å¾®ä»»åŠ¡ä¼šé˜»å¡æœ¬æ¬¡é¡µé¢æ›´æ–°ã€‚è€Œå¦‚æœæ˜¯å®ä»»åŠ¡ï¼Œä¼šå°†è¿™ä¸ªæ–°å¢çš„å®ä»»åŠ¡ä¸¢åˆ°ä¸‹ä¸€è½®äº‹ä»¶å¾ªç¯ï¼Œä¸ä¼šé˜»å¡æœ¬æ¬¡çš„é¡µé¢æ›´æ–°</p><p><strong>ä¸Šé¢æ‰€æœ‰çš„ä¸œè¥¿éƒ½æ˜¯åŸºäº fiber æ¶æ„å®ç°çš„ï¼Œfiberä¸ºçŠ¶æ€æ›´æ–°æä¾›äº†å¯ä¸­æ–­çš„èƒ½åŠ›</strong></p><h2 id="useDeferredValue"><a href="#useDeferredValue" class="headerlink" title="useDeferredValue"></a>useDeferredValue</h2><p>é¦–å…ˆæ¥çœ‹ React 18 æ–°å¢çš„ä¸€ä¸ª APIï¼ŒuseDeferredValueï¼Œå®ƒèƒ½å¤Ÿå¾ˆå¥½åœ°å±•ç¤ºå¹¶å‘æ¸²æŸ“è¿‡ç¨‹ä¸­çš„ä¼˜å…ˆçº§è°ƒæ•´ç‰¹æ€§ã€‚</p><p>useDefferedValue ç”¨äºå£°æ˜ç»„ä»¶éƒ¨åˆ†çŠ¶æ€çš„å¤„ç†æ˜¯å¯ä»¥å»¶è¿Ÿçš„ï¼Œä¸€èˆ¬æ˜¯ä¸€äº›è®¡ç®—é€»è¾‘è¾ƒé‡çš„éƒ¨åˆ†ï¼Œè®©ç»„ä»¶å¯ä»¥å…ˆæ¸²æŸ“å…¶å®ƒéƒ¨åˆ†è€Œä¸ç”¨ç­‰å¾…è¿™éƒ¨åˆ†çŠ¶æ€è®¡ç®—å®Œæˆï¼Œå½“è¿™éƒ¨åˆ†çŠ¶æ€æ›´æ–°å®Œåå†è¿›è¡Œæ¸²æŸ“ï¼Œä»è€Œè®© UI å§‹ç»ˆä¿æŒå¯å“åº”ã€‚</p><p>è·Ÿé˜²æŠ–çš„åŒºåˆ«ï¼šè·Ÿé˜²æŠ–è¿˜æ˜¯æœ‰æ¯”è¾ƒå¤§çš„åŒºåˆ«çš„ï¼Œé‚£ä¹ˆä¸è®ºæœºå™¨å¿«æ…¢ï¼Œç½‘ç»œæƒ…å†µå¦‚ä½•ï¼Œå§‹ç»ˆä¼šåœ¨ç”¨æˆ·åœæ­¢è¾“å…¥åçš„å›ºå®šä¹‹é—´æ‰æ‰§è¡Œã€‚<br>ä½¿ç”¨åœºæ™¯ï¼šè¾“å…¥æ¡†æœç´¢</p><h3 id="ä¸å¹¶å‘çš„å…³ç³»"><a href="#ä¸å¹¶å‘çš„å…³ç³»" class="headerlink" title="ä¸å¹¶å‘çš„å…³ç³»"></a>ä¸å¹¶å‘çš„å…³ç³»</h3><p>è¯¥APiä¾èµ–äºå¹¶å‘ç‰¹æ€§ï¼Œå¹¶å‘ç‰¹æ€§æŒ‡å¼€å¯å¹¶å‘æ¨¡å¼åæ‰èƒ½ä½¿ç”¨çš„ç‰¹æ€§<br><img src="https://i.328888.xyz/2023/04/16/iEpVNa.png" alt="image"></p><h2 id="Suspense"><a href="#Suspense" class="headerlink" title="Suspense"></a>Suspense</h2><p>Suspense æ˜¯ä¸€ç§æ•°æ®è·å–çš„æœºåˆ¶ï¼Œå®ƒçš„ç›®æ ‡æ˜¯è®©ç»„ä»¶èƒ½å¤Ÿåƒè¯»å– props æˆ– state ä¸€æ ·ç®€å•åœ°é€šè¿‡ç½‘ç»œè¯»å–å¼‚æ­¥æ•°æ®ã€‚è¿™é‡Œçš„æ•°æ®ä¸ä»…é™äºæ¥å£è¿”å›æ•°æ®ï¼Œä¹Ÿå¯ä»¥æ˜¯ä»£ç ã€å›¾ç‰‡ç­‰ç­‰<br>ç”¨å¤„1ï¼šä¼˜å…ˆæ¸²æŸ“ç”¨æˆ·ç‚¹å‡»çš„ç»„ä»¶<br>æœ‰ä¸¤ä¸ª Suspense åŒ…è£¹çš„ç»„ä»¶ï¼Œå¦‚æœç”¨æˆ·ç‚¹å‡»å…¶ä¸­ä¸€ä¸ªï¼Œé‚£ä¹ˆå®ƒçš„ä¼˜å…ˆçº§ä¼šå˜é«˜ï¼ŒReact ä¼šä¼˜å…ˆè¿›è¡Œè¿™éƒ¨åˆ†çš„ hydrationï¼Œè®©å®ƒèƒ½å°½å¿«å¯äº¤äº’ã€‚<br>ç”¨å¤„2ï¼šè®¾ç½®loadingæ€</p><h2 id="Render-API"><a href="#Render-API" class="headerlink" title="Render API"></a>Render API</h2><p>ä¸ºäº†æ›´å¥½çš„ç®¡ç†rootèŠ‚ç‚¹ï¼ŒReact 18 å¼•å…¥äº†ä¸€ä¸ªæ–°çš„ root APIï¼Œæ–°çš„ root API è¿˜æ”¯æŒ new concurrent rendererï¼ˆå¹¶å‘æ¨¡å¼çš„æ¸²æŸ“ï¼‰ï¼Œå®ƒå…è®¸ä½ è¿›å…¥concurrent modeï¼ˆå¹¶å‘æ¨¡å¼ï¼‰ã€‚</p><h3 id="ä¸ä¹‹å‰çš„renderçš„åŒºåˆ«"><a href="#ä¸ä¹‹å‰çš„renderçš„åŒºåˆ«" class="headerlink" title="ä¸ä¹‹å‰çš„renderçš„åŒºåˆ«"></a>ä¸ä¹‹å‰çš„renderçš„åŒºåˆ«</h3><p>18ä¹‹å‰<br>å¦‚æœæˆ‘ä»¬éœ€è¦é‡æ–°æ¸²æŸ“æ•´ä¸ªæ ¹appçš„è¯ éœ€è¦ä¼ é€’å¤šæ¬¡container</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> container = <span class="built_in">document</span>.querySelector(<span class="string">'#root'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Initial render. Container is explicitly accessed.</span></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">App</span> <span class="attr">text</span>=<span class="string">"Hello"</span> /&gt;</span>, container);</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">// Subsequent renders. Container is explicitly accessed.</span></span><br><span class="line">ReactDOM.render(&lt;App text="Hello world!" /&gt;, container);</span><br></pre></td></tr></table></figure><p>18ä¹‹å</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// First, we create a root</span></span><br><span class="line"><span class="keyword">const</span> root = ReactDOM.createRoot(<span class="built_in">document</span>.querySelector(<span class="string">'#root'</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// Initial render. Container is implicitly accessed.</span></span><br><span class="line">root.render(<span class="xml"><span class="tag">&lt;<span class="name">App</span> <span class="attr">name</span>=<span class="string">"Hello"</span> /&gt;</span>);</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">// Subsequent renders. Container is implicitly accessed.</span></span><br><span class="line">root.render(&lt;App name="Hello world!" /&gt;);</span><br></pre></td></tr></table></figure><ul><li>useID<br>æ˜¯ä»€ä¹ˆ<br>æ”¯æŒåŒä¸€ä¸ªç»„ä»¶åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ç”Ÿæˆç›¸åŒçš„å”¯ä¸€çš„ IDï¼Œé¿å… hydration çš„ä¸å…¼å®¹ï¼Œè¿™è§£å†³äº†åœ¨ React 17 åŠ 17 ä»¥ä¸‹ç‰ˆæœ¬ä¸­å·²ç»å­˜åœ¨çš„é—®é¢˜ã€‚å› ä¸ºæˆ‘ä»¬çš„æœåŠ¡å™¨æ¸²æŸ“æ—¶æä¾›çš„ HTML æ˜¯æ— åºçš„ï¼ŒuseId çš„åŸç†å°±æ˜¯æ¯ä¸ª id ä»£è¡¨è¯¥ç»„ä»¶åœ¨ç»„ä»¶æ ‘ä¸­çš„å±‚çº§ç»“æ„</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">NameFields</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> id = useId();</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;label htmlFor=&#123;id + <span class="string">'-firstName'</span>&#125;&gt;First Name&lt;<span class="regexp">/label&gt;</span></span><br><span class="line"><span class="regexp">      &lt;div&gt;</span></span><br><span class="line"><span class="regexp">        &lt;input id=&#123;id + '-firstName'&#125; type="text" /</span>&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;label htmlFor=&#123;id + '-lastName'&#125;&gt;Last Name&lt;/</span>label&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;input id=&#123;id + <span class="string">'-lastName'</span>&#125; type=<span class="string">"text"</span> /&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ä¸èƒ½ç”¨äºåˆ—è¡¨çš„key</p><h2 id="setState-è‡ªåŠ¨æ‰¹å¤„ç†"><a href="#setState-è‡ªåŠ¨æ‰¹å¤„ç†" class="headerlink" title="setState è‡ªåŠ¨æ‰¹å¤„ç†"></a>setState è‡ªåŠ¨æ‰¹å¤„ç†</h2><p>æ‰¹å¤„ç†æ˜¯æŒ‡ä¸ºäº†è·å¾—æ›´å¥½çš„æ€§èƒ½ï¼Œåœ¨æ•°æ®å±‚ï¼Œå°†å¤šä¸ªçŠ¶æ€æ›´æ–°æ‰¹é‡å¤„ç†ï¼Œåˆå¹¶æˆä¸€æ¬¡æ›´æ–°ï¼ˆåœ¨è§†å›¾å±‚ï¼Œå°†å¤šä¸ªæ¸²æŸ“åˆå¹¶æˆä¸€æ¬¡æ¸²æŸ“ï¼‰ã€‚</p><p>åœ¨React 18 ä¹‹å‰ï¼Œæˆ‘ä»¬<strong>åªåœ¨ React äº‹ä»¶å¤„ç†å‡½æ•° ä¸­è¿›è¡Œæ‰¹å¤„ç†æ›´æ–°</strong>ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œåœ¨promiseã€setTimeoutã€åŸç”Ÿäº‹ä»¶å¤„ç†å‡½æ•°ä¸­ã€æˆ–ä»»ä½•å…¶å®ƒäº‹ä»¶å†…çš„æ›´æ–°éƒ½ä¸ä¼šè¿›è¡Œæ‰¹å¤„ç†ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useState &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// React 18 ä¹‹å‰</span></span><br><span class="line"><span class="keyword">const</span> App: React.FC = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Appç»„ä»¶æ¸²æŸ“äº†ï¼'</span>);</span><br><span class="line">  <span class="keyword">const</span> [count1, setCount1] = useState(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> [count2, setCount2] = useState(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;button</span><br><span class="line">      onClick=&#123;<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        setCount1(<span class="function"><span class="params">count</span> =&gt;</span> count + <span class="number">1</span>);</span><br><span class="line">        setCount2(<span class="function"><span class="params">count</span> =&gt;</span> count + <span class="number">1</span>);</span><br><span class="line">        <span class="comment">// åœ¨Reactäº‹ä»¶ä¸­è¢«æ‰¹å¤„ç†</span></span><br><span class="line">      &#125;&#125;</span><br><span class="line">    &gt;</span><br><span class="line">      &#123;<span class="string">`count1 is <span class="subst">$&#123;count1&#125;</span>, count2 is <span class="subst">$&#123;count2&#125;</span>`</span>&#125;</span><br><span class="line">    &lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default App;</span></span><br></pre></td></tr></table></figure><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5a02ccce9b0a4b9e9170483617cdb087~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?" alt="image"></p><p>åœ¨ 18 ä¹‹åï¼Œä»»ä½•æƒ…å†µéƒ½ä¼šè‡ªåŠ¨æ‰§è¡Œæ‰¹å¤„ç†ï¼Œå¤šæ¬¡æ›´æ–°å§‹ç»ˆåˆå¹¶ä¸ºä¸€æ¬¡</p><h3 id="æ‰¹å¤„ç†ä¸å¹¶å‘çš„å…³ç³»"><a href="#æ‰¹å¤„ç†ä¸å¹¶å‘çš„å…³ç³»" class="headerlink" title="æ‰¹å¤„ç†ä¸å¹¶å‘çš„å…³ç³»"></a>æ‰¹å¤„ç†ä¸å¹¶å‘çš„å…³ç³»</h3><p><img src="https://i.328888.xyz/2023/04/16/iEpVNa.png" alt="image"></p><h3 id="flushSync"><a href="#flushSync" class="headerlink" title="flushSync"></a>flushSync</h3><p>æ‰¹å¤„ç†æ˜¯ä¸€ä¸ªç ´åæ€§æ”¹åŠ¨ï¼Œå¦‚æœä½ æƒ³é€€å‡ºæ‰¹é‡æ›´æ–°ï¼Œä½ å¯ä»¥ä½¿ç”¨ flushSync</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useState &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; flushSync &#125; <span class="keyword">from</span> <span class="string">'react-dom'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App: React.FC = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [count1, setCount1] = useState(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> [count2, setCount2] = useState(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div</span><br><span class="line">      onClick=&#123;() =&gt; &#123;</span><br><span class="line">        flushSync(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          setCount1(<span class="function"><span class="params">count</span> =&gt;</span> count + <span class="number">1</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// ç¬¬ä¸€æ¬¡æ›´æ–°</span></span><br><span class="line">        flushSync(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          setCount2(<span class="function"><span class="params">count</span> =&gt;</span> count + <span class="number">1</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// ç¬¬äºŒæ¬¡æ›´æ–°</span></span><br><span class="line">      &#125;&#125;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;div&gt;count1ï¼š &#123;count1&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;div&gt;count2ï¼š &#123;count2&#125;&lt;/</span>div&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default App;</span></span><br></pre></td></tr></table></figure><p>flushSync å‡½æ•°å†…éƒ¨çš„å¤šä¸ª setState ä»ç„¶ä¸ºæ‰¹é‡æ›´æ–°ï¼Œè¿™æ ·å¯ä»¥ç²¾å‡†æ§åˆ¶å“ªäº›ä¸éœ€è¦çš„æ‰¹é‡æ›´æ–°ã€‚</p><h2 id="React-ç»„ä»¶çš„è¿”å›å€¼"><a href="#React-ç»„ä»¶çš„è¿”å›å€¼" class="headerlink" title="React ç»„ä»¶çš„è¿”å›å€¼"></a>React ç»„ä»¶çš„è¿”å›å€¼</h2><p>åœ¨ React 17 ä¸­ï¼Œå¦‚æœä½ éœ€è¦è¿”å›ä¸€ä¸ªç©ºç»„ä»¶ï¼ŒReactåªå…è®¸è¿”å›nullã€‚å¦‚æœä½ æ˜¾å¼çš„è¿”å›äº† undefinedï¼Œæ§åˆ¶å°åˆ™ä¼šåœ¨è¿è¡Œæ—¶æŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚<br>åœ¨ React 18 ä¸­ï¼Œä¸å†æ£€æŸ¥å› è¿”å› undefined è€Œå¯¼è‡´å´©æºƒã€‚æ—¢èƒ½è¿”å› nullï¼Œä¹Ÿèƒ½è¿”å› undefinedï¼ˆä½†æ˜¯ React 18 çš„dtsæ–‡ä»¶è¿˜æ˜¯ä¼šæ£€æŸ¥ï¼Œåªå…è®¸è¿”å› nullï¼Œä½ å¯ä»¥å¿½ç•¥è¿™ä¸ªç±»å‹é”™è¯¯ï¼‰ã€‚</p><h2 id="Suspense-ä¸å†éœ€è¦-fallback-æ¥æ•è·"><a href="#Suspense-ä¸å†éœ€è¦-fallback-æ¥æ•è·" class="headerlink" title="Suspense ä¸å†éœ€è¦ fallback æ¥æ•è·"></a>Suspense ä¸å†éœ€è¦ fallback æ¥æ•è·</h2><p>åœ¨ React 18 çš„ Suspense ç»„ä»¶ä¸­ï¼Œå®˜æ–¹å¯¹ ç©ºçš„fallback å±æ€§çš„å¤„ç†æ–¹å¼åšäº†æ”¹å˜ï¼šä¸å†è·³è¿‡ ç¼ºå¤±å€¼ æˆ– å€¼ä¸ºnull çš„ fallback çš„ Suspense è¾¹ç•Œã€‚ç›¸åï¼Œä¼šæ•è·è¾¹ç•Œå¹¶ä¸”å‘å¤–å±‚æŸ¥æ‰¾ï¼Œå¦‚æœæŸ¥æ‰¾ä¸åˆ°ï¼Œå°†ä¼šæŠŠ fallback å‘ˆç°ä¸º nullã€‚<br>æ›´æ–°å‰ï¼š<br>ä»¥å‰ï¼Œå¦‚æœä½ çš„ Suspense ç»„ä»¶æ²¡æœ‰æä¾› fallback å±æ€§ï¼ŒReact å°±ä¼šæ‚„æ‚„è·³è¿‡å®ƒï¼Œç»§ç»­å‘ä¸Šæœç´¢ä¸‹ä¸€ä¸ªè¾¹ç•Œï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// React 17</span></span><br><span class="line"><span class="keyword">const</span> App = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Suspense fallback=&#123;&lt;Loading /&gt;&#125;&gt; <span class="comment">// &lt;--- è¿™ä¸ªè¾¹ç•Œè¢«ä½¿ç”¨ï¼Œæ˜¾ç¤º Loading ç»„ä»¶</span></span><br><span class="line">      &lt;Suspense&gt;                      <span class="comment">// &lt;--- è¿™ä¸ªè¾¹ç•Œè¢«è·³è¿‡ï¼Œæ²¡æœ‰ fallback å±æ€§</span></span><br><span class="line">        &lt;Page /&gt;</span><br><span class="line">      &lt;<span class="regexp">/Suspense&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>Suspense&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼ŒReactå°†ä½¿ç”¨å½“å‰ç»„ä»¶çš„ Suspense ä½œä¸ºè¾¹ç•Œï¼Œå³ä½¿å½“å‰ç»„ä»¶çš„ Suspense çš„å€¼ä¸º null æˆ– undefinedï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// React 18</span></span><br><span class="line"><span class="keyword">const</span> App = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Suspense fallback=&#123;&lt;Loading /&gt;&#125;&gt; <span class="comment">// &lt;--- ä¸ä½¿ç”¨</span></span><br><span class="line">      &lt;Suspense&gt;                      <span class="comment">// &lt;--- è¿™ä¸ªè¾¹ç•Œè¢«ä½¿ç”¨ï¼Œå°† fallback æ¸²æŸ“ä¸º null</span></span><br><span class="line">        &lt;Page /&gt;</span><br><span class="line">      &lt;<span class="regexp">/Suspense&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>Suspense&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><img src="https://juejin.cn/post/7094037148088664078#heading-23" alt="React18 æ–°ç‰¹æ€§è§£è¯» &amp; å®Œæ•´ç‰ˆå‡çº§æŒ‡å—"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>helloï¼Œchrome extension</title>
      <link href="/ashley271017.github.io/2022/08/16/extension/"/>
      <url>/ashley271017.github.io/2022/08/16/extension/</url>
      
        <content type="html"><![CDATA[<blockquote><p>Chrome Extension æ˜¯ Chrome æµè§ˆå™¨çš„æ‰©å±•ï¼Œä¹Ÿå°±æ˜¯å¤§å®¶æ‰€è¯´çš„ã€æ’ä»¶ã€ã€‚ç”±ä¸€å †htmlï¼Œjsï¼Œcssç»„åˆè€Œæˆ</p></blockquote><h2 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h2><ul><li>manifest.json ï¼ˆæ’ä»¶é…ç½®æ–‡ä»¶ï¼‰</li><li>content script (æ’å…¥åˆ°ç›®æ ‡é¡µé¢ä¸­æ‰§è¡Œçš„js)</li><li>background script (åœ¨chromeåå°ä¸­è¿è¡Œçš„ç¨‹åºï¼Œæ–°ç‰ˆæœ¬è¢«service workerå–ä»£) </li><li>popup (ç‚¹å‡»æ’ä»¶å›¾æ ‡å¼¹å‡ºçš„é¡µé¢)<h2 id="manifest-json"><a href="#manifest-json" class="headerlink" title="manifest.json"></a>manifest.json</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"Chromeæ’ä»¶Demo"</span>,</span><br><span class="line">  <span class="attr">"version"</span>: <span class="string">"1.0"</span>,</span><br><span class="line">  <span class="attr">"description"</span>: <span class="string">"chromeæ’ä»¶Demoã€‚"</span>,</span><br><span class="line">  <span class="attr">"icons"</span>: &#123;</span><br><span class="line">    <span class="attr">"16"</span>: <span class="string">"images/icon.png"</span>,</span><br><span class="line">    <span class="attr">"48"</span>: <span class="string">"images/icon.png"</span>,</span><br><span class="line">    <span class="attr">"128"</span>: <span class="string">"images/icon.png"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  "manifest_version": 3, // æ–‡ä»¶ç‰ˆæœ¬</span><br><span class="line">  // popupé¡µé¢é…ç½®</span><br><span class="line">  "page_action": &#123;</span><br><span class="line">    // æµè§ˆå™¨æ’ä»¶æŒ‰é’®çš„å›¾æ ‡</span><br><span class="line">    "default_icon": "images/icon.png",</span><br><span class="line">    // æµè§ˆå™¨æ’ä»¶æŒ‰é’®hoveræ˜¾ç¤ºçš„æ–‡å­—</span><br><span class="line">    "default_title": "React CRX",</span><br><span class="line">    // popupé¡µé¢çš„è·¯å¾„ï¼ˆæ ¹ç›®å½•ä¸ºæœ€ç»ˆbuildç”Ÿæˆçš„æ’ä»¶åŒ…ç›®å½•ï¼‰</span><br><span class="line">    "default_popup": "index.html"</span><br><span class="line">  &#125;,</span><br><span class="line">  // background scripté…ç½®</span><br><span class="line">  "background": &#123; </span><br><span class="line">    // background scriptè·¯å¾„ï¼ˆæ ¹ç›®å½•ä¸ºæœ€ç»ˆbuildç”Ÿæˆçš„æ’ä»¶åŒ…ç›®å½•ï¼‰</span><br><span class="line">    "service_worker": "js/background.js"</span><br><span class="line">  &#125;,</span><br><span class="line">  // content scripté…ç½®</span><br><span class="line">  "content_scripts": [</span><br><span class="line">    &#123;</span><br><span class="line">      // è¯¥è„šæœ¬ä¼šåœ¨å“ªäº›é¡µé¢åœ°å€è¿è¡Œï¼ˆå¯ä»¥ä½¿ç”¨æ­£åˆ™ï¼Œ&lt;all_urls&gt;è¡¨ç¤ºåŒ¹é…æ‰€æœ‰åœ°å€ï¼‰</span><br><span class="line">      "matches": [</span><br><span class="line">        <span class="string">"&lt;all_urls&gt;"</span></span><br><span class="line">      ],</span><br><span class="line">      // æ³¨å…¥çš„cssï¼Œæ³¨æ„ä¸è¦æ±¡æŸ“æ ·å¼</span><br><span class="line">      "css": [</span><br><span class="line">        <span class="string">"static/css/content.css"</span></span><br><span class="line">      ],</span><br><span class="line">      // æ³¨å…¥çš„js</span><br><span class="line">      "js": [</span><br><span class="line">        <span class="string">"static/js/content.js"</span></span><br><span class="line">      ],</span><br><span class="line">      // ä»£ç æ³¨å…¥çš„æ—¶é—´ï¼Œå¯é€‰document_startã€document_endã€document_idleï¼ˆé»˜è®¤ï¼‰</span><br><span class="line">      "run_at": "document_end"</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  // æƒé™ç”³è¯·ï¼ˆéœ€è¦backgroundå‘èµ·è·¨åŸŸè¯·æ±‚çš„urlä¹Ÿæ”¾åœ¨è¿™é‡Œï¼‰</span><br><span class="line">  "permissions": [</span><br><span class="line">    "tabs",</span><br><span class="line">    // æ ¹æ®å®šåˆ¶çš„ç½‘é¡µè§„åˆ™ï¼Œé‡‡å–ç›¸åº”çš„æªæ–½ï¼ˆä¾‹å¦‚åªåœ¨baidu.comå¯åŠ¨ç»„ä»¶ï¼‰</span><br><span class="line">    "declarativeContent",</span><br><span class="line">    // æ’ä»¶æœ¬åœ°å­˜å‚¨</span><br><span class="line">    "storage",</span><br><span class="line">    // é€šçŸ¥</span><br><span class="line">    <span class="string">"notifications"</span></span><br><span class="line">  ],</span><br><span class="line">  // å¦‚æœå‘ç›®æ ‡é¡µé¢æ’å…¥jsï¼Œéœ€è¦åœ¨è¿™é‡Œå£°æ˜ä¸‹æ‰èƒ½è·å¾—æ‰§è¡Œçš„æƒé™</span><br><span class="line">  "web_accessible_resources": ["insert.js"]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id="popup"><a href="#popup" class="headerlink" title="popup"></a>popup</h2><p>å°±æ˜¯ä¸€ä¸ªhtmlé¡µé¢ï¼Œå®ƒå¯ä»¥æœ‰è‡ªå·±çš„cssè·ŸJs,ä½¿ç”¨ä¹‹å‰éœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­å£°æ˜ä¸€ä¸‹<br>ç‰¹æ€§ï¼š</p><ul><li>å¯è®¿é—®ç»å¤§éƒ¨åˆ† API</li><li>ç”Ÿå‘½å‘¨æœŸçŸ­<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">"action": &#123;</span><br><span class="line">    "default_icon": "icons/ic_16.png",</span><br><span class="line">    "default_title": "Extension Popup",</span><br><span class="line">    "default_popup": "html/popup.html"</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure></li></ul><h3 id="popupä¸å¸è½½"><a href="#popupä¸å¸è½½" class="headerlink" title="popupä¸å¸è½½"></a>popupä¸å¸è½½</h3><p>å½“å¼¹å‡ºpopupçš„æ—¶å€™ä¼šè§¦å‘useEffectæ¨¡æ‹Ÿçš„mount </p><h2 id="content-scripts"><a href="#content-scripts" class="headerlink" title="content scripts"></a>content scripts</h2><h3 id="æè¿°ï¼š"><a href="#æè¿°ï¼š" class="headerlink" title="æè¿°ï¼š"></a>æè¿°ï¼š</h3><p>content scriptæ˜¯é©»å…¥åˆ°ç›®æ ‡é¡µé¢ä¸­æ‰§è¡Œçš„jsè„šæœ¬ï¼Œå¯ä»¥è·å–ç›®æ ‡é¡µé¢çš„Domå¹¶è¿›è¡Œä¿®æ”¹ã€‚ä½†æ˜¯ï¼Œcontent scriptçš„JavaScriptä¸ç›®æ ‡é¡µé¢æ˜¯äº’ç›¸éš”ç¦»çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œcontent scriptä¸ç›®æ ‡é¡µé¢ä¸ä¼šå‡ºç°äº’ç›¸æ±¡æŸ“çš„é—®é¢˜ï¼ŒåŒæ—¶ï¼Œä¹Ÿä¸èƒ½è°ƒç”¨å¯¹æ–¹çš„æ–¹æ³•ã€‚åŒæ—¶ä¹Ÿä¸èƒ½è·å–åˆ°ç›®æ ‡é¡µé¢çš„å˜é‡ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå¤§éƒ¨åˆ†çš„Chrome API ä»–éƒ½ä¸èƒ½è°ƒç”¨ã€‚<br>åªèƒ½é€šè¿‡ä¸backgroundæˆ–è€…æ˜¯popupé€šä¿¡è°ƒç”¨ã€‚</p><h3 id="ç‰¹æ€§ï¼š"><a href="#ç‰¹æ€§ï¼š" class="headerlink" title="ç‰¹æ€§ï¼š"></a>ç‰¹æ€§ï¼š</h3><ul><li>ç”Ÿå‘½å‘¨æœŸçŸ­ã€‚</li><li>æƒé™å’Œbackgroundéå¸¸ç±»ä¼¼ï¼Œè°ƒç”¨çš„apiä¸€æ ·ã€‚<h3 id="æ‰§è¡Œæ—¶æœºï¼š"><a href="#æ‰§è¡Œæ—¶æœºï¼š" class="headerlink" title="æ‰§è¡Œæ—¶æœºï¼š"></a>æ‰§è¡Œæ—¶æœºï¼š</h3>å¯ä»¥æŒ‡å®šå®ƒçš„æ‰§è¡Œæ—¶æœºï¼š<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"content_scripts"</span>: [</span><br><span class="line">   &#123;</span><br><span class="line">     ...</span><br><span class="line">     <span class="string">"run_at"</span>: <span class="string">"document_start"</span></span><br><span class="line">   &#125;</span><br><span class="line"> ],</span><br></pre></td></tr></table></figure></li></ul><h3 id="æ€»å…±æœ‰ä¸‰ä¸ªå–å€¼ï¼š"><a href="#æ€»å…±æœ‰ä¸‰ä¸ªå–å€¼ï¼š" class="headerlink" title="æ€»å…±æœ‰ä¸‰ä¸ªå–å€¼ï¼š"></a>æ€»å…±æœ‰ä¸‰ä¸ªå–å€¼ï¼š</h3><ul><li>document_start<br>styleæ ·å¼åŠ è½½å¥½ï¼Œdomæ¸²æŸ“å®Œæˆå’Œè„šæœ¬æ‰§è¡Œå‰</li><li>document_end<br>domæ¸²æŸ“å®Œæˆåï¼Œå³DOMContentLoadedåé©¬ä¸Šæ‰§è¡Œ</li><li>document_idleï¼ˆé»˜è®¤ï¼‰<br>åœ¨DOMContentLoaded å’Œ window loadä¹‹é—´ï¼Œå…·ä½“æ˜¯ä»€ä¹ˆæ—¶åˆ»ï¼Œè¦è§†é¡µé¢çš„å¤æ‚ç¨‹åº¦å’ŒåŠ è½½æ—¶é—´ï¼Œå¹¶é’ˆå¯¹é¡µé¢åŠ è½½é€Ÿåº¦è¿›è¡Œäº†ä¼˜åŒ–ã€‚</li></ul><p>tips</p><h3 id="service-worker"><a href="#service-worker" class="headerlink" title="service worker"></a>service worker</h3><p>æè¿°ï¼š<br>åœ¨ç‰ˆæœ¬2å«åšbackground js,å¸¸é©»åœ¨æµè§ˆå™¨åå°è¿è¡Œï¼Œæ²¡æœ‰å®é™…é¡µé¢ï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸéšç€æµè§ˆå™¨æ‰“å¼€è€Œå¼€å§‹ï¼Œéšç€æµè§ˆå™¨å…³é—­è€Œç»“æŸã€‚ä¸€èˆ¬æŠŠå…¨å±€çš„ã€éœ€è¦ä¸€ç›´è¿è¡Œçš„ä»£ç ï¼ˆæ¯”å¦‚ç›‘å¬ä¸å®šæ—¶è§¦å‘çš„äº‹ä»¶ï¼‰æ”¾åœ¨è¿™é‡Œã€‚<br>ä»¥ä¸‹æ‘˜è‡ªå®˜ç½‘<br>æ‰©å±•ç¨‹åºæ˜¯åŸºäºäº‹ä»¶çš„ç¨‹åºï¼Œç”¨äºä¿®æ”¹æˆ–å¢å¼º Chrome æµè§ˆä½“éªŒã€‚äº‹ä»¶æ˜¯æµè§ˆå™¨è§¦å‘å™¨ï¼Œä¾‹å¦‚å¯¼èˆªåˆ°æ–°é¡µé¢ã€åˆ é™¤ä¹¦ç­¾æˆ–å…³é—­é€‰é¡¹å¡ã€‚æ‰©å±•ä½¿ç”¨service workerä¸­çš„è„šæœ¬ç›‘è§†è¿™äº›äº‹ä»¶ï¼Œç„¶åæ ¹æ®æŒ‡å®šçš„æŒ‡ä»¤åšå‡ºååº”ã€‚</p><h4 id="service-workeræ˜¯å•¥"><a href="#service-workeræ˜¯å•¥" class="headerlink" title="service workeræ˜¯å•¥"></a>service workeræ˜¯å•¥</h4><p>service worker æ˜¯ä¸€ä¸ªç‹¬ç«‹ worker çº¿ç¨‹ï¼Œç‹¬ç«‹äºå½“å‰ç½‘é¡µè¿›ç¨‹ï¼Œæœ‰è‡ªå·±ç‹¬ç«‹çš„ worker context ,service worker çš„çº¿ç¨‹èƒ½åŠ›åŸºäº webworker è€Œç”Ÿï¼Œé€šè¿‡ postMessage å’Œ onMessage è¿›è¡Œçº¿ç¨‹ä¹‹é—´çš„é€šä¿¡ï¼›ç¼“å­˜æœºåˆ¶æ˜¯ä¾èµ– cache API å®ç°çš„ã€‚<br>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œservice workerä¸ä¼šä¸€ç›´å¤„äºæ¿€æ´»çš„çŠ¶æ€ï¼Œé™¤äº†åˆæ¬¡å®‰è£…ï¼Œä»¥åŠæ¥æ”¶åˆ°ç½‘ç»œè¯·æ±‚çš„æ—¶å€™ï¼Œåœ¨Chrome extensionä¸­ï¼ŒæŒ‰ç…§å®˜æ–¹æè¿°ï¼šæ­£åœ¨ä¾¦å¬çš„äº‹ä»¶è§¦å‘ï¼ŒæŒ‰ç…§æŒ‡å®šçš„æŒ‡ä»¤åšå‡ºååº”ï¼Œç„¶åå¸è½½ã€‚</p><h4 id="ç‰¹æ€§ï¼š-1"><a href="#ç‰¹æ€§ï¼š-1" class="headerlink" title="ç‰¹æ€§ï¼š"></a>ç‰¹æ€§ï¼š</h4><ul><li>ç”Ÿå‘½å‘¨æœŸé•¿ï¼šä»æµè§ˆå™¨é¡µé¢æ‰“å¼€æ—¶å€™å¼€å§‹åŠ è½½ï¼Œå…³é—­æ—¶ç»ˆæ­¢ã€‚</li><li>æƒé™å¤§ï¼šå¯ä»¥è°ƒç”¨å‡ ä¹å¯ä»¥è°ƒç”¨æ‰€æœ‰çš„Chromeæ‰©å±•APIï¼ˆé™¤äº†devtoolsï¼‰ã€‚</li><li>æ— è·¨åŸŸé™åˆ¶ï¼šå¯ä»¥è·¨åŸŸè®¿é—®ä»»ä½•ç½‘ç«™è€Œæ— éœ€è¦æ±‚å¯¹æ–¹è®¾ç½®CORSã€‚</li><li>ä¸èƒ½è®¿é—®domï¼šworkerçº¿ç¨‹æ‰€åœ¨çš„å…¨å±€å¯¹è±¡ï¼Œä¸ä¸»çº¿ç¨‹ä¸ä¸€æ ·ï¼Œæ— æ³•è¯»å–ä¸»çº¿ç¨‹æ‰€åœ¨ç½‘é¡µçš„DOMå¯¹è±¡ï¼Œä¹Ÿæ— æ³•ä½¿ç”¨documentï¼Œwindowï¼Œparentè¿™äº›å¯¹è±¡ã€‚</li><li>æ–‡ä»¶é™åˆ¶ï¼šworkçº¿ç¨‹æ— æ³•è¯»å–æœ¬åœ°æ–‡ä»¶ï¼Œæ—¢ä¸å¯ä»¥æ‰“å¼€æœ¬å­£çš„æ–‡ä»¶ç³»ç»Ÿï¼Œæ‰€åŠ è½½çš„è„šæœ¬ï¼Œå¿…é¡»æ¥è‡ªç½‘ç»œ<br>é€šä¿¡æœºåˆ¶</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* eslint-disable no-undef */</span></span><br><span class="line"><span class="comment">// ç»Ÿä¸€æ¶ˆæ¯æ ¼å¼</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ChromeMessage</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(msg, params) &#123;</span><br><span class="line">        <span class="keyword">this</span>.msg = msg;</span><br><span class="line">        <span class="keyword">this</span>.params = params;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è·å–å‡½æ•°çš„å½¢å‚ä¸ªæ•°</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getFuncParameters</span>(<span class="params">func</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> func === <span class="string">'function'</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> match = <span class="regexp">/[^(]+\(([^)]*)?\)/gm</span>.exec(<span class="built_in">Function</span>.prototype.toString.call(func));</span><br><span class="line">        <span class="keyword">if</span> (match[<span class="number">1</span>]) &#123;</span><br><span class="line">            <span class="keyword">const</span> args = match[<span class="number">1</span>].replace(<span class="regexp">/[^,\w]*/g</span>, <span class="string">''</span>).split(<span class="string">','</span>);</span><br><span class="line">            <span class="keyword">return</span> args.length;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›‘å¬å›è°ƒå‡½æ•°</span></span><br><span class="line"><span class="keyword">const</span> listeners = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// äº‹ä»¶åˆ†å‘</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dispatchEvent</span>(<span class="params">request, sendResponse</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; msg &#125; = request;</span><br><span class="line">    <span class="keyword">let</span> callBack;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Object</span>.keys(listeners).forEach(<span class="function">(<span class="params">key</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (key === msg) &#123;</span><br><span class="line">            callBack = listeners[key];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (callBack) &#123;</span><br><span class="line">        <span class="keyword">const</span> paramSize = getFuncParameters(callBack);</span><br><span class="line"></span><br><span class="line">        callBack(request, sendResponse);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> paramSize === <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">chrome.runtime.onMessage.addListener(<span class="function">(<span class="params">request, sender, sendResponse</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> success = dispatchEvent(request, sendResponse);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!success) &#123;</span><br><span class="line">        sendResponse(<span class="keyword">new</span> ChromeMessage(<span class="string">'Default Response'</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// content scripts å‘é€å’Œç›‘å¬æ¶ˆæ¯</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ContentClient</span> </span>&#123;</span><br><span class="line">    listen(msg, callBack) &#123;</span><br><span class="line">        listeners[msg] = callBack;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    sendMessage(message) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">            chrome.runtime.sendMessage(message, (res) =&gt; &#123;</span><br><span class="line">                resolve(res);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">popupClient</span> <span class="keyword">extends</span> <span class="title">ContentClient</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// background å‘é€å’Œç›‘å¬æ¶ˆæ¯</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BackgroundClient</span> </span>&#123;</span><br><span class="line">    listen(msg, callBack) &#123;</span><br><span class="line">        listeners[msg] = callBack;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    sendMessage(message) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">            chrome.tabs.query(&#123; <span class="attr">active</span>: <span class="literal">true</span> &#125;, (tabs) =&gt; &#123;</span><br><span class="line">                chrome.tabs.sendMessage(tabs[<span class="number">0</span>].id, message, (response) =&gt; &#123;</span><br><span class="line">                    resolve(response);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> contentClient = <span class="keyword">new</span> ContentClient();</span><br><span class="line"><span class="keyword">const</span> backgroundClient = <span class="keyword">new</span> BackgroundClient();</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">    contentClient, backgroundClient, ChromeMessage, popupClient</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="å­˜å‚¨æœºåˆ¶"><a href="#å­˜å‚¨æœºåˆ¶" class="headerlink" title="å­˜å‚¨æœºåˆ¶"></a>å­˜å‚¨æœºåˆ¶</h2><h3 id="localStorage"><a href="#localStorage" class="headerlink" title="localStorage"></a>localStorage</h3><p>ä¼˜ç‚¹ï¼š</p><ul><li><p>åŒæ­¥ï¼Œå› æ­¤æ›´å®¹æ˜“ä½¿ç”¨ï¼švar value = localStorage[key]</p></li><li><p>åœ¨ Dev Tools: Resources &gt; Local Storageä¸­æ”¯æŒæŸ¥çœ‹å’Œä¿®æ”¹ã€‚<br>ç¼ºç‚¹ï¼š</p></li><li><p>ä»…å­˜å‚¨å­—ç¬¦ä¸²ï¼Œå› æ­¤æ‚¨éœ€è¦è‡ªå·±åºåˆ—åŒ–æ•°æ®ï¼Œå³JSON.stringify</p></li><li><p>æ— æ³•ä»å†…å®¹è„šæœ¬è®¿é—®ï¼ˆæˆ–è€…æ›´ç¡®åˆ‡åœ°è¯´ï¼Œä¸Šä¸‹æ–‡è„šæœ¬ä¸é¡µé¢è€Œä¸æ˜¯æ‰©å±•å…±äº«å®ƒï¼‰ï¼Œå› æ­¤æ‚¨éœ€è¦ä¾é æ¶ˆæ¯ä¼ é€’å°†å€¼ä¼ é€’ç»™å®ƒä»¬ã€‚</p></li><li><p>åœ¨å¹¶å‘æ‰§è¡Œçš„æ‰©å±•é¡µé¢ä¹‹é—´åŒæ­¥ AND å…±äº«ï¼Œä»è€Œå¯¼è‡´å¯èƒ½çš„åŒæ­¥é—®é¢˜ã€‚<br>chrome.storage.local<br>ä¼˜ç‚¹ï¼š</p></li><li><p>è‡ªåŠ¨åºåˆ—åŒ–ä¸ JSON å…¼å®¹çš„æ•°æ®ï¼Œå¯ä»¥å­˜å‚¨éå­—ç¬¦ä¸²ï¼Œä½†æ˜¯ä¸èƒ½å­˜å‚¨mapå¯¹è±¡ï¼Œéœ€è¦ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// set</span></span><br><span class="line"><span class="keyword">const</span> validValue = isMap ? <span class="built_in">Object</span>.fromEntries(value) : value;</span><br><span class="line">        chrome.storage[storageType].set(&#123; [key]: validValue &#125;, () =&gt; &#123;</span><br><span class="line">            resolve(value);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// get</span></span><br><span class="line"> res = isMap ? <span class="keyword">new</span> <span class="built_in">Map</span>(<span class="built_in">Object</span>.entries(res)) : res;</span><br><span class="line">            resolve(res);</span><br></pre></td></tr></table></figure></li><li><p>åœ¨å†…å®¹è„šæœ¬ä¸­å®Œå…¨å¯ç”¨ã€‚</p></li><li><p>æ”¯æŒé€šçŸ¥æ›´æ”¹çš„äº‹ä»¶ï¼šchrome.storage.onChanged</p></li><li><p>ç»â€unlimitedStorageâ€è®¸å¯ï¼Œå¯ä»¥ä¿å­˜ä»»æ„å¤§é‡çš„æ•°æ®ã€‚</p></li><li><p>æœ‰ä¸€ä¸ªå¾ˆå¥½çš„é»˜è®¤å€¼å†…ç½®æœºåˆ¶ï¼šchrome.storage.local.get({key: defaultValue}, function(value){/<em>â€¦</em>/}); </p></li><li><p>Firefox WebExtensions å’Œ Edge Extensions å®Œå…¨æ”¯æŒã€‚<br>ç¼ºç‚¹ï¼š</p></li><li><p>åœ¨å¼€å‘å·¥å…·ä¸­ä¸å¯è§†åŒ–ï¼›éœ€è¦è°ƒç”¨chrome.storage.local.get(null)ä»¥è·å–æ‰€æœ‰å€¼æˆ–ä½¿ç”¨ç±»ä¼¼Storage Area Explorer çš„ä¸œè¥¿ã€‚<br>chrome.storage.sync<br>ä¸ä¸Šé¢ç›¸åŒï¼Œä½†æ˜¯ï¼š<br>ä¼˜ç‚¹ï¼š</p></li><li><p>å¦‚æœå¯ç”¨äº†æ‰©å±•åŒæ­¥ï¼Œåˆ™åœ¨å·²ç™»å½•çš„ Chrome å®ä¾‹ä¹‹é—´è‡ªåŠ¨åŒæ­¥ã€‚<br>ç¼ºç‚¹ï¼š</p></li><li><p>æ•°æ®å¤§å°å°</p><h2 id="å®æˆ˜æŒ‡å—"><a href="#å®æˆ˜æŒ‡å—" class="headerlink" title="å®æˆ˜æŒ‡å—"></a>å®æˆ˜æŒ‡å—</h2><h3 id="æ€ä¹ˆåšåˆ°çƒ­æ›´æ–°ï¼Ÿ"><a href="#æ€ä¹ˆåšåˆ°çƒ­æ›´æ–°ï¼Ÿ" class="headerlink" title="æ€ä¹ˆåšåˆ°çƒ­æ›´æ–°ï¼Ÿ"></a>æ€ä¹ˆåšåˆ°çƒ­æ›´æ–°ï¼Ÿ</h3><h4 id="æ­£å¸¸çš„æ›´æ–°æµç¨‹"><a href="#æ­£å¸¸çš„æ›´æ–°æµç¨‹" class="headerlink" title="æ­£å¸¸çš„æ›´æ–°æµç¨‹"></a>æ­£å¸¸çš„æ›´æ–°æµç¨‹</h4></li></ul><p>1.æœ¬åœ°npm run build<br>2.è¿›å…¥æ‰©å±•ç¨‹åºç®¡ç†é¡µé¢ï¼Œé‡æ–°åŠ è½½distæ–‡ä»¶<br>3.æŒ‰ä¸‹åˆ·æ–°æŒ‰é’®åˆ·æ–°<br>4.å›åˆ°è¢«è„šæœ¬æ³¨å…¥çš„é¡µé¢ï¼Œåˆ·æ–°èµ„æº</p><h4 id="çƒ­æ›´æ–°çš„æ›´æ–°æµç¨‹"><a href="#çƒ­æ›´æ–°çš„æ›´æ–°æµç¨‹" class="headerlink" title="çƒ­æ›´æ–°çš„æ›´æ–°æµç¨‹"></a>çƒ­æ›´æ–°çš„æ›´æ–°æµç¨‹</h4><p>åœ¨ webpack server å’Œ chrome extension ä¹‹é—´æ­å»ºä¸€ä¸ª è¿æ¥ï¼Œç”± webpack server å‘ chrome extension æ¨é€ç¼–è¯‘å®Œæˆçš„æ¶ˆæ¯</p><ul><li><p>å°†bundleå†™å…¥åˆ°ç£ç›˜ä¸­è€Œä¸æ˜¯å†…å­˜ä¸­</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  devServer: &#123;</span><br><span class="line">    writeToDisk: <span class="literal">true</span>,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>ç›‘å¬reloadæ¥å£ï¼Œç›‘å¬åˆ°ä¹‹åï¼Œæ³¨å†Œç›‘å¬ç¼–è¯‘å®Œæˆçš„é’©å­ï¼Œåœ¨æ­¤å¤„å‘é€æ¶ˆæ¯åˆ°Chrome extension</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ReloadServer</span>(<span class="params">app</span>) </span>&#123;</span><br><span class="line">    app.get(<span class="string">'/reload'</span>, (req, res, next) =&gt; &#123;</span><br><span class="line">      <span class="comment">// å°† request è½¬æ¢ä¸ºä¸€ä¸ª SSEStream</span></span><br><span class="line">        <span class="keyword">const</span> sseStream = <span class="keyword">new</span> SSEStream(req);</span><br><span class="line">        <span class="keyword">const</span> compiler = ChromeReloadPlugin.innerCompiler;</span><br><span class="line">        sseStream.pipe(res);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> closed = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> reloadPlugin = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!closed) &#123;</span><br><span class="line">                <span class="comment">// sseä¸éœ€è¦åŒå‘é€šè®¯</span></span><br><span class="line">                sseStream.write(</span><br><span class="line">                    &#123;</span><br><span class="line">                        event: <span class="string">'compiled successfully'</span>,</span><br><span class="line">                        data: &#123;</span><br><span class="line">                            action: <span class="string">'reload extension and refresh current page'</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="string">'utf-8'</span>,</span><br><span class="line">                    (err) =&gt; &#123;</span><br><span class="line">                        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                            <span class="built_in">console</span>.error(err);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;,</span><br><span class="line">                );</span><br><span class="line"></span><br><span class="line">                setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">                    sseStream.unpipe(res);</span><br><span class="line">                &#125;, <span class="number">100</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        compiler.hooks.done.tap(</span><br><span class="line">            <span class="string">'chrome reload plugin'</span>,</span><br><span class="line">            reloadPlugin</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        res.on(<span class="string">'close'</span>, () =&gt; &#123;</span><br><span class="line">            closed = <span class="literal">true</span>;</span><br><span class="line">            sseStream.unpipe(res);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        next();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>å…¶ä¸­æ¶‰åŠåˆ°ä¸€ç§æŠ€æœ¯ï¼šSSEï¼Œè¿™é‡Œç®€å•ä»‹ç»ä¸€ä¸‹ï¼ŒSSEæ˜¯ä¸€ç§æœåŠ¡å™¨æ¨é€æŠ€æœ¯ï¼Œä½¿å®¢æˆ·ç«¯èƒ½å¤Ÿé€šè¿‡ HTTP è¿æ¥ä»æœåŠ¡å™¨æ¥æ”¶è‡ªåŠ¨æ›´æ–°ã€‚</p><ul><li>Chrome extensionç›‘å¬reloadæ¥å£ï¼Œè°ƒç”¨Chromeçš„reloadå®Œæˆæ›´æ–°ï¼ŒåŒæ—¶é€šçŸ¥content scriptæ›´æ–°<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// background.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; backgroundClient, ChromeMessage, reload &#125; <span class="keyword">from</span> <span class="string">'../chrome'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> eventSource = <span class="keyword">new</span> EventSource(<span class="string">'http://localhost:8080/reload/'</span>);</span><br><span class="line">eventSource.addEventListener(<span class="string">'compiled successfully'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> res = <span class="keyword">await</span> backgroundClient.sendMessage(<span class="keyword">new</span> ChromeMessage(<span class="string">'refresh page'</span>));</span><br><span class="line">  <span class="keyword">if</span> (res) &#123;</span><br><span class="line">      reload();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// content script</span></span><br><span class="line">contentClient.listen(<span class="string">'refresh page'</span>, (res, sendResponse) =&gt; &#123;</span><br><span class="line">    sendResponse(<span class="string">'received refresh cmd'</span>);</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">window</span>.location.reload();</span><br><span class="line">    &#125;, <span class="number">500</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li></ul><h2 id="å¸¸è§é—®é¢˜"><a href="#å¸¸è§é—®é¢˜" class="headerlink" title="å¸¸è§é—®é¢˜"></a>å¸¸è§é—®é¢˜</h2><ul><li>content scriptæ ·å¼æ±¡æŸ“é—®é¢˜<br>content scriptèƒ½æ“ä½œç›®æ ‡é¡µé¢çš„domï¼Œæ‰€ä»¥ä¹Ÿèƒ½ç”Ÿæˆdomæ’å…¥åˆ°ç›®æ ‡é¡µé¢ï¼Œå¯ä»¥ä¸ºç”Ÿæˆçš„domæŒ‡å®šæ ·å¼æ–‡ä»¶<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"content_scripts"</span>: [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">"matches"</span>: [<span class="string">"&lt;all_urls&gt;"</span>],</span><br><span class="line">    <span class="string">"js"</span>: [<span class="string">"js/contentScripts.js"</span>],</span><br><span class="line">    <span class="string">"css"</span>: [<span class="string">"css/contentScripts.css"</span>],</span><br><span class="line">    <span class="string">"run_at"</span>: <span class="string">"document_start"</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure></li></ul><p>è¿™é‡Œçš„æ ·å¼æ–‡ä»¶å¹¶ä¸ä¼šä¸ç›®æ ‡é¡µé¢çš„æ ·å¼ç›¸äº’éš”ç»ã€‚<br><strong>æ€ä¹ˆè§£å†³ï¼Ÿ</strong><br>ä½¿ç”¨postcssçš„æ’ä»¶<code>postcss-plugin-namespace</code>ä¸ºå…¨å±€çš„cssç”Ÿæˆä¸€ä¸ªnamespaceåŒ…è£¹åœ¨æœ€å¤–é¢ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> postCssPlugins = [</span><br><span class="line">    <span class="built_in">require</span>(<span class="string">'autoprefixer'</span>),</span><br><span class="line">    <span class="built_in">require</span>(<span class="string">'postcss-plugin-namespace'</span>)(<span class="string">`.<span class="subst">$&#123;wrapperClassName&#125;</span>`</span>, &#123; <span class="attr">ignore</span>: [<span class="string">'#chrome-extension-content-base-element'</span>, /^((?!\.ant-btn).)*$/] &#125;)</span><br><span class="line">];</span><br></pre></td></tr></table></figure><p>åŒæ—¶ä¹Ÿè¦ä¸ºdomå…ƒç´ æ‰‹åŠ¨åŠ ä¸Šæ­¤ç±»å</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> webpack.DefinePlugin(&#123;</span><br><span class="line">           WRAPPER_CLASS_NAME: <span class="string">`'<span class="subst">$&#123;wrapperClassName&#125;</span>'`</span> <span class="comment">// é˜²æ­¢æ’ä»¶çš„æ ·å¼è¢«æ±¡æŸ“æˆ–è€…æ˜¯å½“å‰é¡µé¢çš„æ ·å¼æ±¡æŸ“æ’ä»¶çš„æ ·å¼</span></span><br><span class="line">       &#125;)</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯åƒç»„ä»¶åº“ä¸­çš„modalç­‰ç»„ä»¶ï¼Œå¹¶ä¸èƒ½ç»™ä»–çš„æœ€å¤–å±‚æŒ‡å®šç±»åï¼Œä½†æ˜¯ç»„ä»¶åº“çš„æ ·å¼æ–‡ä»¶åŒæ ·ä¼šè¢«åŠ ä¸Šnamespaceéœ€è¦åœ¨é…ç½®çš„æ—¶å€™ignoreæ‰è¿™ä¸€éƒ¨åˆ†ç±»åï¼Œæ‰‹åŠ¨åœ¨æ ·å¼æ–‡ä»¶ä¸­åŠ ä¸ŠåŒ…è£¹çš„ç±»åã€‚<br>å‡çº§åˆ°v3ä¹‹åbackgroundæ— æ³•ç›‘å¬åˆ°å¼‚æ­¥å‘é€çš„æ¶ˆæ¯äº†</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// content scirpt</span></span><br><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">'DOMContentLoaded'</span>, () =&gt; &#123;</span><br><span class="line">            <span class="keyword">this</span>.listenSetCookieCmd();</span><br><span class="line">            <span class="keyword">this</span>.sendUserPermission();</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// background.js</span></span><br><span class="line"> <span class="keyword">async</span> listenSetPersonalPermissionCmd() &#123;</span><br><span class="line">        contentClient.listen(<span class="string">'get-current-permission'</span>, <span class="keyword">async</span> (res, sendResponse) =&gt; &#123;</span><br><span class="line">            <span class="keyword">await</span> storage.set(<span class="string">'personalPermission'</span>, res.params, <span class="literal">true</span>);</span><br><span class="line">            sendResponse(<span class="keyword">new</span> ChromeMessage(<span class="string">'set personal permission success'</span>));</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">å¦‚ä¸Š å¹¶æœªå“åº”ï¼ŒçŒœæƒ³æ˜¯service workeråœ¨ä¸€æ®µæ—¶é—´æ²¡æ”¶åˆ°æ¶ˆæ¯ä¹‹åä¼šè‡ªåŠ¨è¿›å…¥ä¼‘çœ </span><br><span class="line">æ€ä¹ˆè§£å†³ï¼Ÿ</span><br><span class="line"><span class="comment">// content script</span></span><br><span class="line"> <span class="keyword">async</span> init() &#123;</span><br><span class="line">        <span class="keyword">this</span>.setHeartBeat();</span><br><span class="line">        <span class="comment">// æ³¨æ„ï¼Œå¿…é¡»è®¾ç½®äº†run_at=document_start æ­¤æ®µä»£ç æ‰ä¼šç”Ÿæ•ˆ</span></span><br><span class="line">        <span class="built_in">document</span>.addEventListener(<span class="string">'DOMContentLoaded'</span>, () =&gt; &#123;</span><br><span class="line">          ...</span><br><span class="line">          </span><br><span class="line">setHeartBeat() &#123;</span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">            contentClient.sendMessage(<span class="string">'ping'</span>);</span><br><span class="line">        &#125;, <span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line"><span class="comment">// background.js</span></span><br><span class="line"> init()&#123;</span><br><span class="line">   <span class="keyword">this</span>.listenPing()</span><br><span class="line"> &#125;</span><br><span class="line">          </span><br><span class="line"> listenPing() &#123;</span><br><span class="line">        parentClient.listen(<span class="string">'ping'</span>, (<span class="function">(<span class="params">res, sendResponse</span>) =&gt;</span> &#123;</span><br><span class="line">            sendResponse(<span class="string">'pong'</span>);</span><br><span class="line">        &#125;));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><ul><li><p>è„šæœ¬æ³¨å…¥</p><ul><li>æ— è®ºæ˜¯registerScriptè¿˜æ˜¯execute Scriptï¼Œä»–çš„windowè·Ÿè¢«æ³¨å…¥é¡µé¢çš„éƒ½æ˜¯ç›¸äº’ç‹¬ç«‹çš„windowï¼Œå¦‚æœéœ€è¦æ›´æ”¹ç›®æ ‡é¡µé¢çš„window:<br>const script = document.createElement(â€˜scriptâ€™);<br>  script.setAttribute(â€˜typeâ€™, â€˜text/javascriptâ€™);<br>  script.setAttribute(â€˜srcâ€™, chrome.runtime.getURL(â€˜inject.jsâ€™));<br>  (document.head || document.documentElement).prepend(script);<br>ä¸´æ—¶æ³¨å…¥çš„è„šæœ¬ä¸èƒ½é˜»å¡åé¢çš„è„šæœ¬çš„æ‰§è¡Œï¼Œå¯èƒ½æ˜¯å› ä¸ºè¢«æ³¨å…¥çš„æ—¶å€™è¿˜åé¢çš„è„šæœ¬å·²ç»å¼€å§‹parseäº†</li><li>ä¸´æ—¶æ’å…¥çš„è„šæœ¬ï¼Œè™½ç„¶æ˜¯ä¸ªæœ¬åœ°çš„è„šæœ¬ä½†æ˜¯ä¹Ÿéœ€è¦åŠ è½½ï¼Œéœ€è¦<code>script.onload=xxx</code>,content scriptæ˜¯ä¸€ä¸ªstandaloneçš„å­¤ç«‹çš„è„šæœ¬ï¼Œå®ƒä¸ä¼šç­‰åˆ°è¢«æ’å…¥åˆ°é¡µé¢çš„è¿™ä¸ªè„šæœ¬æ‰§è¡Œå®Œæ¯•ä¹‹åå†æ‰§è¡Œ</li><li>content scriptä¸injectjsçš„é€šä¿¡ï¼špostmessage</li><li>ä¸èƒ½ç›´æ¥æ‰§è¡Œå†…è”è„šæœ¬ä¿®æ”¹windowå˜é‡ï¼Œä¼šæŠ¥é”™<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">script.innerHTML = <span class="string">`window.ggconfig=<span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(config)&#125;</span>`</span>;</span><br><span class="line"><span class="built_in">document</span>.body.appendChild(script);</span><br></pre></td></tr></table></figure></li></ul></li><li><p>é‡å®šå‘</p><ul><li>æ‹¦æˆªè¢«æ³¨å…¥é¡µé¢çš„é‡å®šå‘ï¼Œhtmlçš„é‡å®šå‘éœ€è¦æ˜¯ä¸€ä¸ªç›¸åŒçš„åŸŸå<br>å¦‚ä½•é˜»å¡å½“å‰é¡µé¢çš„è§£æï¼Ÿ<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> startTime = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime() + <span class="number">2</span>*<span class="number">1000</span>;</span><br><span class="line"><span class="keyword">while</span> (<span class="keyword">new</span> <span class="built_in">Date</span>().getTime() &lt; startTime) &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li></ul><p>æ’å…¥å¦‚ä¸Šè€—æ—¶ä»£ç ï¼Œä½†æ˜¯å› ä¸ºè¿™æ®µä»£ç æ˜¯ç›´æ¥åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œçš„ï¼Œæ‰€ä»¥å¦‚æœæˆ‘åœ¨æ‰©å±•çš„è„šæœ¬ä¸­åŠ ä¸Šä¸€ä¸ªå®šæ—¶å™¨ï¼Œå®šæ—¶å™¨å› ä¸ºæ˜¯å®ä»»åŠ¡ï¼Œä¹Ÿä¼šè¢«é˜»å¡ï¼Œæƒ³åˆ°çš„æ–¹æ³•æ˜¯è®©è¿™æ®µå®šæ—¶å™¨ä»£ç åœ¨web workerä¸­æ‰§è¡Œï¼Œä½†æ˜¯chrome extensionä¸æ”¯æŒæœ¬åœ°js ä½œä¸ºweb workerå­è¿›ç¨‹ï¼ŒæŠ˜ä¸­çš„æ–¹å¼ï¼š<br>new Worker(URL.createObjectURL(new Blob([(${xFunction.toString()})(${json})], { type: â€˜text/javascriptâ€™ })))<br>ä½†æ˜¯ web workerè²Œä¼¼ä¸èƒ½åƒçˆ¶çª—å£ä¹‹å¤–çš„çª—å£å‘é€<code>postMessage</code></p><p>ç»¼ä¸Šï¼šchrome extensionå¯¹è„šæœ¬çš„é™åˆ¶è¿˜æ˜¯æ¯”è¾ƒå¤šçš„ï¼Œå¦‚æœæŠ€æœ¯ä¸Šä¸å¯è¡Œçš„è¯ï¼ŒåŠæ—¶æ›´æ¢äº§å“æ–¹æ¡ˆ<br>Chrome extensionèƒ½ç”¨æ¥åšå•¥<br>æ“ä½œcookie<br>å¼ºå¤§çš„chrome.cookiesapièƒ½è·å–åˆ°å½“å‰åŸŸåä¸‹å­˜åœ¨çš„æ‰€æœ‰çš„cookieï¼ŒåŒ…æ‹¬è®¾ç½®äº†httpOnlyçš„ï¼Œå¯ä»¥ç”¨æ¥å¯¹cookieè¿›è¡Œå¿«é€Ÿè¯»å–åˆ é™¤ç­‰æ“ä½œã€‚<br>æ‹¦æˆªç½‘ç»œè¯·æ±‚<br>chrome.webRequestèƒ½æ‹¦æˆªåˆ°ajaxè¯·æ±‚çš„å„ä¸ªé˜¶æ®µï¼Œå¹¶ä¸”ä¿®æ”¹æˆ–è€…æ˜¯å±è”½è¯·æ±‚</p><p>å±è”½æ‰æ‰€æœ‰å‘å¾€<a href="http://www.evil.comçš„è¯·æ±‚" target="_blank" rel="noopener">www.evil.comçš„è¯·æ±‚</a></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">chrome.webRequest.onBeforeRequest.addListener(</span><br><span class="line">  <span class="function"><span class="keyword">function</span>(<span class="params">details</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="attr">cancel</span>: details.url.indexOf(<span class="string">"://www.evil.com/"</span>) != <span class="number">-1</span>&#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;<span class="attr">urls</span>: [<span class="string">"&lt;all_urls&gt;"</span>]&#125;,</span><br><span class="line">  [<span class="string">"blocking"</span>]</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>å…¶ä»–</p><ul><li>å‘é¡µé¢æ³¨å…¥JSè„šæœ¬,æ¯”å¦‚temperMongkey</li><li>ç½‘é¡µæˆªå›¾</li><li>åˆ©ç”¨chrome.tabsapi æ“ä½œå½“å‰æ‰“å¼€çš„æ ‡ç­¾é¡µï¼ˆæ•´ç†ï¼Œæœç´¢,ç§»é™¤ç­‰ç­‰ï¼‰ï¼Œæ¯”å¦‚one tab</li><li>æ“ä½œå½“å‰é¡µé¢çš„dom,æ¯”å¦‚åˆ’è¯æœç´¢<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><a href="https://zhuanlan.zhihu.com/p/399937088" target="_blank" rel="noopener">å¦‚ä½•å®ç° chrome extension çš„çƒ­æ›´æ–°</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> chromeExtension </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vue3å“åº”å¼åŸç†</title>
      <link href="/ashley271017.github.io/2022/05/15/%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8E%9F%E7%90%86/"/>
      <url>/ashley271017.github.io/2022/05/15/%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8E%9F%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h3 id="Proxy"><a href="#Proxy" class="headerlink" title="Proxy"></a>Proxy</h3><p>Vue3 çš„å“åº”å¼åŸç†ä¾èµ–äº† Proxy è¿™ä¸ªæ ¸å¿ƒ APIï¼Œé€šè¿‡ Proxy å¯ä»¥åŠ«æŒå¯¹è±¡çš„æŸäº›æ“ä½œã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123; <span class="attr">a</span>: <span class="number">1</span> &#125;;</span><br><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> <span class="built_in">Proxy</span>(obj, &#123;</span><br><span class="line">  <span class="keyword">get</span>(target, property, receiver) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"get"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Reflect</span>.get(target, property, receiver);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="keyword">set</span>(target, property, value, receiver) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"set"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Reflect</span>.set(target, property, receiver);</span><br><span class="line">  &#125;,</span><br><span class="line">  has(target, prop) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"has"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Reflect</span>.has(target, prop);</span><br><span class="line">  &#125;,</span><br><span class="line">  deleteProperty(target, prop) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"deleteProperty"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Reflect</span>.deleteProperty(target, prop);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">p.a; <span class="comment">// è¾“å‡º --&gt; get</span></span><br><span class="line">p.a = <span class="number">2</span>; <span class="comment">// è¾“å‡º --&gt; set</span></span><br><span class="line"><span class="string">"a"</span> <span class="keyword">in</span> p; <span class="comment">// è¾“å‡º --&gt; has</span></span><br><span class="line"><span class="keyword">delete</span> p.a; <span class="comment">// è¾“å‡º --&gt; deleteProperty</span></span><br></pre></td></tr></table></figure><p>å¦‚ä¸Šä¾‹å­ï¼Œæˆ‘ä»¬ç”¨ Proxy ä»£ç†äº† Obj å¯¹è±¡çš„å±æ€§è®¿é—®ã€å±æ€§èµ‹å€¼ã€in æ“ä½œç¬¦ã€delete çš„æ“ä½œï¼Œå¹¶è¿›è¡Œ console.log è¾“å‡ºã€‚</p><h3 id="Reflect"><a href="#Reflect" class="headerlink" title="Reflect"></a>Reflect</h3><p>Reflect æ˜¯ä¸ Proxy æ­é…ä½¿ç”¨çš„ä¸€ä¸ª APIï¼Œå½“æˆ‘ä»¬åŠ«æŒäº†æŸäº›æ“ä½œæ—¶ï¼Œå¦‚æœéœ€è¦å†æŠŠè¿™äº›æ“ä½œåå°„å›å»ï¼Œé‚£ä¹ˆå°±éœ€è¦ Reflect è¿™ä¸ª APIã€‚</p><p>ç”±äºæˆ‘ä»¬æ‹¦æˆªäº†å¯¹è±¡çš„æ“ä½œï¼Œæ‰€ä»¥è¿™äº›æ“ä½œè¯¥æœ‰çš„åŠŸèƒ½éƒ½ä¸§å¤±äº†ï¼Œä¾‹å¦‚ï¼Œè®¿é—®å±æ€§ p.a åº”è¯¥å¾—åˆ° a å±æ€§çš„å€¼ï¼Œä½†æ­¤æ—¶å´ä¸ä¼šæœ‰ä»»ä½•ç»“æœï¼Œå¦‚æœæˆ‘ä»¬è¿˜æƒ³æ‹¥æœ‰æ‹¦æˆªä¹‹å‰çš„åŠŸèƒ½ï¼Œé‚£æˆ‘ä»¬å°±éœ€è¦ç”¨ Reflect åå°„å›å»ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123; <span class="attr">a</span>: <span class="number">1</span> &#125;;</span><br><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> <span class="built_in">Proxy</span>(obj, &#123;</span><br><span class="line">  <span class="keyword">get</span>(target, property, receiver) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"get"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Reflect</span>.get(target, property, receiver);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="keyword">set</span>(target, property, value, receiver) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"set"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Reflect</span>.set(target, property, receiver);</span><br><span class="line">  &#125;,</span><br><span class="line">  has(target, prop) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"has"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Reflect</span>.has(target, prop);</span><br><span class="line">  &#125;,</span><br><span class="line">  deleteProperty(target, prop) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"deleteProperty"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Reflect</span>.deleteProperty(target, prop);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="ä¸¾ä¸ªä¾‹å­"><a href="#ä¸¾ä¸ªä¾‹å­" class="headerlink" title="ä¸¾ä¸ªä¾‹å­"></a>ä¸¾ä¸ªä¾‹å­</h3><p>ä»¥ä¸‹å…¨æ–‡æˆ‘ä»¬éƒ½ä¼šé€šè¿‡è¿™ä¸ªä¾‹å­æ¥è®²è¿° Vue3 å“åº”å¼çš„åŸç†ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=<span class="string">"app"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="comment">// åˆ›å»ºä¸€ä¸ªå“åº”å¼å¯¹è±¡</span></span><br><span class="line">  <span class="keyword">const</span> state = reactive(&#123; <span class="attr">counter</span>: <span class="number">1</span> &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç«‹å³è¿è¡Œä¸€ä¸ªå‡½æ•°ï¼Œå½“å“åº”å¼å¯¹è±¡çš„å±æ€§å‘ç”Ÿæ”¹å˜æ—¶é‡æ–°æ‰§è¡Œã€‚</span></span><br><span class="line">  effect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">document</span>.querySelector(<span class="string">"#app"</span>).innerHTML = state.counter;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2s åè§†å›¾æ›´æ–°</span></span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    state.counter += <span class="number">1</span>;</span><br><span class="line">  &#125;, <span class="number">2000</span>);</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ç”¨ reactive åˆ›å»ºäº†ä¸€ä¸ªå“åº”å¼å¯¹è±¡ stateï¼Œå¹¶è°ƒç”¨äº† effect æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ¥å—ä¸€ä¸ªå‰¯ä½œç”¨å‡½æ•°ï¼Œeffect çš„æ‰§è¡Œä¼šç«‹å³è°ƒç”¨å‰¯ä½œç”¨å‡½æ•°ï¼Œå¹¶å°† state.counter èµ‹å€¼ç»™ #app.innerHTMLï¼›ä¸¤ç§’åï¼Œstate.counter += 1ï¼Œæ­¤æ—¶ï¼Œeffect çš„å‰¯ä½œç”¨å‡½æ•°ä¼šé‡æ–°æ‰§è¡Œï¼Œé¡µé¢ä¹Ÿä¼šå˜æˆ 2.</p><p>å†…éƒ¨çš„æ‰§è¡Œè¿‡ç¨‹å¤§æ¦‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="https://mmbiz.qpic.cn/mmbiz_png/cAd6ObKOzECkt2Vn6f73fJUHbKh9pqkwduhZyibx3XxmlJzcBbeEJDBRdT33lpXqlChXXia0DWSSMenx17VzYIvg/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1" alt="image"></p><ul><li>è°ƒç”¨ reactive() è¿”å›ä¸€ä¸ª Proxy ä»£ç†å¯¹è±¡ï¼Œå¹¶åŠ«æŒå¯¹è±¡çš„ get ä¸ set æ“ä½œ</li><li>è°ƒç”¨ effect() æ–¹æ³•æ—¶ï¼Œä¼šè®¿é—®å±æ€§ state.counterï¼Œæ­¤æ—¶ä¼šè§¦å‘ proxy çš„ get æ“ä½œã€‚</li><li><strong>get æ–¹æ³•ä¼šè°ƒç”¨ track() è¿›è¡Œä¾èµ–æ”¶é›†</strong>ï¼›å»ºç«‹ä¸€ä¸ªå¯¹è±¡ï¼ˆstateï¼‰ã€å±æ€§ï¼ˆcounterï¼‰ã€effect å‰¯ä½œç”¨å‡½æ•°çš„ä¾èµ–å…³ç³»ï¼›</li><li><strong>set æ–¹æ³•ä¼šè°ƒç”¨ trigger() è¿›è¡Œä¾èµ–æ›´æ–°</strong>ï¼›é€šè¿‡å¯¹è±¡ï¼ˆstateï¼‰ä¸å±æ€§ï¼ˆcoutnerï¼‰æ‰¾åˆ°å¯¹åº”çš„ effect å‰¯ä½œç”¨å‡½æ•°ï¼Œç„¶åé‡æ–°æ‰§è¡Œã€‚<br>reactive</li></ul><h3 id="reactive"><a href="#reactive" class="headerlink" title="reactive"></a>reactive</h3><p>reactive ä¼šè¿”å›å¦‚ä¸‹ä¸€ä¸ª Proxy å¯¹è±¡</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> reactive = <span class="function">(<span class="params">target</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Proxy</span>(target, &#123;</span><br><span class="line">    <span class="keyword">get</span>(target, key, receiver) &#123;</span><br><span class="line">      <span class="keyword">const</span> res = <span class="built_in">Reflect</span>.get(target, key, receiver);</span><br><span class="line"></span><br><span class="line">      track(target, key); <span class="comment">// æ”¶é›†ä¾èµ–</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (isObject(res)) &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœå½“å‰è·å–çš„å±æ€§å€¼æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œåˆ™ç»§ç»­å°†ä¸ºæ­¤å¯¹è±¡åˆ›å»º Proxy ä»£ç†</span></span><br><span class="line">        <span class="keyword">return</span> reactive(res);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> res;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="keyword">set</span>(target, key, value, receiver) &#123;</span><br><span class="line">      <span class="built_in">Reflect</span>.set(target, key, value, receiver);</span><br><span class="line">      trigger(target, key); <span class="comment">// ä¾èµ–æ›´æ–°</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="effect"><a href="#effect" class="headerlink" title="effect"></a>effect</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> activeEffect;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">effect</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> _effect = <span class="function"><span class="keyword">function</span> <span class="title">reactiveEffect</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    activeEffect = _effect;</span><br><span class="line">    fn();</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  _effect();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆå®šä¹‰å…¨å±€çš„ activeEffectï¼Œå®ƒæ°¸è¿œæŒ‡å‘å½“å‰æ­£åœ¨æ‰§è¡Œçš„ effect å‰¯ä½œç”¨å‡½æ•°ã€‚effect ä¸º fn åˆ›å»ºä¸€ä¸ªå†…éƒ¨çš„å‰¯ä½œç”¨å‡½æ•°ï¼Œç„¶åç«‹å³æ‰§è¡Œï¼Œæ­¤æ—¶ä¼šè§¦å‘å¯¹è±¡çš„ get æ“ä½œï¼Œè°ƒç”¨ track() æ–¹æ³•ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">effect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// effect çš„ç«‹å³æ‰§è¡Œä¼šè®¿é—® state.counterï¼Œè§¦å‘äº†å¯¹è±¡çš„ get æ“ä½œã€‚</span></span><br><span class="line">  <span class="built_in">document</span>.querySelector(<span class="string">"#app"</span>).innerHTML = state.counter;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="track"><a href="#track" class="headerlink" title="track"></a>track</h3><p>track ä¼šå»ºç«‹ä¸€ä¸ª å¯¹è±¡ï¼ˆstateï¼‰ =&gt; å±æ€§ï¼ˆcounterï¼‰ =&gt; effect çš„ä¸€ä¸ªä¾èµ–å…³ç³»</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> targetMap = <span class="keyword">new</span> <span class="built_in">WeakMap</span>();</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">track</span>(<span class="params">target, key</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!activeEffect) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> depsMap = targetMap.get(target);</span><br><span class="line">  <span class="keyword">if</span> (!depsMap) &#123;</span><br><span class="line">    targetMap.set(target, (depsMap = <span class="keyword">new</span> <span class="built_in">Map</span>()));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> dep = depsMap.get(key);</span><br><span class="line">  <span class="keyword">if</span> (!dep) &#123;</span><br><span class="line">    depsMap.set(key, (dep = <span class="keyword">new</span> <span class="built_in">Set</span>()));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!dep.has(activeEffect)) &#123;</span><br><span class="line">    dep.add(activeEffect);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œå®Œæˆæˆåæˆ‘ä»¬å¾—åˆ°ä¸€ä¸ªå¦‚ä¸‹çš„æ•°æ®ç»“æ„ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="comment">// map é›†åˆ</span></span><br><span class="line">  &#123;</span><br><span class="line">    key: &#123;<span class="attr">counter</span>: <span class="number">1</span>&#125; <span class="comment">// state å¯¹è±¡,</span></span><br><span class="line">    value: [ <span class="comment">// map é›†åˆ</span></span><br><span class="line">      &#123;</span><br><span class="line">        key: <span class="string">"counter"</span>,</span><br><span class="line">        value: [ <span class="comment">// set</span></span><br><span class="line">          <span class="function"><span class="keyword">function</span> <span class="title">reactiveEffect</span>(<span class="params"></span>) </span>&#123;&#125; <span class="comment">// effect å‰¯ä½œç”¨å‡½æ•°</span></span><br><span class="line">        ],</span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br></pre></td></tr></table></figure><h3 id="trigger"><a href="#trigger" class="headerlink" title="trigger"></a>trigger</h3><p>å½“æˆ‘ä»¬ç»™ state.counter èµ‹å€¼çš„æ—¶å€™å°±ä¼šè§¦å‘ä»£ç†å¯¹è±¡çš„ set æ“ä½œï¼Œä»è€Œè°ƒç”¨ trigger æ–¹æ³•</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ç»™ counter å±æ€§èµ‹å€¼ä¼šè§¦å‘ set æ“ä½œ</span></span><br><span class="line">  state.counter += <span class="number">1</span>;</span><br><span class="line">&#125;, <span class="number">2000</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">trigger</span>(<span class="params">target, key</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> depsMap = targetMap.get(target);</span><br><span class="line">  <span class="keyword">if</span> (!depsMap) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> effects = depsMap.get(key);</span><br><span class="line">  effects &amp;&amp; effects.forEach(<span class="function">(<span class="params">effect</span>) =&gt;</span> effect());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="vue3ä¸ºä»€ä¹ˆè¦ç”¨proxyå–ä»£defineProperty"><a href="#vue3ä¸ºä»€ä¹ˆè¦ç”¨proxyå–ä»£defineProperty" class="headerlink" title="vue3ä¸ºä»€ä¹ˆè¦ç”¨proxyå–ä»£defineProperty"></a>vue3ä¸ºä»€ä¹ˆè¦ç”¨proxyå–ä»£defineProperty</h3><p>Vue3ä½¿ç”¨Proxyå–ä»£<code>defineProperty</code>çš„åŸå› æ˜¯ï¼ŒProxyå¯ä»¥ç›´æ¥ä»£ç†å¯¹è±¡ï¼Œè€Œ<code>defineProperty</code>åªèƒ½åŠ«æŒå¯¹è±¡çš„å±æ€§ã€‚ç”±äº<code>Object.defineProperty</code>åªèƒ½å¯¹å±æ€§è¿›è¡ŒåŠ«æŒï¼Œéœ€è¦éå†å¯¹è±¡çš„æ¯ä¸ªå±æ€§ï¼Œå¦‚æœå±æ€§å€¼ä¹Ÿæ˜¯å¯¹è±¡ï¼Œåˆ™éœ€è¦æ·±åº¦éå†ã€‚è¿™æ ·çš„æ•ˆç‡æ¯”è¾ƒä½ï¼Œè€Œä¸”ä»£ç é‡ä¹Ÿæ¯”è¾ƒå¤§ã€‚è€ŒProxyå¯ä»¥ç›´æ¥åŠ«æŒæ•°ç»„ã€å¯¹è±¡çš„æ”¹å˜ï¼Œå¯ä»¥ç›´æ¥æ·»åŠ å¯¹è±¡å±æ€§ï¼Œå…¼å®¹æ€§ä¹Ÿæ¯”è¾ƒå¥½ã€‚<br>æ¯”å¦‚ï¼š<br>ä¸‹é¢çš„ä¾‹å­ä½¿ç”¨getæ‹¦æˆªï¼Œå®ç°æ•°ç»„è¯»å–è´Ÿæ•°çš„ç´¢å¼•ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createArray</span>(<span class="params">...elements</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> handler = &#123;</span><br><span class="line">    <span class="keyword">get</span>(target, propKey, receiver) &#123;</span><br><span class="line">      <span class="keyword">let</span> index = <span class="built_in">Number</span>(propKey);</span><br><span class="line">      <span class="keyword">if</span> (index &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        propKey = <span class="built_in">String</span>(target.length + index);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Reflect</span>.get(target, propKey, receiver);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> target = [];</span><br><span class="line">  target.push(...elements);</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Proxy</span>(target, handler);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> arr = createArray(<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>);</span><br><span class="line">arr[<span class="number">-1</span>] <span class="comment">// c</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç ä¸­ï¼Œæ•°ç»„çš„ä½ç½®å‚æ•°æ˜¯-1ï¼Œå°±ä¼šè¾“å‡ºæ•°ç»„çš„å€’æ•°ç¬¬ä¸€ä¸ªæˆå‘˜ã€‚</p><p>å› ä¸ºç›´æ¥å¯¹å¯¹è±¡åšçš„ä»£ç†æ‰€ä»¥è¿˜èƒ½å®ç°é“¾å¼æ“ä½œ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> pipe = <span class="function"><span class="keyword">function</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> funcStack = [];</span><br><span class="line">  <span class="keyword">var</span> oproxy = <span class="keyword">new</span> <span class="built_in">Proxy</span>(&#123;&#125; , &#123;</span><br><span class="line">    <span class="keyword">get</span> : function (pipeObject, fnName) &#123;</span><br><span class="line">      <span class="keyword">if</span> (fnName === <span class="string">'get'</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> funcStack.reduce(<span class="function"><span class="keyword">function</span> (<span class="params">val, fn</span>) </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> fn(val);</span><br><span class="line">        &#125;,value);</span><br><span class="line">      &#125;</span><br><span class="line">      funcStack.push(<span class="built_in">window</span>[fnName]);</span><br><span class="line">      <span class="keyword">return</span> oproxy;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> oproxy;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> double = <span class="function"><span class="params">n</span> =&gt;</span> n * <span class="number">2</span>;</span><br><span class="line"><span class="keyword">var</span> pow    = <span class="function"><span class="params">n</span> =&gt;</span> n * n;</span><br><span class="line"><span class="keyword">var</span> reverseInt = <span class="function"><span class="params">n</span> =&gt;</span> n.toString().split(<span class="string">""</span>).reverse().join(<span class="string">""</span>) | <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">pipe(<span class="number">3</span>).double.pow.reverseInt.get; <span class="comment">// 63</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> vue3 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å‰ç«¯åŒ…ç®¡ç†å·¥å…·</title>
      <link href="/ashley271017.github.io/2022/04/23/%E5%89%8D%E7%AB%AF%E5%8C%85%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7/"/>
      <url>/ashley271017.github.io/2022/04/23/%E5%89%8D%E7%AB%AF%E5%8C%85%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7/</url>
      
        <content type="html"><![CDATA[<p>å½“ä¸‹æœ€ç«çš„åŒ…ç®¡ç†å·¥å…·æ˜¯pnpmï¼Œåœ¨å…¶å‡ºç°ä¹‹å‰ï¼Œå‰ç«¯æœ€å¸¸ç”¨çš„åŒ…ç®¡ç†å·¥å…·æœ‰ä¸¤ä¸ª npmã€yarnï¼Œé‚£ä¸ºä»€ä¹ˆä¼šå‡ºç° pnpm å‘¢ï¼Œä»¥åŠ pnpm çš„å‡ºç°åˆ°åº•è§£å†³äº†å“ªäº›é—®é¢˜ï¼Ÿ</p><h3 id="npm-å­˜åœ¨çš„é—®é¢˜"><a href="#npm-å­˜åœ¨çš„é—®é¢˜" class="headerlink" title="npm å­˜åœ¨çš„é—®é¢˜"></a>npm å­˜åœ¨çš„é—®é¢˜</h3><p>1ã€æ—©æœŸnpm çš„ node_modules é‡‡ç”¨äº†åµŒå¥—ç»“æ„ï¼Œå®Œå…¨æŒ‰ç…§ç›®å½•ç»“æ„æ¥ä¸‹è½½ä¾èµ–æ ‘ï¼Œå®¹æ˜“é€ æˆä¾èµ–é»‘æ´ï¼Œæœ€å…³é”®çš„æ˜¯windowsä¸Šæ”¯æŒçš„æ–‡ä»¶è·¯å¾„æœ€é•¿æ˜¯ 260 å¤šä¸ªå­—ç¬¦ã€‚</p><p>2ã€å•ä¸ªé¡¹ç›®ä¸­ï¼ŒåŒä¸€ä¸ªç‰ˆæœ¬çš„ä¾èµ–åŒ…ï¼Œæœ‰å¯èƒ½è¢«ä¸‹è½½å¤šæ¬¡ï¼›å¤šä¸ªé¡¹ç›®ä¸­ï¼Œæ¯æ¬¡éƒ½éœ€è¦é‡æ–°ä¸‹è½½æ‰€æœ‰ä¾èµ–åŒ…ï¼Œæµªè´¹äº†å¤§é‡çš„ç£ç›˜ç©ºé—´ã€‚</p><h3 id="npm2-x-ç›®å½•ç»“æ„"><a href="#npm2-x-ç›®å½•ç»“æ„" class="headerlink" title="npm2.x ç›®å½•ç»“æ„"></a>npm2.x ç›®å½•ç»“æ„</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">node_modules</span><br><span class="line">    â”œâ”€â”€ moduleA</span><br><span class="line">    â”‚   â””â”€â”€ node_modules</span><br><span class="line">    â”‚       â””â”€â”€ moduleC</span><br><span class="line">    â””â”€â”€ moduleB</span><br><span class="line">        â””â”€â”€ node_modules</span><br><span class="line">            â””â”€â”€ moduleC</span><br><span class="line">                â””â”€â”€ node_modules</span><br><span class="line">                    â””â”€â”€ moduleD</span><br></pre></td></tr></table></figure><p>ä»ä¸Šé¢çš„ç›®å½•ç»“æ„æˆ‘ä»¬èƒ½çœ‹åˆ°ï¼Œå¤šå±‚çš„åµŒå¥—ç»“æ„ï¼Œä»¥åŠ moduleC åŒæ—¶è¢«moduleAã€moduleBä¾èµ–ï¼Œæ‰€ä»¥è¢«é‡å¤ä¸‹è½½äº†ä¸¤æ¬¡ã€‚</p><p>npm å®˜æ–¹åœ¨ npm3.x ä¸­å¯¹ä¸Šè¿°é—®é¢˜åšäº†æ”¹è¿›ã€‚</p><p>npm3.x ä¸­ node_modules é‡‡ç”¨äº†æ‰å¹³åŒ–ç»“æ„ã€‚å°†æ‰€æœ‰çš„å­ä¾èµ–éƒ½æå‡åˆ°æ ¹ç›®å½•ä¸‹ã€‚ä¹Ÿå°±æ˜¯ hoist æœºåˆ¶ã€‚</p><h3 id="npm3-x-ç›®å½•ç»“æ„"><a href="#npm3-x-ç›®å½•ç»“æ„" class="headerlink" title="npm3.x ç›®å½•ç»“æ„"></a>npm3.x ç›®å½•ç»“æ„</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">node_modules</span><br><span class="line">   â”œâ”€â”€ moduleA</span><br><span class="line">   â”œâ”€â”€ moduleB</span><br><span class="line">   â””â”€â”€ moduleC</span><br><span class="line">   â””â”€â”€ moduleD</span><br></pre></td></tr></table></figure><p>è¿™åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šè§£å†³äº†åœ°ç‹±ä¾èµ–çš„é—®é¢˜ï¼Œä»¥åŠç£ç›˜ç©ºé—´çš„æµªè´¹é—®é¢˜ï¼Œä½†åŒæ—¶åˆå¸¦æ¥äº†å…¶ä»–é—®é¢˜</p><p>1ã€å¹½çµä¾èµ–<br>åœ¨package.jsonä¸­æ²¡æœ‰å£°æ˜çš„ä¾èµ–åŒ…ï¼Œå› ä¸ºè¢«å…¶ä»–åŒ…ä¾èµ–ï¼Œè¢«ä¸‹è½½å¹¶æå‡åˆ° node_modules æ ¹ç›®å½•ä¸‹ï¼Œå¯¼è‡´ç›´æ¥å¯ä»¥åœ¨é¡¹ç›®ä¸­å»å¼•ç”¨ã€‚</p><p>2ã€ä¸‹è½½æ–‡ä»¶çš„ä¸ç¡®å®šæ€§<br>åŒä¸€ä»½ package.jsonï¼Œä¸‹è½½å‡ºæ¥çš„ node_modules å¯èƒ½ä¸ä¸€è‡´çš„é—®é¢˜ã€‚</p><p>3ã€ä¾èµ–é‡å¤å®‰è£…<br>è¿™ä¸ªä¹Ÿå¾ˆå¥½ç†è§£ï¼ŒABéƒ½ä¾èµ–æŸä¸ªåŒ…ï¼Œä¾èµ–ä¸åŒçš„ç‰ˆæœ¬ï¼Œæ— è®ºnode_modulesçš„é¡¶å±‚æå‡äº†å“ªä¸ªç‰ˆæœ¬ï¼Œè¿™ä¸ªåŒ…éƒ½æ˜¯ä¼šè¢«å®‰è£…ä¸¤æ¬¡çš„ã€‚è¿™ä¼šåŠ å‰§node_moduleså¯¹ç£ç›˜ç©ºé—´çš„å ç”¨ç‡</p><p>ä¹Ÿå°±æ˜¯è¯´ä¸¤ä¸ªä¾èµ–åŒ…åŒæ—¶ä¾èµ–çš„CåŒ…çš„ä¸åŒç‰ˆæœ¬ï¼ŒCåŒ…åªæœ‰ä¸€ä¸ªç‰ˆæœ¬ä¼šè¢« hoistï¼Œé‚£ä¹ˆåˆ°åº•åº”è¯¥æå‡å“ªä¸ªç‰ˆæœ¬å‘¢ï¼Œç­”æ¡ˆæ˜¯ä¸ç¡®å®šã€‚</p><p>npm 5.x ä¸ºæ­¤æ–°å¢äº† package-lock.json æ–‡ä»¶ï¼Œç”¨æ¥é”å®šä¾èµ–åŒ…çš„ç‰ˆæœ¬å·ï¼Œä»¥åŠç¡®å®šä¸åŒç‰ˆæœ¬å¦‚ä½• hoist çš„é—®é¢˜ã€‚</p><p>è¿™æ ·å°±ç¡®ä¿äº†åŒä¸€ä»½ package.json ä¸‹è½½å‡ºæ¥çš„ node_modules ç›®å½•ç»“æ„ä¸€è‡´ã€ä½† å¹½çµä¾èµ– é—®é¢˜ä»ç„¶æ²¡æœ‰å¾—åˆ°è§£å†³</p><h3 id="yarn"><a href="#yarn" class="headerlink" title="yarn"></a>yarn</h3><p>yarn çš„å‡ºç°ï¼Œå¼¥è¡¥äº† npm2.x çš„ä¼—å¤šç¼ºé™·ã€‚</p><p>1ã€é‡‡ç”¨æ‰å¹³åŒ–çš„æ–¹å¼ç®¡ç† node_modulesï¼Œå¹¶ä¸”é¦–æ¬¡æå‡ºäº†ç¦»çº¿ç¼“å­˜ä¸‹è½½çš„æ¦‚å¿µï¼Œä¸‹è½½é€Ÿåº¦å¤§å¹…æå‡ã€‚</p><p>2ã€yarn.lock<br>yarn.lock ç”¨æ¥ç¡®å®šä¾èµ–æ ‘ä¹‹é—´çš„ç»“æ„ï¼Œç¡®ä¿åŒä¸€ä¸ªé¡¹ç›®ç”ŸæˆåŒæ ·çš„ node_modules</p><p>ä½†æ˜¯ yarn è·Ÿ npm ä¸€æ ·ï¼Œéƒ½æ²¡æœ‰è§£å†³å¹½çµä¾èµ–çš„é—®é¢˜ã€‚</p><h3 id="pnpm"><a href="#pnpm" class="headerlink" title="pnpm"></a>pnpm</h3><p>pnpm åœ¨ 2017 å¹´å‘å¸ƒï¼Œå®ƒçš„å‡ºç°ï¼Œè§£å†³äº† npmã€yarn é•¿æœŸä»¥æ¥å­˜åœ¨çš„æ€§èƒ½ã€å®‰å…¨è®¿é—®ç­‰é—®é¢˜ã€‚</p><p>ç›¸å¯¹äºåˆ«çš„åŒ…ç®¡ç†å·¥å…·å…·æœ‰å¦‚ä¸‹çš„ç‰¹ç‚¹ï¼š</p><ul><li>åŒ…å®‰è£…é€Ÿåº¦æå¿«ï¼›</li><li>ç£ç›˜ç©ºé—´åˆ©ç”¨éå¸¸é«˜æ•ˆã€‚</li></ul><p>pnpmçš„åŒ…ç®¡ç†æ–¹å¼æ˜¯é€šè¿‡å»ºç«‹é“¾æ¥+storeçš„æ–¹å¼æ¥å®Œæˆå¿«é€Ÿå®‰è£…å’Œé˜²æ­¢é‡å¤å®‰è£…ï¼ˆä»¥å‡å°‘ç£ç›˜ç©ºé—´ï¼‰çš„é—®é¢˜ã€‚</p><p><img src="https://cdn.nlark.com/yuque/0/2023/png/992007/1678804378528-4c5762fc-f38e-475f-8d19-e90293a7385c.png?x-oss-process=image%2Fresize%2Cw_1500%2Climit_0" alt="image"></p><h4 id="store"><a href="#store" class="headerlink" title="store"></a>store</h4><p>pnpm é»˜è®¤ä¼šå°†æ‰€æœ‰ä¾èµ–åŒ…ä¸‹è½½åˆ°ç³»ç»Ÿ{home dir}/Library/pnpm/store/v3ä¸­ï¼Œç³»ç»Ÿä¸­ç›¸åŒæ–‡ä»¶åªä¼šå­˜åœ¨ä¸€ä»½ã€‚</p><h4 id="è½¯ç¡¬é“¾æ¥"><a href="#è½¯ç¡¬é“¾æ¥" class="headerlink" title="è½¯ç¡¬é“¾æ¥"></a>è½¯ç¡¬é“¾æ¥</h4><p><strong>è½¯è¿æ¥</strong><br>æ¯ä¸ªé¡¹ç›® node_modules ä¸‹å®‰è£…çš„åŒ…ç»“æ„ä¸ºæ ‘çŠ¶ï¼Œç¬¦åˆ node å°±è¿‘æŸ¥æ‰¾è§„åˆ™ï¼Œä»¥è½¯é“¾æ¥æ–¹å¼å°†å†…å®¹æŒ‡å‘ node_modules/.pnpm ä¸­çš„åŒ…ã€‚</p><p><strong>ç¡¬é“¾æ¥</strong><br>æ¯ä¸ªé¡¹ç›®çš„ node_modules ä¸‹æœ‰ .pnpm ç›®å½•ä»¥æ‰“å¹³ç»“æ„ç®¡ç†æ¯ä¸ªç‰ˆæœ¬åŒ…çš„æºç å†…å®¹ï¼Œä»¥ç¡¬é“¾æ¥æ–¹å¼æŒ‡å‘ pnpm-store ä¸­çš„æ–‡ä»¶åœ°å€ã€‚</p><p>è¿™æ ·å¹½çµä¾èµ–çš„é—®é¢˜å°±è§£å†³äº†ï¼ŒåŒ…ç‰ˆæœ¬ä¸ç¡®å®šæ€§çš„é—®é¢˜ä¹Ÿå°±è§£å†³äº†ã€‚æ¯•ç«Ÿé¡¶å±‚å°±åªæœ‰æˆ‘ä»¬æ‰‹åŠ¨å®‰è£…çš„åŒ…ï¼Œå…¶ä»–ä¾èµ–åŒ…éƒ½æ”¶åœ¨.pnpmä¸­</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿™ç§æ–¹å¼çš„å¥½å¤„æ˜¯ï¼š</p><ul><li>ä¸ä¼šé‡å¤å®‰è£…åŒä¸€ä¸ªåŒ…ã€‚ç”¨ npm/yarn çš„æ—¶å€™ï¼Œå¦‚æœ 100 ä¸ªé¡¹ç›®éƒ½ä¾èµ– lodashï¼Œé‚£ä¹ˆ lodash å¾ˆå¯èƒ½å°±è¢«å®‰è£…äº† 100 æ¬¡ï¼Œç£ç›˜ä¸­å°±æœ‰ 100 ä¸ªåœ°æ–¹å†™å…¥äº†è¿™éƒ¨åˆ†ä»£ç ã€‚ä½†åœ¨ä½¿ç”¨ pnpm åªä¼šå®‰è£…ä¸€æ¬¡ï¼Œç£ç›˜ä¸­åªæœ‰ä¸€ä¸ªåœ°æ–¹å†™å…¥ï¼Œåé¢å†æ¬¡ä½¿ç”¨éƒ½ä¼šç›´æ¥ä½¿ç”¨ hardlink(ç¡¬é“¾æ¥ï¼‰</li><li>å³ä½¿ä¸€ä¸ªåŒ…çš„ä¸åŒç‰ˆæœ¬ï¼Œpnpm ä¹Ÿä¼šæå¤§ç¨‹åº¦åœ°å¤ç”¨ä¹‹å‰ç‰ˆæœ¬çš„ä»£ç ã€‚æ¯”å¦‚ lodash æœ‰ 100 ä¸ªæ–‡ä»¶ï¼Œæ›´æ–°ç‰ˆæœ¬ä¹‹åå¤šäº†ä¸€ä¸ªæ–‡ä»¶ï¼Œé‚£ä¹ˆç£ç›˜å½“ä¸­å¹¶ä¸ä¼šé‡æ–°å†™å…¥ 101 ä¸ªæ–‡ä»¶ï¼Œè€Œæ˜¯ä¿ç•™åŸæ¥çš„ 100 ä¸ªæ–‡ä»¶çš„ hardlinkï¼Œä»…ä»…å†™å…¥é‚£ä¸€ä¸ªæ–°å¢çš„æ–‡ä»¶ã€‚</li></ul><h4 id="è½¯ç¡¬é“¾æ¥çš„åŒºåˆ«"><a href="#è½¯ç¡¬é“¾æ¥çš„åŒºåˆ«" class="headerlink" title="è½¯ç¡¬é“¾æ¥çš„åŒºåˆ«"></a>è½¯ç¡¬é“¾æ¥çš„åŒºåˆ«</h4><p><a href="https://note.youdao.com/web/#/file/WEB29dc8e3158285b5c57f98225ccb251c8/note/WEBa9364ab47e74719d1e4477ea1e0394b7/" target="_blank" rel="noopener">è½¯ç¡¬é“¾æ¥çš„åŒºåˆ«</a></p><p>æ€»ç»“å°±æ˜¯è½¯é“¾æ¥æŒ‡å‘çš„æ˜¯æ–‡ä»¶çš„æ–‡ä»¶è·¯å¾„ï¼Œç¡¬é“¾æ¥è®°å½•çš„æ˜¯æ–‡ä»¶çš„å†…å®¹ï¼Œä½†æ˜¯å½“æºæ–‡ä»¶è¢«åˆ é™¤çš„æ—¶å€™ï¼Œç¡¬é“¾æ¥è¿˜æ˜¯èƒ½è®¿é—®ï¼ˆæ–‡ä»¶çœŸæ­£åˆ é™¤çš„æ¡ä»¶æ˜¯ä¸ä¹‹ç›¸å…³çš„æ‰€æœ‰ç¡¬è¿æ¥æ–‡ä»¶å‡è¢«åˆ é™¤ã€‚ï¼‰è½¯ç¡¬é“¾æ¥ä»»ä½•ä¸€ä¸ªæ–‡ä»¶å‘ç”Ÿæ”¹å˜ï¼Œéƒ½ä¼šåŒæ­¥åˆ°å…¶ä»–çš„é“¾æ¥ï¼Œå› æ­¤ç¡¬é“¾æ¥å¯ä»¥ç”¨æ¥è¢«å¤šä¸ªåœ°æ–¹åŒæ—¶æ“ä½œä½†æ˜¯é˜²æ­¢è¯¯åˆ ï¼Œæ‰€ä»¥pnpmä¼šä½¿ç”¨ç¡¬è¿æ¥æŒ‡å‘.pnpm store ä¸­çš„æ–‡ä»¶åœ°å€ï¼Œç›¸æ¯”ç¡¬é“¾æ¥ï¼Œè½¯é“¾æ¥çš„ä¼˜åŠ¿æ˜¯ï¼šå¯ä»¥ç«‹å³çŸ¥é“ç¬¦å·é“¾æ¥æŒ‡å‘çš„ä½ç½®ï¼Œè€Œä½¿ç”¨ç¡¬é“¾æ¥ï¼Œæ‚¨éœ€è¦æ¢ç´¢æ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿä»¥æ‰¾åˆ°å…±äº«ç›¸åŒ inode çš„æ–‡ä»¶ã€‚å› æ­¤è½¯é“¾æ¥é€šå¸¸ç”¨æ¥åšå¿«æ·æ–¹å¼ï¼Œè€Œè¿™é‡Œä½¿ç”¨è½¯é“¾æ¥æ˜¯ä¸ºäº†æ›´å¿«æ‰¾åˆ°ä¾èµ–åœ¨pnpm storeä¸­çš„ä½ç½®</p>]]></content>
      
      
      
        <tags>
            
            <tag> åŒ…ç®¡ç† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue2å’ŒVue3åŒºåˆ«</title>
      <link href="/ashley271017.github.io/2021/04/16/Vue2%E5%92%8CVue3%E5%8C%BA%E5%88%AB/"/>
      <url>/ashley271017.github.io/2021/04/16/Vue2%E5%92%8CVue3%E5%8C%BA%E5%88%AB/</url>
      
        <content type="html"><![CDATA[<h3 id="å“åº”å¼åŸç†apiçš„æ”¹å˜"><a href="#å“åº”å¼åŸç†apiçš„æ”¹å˜" class="headerlink" title="å“åº”å¼åŸç†apiçš„æ”¹å˜"></a>å“åº”å¼åŸç†apiçš„æ”¹å˜</h3><p>Vue2å“åº”å¼åŸç†é‡‡ç”¨çš„æ˜¯definePropertyï¼Œè€Œvue3é€‰ç”¨çš„æ˜¯proxyã€‚è¿™ä¸¤è€…å‰è€…æ˜¯ä¿®æ”¹å¯¹è±¡å±æ€§çš„æƒé™æ ‡ç­¾ï¼Œåè€…æ˜¯ä»£ç†æ•´ä¸ªå¯¹è±¡ã€‚æ€§èƒ½ä¸Šproxyä¼šæ›´åŠ ä¼˜ç§€ã€‚</p><h3 id="diffç®—æ³•ï¼Œæ¸²æŸ“ç®—æ³•çš„æ”¹å˜"><a href="#diffç®—æ³•ï¼Œæ¸²æŸ“ç®—æ³•çš„æ”¹å˜" class="headerlink" title="diffç®—æ³•ï¼Œæ¸²æŸ“ç®—æ³•çš„æ”¹å˜"></a>diffç®—æ³•ï¼Œæ¸²æŸ“ç®—æ³•çš„æ”¹å˜</h3><p>Vue3ä¼˜åŒ–diffç®—æ³•ã€‚ä¸å†åƒvue2é‚£æ ·æ¯”å¯¹æ‰€æœ‰domï¼Œè€Œé‡‡ç”¨äº†block treeçš„åšæ³•ã€‚æ­¤å¤–é‡æ–°æ¸²æŸ“çš„ç®—æ³•é‡Œä¹Ÿåšäº†æ”¹è¿›ï¼Œåˆ©ç”¨äº†é—­åŒ…æ¥è¿›è¡Œç¼“å­˜ã€‚è¿™ä½¿å¾—vue3çš„é€Ÿåº¦æ¯”vue2å¿«äº†6å€ã€‚</p><h3 id="vue2çš„diff"><a href="#vue2çš„diff" class="headerlink" title="vue2çš„diff"></a>vue2çš„diff</h3><h3 id="è¿‡ç¨‹"><a href="#è¿‡ç¨‹" class="headerlink" title="è¿‡ç¨‹"></a>è¿‡ç¨‹</h3><p>vueåœ¨å†…éƒ¨é€šè¿‡ä¸€ä¸ªå«patchçš„å‡½æ•°å®Œæˆè¯¥è¿‡ç¨‹<br> åœ¨å¯¹æ¯”æ—¶ï¼Œvueé‡‡ç”¨æ·±åº¦ä¼˜å…ˆã€åŒå±‚æ¯”è¾ƒçš„æ–¹å¼è¿›è¡Œæ¯”å¯¹ã€‚<br> åœ¨åˆ¤æ–­ä¸¤ä¸ªèŠ‚ç‚¹æ˜¯å¦ç›¸åŒæ—¶ï¼Œvueæ˜¯é€šè¿‡è™šæ‹ŸèŠ‚ç‚¹çš„keyå’Œtagæ¥è¿›è¡Œåˆ¤æ–­çš„<br> å…·ä½“æ¥è¯´ï¼Œé¦–å…ˆå¯¹æ ¹èŠ‚ç‚¹è¿›è¡Œå¯¹æ¯”ï¼Œå¦‚æœç›¸åŒåˆ™å°†æ—§èŠ‚ç‚¹å…³è”çš„çœŸå®domçš„å¼•ç”¨æŒ‚åˆ°æ–°èŠ‚ç‚¹ä¸Šï¼Œç„¶åæ ¹æ®éœ€è¦æ›´æ–°å±æ€§åˆ°çœŸå®domï¼Œç„¶åå†å¯¹æ¯”å…¶å­èŠ‚ç‚¹æ•°ç»„ï¼›å¦‚æœä¸ç›¸åŒï¼Œåˆ™æŒ‰ç…§æ–°èŠ‚ç‚¹çš„ä¿¡æ¯é€’å½’åˆ›å»ºæ‰€æœ‰çœŸå®domï¼ŒåŒæ—¶æŒ‚åˆ°å¯¹åº”è™šæ‹ŸèŠ‚ç‚¹ä¸Šï¼Œç„¶åç§»é™¤æ‰æ—§çš„domã€‚<br> åœ¨å¯¹æ¯”å…¶å­èŠ‚ç‚¹æ•°ç»„æ—¶ï¼Œvueå¯¹æ¯ä¸ªå­èŠ‚ç‚¹æ•°ç»„ä½¿ç”¨äº†ä¸¤ä¸ªæŒ‡é’ˆï¼Œåˆ†åˆ«æŒ‡å‘å¤´å°¾ï¼Œç„¶åä¸æ–­å‘ä¸­é—´é æ‹¢æ¥è¿›è¡Œå¯¹æ¯”ï¼Œè¿™æ ·åšçš„ç›®çš„æ˜¯å°½é‡å¤ç”¨çœŸå®domï¼Œå°½é‡å°‘çš„é”€æ¯å’Œåˆ›å»ºçœŸå®domã€‚å¦‚æœå‘ç°ç›¸åŒï¼Œåˆ™è¿›å…¥å’Œæ ¹èŠ‚ç‚¹ä¸€æ ·çš„å¯¹æ¯”æµç¨‹ï¼Œå¦‚æœå‘ç°ä¸åŒï¼Œåˆ™ç§»åŠ¨çœŸå®domåˆ°åˆé€‚çš„ä½ç½®ã€‚<br> è¿™æ ·ä¸€ç›´é€’å½’çš„éå†ä¸‹å»ï¼Œç›´åˆ°æ•´æ£µæ ‘å®Œæˆå¯¹æ¯”</p><p><a href="https://www.yuque.com/kongliyuan/kb/hvbvevi73di92t4b" target="_blank" rel="noopener">reactçš„diff</a></p><h4 id="ä¼˜åŒ–ç‚¹"><a href="#ä¼˜åŒ–ç‚¹" class="headerlink" title="ä¼˜åŒ–ç‚¹"></a>ä¼˜åŒ–ç‚¹</h4><ul><li>åªæ¯”è¾ƒåŒå±‚</li><li>åŒç«¯æ¯”è¾ƒï¼šå³åŒæ—¶ä»æ–°æ—§ VNode çš„å¤´éƒ¨å’Œå°¾éƒ¨å¼€å§‹æ¯”è¾ƒï¼Œç„¶åæ ¹æ®æƒ…å†µç§»åŠ¨æŒ‡é’ˆï¼Œç›´åˆ°æ‰¾åˆ°ä¸åŒçš„èŠ‚ç‚¹ä¸ºæ­¢ã€‚è¿™ç§ç­–ç•¥å¯ä»¥æœ€å¤§ç¨‹åº¦åœ°å‡å°‘æ¯”è¾ƒæ¬¡æ•°ï¼Œä»è€Œæé«˜ diff ç®—æ³•çš„æ•ˆç‡ã€‚</li><li>keyä¼˜åŒ–ï¼šå¦‚æœæ²¡æœ‰ç»™èŠ‚ç‚¹æ·»åŠ keyå€¼ï¼Œé‚£ä¹ˆVueä¼šè®¤ä¸ºè¿™äº›èŠ‚ç‚¹æ˜¯ç›¸åŒçš„ï¼Œä»è€Œå¯¹æ•´ä¸ªåˆ—è¡¨è¿›è¡Œé‡æ¸²æŸ“ã€‚è€Œå¦‚æœç»™èŠ‚ç‚¹æ·»åŠ äº†å”¯ä¸€çš„keyå€¼ï¼Œé‚£ä¹ˆVueå°±å¯ä»¥æ ¹æ®keyå€¼æ¥åˆ¤æ–­å“ªäº›èŠ‚ç‚¹æ˜¯ç›¸åŒçš„ï¼Œå“ªäº›èŠ‚ç‚¹æ˜¯ä¸åŒçš„ï¼Œä»è€Œåªå¯¹ä¸åŒçš„èŠ‚ç‚¹è¿›è¡Œæ›´æ–°ï¼Œæé«˜äº†æ€§èƒ½ã€‚</li></ul><h3 id="vue3çš„diff"><a href="#vue3çš„diff" class="headerlink" title="vue3çš„diff"></a>vue3çš„diff</h3><ul><li>é™æ€èŠ‚ç‚¹ä¼˜åŒ–ï¼šé™æ€èŠ‚ç‚¹æŒ‡çš„æ˜¯ä¸ä¼šæ”¹å˜çš„èŠ‚ç‚¹ï¼Œå¦‚æ–‡æœ¬èŠ‚ç‚¹ã€‚åœ¨Vue2ä¸­ï¼Œæ¯æ¬¡é‡æ–°æ¸²æŸ“æ—¶ï¼Œéƒ½ä¼šé‡æ–°åˆ›å»ºè¿™äº›é™æ€èŠ‚ç‚¹ï¼Œè¿™æ ·ä¼šæµªè´¹å¾ˆå¤šæ—¶é—´ã€‚Vue3ä¸­ï¼Œé€šè¿‡é™æ€æå‡çš„æ–¹å¼ï¼Œå°†é™æ€èŠ‚ç‚¹æå‡åˆ°çˆ¶ç»„ä»¶çš„æ¸²æŸ“å‡½æ•°ä¸­ï¼Œåœ¨ç»„ä»¶æ›´æ–°æ—¶ï¼Œåªéœ€è¦å¯¹åŠ¨æ€èŠ‚ç‚¹è¿›è¡Œæ¯”è¾ƒï¼Œä»è€Œé¿å…äº†å¯¹é™æ€èŠ‚ç‚¹çš„é‡å¤æ¸²æŸ“ï¼Œæé«˜äº†æ€§èƒ½ ã€‚</li></ul><h3 id="å»ºç«‹æ•°æ®-data"><a href="#å»ºç«‹æ•°æ®-data" class="headerlink" title="å»ºç«‹æ•°æ® data"></a>å»ºç«‹æ•°æ® data</h3><p>è¿™é‡Œå°±æ˜¯Vue2ä¸Vue3 æœ€å¤§çš„åŒºåˆ« â€” Vue2ä½¿ç”¨é€‰é¡¹ç±»å‹APIï¼ˆOptions APIï¼‰å¯¹æ¯”Vue3åˆæˆå‹APIï¼ˆComposition APIï¼‰<br>æ—§çš„é€‰é¡¹å‹APIåœ¨ä»£ç é‡Œåˆ†å‰²äº†ä¸åŒçš„å±æ€§ï¼ˆpropertiesï¼‰ï¼šdataï¼Œcomputedå±æ€§ï¼Œmethodsï¼Œç­‰ç­‰ã€‚æ–°çš„åˆæˆå‹APIèƒ½è®©æˆ‘ä»¬ç”¨æ–¹æ³•ï¼ˆfunctionï¼‰æ¥åˆ†å‰²ï¼Œç›¸æ¯”äºæ—§çš„APIä½¿ç”¨å±æ€§æ¥åˆ†ç»„ï¼Œè¿™æ ·ä»£ç ä¼šæ›´åŠ ç®€ä¾¿å’Œæ•´æ´ã€‚</p><h3 id="Vue3å¯¹TypeScriptçš„æ”¯æŒæ›´åŠ å‹å¥½"><a href="#Vue3å¯¹TypeScriptçš„æ”¯æŒæ›´åŠ å‹å¥½" class="headerlink" title="Vue3å¯¹TypeScriptçš„æ”¯æŒæ›´åŠ å‹å¥½"></a>Vue3å¯¹TypeScriptçš„æ”¯æŒæ›´åŠ å‹å¥½</h3>]]></content>
      
      
      
        <tags>
            
            <tag> vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¸¸è§ç™»å½•æ–¹æ¡ˆ</title>
      <link href="/ashley271017.github.io/2021/04/10/%E5%B8%B8%E8%A7%81%E7%99%BB%E5%BD%95%E6%96%B9%E6%A1%88/"/>
      <url>/ashley271017.github.io/2021/04/10/%E5%B8%B8%E8%A7%81%E7%99%BB%E5%BD%95%E6%96%B9%E6%A1%88/</url>
      
        <content type="html"><![CDATA[<h2 id="session"><a href="#session" class="headerlink" title="session"></a>session</h2><p>Session æ˜¯ä¸€ç§å­˜å‚¨åœ¨æœåŠ¡å™¨ä¸Šçš„æ•°æ®ç»“æ„ï¼Œç”¨äºå­˜å‚¨æœ‰å…³ç”¨æˆ·çš„ä¿¡æ¯ã€‚Session æ•°æ®å­˜å‚¨åœ¨æœåŠ¡å™¨ä¸Šï¼Œå› æ­¤æ¯” Cookie æ›´åŠ å®‰å…¨ã€‚Session é€šå¸¸ä½¿ç”¨ Cookie æ¥è·Ÿè¸ªç”¨æˆ·ä¼šè¯</p><h3 id="sessionæœºåˆ¶"><a href="#sessionæœºåˆ¶" class="headerlink" title="sessionæœºåˆ¶"></a>sessionæœºåˆ¶</h3><p>å½“æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚éœ€è¦åˆ›å»ºsessionå¯¹è±¡æ—¶ï¼Œé¦–å…ˆä¼šæ£€æŸ¥å®¢æˆ·ç«¯è¯·æ±‚ä¸­æ˜¯å¦åŒ…å«sessionidã€‚å¦‚æœæœ‰sessionidï¼ŒæœåŠ¡å™¨å°†æ ¹æ®è¯¥idè¿”å›å¯¹åº”sessionå¯¹è±¡ã€‚å¦‚æœå®¢æˆ·ç«¯è¯·æ±‚ä¸­æ²¡æœ‰sessionidï¼ŒæœåŠ¡å™¨ä¼šåˆ›å»ºæ–°çš„sessionå¯¹è±¡ï¼Œå¹¶æŠŠsessionidåœ¨æœ¬æ¬¡å“åº”ä¸­è¿”å›ç»™å®¢æˆ·ç«¯ã€‚é€šå¸¸ä½¿ç”¨cookieæ–¹å¼å­˜å‚¨sessionidåˆ°å®¢æˆ·ç«¯ï¼Œåœ¨äº¤äº’ä¸­æµè§ˆå™¨æŒ‰ç…§è§„åˆ™å°†sessionidå‘é€ç»™æœåŠ¡å™¨ã€‚æœåŠ¡å™¨æŒ‰ç…§è¯¥session IDæŸ¥æ‰¾å¯¹åº”çš„sessionä¿¡æ¯å¦‚æœæ²¡æ‰¾åˆ°è¯´æ˜æ²¡ç™»å½•æˆ–è€…ç™»é™†å¤±æ•ˆ<br>å¦‚æœç”¨æˆ·ç¦ç”¨cookieï¼Œåˆ™è¦ä½¿ç”¨URLé‡å†™ï¼Œå¯ä»¥é€šè¿‡response.encodeURL(url) è¿›è¡Œå®ç°ï¼›APIå¯¹encodeURLçš„ç»“æŸä¸ºï¼Œå½“æµè§ˆå™¨æ”¯æŒCookieæ—¶ï¼Œurlä¸åšä»»ä½•å¤„ç†ï¼›å½“æµè§ˆå™¨ä¸æ”¯æŒCookieçš„æ—¶å€™ï¼Œå°†ä¼šé‡å†™URLå°†SessionIDæ‹¼æ¥åˆ°è®¿é—®åœ°å€åã€‚<br>sessionçš„ä¼˜åŠ¿<br>ç›¸è¾ƒäº cookie æ¥è¯´ï¼Œsession å­˜å‚¨åœ¨æœåŠ¡ç«¯ï¼Œå®¢æˆ·ç«¯ä»…ä¿ç•™æ¢å– session çš„ç”¨æˆ·å‡­è¯ã€‚å› æ­¤ä¼ è¾“æ•°æ®é‡å°ï¼Œé€Ÿåº¦å¿«ã€‚session æ›´å®‰å…¨ï¼šæ£€éªŒã€ç”Ÿæˆã€éªŒè¯éƒ½æ˜¯åœ¨æœåŠ¡ç«¯æŒ‰ç…§æŒ‡å®šè§„åˆ™å®Œæˆï¼Œè€Œ cookie å¯èƒ½è¢«å®¢æˆ·ç«¯é€šè¿‡ js ä»£ç ç¯¡æ”¹ã€‚</p><h3 id="session-çš„åŠ£åŠ¿"><a href="#session-çš„åŠ£åŠ¿" class="headerlink" title="session çš„åŠ£åŠ¿"></a>session çš„åŠ£åŠ¿</h3><ul><li>æœåŠ¡å™¨æ˜¯æœ‰çŠ¶æ€çš„ã€‚å¤šå°åç«¯æœåŠ¡å™¨æ— æ³•å…±äº« sessionã€‚**è§£å†³æ–¹æ³•æ˜¯ï¼Œä¸“é—¨å‡†å¤‡ä¸€å° session æœåŠ¡å™¨ï¼Œå…³äº session çš„æ‰€æœ‰æ“ä½œéƒ½äº¤ç»™å®ƒæ¥è°ƒç”¨ã€‚è€ŒæœåŠ¡å™¨ä¹‹é—´çš„è°ƒç”¨ï¼Œå¯ä»¥èµ°å†…ç½‘ ipï¼Œèµ° RPC è°ƒç”¨ï¼ˆåç«¯ä¹‹é—´çš„æ¥å£è¯·æ±‚ï¼Œå‰ç«¯ä¸èƒ½è¯·æ±‚ï¼‰ï¼ˆä¸èµ° httpï¼‰ã€‚</li><li>Session ä¸€èˆ¬å¤±æ•ˆæ—¶é—´è¾ƒçŸ­ï¼Œå®¢æˆ·ç«¯å…³é—­ï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼‰æˆ–è€… Session è¶…æ—¶éƒ½ä¼šå¤±æ•ˆã€‚</li><li>ç”±äºå­˜æ”¾åœ¨cookieä¸­ï¼Œéœ€è¦é˜²æ­¢CSRFæ”»å‡»<br>è§£å†³æ–¹æ¡ˆï¼š<br>â—‹ é˜»æ­¢ä¸æ˜å¤–åŸŸçš„è®¿é—®ï¼ŒåŒæºæ£€æµ‹ï¼ˆæ£€æŸ¥refererã€originï¼‰ã€é™åˆ¶ç¬¬ä¸‰æ–¹cookieï¼ˆsamesite=lax)<br>â—‹ è¯·æ±‚æäº¤æ—¶é™„åŠ CSRF tokenï¼ˆåªè¦tokenä¸æ”¾åœ¨cookieé‡Œï¼Œæ”»å‡»è€…æ— æ³•ä¼ªé€ ï¼Œå¹¶ä¸”é¡µé¢æ²¡æœ‰XSSæ¼æ´æ³„æ¼tokenï¼ŒCSRFå°±æ— æ³•æˆåŠŸï¼‰</li></ul><h3 id="sessionä¸cookieçš„åŒºåˆ«"><a href="#sessionä¸cookieçš„åŒºåˆ«" class="headerlink" title="sessionä¸cookieçš„åŒºåˆ«"></a>sessionä¸cookieçš„åŒºåˆ«</h3><ul><li>ä½œç”¨èŒƒå›´ä¸åŒï¼ŒCookie ä¿å­˜åœ¨å®¢æˆ·ç«¯(æµè§ˆå™¨)ï¼ŒSession ä¿å­˜åœ¨æœåŠ¡å™¨ç«¯ã€‚</li><li>å­˜å–æ–¹å¼çš„ä¸åŒï¼ŒCookieåªèƒ½ä¿å­˜ ASCIIï¼ŒSessionå¯ä»¥å­˜ä»»æ„æ•°æ®ç±»å‹ï¼Œæ¯”å¦‚UserIdç­‰ã€‚</li><li>æœ‰æ•ˆæœŸä¸åŒï¼ŒCookieå¯è®¾ç½®ä¸ºé•¿æ—¶é—´ä¿æŒï¼Œæ¯”å¦‚é»˜è®¤ç™»å½•åŠŸèƒ½åŠŸèƒ½ï¼ŒSessionä¸€èˆ¬æœ‰æ•ˆæ—¶é—´è¾ƒçŸ­ï¼Œå®¢æˆ·ç«¯å…³é—­æˆ–è€…Sessionè¶…æ—¶éƒ½ä¼šå¤±æ•ˆã€‚</li><li>éšç§ç­–ç•¥ä¸åŒï¼ŒCookieå­˜å‚¨åœ¨å®¢æˆ·ç«¯ï¼Œä¿¡æ¯å®¹æ˜“è¢«çªƒå–;Sessionå­˜å‚¨åœ¨æœåŠ¡ç«¯ï¼Œç›¸å¯¹å®‰å…¨ä¸€äº›ã€‚</li><li>å­˜å‚¨å¤§å°ä¸åŒï¼Œ å•ä¸ªCookie ä¿å­˜çš„æ•°æ®ä¸èƒ½è¶…è¿‡ 4Kï¼ŒSessionå¯å­˜å‚¨æ•°æ®è¿œé«˜äºCookieã€‚</li></ul><h3 id="Session-å¦‚ä½•å®ç°é€€å‡ºç™»å½•å‘¢ï¼Ÿ"><a href="#Session-å¦‚ä½•å®ç°é€€å‡ºç™»å½•å‘¢ï¼Ÿ" class="headerlink" title="Session å¦‚ä½•å®ç°é€€å‡ºç™»å½•å‘¢ï¼Ÿ"></a>Session å¦‚ä½•å®ç°é€€å‡ºç™»å½•å‘¢ï¼Ÿ</h3><p>éœ€è¦æ¸…é™¤æ‰ Session ä¸­çš„ç™»å½•çŠ¶æ€ï¼ŒåŒæ—¶ä¹Ÿéœ€è¦æ¸…é™¤æ‰ Cookie ä¸­çš„ SessionIdã€‚<br>é‚£ä¹ˆå¦‚ä½•æ¸…é™¤ Cookie ä¸­çš„ SessionId å‘¢ï¼Ÿ<br>æˆ‘ä»¬å¯ä»¥é€šè¿‡å°† Cookie çš„è¿‡æœŸæ—¶é—´è®¾ç½®ä¸ºä¸€ä¸ªè¿‡å»çš„æ—¶é—´æ¥å®ç°ã€‚</p><h3 id="sessionçš„ç¼ºç‚¹"><a href="#sessionçš„ç¼ºç‚¹" class="headerlink" title="sessionçš„ç¼ºç‚¹"></a>sessionçš„ç¼ºç‚¹</h3><ul><li>ä¾èµ–cookieï¼Œcookieè‡ªèº«å°±æœ‰å®‰å…¨æ¼æ´ï¼Œå¦‚æœcookieè¢«åŠ«æŒçš„è¯ï¼Œé»‘å®¢ä»ä¸­æ‹¿åˆ°äº†session IDï¼Œå†’å……ç”¨æˆ·ä¾æ—§æ˜¯ä¸ªæ¼æ´<br>æ€ä¹ˆé¢„é˜²ï¼š<br>â—‹ ä½¿ç”¨ HTTPS åè®®åŠ å¯†ä¼ è¾“æ•°æ®ï¼Œå¯ä»¥æœ‰æ•ˆé˜²æ­¢ä¸­é—´äººæ”»å‡»å’Œé»‘å®¢çªƒå¬ã€‚<br>â—‹ ç”Ÿæˆéšæœºä¸”å¤æ‚çš„ Session IDï¼Œå¹¶è®¾ç½®åˆç†çš„è¿‡æœŸæ—¶é—´ï¼Œé¿å…è¢«çŒœæµ‹æˆ–è€…é‡æ”¾æ”»å‡»ã€‚<br>â—‹ ä¸è¦åœ¨ URL ä¸­ä½¿ç”¨ Session IDï¼Œé¿å…ä¼šè¯å›ºå®šæ”»å‡»ã€‚<br>â—‹ å®šæœŸæ›´æ¢ Session IDï¼Œä»¥ä¿è¯ä¼šè¯å®‰å…¨æ€§ã€‚</li><li>ä¾èµ–cookieï¼Œå®¢æˆ·ç«¯å¯èƒ½ä¸æ”¯æŒcookie<br>æ€ä¹ˆè§£å†³ï¼š<br>â—‹ URL é‡å†™ Sessionï¼Œæ˜¯ä¸€ç§åœ¨ URL ä¸­ä¼ é€’ Session ID çš„æ–¹å¼ï¼Œç¼ºç‚¹æ˜¯æ”¾åœ¨URLä¸­æ˜¯ä¸å®‰å…¨çš„ï¼Œä»¥ä¸ºæ˜¯æ˜æ–‡ä¼ è¾“</li><li>æœåŠ¡ç«¯ Session éœ€è¦åœ¨æœåŠ¡ç«¯ç»´æŠ¤ï¼Œéœ€è¦æ‰¾åœ°æ–¹ä¿å­˜å®ƒï¼Œåˆè¦è€ƒè™‘åˆ†å¸ƒå¼çš„é—®é¢˜ï¼Œç”šè‡³è¦å•ç‹¬ä¸ºäº†å®ƒå¯ç”¨ä¸€å¥— Redis é›†ç¾¤ã€‚</li></ul><h2 id="JWT-Token"><a href="#JWT-Token" class="headerlink" title="JWT Token"></a>JWT Token</h2><h3 id="ä»€ä¹ˆæ˜¯jwt-token"><a href="#ä»€ä¹ˆæ˜¯jwt-token" class="headerlink" title="ä»€ä¹ˆæ˜¯jwt token"></a>ä»€ä¹ˆæ˜¯jwt token</h3><p>ä¸€ç§åŸºäº Token çš„èº«ä»½è®¤è¯æœºåˆ¶ï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯æ— çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä¸éœ€è¦åœ¨æœåŠ¡ç«¯ä¿å­˜ä¼šè¯ä¿¡æ¯ï¼Œä¹Ÿä¸éœ€è¦åœ¨å®¢æˆ·ç«¯ä¿å­˜ä¼šè¯çŠ¶æ€ã€‚è¿™é‡Œçš„JWT å°±æ˜¯ä¸€ä¸ªä»¤ç‰Œï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬åœ¨ä¼ é€’çš„ token å­—ç¬¦ä¸²ã€‚</p><h4 id="æµç¨‹"><a href="#æµç¨‹" class="headerlink" title="æµç¨‹"></a>æµç¨‹</h4><ol><li>é¦–å…ˆç”¨æˆ·é€šè¿‡è´¦å·å’Œå¯†ç å‘æœåŠ¡å™¨è¯·æ±‚ç™»å½•ã€‚</li><li>æœåŠ¡ç«¯æ ¡éªŒç”¨æˆ·èº«ä»½åï¼Œç”Ÿæˆä¸€ä¸ª Tokenï¼Œç„¶åå°† Token è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</li><li>å®¢æˆ·ç«¯éœ€è¦åœ¨æœ¬åœ°ä¿å­˜è¿™ä¸ª Tokenï¼Œä»¥ä¾¿åç»­çš„è¯·æ±‚æºå¸¦ Tokenã€‚</li><li>å®¢æˆ·ç«¯å¯ä»¥åœ¨æœ¬åœ°å­˜å‚¨æˆ– sessionStorage ä¸­ä¿å­˜ Tokenï¼Œä¹Ÿå¯ä»¥åœ¨ Cookie ä¸­ä¿å­˜ Tokenã€‚</li><li>å®¢æˆ·ç«¯åœ¨åç»­è¯·æ±‚ä¸­ï¼Œéƒ½éœ€è¦å°† Token å‘é€ç»™æœåŠ¡å™¨éªŒè¯ã€‚ä¸€èˆ¬å°† Token æ”¾åœ¨ HTTP è¯·æ±‚å¤´çš„ Authorization å­—æ®µä¸­ï¼Œå‘é€ç»™æœåŠ¡å™¨ã€‚Bearer [Token]</li><li>æœåŠ¡ç«¯åœ¨æ¥æ”¶åˆ°è¯·æ±‚åï¼Œä¼šä» Authorization å­—æ®µä¸­è·å– Tokenï¼Œå¹¶éªŒè¯ token æ˜¯å¦æœ‰æ•ˆï¼Œç­¾åæ˜¯å¦æ­£ç¡®ï¼Œæ˜¯å¦è¿‡æœŸç­‰ã€‚é€šè¿‡åï¼Œå†è¿›è¡Œå“åº”ã€‚</li></ol><h4 id="jwtçš„ç”Ÿæˆè¿‡ç¨‹"><a href="#jwtçš„ç”Ÿæˆè¿‡ç¨‹" class="headerlink" title="jwtçš„ç”Ÿæˆè¿‡ç¨‹"></a>jwtçš„ç”Ÿæˆè¿‡ç¨‹</h4><p>jwtåˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼šheaderï¼ˆå¤´éƒ¨ï¼‰ã€payloadï¼ˆè½½è·ï¼‰å’Œ signatureï¼ˆç­¾åï¼‰<br>header:å®šäº†ç”¨äºç”Ÿæˆç­¾åçš„ç®—æ³•<br>payload:æ”¾äº†ä¸€äº›è¿‡æœŸæ—¶é—´ï¼Œç”¨æˆ·çš„ç›¸å…³ä¿¡æ¯æˆ–å…¶ä»–ä¸šåŠ¡éœ€è¦çš„å¿…è¦ä¿¡æ¯ï¼Œä½†ä¸å»ºè®®æ·»åŠ æ•æ„Ÿä¿¡æ¯ï¼Œå› ä¸ºè¯¥éƒ¨åˆ†åœ¨å®¢æˆ·ç«¯å¯è§£å¯†ã€‚<br>signatureï¼šç„¶åç”¨headerä¸­æŒ‡å®šçš„ç®—æ³•å¯¹å‰ä¸¤éƒ¨åˆ†çš„base64+ç§é’¥ï¼ˆè¿™ä¸ªå¯†é’¥åªæœ‰æœåŠ¡å™¨æ‰èƒ½çŸ¥é“ï¼Œä¸èƒ½æ³„éœ²ç»™ç”¨æˆ·ï¼‰è¿›è¡Œç­¾å</p><h4 id="jwtå¦‚ä½•é˜²æ­¢è¢«ç¯¡æ”¹"><a href="#jwtå¦‚ä½•é˜²æ­¢è¢«ç¯¡æ”¹" class="headerlink" title="jwtå¦‚ä½•é˜²æ­¢è¢«ç¯¡æ”¹"></a>jwtå¦‚ä½•é˜²æ­¢è¢«ç¯¡æ”¹</h4><p>åœ¨æ•´ä¸ª JWT è®¤è¯æµç¨‹ä¸­ï¼ŒæœåŠ¡ç«¯åœ¨æ”¶åˆ°å®¢æˆ·ç«¯è¯·æ±‚å¤´ä¸­æºå¸¦çš„ token æ—¶ï¼Œä¼šä½¿ç”¨ç›¸åŒçš„å¯†é’¥å’Œç®—æ³•å¯¹tokenè¿›è¡Œè§£ç ï¼Œ<br>ç„¶åä½¿ç”¨ç›¸åŒçš„ç®—æ³•ï¼Œå°† header å’Œ payload ä»¥åŠ secret ç§é’¥è¿›è¡Œç­¾åï¼Œç„¶åå’Œ token ä¸­åŸæœ‰çš„ç­¾åè¿›è¡Œå¯¹æ¯”ï¼Œå¦‚æœä¸€è‡´ï¼Œè¯´æ˜ token æ²¡æœ‰è¢«ç¯¡æ”¹ï¼Œå¦‚æœä¸ä¸€è‡´ï¼Œè¯´æ˜ token è¢«ç¯¡æ”¹äº†ã€‚</p><p>æ— è®ºåˆ«äººçŸ¥é“å¤šå°‘æˆ‘ä»¬åœ¨ä¼ è¾“çš„ä¿¡æ¯ï¼Œç¯¡æ”¹å’Œä¼ªé€ åéƒ½ä¸èƒ½é€šè¿‡æœåŠ¡å™¨çš„éªŒè¯ï¼Œæ˜¯å› ä¸ºæ— æ³•è·å–æœåŠ¡å™¨çš„å¯†é’¥ secretï¼ŒçœŸæ­£èƒ½ä¿è¯å®‰å…¨çš„å°±æ˜¯ secret</p><h4 id="jwtå¦‚ä½•é€€å‡ºç™»å½•"><a href="#jwtå¦‚ä½•é€€å‡ºç™»å½•" class="headerlink" title="jwtå¦‚ä½•é€€å‡ºç™»å½•"></a>jwtå¦‚ä½•é€€å‡ºç™»å½•</h4><p>åœ¨ç”¨æˆ·æ³¨é”€ç™»å½•åï¼Œä¼šæŠŠç”¨æˆ· token å­˜åˆ° token åˆ—è¡¨ä¸­ï¼Œå½“è¿™ä¸ª token å†æ¬¡è¢«ç”¨æ¥è¯·æ±‚æ—¶ï¼Œå°±ä¼šå‘½ä¸­é»‘åå•ï¼Œè€Œè¢«æ‹’ç»è¯·æ±‚</p><h4 id="jwtå­˜å‚¨åœ¨å®¢æˆ·ç«¯å¦‚ä½•é˜²æ­¢æœªé€€å‡ºç™»å½•çš„æ—¶å€™è¢«åŠ«æŒ"><a href="#jwtå­˜å‚¨åœ¨å®¢æˆ·ç«¯å¦‚ä½•é˜²æ­¢æœªé€€å‡ºç™»å½•çš„æ—¶å€™è¢«åŠ«æŒ" class="headerlink" title="jwtå­˜å‚¨åœ¨å®¢æˆ·ç«¯å¦‚ä½•é˜²æ­¢æœªé€€å‡ºç™»å½•çš„æ—¶å€™è¢«åŠ«æŒ"></a>jwtå­˜å‚¨åœ¨å®¢æˆ·ç«¯å¦‚ä½•é˜²æ­¢æœªé€€å‡ºç™»å½•çš„æ—¶å€™è¢«åŠ«æŒ</h4><p>è¿˜æ²¡æœ‰é€€å‡ºç™»å½• token ä»ç„¶æœ‰æ•ˆï¼Œå¦‚æœ token æ³„éœ²äº†ï¼Œæ”»å‡»è€…å¯ä»¥ç›—ç”¨è¿™ä¸ª tokenæ¥å†’ç”¨èº«ä»½ã€‚ä½†æ˜¯å¯ä»¥åœ¨ JWT payload éƒ¨åˆ†åŠ ä¸Š IP ä¹‹ç±»çš„æ¥å¢å¼º token çš„å®‰å…¨æ€§ã€‚åŒæ—¶æ›´å®‰å…¨çš„åšæ³•æ˜¯ä½¿ç”¨ https åè®®æ¥ä¼ è¾“ token</p><h4 id="å¦‚ä½•å®ç°æ— æ„Ÿåˆ·æ–°ï¼Ÿ"><a href="#å¦‚ä½•å®ç°æ— æ„Ÿåˆ·æ–°ï¼Ÿ" class="headerlink" title="å¦‚ä½•å®ç°æ— æ„Ÿåˆ·æ–°ï¼Ÿ"></a>å¦‚ä½•å®ç°æ— æ„Ÿåˆ·æ–°ï¼Ÿ</h4><p>åœ¨ç”¨æˆ·ç™»å½•çš„æ—¶å€™ï¼ŒæœåŠ¡ç«¯è¿”å›ä¸¤ä¸ª token</p><ul><li>ä¸€ä¸ªæ˜¯ accessTokenï¼Œç”¨æ¥åšç”¨æˆ·çš„é‰´æƒï¼Œè¿‡æœŸæ—¶é—´æ¯”è¾ƒçŸ­ï¼Œæ¯”å¦‚ 1 å°æ—¶</li><li>ä¸€ä¸ªæ˜¯ refreshTokenï¼Œç”¨æ¥åˆ·æ–° accessTokenï¼Œè¿‡æœŸæ—¶é—´æ¯”è¾ƒé•¿ï¼Œæ¯”å¦‚ 7 å¤©<br>å®¢æˆ·ç«¯æŠŠè¿™ä¸¤ä¸ª token éƒ½å­˜åœ¨æœ¬åœ°ï¼Œæ¯æ¬¡è®¿é—®éƒ½å°† accessToken ä¼ ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯æ ¡éªŒ accessToken æœ‰æ•ˆåï¼Œå“åº”ã€‚<br>å¦‚æœæœåŠ¡ç«¯æ ¡éªŒ accessTokenè¿‡æœŸåï¼Œé‚£ä¹ˆå°±éœ€è¦å°† refreshToken ä¼ ç»™æœåŠ¡ç«¯ï¼Œå¦‚æœ refreshToken æ˜¯æœ‰æ•ˆçš„ï¼Œé‚£ä¹ˆæœåŠ¡ç«¯å°±ä¼šè¿”å›ä¸€ä¸ªæ–°çš„ accessTokenï¼Œå®¢æˆ·ç«¯å°±å¯ä»¥ä½¿ç”¨æ–°çš„ accessToken ç»§ç»­è®¿é—®ã€‚<br>å®¢æˆ·ç«¯éœ€è¦æ›´æ–°æœ¬åœ°çš„ accessTokenï¼Œè¿™æ ·å°±å®ç°äº†æ— æ„Ÿåˆ·æ–°ã€‚<br>è¿™é‡Œä¸€å…±ä¼šå‘é€ 2 æ¬¡çš„ HTTP è¯·æ±‚ï¼Œç¬¬ä¸€æ¬¡è¿‡æœŸè¢«æ‹’ç»ï¼Œç¬¬äºŒæ¬¡åˆ·æ–° token</li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> ç½‘ç»œ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¸¸è§çš„æ”»å‡»æ–¹å¼</title>
      <link href="/ashley271017.github.io/2020/04/16/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/"/>
      <url>/ashley271017.github.io/2020/04/16/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h3 id="XSSæ”»å‡»"><a href="#XSSæ”»å‡»" class="headerlink" title="XSSæ”»å‡»"></a>XSSæ”»å‡»</h3><p>XSSæ”»å‡»æ˜¯ä¸€ç§ä»£ç æ³¨å…¥æ”»å‡»ï¼Œé€šè¿‡æ¶æ„æ³¨å…¥è„šæœ¬åœ¨æµè§ˆå™¨è¿è¡Œï¼Œç„¶åç›—å–ç”¨æˆ·ä¿¡æ¯<br>é€ æˆXSSæ”»å‡»å…¶å®æœ¬è´¨ä¸Šè¿˜æ˜¯å› ä¸ºç½‘ç«™æ²¡æœ‰è¿‡æ»¤æ¶æ„ä»£ç ï¼Œä¸æ­£å¸¸ä»£ç æ··åœ¨ä¸€èµ·ä¹‹åï¼Œæµè§ˆå™¨æ²¡æœ‰åŠæ³•åˆ†è¾¨å“ªäº›æ˜¯å¯ä¿¡çš„ï¼Œç„¶åå¯¼è‡´æ¶æ„ä»£ç ä¹Ÿè¢«æ‰§è¡Œã€‚</p><p>ç„¶åå¯èƒ½å¯¼è‡´ä»¥ä¸‹æƒ…å†µï¼š</p><ul><li>é¡µé¢æ•°æ®æˆ–ç”¨æˆ·ä¿¡æ¯è¢«çªƒå–ï¼Œå¦‚DOMã€Cookieã€LocalStorage</li><li>ä¿®æ”¹DOMï¼Œæ¯”å¦‚ä¼ªé€ ç™»å½•çª—å£æˆ–åœ¨é¡µé¢ç”Ÿæˆæµ®çª—å¹¿å‘Š</li><li>ç›‘å¬ç”¨æˆ·è¡Œä¸ºï¼Œæ¯”å¦‚åœ¨ç™»å½•æˆ–é“¶è¡Œç­‰ç«™ç‚¹ç”¨ addEventListener ç›‘å¬é”®ç›˜äº‹ä»¶ï¼Œçªƒå–è´¦å·å¯†ç ç­‰ä¿¡æ¯</li></ul><p><strong>XSSæ”»å‡»æœ‰ä¸‰ç§ç±»å‹ï¼šå­˜å‚¨å‹ã€åå°„å‹ã€DOMå‹</strong></p><ol><li><p>å­˜å‚¨å‹ï¼šæ˜¯åœ¨æœ‰å‘è´´è¯„è®ºç­‰å¸¦æœ‰æ•°æ®ä¿å­˜åŠŸèƒ½çš„ç½‘ç«™çš„inputã€textareaå°†<code>æ¶æ„ä»£ç æäº¤åˆ°ç½‘ç«™æ•°æ®åº“ä¸­</code>ï¼Œå¦‚<script src="http://æ¶æ„ç½‘ç«™"></script> ï¼Œç„¶åæœåŠ¡å™¨ç›´æ¥å­˜ä¸Šäº†ï¼Œè¿”å›ç»™å‰ç«¯å±•ç¤ºçš„æ—¶å€™ï¼Œå°±ä¼šç›´æ¥æ‰§è¡Œè¿™ä¸ªscriptæ ‡ç­¾é‡Œçš„æ¶æ„ä»£ç </p></li><li><p>åå°„å‹ï¼š<code>æ˜¯æ”»å‡»è€…å°†æ¶æ„JSè„šæœ¬ä½œä¸ºç”¨æˆ·å‘é€ç»™ç½‘ç«™è¯·æ±‚ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œç„¶åç½‘ç«™åˆæŠŠæ¶æ„è„šæœ¬è¿”å›ç»™ç”¨æˆ·ï¼Œè¿™æ—¶å€™å°±ä¼šåœ¨é¡µé¢ä¸­è¢«æ‰§è¡Œ</code>ã€‚æ¯”å¦‚æ‰“å¼€åŒ…å«å¸¦æ¶æ„è„šæœ¬çš„é“¾æ¥ï¼Œå½“æ‰“å¼€åä¼šå‘æœåŠ¡å™¨è¯·æ±‚åï¼ŒæœåŠ¡å™¨ä¼šè·å–URLä¸­çš„æ•°æ®ç„¶åæ‹¼æ¥åœ¨HTMLä¸Šè¿”å›ï¼Œç„¶åæ‰§è¡Œã€‚å®ƒå’Œå­˜å‚¨å‹ä¸åŒçš„æ˜¯ä¸ä¼šå‚¨å­˜åœ¨æœåŠ¡å™¨é‡Œ:<br>æ¯”å¦‚ï¼šä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚æˆ‘ä»¬åœ¨è®¿é—®ä¸€ä¸ªé“¾æ¥çš„æ—¶å€™ï¼ˆ<a href="http://102.3.203.111/Web/reflectedXSS.jsp?param=value...ï¼‰ï¼Œè¿™ä¸ªURLä¸­å°±å¸¦äº†å‚æ•°ï¼ˆparam=value...ï¼‰ï¼Œ`å¦‚æœæœåŠ¡ç«¯æ²¡æœ‰å¯¹å‚æ•°è¿›è¡Œå¿…è¦çš„æ ¡éªŒï¼Œç›´æ¥æ ¹æ®è¿™ä¸ªè¯·æ±‚çš„å‚æ•°å€¼æ„é€ ä¸åŒçš„HTMLè¿”å›ï¼ˆæ¯”å¦‚caniuse`ï¼‰ï¼Œè®©valueå‡ºç°åœ¨è¿”å›çš„htmlä¸­ï¼ˆJS,HTMLæŸå…ƒç´ çš„å†…å®¹æˆ–è€…å±æ€§ï¼‰å¹¶è¢«æµè§ˆå™¨è§£é‡Šæ‰§è¡Œï¼Œå°±å¯èƒ½å­˜åœ¨åå°„å‹XSSæ¼æ´ã€‚" target="_blank" rel="noopener">http://102.3.203.111/Web/reflectedXSS.jsp?param=value...ï¼‰ï¼Œè¿™ä¸ªURLä¸­å°±å¸¦äº†å‚æ•°ï¼ˆparam=value...ï¼‰ï¼Œ`å¦‚æœæœåŠ¡ç«¯æ²¡æœ‰å¯¹å‚æ•°è¿›è¡Œå¿…è¦çš„æ ¡éªŒï¼Œç›´æ¥æ ¹æ®è¿™ä¸ªè¯·æ±‚çš„å‚æ•°å€¼æ„é€ ä¸åŒçš„HTMLè¿”å›ï¼ˆæ¯”å¦‚caniuse`ï¼‰ï¼Œè®©valueå‡ºç°åœ¨è¿”å›çš„htmlä¸­ï¼ˆJS,HTMLæŸå…ƒç´ çš„å†…å®¹æˆ–è€…å±æ€§ï¼‰å¹¶è¢«æµè§ˆå™¨è§£é‡Šæ‰§è¡Œï¼Œå°±å¯èƒ½å­˜åœ¨åå°„å‹XSSæ¼æ´ã€‚</a></p></li><li><p>åŸºäºDOMå‹ï¼šå°±æ˜¯æ”»å‡»è€…é€šè¿‡ä¸€äº›åŠ«æŒæ‰‹æ®µï¼Œåœ¨é¡µé¢èµ„æºä¼ è¾“è¿‡ç¨‹ä¸­åŠ«æŒå¹¶ä¿®æ”¹é¡µé¢çš„æ•°æ®ï¼Œæ’å…¥æ¶æ„ä»£ç </p></li></ol><h3 id="æ€ä¹ˆé˜²èŒƒXSSæ”»å‡»"><a href="#æ€ä¹ˆé˜²èŒƒXSSæ”»å‡»" class="headerlink" title="æ€ä¹ˆé˜²èŒƒXSSæ”»å‡»"></a>æ€ä¹ˆé˜²èŒƒXSSæ”»å‡»</h3><ul><li><p>é’ˆå¯¹å­˜å‚¨å‹ï¼šå¯¹è¾“å…¥æ¡†çš„å†…å®¹è¿›è¡Œè¿‡æ»¤æˆ–ä½¿ç”¨è½¬ä¹‰ç¬¦è¿›è¡Œè½¬ç <br>å­—ç¬¦    è½¬ä¹‰åçš„å­—ç¬¦</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;&amp;lt;</span><br><span class="line">&amp;gt;</span><br><span class="line">&quot;&amp;quot;</span><br><span class="line">&apos;&amp;#x27;</span><br><span class="line">/&amp;#x2F</span><br><span class="line">&amp;&amp;amp;</span><br></pre></td></tr></table></figure></li><li><p><strong>é’ˆå¯¹åå°„å‹ï¼šä½¿ç”¨CSPï¼Œå°±æ˜¯ç™½åå•ï¼Œå‘Šè¯‰æµè§ˆå™¨å“ªäº›å¤–éƒ¨èµ„æºå¯ä»¥åŠ è½½æ‰§è¡Œ</strong>ï¼Œè®©å³ä½¿æ’å…¥è¿›æ¥æ¶æ„ä»£ç çš„ä¹Ÿä¸ä¼šæ‰§è¡Œï¼Œæˆ–è€…å¯ä»¥å‘å“ªäº›ç¬¬ä¸‰æ–¹ç«™ç‚¹æäº¤æ•°æ®ã€‚å¼€å¯ç™½åå•çš„æ–¹å¼æœ‰ä¸¤ç§ï¼š<br>ä½¿ç”¨ meta æ ‡ç­¾ <meta http-equiv="Content-Security-Policy"><br>è®¾ç½®httpå¤´éƒ¨çš„ Content-Security-Policyï¼ˆä½¿ç”¨è¿™ç§æ¨¡å¼,å°†ä¼šç›´æ¥é˜»æ­¢éæ³•çš„å¤–éƒ¨èµ„æºåŠ è½½,åŒæ—¶ä¹Ÿå¯ä»¥é€‰æ‹©æ˜¯å¦é…ç½®å°†éæ³•èµ„æºåŠ è½½çš„é“¾æ¥å’Œè¡Œä¸ºæŠ¥å‘Šç»™æˆ‘ä»¬æŒ‡å®šçš„ç½‘å€ï¼‰</p></li><li><p>é’ˆå¯¹åŸºäºdomå‹ï¼šå¯¹ä¸€äº›æ•æ„Ÿä¿¡æ¯è¿›è¡Œä¿æŠ¤ï¼Œåœ¨Cookieä¿¡æ¯ä¸­æ·»åŠ httpOnlyï¼Œå‘Šè¯‰æµè§ˆå™¨åœ¨ä¿å­˜Cookieï¼Œä¸”ä¸è¦å¯¹å®¢æˆ·ç«¯è„šæœ¬å¼€æ”¾è®¿é—®æƒé™ï¼Œç„¶åå°±ä¸èƒ½é€šè¿‡document.cookieè·å–cookieäº†</p><h3 id="CSRFæ”»å‡»"><a href="#CSRFæ”»å‡»" class="headerlink" title="CSRFæ”»å‡»"></a>CSRFæ”»å‡»</h3><p>å°±æ˜¯è·¨ç«™è¯·æ±‚ä¼ªé€ æ”»å‡»ï¼Œä¸»è¦å°±æ˜¯åˆ©ç”¨ç”¨æˆ·çš„ç™»å½•çŠ¶æ€å‘èµ·è·¨ç«™è¯·æ±‚å†’å……ç”¨æˆ·æ‰§è¡Œä¸€äº›æ“ä½œï¼Œæ¯”å¦‚é‚®ç®±é‡Œçš„ä¹±ä¸ƒå…«ç³Ÿçš„é“¾æ¥ï¼Œæ‰“å¼€é“¾æ¥çš„æ—¶å€™é‚®ç®±è‚¯å®šæ˜¯å¤„äºç™»å½•çŠ¶æ€ï¼Œ<code>ç„¶åé»‘å®¢å°±å¯ä»¥ç”¨è¿™ä¸ªç™»å½•çŠ¶æ€ï¼Œä¼ªé€ å¸¦æœ‰æ­£ç¡® Cookie çš„ http è¯·æ±‚</code>ï¼Œç›´æ¥ç»•è¿‡åå°çš„ç™»å½•éªŒè¯ï¼Œç„¶åå†’å……ç”¨æˆ·æ‰§è¡Œä¸€äº›æ“ä½œ<br>å‘èµ·CSRFæ”»å‡»æœ‰ä¸‰ä¸ªå¿…è¦æ¡ä»¶ï¼š</p></li></ul><ol><li>ç›®æ ‡ç½‘ç«™ä¸€å®šè¦æœ‰CSRFæ¼æ´</li><li>ç”¨æˆ·ç™»å½•è¿‡ç›®æ ‡ç½‘ç«™ï¼Œå¹¶ä¸”æµè§ˆå™¨ä¿å­˜äº†ç™»å½•çŠ¶æ€</li><li>éœ€è¦ç”¨æˆ·ä¸»åŠ¨æ‰“å¼€ç¬¬ä¸‰æ–¹ç«™ç‚¹</li></ol><p><strong>æœ¬è´¨æ˜¯åˆ©ç”¨cookieåœ¨åŒæºè¯·æ±‚ä¸­æºå¸¦å‘é€ç»™æœåŠ¡å™¨çš„ç‰¹ç‚¹</strong>ï¼Œæ¥å®ç°å†’å……ç”¨æˆ·<br><strong>CSRFæ”»å‡»ä¹Ÿæœ‰ä¸‰ç§ç±»å‹ï¼šGETç±»å‹ã€POSTç±»å‹ã€é“¾æ¥å‹</strong></p><ul><li><p>è‡ªåŠ¨å‘GETç±»å‹ï¼šæ¯”å¦‚imgæˆ–iframeæ ‡ç­¾ç­‰ï¼Œå½“ç”¨æˆ·æ‰“å¼€è¿™ä¸ªç½‘ç«™æ—¶,æ¶æ„ç½‘ç«™ä¼šåƒæˆ‘ä»¬çš„æœåŠ¡å™¨è‡ªåŠ¨å‘èµ·å¸¦Cookieçš„èµ„æºè¯·æ±‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"http://æ¶æ„ç½‘å€"</span> &gt;</span></span><br></pre></td></tr></table></figure></li><li><p>è‡ªåŠ¨å‘POSTç±»å‹ï¼šæ¯”å¦‚æ•´ä¸€ä¸ªéšè—çš„è¡¨å•ï¼Œåœ¨ç”¨æˆ·è¿›å…¥é¡µé¢çš„æ—¶å€™è‡ªåŠ¨æäº¤è¡¨å•</p></li><li><p>è¯±å¯¼é“¾æ¥å‹ï¼šå°±æ˜¯è¯±å¯¼ç”¨æˆ·ä¸»åŠ¨ç‚¹å‡»é“¾æ¥ï¼Œæ¯”å¦‚aæ ‡ç­¾<br><a href="https://æ¶æ„ç½‘å€" target="_blank" rel="noopener">ç‚¹å‡»é¢†å–å¤§ç¤¼åŒ…</a><br><a href="https://æ¶æ„ç½‘å€" target="_blank" rel="noopener">ç‚¹å‡»ä¸‹è½½ç¾å¥³è§†é¢‘</a></p></li></ul><p>ä»¥ä¸Šä¸‰ç§å½¢å¼å…¶å®éƒ½æ˜¯é€šè¿‡æ‹¿åˆ°ç”¨æˆ·çš„cookieç„¶åå¼•å¯¼ç”¨æˆ·è¿›å…¥æ¶æ„ç½‘ç«™ï¼Œæ¶æ„ç½‘ç«™å†å»æ‹¿ç€æˆ‘ä»¬çš„cookieå»è¯·æ±‚æˆ‘ä»¬çš„æœåŠ¡å™¨</p><h3 id="æ€ä¹ˆé˜²èŒƒCSRFæ”»å‡»ï¼Œæœ‰ä»€ä¹ˆè§£å†³åŠæ³•ï¼Ÿ"><a href="#æ€ä¹ˆé˜²èŒƒCSRFæ”»å‡»ï¼Œæœ‰ä»€ä¹ˆè§£å†³åŠæ³•ï¼Ÿ" class="headerlink" title="æ€ä¹ˆé˜²èŒƒCSRFæ”»å‡»ï¼Œæœ‰ä»€ä¹ˆè§£å†³åŠæ³•ï¼Ÿ"></a>æ€ä¹ˆé˜²èŒƒCSRFæ”»å‡»ï¼Œæœ‰ä»€ä¹ˆè§£å†³åŠæ³•ï¼Ÿ</h3><ul><li><p>åœ¨Cookieä¿¡æ¯ä¸­æ·»åŠ <code>SameSite</code>å±æ€§ä¸ºnoneï¼Œè¿™ä¸ªå±æ€§æœ‰ä¸‰ä¸ªå€¼ï¼š</p><ul><li><p>strictï¼šä¸¥æ ¼æ¨¡å¼ï¼Œå®Œå…¨ç¦æ­¢ä½¿ç”¨Cookieï¼šæµè§ˆå™¨ä¼šå®Œå…¨ç¦æ­¢ç¬¬ä¸‰æ–¹ Cookieã€‚ç®€è¨€ä¹‹ï¼Œå¦‚æœä½ ä»æå®¢æ—¶é—´çš„é¡µé¢ä¸­è®¿é—® InfoQ çš„èµ„æºï¼Œè€Œ InfoQ çš„æŸäº› Cookie è®¾ç½®äº† SameSite = Strict çš„è¯ï¼Œé‚£ä¹ˆè¿™äº› Cookie æ˜¯ä¸ä¼šè¢«å‘é€åˆ° InfoQ çš„æœåŠ¡å™¨ä¸Šçš„ã€‚åªæœ‰ä½ ä» InfoQ çš„ç«™ç‚¹å»è¯·æ±‚ InfoQ çš„èµ„æºæ—¶ï¼Œæ‰ä¼šå¸¦ä¸Šè¿™äº› Cookieã€‚</p></li><li><p>laxï¼šå®½æ¾æ¨¡å¼ï¼Œå…è®¸éƒ¨åˆ†æƒ…å†µä½¿ç”¨Cookieï¼Œè·¨åŸŸçš„éƒ½è¡Œï¼Œaæ ‡ç­¾è·³è½¬ï¼Œlinkæ ‡ç­¾ï¼ŒGETæäº¤è¡¨å•ï¼šä»ç¬¬ä¸‰æ–¹ç«™ç‚¹çš„é“¾æ¥æ‰“å¼€å’Œä»ç¬¬ä¸‰æ–¹ç«™ç‚¹æäº¤ Get æ–¹å¼çš„è¡¨å•è¿™ä¸¤ç§æ–¹å¼éƒ½ä¼šæºå¸¦ Cookieã€‚<strong>ä½†å¦‚æœåœ¨ç¬¬ä¸‰æ–¹ç«™ç‚¹ä¸­ä½¿ç”¨ Post æ–¹æ³•ï¼Œæˆ–è€…é€šè¿‡ imgã€iframe ç­‰æ ‡ç­¾åŠ è½½çš„ URLï¼Œè¿™äº›åœºæ™¯éƒ½ä¸ä¼šæºå¸¦ Cookieã€‚</strong><br>æ¯”å¦‚ï¼šä» â€‹â€‹time.geekbang.orgâ€‹â€‹ çš„é¡µé¢ä¸­ï¼Œé€šè¿‡aæ ‡ç­¾æ‰“å¼€é¡µé¢ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"https://www.infoq.cn/sendcoin?user=hacker&amp;number=100"</span>&gt;</span>ç‚¹æˆ‘ä¸‹è½½<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å½“ç”¨æˆ·ç‚¹å‡»æ•´ä¸ªé“¾æ¥çš„æ—¶å€™ï¼Œå› ä¸ºInfoQä¸­a_vaule(infoQçš„cookie)çš„SameSiteçš„å€¼è®¾ç½®æˆäº†strictï¼Œé‚£ä¹ˆa_vauleçš„å€¼å°†ä¸ä¼šè¢«æºå¸¦åˆ°è¿™ä¸ªè¯·æ±‚çš„HTTPå¤´ä¸­ã€‚</p></li><li><p>noneï¼šä»»ä½•æƒ…å†µä¸‹éƒ½ä¼šå‘é€Cookieï¼Œä½†å¿…é¡»åŒæ—¶è®¾ç½®Secureå±æ€§ï¼Œæ„æ€æ˜¯éœ€è¦å®‰å…¨ä¸Šä¸‹æ–‡ï¼ŒCookie åªèƒ½é€šè¿‡httpså‘é€ï¼Œå¦åˆ™æ— æ•ˆ</p></li></ul></li></ul><p>Chrome 80ä¹‹å‰é»˜è®¤å€¼æ˜¯noneï¼Œä¹‹åæ˜¯laxï¼Œåœ¨é˜²èŒƒ CSRF æ”»å‡»æ—¶ï¼Œå¯ä»¥é’ˆå¯¹å®é™…æƒ…å†µå°†ä¸€äº›å…³é”®çš„ Cookie è®¾ç½®ä¸º Strict æˆ–è€… Lax æ¨¡å¼ï¼Œè¿™æ ·åœ¨è·¨ç«™ç‚¹è¯·æ±‚æ—¶ï¼Œè¿™äº›å…³é”®çš„ Cookie å°±ä¸ä¼šè¢«å‘é€åˆ°æœåŠ¡å™¨ï¼Œä»è€Œä½¿å¾—é»‘å®¢çš„ CSRF æ”»å‡»å¤±æ•ˆã€‚</p><ul><li>CSRF token<br>å‰é¢è®²åˆ°CSRFçš„å¦ä¸€ä¸ªç‰¹å¾æ˜¯ï¼Œæ”»å‡»è€…æ— æ³•ç›´æ¥çªƒå–åˆ°ç”¨æˆ·çš„ä¿¡æ¯ï¼ˆCookieï¼ŒHeaderï¼Œç½‘ç«™å†…å®¹ç­‰ï¼‰ï¼Œä»…ä»…æ˜¯å†’ç”¨Cookieä¸­çš„ä¿¡æ¯ã€‚</li></ul><p>è€ŒCSRFæ”»å‡»ä¹‹æ‰€ä»¥èƒ½å¤ŸæˆåŠŸï¼Œæ˜¯å› ä¸ºæœåŠ¡å™¨è¯¯æŠŠæ”»å‡»è€…å‘é€çš„è¯·æ±‚å½“æˆäº†ç”¨æˆ·è‡ªå·±çš„è¯·æ±‚ã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è¦æ±‚æ‰€æœ‰çš„ç”¨æˆ·è¯·æ±‚éƒ½æºå¸¦ä¸€ä¸ªCSRFæ”»å‡»è€…æ— æ³•è·å–åˆ°çš„Tokenã€‚æœåŠ¡å™¨é€šè¿‡æ ¡éªŒè¯·æ±‚æ˜¯å¦æºå¸¦æ­£ç¡®çš„Tokenï¼Œæ¥æŠŠæ­£å¸¸çš„è¯·æ±‚å’Œæ”»å‡»çš„è¯·æ±‚åŒºåˆ†å¼€ï¼Œä¹Ÿå¯ä»¥é˜²èŒƒCSRFçš„æ”»å‡»ã€‚</p><p>åŸç†<br>CSRF Tokençš„é˜²æŠ¤ç­–ç•¥åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼š</p><ol><li>å°†CSRF Tokenè¾“å‡ºåˆ°é¡µé¢ä¸­</li></ol><p>é¦–å…ˆï¼Œç”¨æˆ·æ‰“å¼€é¡µé¢çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨éœ€è¦ç»™è¿™ä¸ªç”¨æˆ·ç”Ÿæˆä¸€ä¸ªTokenï¼Œè¯¥Tokené€šè¿‡åŠ å¯†ç®—æ³•å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œä¸€èˆ¬Tokenéƒ½åŒ…æ‹¬éšæœºå­—ç¬¦ä¸²å’Œæ—¶é—´æˆ³çš„ç»„åˆï¼Œæ˜¾ç„¶åœ¨æäº¤æ—¶Tokenä¸èƒ½å†æ”¾åœ¨Cookieä¸­äº†ï¼Œå¦åˆ™åˆä¼šè¢«æ”»å‡»è€…å†’ç”¨ã€‚å› æ­¤ï¼Œä¸ºäº†å®‰å…¨èµ·è§Tokenæœ€å¥½è¿˜æ˜¯å­˜åœ¨æœåŠ¡å™¨çš„Sessionä¸­ï¼Œä¹‹ååœ¨æ¯æ¬¡é¡µé¢åŠ è½½æ—¶ï¼Œä½¿ç”¨JSéå†æ•´ä¸ªDOMæ ‘ï¼Œå¯¹äºDOMä¸­æ‰€æœ‰çš„aå’Œformæ ‡ç­¾ååŠ å…¥Token(aæ ‡ç­¾è¯±å¯¼é“¾æ¥å‹ã€è¡¨å•ç±»å‹ã€å›¾ç‰‡src è‡ªåŠ¨å‘getè¯·æ±‚)ã€‚è¿™æ ·å¯ä»¥è§£å†³å¤§éƒ¨åˆ†çš„è¯·æ±‚</p><ol start="2"><li>é¡µé¢æäº¤çš„è¯·æ±‚æºå¸¦è¿™ä¸ªToken</li></ol><p>å¯¹äºGETè¯·æ±‚ï¼ŒTokenå°†é™„åœ¨è¯·æ±‚åœ°å€ä¹‹åï¼Œè¿™æ ·URL å°±å˜æˆ <a href="http://url?csrftoken=tokenvalueã€‚" target="_blank" rel="noopener">http://url?csrftoken=tokenvalueã€‚</a> è€Œå¯¹äº POST è¯·æ±‚æ¥è¯´ï¼Œè¦åœ¨ form çš„æœ€ååŠ ä¸Š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">â€hiddenâ€</span> <span class="attr">name</span>=<span class="string">â€csrftokenâ€</span> <span class="attr">value</span>=<span class="string">â€tokenvalueâ€/</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="3"><li>æœåŠ¡å™¨éªŒè¯Tokenæ˜¯å¦æ­£ç¡®</li></ol><p>å½“ç”¨æˆ·ä»å®¢æˆ·ç«¯å¾—åˆ°äº†Tokenï¼Œå†æ¬¡æäº¤ç»™æœåŠ¡å™¨çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨éœ€è¦åˆ¤æ–­Tokençš„æœ‰æ•ˆæ€§ï¼ŒéªŒè¯è¿‡ç¨‹æ˜¯å…ˆè§£å¯†Tokenï¼Œå¯¹æ¯”åŠ å¯†å­—ç¬¦ä¸²ä»¥åŠæ—¶é—´æˆ³ï¼Œå¦‚æœåŠ å¯†å­—ç¬¦ä¸²ä¸€è‡´ä¸”æ—¶é—´æœªè¿‡æœŸï¼Œé‚£ä¹ˆè¿™ä¸ªTokenå°±æ˜¯æœ‰æ•ˆçš„ã€‚</p><ul><li>é€šè¿‡originéªŒè¯è¯·æ±‚æ¥æºï¼š<br>æœåŠ¡å™¨æ ¹æ®httpè¯·æ±‚å¤´ä¸­çš„Originæˆ–Refererå±æ€§åˆ¤æ–­æ˜¯å¦ä¸ºå…è®¸è®¿é—®çš„ç«™ç‚¹ï¼Œä»è€Œå¯¹è¯·æ±‚è¿›è¡Œè¿‡æ»¤ã€‚ä¼˜å…ˆåˆ¤æ–­Originï¼Œå¦‚æœä¸¤ä¸ªéƒ½ä¸å­˜åœ¨çš„è¯å°±ç›´æ¥é˜»æ­¢ã€‚<ul><li>Refererï¼šè®°å½•äº†è¯·æ±‚æ˜¯ä»å“ªä¸ªé“¾æ¥è·³è¿‡æ¥çš„å¹¶ä¸”åŒ…å«äº†è·¯å¾„ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯æ¥æºåœ°å€ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½ä¼šæœ‰ã€‚ä¸è¿‡è¿™å®¶ä¼™ä¸å¤ªå¯é ï¼Œæ‰€ä»¥åæ¥åˆæ–°å¢äº†Originå±æ€§</li><li>originï¼šè®°å½•äº†åŸŸåä¿¡æ¯ï¼Œæ²¡æœ‰å…·ä½“çš„URLè·¯å¾„ï¼Œpostè¯·æ±‚æ‰ä¼šæœ‰</li></ul></li></ul><h4 id="referer-originçš„åŒºåˆ«"><a href="#referer-originçš„åŒºåˆ«" class="headerlink" title="referer originçš„åŒºåˆ«"></a>referer originçš„åŒºåˆ«</h4><p><strong>referer</strong></p><p>2.1 å®šä¹‰ï¼š</p><p>Referer é¦–éƒ¨åŒ…å«äº†å½“å‰è¯·æ±‚é¡µé¢çš„æ¥æºé¡µé¢çš„åœ°å€ï¼Œå³è¡¨ç¤ºå½“å‰é¡µé¢æ˜¯é€šè¿‡æ­¤æ¥æºé¡µé¢é‡Œçš„é“¾æ¥è¿›å…¥çš„ã€‚<br>ç»„æˆï¼šåè®®+åŸŸå+ç«¯å£å·+è·¯å¾„+å‚æ•°ï¼ˆæ³¨æ„ï¼Œä¸åŒ…å« hashå€¼ï¼‰<br>ä¾‹å­ï¼š<code>test.com:1998/home</code><br>éœ€è¦æ³¨æ„çš„æ˜¯ referer å®é™…ä¸Šæ˜¯ â€œreferrerâ€ è¯¯æ‹¼å†™ã€‚<br>åœ¨ä»¥ä¸‹å‡ ç§æƒ…å†µä¸‹ï¼ŒReferer ä¸ä¼šè¢«å‘é€ï¼š</p><ul><li>æ¥æºé¡µé¢é‡‡ç”¨çš„åè®®ä¸ºè¡¨ç¤ºæœ¬åœ°æ–‡ä»¶çš„ â€œfileâ€ æˆ–è€… â€œdataâ€ URIï¼›</li><li>å½“å‰è¯·æ±‚é¡µé¢é‡‡ç”¨çš„æ˜¯éå®‰å…¨åè®®ï¼Œè€Œæ¥æºé¡µé¢é‡‡ç”¨çš„æ˜¯å®‰å…¨åè®®ï¼ˆHTTPSï¼‰ï¼›</li><li>ç›´æ¥è¾“å…¥ç½‘å€æˆ–é€šè¿‡æµè§ˆå™¨ä¹¦ç­¾è®¿é—®ï¼›</li><li>ä½¿ç”¨ JavaScript çš„ Location.href æˆ–è€…æ˜¯ Location.replace()ï¼›</li><li>ä½¿ç”¨ html5 ä¸­ noreferrer</li></ul><p>2.2 ç”¨é€”</p><p>æœåŠ¡ç«¯ä¸€èˆ¬ä½¿ç”¨ Referer é¦–éƒ¨è¯†åˆ«è®¿é—®æ¥æºï¼Œå¯èƒ½ä¼šä»¥æ­¤è¿›è¡Œç»Ÿè®¡åˆ†æã€æ—¥å¿—è®°å½•ä»¥åŠç¼“å­˜ä¼˜åŒ–ç­‰ï¼Œè¿˜æœ‰ä¸ªå¸¸è§çš„ç”¨é€”æ˜¯å›¾ç‰‡é˜²ç›—é“¾ã€‚</p><p>é˜²ç›—é“¾åŸç†æ˜¯ï¼šå½“ç”¨æˆ·è®¿é—®ç½‘é¡µæ—¶ï¼Œrefererå°±æ˜¯å‰ä¸€ä¸ªç½‘é¡µçš„URLï¼›å¦‚æœæ˜¯å›¾ç‰‡çš„è¯ï¼Œé€šå¸¸æŒ‡çš„å°±æ˜¯å›¾ç‰‡æ‰€åœ¨çš„ç½‘é¡µã€‚å½“æµè§ˆå™¨å‘æœåŠ¡å™¨å‘é€è¯·æ±‚æ—¶ï¼Œrefererå°±è‡ªåŠ¨æºå¸¦åœ¨HTTPè¯·æ±‚å¤´äº†ã€‚ å›¾ç‰‡æœåŠ¡å™¨æ ¹æ®è¿™ä¸ªè¯·æ±‚å¤´åˆ¤æ–­ï¼Œå¦‚æœ referer ä¸æ˜¯è‡ªå·±çš„æœåŠ¡å™¨ï¼Œå°±å°†å…¶æ‹¦æˆªã€‚</p><p><strong>origin</strong></p><p>3.1 å®šä¹‰</p><p>è¯·æ±‚é¦–éƒ¨å­—æ®µ Origin æŒ‡ç¤ºäº†è¯·æ±‚æ¥è‡ªäºå“ªä¸ªç«™ç‚¹ã€‚è¯¥å­—æ®µä»…æŒ‡ç¤ºæœåŠ¡å™¨åç§°ï¼Œå¹¶ä¸åŒ…å«ä»»ä½•è·¯å¾„ä¿¡æ¯ã€‚é™¤äº†ä¸åŒ…å«è·¯å¾„ä¿¡æ¯ï¼Œè¯¥å­—æ®µä¸ Referer é¦–éƒ¨å­—æ®µç›¸ä¼¼ã€‚<br>è¯¥é¦–éƒ¨ç”¨äº CORS è¯·æ±‚æˆ–è€… POST è¯·æ±‚ã€‚</p><p>ç»„æˆï¼šåè®®+åŸŸå+ç«¯å£å·</p><p>æ³¨æ„ï¼š<strong>åªæœ‰è·¨åŸŸè¯·æ±‚ï¼ˆå¯ä»¥çœ‹åˆ° response æœ‰å¯¹åº”çš„ headerï¼šAccess-Control-Allow-Originï¼‰ï¼Œæˆ–è€…åŒåŸŸæ—¶å‘é€postè¯·æ±‚ï¼Œæ‰ä¼šæºå¸¦originè¯·æ±‚å¤´</strong>ã€‚ å¦‚æœæµè§ˆå™¨ä¸èƒ½è·å–è¯·æ±‚æºï¼Œé‚£ä¹ˆ origin æ»¡è¶³ä¸Šé¢æƒ…å†µä¹Ÿä¼šæºå¸¦ï¼Œä¸è¿‡å…¶å€¼ä¸ºnullã€‚<br>è€Œrefererä¸è®ºä½•ç§æƒ…å†µä¸‹ï¼Œåªè¦æµè§ˆå™¨èƒ½è·å–åˆ°è¯·æ±‚æºéƒ½ä¼šæºå¸¦ã€‚å¦‚æœæµè§ˆå™¨å¦‚æœä¸èƒ½è·å–è¯·æ±‚æºï¼Œé‚£ä¹ˆè¯·æ±‚å¤´ä¸­ä¸ä¼šæºå¸¦refererã€‚</p><p>3.2 ç”¨é€”</p><p>ç”¨äº CORS: å½“æˆ‘ä»¬çš„æµè§ˆå™¨å‘å‡ºè·¨ç«™è¯·æ±‚æ—¶ï¼ŒæœåŠ¡å™¨ä¼šæ ¡éªŒå½“å‰è¯·æ±‚æ˜¯ä¸æ˜¯æ¥è‡ªè¢«å…è®¸çš„ç«™ç‚¹ã€‚æœåŠ¡å™¨å°±æ˜¯é€šè¿‡ Origin å­—æ®µçš„å€¼æ¥è¿›è¡Œåˆ¤æ–­ã€‚</p><h5 id="ä¸¤è€…çš„åŒºåˆ«"><a href="#ä¸¤è€…çš„åŒºåˆ«" class="headerlink" title="ä¸¤è€…çš„åŒºåˆ«"></a>ä¸¤è€…çš„åŒºåˆ«</h5><p>1ã€åªæœ‰è·¨åŸŸè¯·æ±‚ï¼Œæˆ–è€…åŒåŸŸæ—¶å‘é€postè¯·æ±‚ï¼Œæ‰ä¼šæºå¸¦originè¯·æ±‚å¤´ï¼Œè€Œrefererä¸è®ºä½•ç§æƒ…å†µä¸‹ï¼Œåªè¦æµè§ˆå™¨èƒ½è·å–åˆ°è¯·æ±‚æºéƒ½ä¼šæºå¸¦ï¼Œé™¤äº†ä¸Šé¢æåˆ°çš„å‡ ç§æƒ…å†µã€‚</p><p>2ã€ referrer å­˜åœ¨å¾ˆå¤šé—®é¢˜ã€‚æ¯”å¦‚è¯´åœ¨è¯·æ±‚å¤–éƒ¨ç½‘ç«™çš„æ—¶å€™ï¼Œæºå¸¦ç€ url çš„å¾ˆå¤šå‚æ•°ä¿¡æ¯ï¼Œè€Œè¿™äº›ä¿¡æ¯å®é™…ä¸Šæ˜¯éšç§çš„ï¼Œæ‰€ä»¥å­˜åœ¨ä¸€å®šçš„éšç§æš´éœ²é£é™©ã€‚  origin å°±ä¸å­˜åœ¨è¿™ç§éšç§é—®é¢˜ã€‚æ¯”å¦‚ï¼šURLä¸Šæºå¸¦æœ‰tokenç­‰èº«ä»½ä¿¡æ¯æ—¶ï¼Œæ”»å‡»è€…å°±å¯ä»¥ç›—å–ç”¨æˆ·tokenè¿›è¡Œæ”»å‡»ã€‚é™¤æ­¤ä¹‹å¤– ç‚¹å‡»aæ ‡ç­¾çš„æ—¶å€™ä¹Ÿä¼šæºå¸¦refererï¼š<br>aæ ‡ç­¾å¯èƒ½æ³„éœ²ä½ çš„ç«™ç‚¹é“¾æ¥ï¼Œæ‰€ä»¥é¡¹ç›®ä¸­åŒ…å«è·¨åŸŸé“¾æ¥æ—¶æœ€å¥½åšä¸€äº›å¤„ç†ï¼Œå¦‚<code>&lt;a href=&quot;http://example.com&quot; referrerpolicy=&quot;origin&quot;&gt;</code>,<code>&lt;a href=&quot;http://example.com&quot; rel=&quot;noreferrer&quot;&gt;ï¼Œ</code>è¿™ä¸¤ç§æ–¹æ³•éƒ½é™åˆ¶äº†Refererå¤´éƒ¨çš„å‘é€ï¼Œä½ ä¹Ÿå¯ä»¥ç›´æ¥æ·»åŠ metaæ ‡ç­¾å…¨å±€è®¾ç½®Refererå‘é€ç­–ç•¥<meta name="referrer" content="origin"></p><ul><li>åŒé‡éªŒè¯Cookieï¼š</li></ul><p>åˆ©ç”¨æ”»å‡»è€…åªèƒ½åˆ©ç”¨Cookieï¼Œä¸èƒ½è·å–Cookieçš„ç‰¹ç‚¹ï¼Œç”¨æˆ·è®¿é—®é¡µé¢æ—¶ï¼ŒæœåŠ¡å™¨å‘è¯·æ±‚åŸŸåæ·»åŠ ä¸€ä¸ªCookieéšæœºå­—ç¬¦ä¸²ï¼Œç„¶åï¼Œç”¨æˆ·å†æ¬¡è¯·æ±‚æ—¶ä»Cookieä¸­å–å‡ºè¿™ä¸ªå­—ç¬¦ä¸²ï¼Œæ·»åŠ åˆ°URLå‚æ•°ä¸­ï¼Œç„¶åæœåŠ¡å™¨é€šè¿‡å¯¹Cookieä¸­çš„æ•°æ®å’Œå‚æ•°ä¸­çš„æ•°æ®å¯¹æ¯”éªŒè¯ï¼Œä¸ä¸€æ ·å°±æ‹’ç»è¯·æ±‚ã€‚ç¼ºç‚¹æ˜¯å¦‚æœç½‘ç«™å­˜åœ¨XSSæ¼æ´ï¼Œè¿™æ³•å­å°±ä¼šå¤±æ•ˆï¼Œè€Œä¸”ä¸èƒ½åšåˆ°å­åŸŸåçš„éš”ç¦»</p><ul><li>é€šè¿‡éªŒè¯ç å’Œå¯†ç çš„æ–¹å¼ç¡®ä¿æ˜¯çœŸå®ç”¨æˆ·</li></ul><h3 id="ä¸­é—´äººæ”»å‡»"><a href="#ä¸­é—´äººæ”»å‡»" class="headerlink" title="ä¸­é—´äººæ”»å‡»"></a>ä¸­é—´äººæ”»å‡»</h3><p>ä¸­é—´äººæ”»å‡»ï¼ˆMITMï¼‰æ˜¯æŒ‡æ”»å‡»è€…ä¸é€šè®¯çš„ä¸¤ç«¯åˆ†åˆ«åˆ›å»ºç‹¬ç«‹çš„è”ç³»ï¼Œå¹¶äº¤æ¢å…¶æ‰€æ”¶åˆ°çš„æ•°æ®ï¼Œä½¿é€šè®¯çš„ä¸¤ç«¯è®¤ä¸ºä»–ä»¬æ­£åœ¨é€šè¿‡ä¸€ä¸ªç§å¯†çš„è¿æ¥ä¸å¯¹æ–¹ç›´æ¥å¯¹è¯ï¼Œä½†äº‹å®ä¸Šæ•´ä¸ªä¼šè¯éƒ½è¢«æ”»å‡»è€…å®Œå…¨æ§åˆ¶ã€‚ä¸­é—´äººæ”»å‡»å¸¸è§çš„æ–¹å¼æœ‰ï¼šWi-Fiæ¬ºéª—ã€HTTPSæ¬ºéª—ã€SSLåŠ«æŒã€DNSæ¬ºéª—ã€ç”µå­é‚®ä»¶åŠ«æŒç­‰</p><h4 id="å¦‚ä½•é˜²èŒƒ"><a href="#å¦‚ä½•é˜²èŒƒ" class="headerlink" title="å¦‚ä½•é˜²èŒƒ"></a>å¦‚ä½•é˜²èŒƒ</h4><ul><li><p>ä½¿ç”¨HTTPSåè®®ï¼šHTTPSåè®®å¯ä»¥é˜²æ­¢åŸºæœ¬çš„ä¸­é—´äººæ”»å‡»ã€‚å½“ç„¶ï¼Œæ”»å‡»è€…ä¹Ÿä¼šé€šè¿‡å¤šç§æ–¹æ³•ï¼Œæ¥ç ´åHTTPSï¼Œè¿›è€Œæ¶ˆé™¤åŠ å¯†çš„å®‰å…¨æ€§ã€‚ä¾‹å¦‚ï¼ŒSSLStripç±»å‹çš„ä¸­é—´äººæ”»å‡»ï¼Œä¼šå¼ºåˆ¶å°†æµè§ˆå™¨â€œå¡â€åœ¨æ—§çš„HTTPæ¨¡å¼ã€‚å¯¹æ­¤ï¼Œæ‚¨å¯ä»¥é€šè¿‡ç»†å¿ƒè§‚å¯Ÿæµè§ˆå™¨çš„åœ°å€æ ï¼Œæ˜¯å¦å¸¦æœ‰çº¢å‰æˆ–æƒŠå¹å·çš„é€šçŸ¥ï¼Œä»¥å‘ç°ã€‚</p></li><li><p>ä½¿ç”¨VPNï¼šVPNæ˜¯ä¸€ç§è™šæ‹Ÿä¸“ç”¨ç½‘ç»œï¼Œå¯ä»¥åœ¨å…¬å…±ç½‘ç»œä¸Šå»ºç«‹ä¸€ä¸ªç§æœ‰ç½‘ç»œã€‚VPNå¯ä»¥åŠ å¯†æ•°æ®ä¼ è¾“ï¼Œä»è€Œé˜²æ­¢ä¸­é—´äººæ”»å‡»ã€‚</p></li><li><p>ä½¿ç”¨æ•°å­—è¯ä¹¦ï¼šæ•°å­—è¯ä¹¦æ˜¯ä¸€ç§ç”¨äºéªŒè¯èº«ä»½çš„ç”µå­è¯ä¹¦ã€‚ä½¿ç”¨æ•°å­—è¯ä¹¦å¯ä»¥é˜²æ­¢ä¸­é—´äººæ”»å‡»ã€‚</p></li><li><p>ä¸è¦ä½¿ç”¨å…¬å…±Wi-Fiï¼šå…¬å…±Wi-Fiå¾ˆå®¹æ˜“è¢«é»‘å®¢åˆ©ç”¨è¿›è¡Œä¸­é—´äººæ”»å‡»ã€‚æ‰€ä»¥å°½é‡ä¸è¦ä½¿ç”¨å…¬å…±Wi-Fi123ã€‚</p></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> æµè§ˆå™¨å®‰å…¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>reactæ€§èƒ½ä¼˜åŒ–</title>
      <link href="/ashley271017.github.io/2020/02/23/react%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"/>
      <url>/ashley271017.github.io/2020/02/23/react%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<h2 id="å‡å°‘æ¸²æŸ“çš„èŠ‚ç‚¹-é™ä½æ¸²æŸ“è®¡ç®—é‡"><a href="#å‡å°‘æ¸²æŸ“çš„èŠ‚ç‚¹-é™ä½æ¸²æŸ“è®¡ç®—é‡" class="headerlink" title="å‡å°‘æ¸²æŸ“çš„èŠ‚ç‚¹/é™ä½æ¸²æŸ“è®¡ç®—é‡"></a>å‡å°‘æ¸²æŸ“çš„èŠ‚ç‚¹/é™ä½æ¸²æŸ“è®¡ç®—é‡</h2><p>0ï¸âƒ£ ä¸è¦åœ¨æ¸²æŸ“å‡½æ•°é‡Œé¢è¿›è¡Œä¸å¿…è¦çš„è®¡ç®—</p><p>1ï¸âƒ£ å‡å°‘ä¸å¿…è¦çš„åµŒå¥—<br>ä¸€èˆ¬ä¸å¿…è¦çš„èŠ‚ç‚¹åµŒå¥—éƒ½æ˜¯æ»¥ç”¨é«˜é˜¶ç»„ä»¶/RenderProps å¯¼è‡´çš„ æœ‰å¾ˆå¤šç§æ–¹å¼æ¥ä»£æ›¿é«˜é˜¶ç»„ä»¶/RenderPropsï¼Œä¾‹å¦‚ä¼˜å…ˆä½¿ç”¨ propsã€React Hooks</p><p>2ï¸âƒ£ è™šæ‹Ÿåˆ—è¡¨<br>å®ç°æ–¹æ¡ˆï¼š<br>1.intersectionobserveråªæ¸²æŸ“åœ¨å¯è§†åŒºçš„å†…å®¹<br>åªè§‚å¯Ÿç¬¬ä¸€ä¸ªè·Ÿæœ€åä¸€ä¸ªå…ƒç´ ï¼Œæ¯”å¦‚ä¸€ä¸ªlistï¼Œå½“æœ€åä¸€ä¸ªå…ƒç´ è¿›å…¥å¯è§†åŒºçš„æ—¶å€™ï¼Œæ¸²æŸ“çš„ç¬¬ä¸€ä¸ªå…ƒç´ å˜æˆæœ€åä¸€ä¸ªå…ƒç´ çš„ä¸‹ä¸€ä¸ªå…ƒç´ <br>2.æ»šåŠ¨åŠ è½½</p><p>3ï¸âƒ£ æƒ°æ€§åŠ è½½</p><h2 id="ç²¾ç»†åŒ–æ¸²æŸ“"><a href="#ç²¾ç»†åŒ–æ¸²æŸ“" class="headerlink" title="ç²¾ç»†åŒ–æ¸²æŸ“"></a>ç²¾ç»†åŒ–æ¸²æŸ“</h2><ul><li>ç®€åŒ– props<br>â‘  å¦‚æœä¸€ä¸ªç»„ä»¶çš„ props å¤ªå¤æ‚ä¸€èˆ¬æ„å‘³ç€è¿™ä¸ªç»„ä»¶å·²ç»è¿èƒŒäº†â€˜å•ä¸€èŒè´£â€™ï¼Œé¦–å…ˆåº”è¯¥å°è¯•å¯¹ç»„ä»¶è¿›è¡Œæ‹†è§£.<br>â‘¡ å¦å¤–å¤æ‚çš„ props ä¹Ÿä¼šå˜å¾—éš¾ä»¥ç»´æŠ¤, æ¯”å¦‚ä¼šå½±å“shallowCompareæ•ˆç‡, è¿˜ä¼šè®©ç»„ä»¶çš„å˜åŠ¨å˜å¾—éš¾ä»¥é¢„æµ‹å’Œè°ƒè¯•.</li></ul><h2 id="hooksä¼˜åŒ–"><a href="#hooksä¼˜åŒ–" class="headerlink" title="hooksä¼˜åŒ–"></a>hooksä¼˜åŒ–</h2><ul><li>useStateåˆå§‹åŒ–æƒ°æ€§å‡½æ•°<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function Table(props) &#123;</span><br><span class="line">  // âš ï¸ createRows() æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šè¢«è°ƒç”¨</span><br><span class="line">  const [rows, setRows] = useState(createRows(props.count));</span><br><span class="line">  // ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>ä¸ºé¿å…é‡æ–°åˆ›å»ºè¢«å¿½ç•¥çš„åˆå§‹ stateï¼Œæˆ‘ä»¬å¯ä»¥ä¼ ä¸€ä¸ª å‡½æ•° ç»™ useStateï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function Table(props) &#123;</span><br><span class="line">  // âœ… createRows() åªä¼šè¢«è°ƒç”¨ä¸€æ¬¡</span><br><span class="line">  const [rows, setRows] = useState(() =&gt; createRows(props.count));</span><br><span class="line">  // ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“<code>initialState</code>ä»¥å‡½æ•°å½¢å¼ä¼ å…¥æ—¶ï¼Œå®ƒåªä¼šåœ¨å‡½æ•°ç»„ä»¶åˆå§‹åŒ–çš„æ—¶å€™æ‰§è¡Œä¸€æ¬¡ï¼Œå‡½æ•°<code>re-render</code>æ—¶ä¸ä¼šå†è¢«æ‰§è¡Œ</p><p>ä»¥ä¸Šå°šå¾…è€ƒç©¶ï¼›</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useState(props.value)</span><br></pre></td></tr></table></figure><p>å¹¶ä¸ä¼šéšç€propsçš„å˜åŒ–è€Œå˜åŒ–ï¼Œ<strong>åˆå§‹åŒ–å€¼åªä¼šåˆå§‹ä¸€æ¬¡,åŒæ ·çš„<code>useRef</code>ä¹Ÿæ˜¯ä¸€æ ·</strong></p><h2 id="ä¼˜åŒ–key"><a href="#ä¼˜åŒ–key" class="headerlink" title="ä¼˜åŒ–key"></a>ä¼˜åŒ–key</h2><p>é™¤äº†ä»¥ä¸‹çš„æƒ…å†µä¸ä½¿ç”¨<code>index</code>ä½œä¸ºkey:<br>åˆ—è¡¨çš„é‡æ–°æ’åºï¼Œå¢åˆ ï¼Œè¿‡æ»¤ä¸ä¼šå‘ç”Ÿ</p><h2 id="å‡å°‘re-render"><a href="#å‡å°‘re-render" class="headerlink" title="å‡å°‘re-render"></a>å‡å°‘re-render</h2><h3 id="å“ªäº›åŸå› ä¼šå¯¼è‡´rerender"><a href="#å“ªäº›åŸå› ä¼šå¯¼è‡´rerender" class="headerlink" title="å“ªäº›åŸå› ä¼šå¯¼è‡´rerender"></a>å“ªäº›åŸå› ä¼šå¯¼è‡´rerender</h3><ul><li><p>çŠ¶æ€æ›´æ”¹</p><ul><li>å½“ç»„ä»¶çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå®ƒå°†é‡æ–°æ¸²æŸ“è‡ªèº«ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç±»ç»„ä»¶çš„stateè¢«é‡å¤è®¾ç½®æˆåŒä¸€ä¸ªå€¼ä¼šå¯¼è‡´é‡æ–°æ¸²æŸ“ï¼Œä½†æ˜¯å‡½æ•°ç»„ä»¶ä¸ä¼šã€‚</li></ul></li><li><p>çˆ¶çº§ï¼ˆæˆ–å­çº§ï¼‰é‡æ–°æ¸²æŸ“</p><p><code>æ³¨æ„æ˜¯çˆ¶ç»„ä»¶çš„é‡æ–°æ¸²æŸ“è§¦å‘äº†å­ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ï¼Œä¸å­ç»„ä»¶çš„ props æ˜¯å¦å˜åŒ–æ— å…³ã€‚åªæœ‰é‚£äº›ä½¿ç”¨äº† React.memo å’Œ useMemo çš„ç»„ä»¶ï¼Œprops çš„å˜åŒ–æ‰ä¼šè§¦å‘ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ã€‚</code></p></li><li><p>context å˜åŒ–</p></li><li><p>hooks å˜åŒ–ã€‚</p><ul><li>hooks å†…éƒ¨çš„çŠ¶æ€å˜åŒ–ä¼šè§¦å‘ç»„ä»¶çš„ re-render</li><li>å¦‚æœ hooks ä½¿ç”¨äº† contextï¼Œå¹¶ä¸” context çš„å€¼å‘ç”Ÿäº†å˜åŒ–ï¼Œä¹Ÿä¼šè§¦å‘ç»„ä»¶çš„ re-render</li></ul></li></ul><h3 id="æ€ä¹ˆé¿å…re-render"><a href="#æ€ä¹ˆé¿å…re-render" class="headerlink" title="æ€ä¹ˆé¿å…re-render"></a>æ€ä¹ˆé¿å…re-render</h3><ul><li><p>é¿å…åœ¨ render å‡½æ•°ä¸­åˆ›å»ºç»„ä»¶ï¼ŒåŸå› å¦‚ä¸‹ï¼š<br><strong>åœ¨æ¯æ¬¡é‡æ–°æ¸²æŸ“æ—¶ï¼ŒReact éƒ½ä¼šé‡æ–°è£…è½½è¿™ä¸ªç»„ä»¶ï¼ˆå³é”€æ¯å®ƒå¹¶ä»å¤´å¼€å§‹é‡æ–°åˆ›å»ºï¼‰</strong>ï¼Œè¿™æ¯”æ­£å¸¸çš„é‡æ–°æ¸²æŸ“è¦æ…¢å¾—å¤šã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜ä¼šå¯¼è‡´ä»¥ä¸‹é—®é¢˜ï¼š</p><ul><li>åœ¨é‡æ–°æ¸²æŸ“æœŸé—´å¯èƒ½å‡ºç°å†…å®¹ â€œé—ªçƒâ€</li><li>æ¯æ¬¡é‡æ–°æ¸²æŸ“æ—¶åœ¨ç»„ä»¶çš„çŠ¶æ€ä¼šè¢«é‡ç½®</li><li>æ¯æ¬¡é‡æ–°æ¸²æŸ“æ—¶ä¸ä¼šè§¦å‘ä¾èµ–é¡¹çš„ useEffect</li><li>å¦‚æœç»„ä»¶è¢«èšç„¦ï¼Œåˆ™ç„¦ç‚¹å°†ä¸¢å¤±</li></ul></li><li><p>state ä¸‹ç§»åˆ°å­ç»„ä»¶ä¸­</p></li><li><p>ç»„ä»¶ä½œä¸º props</p></li></ul><p>ä¸å‰é¢çš„æ¨¡å¼åŸºæœ¬ç›¸åŒï¼Œå°†çŠ¶æ€å°è£…åœ¨ä¸€ä¸ªè¾ƒå°çš„ç»„ä»¶ä¸­ï¼Œè€Œè¾ƒé‡çš„ç»„ä»¶ä½œä¸º props ä¼ é€’ç»™å®ƒã€‚props ä¸å— state å˜åŒ–çš„å½±å“ï¼Œå› æ­¤è¯¥è¾ƒé‡çš„ç»„ä»¶ä¸ä¼šè¢«é‡æ–°æ¸²æŸ“</p><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1e82916e4080487cb35fbdfc01e8737b~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p><ul><li>ä½¿ç”¨ React.memo</li></ul><h3 id="å¸¸è§è¯¯åŒº"><a href="#å¸¸è§è¯¯åŒº" class="headerlink" title="å¸¸è§è¯¯åŒº"></a>å¸¸è§è¯¯åŒº</h3><ul><li>æ— ç”¨çš„ useMemo/useCallback props<br>å°†å­ç»„ä»¶çš„ props åŒ…è£…æˆ memoize å€¼ï¼Œæ˜¯ä¸èƒ½é¿å…è¯¥å­ç»„ä»¶é‡æ–°æ¸²æŸ“çš„ã€‚<code>åªè¦çˆ¶ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼Œé‚£ä¹ˆå­ç»„ä»¶å°±ä¼šè¢«é‡æ–°æ¸²æŸ“</code>ï¼Œä¸ props æ²¡æœ‰å…³ç³»ã€‚è¿™ä¸ªæ—¶å€™å°±éœ€è¦ç”¨åˆ°<strong>React.Memo</strong>äº†</li></ul><p>é”™è¯¯åšæ³•</p><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e159c1e90da8429d9f8aa2369239199f~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p><p>æ­£ç¡®åšæ³•</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4e7ed302cbd0400f9e6f35cc97bd734f~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p><ul><li>æ­£ç¡®ä½¿ç”¨key<br>å¦‚æœåˆ—è¡¨é¡¹æ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œçˆ¶ç»„ä»¶é‡æ–°æ¸²æŸ“äº†,ä»…ä»…è®¾ç½® key å€¼å¹¶ä¸ä¼šæé«˜åˆ—è¡¨çš„æ€§èƒ½ã€‚ä¸ºäº†é¿å…åˆ—è¡¨å…ƒç´ çš„é‡æ–°æ¸²æŸ“ï¼Œè¿˜è¦ç”¨ React.memo åŒ…è£…å®ƒä»¬</li></ul><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e011f1d7d3c24a46955acf2e3b8c741c~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p><ul><li>é¿å… Context å¼•èµ· re-render<ul><li>å°† Provider çš„å€¼åš memoize å¤„ç†</li></ul></li></ul><p>å¦‚æœ Context Provider æ²¡æœ‰åœ¨é¡µé¢çš„æ ¹èŠ‚ç‚¹ä¸Šï¼Œ<code>é‚£ä¹ˆç¥–å…ˆèŠ‚ç‚¹çš„å˜åŒ–ä¹Ÿä¼šå¯¼è‡´å®ƒè¢«é‡æ–°æ¸²æŸ“</code>ï¼Œæ‰€ä»¥å®ƒçš„å€¼ä¹Ÿåº”è¯¥è¢« memoizeã€‚</p><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/89b6d479a20e40bb83169a1ff24405b1~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p><ul><li>å¯¹æ•°æ®å’Œ API åšæ‹†åˆ†</li></ul><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/27f94c617ba4495e947321118d6df6b6~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p><ul><li><p>@rematch/core<br>ä½¿ç”¨æ—¶ï¼šuseContextï¼Œæ— éœ€åœ¨æ ¹ç»„ä»¶åŒ…è£¹storeï¼Œåªéœ€è¦</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">init(&#123; <span class="attr">models</span>: &#123; global &#125; &#125;);</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨<code>createPortal</code>åˆ›å»ºçš„ç»„ä»¶Aï¼Œæ’å…¥åˆ°ä¸€ä¸ªdomèŠ‚ç‚¹ï¼ŒdomèŠ‚ç‚¹æ‰€åœ¨çš„ç»„ä»¶è¢«é‡æ–°æ¸²æŸ“çš„è¯ï¼Œæ˜¯ä¸ä¼šå¼•å‘ç»„ä»¶Açš„é‡æ–°æ¸²æŸ“çš„ã€‚</li></ul><h3 id="contextä¼˜åŒ–"><a href="#contextä¼˜åŒ–" class="headerlink" title="contextä¼˜åŒ–"></a>contextä¼˜åŒ–</h3></li><li><p>æ‹†åˆ†context</p></li><li><p>useMemo React.memoåšç¼“å­˜</p></li><li><p>å€Ÿé‰´reduxçš„<strong>å‘å¸ƒè®¢é˜…</strong>æ¨¡å¼</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// provider</span></span><br><span class="line"><span class="keyword">const</span> Provider = <span class="function">(<span class="params">&#123; children &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [store, dispatch] = useReducer(reducer, initState);</span><br><span class="line">  <span class="keyword">const</span> storeRef = useRef(<span class="literal">null</span>);</span><br><span class="line">  storeRef.current = store;</span><br><span class="line">  <span class="comment">// è®¢é˜…æ‰€æœ‰å­ç»„ä»¶æ›´æ–°çš„å›è°ƒå‡½æ•°</span></span><br><span class="line">  <span class="keyword">const</span> subscribeRef = useRef([]);</span><br><span class="line">  <span class="comment">// storeå˜åŒ–çš„æ—¶å€™æ‰§è¡Œæ‰€æœ‰çš„ç›‘å¬å‡½æ•°</span></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    subscribeRef.current.forEach(<span class="function">(<span class="params">sub</span>) =&gt;</span> sub());</span><br><span class="line">  &#125;, [store]);</span><br><span class="line">  <span class="comment">// ç¼“å­˜value åˆ©ç”¨refæ‹¿åˆ°æœ€æ–°çš„çŠ¶æ€</span></span><br><span class="line">  <span class="keyword">const</span> value = useMemo(</span><br><span class="line">    () =&gt; (&#123;</span><br><span class="line">      dispatch,</span><br><span class="line">      subscribe: <span class="function">(<span class="params">cb</span>) =&gt;</span> &#123;</span><br><span class="line">        subscribeRef.current.push(cb);</span><br><span class="line">        <span class="comment">// return unsubscribe</span></span><br><span class="line">        <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          subscribeRef.current = subscribeRef.current.filter(</span><br><span class="line">            (item) =&gt; item !== cb</span><br><span class="line">          );</span><br><span class="line">        &#125;;</span><br><span class="line">      &#125;,</span><br><span class="line">      getState: <span class="function"><span class="params">()</span> =&gt;</span> storeRef.current,</span><br><span class="line">    &#125;),</span><br><span class="line">    []</span><br><span class="line">  );</span><br><span class="line">  <span class="comment">// valueæ­¤åéƒ½ä¸ä¼šå˜åŒ–äº† åªæœ‰storeå˜åŒ– storeå˜åŒ–çš„æ—¶å€™é€šçŸ¥æ‰€æœ‰çš„æ¶ˆè´¹è€…</span></span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">MyContext.Provider</span> <span class="attr">value</span>=<span class="string">&#123;value&#125;</span> <span class="attr">children</span>=<span class="string">&#123;children&#125;</span> /&gt;</span>;</span></span><br><span class="line"><span class="xml">&#125;;</span></span><br><span class="line"><span class="xml">// useSelector</span></span><br><span class="line"><span class="xml">export const useSelector = (selector) =&gt; &#123;</span></span><br><span class="line"><span class="xml">  const [, forceRender] = useReducer((s) =&gt; s + 1, 0);</span></span><br><span class="line"><span class="xml">  const store = useContext(Mycontext);</span></span><br><span class="line"><span class="xml">  // è·å–state</span></span><br><span class="line"><span class="xml">  const selectedStateRef = useRef(null);</span></span><br><span class="line"><span class="xml">  selectedStateRef.current = selector(store.getState());</span></span><br><span class="line"><span class="xml">  // æ›´æ–°å›è°ƒ å¯¹æ¯”æ›´æ–°åçš„state</span></span><br><span class="line"><span class="xml">  const checkUpdates = useCallback(() =&gt; &#123;</span></span><br><span class="line"><span class="xml">    const newState = selector(store.getState());</span></span><br><span class="line"><span class="xml">    if (newState !== selectedStateRef.current) &#123;</span></span><br><span class="line"><span class="xml">      forceRender();</span></span><br><span class="line"><span class="xml">    &#125;</span></span><br><span class="line"><span class="xml">  &#125;, []);</span></span><br><span class="line"><span class="xml">  // mountedçš„æ—¶å€™è®¢é˜…store</span></span><br><span class="line"><span class="xml">  useEffect(() =&gt; &#123;</span></span><br><span class="line"><span class="xml">    const unsubscribe = store.subscribe(checkUpdates);</span></span><br><span class="line"><span class="xml">    // å¸è½½çš„æ—¶å€™å–æ¶ˆè®¢é˜…</span></span><br><span class="line"><span class="xml">    return unsubscribe;</span></span><br><span class="line"><span class="xml">  &#125;, [store, checkUpdates]);</span></span><br><span class="line"><span class="xml">  // è¿”å›æœ€æ–°çš„state</span></span><br><span class="line"><span class="xml">  return selectedStateRef.current;</span></span><br><span class="line"><span class="xml">&#125;;</span></span><br></pre></td></tr></table></figure></li></ul><p>useDispatch<br><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/83c2ec24184d4ea7a2964c75b2117992~tplv-k3u1fbpfcp-watermark.image?" alt="æˆªå±2022-11-15 ä¸Šåˆ11.46.36.png"><br>ä½¿ç”¨ï¼š</p><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9ec27461dd414a7a8fbdc86c902a2726~tplv-k3u1fbpfcp-watermark.image?" alt="æˆªå±2022-11-15 ä¸Šåˆ11.50.30.png"></p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li>(ä¸€ä»½è¯¦å°½çš„ React re-render æŒ‡å—)[<a href="https://mp.weixin.qq.com/s/SH7N2f5ZhUhysQ7_G2s9rQ]" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/SH7N2f5ZhUhysQ7_G2s9rQ]</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> react </tag>
            
            <tag> æ€§èƒ½ä¼˜åŒ– </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>webpackæ„å»ºé€Ÿåº¦ä¼˜åŒ–</title>
      <link href="/ashley271017.github.io/2020/02/13/webpack%E6%9E%84%E5%BB%BA%E9%80%9F%E5%BA%A6%E4%BC%98%E5%8C%96/"/>
      <url>/ashley271017.github.io/2020/02/13/webpack%E6%9E%84%E5%BB%BA%E9%80%9F%E5%BA%A6%E4%BC%98%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<h3 id="webpackæ‰“åŒ…åŸç†å›é¡¾"><a href="#webpackæ‰“åŒ…åŸç†å›é¡¾" class="headerlink" title="webpackæ‰“åŒ…åŸç†å›é¡¾"></a>webpackæ‰“åŒ…åŸç†å›é¡¾</h3><ul><li>è§£æå…¥å£æ–‡ä»¶ï¼šWebpack ä¼šä»é…ç½®æ–‡ä»¶ä¸­è¯»å–å…¥å£æ–‡ä»¶çš„è·¯å¾„ï¼Œç„¶åè§£æå…¥å£æ–‡ä»¶ï¼Œå¦‚æœå…¥å£æ–‡ä»¶å¼•å…¥äº†åˆ«çš„æ–‡ä»¶ï¼Œwebpackå°±è¦å…ˆå°†è¿™äº›æ–‡ä»¶ä¸€ä¸ªä¸€ä¸ªçš„è¯»å–å®Œæ¯•ï¼Œå½“ç„¶è¯»å–çš„ä»£ç é‡Œé¢å¯èƒ½æœ‰htmlã€cssç­‰æ ¼å¼ï¼Œæ‰€ä»¥webpackä¼šåˆ©ç”¨ä¸€äº›loaderå°†è¿™äº›æ ¼å¼è½¬æ¢æˆjsæ ¼å¼ï¼Œç”Ÿæˆä¸€ä¸ªæŠ½è±¡è¯­æ³•æ ‘</li><li>åŠ è½½æ¨¡å—ï¼šWebpack ä¼šæ ¹æ®ä¾èµ–å›¾ä¸­çš„ä¿¡æ¯ï¼Œé€’å½’åœ°åŠ è½½æ‰€æœ‰éœ€è¦çš„æ¨¡å—ã€‚å¯¹äºæ¯ä¸ªæ¨¡å—ï¼ŒWebpack ä¼šæ ¹æ®å…¶ç±»å‹ï¼ˆä¾‹å¦‚ JavaScriptã€CSSã€å›¾ç‰‡ç­‰ï¼‰ä½¿ç”¨ç›¸åº”çš„ loader è¿›è¡Œè½¬æ¢å’Œå¤„ç†ã€‚ </li><li>åˆ†ææ¨¡å—é—´çš„ä¾èµ–å…³ç³»ï¼šWebpack ä¼šåˆ†ææ¯ä¸ªæ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œå¹¶ç”Ÿæˆä¸€å¼ ä¾èµ–å›¾è°±ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼ŒWebpack ä¼šç¡®å®šæ¯ä¸ªæ¨¡å—çš„æ‰§è¡Œé¡ºåºï¼Œå¹¶åˆ›å»ºä¸€ä¸ª chunkã€‚ </li><li>ç”Ÿæˆè¾“å‡ºæ–‡ä»¶ï¼šæœ€åï¼ŒWebpack ä¼šæ ¹æ® chunk çš„ä¿¡æ¯ï¼Œç”Ÿæˆä¸€ä¸ªæˆ–å¤šä¸ªè¾“å‡ºæ–‡ä»¶ã€‚è¾“å‡ºæ–‡ä»¶å¯ä»¥æ˜¯ JavaScript æ–‡ä»¶ã€CSS æ–‡ä»¶ã€å›¾ç‰‡æ–‡ä»¶ç­‰ã€‚<br>å…³æ³¨åˆ°ä¸Šé¢çš„è¿‡ç¨‹ï¼Œå¯ä»¥å‘ç°ä¸»è¦ä¼˜åŒ–çš„å°±æ˜¯ç¬¬äºŒæ­¥ä»¥åŠç¬¬ä¸‰æ­¥<h4 id="æ‹†åˆ†å¤šå…¥å£"><a href="#æ‹†åˆ†å¤šå…¥å£" class="headerlink" title="æ‹†åˆ†å¤šå…¥å£"></a>æ‹†åˆ†å¤šå…¥å£</h4>webpackå¯¹äºå•å…¥å£æ–‡ä»¶ï¼Œæ¯ä¸ªå…¥å£æ–‡ä»¶æŠŠè‡ªå·±æ‰€ä¾èµ–çš„èµ„æºå…¨éƒ¨æ‰“åŒ…åˆ°ä¸€èµ·ï¼Œå³ä½¿ä¸€ä¸ªèµ„æºå¾ªç¯åŠ è½½çš„è¯ï¼Œä¹Ÿåªä¼šæ‰“åŒ…ä¸€ä»½ï¼Œå› æ­¤å¦‚æœæ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤§çš„åº”ç”¨çš„è¯ï¼Œå¯ä»¥æ‹†åˆ†æˆå¤šä¸ªå…¥å£ï¼Œè¿™é‡Œæ‹†åˆ†å¯ä»¥æ˜¯æŒ‰ç…§é¡µé¢æ‹†åˆ†æˆ–è€…ã€‚ã€‚ã€‚<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">entry: &#123;</span><br><span class="line">    minivideo: <span class="string">'src/pages/miniVideo/index.jsx'</span>,</span><br><span class="line">    minivideoHome: <span class="string">'src/pages/home/index.jsx'</span>,</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="æå–å…¬å…±åŒ…"><a href="#æå–å…¬å…±åŒ…" class="headerlink" title="æå–å…¬å…±åŒ…"></a>æå–å…¬å…±åŒ…</h4><p>ä¸€ä¸ªå¤šé¡µé¢åº”ç”¨ï¼Œå¦‚æœæ‰€æœ‰çš„é¡µé¢éƒ½ä¾èµ–äºä¸€æ ·çš„åŸºç¡€åº“ï¼Œé‚£å¦‚æœæ‰€æœ‰çš„entryéƒ½åŒ…å«æœ‰åŸºç¡€åº“çš„ä»£ç å°±ä¼šé€ æˆæµªè´¹</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">"html-webpack-plugin"</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// å•å…¥å£</span></span><br><span class="line">  <span class="comment">// entry: './src/main.js',</span></span><br><span class="line">  <span class="comment">// å¤šå…¥å£</span></span><br><span class="line">  entry: &#123;</span><br><span class="line">    main: <span class="string">"./src/main.js"</span>,</span><br><span class="line">    app: <span class="string">"./src/app.js"</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">"./dist"</span>),</span><br><span class="line">    <span class="comment">// [name]æ˜¯webpackå‘½åè§„åˆ™ï¼Œä½¿ç”¨chunkçš„nameä½œä¸ºè¾“å‡ºçš„æ–‡ä»¶åã€‚</span></span><br><span class="line">    <span class="comment">// ä»€ä¹ˆæ˜¯chunkï¼Ÿæ‰“åŒ…çš„èµ„æºå°±æ˜¯chunkï¼Œè¾“å‡ºå‡ºå»å«bundleã€‚</span></span><br><span class="line">    <span class="comment">// chunkçš„nameæ˜¯å•¥å‘¢ï¼Ÿ æ¯”å¦‚ï¼š entryä¸­xxx: "./src/xxx.js", nameå°±æ˜¯xxxã€‚æ³¨æ„æ˜¯å‰é¢çš„xxxï¼Œå’Œæ–‡ä»¶åæ— å…³ã€‚</span></span><br><span class="line">    <span class="comment">// ä¸ºä»€ä¹ˆéœ€è¦è¿™æ ·å‘½åå‘¢ï¼Ÿå¦‚æœè¿˜æ˜¯ä¹‹å‰å†™æ³•main.jsï¼Œé‚£ä¹ˆæ‰“åŒ…ç”Ÿæˆä¸¤ä¸ªjsæ–‡ä»¶éƒ½ä¼šå«åšmain.jsä¼šå‘ç”Ÿè¦†ç›–ã€‚(å®é™…ä¸Šä¼šç›´æ¥æŠ¥é”™çš„)</span></span><br><span class="line">    filename: <span class="string">"js/[name].js"</span>,</span><br><span class="line">    clean: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">      template: <span class="string">"./public/index.html"</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">  mode: <span class="string">"production"</span>,</span><br><span class="line">  optimization: &#123;</span><br><span class="line">    <span class="comment">// ä»£ç åˆ†å‰²é…ç½®</span></span><br><span class="line">    splitChunks: &#123;</span><br><span class="line">      chunks: <span class="string">"all"</span>, <span class="comment">// å¯¹æ‰€æœ‰æ¨¡å—éƒ½è¿›è¡Œåˆ†</span></span><br><span class="line">      <span class="comment">// ä¿®æ”¹é…ç½®</span></span><br><span class="line">      cacheGroups: &#123;</span><br><span class="line">        <span class="comment">// ç»„ï¼Œå“ªäº›æ¨¡å—è¦æ‰“åŒ…åˆ°ä¸€ä¸ªç»„</span></span><br><span class="line">        <span class="comment">// defaultVendors: &#123; // ç»„å</span></span><br><span class="line">        <span class="comment">//   test: /[\\/]node_modules[\\/]/, // éœ€è¦æ‰“åŒ…åˆ°ä¸€èµ·çš„æ¨¡å—</span></span><br><span class="line">        <span class="comment">//   priority: -10, // æƒé‡ï¼ˆè¶Šå¤§è¶Šé«˜ï¼‰</span></span><br><span class="line">        <span class="comment">//   reuseExistingChunk: true, // å¦‚æœå½“å‰ chunk åŒ…å«å·²ä»ä¸» bundle ä¸­æ‹†åˆ†å‡ºçš„æ¨¡å—ï¼Œåˆ™å®ƒå°†è¢«é‡ç”¨ï¼Œè€Œä¸æ˜¯ç”Ÿæˆæ–°çš„æ¨¡å—</span></span><br><span class="line">        <span class="comment">// &#125;,</span></span><br><span class="line">        <span class="keyword">default</span>: &#123;</span><br><span class="line">          <span class="comment">// å…¶ä»–æ²¡æœ‰å†™çš„é…ç½®ä¼šä½¿ç”¨ä¸Šé¢çš„é»˜è®¤å€¼</span></span><br><span class="line">          minSize: <span class="number">0</span>, <span class="comment">// æˆ‘ä»¬å®šä¹‰çš„æ–‡ä»¶ä½“ç§¯å¤ªå°äº†ï¼Œæ‰€ä»¥è¦æ”¹æ‰“åŒ…çš„æœ€å°æ–‡ä»¶ä½“ç§¯</span></span><br><span class="line">          minChunks: <span class="number">2</span>,</span><br><span class="line">          priority: <span class="number">-20</span>,</span><br><span class="line">          reuseExistingChunk: <span class="literal">true</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="å‡å°‘ä¾èµ–å¤„ç†æ—¶é—´"><a href="#å‡å°‘ä¾èµ–å¤„ç†æ—¶é—´" class="headerlink" title="å‡å°‘ä¾èµ–å¤„ç†æ—¶é—´"></a>å‡å°‘ä¾èµ–å¤„ç†æ—¶é—´</h4><ul><li><p>CDNåˆ†åŒ…<br>ä¹‹å‰å¯¹æ‰“åŒ…ä½“ç§¯è¿›è¡Œåˆ†æçš„æ—¶å€™ï¼Œå‘ç°react-domã€reactæ˜¯å æ®ä½“ç§¯éå¸¸å¤§çš„å‡ ä¸ªåŒ…ï¼Œåœ¨æ‰“åŒ…è¿™äº›åŒ…çš„æ—¶å€™å°±éå¸¸è€—æ—¶ã€‚cdnåˆ†åŒ…å¯ä»¥è®©æˆ‘ä»¬åœ¨æ‰“åŒ…è¿‡ç¨‹ä¸­å°†ç‰¹å®šåŒ…åˆ†ç¦»å‡ºæ¥ï¼Œä»è€Œæå‡æ‰“åŒ…é€Ÿåº¦ã€‚<br>æ’é™¤éƒ¨åˆ†åº“çš„æ‰“åŒ…éœ€è¦å€ŸåŠ©<code>html-webpack-externals-plugin</code> æ’ä»¶<br>å‡å°‘loaderè§£æè½¬æ¢æ—¶é—´</p></li><li><p>æ‰“åŒ…é€Ÿåº¦åˆ†æï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add speed-measure-webpack-plugin -D</span><br></pre></td></tr></table></figure></li></ul><p>æˆ‘ä»¬å€ŸåŠ© <code>speed-measure-webpack-plugin</code> æ’ä»¶ï¼Œå®ƒåˆ†æ webpack çš„æ€»æ‰“åŒ…è€—æ—¶ä»¥åŠæ¯ä¸ª plugin å’Œ loader çš„æ‰“åŒ…è€—æ—¶ï¼Œä»è€Œè®©æˆ‘ä»¬å¯¹æ‰“åŒ…æ—¶é—´è¾ƒé•¿çš„éƒ¨åˆ†è¿›è¡Œé’ˆå¯¹æ€§ä¼˜åŒ–ã€‚</p><ul><li>å¤šè¿›ç¨‹æ„å»º</li></ul><p>å¯¹äºè€—æ—¶è¾ƒé•¿çš„æ¨¡å—ï¼ŒåŒæ—¶å¼€å¯å¤šä¸ª nodejs è¿›ç¨‹è¿›è¡Œæ„å»º<br>thread-loaderï¼šå°†åŸæœ‰çš„ webpack å¯¹ loader çš„æ‰§è¡Œè¿‡ç¨‹ä»å•ä¸€è¿›ç¨‹çš„å½¢å¼æ‰©å±•æˆå¤šè¿›ç¨‹æ¨¡å¼ï¼Œæ¥åŠ é€Ÿä»£ç æ„å»º</p><ul><li>ç¼©å°æ„å»ºèŒƒå›´</li></ul><p>æ„å»ºè¿‡ç¨‹æ˜¯é»˜è®¤å…¨å±€æŸ¥æ‰¾ï¼Œè¿™éå¸¸çš„è€—æ—¶ã€‚é€šè¿‡æ‰‹åŠ¨é…ç½®rulesä¸­çš„æ–‡ä»¶æŸ¥æ‰¾èŒƒå›´testã€includeå¯ä»¥å‡å°‘æ‰“åŒ…çš„èŒƒå›´ï¼Œä»è€Œæå‡æ‰“åŒ…çš„é€Ÿåº¦ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        use: [<span class="string">'babel-loader'</span>],</span><br><span class="line">        exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li>ç¼“å­˜Eslint æ£€æŸ¥ å’Œ Babel ç¼–è¯‘ç»“æœ</li></ul><p>æ¯æ¬¡æ‰“åŒ…æ—¶ js æ–‡ä»¶éƒ½è¦ç»è¿‡ Eslint æ£€æŸ¥ å’Œ Babel ç¼–è¯‘ï¼Œé€Ÿåº¦æ¯”è¾ƒæ…¢ã€‚æˆ‘ä»¬å¯ä»¥ç¼“å­˜ä¹‹å‰çš„ Eslint æ£€æŸ¥ å’Œ Babel ç¼–è¯‘ç»“æœï¼Œè¿™æ ·ç¬¬äºŒæ¬¡æ‰“åŒ…æ—¶é€Ÿåº¦å°±ä¼šæ›´å¿«äº†ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">            test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">            <span class="comment">// exclude: /node_modules/, // æ’é™¤node_modulesä»£ç ä¸ç¼–è¯‘</span></span><br><span class="line">            include: path.resolve(__dirname, <span class="string">"../src"</span>), <span class="comment">// ä¹Ÿå¯ä»¥ç”¨åŒ…å«</span></span><br><span class="line">            loader: <span class="string">"babel-loader"</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              cacheDirectory: <span class="literal">true</span>, <span class="comment">// å¼€å¯babelç¼–è¯‘ç¼“å­˜</span></span><br><span class="line">              cacheCompression: <span class="literal">false</span>, <span class="comment">// ç¼“å­˜æ–‡ä»¶ä¸è¦å‹ç¼©</span></span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line"><span class="comment">// eslint</span></span><br><span class="line">                <span class="keyword">new</span> ESLintWebpackPlugin(&#123;</span><br><span class="line">      <span class="comment">// æŒ‡å®šæ£€æŸ¥æ–‡ä»¶çš„æ ¹ç›®å½•</span></span><br><span class="line">      context: path.resolve(__dirname, <span class="string">"../src"</span>),</span><br><span class="line">      exclude: <span class="string">"node_modules"</span>, <span class="comment">// é»˜è®¤å€¼</span></span><br><span class="line">      cache: <span class="literal">true</span>, <span class="comment">// å¼€å¯ç¼“å­˜</span></span><br><span class="line">      <span class="comment">// ç¼“å­˜ç›®å½•</span></span><br><span class="line">      cacheLocation: path.resolve(</span><br><span class="line">        __dirname,</span><br><span class="line">        <span class="string">"../node_modules/.cache/.eslintcache"</span></span><br><span class="line">      ),</span><br><span class="line">    &#125;),</span><br></pre></td></tr></table></figure><ul><li>é…ç½®oneOf</li></ul><p>ä½¿å¾—åŒ¹é…ä¸Šä¸€ä¸ª loader, å‰©ä¸‹çš„å°±ä¸å†åŒ¹é…äº†ï¼Œè§£å†³æ‰“åŒ…æ—¶æ¯ä¸ªæ–‡ä»¶éƒ½ä¼šç»è¿‡æ‰€æœ‰ loader å¤„ç†ï¼Œè™½ç„¶å› ä¸º test æ­£åˆ™åŸå› å®é™…æ²¡æœ‰å¤„ç†ä¸Šï¼Œä½†æ˜¯éƒ½è¦è¿‡ä¸€éã€‚æ¯”è¾ƒæ…¢çš„é—®é¢˜</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"><span class="keyword">const</span> ESLintWebpackPlugin = <span class="built_in">require</span>(<span class="string">"eslint-webpack-plugin"</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">"html-webpack-plugin"</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: <span class="string">"./src/main.js"</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: <span class="literal">undefined</span>, <span class="comment">// å¼€å‘æ¨¡å¼æ²¡æœ‰è¾“å‡ºï¼Œä¸éœ€è¦æŒ‡å®šè¾“å‡ºç›®å½•</span></span><br><span class="line">    filename: <span class="string">"static/js/main.js"</span>, <span class="comment">// å°† js æ–‡ä»¶è¾“å‡ºåˆ° static/js ç›®å½•ä¸­</span></span><br><span class="line">    <span class="comment">// clean: true, // å¼€å‘æ¨¡å¼æ²¡æœ‰è¾“å‡ºï¼Œä¸éœ€è¦æ¸…ç©ºè¾“å‡ºç»“æœ</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        oneOf: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="comment">// ç”¨æ¥åŒ¹é… .css ç»“å°¾çš„æ–‡ä»¶</span></span><br><span class="line">            test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">            <span class="comment">// use æ•°ç»„é‡Œé¢ Loader æ‰§è¡Œé¡ºåºæ˜¯ä»å³åˆ°å·¦</span></span><br><span class="line">            use: [<span class="string">"style-loader"</span>, <span class="string">"css-loader"</span>],</span><br><span class="line">          &#125;,</span><br><span class="line"></span><br><span class="line">          &#123;</span><br><span class="line">            test: <span class="regexp">/\.(ttf|woff2?)$/</span>,</span><br><span class="line">            type: <span class="string">"asset/resource"</span>,</span><br><span class="line">            generator: &#123;</span><br><span class="line">              filename: <span class="string">"static/media/[hash:8][ext][query]"</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">            exclude: <span class="regexp">/node_modules/</span>, <span class="comment">// æ’é™¤node_modulesä»£ç ä¸ç¼–è¯‘</span></span><br><span class="line">            loader: <span class="string">"babel-loader"</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure><h4 id="ç¼“å­˜ç”Ÿæˆçš„-webpack-æ¨¡å—å’Œ-chunk"><a href="#ç¼“å­˜ç”Ÿæˆçš„-webpack-æ¨¡å—å’Œ-chunk" class="headerlink" title="ç¼“å­˜ç”Ÿæˆçš„ webpack æ¨¡å—å’Œ chunk"></a>ç¼“å­˜ç”Ÿæˆçš„ webpack æ¨¡å—å’Œ chunk</h4><p>webpack5 å†…ç½®äº† <code>cache</code> æ¨¡å—ï¼Œç¼“å­˜ç”Ÿæˆçš„ webpack æ¨¡å—å’Œ chunkï¼Œæ¥æ”¹å–„æ„å»ºé€Ÿåº¦ã€‚å®ƒåœ¨å¼€å‘ç¯å¢ƒä¸‹ä¼šé»˜è®¤è®¾ç½®ä¸º <code>type: &#39;memory&#39;</code> è€Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¢«ç¦ç”¨ã€‚å¯ä»¥é€šè¿‡è®¾ç½® <code>cache: { type: &#39;filesystem&#39; }</code>æ¥å¼€æ”¾æ›´å¤šé…ç½®é¡¹<br>æ¯”å¦‚æˆ‘åœ¨<code>webpack.config.js</code>ä¸­å¦‚ä¸‹é…ç½®ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;   <span class="attr">cache</span>: &#123;     <span class="attr">type</span>: <span class="string">'filesystem'</span>,   &#125;, &#125;;</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆç¬¬ä¸€æ¬¡æ‰“åŒ…åï¼Œå°±ä¼šåœ¨node_modulesæ–‡ä»¶å¤¹ä¸‹é¢ç”Ÿæˆä¸€ä¸ªcacheæ–‡ä»¶å¤¹ï¼Œä»è€Œç¬¬äºŒæ¬¡æ‰“åŒ…é€Ÿåº¦æ˜¾è‘—æå‡ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç®—æ³•å¡«å‘</title>
      <link href="/ashley271017.github.io/2020/01/06/%E7%AE%97%E6%B3%95%E5%A1%AB%E5%9D%91/"/>
      <url>/ashley271017.github.io/2020/01/06/%E7%AE%97%E6%B3%95%E5%A1%AB%E5%9D%91/</url>
      
        <content type="html"><![CDATA[<h3 id="è´ªå¿ƒæ³•"><a href="#è´ªå¿ƒæ³•" class="headerlink" title="è´ªå¿ƒæ³•"></a>è´ªå¿ƒæ³•</h3><p>æ–¹æ³•æ˜¯ä»æŸä¸€èµ·ç‚¹å¼€å§‹ï¼Œåœ¨æ¯ä¸€ä¸ªè§£å†³é—®é¢˜æ­¥éª¤ä¸­ä½¿ç”¨è´ªå¿ƒåŸåˆ™ï¼Œå³é‡‡å–åœ¨å½“å‰çŠ¶æ€ä¸‹æœ€æœ‰åˆ©æˆ–è€…æ˜¯æœ€ä¼˜åŒ–çš„é€‰æ‹©ï¼Œè´ªå¿ƒæ³•å¸¸ç”¨äºæ‰¾å‡ºå›¾çš„æœ€å°ç”Ÿæˆæ ‘ï¼Œæœ€çŸ­è·¯å¾„ï¼Œå“ˆå¤«æ›¼ç¼–ç ç­‰ç­‰<br>åº”ç”¨ï¼šåœ¨ä¸€å®šçš„æ—¶é—´ä¹‹å†…ä¸Šå®Œå°½é‡å¤šçš„è¯¾ç¨‹<br>ç­–ç•¥ï¼šæ¯æ¬¡é€‰æ‹©æœ€æ—©ç»“æŸçš„è¯¾ç¨‹</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é¦–å…ˆå°†å·²é€‰è¯¾ç¨‹çš„åˆ—è¡¨åˆå§‹åŒ–ä¸ºç©ºï¼Œç„¶åæ‰§è¡Œè´ªå¿ƒç®—æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">executeSchedule</span><span class="params">(courses,selectionRule)</span>:</span></span><br><span class="line">    selectedCourses = []</span><br><span class="line">    <span class="keyword">while</span> len(courses) &gt; <span class="number">0</span>:</span><br><span class="line">        selCourse = earliestFinishTime(courses)</span><br><span class="line">        selectedCourses.append(selCourse)</span><br><span class="line">        courses = removeConflictingCourses(selCourse,courses)</span><br><span class="line">    <span class="keyword">return</span> selectedCourses</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">earliestFinishTime</span><span class="params">(courses)</span>:</span></span><br><span class="line">    earliestFinishTime = courses[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> courses:</span><br><span class="line">        <span class="keyword">if</span> i[<span class="number">1</span>] &lt; earliestFinishTime[<span class="number">1</span>]:</span><br><span class="line">            earliestFinishTime = i</span><br><span class="line">    <span class="keyword">return</span> earliestFinishTime</span><br><span class="line"><span class="comment"># æ’é™¤å·²é€‰è¯¾ç¨‹ä¸­ä¸å½“å‰é€‰ä¸­çš„è¯¾ç¨‹å†²çªçš„è¯¾ç¨‹</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">removeConflictingCourses</span><span class="params">(selCourse,courses)</span>:</span></span><br><span class="line">    noConflictingCourses = []</span><br><span class="line">    <span class="keyword">for</span> s <span class="keyword">in</span> courses:</span><br><span class="line">        <span class="keyword">if</span> s[<span class="number">1</span>] &lt;= selCourse[<span class="number">0</span>] <span class="keyword">or</span> s[<span class="number">0</span>] &gt;= selCourse[<span class="number">1</span>]:</span><br><span class="line">        noConflictingCourses.append(s)</span><br><span class="line">    <span class="keyword">return</span> noConflictingCourses</span><br></pre></td></tr></table></figure><h3 id="åŠ¨æ€è§„åˆ’æ³•"><a href="#åŠ¨æ€è§„åˆ’æ³•" class="headerlink" title="åŠ¨æ€è§„åˆ’æ³•"></a>åŠ¨æ€è§„åˆ’æ³•</h3><p>ä¹Ÿæ˜¯å°†ä¸€ä¸ªé—®é¢˜æ‹†è§£æˆè‹¥å¹²ä¸ªå­é—®é¢˜ï¼Œä½†æ˜¯è·Ÿåˆ†æ²»æ³•ä¸ä¸€æ ·çš„æ˜¯å®ƒä¼šå°†æ¯ä¸€ä¸ªå­é—®é¢˜çš„ç­”æ¡ˆå­˜å‚¨èµ·æ¥ï¼Œä»¥ä¾›ä¸‹æ¬¡æ±‚è§£çš„æ—¶å€™ä½¿ç”¨ï¼Œè¿™æ ·èƒ½å¤Ÿå‡å°‘è®¡ç®—çš„æ—¶é—´</p><h3 id="å›æº¯"><a href="#å›æº¯" class="headerlink" title="å›æº¯"></a>å›æº¯</h3><p>ä¸€ç§å¯ä»¥æ‰¾å‡ºæ‰€æœ‰è§£æˆ–è€…æ˜¯ä¸€éƒ¨åˆ†è§£çš„ç®—æ³•ï¼Œä¸€æ—¦å‘ç°ä¸æ­£å¸¸çš„æ•°æ®å°±ä¸å†ç»§ç»­ï¼Œè€Œæ˜¯ä¼šå›åˆ°ä¸Šä¸€å±‚</p><h3 id="é€’å½’åˆ†æ²»"><a href="#é€’å½’åˆ†æ²»" class="headerlink" title="é€’å½’åˆ†æ²»"></a>é€’å½’åˆ†æ²»</h3><p>åº”ç”¨ï¼šä¸€å †çœŸå¸ä¸­æœ‰ä¸€ä¸ªæ˜¯å‡çš„ï¼Œå‡å¸çš„é‡äºçœŸçš„ï¼Œæ‰¾å‡ºå‡å¸</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">coinslist=[<span class="number">1</span>,<span class="number">1</span>,<span class="number">4</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>]</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">coinComparison</span><span class="params">(coinslist)</span>:</span></span><br><span class="line">    counter=<span class="number">0</span></span><br><span class="line">    currlist=coinslist</span><br><span class="line">    <span class="keyword">while</span> len(currlist) &gt; <span class="number">1</span>:</span><br><span class="line">        group1,group2,group3 = splitCoins(currlist)</span><br><span class="line">        currlist = findFakeGroup(group1,group2,group3)</span><br><span class="line">        counter+=<span class="number">1</span></span><br><span class="line">    fake=currlist[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">findFakeGroup</span><span class="params">(group1,group2,group3)</span>:</span></span><br><span class="line">    resultland2 = compare(group1,group2)</span><br><span class="line">    <span class="keyword">if</span> resultland2 == <span class="string">'left'</span>:</span><br><span class="line">       fakeGroup = group1</span><br><span class="line">    <span class="keyword">elif</span> resultland2 == <span class="string">'right'</span></span><br><span class="line">       fakeGroup = group2</span><br><span class="line">    <span class="keyword">elif</span> resultland2 == <span class="string">'equal'</span></span><br><span class="line">       fakeGroup = group3</span><br><span class="line">    <span class="keyword">return</span> fakeGroup</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">compare</span><span class="params">(groupA,groupB)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> sum(groupA)&gt;sum(groupB):</span><br><span class="line">       result = <span class="string">'left'</span></span><br><span class="line">    <span class="keyword">elif</span> sum(groupB)&gt;sum(groupA):</span><br><span class="line">       result = <span class="string">'right'</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">       result = <span class="string">'equal'</span></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">splitCoins</span><span class="params">(coinslist)</span>:</span></span><br><span class="line">    length = len(coinslist)</span><br><span class="line">    group1=coinslist[<span class="number">0</span>:length//<span class="number">3</span>]</span><br><span class="line">    group2=coinslist[length//<span class="number">3</span>:length//<span class="number">3</span>*<span class="number">2</span>]</span><br><span class="line">    group3=coinslist[length//<span class="number">3</span>*<span class="number">2</span>:length]</span><br><span class="line">    <span class="keyword">return</span> group1,group2,group3</span><br></pre></td></tr></table></figure><h3 id="è®°å¿†é€’å½’"><a href="#è®°å¿†é€’å½’" class="headerlink" title="è®°å¿†é€’å½’"></a>è®°å¿†é€’å½’</h3><p>åº”ç”¨ï¼šæœ‰ä»¥ä¸‹çš„ç¡¬å¸ï¼Œéœ€è¦é€‰æ‹©éƒ¨åˆ†ç¡¬å¸ä½¿å¾—ä»–ä»¬çš„å’Œæœ€å¤§åŒ–ï¼Œå¹¶ä¸”ä¸èƒ½é€‰æ‹©ç›¸é‚»çš„ç¡¬å¸<br>1 3 2 44 5</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">coins</span><span class="params">(row,memo)</span>:</span></span><br><span class="line">   <span class="keyword">if</span> len(row) == <span class="number">0</span>:</span><br><span class="line">      memo[<span class="number">0</span>] = <span class="number">0</span></span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>,memo</span><br><span class="line">   <span class="keyword">elif</span> len(row) == <span class="number">1</span>:</span><br><span class="line">      memo[<span class="number">1</span>] = row[<span class="number">0</span>]</span><br><span class="line">      <span class="keyword">return</span> row[<span class="number">0</span>],memo</span><br><span class="line">   <span class="keyword">try</span>:</span><br><span class="line">      retukrn (memo[len(row)],memo)</span><br><span class="line">   <span class="keyword">except</span> KeyError:</span><br><span class="line">      <span class="comment"># å¯¹åº”é€‰ä¸­ç¬¬ä¸€æšç¡¬å¸</span></span><br><span class="line">      pick = coins(row[<span class="number">2</span>:],memo)[<span class="number">0</span>]+row[<span class="number">0</span>])</span><br><span class="line">      <span class="comment"># å¯¹åº”è·³è¿‡ç¬¬ä¸€æšç¡¬å¸</span></span><br><span class="line">      skip = coins(row[<span class="number">1</span>:],memo)[<span class="number">0</span>]</span><br><span class="line">      result = max(pick,skip)</span><br><span class="line">      memo[len(row)] = result</span><br><span class="line">      <span class="keyword">return</span> (result,memo)</span><br></pre></td></tr></table></figure><h3 id="å›¾çš„å¹¿åº¦ä¼˜å…ˆæœç´¢"><a href="#å›¾çš„å¹¿åº¦ä¼˜å…ˆæœç´¢" class="headerlink" title="å›¾çš„å¹¿åº¦ä¼˜å…ˆæœç´¢"></a>å›¾çš„å¹¿åº¦ä¼˜å…ˆæœç´¢</h3><p>åº”ç”¨ï¼šå…­åº¦åˆ†éš”ï¼Œæ¯ä¸ªäººä¸å…¶ä»–ä»»ä½•äººéƒ½åªéœ€è¦ç»è¿‡å…­æ­¥ä»¥å†…çš„ä»‹ç»ï¼Œåˆ†éš”åº¦æŒ‡çš„æ˜¯æ¯ä¸€ä¸ªäººä¹‹é—´çš„æœ€å¤§åˆ†éš”åº¦</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">small = &#123;</span><br><span class="line">  &apos;A&apos;:[&apos;B&apos;,&apos;C&apos;],</span><br><span class="line">  &apos;B&apos;:[&apos;A&apos;,&apos;C&apos;]</span><br><span class="line">&#125;</span><br><span class="line">def degreesOfSeparation(graph,start):</span><br><span class="line">    if start not in graph:</span><br><span class="line">     return -1</span><br><span class="line">     visited = set()</span><br><span class="line">     frontier = set()</span><br><span class="line">     degrees=0</span><br><span class="line">     visited.add(start)</span><br><span class="line">     frontier.add(start)</span><br><span class="line">     while len(frontier) &gt; 0:</span><br><span class="line">       print(frontier,&apos;:&apos;,degrees)</span><br><span class="line">       degrees += 1</span><br><span class="line">       newfront = set()</span><br><span class="line">       for g in frontier:</span><br><span class="line">           for next in graph[g]:</span><br><span class="line">           if next not in visited:</span><br><span class="line">              visited.add(next)</span><br><span class="line">              newfront.add(next)</span><br><span class="line">              # å°†å½“å‰å…ˆé”‹è®¾ç½®ä¸ºæ–°çš„å…ˆé”‹</span><br><span class="line">              frontier = newfront</span><br><span class="line">      return degrees -=1</span><br><span class="line">degreesOfSeparation(small,&apos;A&apos;)</span><br><span class="line"># &#123;&apos;A&apos;&#125;:0</span><br><span class="line"># &#123;&apos;C&apos;,&apos;B&apos;&#125;:1</span><br><span class="line"># ...</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ—¥å¸¸è®°å½•</title>
      <link href="/ashley271017.github.io/2020/01/06/%E8%AE%B0%E5%BD%95/"/>
      <url>/ashley271017.github.io/2020/01/06/%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<p> å¹´å‰çš„ç©ºæ¡£æœŸå»äº†æŸå‚æ¬ç –ï¼Œæ„Ÿæ…¨ç”Ÿæ´»çš„ä¸æ˜“çš„åŒæ—¶æ·±æ„Ÿé çŸ¥è¯†èµšé’±æ˜¯ä¸€ä»¶å¤šä¹ˆå¹¸ç¦çš„äº‹æƒ…ï¼Œçªç„¶æåº¦æ¸´æœ›è¿…é€Ÿæå‡è‡ªå·±çš„æŠ€æœ¯æ°´å¹³ï¼Œæ¸´æœ›ä¾é æŠ€æœ¯è€Œä¸æ˜¯æœºæ¢°æ€§çš„åŠ³åŠ¨èµšé’±ã€‚<br> è¿‡å®Œå¹´å°± 23 å²äº†ï¼Œèƒ½äº«å—å¹´è½»çš„æ—¥å­å·²ç»ä¸å¤šäº†ï¼Œä¸‰å¹´ä¹‹åå¼€å§‹è¡°è€ï¼Œä¸å†æ˜¯å°é²œè‚‰ï¼Œå¯èƒ½ä¸å†æœ‰å°‘å¹´çš„æ¿€æƒ…ï¼Œå¯èƒ½ä¼šå®‰äºç°çŠ¶ï¼Œä¸€å¿ƒåªæƒ³æ±‚ç¨³ï¼Œå¯èƒ½å›é¦–ä»Šå¤©ï¼Œä¼šè§‰å¾—è¿™æ ¹æœ¬æ²¡ä»€ä¹ˆå¤§ä¸äº†ï¼Œå› ä¸ºæˆ‘ç°åœ¨å·²ç»ç¨³å®šä¸‹æ¥äº†å‘€ã€‚ã€‚ã€‚æƒ³åˆ°è¿™äº›ï¼Œæ—¢è§‰å¾—å¾—åˆ°äº†å®‰æ…°åˆè§‰å¾—ç´¢ç„¶æ— å‘³ã€‚<br> æˆ‘åˆ°åº•æƒ³è¦è¿‡æ€æ ·çš„äººç”Ÿï¼Ÿæƒ³è¦èµ°ä»€ä¹ˆæ ·çš„èŒä¸šé“è·¯ï¼Ÿå…¶å®ç°åœ¨çš„æˆ‘ä¹Ÿä¸æ˜ç¡®ï¼Œæœªæ¥çš„æ—¥å­ï¼Œé“é˜»ä¸”é•¿ï¼Œå”¯ä¸€çš„æ„¿æœ›æ˜¯å¸Œæœ›è‡ªå·±å¯ä»¥å°‘ç•™é—æ†¾ï¼Œèƒ½ä¸€è·¯å‘å‰ä¸è¦å›å¤´å§ã€‚ã€‚ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> ç”Ÿæ´» </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é¢è¯•ä¸­çš„ç¼–ç¨‹é¢˜</title>
      <link href="/ashley271017.github.io/2019/12/24/%E9%9D%A2%E8%AF%95%E4%B8%AD%E7%9A%84%E7%BC%96%E7%A8%8B%E9%A2%98%EF%BD%9E%E4%B8%8D%E5%AE%9A%E6%9C%9F%E6%9B%B4%E6%96%B0/"/>
      <url>/ashley271017.github.io/2019/12/24/%E9%9D%A2%E8%AF%95%E4%B8%AD%E7%9A%84%E7%BC%96%E7%A8%8B%E9%A2%98%EF%BD%9E%E4%B8%8D%E5%AE%9A%E6%9C%9F%E6%9B%B4%E6%96%B0/</url>
      
        <content type="html"><![CDATA[<ul><li><p>æ±‚å¤šä¸ªæ•°ç»„çš„äº¤é›†</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">jiaojiArr</span>(<span class="params">a,b</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Set</span>([...a].filter(<span class="function"><span class="params">item</span>=&gt;</span>b.includes(item)))</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getJiaoji</span>(<span class="params">...arrs</span>)</span>&#123;</span><br><span class="line"><span class="keyword">return</span> arrs.reduce(<span class="function">(<span class="params">jiaoji,arr</span>)=&gt;</span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">Array</span>.from(jiaojiArr(jiaoji,arr))</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>å®ç°indexof</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Array</span>.prototype.indexOf=<span class="function"><span class="keyword">function</span> (<span class="params">target,start=<span class="number">0</span></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">let</span> str=<span class="keyword">this</span>.slice(start).join(<span class="string">','</span>)</span><br><span class="line">  <span class="keyword">let</span> strArr=str.split(<span class="string">`<span class="subst">$&#123;target&#125;</span>,`</span>)</span><br><span class="line">  <span class="keyword">if</span>(strArr.length===<span class="number">1</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> strArr[<span class="number">0</span>].split(<span class="string">','</span>).length - <span class="number">1</span>+start</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">String</span>.prototype.indexOf=<span class="function"><span class="keyword">function</span>(<span class="params">target,start=<span class="number">0</span></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">let</span> str=<span class="keyword">this</span>.slice(start)</span><br><span class="line">  <span class="keyword">let</span> result=str.replace(<span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">`<span class="subst">$&#123;target&#125;</span>\\w+`</span>,<span class="string">'g'</span>),<span class="string">''</span>).length+start</span><br><span class="line">  <span class="keyword">return</span> result===<span class="keyword">this</span>.length? <span class="number">-1</span> : result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>åˆ¤æ–­é“¾è¡¨ä¸­æ˜¯å¦å­˜åœ¨ç¯</p></li></ul><p>æ€è·¯ï¼šè®¾ç½®ä¸€ä¸ª slow æŒ‡é’ˆ slow = slow-&gt;nextï¼Œä¸€ä¸ª fast æŒ‡é’ˆ fast = fast-&gt;next-&gt;nextã€‚å› ä¸º fast æŒ‡é’ˆç§»åŠ¨çš„æ¯” slow å¿«ï¼Œè¦æ˜¯æœ‰ç¯çš„è¯ä¸€å®šä¼šç›¸é‡</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">linknode</span>(<span class="params">x</span>)</span>&#123;</span><br><span class="line"><span class="keyword">this</span>.val=x</span><br><span class="line"><span class="keyword">this</span>.next=<span class="literal">null</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">linklist</span>()</span>&#123;</span><br><span class="line"><span class="keyword">constructor</span>(x)&#123;</span><br><span class="line">  <span class="keyword">this</span>.head=<span class="keyword">new</span> linknode(x)</span><br><span class="line">&#125;</span><br><span class="line">append(x)&#123;</span><br><span class="line">  <span class="keyword">const</span> newnode=<span class="keyword">new</span> linknode(x)</span><br><span class="line">  <span class="keyword">let</span> current=<span class="keyword">this</span>.head</span><br><span class="line">  <span class="keyword">while</span>(current.next)&#123;</span><br><span class="line">current=current.next</span><br><span class="line">  &#125;</span><br><span class="line">  current.next=newnode</span><br><span class="line">&#125;</span><br><span class="line">judge()&#123;</span><br><span class="line">  <span class="keyword">if</span>(!<span class="keyword">this</span>.head.next)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="keyword">let</span> fast=<span class="keyword">this</span>.head.next.next</span><br><span class="line"><span class="keyword">let</span> low=<span class="keyword">this</span>.head.next</span><br><span class="line"><span class="keyword">while</span>(fast.next)&#123;</span><br><span class="line">  <span class="keyword">if</span>(fast.next===low.next)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">  fast=fast.next.next</span><br><span class="line">  low=low.next</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>ä»æ•°ç»„ä¸­å–å¾—éšæœºæ•°ä¸èƒ½æœ‰é‡å¤çš„</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getRandomNumFromArr</span>(<span class="params">arr, count</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (count &gt;= arr.length) &#123;</span><br><span class="line">    <span class="keyword">return</span> arr</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> result = []</span><br><span class="line">  <span class="keyword">while</span> (result.length &lt; count) &#123;</span><br><span class="line">    <span class="keyword">let</span> random = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * (arr.length<span class="number">-1</span>))</span><br><span class="line">    <span class="keyword">if</span> (!result.includes(arr[random])) &#123;</span><br><span class="line">      result.push(arr[random])</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>å®ç°addå‡½æ•°</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> fn = <span class="function"><span class="keyword">function</span>(<span class="params">m</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> add(n + m)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// valueOf åœ¨ ç®—æœ¯è¿ç®—æ—¶ç”Ÿæ•ˆå¦‚ +add(2)(3)</span></span><br><span class="line">  fn.valueOf = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> n</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// toString åœ¨ è½¬æ¢ä¸ºå­—ç¬¦ä¸²æ—¶è°ƒç”¨ add(2)(3)</span></span><br><span class="line">  fn.toString = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">''</span> + n</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> fn</span><br><span class="line">&#125;</span><br><span class="line">add(<span class="number">1</span>); <span class="comment">// 1</span></span><br><span class="line">add(<span class="number">1</span>)(<span class="number">2</span>);  <span class="comment">// 3</span></span><br><span class="line">add(<span class="number">1</span>)(<span class="number">2</span>)(<span class="number">3</span>)ï¼›  <span class="comment">// 6</span></span><br></pre></td></tr></table></figure></li><li><p>è·å¾—æ‰€æœ‰çˆ¶çº§çš„ID</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> data = [</span><br><span class="line">  &#123;</span><br><span class="line">    id: <span class="string">'1'</span>,</span><br><span class="line">    name: <span class="string">'test1'</span>,</span><br><span class="line">    children: [</span><br><span class="line">      &#123;</span><br><span class="line">        id: <span class="string">'11'</span>,</span><br><span class="line">        name: <span class="string">'test11'</span>,</span><br><span class="line">        children: [</span><br><span class="line">          &#123;</span><br><span class="line">            id: <span class="string">'111'</span>,</span><br><span class="line">            name: <span class="string">'test111'</span></span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        id: <span class="string">'12'</span>,</span><br><span class="line">        name: <span class="string">'test12'</span>,</span><br><span class="line">        children: [</span><br><span class="line">          &#123;</span><br><span class="line">            id: <span class="string">'121'</span>,</span><br><span class="line">            name: <span class="string">'test121'</span></span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br><span class="line"><span class="comment">// æ­£åˆ™è¡¨è¾¾å¼ç‰ˆ</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getParentId</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> str = <span class="built_in">JSON</span>.stringify(data)</span><br><span class="line">  <span class="keyword">const</span> childReg = <span class="regexp">/\&#123;[^&#123;&#125;]+\&#125;/g</span></span><br><span class="line">  <span class="keyword">const</span> childCollects = str.match(chilReg)</span><br><span class="line">  <span class="keyword">const</span> idReg = <span class="regexp">/(?&lt;=id\":\")\d+/g</span></span><br><span class="line">  <span class="keyword">const</span> childIdCollects = childCollects.map(<span class="function">(<span class="params">child</span>) =&gt;</span> child.match(idReg)[<span class="number">0</span>])</span><br><span class="line">  <span class="keyword">const</span> totalIdCollects = str.match(idReg)</span><br><span class="line">  <span class="keyword">return</span> totalIdCollects.filter(<span class="function">(<span class="params">item</span>) =&gt;</span> !childIdCollects.includes(item))</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// DFS</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getParentId</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> result = &#123;&#125;</span><br><span class="line">  ;(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> parents = data.filter(<span class="function">(<span class="params">item</span>) =&gt;</span> <span class="string">'children'</span> <span class="keyword">in</span> item)</span><br><span class="line">    parents.reduce(<span class="function">(<span class="params">obj, item</span>) =&gt;</span> &#123;</span><br><span class="line">      obj[item.id] = <span class="built_in">Symbol</span>()</span><br><span class="line">      <span class="keyword">return</span> obj</span><br><span class="line">    &#125;, result)</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> k <span class="keyword">of</span> parents) &#123;</span><br><span class="line">      <span class="built_in">arguments</span>.callee(k.children)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)(data)</span><br><span class="line">  <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>æ·±åº¦åˆå¹¶ä¸¤ä¸ªå¯¹è±¡</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mergeDeep</span>(<span class="params">target, obj</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> result = &#123; ...target&#125;</span><br><span class="line">  ;(<span class="function"><span class="keyword">function</span> <span class="title">merge</span>(<span class="params">origin, obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> k <span class="keyword">in</span> obj) &#123;</span><br><span class="line">      <span class="keyword">if</span> (</span><br><span class="line">        <span class="keyword">typeof</span> origin[k] !== <span class="string">'object'</span> ||</span><br><span class="line">        <span class="keyword">typeof</span> obj[k] !== <span class="string">'object'</span> ||</span><br><span class="line">        <span class="built_in">Array</span>.isArray(origin[k]) !== <span class="built_in">Array</span>.isArray(obj[k])</span><br><span class="line">      ) &#123;</span><br><span class="line">        origin[k] = obj[k]</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        merge(origin[k], obj[k])</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)(result, obj)</span><br><span class="line">  <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> é¢è¯• </category>
          
          <category> js </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>é¢ç»cssç¯‡</title>
      <link href="/ashley271017.github.io/2019/12/18/%E9%9D%A2%E7%BB%8Fcss%E7%AF%87/"/>
      <url>/ashley271017.github.io/2019/12/18/%E9%9D%A2%E7%BB%8Fcss%E7%AF%87/</url>
      
        <content type="html"><![CDATA[<h3 id="æ°´å¹³å‚ç›´å±…ä¸­çš„å„ç§å§¿åŠ¿ï¼Œè¡¥å……"><a href="#æ°´å¹³å‚ç›´å±…ä¸­çš„å„ç§å§¿åŠ¿ï¼Œè¡¥å……" class="headerlink" title="æ°´å¹³å‚ç›´å±…ä¸­çš„å„ç§å§¿åŠ¿ï¼Œè¡¥å……"></a>æ°´å¹³å‚ç›´å±…ä¸­çš„å„ç§å§¿åŠ¿ï¼Œè¡¥å……</h3><ul><li><p><a href="https://www.html.cn/archives/8510" target="_blank" rel="noopener">girdå¸ƒå±€</a></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">div</span><span class="selector-class">.parent</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: grid;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.child</span> &#123;</span><br><span class="line">    <span class="attribute">justify-self</span>: center;</span><br><span class="line">    <span class="attribute">align-self</span>: center;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>flex</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">div</span><span class="selector-class">.parent</span>&#123;</span><br><span class="line">  <span class="attribute">display</span>:flex;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.child</span>&#123;</span><br><span class="line">  <span class="attribute">margin</span>:auto;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="link-vs-import"><a href="#link-vs-import" class="headerlink" title="link vs @import"></a>link vs @import</h3><p>å½“ä¸€ä¸ªé¡µé¢è¢«åŠ è½½çš„æ—¶å€™ï¼ˆå°±æ˜¯è¢«æµè§ˆè€…æµè§ˆçš„æ—¶å€™ï¼‰ï¼Œlinkå¼•ç”¨çš„CSSä¼šåŒæ—¶è¢«åŠ è½½ï¼Œè€Œ@importå¼•ç”¨çš„CSS ä¼šç­‰åˆ°é¡µé¢å…¨éƒ¨è¢«ä¸‹è½½å®Œå†è¢«åŠ è½½ã€‚</p><h3 id="line-height-2-ä¸200"><a href="#line-height-2-ä¸200" class="headerlink" title="line-height 2 ä¸200%"></a>line-height 2 ä¸200%</h3><ul><li><p>çˆ¶å…ƒç´ è®¾ç½®line-height: 200%;å±æ€§æ—¶ çˆ¶å…ƒç´ è®¾ç½®è¿™ä¸ªå±æ€§åï¼Œå…¶æ‰€æœ‰å­å…ƒç´ çš„è¡Œé«˜éƒ½æ˜¯ä¸€ä¸ªå…·ä½“çš„å€¼ï¼Œå³ä»–ä»¬çˆ¶å…ƒç´ å­—ä½“å¤§å°çš„200%ã€‚ä¸‹ä¾‹å¯çœ‹å‡ºå­å…ƒç´ çš„è¡Œé«˜éƒ½ä¸€è‡´ï¼Œå³çˆ¶å…ƒç´ å­—ä½“å¤§å°çš„2å€ï¼Œ32pxã€‚</p></li><li><p>çˆ¶å…ƒç´ è®¾ç½®line-height: 2;å±æ€§æ—¶ çˆ¶å…ƒç´ è®¾ç½®è¿™ä¸ªå±æ€§åï¼Œå…¶æ‰€æœ‰å­å…ƒç´ çš„è¡Œé«˜éƒ½æ˜¯è‡ªèº«å­—ä½“å¤§å°çš„2å€ã€‚ä¸‹ä¾‹å¯çœ‹å‡ºå­å…ƒç´ çš„è¡Œé«˜éƒ½æ˜¯ä¸ä¸€è‡´çš„</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> é¢ç» </category>
          
          <category> css </category>
          
      </categories>
      
      
        <tags>
            
            <tag> css </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é¢ç»æµè§ˆå™¨ç¯‡</title>
      <link href="/ashley271017.github.io/2019/12/12/%E9%9D%A2%E7%BB%8F%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E7%AF%87/"/>
      <url>/ashley271017.github.io/2019/12/12/%E9%9D%A2%E7%BB%8F%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E7%AF%87/</url>
      
        <content type="html"><![CDATA[<h3 id="Httpè¯·æ±‚ä¸­çš„keep-alive"><a href="#Httpè¯·æ±‚ä¸­çš„keep-alive" class="headerlink" title="Httpè¯·æ±‚ä¸­çš„keep-alive"></a>Httpè¯·æ±‚ä¸­çš„keep-alive</h3><p>åœ¨httpæ—©æœŸï¼Œæ¯ä¸ªhttpè¯·æ±‚éƒ½è¦æ±‚æ‰“å¼€ä¸€ä¸ªtpc socketè¿æ¥ï¼Œå¹¶ä¸”ä½¿ç”¨ä¸€æ¬¡ä¹‹åå°±æ–­å¼€è¿™ä¸ªtcpè¿æ¥ã€‚<br>ä½¿ç”¨keep-aliveå¯ä»¥æ”¹å–„è¿™ç§çŠ¶æ€ï¼Œå³åœ¨ä¸€æ¬¡TCPè¿æ¥ä¸­å¯ä»¥æŒç»­å‘é€å¤šä»½æ•°æ®è€Œä¸ä¼šæ–­å¼€è¿æ¥ã€‚é€šè¿‡ä½¿ç”¨keep-aliveæœºåˆ¶ï¼Œå¯ä»¥å‡å°‘tcpè¿æ¥å»ºç«‹æ¬¡æ•°ï¼Œä¹Ÿæ„å‘³ç€å¯ä»¥å‡å°‘TIME_WAITçŠ¶æ€è¿æ¥ï¼Œä»¥æ­¤æé«˜æ€§èƒ½å’Œæé«˜httpdæœåŠ¡å™¨çš„ååç‡(æ›´å°‘çš„tcpè¿æ¥æ„å‘³ç€æ›´å°‘çš„ç³»ç»Ÿå†…æ ¸è°ƒç”¨,socketçš„accept()å’Œclose()è°ƒç”¨)ã€‚<br>ä½†æ˜¯ï¼Œkeep-aliveå¹¶ä¸æ˜¯å…è´¹çš„åˆé¤,é•¿æ—¶é—´çš„tcpè¿æ¥å®¹æ˜“å¯¼è‡´ç³»ç»Ÿèµ„æºæ— æ•ˆå ç”¨ã€‚é…ç½®ä¸å½“çš„keep-aliveï¼Œæœ‰æ—¶æ¯”é‡å¤åˆ©ç”¨è¿æ¥å¸¦æ¥çš„æŸå¤±è¿˜æ›´å¤§ã€‚æ‰€ä»¥ï¼Œæ­£ç¡®åœ°è®¾ç½®keep-alive timeoutæ—¶é—´éå¸¸é‡è¦ã€‚</p><h3 id="æµè§ˆå™¨ä¸ºä»€ä¹ˆè¦é™åˆ¶getè¯·æ±‚çš„å‚æ•°çš„é•¿åº¦"><a href="#æµè§ˆå™¨ä¸ºä»€ä¹ˆè¦é™åˆ¶getè¯·æ±‚çš„å‚æ•°çš„é•¿åº¦" class="headerlink" title="æµè§ˆå™¨ä¸ºä»€ä¹ˆè¦é™åˆ¶getè¯·æ±‚çš„å‚æ•°çš„é•¿åº¦"></a>æµè§ˆå™¨ä¸ºä»€ä¹ˆè¦é™åˆ¶<code>get</code>è¯·æ±‚çš„å‚æ•°çš„é•¿åº¦</h3><p>æ˜¯å› ä¸º<code>url</code>çš„é•¿åº¦ä¼šè¢«é™åˆ¶</p><h3 id="HTTPS-æ¡æ‰‹è¿‡ç¨‹ä¸­ï¼Œå®¢æˆ·ç«¯å¦‚ä½•éªŒè¯è¯ä¹¦çš„åˆæ³•æ€§"><a href="#HTTPS-æ¡æ‰‹è¿‡ç¨‹ä¸­ï¼Œå®¢æˆ·ç«¯å¦‚ä½•éªŒè¯è¯ä¹¦çš„åˆæ³•æ€§" class="headerlink" title="HTTPS æ¡æ‰‹è¿‡ç¨‹ä¸­ï¼Œå®¢æˆ·ç«¯å¦‚ä½•éªŒè¯è¯ä¹¦çš„åˆæ³•æ€§"></a>HTTPS æ¡æ‰‹è¿‡ç¨‹ä¸­ï¼Œå®¢æˆ·ç«¯å¦‚ä½•éªŒè¯è¯ä¹¦çš„åˆæ³•æ€§</h3><p>ï¼ˆ1ï¼‰é¦–å…ˆæµè§ˆå™¨è¯»å–è¯ä¹¦ä¸­çš„è¯ä¹¦æ‰€æœ‰è€…ã€æœ‰æ•ˆæœŸç­‰ä¿¡æ¯è¿›è¡Œæ ¡éªŒï¼Œæ ¡éªŒè¯ä¹¦çš„ç½‘ç«™åŸŸåæ˜¯å¦ä¸è¯ä¹¦é¢å‘çš„åŸŸåä¸€è‡´ï¼Œæ ¡éªŒè¯ä¹¦æ˜¯å¦åœ¨æœ‰æ•ˆæœŸå†…<br>ï¼ˆ2ï¼‰æµè§ˆå™¨å¼€å§‹æŸ¥æ‰¾æ“ä½œç³»ç»Ÿä¸­å·²å†…ç½®çš„å—ä¿¡ä»»çš„è¯ä¹¦å‘å¸ƒæœºæ„CAï¼Œä¸æœåŠ¡å™¨å‘æ¥çš„è¯ä¹¦ä¸­çš„é¢å‘è€…CAæ¯”å¯¹ï¼Œç”¨äºæ ¡éªŒè¯ä¹¦æ˜¯å¦ä¸ºåˆæ³•æœºæ„é¢å‘<br>ï¼ˆ3ï¼‰å¦‚æœæ‰¾ä¸åˆ°ï¼Œæµè§ˆå™¨å°±ä¼šæŠ¥é”™ï¼Œè¯´æ˜æœåŠ¡å™¨å‘æ¥çš„è¯ä¹¦æ˜¯ä¸å¯ä¿¡ä»»çš„ã€‚<br>ï¼ˆ4ï¼‰å¦‚æœæ‰¾åˆ°ï¼Œé‚£ä¹ˆæµè§ˆå™¨å°±ä¼šä»æ“ä½œç³»ç»Ÿä¸­å–å‡ºé¢å‘è€…CA çš„å…¬é’¥(å¤šæ•°æµè§ˆå™¨å¼€å‘å•†å‘å¸ƒ<br>ç‰ˆæœ¬æ—¶ï¼Œä¼šäº‹å…ˆåœ¨å†…éƒ¨æ¤å…¥å¸¸ç”¨è®¤è¯æœºå…³çš„å…¬å¼€å¯†é’¥)ï¼Œç„¶åå¯¹æœåŠ¡å™¨å‘æ¥çš„è¯ä¹¦é‡Œé¢çš„ç­¾åè¿›è¡Œè§£å¯†<br>ï¼ˆ5ï¼‰æµè§ˆå™¨ä½¿ç”¨ç›¸åŒçš„hashç®—æ³•è®¡ç®—å‡ºæœåŠ¡å™¨å‘æ¥çš„è¯ä¹¦çš„hashå€¼ï¼Œå°†è¿™ä¸ªè®¡ç®—çš„hashå€¼ä¸è¯ä¹¦ä¸­ç­¾ååšå¯¹æ¯”<br>ï¼ˆ6ï¼‰å¯¹æ¯”ç»“æœä¸€è‡´ï¼Œåˆ™è¯æ˜æœåŠ¡å™¨å‘æ¥çš„è¯ä¹¦åˆæ³•ï¼Œæ²¡æœ‰è¢«å†’å……</p><h3 id="getä¸poståœ¨ç¼“å­˜æ–¹é¢çš„åŒºåˆ«"><a href="#getä¸poståœ¨ç¼“å­˜æ–¹é¢çš„åŒºåˆ«" class="headerlink" title="getä¸poståœ¨ç¼“å­˜æ–¹é¢çš„åŒºåˆ«"></a>getä¸poståœ¨ç¼“å­˜æ–¹é¢çš„åŒºåˆ«</h3><p>getè¯·æ±‚ç±»ä¼¼äºæŸ¥æ‰¾çš„è¿‡ç¨‹ï¼Œç”¨æˆ·è·å–æ•°æ®ï¼Œå¯ä»¥ä¸ç”¨æ¯æ¬¡éƒ½ä¸æ•°æ®åº“è¿æ¥ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ç¼“å­˜ã€‚<br>postä¸åŒï¼Œpoståšçš„ä¸€èˆ¬æ˜¯ä¿®æ”¹å’Œåˆ é™¤çš„å·¥ä½œï¼Œæ‰€ä»¥å¿…é¡»ä¸æ•°æ®åº“äº¤äº’ï¼Œæ‰€ä»¥ä¸èƒ½ä½¿ç”¨ç¼“å­˜ã€‚å› æ­¤getè¯·æ±‚é€‚åˆäºè¯·æ±‚ç¼“å­˜ã€‚</p><h3 id="å››ç§å­˜å‚¨"><a href="#å››ç§å­˜å‚¨" class="headerlink" title="å››ç§å­˜å‚¨"></a>å››ç§å­˜å‚¨</h3><ul><li>cookieçš„ç”Ÿå­˜æ—¶é—´<br>å¦‚æœä¸è®¾ç½®è¿‡æœŸæ—¶é—´<code>expires</code>ï¼Œåˆ™è¡¨ç¤ºè¿™ä¸ª cookie ç”Ÿå‘½å‘¨æœŸä¸ºæµè§ˆå™¨ä¼šè¯æœŸé—´ï¼Œåªè¦å…³é—­æµè§ˆå™¨çª—å£ï¼Œcookie å°±æ¶ˆå¤±äº†ã€‚è¿™ç§ç”Ÿå‘½æœŸä¸ºæµè§ˆä¼šè¯æœŸçš„ cookie è¢«ç§°ä¸ºä¼šè¯ cookieã€‚ä¼šè¯ cookie ä¸€èˆ¬ä¸ä¿å­˜åœ¨ç¡¬ç›˜ä¸Šè€Œæ˜¯ä¿å­˜åœ¨å†…å­˜é‡Œã€‚<br>ã€€ã€€å¦‚æœè®¾ç½®äº†è¿‡æœŸæ—¶é—´ï¼Œæµè§ˆå™¨å°±ä¼šæŠŠ cookie ä¿å­˜åˆ°ç¡¬ç›˜ä¸Šï¼Œå…³é—­åå†æ¬¡æ‰“å¼€æµè§ˆå™¨ï¼Œè¿™äº› cookie ä¾ç„¶æœ‰æ•ˆç›´åˆ°è¶…è¿‡è®¾å®šçš„è¿‡æœŸæ—¶é—´ã€‚</li></ul><h4 id="session"><a href="#session" class="headerlink" title="session"></a>session</h4><ul><li>sessionçš„æœ¬è´¨ï¼šå°±æ˜¯å­˜å‚¨åœ¨æœåŠ¡å™¨ä¸Šçš„ä¸€ä¸ªå“ˆå¸Œè¡¨ã€‚</li></ul><p>å°†sessionIDï¼ˆéšæœºæ•°ï¼‰ é€šè¿‡ Cookie å‘ç»™å®¢æˆ·ç«¯<br>å®¢æˆ·ç«¯è®¿é—®æœåŠ¡å™¨æ—¶ï¼ŒæœåŠ¡å™¨è¯»å– sessionID<br>æœåŠ¡å™¨æœ‰ä¸€å—å†…å­˜ï¼ˆå“ˆå¸Œè¡¨ï¼‰ä¿å­˜äº†æ‰€æœ‰ session<br>é€šè¿‡sessionID åå°å¯ä»¥å¾—åˆ°å¯¹åº”ç”¨æˆ·çš„éšç§ä¿¡æ¯ï¼Œå¦‚ idï¼Œemail<br>è¿™å—å†…å­˜ï¼ˆå“ˆå¸Œè¡¨ï¼‰å°±æ˜¯æœåŠ¡å™¨ä¸Šçš„æ‰€æœ‰ session</p><ul><li>ä¸ºä»€ä¹ˆä¼šæœ‰ session? cookieèƒ½è¢«ç”¨æˆ·æˆªå– ä¸å®‰å…¨<br>ä¹‹å‰çš„å†™æ³•ï¼šç›´æ¥å°†æ•°æ®æ”¾åˆ°cookieé‡Œé¢ï¼š<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response.setHeader(<span class="string">'Set-Cookie'</span>, <span class="string">`login_email=<span class="subst">$&#123;email&#125;</span>`</span>)</span><br></pre></td></tr></table></figure></li></ul><p>è¿™æ ·å†™ä¸€æ¥ä¼šæš´éœ²ç”¨æˆ·çš„ä¸ªäººä¿¡æ¯ï¼ŒäºŒæ¥ç”¨æˆ·å¯ä»¥ç›´æ¥é€šè¿‡æµè§ˆå™¨ä¿®æ”¹cookieï¼Œææœ‰å¯èƒ½è·å–åˆ°åˆ«äººçš„ç”¨æˆ·ä¿¡æ¯ï¼Œæä¸å®‰å…¨ã€‚å› æ­¤å‡ºç°äº†ä¸‹é¢çš„ä½¿ç”¨sessionçš„æ“ä½œï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> sessions = &#123;&#125;</span><br><span class="line"><span class="keyword">let</span> sessionId = <span class="built_in">Math</span>.random() * <span class="number">10000</span> <span class="comment">// è®¾ç½®sessionId ä¸ºä¸€ä¸ªéšæœºæ•°</span></span><br><span class="line">sessions[sessionId] = &#123;<span class="attr">login_email</span>:email&#125; <span class="comment">// å°†email å­˜å‚¨åœ¨sessionsè¿™ä¸ªå¯¹è±¡ä¸­</span></span><br><span class="line">response.setHeader(<span class="string">'Set-Cookie'</span>, <span class="string">`sessionId = <span class="subst">$&#123;sessionId&#125;</span>`</span>) </span><br><span class="line"><span class="comment">// cookieä¸­å­˜å‚¨çš„æ˜¯ sessionId è¿™ä¸ªéšæœºæ•°</span></span><br></pre></td></tr></table></figure><p>é¦–å…ˆæ¥è§£é‡Šä¸€ä¸‹ä¸Šé¢çš„ä»£ç ï¼šå³è®¾ç½®cookieçš„ä¸­å­˜å‚¨çš„å€¼ä¸ºä¸€ä¸ªéšæœºæ•°ï¼Œå½“åå°è·å–åˆ°cookieæ—¶ï¼Œå°±å¯ä»¥è·å–åˆ°è¯¥éšæœºæ•°å¹¶åœ¨sessionsè¿™ä¸ªå¯¹è±¡ä¸­æŸ¥æ‰¾keyä¸ºè¿™ä¸ªéšæœºæ•°çš„valueï¼Œå³å¯çŸ¥é“ç”¨æˆ·çš„é‚®ç®±æ˜¯ä»€ä¹ˆ ã€‚</p><ul><li>ä¸åŸºäºcookieèƒ½å¦å®ç°session<br>åç«¯å¾…ç”¨æˆ·ç™»é™†åè®¾ç½®ä»–çš„sessionIDï¼Œä½†ä¸æŠŠå®ƒæ”¾åœ¨ cookie é‡Œï¼Œè€Œæ˜¯å°†ä¿¡æ¯é€šè¿‡å“åº”ä½“ä¼ JSONç»™å‰ç«¯ã€‚<br>å‰ç«¯æ‹¿åˆ°å“åº”ä½“ä¸­çš„JSONåå°†å…¶è½¬æ¢æˆå¯¹è±¡ï¼ˆJSON.parseï¼‰<br>å°†ä»JSONä¸­è·å–åˆ°çš„æ•°æ®ï¼ˆå¦‚ sessionIDï¼‰æ”¾åœ¨ localStorage é‡Œé¢ï¼ˆlocalStorageé‡Œçš„æ•°æ®ç›®å‰æš‚æ—¶ç”¨ä¸åˆ°ï¼‰<br>ä»¥åè·³è½¬åˆ°å…¶ä»–é¡µé¢ï¼ˆå¦‚é¦–é¡µï¼‰æ—¶ï¼Œå°† sessionID æ”¾åœ¨ URL çš„æŸ¥è¯¢å‚æ•°é‡Œï¼ˆå¦‚ï¼šwindow.location.href = â€˜/?sessionId=object.sessionIdâ€™ï¼‰<br>é‚£ä¹ˆè¿›å…¥é¦–é¡µåï¼Œè¯¥é¡µé¢çš„ URL çš„æŸ¥è¯¢å‚æ•°å°±å¸¦ä¸Šäº†ä½ çš„sessionID<br>åç«¯é€šè¿‡åœ¨ç”¨æˆ·è®¿é—®é¦–é¡µæ—¶ï¼Œä¼ åˆ°æœåŠ¡å™¨çš„ URL ï¼Œæ¥è·å–åˆ°æŸ¥è¯¢å‚æ•°ï¼Œä»è€Œè·å–åˆ°ç”¨æˆ·çš„ sessionIDï¼Œç„¶ååœ¨æ•°æ®åº“ä¸­æŸ¥åˆ°sessionIDå¯¹åº”çš„ä¿¡æ¯å°±å¯ä»¥çŸ¥é“ç”¨æˆ·æ˜¯è°ã€‚</li></ul><h3 id="ä¸ºä»€ä¹ˆé€šå¸¸åœ¨å‘é€æ•°æ®åŸ‹ç‚¹è¯·æ±‚çš„æ—¶å€™ä½¿ç”¨çš„æ˜¯-1x1-åƒç´ çš„é€æ˜-gif-å›¾ç‰‡"><a href="#ä¸ºä»€ä¹ˆé€šå¸¸åœ¨å‘é€æ•°æ®åŸ‹ç‚¹è¯·æ±‚çš„æ—¶å€™ä½¿ç”¨çš„æ˜¯-1x1-åƒç´ çš„é€æ˜-gif-å›¾ç‰‡" class="headerlink" title="ä¸ºä»€ä¹ˆé€šå¸¸åœ¨å‘é€æ•°æ®åŸ‹ç‚¹è¯·æ±‚çš„æ—¶å€™ä½¿ç”¨çš„æ˜¯ 1x1 åƒç´ çš„é€æ˜ gif å›¾ç‰‡"></a>ä¸ºä»€ä¹ˆé€šå¸¸åœ¨å‘é€æ•°æ®åŸ‹ç‚¹è¯·æ±‚çš„æ—¶å€™ä½¿ç”¨çš„æ˜¯ 1x1 åƒç´ çš„é€æ˜ gif å›¾ç‰‡</h3><p>ä½œç”¨ï¼šå·¥ä½œä¸­ï¼Œç”¨äºå‰ç«¯ç›‘æ§ï¼Œæ¯”å¦‚æ›å…‰ç­‰ç­‰ï¼Œè°·æ­Œå’Œç™¾åº¦çš„éƒ½æ˜¯ç”¨çš„1x1 åƒç´ çš„é€æ˜ gif å›¾ç‰‡ï¼›<br>why?</p><p>æ²¡æœ‰è·¨åŸŸé—®é¢˜ï¼Œä¸€èˆ¬è¿™ç§ä¸ŠæŠ¥æ•°æ®ï¼Œä»£ç è¦å†™é€šç”¨çš„ï¼›ï¼ˆæ’é™¤ajaxï¼‰<br>ä¸ä¼šé˜»å¡é¡µé¢åŠ è½½ï¼Œå½±å“ç”¨æˆ·çš„ä½“éªŒï¼Œåªè¦new Imageå¯¹è±¡å°±å¥½äº†ï¼›ï¼ˆæ’é™¤JS/CSSæ–‡ä»¶èµ„æºæ–¹å¼ä¸ŠæŠ¥ï¼‰<br>åœ¨æ‰€æœ‰å›¾ç‰‡ä¸­ï¼Œä½“ç§¯æœ€å°ï¼›ï¼ˆæ¯”è¾ƒPNG/JPGï¼‰</p><h3 id="cookie-å’Œ-localStorage-çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ"><a href="#cookie-å’Œ-localStorage-çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ" class="headerlink" title="cookie å’Œ localStorage çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ"></a>cookie å’Œ localStorage çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ</h3><p>ç­”ï¼šcookie æ¯æ¬¡è¯·æ±‚ä¼šè¢«å¸¦ç»™æœåŠ¡å™¨ï¼Œè€Œ localStorageä¸ä¼šï¼›cookieçš„æœ€å¤§å‚¨å­˜é‡ä¸€èˆ¬åªæœ‰4kï¼Œè€ŒlocalStorage ä¸€èˆ¬æœ‰5Mb</p><h3 id="sessionstorageè·Ÿlocalstorageçš„åŒºåˆ«"><a href="#sessionstorageè·Ÿlocalstorageçš„åŒºåˆ«" class="headerlink" title="sessionstorageè·Ÿlocalstorageçš„åŒºåˆ«"></a>sessionstorageè·Ÿlocalstorageçš„åŒºåˆ«</h3><p>localStorage: åœ¨åŒä¸€ä¸ªæµè§ˆå™¨å†…ï¼ŒåŒæºæ–‡æ¡£ä¹‹é—´å…±äº« localStorage æ•°æ®ï¼Œå¯ä»¥äº’ç›¸è¯»å–ã€è¦†ç›–ã€‚<br>sessionStorage: ä¸ localStorage ä¸€æ ·éœ€è¦åŒä¸€æµè§ˆå™¨åŒæºæ–‡æ¡£è¿™ä¸€æ¡ä»¶ã€‚ä¸ä»…å¦‚æ­¤ï¼ŒsessionStorage çš„ä½œç”¨åŸŸè¿˜è¢«é™å®šåœ¨äº†çª—å£ä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåªæœ‰åŒä¸€æµè§ˆå™¨ã€åŒä¸€çª—å£çš„åŒæºæ–‡æ¡£æ‰èƒ½å…±äº«æ•°æ®ã€‚</p><h3 id="tcpçš„æµé‡æ§åˆ¶ä¸æ‹¥å¡æ§åˆ¶"><a href="#tcpçš„æµé‡æ§åˆ¶ä¸æ‹¥å¡æ§åˆ¶" class="headerlink" title="tcpçš„æµé‡æ§åˆ¶ä¸æ‹¥å¡æ§åˆ¶"></a>tcpçš„æµé‡æ§åˆ¶ä¸æ‹¥å¡æ§åˆ¶</h3><ul><li><p>æµé‡æ§åˆ¶ ï¼ˆå®ç°ï¼šä¸»è¦çš„æ–¹å¼å°±æ˜¯æ¥æ”¶æ–¹è¿”å›çš„ ACK ä¸­ä¼šåŒ…å«è‡ªå·±çš„æ¥æ”¶çª—å£çš„å¤§å°ï¼Œå¹¶ä¸”åˆ©ç”¨å¤§å°æ¥æ§åˆ¶å‘é€æ–¹çš„æ•°æ®å‘é€ã€‚ï¼‰<br>å¦‚æœå‘é€è€…å‘é€æ•°æ®è¿‡å¿«ï¼Œæ¥æ”¶è€…æ¥ä¸åŠæ¥æ”¶ï¼Œé‚£ä¹ˆå°±ä¼šæœ‰åˆ†ç»„ä¸¢å¤±ã€‚ä¸ºäº†é¿å…åˆ†ç»„ä¸¢å¤±ï¼Œæ§åˆ¶å‘é€è€…çš„å‘é€é€Ÿåº¦ï¼Œä½¿å¾—æ¥æ”¶è€…æ¥å¾—åŠæ¥æ”¶ï¼Œè¿™å°±æ˜¯æµé‡æ§åˆ¶ã€‚æµé‡æ§åˆ¶æ ¹æœ¬ç›®çš„æ˜¯é˜²æ­¢åˆ†ç»„ä¸¢å¤±ï¼Œå®ƒæ˜¯æ„æˆTCPå¯é æ€§çš„ä¸€æ–¹é¢ã€‚</p></li><li><p>æµé‡æ§åˆ¶ä¸æ‹¥å¡æ§åˆ¶çš„åŒºåˆ«<br>æ‹¥å¡æ§åˆ¶ï¼šæ‹¥å¡æ§åˆ¶æ˜¯ä½œç”¨äºç½‘ç»œçš„ï¼Œå®ƒæ˜¯é˜²æ­¢è¿‡å¤šçš„æ•°æ®æ³¨å…¥åˆ°ç½‘ç»œä¸­ï¼Œé¿å…å‡ºç°ç½‘ç»œè´Ÿè½½è¿‡å¤§çš„æƒ…å†µï¼›å¸¸ç”¨çš„æ–¹æ³•å°±æ˜¯ï¼šï¼ˆ 1 ï¼‰æ…¢å¼€å§‹ã€æ‹¥å¡é¿å…ï¼ˆ 2 ï¼‰å¿«é‡ä¼ ã€å¿«æ¢å¤ã€‚</p></li></ul><p>æµé‡æ§åˆ¶ï¼šæµé‡æ§åˆ¶æ˜¯ä½œç”¨äºæ¥æ”¶è€…çš„ï¼Œå®ƒæ˜¯æ§åˆ¶å‘é€è€…çš„å‘é€é€Ÿåº¦ä»è€Œä½¿æ¥æ”¶è€…æ¥å¾—åŠæ¥æ”¶ï¼Œé˜²æ­¢åˆ†ç»„ä¸¢å¤±çš„</p><h3 id="åŸŸåè§£æ"><a href="#åŸŸåè§£æ" class="headerlink" title="åŸŸåè§£æ"></a>åŸŸåè§£æ</h3><p>1ã€æµè§ˆå™¨ä¸­è¾“å…¥æƒ³è¦è®¿é—®çš„ç½‘ç«™çš„åŸŸåï¼Œæ“ä½œç³»ç»Ÿä¼šå…ˆæ£€æŸ¥æœ¬åœ°çš„hostsæ–‡ä»¶æ˜¯å¦æœ‰è¿™ä¸ªç½‘å€æ˜ å°„å…³ç³»ï¼Œå¦‚æœæœ‰ï¼Œå°±å…ˆè°ƒç”¨è¿™ä¸ªIPåœ°å€æ˜ å°„ï¼Œå®ŒæˆåŸŸåè§£æã€‚<br>2ã€å¦‚æœhostsé‡Œæ²¡æœ‰è¿™ä¸ªåŸŸåçš„æ˜ å°„ï¼Œå®¢æˆ·ç«¯ä¼šå‘æœ¬åœ°DNSæœåŠ¡å™¨å‘èµ·æŸ¥è¯¢ã€‚æœ¬åœ°DNSæœåŠ¡å™¨æ”¶åˆ°æŸ¥è¯¢æ—¶ï¼Œå¦‚æœè¦æŸ¥è¯¢çš„åŸŸååŒ…å«åœ¨æœ¬åœ°é…ç½®åŒºåŸŸèµ„æºä¸­ï¼Œåˆ™è¿”å›è§£æç»“æœç»™å®¢æˆ·æœºï¼Œå®ŒæˆåŸŸåè§£æã€‚<br>3ã€å¦‚æœæœ¬åœ°DNSæœåŠ¡å™¨æœ¬åœ°åŒºåŸŸæ–‡ä»¶ä¸ç¼“å­˜è§£æéƒ½å¤±æ•ˆï¼Œåˆ™æ ¹æ®æœ¬åœ°DNSæœåŠ¡å™¨çš„è®¾ç½®ï¼Œ<code>é‡‡ç”¨é€’å½’æˆ–è€…è¿­ä»£æŸ¥è¯¢</code>ï¼Œç›´è‡³è§£æå®Œæˆã€‚</p><ul><li><p>é€’å½’æŸ¥è¯¢<br><img src="https://user-gold-cdn.xitu.io/2018/5/27/1639fd992859d5f1?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img"></p></li><li><p>è¿­ä»£æŸ¥è¯¢<br><img src="https://user-gold-cdn.xitu.io/2018/5/27/1639fdb27f876e0d?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img"></p></li></ul><h3 id="æµè§ˆå™¨å®‰å…¨"><a href="#æµè§ˆå™¨å®‰å…¨" class="headerlink" title="æµè§ˆå™¨å®‰å…¨"></a>æµè§ˆå™¨å®‰å…¨</h3><ul><li>CSRF çš„é˜²å¾¡</li></ul><blockquote><p>1ã€å°½é‡ä½¿ç”¨ POSTï¼Œé™åˆ¶ GET<br>GET æ¥å£å¤ªå®¹æ˜“è¢«æ‹¿æ¥åš CSRF æ”»å‡»ï¼Œçœ‹ä¸Šé¢ç¤ºä¾‹å°±çŸ¥é“ï¼Œåªè¦æ„é€ ä¸€ä¸ª img æ ‡ç­¾ï¼Œè€Œ img æ ‡ç­¾åˆæ˜¯ä¸èƒ½è¿‡æ»¤çš„æ•°æ®ã€‚æ¥å£æœ€å¥½é™åˆ¶ä¸º POST ä½¿ç”¨ï¼ŒGET åˆ™æ— æ•ˆï¼Œé™ä½æ”»å‡»é£é™©ã€‚<br>å½“ç„¶ POST å¹¶ä¸æ˜¯ä¸‡æ— ä¸€å¤±ï¼Œæ”»å‡»è€…åªè¦æ„é€ ä¸€ä¸ª form å°±å¯ä»¥ï¼Œä½†éœ€è¦åœ¨ç¬¬ä¸‰æ–¹é¡µé¢åšï¼Œè¿™æ ·å°±å¢åŠ æš´éœ²çš„å¯èƒ½æ€§ã€‚<br>2ã€å°† cookie è®¾ç½®ä¸º HttpOnly<br>CRSF æ”»å‡»å¾ˆå¤§ç¨‹åº¦ä¸Šæ˜¯åˆ©ç”¨äº†æµè§ˆå™¨çš„ cookieï¼Œä¸ºäº†é˜²æ­¢ç«™å†…çš„ XSS æ¼æ´ç›—å– cookie,éœ€è¦åœ¨ cookie ä¸­è®¾ç½®â€œHttpOnlyâ€å±æ€§ï¼Œè¿™æ ·é€šè¿‡ç¨‹åºï¼ˆå¦‚ JavaScript è„šæœ¬ã€Applet ç­‰ï¼‰å°±æ— æ³•è¯»å–åˆ° cookie ä¿¡æ¯ï¼Œé¿å…äº†æ”»å‡»è€…ä¼ªé€  cookie çš„æƒ…å†µå‡ºç°ã€‚<br>åœ¨ Java çš„ Servlet çš„ API ä¸­è®¾ç½® cookie ä¸º HttpOnly çš„ä»£ç å¦‚ä¸‹ï¼š<br>response.setHeader( â€œSet-Cookieâ€, â€œcookiename=cookievalue;HttpOnlyâ€);<br>3ã€å¢åŠ  token<br>CSRF æ”»å‡»ä¹‹æ‰€ä»¥èƒ½å¤ŸæˆåŠŸï¼Œæ˜¯å› ä¸ºæ”»å‡»è€…å¯ä»¥ä¼ªé€ ç”¨æˆ·çš„è¯·æ±‚ï¼Œè¯¥è¯·æ±‚ä¸­æ‰€æœ‰çš„ç”¨æˆ·éªŒè¯ä¿¡æ¯éƒ½å­˜åœ¨äº cookie ä¸­ï¼Œå› æ­¤æ”»å‡»è€…å¯ä»¥åœ¨ä¸çŸ¥é“ç”¨æˆ·éªŒè¯ä¿¡æ¯çš„æƒ…å†µä¸‹ç›´æ¥åˆ©ç”¨ç”¨æˆ·çš„ cookie æ¥é€šè¿‡å®‰å…¨éªŒè¯ã€‚ç”±æ­¤å¯çŸ¥ï¼Œ<br>æŠµå¾¡ CSRF æ”»å‡»çš„å…³é”®åœ¨äºï¼šåœ¨è¯·æ±‚ä¸­æ”¾å…¥æ”»å‡»è€…æ‰€ä¸èƒ½ä¼ªé€ çš„ä¿¡æ¯ï¼Œå¹¶ä¸”è¯¥ä¿¡æ€»ä¸å­˜åœ¨äº cookie ä¹‹ä¸­ã€‚é‰´äºæ­¤ï¼Œç³»ç»Ÿå¼€å‘äººå‘˜å¯ä»¥åœ¨ HTTP è¯·æ±‚ä¸­ä»¥å‚æ•°çš„å½¢å¼åŠ å…¥ä¸€ä¸ªéšæœºäº§ç”Ÿçš„ tokenï¼Œå¹¶åœ¨æœåŠ¡ç«¯è¿›è¡Œ token æ ¡éªŒï¼Œå¦‚æœè¯·æ±‚ä¸­æ²¡æœ‰ token æˆ–è€… token å†…å®¹ä¸æ­£ç¡®ï¼Œåˆ™è®¤ä¸ºæ˜¯ CSRF æ”»å‡»è€Œæ‹’ç»è¯¥è¯·æ±‚ã€‚<br>å‡è®¾è¯·æ±‚é€šè¿‡ POST æ–¹å¼æäº¤ï¼Œåˆ™å¯ä»¥åœ¨ç›¸åº”çš„è¡¨å•ä¸­å¢åŠ ä¸€ä¸ªéšè—åŸŸï¼š<br><input type="hidden" name="_toicen" value="tokenvalue"><br>token çš„å€¼é€šè¿‡æœåŠ¡ç«¯ç”Ÿæˆï¼Œè¡¨å•æäº¤å token çš„å€¼é€šè¿‡ POST è¯·æ±‚ä¸å‚æ•°ä¸€åŒå¸¦åˆ°æœåŠ¡ç«¯ï¼Œæ¯æ¬¡ä¼šè¯å¯ä»¥ä½¿ç”¨ç›¸åŒçš„ tokenï¼Œä¼šè¯è¿‡æœŸï¼Œåˆ™ token å¤±æ•ˆï¼Œæ”»å‡»è€…å› æ— æ³•è·å–åˆ° tokenï¼Œä¹Ÿå°±æ— æ³•ä¼ªé€ è¯·æ±‚ã€‚<br>   note:<br>ã€€ã€€1ã€è¦ç¡®ä¿åŒä¸€é¡µé¢ä¸­æ¯ä¸ªè¡¨å•éƒ½å«æœ‰è‡ªå·±å”¯ä¸€çš„ä»¤ç‰Œ<br>ã€€ã€€2ã€éªŒè¯åéœ€è¦åˆ é™¤ç›¸åº”çš„éšæœºæ•°<br>   3ã€Token ä¿å­˜åœ¨ Session ä¸­ã€‚å‡å¦‚ Token ä¿å­˜åœ¨ Cookie ä¸­ï¼Œç”¨æˆ·æµè§ˆå™¨å¼€äº†å¾ˆå¤šé¡µé¢ã€‚åœ¨ä¸€äº›é¡µé¢ Token è¢«ä½¿ç”¨æ¶ˆè€—æ‰åæ–°çš„Token ä¼šè¢«é‡æ–°ç§å…¥ï¼Œä½†é‚£äº›è€çš„ Tab é¡µé¢å¯¹åº”çš„ HTML é‡Œè¿˜æ˜¯è€ Tokenã€‚è¿™ä¼šè®©ç”¨æˆ·è§‰å¾—ä¸ºå•¥å‡ åˆ†é’Ÿå‰æ‰“å¼€çš„é¡µé¢ä¸èƒ½æ­£å¸¸æäº¤ï¼Ÿ<br>åœ¨ session ä¸­æ·»åŠ  token çš„å®ç°ä»£ç ï¼š</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">HttpSession session = request.getSession();</span><br><span class="line"><span class="built_in">Object</span> token = session.getAttribute(<span class="string">"_token"</span>);</span><br><span class="line"><span class="keyword">if</span>(token == <span class="literal">null</span> I I <span class="string">""</span>.equals(token)) &#123;</span><br><span class="line">    session.setAttribute(<span class="string">"_token"</span>, UUID.randomUUIDO .toString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>4ã€é€šè¿‡ Referer è¯†åˆ«<br>æ ¹æ® HTTP åè®®ï¼Œåœ¨ HTTP å¤´ä¸­æœ‰ä¸€ä¸ªå­—æ®µå« Refererï¼Œå®ƒè®°å½•äº†è¯¥ HTTP è¯·æ±‚çš„æ¥æºåœ°å€ã€‚åœ¨é€šå¸¸æƒ…å†µä¸‹ï¼Œè®¿é—®ä¸€ä¸ªå®‰å…¨å—é™çš„é¡µé¢çš„è¯·æ±‚éƒ½æ¥è‡ªäºåŒä¸€ä¸ªç½‘ç«™ã€‚æ¯”å¦‚æŸé“¶è¡Œçš„è½¬è´¦æ˜¯é€šè¿‡ç”¨æˆ·è®¿é—®<a href="http://www.xxx.com/transfer.doé¡µé¢å®Œæˆçš„ï¼Œç”¨æˆ·å¿…é¡»å…ˆç™»å½•www.xxx.comï¼Œç„¶åé€šè¿‡å•å‡»é¡µé¢ä¸Šçš„æäº¤æŒ‰é’®æ¥è§¦å‘è½¬è´¦äº‹ä»¶ã€‚å½“ç”¨æˆ·æäº¤è¯·æ±‚æ—¶ï¼Œè¯¥è½¬è´¦è¯·æ±‚çš„Refererå€¼å°±ä¼šæ˜¯" target="_blank" rel="noopener">http://www.xxx.com/transfer.doé¡µé¢å®Œæˆçš„ï¼Œç”¨æˆ·å¿…é¡»å…ˆç™»å½•www.xxx.comï¼Œç„¶åé€šè¿‡å•å‡»é¡µé¢ä¸Šçš„æäº¤æŒ‰é’®æ¥è§¦å‘è½¬è´¦äº‹ä»¶ã€‚å½“ç”¨æˆ·æäº¤è¯·æ±‚æ—¶ï¼Œè¯¥è½¬è´¦è¯·æ±‚çš„Refererå€¼å°±ä¼šæ˜¯</a><br>æäº¤æŒ‰é’®æ‰€åœ¨é¡µé¢çš„ URLï¼ˆæœ¬ä¾‹ä¸º <a href="http://www.xxx" target="_blank" rel="noopener">www.xxx</a>. com/transfer.doï¼‰ã€‚å¦‚æœæ”»å‡»è€…è¦å¯¹é“¶è¡Œç½‘ç«™å®æ–½ CSRF æ”»å‡»ï¼Œä»–åªèƒ½åœ¨å…¶ä»–ç½‘ç«™æ„é€ è¯·æ±‚ï¼Œå½“ç”¨æˆ·é€šè¿‡å…¶ä»–ç½‘ç«™å‘é€è¯·æ±‚åˆ°é“¶è¡Œæ—¶ï¼Œè¯¥è¯·æ±‚çš„ Referer çš„å€¼æ˜¯å…¶ä»–ç½‘ç«™çš„åœ°å€ï¼Œè€Œä¸æ˜¯é“¶è¡Œè½¬è´¦é¡µé¢çš„åœ°å€ã€‚å› æ­¤ï¼Œè¦é˜²å¾¡ CSRF æ”»å‡»ï¼Œé“¶è¡Œç½‘ç«™åªéœ€è¦å¯¹äºæ¯ä¸€ä¸ªè½¬è´¦è¯·æ±‚éªŒè¯å…¶ Referer å€¼å³å¯ï¼Œå¦‚æœæ˜¯ä»¥ <a href="http://www.xx.om" target="_blank" rel="noopener">www.xx.om</a> åŸŸåå¼€å¤´çš„åœ°å€ï¼Œåˆ™è¯´æ˜è¯¥è¯·æ±‚æ˜¯æ¥è‡ªé“¶è¡Œç½‘ç«™è‡ªå·±çš„è¯·æ±‚ï¼Œæ˜¯åˆæ³•çš„ï¼›å¦‚æœ Referer æ˜¯å…¶ä»–ç½‘ç«™ï¼Œå°±æœ‰å¯èƒ½æ˜¯ CSRF æ”»å‡»ï¼Œåˆ™æ‹’ç»è¯¥è¯·æ±‚ã€‚<br>å–å¾— HTTP è¯·æ±‚ Refererï¼š<br>String referer = request.getHeader(â€œRefererâ€);<br>5.ä½¿ç”¨éªŒè¯ç </p><ul><li><a href="https://tech.meituan.com/2018/09/27/fe-security.html" target="_blank" rel="noopener">xssæ”»å‡»æ–¹å¼ä»¥åŠé˜²å¾¡</a></li></ul></blockquote><ul><li>ä¸­é—´äººæ”»å‡»<br>ä¸­é—´äººæ”»å‡»è¿‡ç¨‹å¦‚ä¸‹ï¼š</li></ul><p>æœåŠ¡å™¨å‘å®¢æˆ·ç«¯å‘é€å…¬é’¥ã€‚<br>æ”»å‡»è€…æˆªè·å…¬é’¥ï¼Œä¿ç•™åœ¨è‡ªå·±æ‰‹ä¸Šã€‚<br>ç„¶åæ”»å‡»è€…è‡ªå·±ç”Ÿæˆä¸€ä¸ªã€ä¼ªé€ çš„ã€‘å…¬é’¥ï¼Œå‘ç»™å®¢æˆ·ç«¯ã€‚<br>å®¢æˆ·ç«¯æ”¶åˆ°ä¼ªé€ çš„å…¬é’¥åï¼Œç”ŸæˆåŠ å¯†hashå€¼å‘ç»™æœåŠ¡å™¨ã€‚<br>æ”»å‡»è€…è·å¾—åŠ å¯†hashå€¼ï¼Œç”¨è‡ªå·±çš„ç§é’¥è§£å¯†è·å¾—çœŸç§˜é’¥ã€‚<br>åŒæ—¶ç”Ÿæˆå‡çš„åŠ å¯†hashå€¼ï¼Œå‘ç»™æœåŠ¡å™¨ã€‚<br>æœåŠ¡å™¨ç”¨ç§é’¥è§£å¯†è·å¾—å‡ç§˜é’¥ã€‚<br>æœåŠ¡å™¨ç”¨åŠ ç§˜é’¥åŠ å¯†ä¼ è¾“ä¿¡æ¯<br>é˜²èŒƒæ–¹æ³•ï¼š</p><p>æœåŠ¡ç«¯åœ¨å‘é€æµè§ˆå™¨çš„å…¬é’¥ä¸­åŠ å…¥CAè¯ä¹¦ï¼Œæµè§ˆå™¨å¯ä»¥éªŒè¯CAè¯ä¹¦çš„æœ‰æ•ˆæ€§<br>å¼ºåˆ¶é¡µé¢ä½¿ç”¨https é˜²å¾¡ä¸­é—´äººæ”»å‡»</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">requestHandler</span>(<span class="params">req, res</span>)</span>&#123;</span><br><span class="line">    res.setHeader(<span class="string">'Strict-Transport-Security'</span>,<span class="string">'max-age=31536000; includeSubDomains; preload'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ·±å…¥äº†è§£æµè§ˆå™¨ç¼“å­˜æœºåˆ¶"><a href="#æ·±å…¥äº†è§£æµè§ˆå™¨ç¼“å­˜æœºåˆ¶" class="headerlink" title="æ·±å…¥äº†è§£æµè§ˆå™¨ç¼“å­˜æœºåˆ¶"></a>æ·±å…¥äº†è§£æµè§ˆå™¨ç¼“å­˜æœºåˆ¶</h3><p><a href="https://www.jianshu.com/p/54cc04190252" target="_blank" rel="noopener">https://www.jianshu.com/p/54cc04190252</a><br>è¡¥å……ï¼šå…³äºå¼ºç¼“å­˜å–èµ„æºçš„ä½ç½®<br>å¦‚æœå¼€å¯äº†Service Workeré¦–å…ˆä¼šä»Service Workerä¸­æ‹¿<br>å¦‚æœæ–°å¼€ä¸€ä¸ªä»¥å‰æ‰“å¼€è¿‡çš„é¡µé¢ç¼“å­˜ä¼šä»Disk Cacheä¸­æ‹¿ï¼ˆå‰ææ˜¯å‘½ä¸­å¼ºç¼“å­˜ï¼‰<br>åˆ·æ–°å½“å‰é¡µé¢æ—¶æµè§ˆå™¨ä¼šæ ¹æ®å½“å‰è¿è¡Œç¯å¢ƒå†…å­˜æ¥å†³å®šæ˜¯ä» Memory Cache è¿˜æ˜¯ ä»Disk Cacheä¸­æ‹¿(å¯ä»¥çœ‹åˆ°ä¸‹å›¾æœ€åå‡ ä¸ªæ–‡ä»¶æœ‰æ—¶å€™æ˜¯ä» Memory Cacheä¸­æ‹¿æœ‰æ—¶å€™æ˜¯ä»Disk Cacheä¸­æ‹¿)</p><h3 id="303ä¸302çš„åŒºåˆ«"><a href="#303ä¸302çš„åŒºåˆ«" class="headerlink" title="303ä¸302çš„åŒºåˆ«"></a>303ä¸302çš„åŒºåˆ«</h3><p>303 å¸¸ç”¨äºå°† POST è¯·æ±‚é‡å®šå‘åˆ° GET è¯·æ±‚ï¼Œæ¯”å¦‚ä½ ä¸Šä¼ äº†ä¸€ä»½ä¸ªäººä¿¡æ¯ï¼ŒæœåŠ¡å™¨å‘å›ä¸€ä¸ª 303 å“åº”ï¼Œå°†ä½ å¯¼å‘ä¸€ä¸ªâ€œä¸Šä¼ æˆåŠŸâ€é¡µé¢ã€‚</p><h3 id="websoket-httpä¹‹é—´çš„è”ç³»"><a href="#websoket-httpä¹‹é—´çš„è”ç³»" class="headerlink" title="websoket httpä¹‹é—´çš„è”ç³»"></a>websoket httpä¹‹é—´çš„è”ç³»</h3><ol><li>éƒ½æ˜¯ä¸€æ ·åŸºäºTCPçš„ï¼Œéƒ½æ˜¯å¯é æ€§ä¼ è¾“åè®®ã€‚</li><li>éƒ½æ˜¯åº”ç”¨å±‚åè®®ã€‚</li></ol><p>WebSocketåœ¨å»ºç«‹æ¡æ‰‹æ—¶ï¼Œæ•°æ®æ˜¯é€šè¿‡HTTPä¼ è¾“çš„ã€‚ä½†æ˜¯å»ºç«‹ä¹‹åï¼Œåœ¨çœŸæ­£ä¼ è¾“æ—¶å€™æ˜¯ä¸éœ€è¦HTTPåè®®çš„ã€‚</p><p>WebSocketè¿æ¥çš„è¿‡ç¨‹æ˜¯ï¼š</p><p>é¦–å…ˆï¼Œå®¢æˆ·ç«¯å‘èµ·httpè¯·æ±‚ï¼Œç»è¿‡3æ¬¡æ¡æ‰‹åï¼Œå»ºç«‹èµ·TCPè¿æ¥ï¼›httpè¯·æ±‚é‡Œå­˜æ”¾WebSocketæ”¯æŒçš„ç‰ˆæœ¬å·ç­‰ä¿¡æ¯ï¼Œå¦‚ï¼šUpgradeã€Connectionã€WebSocket-Versionç­‰ï¼›<br>ç„¶åï¼ŒæœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯çš„æ¡æ‰‹è¯·æ±‚åï¼ŒåŒæ ·é‡‡ç”¨HTTPåè®®å›é¦ˆæ•°æ®ï¼›<br>æœ€åï¼Œå®¢æˆ·ç«¯æ”¶åˆ°è¿æ¥æˆåŠŸçš„æ¶ˆæ¯åï¼Œå¼€å§‹å€ŸåŠ©äºTCPä¼ è¾“ä¿¡é“è¿›è¡Œå…¨åŒå·¥é€šä¿¡ã€‚</p><h3 id="http-keepalive"><a href="#http-keepalive" class="headerlink" title="http keepalive"></a>http keepalive</h3><p>Http keep-alive<br>åœ¨ HTTP 1.0 æ—¶æœŸï¼Œæ¯ä¸ª TCP è¿æ¥åªä¼šè¢«ä¸€ä¸ª HTTP Transactionï¼ˆè¯·æ±‚åŠ å“åº”ï¼‰ä½¿ç”¨ï¼Œè¯·æ±‚æ—¶å»ºç«‹ï¼Œè¯·æ±‚å®Œæˆé‡Šæ”¾è¿æ¥ã€‚å½“ç½‘é¡µå†…å®¹è¶Šæ¥è¶Šå¤æ‚ï¼ŒåŒ…å«å¤§é‡å›¾ç‰‡ã€CSS ç­‰èµ„æºä¹‹åï¼Œè¿™ç§æ¨¡å¼æ•ˆç‡å°±æ˜¾å¾—å¤ªä½äº†ã€‚æ‰€ä»¥ï¼Œåœ¨ HTTP 1.1 ä¸­ï¼Œå¼•å…¥äº† HTTP persistent connection çš„æ¦‚å¿µï¼Œä¹Ÿç§°ä¸º HTTP keep-aliveï¼Œç›®çš„æ˜¯å¤ç”¨TCPè¿æ¥ï¼Œåœ¨ä¸€ä¸ªTCPè¿æ¥ä¸Šè¿›è¡Œå¤šæ¬¡çš„HTTPè¯·æ±‚ä»è€Œæé«˜æ€§èƒ½ã€‚</p><h3 id="tcp-keepalive"><a href="#tcp-keepalive" class="headerlink" title="tcp keepalive"></a>tcp keepalive</h3><p>åœ¨ä½¿ç”¨TCPé•¿è¿æ¥ï¼ˆå¤ç”¨å·²å»ºç«‹TCPè¿æ¥ï¼‰çš„åœºæ™¯ä¸‹ï¼Œéœ€è¦å¯¹TCPè¿æ¥è¿›è¡Œä¿æ´»ï¼Œé¿å…è¢«ç½‘å…³å¹²æ‰è¿æ¥ã€‚<br>åœ¨åº”ç”¨å±‚ï¼Œå¯ä»¥é€šè¿‡å®šæ—¶å‘é€å¿ƒè·³åŒ…çš„æ–¹å¼å®ç°ã€‚</p><h3 id="æ•°å­—ç­¾åå·¥ä½œåŸç†"><a href="#æ•°å­—ç­¾åå·¥ä½œåŸç†" class="headerlink" title="æ•°å­—ç­¾åå·¥ä½œåŸç†"></a>æ•°å­—ç­¾åå·¥ä½œåŸç†</h3><p><a href="https://blog.51cto.com/winda/1968298" target="_blank" rel="noopener">https://blog.51cto.com/winda/1968298</a></p><h3 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h3><ul><li><a href="https://www.jianshu.com/p/9ed3e8759ce3" target="_blank" rel="noopener">æµè§ˆå™¨ç¼“å­˜æ§åˆ¶è¯¦è§£ï¼ˆcookieã€sessionã€localStorageã€Cache-Controlç­‰</a></li><li><a href="https://www.jianshu.com/p/67408d73c66d" target="_blank" rel="noopener">å®‰å…¨|å¸¸è§çš„Webæ”»å‡»æ‰‹æ®µä¹‹CSRFæ”»å‡»</a></li></ul><ul><li><a href="https://github.com/yygmind/blog/issues/43" target="_blank" rel="noopener">å‰ç«¯ 100 é—®ï¼šèƒ½ææ‡‚80%çš„è¯·æŠŠç®€å†ç»™æˆ‘</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> é¢ç» </category>
          
          <category> æµè§ˆå™¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ç§‹å­£å‰ç«¯é¢ç»è®°å½•</title>
      <link href="/ashley271017.github.io/2019/12/11/%E7%A7%8B%E5%AD%A3%E5%89%8D%E7%AB%AF%E9%9D%A2%E7%BB%8F%E8%AE%B0%E5%BD%95/"/>
      <url>/ashley271017.github.io/2019/12/11/%E7%A7%8B%E5%AD%A3%E5%89%8D%E7%AB%AF%E9%9D%A2%E7%BB%8F%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<h3 id="é—®åˆ°sessionstorageè·Ÿlocalstorageçš„åŒºåˆ«-ç­”å‰è€…åªåœ¨å½“å‰çª—å£æœ‰æ•ˆæ˜¯å¯¹çš„-å†é—®ä¸€éåˆä¸ç¡®å®šäº†-è¯´æ˜åŸºç¡€ä¸ç‰¢å›ºå®¹æ˜“è¢«å¥—è·¯"><a href="#é—®åˆ°sessionstorageè·Ÿlocalstorageçš„åŒºåˆ«-ç­”å‰è€…åªåœ¨å½“å‰çª—å£æœ‰æ•ˆæ˜¯å¯¹çš„-å†é—®ä¸€éåˆä¸ç¡®å®šäº†-è¯´æ˜åŸºç¡€ä¸ç‰¢å›ºå®¹æ˜“è¢«å¥—è·¯" class="headerlink" title="é—®åˆ°sessionstorageè·Ÿlocalstorageçš„åŒºåˆ« ç­”å‰è€…åªåœ¨å½“å‰çª—å£æœ‰æ•ˆæ˜¯å¯¹çš„ å†é—®ä¸€éåˆä¸ç¡®å®šäº† è¯´æ˜åŸºç¡€ä¸ç‰¢å›ºå®¹æ˜“è¢«å¥—è·¯"></a>é—®åˆ°<code>sessionstorage</code>è·Ÿ<code>localstorage</code>çš„åŒºåˆ« ç­”å‰è€…åªåœ¨å½“å‰çª—å£æœ‰æ•ˆæ˜¯å¯¹çš„ å†é—®ä¸€éåˆä¸ç¡®å®šäº† è¯´æ˜åŸºç¡€ä¸ç‰¢å›ºå®¹æ˜“è¢«å¥—è·¯</h3><ol><li>å­˜å‚¨å¤§å°ï¼š éƒ½ä¸º 5MB</li><li>å­˜å‚¨ä½ç½®ï¼š éƒ½åœ¨å®¢æˆ·ç«¯ï¼Œä¸äºˆæœåŠ¡å™¨è¿›è¡Œäº¤äº’é€šä¿¡</li><li>å­˜å‚¨å†…å®¹ç±»å‹ï¼š å­—ç¬¦ä¸²ï¼Œå¤æ‚çš„å¯¹è±¡å¯ä»¥ä½¿ç”¨ ECMAScript æä¾›çš„ JSON stringify å’Œ parse æ¥å¤„ç†</li><li>è·å–æ–¹å¼ï¼šwindow.localStorage, window.sessionStorage</li><li>åº”ç”¨åœºæ™¯ï¼š localStorage ç”¨äºé•¿æœŸç™»å½• and åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å·²ç™»å½•<br>sessionStorage æ•æ„Ÿè´¦å·ä¸€æ¬¡æ€§ç™»å½•</li></ol><h3 id="é¡µé¢å¡é¡¿-æ€ä¹ˆç›‘æµ‹åˆ°æ˜¯å“ªä¸€éƒ¨åˆ†çš„ä»£ç å‡ºç°äº†é—®é¢˜"><a href="#é¡µé¢å¡é¡¿-æ€ä¹ˆç›‘æµ‹åˆ°æ˜¯å“ªä¸€éƒ¨åˆ†çš„ä»£ç å‡ºç°äº†é—®é¢˜" class="headerlink" title="é¡µé¢å¡é¡¿ æ€ä¹ˆç›‘æµ‹åˆ°æ˜¯å“ªä¸€éƒ¨åˆ†çš„ä»£ç å‡ºç°äº†é—®é¢˜"></a>é¡µé¢å¡é¡¿ æ€ä¹ˆç›‘æµ‹åˆ°æ˜¯å“ªä¸€éƒ¨åˆ†çš„ä»£ç å‡ºç°äº†é—®é¢˜</h3><p><a href="http://www.ruanyifeng.com/blog/2017/09/flame-graph.html" target="_blank" rel="noopener">ç«ç„°å›¾</a>(å¯ä»¥çœ‹åˆ°æ¯ä¸ªå‡½æ•°å æ®çš„å®½åº¦ï¼Œè¶Šå®½è¡¨ç¤ºæ‰§è¡Œçš„æ—¶é—´è¶Šé•¿)</p><h3 id="è¦æ˜¯ä¸ç”¨æ¡†æ¶çš„è¯-æ€ä¹ˆä¼˜åŒ–ä»£ç çš„ç»“æ„ï¼Ÿ"><a href="#è¦æ˜¯ä¸ç”¨æ¡†æ¶çš„è¯-æ€ä¹ˆä¼˜åŒ–ä»£ç çš„ç»“æ„ï¼Ÿ" class="headerlink" title="è¦æ˜¯ä¸ç”¨æ¡†æ¶çš„è¯ æ€ä¹ˆä¼˜åŒ–ä»£ç çš„ç»“æ„ï¼Ÿ"></a>è¦æ˜¯ä¸ç”¨æ¡†æ¶çš„è¯ æ€ä¹ˆä¼˜åŒ–ä»£ç çš„ç»“æ„ï¼Ÿ</h3><h4 id="MVVM"><a href="#MVVM" class="headerlink" title="MVVM"></a>MVVM</h4><p>åˆç§°çŠ¶æ€æœºåˆ¶ï¼ŒView å’Œ ViewModel æ˜¯è¿›è¡Œç»‘å®šçš„ï¼Œæ”¹å˜ ViewModel å°±ä¼šç›´æ¥ä½œç”¨åˆ° View è§†å›¾ä¸Šï¼Œè€Œ View ä¼šæŠŠäº‹ä»¶ä¼ é€’ç»™ ViewModel,ViewModel å»å¯¹ Model è¿›è¡Œæ“ä½œå¹¶æ¥å—æ›´æ–°ã€‚</p><ul><li>Viewï¼šUI ç•Œé¢</li><li>ViewModelï¼šå®ƒæ˜¯ View çš„æŠ½è±¡ï¼Œè´Ÿè´£ View ä¸ Model ä¹‹é—´ä¿¡æ¯è½¬æ¢ï¼Œå°† View çš„ Command ä¼ é€åˆ° Modelï¼›<br>æ¯”èµ· MVP ä¸­ View éœ€è¦è‡ªå·±æä¾› APIï¼ŒMVVM åœ¨ VM ä¸­æ„å»ºä¸€ç»„çŠ¶æ€æ•°æ®ï¼ˆstate dataï¼‰ï¼Œä½œä¸º View çŠ¶æ€çš„æŠ½è±¡ã€‚ç„¶åé€šè¿‡åŒå‘æ•°æ®ç»‘å®šï¼ˆdata bindingï¼‰ä½¿ VM ä¸­çš„çŠ¶æ€æ•°æ®ï¼ˆstate dataï¼‰ä¸ View ä¸­çš„æ˜¾ç¤ºçŠ¶æ€ï¼ˆscreen stateï¼‰ä¿æŒä¸€è‡´ã€‚è¿™æ ·ï¼ŒVM ä¸­çš„å±•ç¤ºé€»è¾‘åªéœ€è¦ä¿®æ”¹å¯¹åº”çš„çŠ¶æ€æ•°æ®ï¼Œå°±å¯ä»¥æ§åˆ¶ View çš„çŠ¶æ€ï¼Œä»è€Œé¿å…åœ¨ View ä¸Šå¼€å‘å¤§é‡çš„æ¥å£</li><li>Modelï¼šæ•°æ®è®¿é—®å±‚</li></ul><p><img src="https://images2015.cnblogs.com/blog/1131758/201703/1131758-20170323093701283-975203660.png" alt="imgs"></p><p>ï¼Ÿä¸é€‚åˆ SEOï¼Ÿ</p><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬å®šä¹‰å¥½ä¸€ä¸ª JavaScript å¯¹è±¡ä½œä¸º Modelï¼Œå¹¶ä¸”æŠŠè¿™ä¸ª Model çš„ä¸¤ä¸ªå±æ€§ç»‘å®šåˆ° DOM èŠ‚ç‚¹ä¸Šï¼š</p><h4 id="MVC"><a href="#MVC" class="headerlink" title="MVC"></a>MVC</h4><p>View æŒæœ‰äº† Controllerï¼ŒæŠŠäº‹ä»¶ä¼ é€’ç»™ Controllerï¼ŒController ç”±æ­¤å»è§¦å‘ Model å±‚çš„äº‹ä»¶ï¼ŒModel æ›´æ–°å®Œæ•°æ®ï¼ˆç½‘ç»œæˆ–è€…æœ¬åœ°æ•°æ®ï¼‰ä¹‹åè§¦å‘ View çš„æ›´æ–°äº‹ä»¶</p><ul><li>View è´Ÿè´£æ¸²æŸ“ç”¨æˆ·ç•Œé¢ï¼Œåº”è¯¥é¿å…åœ¨ View ä¸­æ¶‰åŠä¸šåŠ¡é€»è¾‘</li><li>Controller è´Ÿè´£æ¥æ”¶ç”¨æˆ·è¾“å…¥ï¼Œæ ¹æ®ç”¨æˆ·è¾“å…¥è°ƒç”¨ Model é€»è¾‘ï¼Œå°†äº§ç”Ÿçš„ç»“æœäº¤ç»™ View éƒ¨åˆ†ï¼Œè®© View æ¸²æŸ“å‡ºå¿…è¦çš„è¾“å‡º</li><li>Model è´Ÿè´£ç®¡ç†æ•°æ®ï¼Œå¤§éƒ¨åˆ†ä¸šåŠ¡é€»è¾‘ä¹Ÿåº”è¯¥æ”¾åœ¨ Model</li></ul><p><strong>ç¼ºç‚¹ï¼š</strong> ç”±äºåœ¨å®ç°çš„è¿‡ç¨‹ä¸­ï¼Œå¾€å¾€å‡ºç° View ä¸ Model ä¸ç»è¿‡ Controller é€šä¿¡çš„ç°è±¡ï¼Œé€ æˆæ•°æ®æµæ··ä¹±ï¼Œéš¾ä»¥ç»´æŠ¤å’Œå¢åŠ åŠŸèƒ½</p><p><img src="https://www.peterchen.club/imgs/MVCDisadvantage.png" alt="imgs"></p><h4 id="mvc-ä¸-mvvm-çš„åŒºåˆ«"><a href="#mvc-ä¸-mvvm-çš„åŒºåˆ«" class="headerlink" title="mvc ä¸ mvvm çš„åŒºåˆ«"></a>mvc ä¸ mvvm çš„åŒºåˆ«</h4><p>MVVM ä¸ MVC æœ€å¤§çš„åŒºåˆ«å°±æ˜¯ï¼šå®ƒå®ç°äº† View å’Œ Model çš„è‡ªåŠ¨åŒæ­¥ï¼Œä¹Ÿå°±æ˜¯å½“ Model çš„å±æ€§æ”¹å˜æ—¶ï¼Œæˆ‘ä»¬ä¸ç”¨å†è‡ªå·±æ‰‹åŠ¨æ“ä½œ Dom å…ƒç´ ï¼Œæ¥æ”¹å˜ View çš„æ˜¾ç¤ºï¼Œè€Œæ˜¯æ”¹å˜å±æ€§åè¯¥å±æ€§å¯¹åº” View å±‚æ˜¾ç¤ºä¼šè‡ªåŠ¨æ”¹å˜</p><p>æ‹¿å…¸å‹çš„ MVVM æ¨¡å¼çš„ä»£è¡¨ï¼ŒVueï¼Œæ¥ä¸¾ä¾‹<br>html éƒ¨åˆ†ç›¸å½“äº View å±‚ï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œçš„ View é€šè¿‡é€šè¿‡æ¨¡æ¿è¯­æ³•æ¥å£°æ˜å¼çš„å°†æ•°æ®æ¸²æŸ“è¿› DOM å…ƒç´ ï¼Œå½“ ViewModel å¯¹ Model è¿›è¡Œæ›´æ–°æ—¶ï¼Œé€šè¿‡æ•°æ®ç»‘å®šæ›´æ–°åˆ° Viewã€‚</p><p>Vue å®ä¾‹ä¸­çš„ data ç›¸å½“äº Model å±‚ï¼Œè€Œ ViewModel å±‚çš„æ ¸å¿ƒæ˜¯ Vue ä¸­çš„åŒå‘æ•°æ®ç»‘å®šï¼Œå³ Model å˜åŒ–æ—¶ VIew å¯ä»¥å®æ—¶æ›´æ–°ï¼ŒView å˜åŒ–ä¹Ÿèƒ½è®© Model å‘ç”Ÿå˜åŒ–ã€‚</p><h3 id="è·¨åŸŸ"><a href="#è·¨åŸŸ" class="headerlink" title="è·¨åŸŸ"></a>è·¨åŸŸ</h3><p>è¡¥å……ï¼š</p><ul><li>cra ç”Ÿæˆçš„é¡¹ç›®æ”¯æŒåœ¨<code>package.json</code>å­—æ®µè®¾ç½®<code>proxy</code><br>å¦‚ï¼šwill proxy your request to <a href="http://localhost:4000/api/todos" target="_blank" rel="noopener">http://localhost:4000/api/todos</a> as a fallback</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"proxy"</span>: <span class="string">"http://localhost:4000"</span>,</span><br></pre></td></tr></table></figure><ul><li><p>æœ¬åœ°æµ‹è¯•ç”¨ é…ç½® hosts æ–‡ä»¶ å¦‚ï¼šâ€™127.0.0.1 xx.comâ€™æˆ–è€…æ˜¯é…ç½® switchyomega æ¯”å¦‚è¾“å…¥ test.xxx.com ä»£ç†åˆ° localhost è¿™æ ·å‘è¯·æ±‚çš„æ—¶å€™çš„ origin æ˜¯ test å°±ä¸ä¼šå‡ºç°è·¨åŸŸé”™è¯¯ ï¼ˆmidc æœ‰äº›æ¥å£æ˜¯èƒ½è·¨åŸŸçš„ï¼Œæ‰€ä»¥ origin æ˜¯ localhost çš„æ—¶å€™ä¹Ÿä¸ä¼šæŠ¥é”™ï¼‰</p></li><li><p><a href="https://segmentfault.com/a/1190000014882611" target="_blank" rel="noopener">postmessage+iframe</a></p></li></ul><h3 id="æ€§èƒ½ä¼˜åŒ–-ï¼ˆä¸è¦ä¸€ç›´è¯´-reactï¼‰"><a href="#æ€§èƒ½ä¼˜åŒ–-ï¼ˆä¸è¦ä¸€ç›´è¯´-reactï¼‰" class="headerlink" title="æ€§èƒ½ä¼˜åŒ– ï¼ˆä¸è¦ä¸€ç›´è¯´ reactï¼‰"></a>æ€§èƒ½ä¼˜åŒ– ï¼ˆä¸è¦ä¸€ç›´è¯´ reactï¼‰</h3><h3 id="è™šæ‹Ÿ-dom"><a href="#è™šæ‹Ÿ-dom" class="headerlink" title="è™šæ‹Ÿ dom"></a>è™šæ‹Ÿ dom</h3><p>å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„ JavaScript å¯¹è±¡ï¼ŒåŒ…å«äº† tagã€propsã€children ä¸‰ä¸ªå±æ€§ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  tag: <span class="string">'div'</span>,</span><br><span class="line">  props: &#123;</span><br><span class="line">    id: <span class="string">'app'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  chidren: [</span><br><span class="line">    &#123;</span><br><span class="line">      tag: <span class="string">'p'</span>,</span><br><span class="line">      props: &#123;</span><br><span class="line">        className: <span class="string">'text'</span></span><br><span class="line">      &#125;,</span><br><span class="line">      chidren: [</span><br><span class="line">        <span class="string">'hello world!!!'</span></span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸»æµçš„è™šæ‹Ÿ DOM åº“ï¼ˆsnabbdomã€virtual-domï¼‰ï¼Œé€šå¸¸éƒ½æœ‰ä¸€ä¸ª h å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯ React ä¸­çš„ React.createElementï¼Œä»¥åŠ Vue ä¸­çš„ render æ–¹æ³•ä¸­çš„ createElementï¼Œå¦å¤– React æ˜¯é€šè¿‡ babel å°† jsx è½¬æ¢ä¸º h å‡½æ•°æ¸²æŸ“çš„å½¢å¼ï¼Œè€Œ Vue æ˜¯ä½¿ç”¨ vue-loader å°†æ¨¡ç‰ˆè½¬ä¸º h å‡½æ•°æ¸²æŸ“çš„å½¢å¼ï¼ˆä¹Ÿå¯ä»¥é€šè¿‡ babel-plugin-transform-vue-jsx æ’ä»¶åœ¨ vue ä¸­ä½¿ç”¨ jsxï¼Œæœ¬è´¨è¿˜æ˜¯è½¬æ¢ä¸º h å‡½æ•°æ¸²æŸ“å½¢å¼ï¼‰ã€‚</p><h4 id="è™šæ‹Ÿ-dom-çš„ä¼˜åŠ¿"><a href="#è™šæ‹Ÿ-dom-çš„ä¼˜åŠ¿" class="headerlink" title="è™šæ‹Ÿ dom çš„ä¼˜åŠ¿"></a>è™šæ‹Ÿ dom çš„ä¼˜åŠ¿</h4><p>å‡å°‘ JavaScript æ“ä½œçœŸå® DOM çš„å¸¦æ¥çš„æ€§èƒ½æ¶ˆè€—ã€‚è™½ç„¶è¿™ä¸€ä¸ªè™šæ‹Ÿ DOM å¸¦æ¥çš„ä¸€ä¸ªä¼˜åŠ¿ï¼Œä½†å¹¶ä¸æ˜¯å…¨éƒ¨ã€‚è™šæ‹Ÿ DOM æœ€å¤§çš„ä¼˜åŠ¿åœ¨äºæŠ½è±¡äº†åŸæœ¬çš„æ¸²æŸ“è¿‡ç¨‹ï¼Œå®ç°äº†è·¨å¹³å°çš„èƒ½åŠ›ï¼Œè€Œä¸ä»…ä»…å±€é™äºæµè§ˆå™¨çš„ DOMï¼Œå¯ä»¥æ˜¯å®‰å“å’Œ IOS çš„åŸç”Ÿç»„ä»¶ï¼Œå¯ä»¥æ˜¯è¿‘æœŸå¾ˆç«çƒ­çš„å°ç¨‹åºï¼Œä¹Ÿå¯ä»¥æ˜¯å„ç§ GUI</p><h4 id="æ·±æµ…æ‹·è´çš„åŒºåˆ«-æ€ä¹ˆæ·±æ‹·è´ä¸€ä¸ªå‡½æ•°"><a href="#æ·±æµ…æ‹·è´çš„åŒºåˆ«-æ€ä¹ˆæ·±æ‹·è´ä¸€ä¸ªå‡½æ•°" class="headerlink" title="æ·±æµ…æ‹·è´çš„åŒºåˆ« æ€ä¹ˆæ·±æ‹·è´ä¸€ä¸ªå‡½æ•°"></a>æ·±æµ…æ‹·è´çš„åŒºåˆ« æ€ä¹ˆæ·±æ‹·è´ä¸€ä¸ªå‡½æ•°</h4><ul><li>æµ…æ‹·è´â€”æµ…æ‹·è´æ˜¯æŒ‡å¤åˆ¶å¯¹è±¡çš„æ—¶å€™ï¼Œåªå¯¹ç¬¬ä¸€å±‚é”®å€¼å¯¹è¿›è¡Œç‹¬ç«‹çš„å¤åˆ¶ï¼Œå¦‚æœå¯¹è±¡å†…è¿˜æœ‰å¯¹è±¡ï¼Œåˆ™åªèƒ½å¤åˆ¶åµŒå¥—å¯¹è±¡çš„åœ°å€</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æµ…æ‹·è´æ•°ç»„</span></span><br><span class="line">a.slice() || a.concat()</span><br></pre></td></tr></table></figure><ul><li>æ·±æ‹·è´â€”æ·±æ‹·è´æ˜¯æŒ‡å¤åˆ¶å¯¹è±¡çš„æ—¶å€™å®Œå…¨çš„æ‹·è´ä¸€ä»½å¯¹è±¡ï¼Œå³ä½¿åµŒå¥—äº†å¯¹è±¡ï¼Œä¸¤è€…ä¹Ÿç›¸äº’åˆ†ç¦»ï¼Œä¿®æ”¹ä¸€ä¸ªå¯¹è±¡çš„å±æ€§ï¼Œä¹Ÿä¸ä¼šå½±å“å¦ä¸€ä¸ªã€‚å…¶å®åªè¦é€’å½’ä¸‹å»ï¼ŒæŠŠé‚£äº›å±æ€§çš„å€¼ä»ç„¶æ˜¯å¯¹è±¡çš„å†æ¬¡è¿›å…¥å¯¹è±¡å†…éƒ¨ä¸€ ä¸€è¿›è¡Œå¤åˆ¶å³å¯ã€‚</li></ul><blockquote><p>note! JSON.parse(JSON.stringify(obj))çš„ç¼ºé™·æ˜¯ä¸èƒ½å¤Ÿæ‹·è´å‡½æ•° å› ä¸º JSON ä¸å…è®¸åŒ…å«å‡½æ•°ï¼ŒJSON.stringify() ä¼šåˆ é™¤ JavaScript å¯¹è±¡çš„å‡½æ•°ï¼ŒåŒ…æ‹¬ key å’Œ valueã€‚</p></blockquote><p>è§£å†³<code>JSON.stringify</code>ä¸èƒ½æ‹·è´å‡½æ•°çš„é—®é¢˜</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">deepClone</span>(<span class="params">source, hash = new WeakMap(</span>)) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> obj</span><br><span class="line">  <span class="keyword">const</span> Constructor = source.constructor</span><br><span class="line">  <span class="keyword">switch</span> (Constructor) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="built_in">Date</span>:</span><br><span class="line">      obj = <span class="keyword">new</span> Constructor(source.getTime())</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">case</span> <span class="built_in">RegExp</span>:</span><br><span class="line">      obj = <span class="keyword">new</span> Constructor(source)</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">if</span> (hash.has(source)) &#123;</span><br><span class="line">        <span class="keyword">return</span> hash.get(source)</span><br><span class="line">      &#125;</span><br><span class="line">      obj = <span class="keyword">new</span> Constructor()</span><br><span class="line">      hash.set(source, obj)</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> source) &#123;</span><br><span class="line">    obj[key] = isObject(source[key])</span><br><span class="line">      ? deepClone(source[key], hash)</span><br><span class="line">      : source[key]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> obj</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="doctype-çš„ä½œç”¨"><a href="#doctype-çš„ä½œç”¨" class="headerlink" title="doctype çš„ä½œç”¨"></a>doctype çš„ä½œç”¨</h4><p>å£°æ˜äº†çš„è¯æµè§ˆå™¨å°±ä¼šä½¿ç”¨æ ‡å‡†æ¨¡å¼è§£æé¡µé¢ è¿™æ ·æ‰€æœ‰æµè§ˆå™¨æ˜¾ç¤ºçš„æ ·å¼å°±æ˜¯ä¸€æ ·çš„</p><h4 id="ä½¿ç”¨symbolä¼šé‡åˆ°å“ªäº›é—®é¢˜"><a href="#ä½¿ç”¨symbolä¼šé‡åˆ°å“ªäº›é—®é¢˜" class="headerlink" title="ä½¿ç”¨symbolä¼šé‡åˆ°å“ªäº›é—®é¢˜"></a>ä½¿ç”¨<code>symbol</code>ä¼šé‡åˆ°å“ªäº›é—®é¢˜</h4><ul><li><p><code>symbol</code>çš„ç‰¹ç‚¹<br>1.Symbol(â€˜keyâ€™) !== Symbol(â€˜keyâ€™) //true,è¿”å›ä¸åŒ<br>2.Symbol(â€œknowâ€).name = 1; // TypeError,åªè¯»<br>3.forâ€¦in ã€ Object.keys(obj) ã€Object.getOwnPropertyNames(obj)ä¼šå¿½ç•¥ Symbol,å³è‡ªèº«ä¸å¯æšä¸¾ 4.ä¸èƒ½ç”¨ obj.prop çš„å½¢å¼è®¿é—®</p></li><li><p><a href="https://zhuanlan.zhihu.com/p/22652486" target="_blank" rel="noopener"><code>symbol</code>çš„ä½¿ç”¨åœºæ™¯</a><br>ç¬¬ä¸€ä¸ªä½œç”¨æ˜¯ä½œä¸ºå±æ€§åé¿å…å±æ€§åå†²çªï¼Œ<br>ç¬¬äºŒä¸ªä½œç”¨æ˜¯æ›¿ä»£ä»£ç ä¸­å¤šæ¬¡ä½¿ç”¨çš„å­—ç¬¦ä¸²ï¼ˆä¾‹å¦‚ï¼šabcï¼‰ï¼Œå¤šæ¬¡ä½¿ç”¨çš„å­—ç¬¦ä¸²åœ¨ä»£ç ä¸­ä¸æ˜“ç»´æŠ¤ï¼Œè€Œè¿™æ—¶å€™å®šä¹‰ä¸€ä¸ªå¯¹è±¡çš„å±æ€§ï¼ˆå±æ€§åç”¨ Symbol æ ¼å¼ï¼‰ï¼Œå€¼ä¸º abcï¼Œå°±å¯ä»¥ä½œä¸ºå…¨å±€å˜é‡æ¥ä½¿ç”¨äº†ã€‚<br>ç¬¬ä¸‰ä¸ªï¼Œç”±äºä»¥ Symbol å€¼ä½œä¸ºåç§°çš„å±æ€§ï¼Œä¸ä¼šè¢«å¸¸è§„æ–¹æ³•éå†å¾—åˆ°ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œä¸ºå¯¹è±¡å®šä¹‰ä¸€äº›éç§æœ‰çš„ã€ä½†åˆå¸Œæœ›åªç”¨äºå†…éƒ¨çš„æ–¹æ³•ã€‚<br>ç¬¬å››ä¸ªï¼Œè¿™ä¸ªæœ‰æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›é‡æ–°ä½¿ç”¨åŒä¸€ä¸ª Symbol å€¼ï¼ŒSymbol.for æ–¹æ³•å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ã€‚å®ƒæ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ï¼Œç„¶åæœç´¢æœ‰æ²¡æœ‰ä»¥è¯¥å‚æ•°ä½œä¸ºåç§°çš„ Symbol å€¼ã€‚å¦‚æœæœ‰ï¼Œå°±è¿”å›è¿™ä¸ª Symbol å€¼ï¼Œå¦åˆ™å°±æ–°å»ºå¹¶è¿”å›ä¸€ä¸ªä»¥è¯¥å­—ç¬¦ä¸²ä¸ºåç§°çš„ Symbol å€¼ã€‚</p></li></ul><p>ç”Ÿæˆä¸€ä¸ªå”¯ä¸€å€¼ å› ä¸ºæˆ‘ä»¬åœ¨ä½¿ç”¨å®ƒçš„æ—¶å€™å±æ€§å€¼æ˜¯å¤šå°‘éƒ½æ— æ‰€è°“</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> race = &#123;</span><br><span class="line">  protoss: <span class="built_in">Symbol</span>(),</span><br><span class="line">  terran: <span class="built_in">Symbol</span>(),</span><br><span class="line">  zerg: <span class="built_in">Symbol</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">race.protoss !== race.terran <span class="comment">// true</span></span><br></pre></td></tr></table></figure><h4 id="åŸºæœ¬æ•°æ®ç±»å‹çš„åˆ¤æ–­"><a href="#åŸºæœ¬æ•°æ®ç±»å‹çš„åˆ¤æ–­" class="headerlink" title="åŸºæœ¬æ•°æ®ç±»å‹çš„åˆ¤æ–­"></a>åŸºæœ¬æ•°æ®ç±»å‹çš„åˆ¤æ–­</h4><ul><li>typeof Symbol() === â€˜symbolâ€™</li></ul><h4 id="reduxçš„åŸç†ï¼ˆè¦æ·±å…¥-ä¸­é—´ä»¶ï¼‰å…³äºä½¿ç”¨hookså®ç°redux"><a href="#reduxçš„åŸç†ï¼ˆè¦æ·±å…¥-ä¸­é—´ä»¶ï¼‰å…³äºä½¿ç”¨hookså®ç°redux" class="headerlink" title="reduxçš„åŸç†ï¼ˆè¦æ·±å…¥ ä¸­é—´ä»¶ï¼‰å…³äºä½¿ç”¨hookså®ç°redux"></a><code>redux</code>çš„åŸç†ï¼ˆè¦æ·±å…¥ ä¸­é—´ä»¶ï¼‰å…³äºä½¿ç”¨<code>hooks</code>å®ç°<code>redux</code></h4><p>dispatch ä¸€ä¸ª action çš„æ—¶å€™å°† action ä¼ å…¥æ‰€æœ‰çš„ reducers,ç„¶åè¿”å›æ›´æ–°çš„ state åŒæ—¶è§¦å‘ä½¿ç”¨<code>subscribe</code>æ–¹æ³•æ³¨å†Œçš„æ‰€æœ‰ listener å‡½æ•°<br>(ä¸ºä»€ä¹ˆåœ¨ hasChanged ä¸º true çš„æ—¶å€™è¿˜è¦æ¥ç€è°ƒç”¨åé¢çš„ reducers å‘¢ï¼Ÿ)</p><h4 id="ä¸ºä»€ä¹ˆreducerè¦æ˜¯ä¸€ä¸ªçº¯å‡½æ•°"><a href="#ä¸ºä»€ä¹ˆreducerè¦æ˜¯ä¸€ä¸ªçº¯å‡½æ•°" class="headerlink" title="ä¸ºä»€ä¹ˆreducerè¦æ˜¯ä¸€ä¸ªçº¯å‡½æ•°"></a>ä¸ºä»€ä¹ˆ<code>reducer</code>è¦æ˜¯ä¸€ä¸ªçº¯å‡½æ•°</h4><ul><li>react æœ‰ä¸€ä¸ª shouldcomponentupdate äº‹ä»¶ä½œä¸ºä¼˜åŒ–ï¼Œå½“æˆ‘ä»¬é‡æ¸²æŸ“æ—¶ä¹Ÿå¸Œæœ›è®¢é˜…äº‹ä»¶èƒ½å·®å¼‚åŒ–æ›´æ–°ä»¥ä¼˜åŒ–æ€§èƒ½ï¼Œæ€ä¹ˆå®ç°ï¼Ÿæ¯”å¯¹ä¸€æ¬¡æ›´æ–°é‡Œçš„æ–°è€ state<br>å½“ reducer æ˜¯çº¯å‡½æ•°æ—¶ï¼Œç”Ÿæˆä¸€ä¸ªæ–° stateï¼Œæ–°è€å¯¹è±¡åœ°å€å¼•ç”¨ä¸ä¸€ï¼Œèƒ½å®ç°<br>è‹¥ reducer æ˜¯å‰¯ä½œç”¨ï¼Œé‚£ä¹ˆè™½ç„¶å¯¹è±¡å†…å˜åŒ–ï¼Œæ–°è€å¯¹è±¡åœ°å€ä¸€è‡´ï¼Œä¸èƒ½å®ç°<br>æ­¤å¤–<br>åœ¨<code>combinereducers</code>ä¸­åˆ¤æ–­<code>haschanged</code>ä¹Ÿæ˜¯é€šè¿‡<code>nextStateForKey !== previousStateForKey</code> ç›´æ¥åˆ¤æ–­å¼•ç”¨è€Œä¸æ˜¯æ·±åº¦éå†æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡çš„å€¼ æ›´ç®€æ´</li><li>å¦‚æœä¸æ˜¯çº¯å‡½æ•° è¿”å›çš„ state å°±å…·æœ‰ä¸ç¡®å®šæ€§ é‚£ä¹ˆ UI æ‹¿åˆ°çš„æ•°æ®ä¹Ÿå…·æœ‰ä¸ç¡®å®šæ€§</li></ul><h4 id="redux-ä¸­çš„è§‚å¯Ÿè€…æ¨¡å¼"><a href="#redux-ä¸­çš„è§‚å¯Ÿè€…æ¨¡å¼" class="headerlink" title="redux ä¸­çš„è§‚å¯Ÿè€…æ¨¡å¼"></a>redux ä¸­çš„è§‚å¯Ÿè€…æ¨¡å¼</h4><ol><li>store æä¾›æ•°æ®çš„ get é’©å­ï¼ˆstore.getStateï¼‰,ä¸ç›´æ¥æä¾›æ•°æ®çš„ setï¼Œæ‰€ä»¥å¿…é¡»é€šè¿‡ dispatchï¼ˆactionï¼‰æ¥ set æ•°æ®ã€‚</li><li>åˆ©ç”¨è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆsub/ pubï¼‰è¿æ¥ model å’Œ view çš„ä¸­é—´å¯¹è±¡ã€‚view å±‚é€šè¿‡è°ƒç”¨ store.dispatch æ–¹æ³•è§¦å‘ reducer æ”¹å˜ modelã€‚å¯¹åº” pubã€‚ model å±‚é€šè¿‡è°ƒç”¨ store.subscribe æ³¨å†Œè§†å›¾æ›´æ–°äº‹ä»¶ï¼ˆsetstateï¼‰ï¼Œè¯¥äº‹ä»¶ä¼šåœ¨æ•°æ®æ”¹å˜ä¹‹åè¢«è°ƒç”¨ã€‚å¯¹åº” subã€‚</li></ol><blockquote><p><a href="https://www.jianshu.com/p/594f018b68e7" target="_blank" rel="noopener">è§‚å¯Ÿè€…æ¨¡å¼å’Œå‘å¸ƒè®¢é˜…æ¨¡å¼çš„åŒºåˆ«</a></p></blockquote><h4 id="å…³äºæœ€è¿‘åšçš„é¡¹ç›®ï¼Œè‡ªæˆ‘ä»‹ç»ï¼Œé”™è¯¯ç›‘æ§ï¼Œå­¦äº†å“ªäº›æ–°æŠ€æœ¯ã€‚ã€‚ã€‚"><a href="#å…³äºæœ€è¿‘åšçš„é¡¹ç›®ï¼Œè‡ªæˆ‘ä»‹ç»ï¼Œé”™è¯¯ç›‘æ§ï¼Œå­¦äº†å“ªäº›æ–°æŠ€æœ¯ã€‚ã€‚ã€‚" class="headerlink" title="å…³äºæœ€è¿‘åšçš„é¡¹ç›®ï¼Œè‡ªæˆ‘ä»‹ç»ï¼Œé”™è¯¯ç›‘æ§ï¼Œå­¦äº†å“ªäº›æ–°æŠ€æœ¯ã€‚ã€‚ã€‚"></a>å…³äºæœ€è¿‘åšçš„é¡¹ç›®ï¼Œè‡ªæˆ‘ä»‹ç»ï¼Œé”™è¯¯ç›‘æ§ï¼Œå­¦äº†å“ªäº›æ–°æŠ€æœ¯ã€‚ã€‚ã€‚</h4><h4 id="å…³äºå‡½æ•°ç»„ä»¶è·Ÿç±»å¼ç»„ä»¶çš„åŒºåˆ«"><a href="#å…³äºå‡½æ•°ç»„ä»¶è·Ÿç±»å¼ç»„ä»¶çš„åŒºåˆ«" class="headerlink" title="å…³äºå‡½æ•°ç»„ä»¶è·Ÿç±»å¼ç»„ä»¶çš„åŒºåˆ«"></a>å…³äºå‡½æ•°ç»„ä»¶è·Ÿç±»å¼ç»„ä»¶çš„åŒºåˆ«</h4><p><code>props</code>æ˜¯ä¸å¯å˜æ•°æ®ï¼Œæ°¸è¿œä¸ä¼šæ”¹å˜ã€‚ä½†æ˜¯ï¼Œ<code>this</code>å´å§‹ç»ˆæ˜¯å¯å˜çš„ ã€‚æ‰€ä»¥é€šè¿‡<code>this</code>æ‹¿åˆ°çš„æ°¸è¿œéƒ½æ˜¯æœ€æ–°çš„å€¼</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProfilePage</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  showMessage = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    alert(<span class="string">'Followed '</span> + <span class="keyword">this</span>.props.user)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  handleClick = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    setTimeout(<span class="keyword">this</span>.showMessage, <span class="number">3000</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.handleClick&#125;</span>&gt;</span>Follow<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ProfilePage</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> showMessage = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    alert(<span class="string">'Followed '</span> + props.user)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> handleClick = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    setTimeout(showMessage, <span class="number">3000</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;handleClick&#125;</span>&gt;</span>Follow<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ç‚¹å‡» follow ä¹‹åå†åˆ‡æ¢ç”¨æˆ·çš„åå­—ï¼Œä¸‰ç§’ä¹‹åå‡½æ•°ç»„ä»¶å¼¹å‡ºæ¥çš„ä¾æ—§æ˜¯ç‚¹å‡» follow çš„æ—¶å€™çš„ç”¨æˆ·çš„åå­—<br>è€Œç±»ç»„ä»¶å¼¹å‡ºæ¥çš„å´æ˜¯åˆ‡æ¢ä¹‹åçš„åå­—ï¼Œæ˜¯å› ä¸ºå‡½æ•°ç»„ä»¶èƒ½æ•è·æŸä¸€æ—¶åˆ»çš„ props ä¸ stateï¼ˆhooks ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼‰</p><h3 id="ç®—æ³•"><a href="#ç®—æ³•" class="headerlink" title="ç®—æ³•"></a>ç®—æ³•</h3><h4 id="çº¢é»‘æ ‘"><a href="#çº¢é»‘æ ‘" class="headerlink" title="çº¢é»‘æ ‘"></a>çº¢é»‘æ ‘</h4><p>æœ¬è´¨æ˜¯ä¸€ç§äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œä¹Ÿå°±æ˜¯å·¦è¾¹çš„å­èŠ‚ç‚¹çš„å€¼æ¯”æ ¹èŠ‚ç‚¹å°ï¼Œå³è¾¹çš„æ¯”æ ¹èŠ‚ç‚¹å¤§ï¼Œåœ¨æç«¯æƒ…å†µä¸‹ï¼Œæ¯”å¦‚è¿ç»­æ’å…¥ä¾æ¬¡é€’å¢æˆ–é€’å‡çš„èŠ‚ç‚¹ï¼ŒæŸ¥æ‰¾æ ‘å°†é€€åŒ–æˆé“¾è¡¨<br>çº¢é»‘æ ‘é€šè¿‡å¦‚ä¸‹çš„æ€§è´¨å®šä¹‰å®ç°è‡ªå¹³è¡¡ï¼š</p><p>èŠ‚ç‚¹æ˜¯çº¢è‰²æˆ–é»‘è‰²ã€‚<br>æ ¹æ˜¯é»‘è‰²ã€‚<br>æ‰€æœ‰å¶å­éƒ½æ˜¯é»‘è‰²ï¼ˆå¶å­æ˜¯ NIL èŠ‚ç‚¹ï¼‰ã€‚<br>æ¯ä¸ªçº¢è‰²èŠ‚ç‚¹å¿…é¡»æœ‰ä¸¤ä¸ªé»‘è‰²çš„å­èŠ‚ç‚¹ã€‚ï¼ˆä»æ¯ä¸ªå¶å­åˆ°æ ¹çš„æ‰€æœ‰è·¯å¾„ä¸Šä¸èƒ½æœ‰ä¸¤ä¸ªè¿ç»­çš„çº¢è‰²èŠ‚ç‚¹ã€‚ï¼‰<br>ä»ä»»ä¸€èŠ‚ç‚¹åˆ°å…¶æ¯ä¸ªå¶å­çš„æ‰€æœ‰ç®€å•è·¯å¾„éƒ½åŒ…å«ç›¸åŒæ•°ç›®çš„é»‘è‰²èŠ‚ç‚¹ï¼ˆç®€ç§°é»‘é«˜ï¼‰</p><h3 id="å®ç°æ¨¡ç³Šæœç´¢ç»“æœçš„å…³é”®è¯é«˜äº®æ˜¾ç¤º"><a href="#å®ç°æ¨¡ç³Šæœç´¢ç»“æœçš„å…³é”®è¯é«˜äº®æ˜¾ç¤º" class="headerlink" title="å®ç°æ¨¡ç³Šæœç´¢ç»“æœçš„å…³é”®è¯é«˜äº®æ˜¾ç¤º"></a>å®ç°æ¨¡ç³Šæœç´¢ç»“æœçš„å…³é”®è¯é«˜äº®æ˜¾ç¤º</h3><p>è€ƒè™‘èŠ‚æµã€ç¼“å­˜ã€‚å…¶å®è¿˜å¯ä»¥ä¸Šåˆ—è¡¨diff+å®šæ—¶æ¸…ç†ç¼“å­˜</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">debounce</span>(<span class="params">fn, timeout = <span class="number">300</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> t;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">(<span class="params">...args</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (t) &#123;</span><br><span class="line">        clearTimeout(t);</span><br><span class="line">      &#125;</span><br><span class="line">      t = setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        fn.apply(fn, args);</span><br><span class="line">      &#125;, timeout);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">// dataåº”è¯¥æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æ•°ç»„ ä¸ºäº†å‡å°cacheå çš„å†…å­˜ ç¼“å­˜ç”¨æˆ·è¾“å…¥è¿‡çš„å…³é”®è¯ </span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">memorize</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> cache = <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="function">(<span class="params">name</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (!name) &#123;</span><br><span class="line">        container.innerHTML = <span class="string">''</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (cache.get(name)) &#123;</span><br><span class="line">        container.innerHTML = cache.get(name);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">const</span> res = fn.call(fn, name).join(<span class="string">''</span>);</span><br><span class="line">      cache.set(name, res);</span><br><span class="line">      container.innerHTML = res;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">handleInput</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> reg = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">`\(<span class="subst">$&#123;value&#125;</span>\)`</span>);</span><br><span class="line">    <span class="keyword">const</span> search = data.reduce(<span class="function">(<span class="params">res, cur</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (reg.test(cur)) &#123;</span><br><span class="line">        <span class="keyword">const</span> match = <span class="built_in">RegExp</span>.$<span class="number">1</span>;</span><br><span class="line">        res.push(<span class="string">`&lt;li&gt;<span class="subst">$&#123;cur.replace(match, <span class="string">'&lt;bdi&gt;$&amp;&lt;/bdi&gt;'</span>)&#125;</span>&lt;/li&gt;`</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> res;</span><br><span class="line">    &#125;, []);</span><br><span class="line">    <span class="keyword">return</span> search;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> data = [<span class="string">"ä¸Šæµ·é‡ç”ŸåŠ¨ç‰©å›­"</span>, <span class="string">"ä¸Šé¥¶é‡ç”ŸåŠ¨ç‰©å›­"</span>, <span class="string">"åŒ—äº¬å··å­"</span>, <span class="string">"ä¸Šæµ·ä¸­å¿ƒ"</span>, <span class="string">"ä¸Šæµ·é»„åŸ”æ±Ÿ"</span>, <span class="string">"è¿ªå£«å°¼ä¸Šæµ·"</span>, <span class="string">"é™†å®¶å˜´ä¸Šæµ·ä¸­å¿ƒ"</span>]</span><br><span class="line">  <span class="keyword">const</span> container = <span class="built_in">document</span>.querySelector(<span class="string">'.container'</span>);</span><br><span class="line">  <span class="keyword">const</span> memorizeInput = memorize(handleInput);</span><br><span class="line">  <span class="built_in">document</span>.querySelector(<span class="string">'.inp'</span>).addEventListener(<span class="string">'input'</span>, debounce(<span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">    memorizeInput(e.target.value);</span><br><span class="line">  &#125;))</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h3><ul><li><a href="https://zhuanlan.zhihu.com/p/75533792" target="_blank" rel="noopener">è™šæ‹Ÿ DOM åˆ°åº•æ˜¯ä»€ä¹ˆ</a></li><li><a href="https://www.kancloud.cn/lixianshengdezhanghao/interview/904696" target="_blank" rel="noopener">MVC å’Œ MVVM çš„åŒºåˆ«</a></li><li><a href="https://juejin.im/post/5cb707626fb9a0689d6f9797" target="_blank" rel="noopener">React å‡½æ•°ç»„ä»¶å’Œç±»ç»„ä»¶çš„å·®å¼‚</a></li><li><a href="https://juejin.im/post/5cc1a0a3e51d456e403772ed" target="_blank" rel="noopener">â€œæ·±æ‹·è´â€ ä¸ â€œæµ…æ‹·è´â€ çš„åŒºåˆ«ï¼ŒJS å®ç°æ·±æµ…æ‹·è´çš„å‡ ç§æ–¹æ³•</a></li><li><a href="https://zhuanlan.zhihu.com/p/22652486" target="_blank" rel="noopener">ã€Œæ¯æ—¥ä¸€é¢˜ã€JS ä¸­çš„ Symbol æ˜¯ä»€ä¹ˆï¼Ÿ</a></li><li><a href="https://github.com/yygmind/blog/issues/43" target="_blank" rel="noopener">å‰ç«¯ 100 é—®ï¼šèƒ½ææ‡‚ 80%çš„è¯·æŠŠç®€å†ç»™æˆ‘</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> é¢ç» </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>é¢ç»é¡¹ç›®æ„å»ºç¯‡</title>
      <link href="/ashley271017.github.io/2019/12/11/%E9%9D%A2%E7%BB%8F%E9%A1%B9%E7%9B%AE%E6%9E%84%E5%BB%BA%E7%AF%87/"/>
      <url>/ashley271017.github.io/2019/12/11/%E9%9D%A2%E7%BB%8F%E9%A1%B9%E7%9B%AE%E6%9E%84%E5%BB%BA%E7%AF%87/</url>
      
        <content type="html"><![CDATA[<h3 id="æ€ä¹ˆçº¦æŸä»£ç è§„èŒƒï¼Ÿ"><a href="#æ€ä¹ˆçº¦æŸä»£ç è§„èŒƒï¼Ÿ" class="headerlink" title="æ€ä¹ˆçº¦æŸä»£ç è§„èŒƒï¼Ÿ"></a>æ€ä¹ˆçº¦æŸä»£ç è§„èŒƒï¼Ÿ</h3><p>ç»“åˆ<code>lint-staged</code>ä¸<code>husky</code> å®ç°åœ¨æ¯æ¬¡æäº¤ä¹‹å‰ è‡ªåŠ¨ä¿®å¤æœ¬æ¬¡ä¿®æ”¹çš„ä»£ç </p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">    <span class="attr">"precommit"</span>: <span class="string">"lint-staged"</span> //è¿™ä¸ªé’©å­æ˜¯åœ¨å®‰è£…huskyä¹‹åæ‰æœ‰çš„ package.jsonä¸­åŸæœ‰çš„é’©å­:https://segmentfault.com/a/<span class="number">1190000008832423</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"lint-staged"</span>: &#123;</span><br><span class="line">    <span class="attr">"src/**/*.js"</span>: [<span class="string">"eslint --fix"</span>, <span class="string">"git add"</span>]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">// æˆ–è€…ä½¿ç”¨ä¸‹é¢çš„é…ç½®ï¼Œè‡ªåŠ¨æ ¼å¼åŒ–ä»£ç ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰ï¼š</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">    <span class="attr">"precommit"</span>: <span class="string">"lint-staged"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"lint-staged"</span>: &#123;</span><br><span class="line">    <span class="attr">"src/**/*.js"</span>: [<span class="string">"prettier --write"</span>, <span class="string">"git add"</span>]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="webpackæ‰“åŒ…ä¼˜åŒ–"><a href="#webpackæ‰“åŒ…ä¼˜åŒ–" class="headerlink" title="webpackæ‰“åŒ…ä¼˜åŒ–"></a>webpackæ‰“åŒ…ä¼˜åŒ–</h3><ul><li><p>å®šä½ä½“ç§¯å¤§çš„æ¨¡å— - webpack-bundle-analyzer</p></li><li><p>ç§»é™¤ä¸å¿…è¦çš„æ–‡ä»¶<br>ä½¿ç”¨webpackè‡ªå¸¦çš„ä¸¤ä¸ªåº“</p></li><li><p>IgnorePlugin</p></li><li><p>ContextReplacementPlugin</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ’ä»¶é…ç½®</span></span><br><span class="line">plugins: [</span><br><span class="line">  <span class="comment">// å¿½ç•¥moment.jsä¸­æ‰€æœ‰çš„localeæ–‡ä»¶</span></span><br><span class="line">  <span class="keyword">new</span> webpack.IgnorePlugin(<span class="regexp">/^\.\/locale$/</span>, /moment$/),</span><br><span class="line">],</span><br><span class="line"><span class="comment">// ä½¿ç”¨æ–¹å¼</span></span><br><span class="line"><span class="keyword">const</span> moment = <span class="built_in">require</span>(<span class="string">'moment'</span>);</span><br><span class="line"><span class="comment">// å¼•å…¥zh-cn localeæ–‡ä»¶</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">'moment/locale/zh-cn'</span>);</span><br><span class="line">moment.locale(<span class="string">'zh-cn'</span>);</span><br></pre></td></tr></table></figure></li><li><p>æ¨¡å—åŒ–å¼•ç”¨</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;chain, cloneDeep&#125; <span class="keyword">from</span> <span class="string">'lodash'</span>;</span><br><span class="line"><span class="comment">// å¯ä»¥æ”¹å†™ä¸º</span></span><br><span class="line"><span class="keyword">import</span> chain <span class="keyword">from</span> <span class="string">'lodash/chain'</span>;</span><br><span class="line"><span class="keyword">import</span> cloneDeep <span class="keyword">from</span> <span class="string">'lodash/cloneDeep'</span>;</span><br></pre></td></tr></table></figure></li><li><p>é€šè¿‡CDNå¼•ç”¨</p></li><li><p>æœåŠ¡ç«¯å¼€å¯Gzipå‹ç¼©<br>å¼€å¯gzipå‹ç¼©å¯ä»¥å‡å°‘HTTPä¼ è¾“çš„æ•°æ®é‡å’Œæ—¶é—´ï¼Œä»è€Œå‡å°‘å®¢æˆ·ç«¯è¯·æ±‚çš„å“åº”æ—¶é—´</p></li><li><p><code>splitChunks</code>é…ç½®ä»£ç åˆ†å‰²<br>æ­¤ç‰¹æ€§èƒ½å¤ŸæŠŠä»£ç åˆ†ç¦»åˆ°ä¸åŒçš„ bundle ä¸­ï¼Œç„¶åå¯ä»¥æŒ‰éœ€åŠ è½½æˆ–å¹¶è¡ŒåŠ è½½è¿™äº›æ–‡ä»¶ã€‚ä»£ç åˆ†ç¦»å¯ä»¥ç”¨äºè·å–æ›´å°çš„ bundleï¼Œä»¥åŠæ§åˆ¶èµ„æºåŠ è½½ä¼˜å…ˆçº§ï¼Œå¦‚æœä½¿ç”¨åˆç†ï¼Œä¼šæå¤§å½±å“åŠ è½½æ—¶é—´ã€‚</p></li></ul><h3 id="webpack-çƒ­æ›´æ–°åŸç†"><a href="#webpack-çƒ­æ›´æ–°åŸç†" class="headerlink" title="webpack çƒ­æ›´æ–°åŸç†"></a>webpack çƒ­æ›´æ–°åŸç†</h3><p>åœ¨ webpack ä¸­ï¼Œéƒ½æ˜¯æ¨¡å—ä¸”æœ‰å”¯ä¸€æ ‡è¯†ã€‚åœ¨ webpack ç¼–è¯‘å®Œæˆåï¼Œå°†ä¿®æ”¹çš„æ¨¡å— hash å¯¹åº”çš„æ¨¡å—é‡æ–°æ‰§è¡Œã€‚å°±è¾¾åˆ°äº†å±€éƒ¨åˆ·æ–°çš„æ•ˆæœã€‚</p><p>è¿‡ç¨‹<br>webpack-dev-middleware æ˜¯ç”¨æ¥å¤„ç†æ–‡ä»¶æ‰“åŒ…åˆ°å“ªé‡Œï¼Œåˆ°å†…å­˜è¯»å–é€Ÿåº¦æ›´å¿«ã€‚<br>devServer åœ¨ç›‘å¬ compiler done åï¼Œåˆ©ç”¨ socket å‘Šè¯‰ devServer/client ä¿®æ”¹æ¨¡å—çš„ hash<br>HMR.runtime åˆ©ç”¨ HTTP è¯·æ±‚ hash.hot-update.json è·å–æ›´æ–°æ¨¡å—åˆ—è¡¨ hotDownloadManifest<br>{â€œhâ€:â€11ba55af05df7c2d3d13â€,â€câ€:{â€œindex-wrapâ€:true}}<br>å†é€šè¿‡ HTTP (jsonp) è·å–æ›´æ–°æ¨¡å—çš„ js<br>index-wrap.7466b9e256c084c8463f.hot-update.js<br>è¿”å›æ‰§è¡Œ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">webpackHotUpdate(<span class="string">"index-wrap"</span>, &#123;</span><br><span class="line">  <span class="comment">// ....</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><code>webpackHotUpdate</code> åšäº†ä¸‰ä»¶äº‹<br>æ‰¾åˆ°è¿‡æœŸçš„æ¨¡å—å’Œä¾èµ–å¹¶ä»ç¼“å­˜ä¸­åˆ é™¤</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> installedModules[moduleId];</span><br><span class="line"><span class="keyword">delete</span> outdatedDependencies[moduleId];</span><br></pre></td></tr></table></figure><p>éå†æ‰€æœ‰çš„ module.childrenï¼Œé‡æ–° <code>installedModules</code> æ‰€æœ‰çš„å­æ¨¡å—<br>æœ€åå°†è‡ªèº«æ¨¡å—çš„å†…å®¹åšæ›¿æ¢ä¿®æ”¹</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">modules[moduleId] = appliedUpdate[moduleId]</span><br></pre></td></tr></table></figure><p>æœ€åä»£ç æ›¿æ¢ä¹‹åå¹¶æ²¡æœ‰é‡æ–°æ‰§è¡Œï¼Œéœ€è¦æ‰‹åŠ¨æ³¨å†Œéœ€è¦é‡æ–°æ‰§è¡Œçš„æ¨¡å—æ–¹æ³•</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="built_in">module</span>.hot) &#123;</span><br><span class="line">   <span class="built_in">module</span>.hot.accept(<span class="string">'./print.js'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">     <span class="built_in">console</span>.log(<span class="string">'Accepting the updated printMe module!'</span>);</span><br><span class="line">     printMe();</span><br><span class="line">   &#125;)</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h3 id="å›½é™…åŒ–æ–¹æ¡ˆ"><a href="#å›½é™…åŒ–æ–¹æ¡ˆ" class="headerlink" title="å›½é™…åŒ–æ–¹æ¡ˆ"></a>å›½é™…åŒ–æ–¹æ¡ˆ</h3><p>åç«¯åœ¨<code>cookie</code>ä¸­è®¾ç½®<code>applocal</code>å­—æ®µ å‰ç«¯å†å»æ‹¿ã€‚ã€‚ã€‚</p><h3 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h3><ul><li>[ç”¨ husky å’Œ lint-staged æ„å»ºè¶…æºœçš„ä»£ç æ£€æŸ¥å·¥ä½œæµ](ç”¨ husky å’Œ lint-staged æ„å»ºè¶…æºœçš„ä»£ç æ£€æŸ¥å·¥ä½œæµ)</li><li><a href="https://juejin.im/post/5b1e303b6fb9a01e605fd0b3" target="_blank" rel="noopener">Webpackæ‰“åŒ…ä¼˜åŒ–</a></li><li><a href="https://juejin.im/post/5de0cfe46fb9a071665d3df0" target="_blank" rel="noopener">è½»æ¾ç†è§£webpackçƒ­æ›´æ–°åŸç†</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> é…ç½® </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é¢ç»jsç¯‡</title>
      <link href="/ashley271017.github.io/2019/12/10/%E9%9D%A2%E7%BB%8Fjs%E7%AF%87/"/>
      <url>/ashley271017.github.io/2019/12/10/%E9%9D%A2%E7%BB%8Fjs%E7%AF%87/</url>
      
        <content type="html"><![CDATA[<h2 id="åŸç”Ÿ-js"><a href="#åŸç”Ÿ-js" class="headerlink" title="åŸç”Ÿ js"></a>åŸç”Ÿ js</h2><h3 id="typeofçš„åŸç†"><a href="#typeofçš„åŸç†" class="headerlink" title="typeofçš„åŸç†"></a><code>typeof</code>çš„åŸç†</h3><p>js åœ¨åº•å±‚å­˜å‚¨å˜é‡çš„æ—¶å€™ï¼Œä¼šåœ¨å˜é‡çš„æœºå™¨ç çš„ä½ä½ 1-3 ä½å­˜å‚¨å…¶ç±»å‹ä¿¡æ¯ ğŸ‘‰</p><blockquote><p>000ï¼šå¯¹è±¡<br>010ï¼šæµ®ç‚¹æ•°<br>100ï¼šå­—ç¬¦ä¸²<br>110ï¼šå¸ƒå°”<br>1ï¼šæ•´æ•°</p></blockquote><p>but, å¯¹äº undefined å’Œ null æ¥è¯´ï¼Œè¿™ä¸¤ä¸ªå€¼çš„ä¿¡æ¯å­˜å‚¨æ˜¯æœ‰ç‚¹ç‰¹æ®Šçš„ã€‚<br>nullï¼šæ‰€æœ‰æœºå™¨ç å‡ä¸º 0<br>undefinedï¼šç”¨ âˆ’2^30 æ•´æ•°æ¥è¡¨ç¤º<br>æ‰€ä»¥ï¼Œtypeof åœ¨åˆ¤æ–­ null çš„æ—¶å€™å°±å‡ºç°é—®é¢˜äº†ï¼Œç”±äº null çš„æ‰€æœ‰æœºå™¨ç å‡ä¸º 0ï¼Œå› æ­¤ç›´æ¥è¢«å½“åšäº†å¯¹è±¡æ¥çœ‹å¾…ã€‚</p><h3 id="instanceofçš„åŸç†"><a href="#instanceofçš„åŸç†" class="headerlink" title="instanceofçš„åŸç†"></a><code>instanceof</code>çš„åŸç†</h3><p>é€šè¿‡åˆ¤æ–­å³è¾¹çš„å˜é‡çš„<code>prototype</code>æ˜¯å¦åœ¨å·¦è¾¹çš„å˜é‡çš„åŸå‹é“¾ä¸Š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myInstanceOf</span>(<span class="params">leftVal, rightVal</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> rightProto = rightVal.prototype</span><br><span class="line">  <span class="keyword">let</span> leftCopy = leftVal.__proto__</span><br><span class="line">  <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (leftCopy === <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (leftCopy === rightProto) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    leftCopy = leftCopy.__proto__</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç”ŸæˆæŒ‡å®šèŒƒå›´å†…çš„éšæœºæ•°"><a href="#ç”ŸæˆæŒ‡å®šèŒƒå›´å†…çš„éšæœºæ•°" class="headerlink" title="ç”ŸæˆæŒ‡å®šèŒƒå›´å†…çš„éšæœºæ•°"></a>ç”ŸæˆæŒ‡å®šèŒƒå›´å†…çš„éšæœºæ•°</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">RandomNum</span> (<span class="params">min, max</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> range = max - min</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Math</span>.round(<span class="built_in">Math</span>.random()*range) + min</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="null-undefined-çš„åŒºåˆ«"><a href="#null-undefined-çš„åŒºåˆ«" class="headerlink" title="null undefined çš„åŒºåˆ«"></a>null undefined çš„åŒºåˆ«</h3><p>å‰è€…æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å¯¹è±¡ ä¸ä¼šè¢«åƒåœ¾å›æ”¶æœºåˆ¶å›æ”¶ å‰è€…è½¬æ¢æˆæ•°å­—æ˜¯ 0 åè€…æ˜¯ NaN</p><h3 id="å‡½æ•°å‚æ•°æ˜¯æŒ‰å€¼ä¼ é€’-ä¸ºä»€ä¹ˆä¼ ä¸€ä¸ªå¯¹è±¡è¿›å»-å‡½æ•°å†…éƒ¨çš„ä¿®æ”¹ä¼šå½±å“è¯¥å¯¹è±¡"><a href="#å‡½æ•°å‚æ•°æ˜¯æŒ‰å€¼ä¼ é€’-ä¸ºä»€ä¹ˆä¼ ä¸€ä¸ªå¯¹è±¡è¿›å»-å‡½æ•°å†…éƒ¨çš„ä¿®æ”¹ä¼šå½±å“è¯¥å¯¹è±¡" class="headerlink" title="å‡½æ•°å‚æ•°æ˜¯æŒ‰å€¼ä¼ é€’ ä¸ºä»€ä¹ˆä¼ ä¸€ä¸ªå¯¹è±¡è¿›å» å‡½æ•°å†…éƒ¨çš„ä¿®æ”¹ä¼šå½±å“è¯¥å¯¹è±¡"></a>å‡½æ•°å‚æ•°æ˜¯æŒ‰å€¼ä¼ é€’ ä¸ºä»€ä¹ˆä¼ ä¸€ä¸ªå¯¹è±¡è¿›å» å‡½æ•°å†…éƒ¨çš„ä¿®æ”¹ä¼šå½±å“è¯¥å¯¹è±¡</h3><p>ä¼ çš„æ˜¯æ˜¯æ ˆå†…æ•°æ®çš„æ‹·è´<br>ç®€å•æ•°æ®ç±»å‹ä¼ çš„æ˜¯ å€¼æœ¬èº« ï¼ˆå› ä¸ºç›´æ¥æŠŠå€¼å­˜åœ¨æ ˆå†…ï¼‰<br>å¤æ‚æ•°æ®ç±»å‹ä¼ çš„æ˜¯ å¯¹è±¡åœ¨å†…å­˜é‡Œé¢çš„åœ°å€ ï¼ˆå› ä¸ºå¤æ‚å¯¹è±¡å­˜åœ¨å †å†…ï¼Œæ‰€ä»¥åœ¨æ ˆé‡Œå­˜å¯¹è±¡æ‰€åœ¨çš„å †åœ°å€ï¼‰</p><h3 id="ä½ è§‰å¾—jQueryæˆ–zeptoæºç æœ‰å“ªäº›å†™çš„å¥½çš„åœ°æ–¹"><a href="#ä½ è§‰å¾—jQueryæˆ–zeptoæºç æœ‰å“ªäº›å†™çš„å¥½çš„åœ°æ–¹" class="headerlink" title="ä½ è§‰å¾—jQueryæˆ–zeptoæºç æœ‰å“ªäº›å†™çš„å¥½çš„åœ°æ–¹"></a>ä½ è§‰å¾—jQueryæˆ–zeptoæºç æœ‰å“ªäº›å†™çš„å¥½çš„åœ°æ–¹</h3><p>jqueryæºç å°è£…åœ¨ä¸€ä¸ªåŒ¿åå‡½æ•°çš„è‡ªæ‰§è¡Œç¯å¢ƒä¸­ï¼Œæœ‰åŠ©äºé˜²æ­¢å˜é‡çš„å…¨å±€æ±¡æŸ“ï¼Œç„¶åé€šè¿‡ä¼ å…¥windowå¯¹è±¡å‚æ•°ï¼Œå¯ä»¥ä½¿windowå¯¹è±¡ä½œä¸ºå±€éƒ¨å˜é‡ä½¿ç”¨ï¼Œå¥½å¤„æ˜¯å½“jqueryä¸­è®¿é—®windowå¯¹è±¡çš„æ—¶å€™ï¼Œå°±ä¸ç”¨å°†ä½œç”¨åŸŸé“¾é€€å›åˆ°é¡¶å±‚ä½œç”¨åŸŸäº†ï¼Œä»è€Œå¯ä»¥æ›´å¿«çš„è®¿é—®windowå¯¹è±¡ã€‚åŒæ ·ï¼Œä¼ å…¥undefinedå‚æ•°ï¼Œå¯ä»¥ç¼©çŸ­æŸ¥æ‰¾undefinedæ—¶çš„ä½œç”¨åŸŸé“¾ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"> window, undefined </span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">     <span class="comment">//ç”¨ä¸€ä¸ªå‡½æ•°åŸŸåŒ…èµ·æ¥ï¼Œå°±æ˜¯æ‰€è°“çš„æ²™ç®±</span></span><br><span class="line"></span><br><span class="line">     <span class="comment">//åœ¨è¿™é‡Œè¾¹varå®šä¹‰çš„å˜é‡ï¼Œå±äºè¿™ä¸ªå‡½æ•°åŸŸå†…çš„å±€éƒ¨å˜é‡ï¼Œé¿å…æ±¡æŸ“å…¨å±€</span></span><br><span class="line"></span><br><span class="line">     <span class="comment">//æŠŠå½“å‰æ²™ç®±éœ€è¦çš„å¤–éƒ¨å˜é‡é€šè¿‡å‡½æ•°å‚æ•°å¼•å…¥è¿›æ¥</span></span><br><span class="line"></span><br><span class="line">     <span class="comment">//åªè¦ä¿è¯å‚æ•°å¯¹å†…æä¾›çš„æ¥å£çš„ä¸€è‡´æ€§ï¼Œä½ è¿˜å¯ä»¥éšæ„æ›¿æ¢ä¼ è¿›æ¥çš„è¿™ä¸ªå‚æ•°</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">window</span>.jQuery = <span class="built_in">window</span>.$ = jQuery;</span><br><span class="line"></span><br><span class="line">&#125;)( <span class="built_in">window</span> );</span><br></pre></td></tr></table></figure><h3 id="è™šæ‹Ÿdom"><a href="#è™šæ‹Ÿdom" class="headerlink" title="è™šæ‹Ÿdom"></a>è™šæ‹Ÿdom</h3><ul><li><p>ä¸ºä»€ä¹ˆç›´æ¥æ“ä½œdomè€—æ—¶<br>v8 bindingä¼šå°†åŸç”Ÿçš„domå¯¹è±¡ï¼ˆæ¯”å¦‚document.a)æ˜ å°„æˆåŒ…è£…çš„jså¯¹è±¡ï¼Œæ‰€ä»¥æ‰§è¡Œ<code>document.a=ã€‚ã€‚ã€‚</code>å¾ˆå¿«<br>ä½†æ˜¯<code>document.title=ã€‚ã€‚ã€‚</code>å¾ˆæ…¢æ˜¯å› ä¸ºä¿®æ”¹titleçš„æ—¶å€™åŒæ—¶ä¹Ÿä¿®æ”¹äº† DOM å¯¹è±¡çš„ attributes<br>æ­¤å¤–å¾ˆå¤šæ—¶å€™æ“ä½œdoméƒ½ä¼šå¼•èµ·é‡ç»˜ä¸å›æµ å¹¶ä¸”å¾ˆå¤šdom apiçš„è¯»å†™éƒ½ä¼šè®¾è®¡é¡µé¢å¸ƒå±€çš„é‡æ–°è®¡ç®—ä»¥ç¡®ä¿è¿”å›å€¼çš„å‡†ç¡®</p></li><li><p>è™šæ‹Ÿdomä¸å¿« ä¸ºä»€ä¹ˆreactå¿«</p><blockquote><p>React is fast because it only manipulates the DOM as much as it needs to,Updating changes is much faster than re-building the entire DOM tree from scratch. Itâ€™s able to do this because it keeps the virtual DOM representation from the last time we updated or rendered our component in memory. It then compares the two versions and updates the changes.</p></blockquote></li></ul><blockquote><p>React Virtual DOM is an object,<br>when we create an webpage browser create dom in a tree manner. to find the changes in two different trees &gt;time complexity is O(n^3) but REACT DIFF algorithm can able to do it in O(n) time by using keys of each node.that is why react is faster</p></blockquote><ul><li>ä¸ºä»€ä¹ˆè™šæ‹Ÿdomæ€§èƒ½æ›´å¥½<blockquote><p>ä¼ ç»ŸMVCæ¡†æ¶,å¦‚backbone,å®ƒæ˜¯å°†æŸä¸ªæ¨¡æ¿ç¼–è¯‘æˆæ¨¡æ¿å‡½æ•°,éœ€è¦æ›´æ–°æ—¶,æ˜¯è‡ªå·±æ‰‹åŠ¨å°†æ•°æ®æ•´ä½“ä¼ å…¥æ¨¡æ¿å‡½æ•°, å¾—åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²,ä½¿ç”¨innerHTMLåˆ·æ–°æŸä¸ªå®¹å™¨!æ³¨æ„,è¿™é‡Œå…¶å®å¯ä»¥ä¼˜åŒ–,ä½†ç”±äºæ˜¯æ‰‹åŠ¨,æ˜¯ä½“åŠ›æ´»,éƒ½æ˜¯ä½¿ç”¨å¾ˆç²—æ”¾å‹çš„innerhTMLäº†äº‹ (ä½¿ç”¨jQueryçš„htmlæ–¹æ³•æ€§èƒ½ä¼šæ›´å·®,ä¸è¿‡å¥½å¤„æ˜¯å®ƒå¤„ç†äº†IEä¸‹çš„innerHTML BUGåŠå…¨å¹³å°çš„æ— æ³•æ‰§è¡Œå†…éƒ¨çš„scriptæ ‡ç­¾çš„BUG) ç”±äºæ•´ä½“æ›¿æ¢,ä¸€ä¸‹å­é”€æ¯è¿™ä¹ˆå¤šå…ƒç´ (æœ‰æ—¶è¿˜ç»‘ç€äº‹ä»¶,å¯èƒ½å¯¼è‡´GCå‡ºé—®é¢˜),åˆè¦æ’å…¥è¿™ä¹ˆå¤šå…ƒç´ ,å†é‡æ–°ç»‘å®šäº‹ä»¶(è¿™ä¸ªå¯ä»¥ä½¿ç”¨äº‹ä»¶ä»£ç†ç¼“è§£) å› æ­¤æ€§èƒ½éå¸¸å·®</p></blockquote></li></ul><blockquote><p>knockouté‚£æ ·, ä½¿ç”¨æ—¶è®©ç”¨æˆ·ç—›è‹¦ä¸€äº›,ä½¿ç”¨å¯åŒæ­¥è§†å›¾çš„ä¸œè¥¿ç”¨å‡½æ•°(wrapper)åŒ…è£¹èµ·æ¥, åˆ·æ–°è§†å›¾,å°±åªéœ€è¦é‡æ–°è°ƒç”¨è¿™ä¸ªwrapper.ç°åœ¨æ‰€æœ‰æ–°çš„MVVMéƒ½æ˜¯ä»koé‚£é‡Œå­¦åˆ°ä¾èµ–æ”¶é›†. è¿™ä¸ªwraperä¼šé€šçŸ¥å…¶ä¾èµ–çš„wrapper,é€šè¿‡æå…¶ç—›è‹¦æ™¦æ¶©çš„æ–¹å¼è¿›å…¥äº‹ä»¶æ€»çº¿, æ‰§è¡Œè§†å›¾åˆ·æ–°å‡½æ•°. knockoutæ˜¯ä½¿ç”¨é—­åŒ…ç”¨åˆ°æè‡´çš„åº“,æ˜¾ç„¶è¿™æ ·åšæ€§èƒ½ä¹Ÿå¾ˆå·®.</p></blockquote><blockquote><p>æœ€åreact, é¦–å…ˆä½¿ç”¨ç¼–è¯‘æ‰‹æ®µ(jsxçš„è™šæ‹ŸDOMè½¬æ¢), å°†è¿™éƒ¨åˆ†æ¶ˆè€—èƒ½æå‰é‡Šæ”¾å‡ºå», ä¸è¿‡å°†å­—ç¬¦ä¸²(jsxæ¨¡æ¿)è½¬æ¢ä¸ºä¸€ä¸ªä¸ªJSå¯¹è±¡,ä¹Ÿå ä¸äº†å¤šå°‘å†…å­˜. ç„¶åæ˜¯æ•°æ®å‘ç”Ÿå˜åŠ¨æ—¶, ç”±äºæ•°æ®å˜åŠ¨éƒ½æ˜¯éœ€è¦ç”¨setStateæ–¹æ³•,å› æ­¤å…¼å®¹æ€§å¾ˆå¥½, å°‘äº†Object.definePropertyæˆ–wrapperçš„æ¶ˆè€—,ç„¶åå¯¹åº”æ•°æ®é€šè¿‡renderè½¬æ¢æˆå­—ç¬¦ä¸²,å­—ç¬¦ä¸²å†è½¬æ¢è™šæ‹ŸDOMæ ‘ å…ˆåè™šæ‹ŸDOMè¿›è¡Œæ¯”è¾ƒ, æ›´æ–°è§†å›¾.</p></blockquote><blockquote><p>reactæ˜¯é¢å‘ç»„ä»¶è®¾è®¡, ä¸€ä¸ªç»„ä»¶å°±æ˜¯ä¸€ä¸ªå¯†å°èˆ±, å¾ˆå°‘ä¼šå¯¹æ‰€æœ‰è™šæ‹ŸDOMè¿›è¡Œæ¯”è¾ƒ, ç”±äºå¼ºåˆ¶ä½¿ç”¨å•å‘æµåŠ¨, å‡å°‘æ¯æ¬¡å˜åŠ¨éœ€è¦çš„diff. æ²¡æœ‰ç»‘å®šå¯¹è±¡ä¸wrapperçš„å†…å­˜å ç”¨é«˜çš„é—®é¢˜.</p></blockquote><h3 id="å®ç°å‡½æ•°æŸ¯é‡ŒåŒ–"><a href="#å®ç°å‡½æ•°æŸ¯é‡ŒåŒ–" class="headerlink" title="å®ç°å‡½æ•°æŸ¯é‡ŒåŒ–"></a>å®ç°å‡½æ•°æŸ¯é‡ŒåŒ–</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">curry</span>(<span class="params">f</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> context = <span class="keyword">this</span></span><br><span class="line">  <span class="keyword">let</span> args = []</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">...arg</span>) </span>&#123;</span><br><span class="line">    args = args.concat(arg)</span><br><span class="line">    <span class="keyword">if</span> (arg.length) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">arguments</span>.callee</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> f.apply(context, arg)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="arguments-callee-ä¸arguments-callerçš„åŒºåˆ«"><a href="#arguments-callee-ä¸arguments-callerçš„åŒºåˆ«" class="headerlink" title="arguments.callee ä¸arguments.callerçš„åŒºåˆ«"></a><code>arguments.callee</code> ä¸<code>arguments.caller</code>çš„åŒºåˆ«</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// arguments.callee : [Function:f]</span></span><br><span class="line">  <span class="comment">//  arguments.caller : [Function:g]</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">g</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  f()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç±»æ•°ç»„å¯¹è±¡æœ‰å“ªäº›"><a href="#ç±»æ•°ç»„å¯¹è±¡æœ‰å“ªäº›" class="headerlink" title="ç±»æ•°ç»„å¯¹è±¡æœ‰å“ªäº›"></a>ç±»æ•°ç»„å¯¹è±¡æœ‰å“ªäº›</h3><p>å…·æœ‰lengthå±æ€§çš„å¹¶ä¸”èƒ½ä½¿ç”¨ç´¢å¼•è®¿é—®çš„ æ¯”å¦‚arguments domç›¸å…³çš„æ•°æ®ç»“æ„ localstorage sesstionstorage..</p><h3 id="å‡½æ•°æå‡è·Ÿå˜é‡æå‡"><a href="#å‡½æ•°æå‡è·Ÿå˜é‡æå‡" class="headerlink" title="å‡½æ•°æå‡è·Ÿå˜é‡æå‡"></a>å‡½æ•°æå‡è·Ÿå˜é‡æå‡</h3><p>å‡½æ•°å£°æ˜çš„ä¼˜å…ˆçº§æœ€é«˜ï¼Œä¼šè¢«æå‡è‡³å½“å‰ä½œç”¨åŸŸæœ€é¡¶ç«¯</p><h3 id="å®ç°æ·±æ‹·è´"><a href="#å®ç°æ·±æ‹·è´" class="headerlink" title="å®ç°æ·±æ‹·è´"></a>å®ç°æ·±æ‹·è´</h3><h3 id="å¾ªç¯é€’å½’å®ç°"><a href="#å¾ªç¯é€’å½’å®ç°" class="headerlink" title="å¾ªç¯é€’å½’å®ç°"></a>å¾ªç¯é€’å½’å®ç°</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = &#123;</span><br><span class="line">  name: <span class="string">'mary'</span>,</span><br><span class="line">  age: <span class="number">20</span>,</span><br><span class="line">  friend: &#123;</span><br><span class="line">    name: <span class="string">'å“ˆå“ˆ'</span>,</span><br><span class="line">    age: <span class="number">19</span>,</span><br><span class="line">    hobby: <span class="string">'eat'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">deep</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> newobj = &#123;&#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> obj) &#123;</span><br><span class="line">    <span class="comment">// æ­¤å¤„éå†çš„keyåŒ…æ‹¬äº†å®ä¾‹å¯¹è±¡å’Œå®ƒåŸå‹çš„å±æ€§ï¼Œæ‰€ä»¥è¦ç”¨hasOwnPropertyè¿›è¡Œç­›é€‰(nodeç¯å¢ƒä¸ä¼šï¼Œæµè§ˆå™¨ç¯å¢ƒä¼šåˆ—ä¸¾åŸå‹å±æ€§)</span></span><br><span class="line">    <span class="keyword">if</span> (obj.hasOwnProperty(key)) &#123;</span><br><span class="line">      <span class="comment">// å¦‚æœæ˜¯åŸºæœ¬ç±»å‹åˆ™è¿›è¡Œå¤åˆ¶</span></span><br><span class="line">      <span class="keyword">if</span> (</span><br><span class="line">        <span class="keyword">typeof</span> obj[key] === <span class="string">'number'</span> ||</span><br><span class="line">        <span class="keyword">typeof</span> obj[key] === <span class="string">'string'</span> ||</span><br><span class="line">        <span class="keyword">typeof</span> obj[key] === <span class="string">'boolean'</span> ||</span><br><span class="line">        obj[key] === <span class="literal">undefined</span> ||</span><br><span class="line">        obj[key] === <span class="literal">null</span></span><br><span class="line">      ) &#123;</span><br><span class="line">        newobj[key] = obj[key]</span><br><span class="line">        <span class="comment">// å¦‚æœä¸æ˜¯åˆ™ä¸ºarrayæˆ–è€…object,ä»ç„¶éœ€è¦æ·±å±‚æ¬¡çš„é€’å½’å¤åˆ¶</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        newobj[key] = deep(obj[key])</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> newobj</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="load-äº‹ä»¶ä¸-DOMContentLoaded-äº‹ä»¶-document-ready"><a href="#load-äº‹ä»¶ä¸-DOMContentLoaded-äº‹ä»¶-document-ready" class="headerlink" title="load äº‹ä»¶ä¸ DOMContentLoaded äº‹ä»¶,$(document).ready()"></a>load äº‹ä»¶ä¸ DOMContentLoaded äº‹ä»¶,$(document).ready()</h3><ul><li>å½“ DOMContentLoaded äº‹ä»¶è§¦å‘æ—¶ï¼Œä»…å½“ DOM åŠ è½½å®Œæˆï¼Œä¸åŒ…æ‹¬æ ·å¼è¡¨ï¼Œå›¾ç‰‡ã€‚</li><li>å½“ onload äº‹ä»¶è§¦å‘æ—¶ï¼Œé¡µé¢ä¸Šæ‰€æœ‰çš„ DOMï¼Œæ ·å¼è¡¨ï¼Œè„šæœ¬ï¼Œå›¾ç‰‡éƒ½å·²ç»åŠ è½½å®Œæˆäº†ã€‚</li><li>$(document).ready()æ˜¯DOMç»“æ„ç»˜åˆ¶å®Œæ¯•åå°±æ‰§è¡Œï¼Œä¸å¿…ç­‰åˆ°åŠ è½½å®Œæ¯•</li><li>window.onloadä¸èƒ½åŒæ—¶ç¼–å†™å¤šä¸ªï¼Œå¦‚æœæœ‰å¤šä¸ªwindow.onloadæ–¹æ³•ï¼Œåªä¼šæ‰§è¡Œä¸€ä¸ªï¼Œ$(document).ready()å¯ä»¥åŒæ—¶ç¼–å†™å¤šä¸ªï¼Œå¹¶ä¸”éƒ½å¯ä»¥å¾—åˆ°æ‰§è¡Œ,$(document).ready(function(){})å¯ä»¥ç®€å†™æˆ$(function(){})</li></ul><h3 id="æ„é€ å‡½æ•°çš„è¿”å›å€¼"><a href="#æ„é€ å‡½æ•°çš„è¿”å›å€¼" class="headerlink" title="æ„é€ å‡½æ•°çš„è¿”å›å€¼"></a>æ„é€ å‡½æ•°çš„è¿”å›å€¼</h3><blockquote><p>æ„é€ å‡½æ•°ä¸éœ€è¦æ˜¾ç¤ºçš„è¿”å›å€¼ã€‚ä½¿ç”¨ new æ¥åˆ›å»ºå¯¹è±¡(è°ƒç”¨æ„é€ å‡½æ•°)æ—¶ï¼Œå¦‚æœ return çš„æ˜¯éå¯¹è±¡(æ•°å­—ã€å­—ç¬¦ä¸²ã€å¸ƒå°”ç±»å‹ç­‰)ä¼šå¿½è€Œç•¥è¿”å›å€¼;å¦‚æœ return çš„æ˜¯å¯¹è±¡ï¼Œåˆ™è¿”å›è¯¥å¯¹è±¡(æ³¨ï¼šè‹¥ return null ä¹Ÿä¼šå¿½ç•¥è¿”å›å€¼ï¼‰ã€‚</p></blockquote><h3 id="å¤§æ•°æ±‚å’Œ"><a href="#å¤§æ•°æ±‚å’Œ" class="headerlink" title="å¤§æ•°æ±‚å’Œ"></a>å¤§æ•°æ±‚å’Œ</h3><p>é‡‡ç”¨å°æ—¶ä¾¯å­¦åŠ æ³•æ—¶çš„æ‰‹åŠ¨è®¡ç®—çš„æ–¹æ³•ï¼Œä»æœ€ä½ä½ä¾æ¬¡ç›¸åŠ ï¼Œå¾—åˆ°æœ€åçš„ç»“æœ<br>å› ä¸ºå¯¹äºè¾ƒå¤§çš„æ•°jsä¼šè‡ªåŠ¨é‡‡ç”¨ç§‘å­¦è®°æ•°æ³•çš„æ–¹å¼è¡¨ç¤ºï¼Œæ‰€ä»¥å‚ä¸è®¡ç®—çš„å‚æ•°ç”¨å­—ç¬¦ä¸²è¡¨ç¤º</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getSum</span>(<span class="params">d1, d2</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// å¦‚æœç¬¬ä¸€ä¸ªæ•°è¾ƒå¤§åˆ™äº¤æ¢ä¸¤ä¸ªæ•°</span></span><br><span class="line">    <span class="keyword">if</span> (d1.length &lt; d2.length) &#123;</span><br><span class="line">        [d1, d2] = [d2, d1];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å°†ä¸¤ä¸ªæ•°è½¬ä¸ºæ•°ç»„å½¢å¼</span></span><br><span class="line">    <span class="keyword">let</span> [arr1, arr2] = [[...d1].reverse(), [...d2].reverse()];</span><br><span class="line">    <span class="comment">// numç”¨ä½œå½“å¯¹åº”ä½æ•°ç›¸åŠ å¤§äº10æ—¶åšè¿›ä½</span></span><br><span class="line">    <span class="keyword">let</span> num = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// å¾ªç¯arr1.lengthæ¬¡æ±‚å’Œ</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; arr1.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (arr2[i]) &#123;</span><br><span class="line">            arr1[i] = <span class="built_in">Number</span>.parseInt(arr1[i]) + <span class="built_in">Number</span>.parseInt(arr2[i]) + num;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            arr1[i] = <span class="built_in">Number</span>.parseInt(arr1[i]) + num;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (arr1[i] &gt;= <span class="number">10</span>) &#123;</span><br><span class="line">            [arr1[i], num] = [arr1[i] % <span class="number">10</span>, <span class="number">1</span>];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            num = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¦‚æœæœ€åè¿›ä½ä¸º1ï¼Œåˆ™ç»“æœå‰åº”åŠ 1ä¸º</span></span><br><span class="line">    <span class="keyword">if</span> (num === <span class="number">1</span>) &#123;</span><br><span class="line">        arr1[arr1.length] = num;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è¿”å›ç»“æœå­—ç¬¦ä¸²</span></span><br><span class="line">    <span class="keyword">return</span> arr1.reverse().join(<span class="string">''</span>);</span><br><span class="line">&#125;</span><br><span class="line">args=args.concat(arg)</span><br><span class="line"><span class="string">``</span><span class="string">` </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">### generatorå‡½æ•°çš„ä½¿ç”¨åœºæ™¯</span></span><br><span class="line"><span class="string">* å¤šæ–‡ä»¶ä¸Šä¼  ä¸Šä¼ å®Œç¬¬ä¸€ç»„æ–‡ä»¶ä¹‹åæš‚åœæ‰§è¡Œ åšå…¶ä»–çš„äº‹æƒ… ä¹‹åå†ç»§ç»­ä¸Šä¼  é€šè¿‡è¿”å›å€¼doneå±æ€§æ˜¯å¦ä¸ºçœŸæ¥åˆ¤æ–­èƒ½å¦ç»§ç»­æ‰§è¡Œ</span></span><br><span class="line"><span class="string">* ç”Ÿæˆå…·æœ‰indexçš„enumerateç»“æ„ (è¿”å›çš„æ˜¯iteratorå¯¹è±¡ èƒ½ç›´æ¥ä½¿ç”¨for inéå†ï¼Œä¹Ÿèƒ½ä½œä¸ºArray.fromç­‰çš„å‚æ•°)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">### æ·±åº¦æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡</span></span><br><span class="line"><span class="string">1.é€šè¿‡json.parse(json.stringify)... ç›¸ç­‰ç›´æ¥è¿”å›true</span></span><br><span class="line"><span class="string">2.object.keys.lengthä¸ç›¸ç­‰ è¿”å›false</span></span><br><span class="line"><span class="string">3.éå† é‡åˆ°ä¸ºå¯¹è±¡çš„å±æ€§é€’å½’</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">### å®ç° bind</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>js</span><br><span class="line"><span class="comment">// å®šä¹‰è¿™ä¸ªæ–¹æ³•ä¸ºmyBind</span></span><br><span class="line"><span class="built_in">Function</span>.prototype.my_bind = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> self = <span class="keyword">this</span>, <span class="comment">// ä¿å­˜åŸå‡½æ•°</span></span><br><span class="line">    context = <span class="built_in">Array</span>.prototype.shift.call(<span class="built_in">arguments</span>), <span class="comment">// ä¿å­˜éœ€è¦ç»‘å®šçš„thisä¸Šä¸‹æ–‡</span></span><br><span class="line">    <span class="comment">// ä¸Šä¸€è¡Œç­‰ä»·äº context = [].shift.call(arguments);</span></span><br><span class="line">    args = <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>) <span class="comment">// å‰©ä½™çš„å‚æ•°è½¬ä¸ºæ•°ç»„</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// è¿”å›ä¸€ä¸ªæ–°å‡½æ•°</span></span><br><span class="line">    self.apply(</span><br><span class="line">      context,</span><br><span class="line">      <span class="built_in">Array</span>.prototype.concat.call(args, <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>))</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="promiseçš„æ„é€ å‡½æ•°è·Ÿä»–çš„thenæ–¹æ³•æ˜¯å¼‚æ­¥è¿˜æ˜¯åŒæ­¥"><a href="#promiseçš„æ„é€ å‡½æ•°è·Ÿä»–çš„thenæ–¹æ³•æ˜¯å¼‚æ­¥è¿˜æ˜¯åŒæ­¥" class="headerlink" title="promiseçš„æ„é€ å‡½æ•°è·Ÿä»–çš„thenæ–¹æ³•æ˜¯å¼‚æ­¥è¿˜æ˜¯åŒæ­¥"></a>promiseçš„æ„é€ å‡½æ•°è·Ÿä»–çš„thenæ–¹æ³•æ˜¯å¼‚æ­¥è¿˜æ˜¯åŒæ­¥</h3><p>promiseæ„é€ å‡½æ•°æ˜¯åŒæ­¥æ‰§è¡Œçš„ï¼Œthenæ–¹æ³•å› ä¸ºæ˜¯å¾®ä»»åŠ¡æ˜¯å¼‚æ­¥æ‰§è¡Œçš„</p><h3 id="æ¨¡å—åŒ–"><a href="#æ¨¡å—åŒ–" class="headerlink" title="æ¨¡å—åŒ–"></a>æ¨¡å—åŒ–</h3><ul><li>ä¸ºä»€ä¹ˆè¦æ¨¡å—åŒ–<br>ä¸ºäº†é¿å…å…¨å±€æ±¡æŸ“</li><li>æ€ç»´å¯¼å›¾<br><a href="https://www.processon.com/view/link/5c8409bbe4b02b2ce492286a#map" target="_blank" rel="noopener">https://www.processon.com/view/link/5c8409bbe4b02b2ce492286a#map</a></li></ul><h3 id="jsç±»å‹è½¬æ¢"><a href="#jsç±»å‹è½¬æ¢" class="headerlink" title="jsç±»å‹è½¬æ¢"></a>jsç±»å‹è½¬æ¢</h3><ul><li><p>å¼ºåˆ¶ç±»å‹è½¬æ¢<br>é€šè¿‡ Number()ã€parseInt()ã€parseFloat()ã€toString()ã€String()ã€Boolean(),è¿›è¡Œå¼ºåˆ¶ç±»å‹è½¬æ¢ã€‚</p></li><li><p>éšå¼ç±»å‹è½¬æ¢<br>é€»è¾‘è¿ç®—ç¬¦(&amp;&amp;ã€ ||ã€ !)ã€è¿ç®—ç¬¦(+ã€-ã€*ã€/)ã€å…³ç³»æ“ä½œç¬¦(&gt;ã€ &lt;ã€ &lt;= ã€&gt;=)ã€ç›¸ç­‰è¿ç®—ç¬¦(==)æˆ–è€… if/while çš„æ¡ä»¶ï¼Œå¯èƒ½ä¼šè¿›è¡Œéšå¼ç±»å‹è½¬æ¢ã€‚<br>å…³äºvalueof tostring<br>åœ¨æ•°å€¼è¿ç®—é‡Œï¼Œä¼šä¼˜å…ˆè°ƒç”¨valueOf() å­—ç¬¦ä¸²è¿ç®—ä¼˜å…ˆè°ƒç”¨åè€…</p></li></ul><h3 id="å®ç°æ•°ç»„æ‰å¹³åŒ–"><a href="#å®ç°æ•°ç»„æ‰å¹³åŒ–" class="headerlink" title="å®ç°æ•°ç»„æ‰å¹³åŒ–"></a>å®ç°æ•°ç»„æ‰å¹³åŒ–</h3><ul><li>æ–¹å¼ä¸€</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">;[].concat.apply([], [[<span class="number">1</span>], [<span class="number">2</span>], [<span class="number">3</span>]]) <span class="comment">// [1, 2, 3]</span></span><br></pre></td></tr></table></figure><ul><li><p>chrome 69 åæ•°ç»„è‡ªå¸¦ flat æ–¹æ³•</p></li><li><p>æ–¹å¼äºŒ</p></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">flatten</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> arr.reduce(<span class="function"><span class="keyword">function</span>(<span class="params">prev, item</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> prev.concat(<span class="built_in">Array</span>.isArray(item) ? flatten(item) : item)</span><br><span class="line">  &#125;, [])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æ–¹å¼ä¸‰</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">flatten</span>(<span class="params">arr</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(arr.some(<span class="function"><span class="params">item</span>=&gt;</span><span class="built_in">Array</span>.isArray(item))&#123;</span><br><span class="line">        arr = [].concat(...arr);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å®ç°-1-2-mutiple-1-2-1-4"><a href="#å®ç°-1-2-mutiple-1-2-1-4" class="headerlink" title="å®ç°[1,2].mutiple() = [1,2,1,4]"></a>å®ç°<code>[1,2].mutiple() = [1,2,1,4]</code></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Array</span>.prototype.mutiple = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> tail = <span class="keyword">this</span>.map(<span class="function">(<span class="params">item</span>) =&gt;</span> item ** <span class="number">2</span>)</span><br><span class="line">  <span class="keyword">return</span> [...this, ...tail]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å®ç°composeå‡½æ•°"><a href="#å®ç°composeå‡½æ•°" class="headerlink" title="å®ç°composeå‡½æ•°"></a>å®ç°composeå‡½æ•°</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">compose</span>(<span class="params">...funcs</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (funcs.length === <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">arg</span> =&gt;</span> arg</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (funcs.length === <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> funcs[<span class="number">0</span>]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> last = funcs[funcs.length - <span class="number">1</span>]</span><br><span class="line">  <span class="keyword">const</span> rest = funcs.slice(<span class="number">0</span>, <span class="number">-1</span>)</span><br><span class="line">  <span class="comment">// reduceright:å°†æ•°ç»„ä¸­æ¯ä¸€é¡¹ä»å³å‘å·¦è°ƒç”¨callback</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">...args</span>) =&gt;</span> rest.reduceRight(<span class="function">(<span class="params">composed, f</span>) =&gt;</span> f(composed), last(...args))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="var-a3-name-â€œå‰ç«¯å¼€å‘â€-var-b3-a3-a3-null-console-log-b3"><a href="#var-a3-name-â€œå‰ç«¯å¼€å‘â€-var-b3-a3-a3-null-console-log-b3" class="headerlink" title="var a3 = {name: â€œå‰ç«¯å¼€å‘â€}; var b3 = a3; a3 = null console.log(b3)?"></a>var a3 = {name: â€œå‰ç«¯å¼€å‘â€}; var b3 = a3; a3 = null console.log(b3)?</h3><p>// {name: â€œå‰ç«¯å¼€å‘â€}</p><h3 id="äº‹ä»¶å§”æ‰˜çš„ä¼˜ç¼ºç‚¹"><a href="#äº‹ä»¶å§”æ‰˜çš„ä¼˜ç¼ºç‚¹" class="headerlink" title="äº‹ä»¶å§”æ‰˜çš„ä¼˜ç¼ºç‚¹"></a>äº‹ä»¶å§”æ‰˜çš„ä¼˜ç¼ºç‚¹</h3><ul><li>ä¼˜ç‚¹<br>å‡å°‘äº‹ä»¶æ³¨å†Œ å‡å°å†…å­˜</li><li>ç¼ºç‚¹<br>æœ‰çš„äº‹ä»¶ä¸æ”¯æŒå†’æ³¡</li></ul><h3 id="0-1-0-2-0-3"><a href="#0-1-0-2-0-3" class="headerlink" title="0.1+0.2!=0.3"></a>0.1+0.2!=0.3</h3><p>åè¿›åˆ¶çš„ 0.1 å’Œ 0.2 éƒ½ä¼šè¢«è½¬æ¢æˆäºŒè¿›åˆ¶ï¼Œä½†ç”±äºæµ®ç‚¹æ•°ç”¨äºŒè¿›åˆ¶è¡¨è¾¾æ—¶æ˜¯æ— ç©·çš„ï¼Œä¾‹å¦‚ã€‚<br>JavaScript ä»£ç :<br>0.1 -&gt; 0.0001100110011001â€¦(æ— é™)<br>0.2 -&gt; 0.0011001100110011â€¦(æ— é™)<br>IEEE 754 æ ‡å‡†çš„ 64 ä½åŒç²¾åº¦æµ®ç‚¹æ•°çš„å°æ•°éƒ¨åˆ†æœ€å¤šæ”¯æŒ 53 ä½äºŒè¿›åˆ¶ä½ï¼Œæ‰€ä»¥ä¸¤è€…ç›¸åŠ ä¹‹åå¾—åˆ°äºŒè¿›åˆ¶ä¸ºï¼š<br>JavaScript ä»£ç :<br>0.0100110011001100110011001100110011001100110011001100<br>å› æµ®ç‚¹æ•°å°æ•°ä½çš„é™åˆ¶è€Œæˆªæ–­çš„äºŒè¿›åˆ¶æ•°å­—ï¼Œå†è½¬æ¢ä¸ºåè¿›åˆ¶ï¼Œå°±æˆäº† 0.30000000000000004ã€‚æ‰€ä»¥åœ¨è¿›è¡Œç®—æœ¯è®¡ç®—æ—¶ä¼šäº§ç”Ÿè¯¯å·®</p><h3 id="æ€ä¹ˆè®¾ç½®å¯¹è±¡çš„å±æ€§ä¸èƒ½è¢«åˆ é™¤ï¼Ÿ"><a href="#æ€ä¹ˆè®¾ç½®å¯¹è±¡çš„å±æ€§ä¸èƒ½è¢«åˆ é™¤ï¼Ÿ" class="headerlink" title="æ€ä¹ˆè®¾ç½®å¯¹è±¡çš„å±æ€§ä¸èƒ½è¢«åˆ é™¤ï¼Ÿ"></a>æ€ä¹ˆè®¾ç½®å¯¹è±¡çš„å±æ€§ä¸èƒ½è¢«åˆ é™¤ï¼Ÿ</h3><p><code>definePropperty</code>è®¾ç½®<code>configurable</code> false<br>why? <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/delete" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/delete</a></p><h3 id="addeventListenerçš„ç¬¬ä¸‰ä¸ªå‚æ•°"><a href="#addeventListenerçš„ç¬¬ä¸‰ä¸ªå‚æ•°" class="headerlink" title="addeventListenerçš„ç¬¬ä¸‰ä¸ªå‚æ•°"></a>addeventListenerçš„ç¬¬ä¸‰ä¸ªå‚æ•°</h3><p>æ˜¯ä¸€ä¸ªå¯¹è±¡option,åŒ…æ‹¬<code>capture, passive,once</code>é€‰é¡¹ ä¸æ”¯æŒè¿™ç§å†™æ³•çš„é»˜è®¤ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯<code>usecapture</code></p><h3 id="å‡ ç§åˆ¤æ–­æ•°ç»„ç±»å‹çš„ä¼˜ç¼ºç‚¹"><a href="#å‡ ç§åˆ¤æ–­æ•°ç»„ç±»å‹çš„ä¼˜ç¼ºç‚¹" class="headerlink" title="å‡ ç§åˆ¤æ–­æ•°ç»„ç±»å‹çš„ä¼˜ç¼ºç‚¹"></a>å‡ ç§åˆ¤æ–­æ•°ç»„ç±»å‹çš„ä¼˜ç¼ºç‚¹</h3><p>instanceofä¸èƒ½æ£€æµ‹æ¥è‡ªiframeçš„æ•°ç»„ã€‚å°±æ˜¯window.frames[xx].Arrayæ„é€ å‡ºæ¥çš„æ•°ç»„<br>Array.isArrayå…¼å®¹æ€§æ²¡é‚£ä¹ˆå¥½</p><h3 id="ä¸ºä»€ä¹ˆè¡¨å•èƒ½è·¨åŸŸ"><a href="#ä¸ºä»€ä¹ˆè¡¨å•èƒ½è·¨åŸŸ" class="headerlink" title="ä¸ºä»€ä¹ˆè¡¨å•èƒ½è·¨åŸŸ"></a>ä¸ºä»€ä¹ˆè¡¨å•èƒ½è·¨åŸŸ</h3><p>å› ä¸ºè¡¨å•çš„è¯·æ±‚ä¸€èˆ¬éƒ½æ˜¯æäº¤æ•°æ® å¹¶ä¸”ä¼ ç»Ÿformè¡¨å•æäº¤æµè§ˆå™¨ä¼šå‘ç”Ÿè·³è½¬ å¹¶ä¸”ä¸éœ€è¦è¿”å›å“åº”æ•°æ® æ˜¯å®‰å…¨çš„</p><h3 id="ä¸ºä»€ä¹ˆç®­å¤´å‡½æ•°ä¸èƒ½ä½¿ç”¨newæ“ä½œç¬¦"><a href="#ä¸ºä»€ä¹ˆç®­å¤´å‡½æ•°ä¸èƒ½ä½¿ç”¨newæ“ä½œç¬¦" class="headerlink" title="ä¸ºä»€ä¹ˆç®­å¤´å‡½æ•°ä¸èƒ½ä½¿ç”¨newæ“ä½œç¬¦"></a>ä¸ºä»€ä¹ˆç®­å¤´å‡½æ•°ä¸èƒ½ä½¿ç”¨<code>new</code>æ“ä½œç¬¦</h3><p>å› ä¸ºå®ƒæ²¡æœ‰è‡ªå·±çš„thisä¸prototype å±æ€§ ï¼Œè€Œ new å‘½ä»¤åœ¨æ‰§è¡Œæ—¶éœ€è¦å°†æ„é€ å‡½æ•°çš„ prototype èµ‹å€¼ç»™æ–°çš„å¯¹è±¡çš„ <strong>proto</strong></p><h2 id="react-ç›¸å…³"><a href="#react-ç›¸å…³" class="headerlink" title="react ç›¸å…³"></a>react ç›¸å…³</h2><h3 id="React-ä¸­-setState-ä»€ä¹ˆæ—¶å€™æ˜¯åŒæ­¥çš„ï¼Œä»€ä¹ˆæ—¶å€™æ˜¯å¼‚æ­¥çš„"><a href="#React-ä¸­-setState-ä»€ä¹ˆæ—¶å€™æ˜¯åŒæ­¥çš„ï¼Œä»€ä¹ˆæ—¶å€™æ˜¯å¼‚æ­¥çš„" class="headerlink" title="React ä¸­ setState ä»€ä¹ˆæ—¶å€™æ˜¯åŒæ­¥çš„ï¼Œä»€ä¹ˆæ—¶å€™æ˜¯å¼‚æ­¥çš„"></a>React ä¸­ setState ä»€ä¹ˆæ—¶å€™æ˜¯åŒæ­¥çš„ï¼Œä»€ä¹ˆæ—¶å€™æ˜¯å¼‚æ­¥çš„</h3><p>åœ¨ React ä¸­ï¼Œå¦‚æœæ˜¯ç”± React å¼•å‘çš„äº‹ä»¶å¤„ç†ä¹Ÿå°±æ˜¯åˆæˆäº‹ä»¶ï¼ˆæ¯”å¦‚é€šè¿‡ onClick å¼•å‘çš„äº‹ä»¶å¤„ç†ï¼‰ï¼Œè°ƒç”¨ setState ä¸ä¼šåŒæ­¥æ›´æ–° this.stateï¼Œé™¤æ­¤ä¹‹å¤–çš„ setState è°ƒç”¨ä¼šåŒæ­¥æ‰§è¡Œ this.stateã€‚æ‰€è°“â€œé™¤æ­¤ä¹‹å¤–â€ï¼ŒæŒ‡çš„æ˜¯ç»•è¿‡ React é€šè¿‡ addEventListener ç›´æ¥æ·»åŠ çš„äº‹ä»¶å¤„ç†å‡½æ•°ä¹Ÿå°±æ˜¯åŸç”Ÿäº‹ä»¶ï¼Œè¿˜æœ‰é€šè¿‡ setTimeout/setInterval äº§ç”Ÿçš„å¼‚æ­¥è°ƒç”¨ã€‚</p><p><strong>åŸå› ï¼š</strong>åœ¨ React çš„ setState å‡½æ•°å®ç°ä¸­ï¼Œä¼šæ ¹æ®ä¸€ä¸ªå˜é‡ isBatchingUpdates åˆ¤æ–­æ˜¯ç›´æ¥æ›´æ–° this.state è¿˜æ˜¯æ”¾åˆ°é˜Ÿåˆ—ä¸­å›å¤´å†è¯´ï¼Œè€Œ isBatchingUpdates é»˜è®¤æ˜¯ falseï¼Œä¹Ÿå°±è¡¨ç¤º setState ä¼šåŒæ­¥æ›´æ–° this.stateï¼Œä½†æ˜¯ï¼Œæœ‰ä¸€ä¸ªå‡½æ•° batchedUpdatesï¼Œè¿™ä¸ªå‡½æ•°ä¼šæŠŠ isBatchingUpdates ä¿®æ”¹ä¸º trueï¼Œè€Œå½“ React åœ¨è°ƒç”¨äº‹ä»¶å¤„ç†å‡½æ•°ä¹‹å‰å°±ä¼šè°ƒç”¨è¿™ä¸ª batchedUpdatesï¼Œé€ æˆçš„åæœï¼Œå°±æ˜¯ç”± React æ§åˆ¶çš„äº‹ä»¶å¤„ç†è¿‡ç¨‹ setState ä¸ä¼šåŒæ­¥æ›´æ–° this.stateã€‚</p><h3 id="jsx-è¯­æ³•ä¸ºä»€ä¹ˆ-éœ€è¦-import-react-åŒ…"><a href="#jsx-è¯­æ³•ä¸ºä»€ä¹ˆ-éœ€è¦-import-react-åŒ…" class="headerlink" title="jsx è¯­æ³•ä¸ºä»€ä¹ˆ éœ€è¦ import react åŒ…"></a>jsx è¯­æ³•ä¸ºä»€ä¹ˆ éœ€è¦ import react åŒ…</h3><p>JSX è¯­æ³•åªæ˜¯ä¸€ç§è¯­æ³•ç³–ï¼Œ<code>babel</code>è½¬è¯‘ä¹‹åå°±ä¼šå˜æˆ<code>React.createElement</code></p><h3 id="react-ç”Ÿå‘½å‘¨æœŸå˜æ›´çš„åŸå› "><a href="#react-ç”Ÿå‘½å‘¨æœŸå˜æ›´çš„åŸå› " class="headerlink" title="react ç”Ÿå‘½å‘¨æœŸå˜æ›´çš„åŸå› "></a>react ç”Ÿå‘½å‘¨æœŸå˜æ›´çš„åŸå› </h3><p>åœ¨ fiber ä¸­ï¼Œæ›´æ–°æ˜¯åˆ†é˜¶æ®µçš„ï¼Œå…·ä½“åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼Œé¦–å…ˆæ˜¯ reconciliation çš„é˜¶æ®µï¼Œè¿™ä¸ªé˜¶æ®µåœ¨è®¡ç®—å‰å dom æ ‘çš„å·®å¼‚ï¼Œç„¶åæ˜¯ commit çš„é˜¶æ®µï¼Œè¿™ä¸ªé˜¶æ®µå°†æŠŠæ›´æ–°æ¸²æŸ“åˆ°é¡µé¢ä¸Šã€‚ç¬¬ä¸€ä¸ªé˜¶æ®µæ˜¯å¯ä»¥æ‰“æ–­çš„ï¼Œå› ä¸ºè¿™ä¸ªé˜¶æ®µè€—æ—¶å¯èƒ½ä¼šå¾ˆé•¿ï¼Œå› æ­¤éœ€è¦æš‚åœä¸‹æ¥å»æ‰§è¡Œå…¶ä»–æ›´é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡ï¼Œç¬¬äºŒä¸ªé˜¶æ®µåˆ™ä¸ä¼šè¢«æ‰“æ–­ï¼Œä¼šä¸€å£æ°”æŠŠæ›´æ–°æ¸²æŸ“åˆ°é¡µé¢ä¸Šã€‚</p><p>ç”±äº <code>reconciliation</code> çš„é˜¶æ®µä¼šè¢«æ‰“æ–­ï¼Œå¯èƒ½ä¼šå¯¼è‡´ <code>commit</code> å‰çš„è¿™äº›ç”Ÿå‘½å‘¨æœŸå‡½æ•°å¤šæ¬¡æ‰§è¡Œã€‚react å®˜æ–¹ç›®å‰å·²ç»æŠŠ <code>componentWillMount</code>ã€<code>componentWillReceiveProps</code> å’Œ <code>componetWillUpdate</code> æ ‡è®°ä¸º unsafeï¼Œå¹¶ä½¿ç”¨æ–°çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•° <code>getDerivedStateFromProps</code> å’Œ <code>getSnapshotBeforeUpdate</code> è¿›è¡Œæ›¿æ¢ã€‚</p><p>ç»„ä»¶çš„æ¸²æŸ“è¢«åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼šç¬¬ä¸€ä¸ªé˜¶æ®µï¼ˆä¹Ÿå«åš render é˜¶æ®µï¼‰æ˜¯å¯ä»¥è¢« React æ‰“æ–­çš„ï¼Œä¸€æ—¦è¢«æ‰“æ–­ï¼Œè¿™é˜¶æ®µæ‰€åšçš„æ‰€æœ‰äº‹æƒ…éƒ½è¢«åºŸå¼ƒï¼Œå½“ React å¤„ç†å®Œç´§æ€¥çš„äº‹æƒ…å›æ¥ï¼Œä¾ç„¶ä¼šé‡æ–°æ¸²æŸ“è¿™ä¸ªç»„ä»¶ï¼Œè¿™æ—¶å€™ç¬¬ä¸€é˜¶æ®µçš„å·¥ä½œä¼šé‡åšä¸€éï¼›ç¬¬äºŒä¸ªé˜¶æ®µå«åš commit é˜¶æ®µï¼Œä¸€æ—¦å¼€å§‹å°±ä¸èƒ½ä¸­æ–­ï¼Œä¹Ÿå°±æ˜¯è¯´ç¬¬äºŒä¸ªé˜¶æ®µçš„å·¥ä½œä¼šç¨³ç¨³å½“å½“åœ°åšåˆ°è¿™ä¸ªç»„ä»¶çš„æ¸²æŸ“ç»“æŸã€‚</p><p>ä¸¤ä¸ªé˜¶æ®µçš„åˆ†ç•Œç‚¹ï¼Œå°±æ˜¯  render  å‡½æ•°ã€‚render å‡½æ•°ä¹‹å‰çš„æ‰€æœ‰ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼ˆåŒ…æ‹¬ render)éƒ½å±äºç¬¬ä¸€é˜¶æ®µï¼Œä¹‹åçš„éƒ½å±äºç¬¬äºŒé˜¶æ®µã€‚<br>render ä¹‹å‰çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼ˆä¹Ÿå°±æ˜¯ç¬¬ä¸€é˜¶æ®µç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼‰åŒ…æ‹¬è¿™äº›ï¼š</p><blockquote><p>componentWillReceiveProps<br>shouldComponentUpdate<br>componentWillUpdate<br>componentWillMount<br>render</p></blockquote><p>getDerivedStateFromProps åº”è¯¥æ˜¯ä¸€ä¸ªçº¯å‡½æ•°ï¼ŒReact å°±æ˜¯é€šè¿‡è¦æ±‚è¿™ç§çº¯å‡½æ•°ï¼Œå¼ºåˆ¶å¼€å‘è€…ä»¬å¿…é¡»é€‚åº”å¼‚æ­¥æ¸²æŸ“ã€‚</p><h4 id="reconciliation-é˜¶æ®µ"><a href="#reconciliation-é˜¶æ®µ" class="headerlink" title="reconciliation é˜¶æ®µ"></a>reconciliation é˜¶æ®µ</h4><p>è™šæ‹Ÿ dom çš„æ•°æ®å¯¹æ¯”</p><h4 id="commit-é˜¶æ®µ"><a href="#commit-é˜¶æ®µ" class="headerlink" title="commit é˜¶æ®µ"></a>commit é˜¶æ®µ</h4><p>å°† change list æ›´æ–°åˆ° dom ä¸Š ä¸é€‚åˆæ‹†åˆ†æ˜¯å› ä¸ºä½¿ç”¨ vdom çš„æ„ä¹‰å°±æ˜¯ä¸ºäº†èŠ‚çœè€—æ—¶çš„ dom æ“ä½œ</p><h3 id="ç”Ÿå‘½å‘¨æœŸ"><a href="#ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ç”Ÿå‘½å‘¨æœŸ"></a>ç”Ÿå‘½å‘¨æœŸ</h3><p>React16.3 å¼€å¯å¼‚æ­¥æ¸²æŸ“</p><h4 id="æ–°å¢çš„ä¸¤ä¸ª"><a href="#æ–°å¢çš„ä¸¤ä¸ª" class="headerlink" title="æ–°å¢çš„ä¸¤ä¸ª"></a>æ–°å¢çš„ä¸¤ä¸ª</h4><ul><li><p>getDerivedStateFromProps<br>è§¦å‘æ—¶é—´(v16.4 ä¿®æ­£)ï¼šç»„ä»¶æ¯æ¬¡è¢« render çš„æ—¶å€™ï¼ŒåŒ…æ‹¬åœ¨ç»„ä»¶æ„å»ºä¹‹å(è™šæ‹Ÿ dom ä¹‹åï¼Œå®é™… dom æŒ‚è½½ä¹‹å‰)ï¼Œæ¯æ¬¡è·å–æ–°çš„ props æˆ– state ä¹‹åã€‚åœ¨ v16.3 ç‰ˆæœ¬æ—¶ï¼Œç»„ä»¶ state çš„æ›´æ–°ä¸ä¼šè§¦å‘è¯¥ç”Ÿå‘½å‘¨æœŸã€‚<br>æ¯æ¬¡æ¥æ”¶æ–°çš„ props ä¹‹åéƒ½ä¼šè¿”å›ä¸€ä¸ªå¯¹è±¡ä½œä¸ºæ–°çš„ stateï¼Œè¿”å› null åˆ™è¯´æ˜ä¸éœ€è¦æ›´æ–° state.<br>é…åˆ componentDidUpdateï¼Œå¯ä»¥è¦†ç›– componentWillReceiveProps çš„æ‰€æœ‰ç”¨æ³•<br>getDerivedStateFromProps æ˜¯ä¸€ä¸ªé™æ€å‡½æ•°ï¼Œæ‰€ä»¥å‡½æ•°ä½“å†…ä¸èƒ½è®¿é—® thisï¼Œè¾“å‡ºå®Œå…¨ç”±è¾“å…¥å†³å®šã€‚</p></li><li><p>getSnapshotBeforeUpdate</p></li></ul><p>è§¦å‘æ—¶é—´: update å‘ç”Ÿçš„æ—¶å€™ï¼Œåœ¨ render ä¹‹åï¼Œåœ¨ç»„ä»¶ dom æ¸²æŸ“ä¹‹å‰ã€‚<br>è¿”å›ä¸€ä¸ªå€¼ï¼Œä½œä¸º componentDidUpdate çš„ç¬¬ä¸‰ä¸ªå‚æ•°ã€‚<br>é…åˆ componentDidUpdate, å¯ä»¥è¦†ç›– componentWillUpdate çš„æ‰€æœ‰ç”¨æ³•</p><h4 id="setStateå¯ä»¥æ¥å—å‡½æ•°ä¸ºå‚æ•°å—ï¼Ÿæœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ"><a href="#setStateå¯ä»¥æ¥å—å‡½æ•°ä¸ºå‚æ•°å—ï¼Ÿæœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ" class="headerlink" title="setStateå¯ä»¥æ¥å—å‡½æ•°ä¸ºå‚æ•°å—ï¼Ÿæœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ"></a>setStateå¯ä»¥æ¥å—å‡½æ•°ä¸ºå‚æ•°å—ï¼Ÿæœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.setState(<span class="function">(<span class="params">prevState, props</span>) =&gt;</span> (&#123;</span><br><span class="line">  counter: prevState.counter + props.increment</span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure><h4 id="å…³äºcomponentDidCatchçš„è§¦å‘æ—¶æœº"><a href="#å…³äºcomponentDidCatchçš„è§¦å‘æ—¶æœº" class="headerlink" title="å…³äºcomponentDidCatchçš„è§¦å‘æ—¶æœº"></a>å…³äº<code>componentDidCatch</code>çš„è§¦å‘æ—¶æœº</h4><p>componentDidCatch()<br>componentDidCatch(err, info)<br>ä»»ä½•å­ç»„ä»¶åœ¨æ¸²æŸ“æœŸé—´ï¼Œç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¸­æˆ–è€…æ„é€ å‡½æ•° constructor å‘ç”Ÿé”™è¯¯æ—¶è°ƒç”¨ã€‚</p><p>é”™è¯¯è¾¹ç•Œä¸ä¼šæ•è·ä¸‹é¢çš„é”™è¯¯ï¼š</p><ul><li>äº‹ä»¶å¤„ç† (Event handlers) ï¼ˆå› ä¸ºäº‹ä»¶å¤„ç†ä¸å‘ç”Ÿåœ¨ React æ¸²æŸ“æ—¶ï¼ŒæŠ¥é”™ä¸å½±å“æ¸²æŸ“ï¼‰</li><li>å¼‚æ­¥ä»£ç  (Asynchronous code) (e.g. setTimeout or requestAnimationFrame callbacks)</li><li>æœåŠ¡ç«¯æ¸²æŸ“ (Server side rendering)</li><li>é”™è¯¯è¾¹ç•Œæœ¬èº«(è€Œä¸æ˜¯å­ç»„ä»¶)æŠ›å‡ºçš„é”™è¯¯</li></ul><h4 id="è¡¥å……ï¼šstatic-getDerivedStateFromError"><a href="#è¡¥å……ï¼šstatic-getDerivedStateFromError" class="headerlink" title="è¡¥å……ï¼šstatic getDerivedStateFromError"></a>è¡¥å……ï¼š<code>static getDerivedStateFromError</code></h4><p>æ­¤ç”Ÿå‘½å‘¨æœŸä¼šåœ¨åä»£ç»„ä»¶æŠ›å‡ºé”™è¯¯åè¢«è°ƒç”¨ã€‚ å®ƒå°†æŠ›å‡ºçš„é”™è¯¯ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªå€¼ä»¥æ›´æ–° state,å¯ä»¥åœ¨æ­¤ç”Ÿå‘½å‘¨æœŸä¸­ æ›´æ–° state ä½¿ä¸‹ä¸€æ¬¡æ¸²æŸ“å¯ä»¥æ˜¾é™çº§ UIã€‚<br>getDerivedStateFromError() ä¼šåœ¨æ¸²æŸ“é˜¶æ®µè°ƒç”¨ï¼Œå› æ­¤ä¸å…è®¸å‡ºç°å‰¯ä½œç”¨ã€‚ å¦‚é‡æ­¤ç±»æƒ…å†µï¼Œè¯·æ”¹ç”¨ componentDidCatch()</p><blockquote><p>note: UNSAFE_componentWillMount() åœ¨æŒ‚è½½ä¹‹å‰è¢«è°ƒç”¨ã€‚å®ƒåœ¨ render() ä¹‹å‰è°ƒç”¨ï¼Œå› æ­¤åœ¨æ­¤æ–¹æ³•ä¸­åŒæ­¥è°ƒç”¨ setState() ä¸ä¼šè§¦å‘é¢å¤–æ¸²æŸ“ã€‚é€šå¸¸ï¼Œæˆ‘ä»¬å»ºè®®ä½¿ç”¨ constructor() æ¥åˆå§‹åŒ– stateã€‚</p></blockquote><h4 id="react-router-çš„åŸç†"><a href="#react-router-çš„åŸç†" class="headerlink" title="react-router çš„åŸç†"></a><a href="https://www.cnblogs.com/chenjinxinlove/p/8467744.html" target="_blank" rel="noopener">react-router çš„åŸç†</a></h4><h4 id="react-routerçš„å®ç°åŸç†"><a href="#react-routerçš„å®ç°åŸç†" class="headerlink" title="react-routerçš„å®ç°åŸç†"></a><code>react-router</code>çš„å®ç°åŸç†</h4><ul><li><p>createBrowserHistory: åˆ©ç”¨ HTML5 é‡Œé¢çš„ history</p></li><li><p>createHashHistory: é€šè¿‡ hash æ¥å­˜å‚¨åœ¨ä¸åŒçŠ¶æ€ä¸‹çš„ history ä¿¡æ¯</p></li><li><p>createMemoryHistory: åœ¨å†…å­˜ä¸­è¿›è¡Œå†å²è®°å½•çš„å­˜å‚¨</p></li></ul><h4 id="linkç»„ä»¶è·Ÿaæ ‡ç­¾çš„åŒºåˆ«"><a href="#linkç»„ä»¶è·Ÿaæ ‡ç­¾çš„åŒºåˆ«" class="headerlink" title="linkç»„ä»¶è·Ÿaæ ‡ç­¾çš„åŒºåˆ«"></a>linkç»„ä»¶è·Ÿaæ ‡ç­¾çš„åŒºåˆ«</h4><p>æœ‰onclické‚£å°±æ‰§è¡Œonclick<br>clickçš„æ—¶å€™é˜»æ­¢aæ ‡ç­¾é»˜è®¤äº‹ä»¶ï¼ˆè¿™æ ·å­ç‚¹å‡»<a href="/abc">123</a>å°±ä¸ä¼šè·³è½¬å’Œåˆ·æ–°é¡µé¢ï¼‰<br>å†å–å¾—è·³è½¬hrefï¼ˆå³æ˜¯toï¼‰ï¼Œç”¨historyï¼ˆå‰ç«¯è·¯ç”±ä¸¤ç§æ–¹å¼ä¹‹ä¸€ï¼Œhistory &amp; hashï¼‰è·³è½¬ï¼Œæ­¤æ—¶åªæ˜¯é“¾æ¥å˜äº†ï¼Œå¹¶æ²¡æœ‰åˆ·æ–°é¡µé¢</p><h4 id="ä¼ªä»£ç å®ç°"><a href="#ä¼ªä»£ç å®ç°" class="headerlink" title="ä¼ªä»£ç å®ç°"></a>ä¼ªä»£ç å®ç°</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// createBrowserHistory(HTML5)ä¸­çš„å‰è¿›å®ç°</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">finishTransition</span>(<span class="params">location</span>) </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">const</span> historyState = &#123; key &#125;;</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">if</span> (location.action === <span class="string">'PUSH'</span>) ) &#123;</span><br><span class="line">    <span class="built_in">window</span>.history.pushState(historyState, <span class="literal">null</span>, path);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">window</span>.history.replaceState(historyState, <span class="literal">null</span>, path)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// createHashHistoryçš„å†…éƒ¨å®ç°</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">finishTransition</span>(<span class="params">location</span>) </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">if</span> (location.action === <span class="string">'PUSH'</span>) ) &#123;</span><br><span class="line">    <span class="built_in">window</span>.location.hash = path;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">window</span>.location.replace(</span><br><span class="line">    <span class="built_in">window</span>.location.pathname + <span class="built_in">window</span>.location.search + <span class="string">'#'</span> + path</span><br><span class="line">  );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// createMemoryHistoryçš„å†…éƒ¨å®ç°</span></span><br><span class="line">entries = [];</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">finishTransition</span>(<span class="params">location</span>) </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">switch</span> (location.action) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'PUSH'</span>:</span><br><span class="line">      entries.push(location);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'REPLACE'</span>:</span><br><span class="line">      entries[current] = location;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="vue-ç›¸å…³"><a href="#vue-ç›¸å…³" class="headerlink" title="vue ç›¸å…³"></a>vue ç›¸å…³</h2><ul><li>ä¸ºä»€ä¹ˆç»„ä»¶çš„ data å¿…é¡»æ˜¯ä¸€ä¸ªå‡½æ•°<br>ä¸ºäº†è®©æ¯ä¸€ä¸ªå®ä¾‹ç»´æŠ¤ä¸€ä»½è¿”å›å¯¹è±¡çš„ç‹¬ç«‹çš„æ‹·è´ï¼Œè¿™æ ·å„ä¸ªç»„ä»¶çš„ data å˜åŒ–çš„æ—¶å€™äº’ä¸å½±å“</li></ul><h2 id="nodeç›¸å…³"><a href="#nodeç›¸å…³" class="headerlink" title="nodeç›¸å…³"></a>nodeç›¸å…³</h2><ul><li>nodeæ–‡ä»¶æŸ¥æ‰¾æœºåˆ¶<br>æ€»ä½“æµç¨‹<br><img src="https://img-blog.csdn.net/20140518175333390?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvYWFha2luZ3dpbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="image"><br>å…¶ä½™çš„<br><img src="https://img-blog.csdn.net/20140518175420125?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvYWFha2luZ3dpbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="image"></li></ul><h3 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h3><ul><li><a href="https://juejin.im/post/5b0b9b9051882515773ae714" target="_blank" rel="noopener">æµ…è°ˆ instanceof å’Œ typeof çš„å®ç°åŸç†</a></li><li><a href="https://zhuanlan.zhihu.com/p/32031325" target="_blank" rel="noopener">ä¸¤ä¸ªå¤§æ•°æ±‚å’Œ</a></li><li><a href="https://github.com/sisterAn/blog/issues/26" target="_blank" rel="noopener">æ·±å…¥ setstate æœºåˆ¶</a></li><li><a href="https://segmentfault.com/a/1190000020348448" target="_blank" rel="noopener">å¤§è¯ react ç”Ÿå‘½å‘¨æœŸ 2019ï¼šreact-v16.3 æ–°ç”Ÿå‘½å‘¨æœŸæ€»ç»“</a></li><li><a href="https://blog.csdn.net/tangzhl/article/details/79696055" target="_blank" rel="noopener">react-router çš„å®ç°åŸç†</a></li><li><a href="https://juejin.im/post/5af3cc4af265da0ba3521028" target="_blank" rel="noopener">ç¤¾æ‹›ä¸­çº§å‰ç«¯ç¬”è¯•é¢è¯•é¢˜æ€»ç»“</a></li><li><a href="https://www.quora.com/Why-is-Reacts-virtual-DOM-so-much-faster-than-the-real-DOM" target="_blank" rel="noopener">Why is Reactâ€™s virtual DOM so much faster than the real DOM?</a></li><li><a href="https://github.com/yygmind/blog/issues/43" target="_blank" rel="noopener">å‰ç«¯ 100 é—®ï¼šèƒ½ææ‡‚80%çš„è¯·æŠŠç®€å†ç»™æˆ‘</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> é¢ç» </category>
          
          <category> js </category>
          
      </categories>
      
      
        <tags>
            
            <tag> js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2019å¹´åº¦æ€»ç»“</title>
      <link href="/ashley271017.github.io/2019/12/10/2019%E5%B9%B4%E5%BA%A6%E6%80%BB%E7%BB%93/"/>
      <url>/ashley271017.github.io/2019/12/10/2019%E5%B9%B4%E5%BA%A6%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<p><img src="https://www.2008php.com/2014_Website_appreciate/2015-12-16/20151216171611.jpg" alt="img"></p><h2 id="å†™ç»™è‡ªå·±çš„å‡†åˆ™"><a href="#å†™ç»™è‡ªå·±çš„å‡†åˆ™" class="headerlink" title="å†™ç»™è‡ªå·±çš„å‡†åˆ™"></a>å†™ç»™è‡ªå·±çš„å‡†åˆ™</h2><ul><li><p>ä¸ç®¡æ”¹åŠ¨çš„æ–‡ä»¶å†å¤šï¼Œéƒ½è¦ä¸€ä¸ªä¸ªæ£€æŸ¥ï¼Œçœ‹æœ‰æ²¡æœ‰è¯¯æ”¹çš„åœ°æ–¹ï¼Œè‡ªå·±çš„æ”¹åŠ¨æœ‰æ²¡æœ‰å½±å“å…¶ä»–çš„åŠŸèƒ½</p></li><li><p>å†™ä»£ç å‰ï¼Œè¯·ä¸‰æ€ï¼Œè¯·ä¸‰æ€ï¼Œè¯·ä¸‰æ€ï¼Œä¸è¦æ€¥äºåŠ¨æ‰‹</p></li><li><p>ä¸è¦ç›¸ä¿¡æµ‹è¯•ï¼Œä¸€å®šè¦åœ¨ä¸Šçº¿ä¹‹å‰ç”¨å„ç§è®¾å¤‡ï¼Œå„ç§å¤§å°çš„å±å¹•ï¼Œå„ç§æµè§ˆå™¨ï¼Œæµ‹è¯•ä¸€éæ‰€æœ‰ç›¸å…³çš„åŠŸèƒ½ï¼Œæ‰€æœ‰å¯èƒ½å‡ºç°çš„æƒ…å†µ</p></li><li><p>ä¸€ä¸ªåŠŸèƒ½ä¸€ä¸ªåˆ†æ”¯ï¼Œæ—¶åˆ»ä¿æŒä¸çº¿ä¸ŠåŒæ­¥</p></li><li><p>å¤šç ”ç©¶ç ”ç©¶å„ç§åº”ç”¨ï¼Œç«™åœ¨ç”¨æˆ·çš„è§’åº¦å»æµ‹è¯•è€Œä¸æ˜¯è‡ªå·±çš„è§’åº¦</p></li><li><p>ä¸æ˜ç™½çš„ï¼Œå®¹æ˜“è®°æ··çš„çŸ¥è¯†ç‚¹è¦è‡ªå·±å½’çº³æ€»ç»“ï¼Œå¤šåŠ¨æ‰‹ï¼Œä¸è¦ä»Šå¤©çœ‹å‡ ç¯‡æ–‡ç« æ˜å¤©åˆå¿˜äº†</p></li><li><p>æ™šä¸Šè¦ç¡å¥½ï¼Œé¿å…ç¬¬äºŒå¤©æ‰“çŒç¡</p></li></ul><h2 id="å†™ç»™2020å¹´çš„è‡ªå·±"><a href="#å†™ç»™2020å¹´çš„è‡ªå·±" class="headerlink" title="å†™ç»™2020å¹´çš„è‡ªå·±"></a>å†™ç»™2020å¹´çš„è‡ªå·±</h2><p>   å¤šåŠ¨æ‰‹å†™ä»£ç ï¼Œå¤šç‚¹å·¥ä½œä¹‹å¤–çš„è¾“å‡ºï¼Œå·©å›ºjsåŸºç¡€ï¼Œå¸Œæœ›æˆ‘èƒ½åœ¨è¿™æ¡è·¯è¶Šèµ°è¶Šè¿œå§ã€‚ã€‚ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æˆé•¿ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>webpackå¸¸ç”¨é…ç½®é€ŸæŸ¥</title>
      <link href="/ashley271017.github.io/2019/12/08/webpack%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E9%80%9F%E6%9F%A5/"/>
      <url>/ashley271017.github.io/2019/12/08/webpack%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E9%80%9F%E6%9F%A5/</url>
      
        <content type="html"><![CDATA[<h3 id="ç”Ÿäº§ç¯å¢ƒå¸¸ç”¨æ’ä»¶"><a href="#ç”Ÿäº§ç¯å¢ƒå¸¸ç”¨æ’ä»¶" class="headerlink" title="ç”Ÿäº§ç¯å¢ƒå¸¸ç”¨æ’ä»¶"></a>ç”Ÿäº§ç¯å¢ƒå¸¸ç”¨æ’ä»¶</h3><h4 id="imagemin-webpack-plugin-å›¾ç‰‡å‹ç¼©æ’ä»¶"><a href="#imagemin-webpack-plugin-å›¾ç‰‡å‹ç¼©æ’ä»¶" class="headerlink" title="imagemin-webpack-plugin - å›¾ç‰‡å‹ç¼©æ’ä»¶"></a>imagemin-webpack-plugin - å›¾ç‰‡å‹ç¼©æ’ä»¶</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å¼•å…¥æ’ä»¶</span></span><br><span class="line"><span class="keyword">var</span> ImageminPlugin = <span class="built_in">require</span>(<span class="string">'imagemin-webpack-plugin'</span>).default;</span><br><span class="line"></span><br><span class="line"><span class="comment">//é…ç½®</span></span><br><span class="line">plugins: [</span><br><span class="line">    <span class="keyword">new</span> ImageminPlugin(&#123;</span><br><span class="line">      disable: process.env.NODE_ENV !== <span class="string">'production'</span>, <span class="comment">// å¼€å‘æ—¶ä¸å¯ç”¨</span></span><br><span class="line">      pngquant: &#123;<span class="comment">//å›¾ç‰‡è´¨é‡</span></span><br><span class="line">        quality: ...</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h4 id="mini-css-extract-plugin-ä¾æ®æ¯ä¸ªentryç”Ÿæˆå•ä¸ªcssæ–‡ä»¶ï¼ˆå°†cssä»jsä¸­æå–å‡ºæ¥ï¼‰"><a href="#mini-css-extract-plugin-ä¾æ®æ¯ä¸ªentryç”Ÿæˆå•ä¸ªcssæ–‡ä»¶ï¼ˆå°†cssä»jsä¸­æå–å‡ºæ¥ï¼‰" class="headerlink" title="mini-css-extract-plugin - ä¾æ®æ¯ä¸ªentryç”Ÿæˆå•ä¸ªcssæ–‡ä»¶ï¼ˆå°†cssä»jsä¸­æå–å‡ºæ¥ï¼‰"></a>mini-css-extract-plugin - ä¾æ®æ¯ä¸ªentryç”Ÿæˆå•ä¸ªcssæ–‡ä»¶ï¼ˆå°†cssä»jsä¸­æå–å‡ºæ¥ï¼‰</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å°†style-loaderæ¢æˆmini-css-extract..</span></span><br><span class="line"> use: [</span><br><span class="line">        &#123;</span><br><span class="line">          loader: MiniCssExtractPlugin.loader</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">'css-loader'</span></span><br><span class="line">        ...</span><br><span class="line"> ]</span><br><span class="line"> ...</span><br><span class="line"> <span class="keyword">new</span> MiniCssExtractPlugin(&#123;</span><br><span class="line">        filename: <span class="string">'static/css/[name].[contenthash:8].css'</span>,</span><br><span class="line">        chunkFilename: <span class="string">'static/css/[name].[contenthash:8].chunk.css'</span> <span class="comment">// import() dynamically import</span></span><br><span class="line">      &#125;)</span><br></pre></td></tr></table></figure><h4 id="cleanwebpackplugin"><a href="#cleanwebpackplugin" class="headerlink" title="cleanwebpackplugin"></a>cleanwebpackplugin</h4><p>åœ¨webpackä¸­æ‰“åŒ…çš„æ–‡ä»¶é€šå¸¸æ˜¯é€šè¿‡hashç”Ÿæˆçš„ï¼Œå¦‚æœæ–‡ä»¶æ”¹åŠ¨ï¼Œé‚£ä¹ˆæ‰“åŒ…çš„æ–‡ä»¶å°±ä¼šè¶Šæ¥è¶Šå¤š,è¿™ä¸ªæ’ä»¶ç”¨æ¥æ¸…é™¤ä¹‹å‰çš„æ–‡ä»¶</p><h4 id="postcss-loader"><a href="#postcss-loader" class="headerlink" title="postcss-loader"></a>postcss-loader</h4><h5 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h5><p>èƒ½å¤Ÿåƒlessä¸€æ ·çš„è‡ªåŠ¨è¡¥å…¨æµè§ˆå™¨å‰ç¼€ï¼Œéœ€è¦ä¸<code>autoprefixer</code>ä¸€èµ·ä½¿ç”¨,PostCSSçš„ä¸€å¤§ç‰¹ç‚¹æ˜¯ï¼Œå…è®¸ä½¿ç”¨æœ€æ–°çš„CSSç‰¹æ€§ï¼Œåœ¨ä½ çš„CSSé‡Œæä¾›ç»Ÿè®¡æ•°æ®ï¼Œæˆ–è€…æ˜¯å…è®¸ä½ ä½¿ç”¨ Sassï¼ŒLessæˆ–æ˜¯Stylusç­‰CSSé¢„å¤„ç†å™¨ã€‚</p><h5 id="postcssçš„ç”Ÿæ€åœˆæä¾›äº†ä¸Šç™¾ç§æ’ä»¶"><a href="#postcssçš„ç”Ÿæ€åœˆæä¾›äº†ä¸Šç™¾ç§æ’ä»¶" class="headerlink" title="postcssçš„ç”Ÿæ€åœˆæä¾›äº†ä¸Šç™¾ç§æ’ä»¶"></a>postcssçš„ç”Ÿæ€åœˆæä¾›äº†ä¸Šç™¾ç§æ’ä»¶</h5><p>Autoprefixer</p><blockquote><p>æ ¹æ®ç”¨æˆ·çš„ä½¿ç”¨åœºæ™¯æ¥è§£æCSSå’Œæ·»åŠ vendor prefixesï¼ˆå‰æ–‡æ³¨2ï¼‰ã€‚</p></blockquote><p>PostCSS Focus</p><blockquote><p>ä¸€ç§åˆ©ç”¨é”®ç›˜æ“ä½œä¸ºæ¯ä¸ª:hoveræ·»åŠ :focusé€‰æ‹©å™¨çš„PostCSSæ’ä»¶ã€‚</p></blockquote><p>PreCSS</p><blockquote><p>ä¸€ä¸ªå…è®¸ä½ åœ¨ä»£ç ä¸­ä½¿ç”¨ç±»ä¼¼Sassæ ‡è®°çš„æ’ä»¶ã€‚</p></blockquote><p>Stylelint</p><blockquote><p>ä¸€ç§å¼ºå¤§çš„ï¼Œå…ˆè¿›çš„å¯ä»¥ä½¿ä½ åœ¨CSSæ ·å¼ä¸­ä¿æŒä¸€è‡´æ€§ï¼Œé¿å…é”™è¯¯çš„CSS linterå·¥å…·ã€‚</p></blockquote><p>PostCSS CSSnext</p><blockquote><p>ä¸€ç§å¯ä»¥è®©ä½ ä½¿ç”¨CSSæœ€æ–°ç‰¹æ€§çš„æ’ä»¶ã€‚å®ƒé€šè¿‡å°†æœ€æ–°çš„CSSç‰¹æ€§è½¬å˜ä¸ºç°é˜¶æ®µæµè§ˆå™¨æ‰€å…¼å®¹çš„ç‰¹æ€§ï¼Œè¿™æ ·ä½ ä¸ç”¨å†ç­‰å¾…æµè§ˆå™¨å¯¹æŸä¸€ç‰¹å®šæ–°ç‰¹æ€§çš„æ”¯æŒã€‚</p></blockquote><p>â€¦</p><h5 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h5><p>éœ€è¦ç»“åˆ<code>postcss.config.js</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// postcss.config.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="built_in">require</span>(<span class="string">'precss'</span>),</span><br><span class="line">    <span class="built_in">require</span>(<span class="string">'autoprefixer'</span>)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line">  test: <span class="regexp">/\.scss$/</span>,</span><br><span class="line">&#123;</span><br><span class="line">          loader: <span class="built_in">require</span>.resolve(<span class="string">'postcss-loader'</span>),</span><br><span class="line">          options: &#123;</span><br><span class="line">            ident: <span class="string">'postcss'</span>,</span><br><span class="line">            plugins: <span class="function"><span class="params">()</span> =&gt;</span> [</span><br><span class="line">              <span class="built_in">require</span>(<span class="string">'postcss-flexbugs-fixes'</span>),</span><br><span class="line">              <span class="built_in">require</span>(<span class="string">'postcss-preset-env'</span>)(&#123;</span><br><span class="line">                 autoprefixer: &#123;</span><br><span class="line">                  flexbox: <span class="string">'no-2009'</span></span><br><span class="line">                &#125;,</span><br><span class="line">                stage: <span class="number">3</span></span><br><span class="line">              &#125;)</span><br><span class="line">            ]</span><br></pre></td></tr></table></figure><h4 id="terser-webpack-plugin-jså‹ç¼©æ’ä»¶"><a href="#terser-webpack-plugin-jså‹ç¼©æ’ä»¶" class="headerlink" title="terser-webpack-plugin - jså‹ç¼©æ’ä»¶"></a><a href="https://www.npmjs.com/package/terser-webpack-plugin" target="_blank" rel="noopener">terser-webpack-plugin</a> - jså‹ç¼©æ’ä»¶</h4><h5 id="ä½¿ç”¨-1"><a href="#ä½¿ç”¨-1" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">optimization: &#123;</span><br><span class="line">  ...</span><br><span class="line">      minimize: <span class="literal">true</span>,</span><br><span class="line">      minimizer: [</span><br><span class="line">      <span class="keyword">new</span> TerserJSPlugin(&#123;</span><br><span class="line">        terserOptions: &#123;</span><br><span class="line">          output: &#123;</span><br><span class="line">            comments: <span class="literal">false</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        extractComments: <span class="literal">false</span></span><br><span class="line">      &#125;),</span><br><span class="line">      <span class="keyword">new</span> OptimizeCSSAssetsPlugin(&#123;&#125;)</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h4 id="progress-bar-webpack-plugin"><a href="#progress-bar-webpack-plugin" class="headerlink" title="progress-bar-webpack-plugin"></a>progress-bar-webpack-plugin</h4><h5 id="ç®€ä»‹-1"><a href="#ç®€ä»‹-1" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h5><p>æ˜¾ç¤º<code>build</code>è¿›åº¦</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">plugins: [</span><br><span class="line">  <span class="keyword">new</span> ProgressBarPlugin()</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h4 id="optimize-css-assets-webpack-plugin-csså‹ç¼©æ’ä»¶"><a href="#optimize-css-assets-webpack-plugin-csså‹ç¼©æ’ä»¶" class="headerlink" title="optimize-css-assets-webpack-plugin - csså‹ç¼©æ’ä»¶"></a><a href="https://www.npmjs.com/package/optimize-css-assets-webpack-plugin" target="_blank" rel="noopener">optimize-css-assets-webpack-plugin</a> - csså‹ç¼©æ’ä»¶</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">plugins:[</span><br><span class="line">  ...</span><br><span class="line">    <span class="keyword">new</span> OptimizeCssAssetsPlugin(&#123;</span><br><span class="line">      assetNameRegExp: <span class="regexp">/\.optimize\.css$/g</span>,</span><br><span class="line">      cssProcessor: <span class="built_in">require</span>(<span class="string">'cssnano'</span>),</span><br><span class="line">      cssProcessorPluginOptions: &#123;</span><br><span class="line">        preset: [<span class="string">'default'</span>, &#123; <span class="attr">discardComments</span>: &#123; <span class="attr">removeAll</span>: <span class="literal">true</span> &#125; &#125;],</span><br><span class="line">      &#125;,</span><br><span class="line">      canPrint: <span class="literal">true</span></span><br><span class="line">    &#125;)</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h4 id="webpack-bundle-analyzer"><a href="#webpack-bundle-analyzer" class="headerlink" title="webpack-bundle-analyzer"></a><a href="https://www.npmjs.com/package/webpack-bundle-analyzer" target="_blank" rel="noopener">webpack-bundle-analyzer</a></h4><h4 id="ç®€ä»‹-2"><a href="#ç®€ä»‹-2" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>å¯ä»¥çœ‹åˆ°æ‰“åŒ…ä¹‹åå„ä¸ªæ–‡ä»¶çš„å¤§å° ä¹‹åå¯ä»¥åšä¸€äº›ä¼˜åŒ–</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> BundleAnalyzerPlugin = <span class="built_in">require</span>(<span class="string">'webpack-bundle-analyzer'</span>).BundleAnalyzerPlugin;</span><br><span class="line"> </span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> BundleAnalyzerPlugin()</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¼€å‘ç¯å¢ƒå¸¸ç”¨æ’ä»¶"><a href="#å¼€å‘ç¯å¢ƒå¸¸ç”¨æ’ä»¶" class="headerlink" title="å¼€å‘ç¯å¢ƒå¸¸ç”¨æ’ä»¶"></a>å¼€å‘ç¯å¢ƒå¸¸ç”¨æ’ä»¶</h3><h4 id="HotModuleReplacementPlugin"><a href="#HotModuleReplacementPlugin" class="headerlink" title="HotModuleReplacementPlugin"></a>HotModuleReplacementPlugin</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">plugins:</span><br><span class="line">...</span><br><span class="line"><span class="keyword">new</span> webpack.HotModuleReplacementPlugin()</span><br></pre></td></tr></table></figure><h4 id="friendly-errors-webpack-plugin-å‹å¥½çš„webpacké”™è¯¯æç¤º"><a href="#friendly-errors-webpack-plugin-å‹å¥½çš„webpacké”™è¯¯æç¤º" class="headerlink" title="friendly-errors-webpack-plugin - å‹å¥½çš„webpacké”™è¯¯æç¤º"></a><a href="https://www.npmjs.com/package/friendly-errors-webpack-plugin" target="_blank" rel="noopener">friendly-errors-webpack-plugin</a> - å‹å¥½çš„webpacké”™è¯¯æç¤º</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> FriendlyErrorsPlugin(&#123;</span><br><span class="line">  compilationSuccessInfo: &#123;</span><br><span class="line">    messages: [<span class="string">'You application is running here http://localhost:3000'</span>],</span><br><span class="line">    notes: [<span class="string">'Some additionnal notes to be displayed unpon successful compilation'</span>]</span><br><span class="line">  &#125;,</span><br><span class="line">  onErrors: <span class="function"><span class="keyword">function</span> (<span class="params">severity, errors</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// You can listen to errors transformed and prioritized by the plugin</span></span><br><span class="line">    <span class="comment">// severity can be 'error' or 'warning'</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h3 id="åŸºç¡€é…ç½®"><a href="#åŸºç¡€é…ç½®" class="headerlink" title="åŸºç¡€é…ç½®"></a>åŸºç¡€é…ç½®</h3><h4 id="htmlwebpackplugin"><a href="#htmlwebpackplugin" class="headerlink" title="htmlwebpackplugin"></a><a href="https://www.npmjs.com/package/html-webpack-plugin" target="_blank" rel="noopener">htmlwebpackplugin</a></h4><p><a href="https://juejin.im/post/5ce96ad7e51d455a2f2201e1" target="_blank" rel="noopener">https://juejin.im/post/5ce96ad7e51d455a2f2201e1</a></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">    inject: <span class="literal">true</span>,</span><br><span class="line">    excludeAssets: [...], </span><br><span class="line">    chunks: [page.toLowerCase()].concat(</span><br><span class="line">      isEnvProduction ? [<span class="string">'assets'</span>, <span class="string">'vendors'</span>...] : []</span><br><span class="line">    ),</span><br><span class="line">    templateParameters: ...,</span><br><span class="line">    minify: isEnvProduction &amp;&amp; &#123;</span><br><span class="line">      removeComments: <span class="literal">true</span>,</span><br><span class="line">      collapseWhitespace: <span class="literal">true</span>,</span><br><span class="line">      removeRedundantAttributes: <span class="literal">true</span>,</span><br><span class="line">      useShortDoctype: <span class="literal">true</span>,</span><br><span class="line">      removeEmptyAttributes: <span class="literal">true</span>,</span><br><span class="line">      removeStyleLinkTypeAttributes: <span class="literal">true</span>,</span><br><span class="line">      keepClosingSlash: <span class="literal">true</span>,</span><br><span class="line">      minifyJS: <span class="literal">true</span>,</span><br><span class="line">      minifyCSS: <span class="literal">true</span>,</span><br><span class="line">      minifyURLs: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    filename: ...</span><br><span class="line">    template: ...</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h3><ul><li><a href="https://juejin.im/entry/57635cdda341310064c5910a" target="_blank" rel="noopener">å…³äº PostCSS æ™®åŠçš„ä¸€ç‚¹å¾®å°çš„å·¥ä½œ</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> é…ç½® </category>
          
      </categories>
      
      
        <tags>
            
            <tag> webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>webpacké…ç½®å¤šé¡µé¢å›½é™…åŒ–åº”ç”¨</title>
      <link href="/ashley271017.github.io/2019/11/15/%E9%85%8D%E7%BD%AE%E5%A4%9A%E9%A1%B5%E9%9D%A2%E5%9B%BD%E9%99%85%E5%8C%96%E5%BA%94%E7%94%A8/"/>
      <url>/ashley271017.github.io/2019/11/15/%E9%85%8D%E7%BD%AE%E5%A4%9A%E9%A1%B5%E9%9D%A2%E5%9B%BD%E9%99%85%E5%8C%96%E5%BA%94%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h3 id="å¤šå…¥å£é…ç½®"><a href="#å¤šå…¥å£é…ç½®" class="headerlink" title="å¤šå…¥å£é…ç½®"></a>å¤šå…¥å£é…ç½®</h3><p>é€šè¿‡è¯»å–æ–‡ä»¶ç»“æ„æ¥åŠ¨æ€ç”Ÿæˆå…¥å£ã€‚åŠ¡å¿…ä½¿ç”¨å¯¹è±¡å†™æ³•ï¼Œé”®åè¡¨ç¤º <code>chunkName</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: collectEntries()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">collectEntries</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> pagesDir = path.resolve(__dirname, <span class="string">'../src/pages'</span>)</span><br><span class="line">  <span class="keyword">return</span> fs</span><br><span class="line">    .readdirSync(pagesDir)</span><br><span class="line">    .map(<span class="function">(<span class="params">pageName</span>) =&gt;</span> (&#123;</span><br><span class="line">      chunkName: pageName,</span><br><span class="line">      entryFile: path.join(pagesDir, pageName, <span class="string">'index.jsx'</span>)</span><br><span class="line">    &#125;))</span><br><span class="line">    .reduce(</span><br><span class="line">      (entries, item) =&gt; (&#123;</span><br><span class="line">        ...entries,</span><br><span class="line">        [item.chunkName]: item.entryFile</span><br><span class="line">      &#125;),</span><br><span class="line">      &#123;&#125;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¤š-html-æ–‡ä»¶è¾“å‡º"><a href="#å¤š-html-æ–‡ä»¶è¾“å‡º" class="headerlink" title="å¤š html æ–‡ä»¶è¾“å‡º"></a>å¤š html æ–‡ä»¶è¾“å‡º</h3><p>plugins æ·»åŠ å¤šä¸ª <code>HtmlWebpackPlugin</code> å®ä¾‹ï¼Œæ·»åŠ  chunks é…ç½®å°†åªåœ¨é¡µé¢æ³¨å…¥å½“å‰é¡µé¢çš„ä»£ç å—ï¼Œä¸è®¾ç½® chunks ä¼šæ³¨å…¥æ‰€æœ‰é¡µé¢ä»£ç å—</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  plugins: [</span><br><span class="line">    ...collectHtmls()</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">collectHtmls</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> pagesDir = path.resolve(__dirname, <span class="string">'../src/pages'</span>)</span><br><span class="line">  <span class="keyword">const</span> templatesDir = path.resolve(__dirname, <span class="string">'../public/templates'</span>)</span><br><span class="line">  <span class="keyword">const</span> templateOutputsDir = path.resolve(__dirname, <span class="string">'../dist'</span>)</span><br><span class="line">  <span class="keyword">return</span> fs.readdirSync(pagesDir).map(<span class="function">(<span class="params">pageName</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">      inject: <span class="literal">true</span>,</span><br><span class="line">      chunks: [pageName],</span><br><span class="line">      filename: path.join(templateOutputsDir, <span class="string">`<span class="subst">$&#123;pageName&#125;</span>.html`</span>),</span><br><span class="line">      template: path.join(templatesDir, <span class="string">`<span class="subst">$&#123;pageName&#125;</span>.html`</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="devServer-é…ç½®"><a href="#devServer-é…ç½®" class="headerlink" title="devServer é…ç½®"></a>devServer é…ç½®</h3><p>å¤šå›½å®¶ç½‘ç«™åœ°å€ä¸€èˆ¬ä¸º <a href="https://www.xxx.com/locale" target="_blank" rel="noopener">https://www.xxx.com/locale</a>, å‚è€ƒè‹¹æœå®˜ç½‘ (opens new window)å’Œ å¾®è½¯å®˜ç½‘ (opens new window)ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦å¤„ç†ä¸€ä¸‹é‡å®šå‘ï¼Œä¹Ÿå°±æ˜¯ devServer çš„ <code>historyApiFallback</code> é¡¹ï¼Œéœ€æå‰é…ç½®æ”¯æŒçš„å›½å®¶ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  devServer: &#123;</span><br><span class="line">    historyApiFallback: &#123;</span><br><span class="line">      rewrites: collectRewrites()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> avalibleLocales = <span class="string">'(cn|us|ru|id)'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">collectRewrites</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> fs</span><br><span class="line">    .readdirSync(path.resolve(__dirname, <span class="string">'../src/pages'</span>))</span><br><span class="line">    .map(<span class="function">(<span class="params">page</span>) =&gt;</span> (&#123;</span><br><span class="line">      <span class="keyword">from</span>: <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">`^/<span class="subst">$&#123;avalibleLocales&#125;</span>/<span class="subst">$&#123;page&#125;</span>/?$`</span>, <span class="string">'i'</span>),</span><br><span class="line">      to: <span class="string">`/<span class="subst">$&#123;page&#125;</span>.html`</span></span><br><span class="line">    &#125;))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ react-router æ—¶ basename éœ€è¦é…ç½®ä¸ºå½“å‰å›½å®¶</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> App = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Router</span> <span class="attr">basename</span>=<span class="string">&#123;</span>`/$&#123;<span class="attr">locale</span>&#125;`&#125;&gt;</span>&#123;/*...*/&#125;<span class="tag">&lt;/<span class="name">Router</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¤šè¯­è¨€é…ç½®"><a href="#å¤šè¯­è¨€é…ç½®" class="headerlink" title="å¤šè¯­è¨€é…ç½®"></a>å¤šè¯­è¨€é…ç½®</h3><p>ä½¿ç”¨ React-Intlé…ç½®å¤šå›½è¯­è¨€åŒ…ã€‚ä¸ºé˜²æ­¢ bundle ä½“ç§¯è¿‡å¤§ï¼Œè¯­è¨€åŒ…ç”¨ code spliting åˆ†å‰²ã€‚æ³¨æ„è¯­è¨€åŒ…æœªåŠ è½½æ—¶ä¸è¦æ˜¾ç¤ºé¡µé¢å†…å®¹ï¼Œå¦åˆ™é¡µé¢ä¼šæœ‰é—ªçƒã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="built_in">Intl</span> = <span class="function">(<span class="params">&#123; children &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [messages, setMessages] = useState()</span><br><span class="line">  <span class="keyword">const</span> loadLocaleData = useCallback(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">import</span>(<span class="string">`@/languages/<span class="subst">$&#123;locale&#125;</span>.json`</span>).then(setMessages)</span><br><span class="line">  &#125;, [language])</span><br><span class="line">  useEffect(loadLocaleData, [])</span><br><span class="line">  <span class="keyword">return</span> messages ? (</span><br><span class="line">    &lt;IntlProvider messages=&#123;messages&#125; locale=&#123;locale&#125;&gt;</span><br><span class="line">      &#123;children&#125;</span><br><span class="line">    &lt;<span class="regexp">/IntlProvider&gt;</span></span><br><span class="line"><span class="regexp">  ) : null</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å‰ç«¯æ€§èƒ½ä¼˜åŒ–</title>
      <link href="/ashley271017.github.io/2019/11/07/%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"/>
      <url>/ashley271017.github.io/2019/11/07/%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<h3 id="å‰ç«¯æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ"><a href="#å‰ç«¯æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ" class="headerlink" title="å‰ç«¯æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ"></a><a href="https://csspod.com/frontend-performance-best-practices/" target="_blank" rel="noopener">å‰ç«¯æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ</a></h3><h3 id="é’ˆå¯¹-spa-çš„æ€§èƒ½ä¼˜åŒ–"><a href="#é’ˆå¯¹-spa-çš„æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="é’ˆå¯¹ spa çš„æ€§èƒ½ä¼˜åŒ–"></a>é’ˆå¯¹ spa çš„æ€§èƒ½ä¼˜åŒ–</h3><ul><li>ä¼˜åŒ–é¦–å±æ¸²æŸ“</li></ul><p>å°†æ‰€æœ‰ç”¨äºé¦–å±æ¸²æŸ“çš„ css æ–‡ä»¶æ•´åˆæˆä¸€ä¸ªå†…åµŒåˆ° head æ ‡ç­¾ï¼Œç”±äº http æ•°æ®åŒ…çš„é™åˆ¶ï¼Œæ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡ 14kb<br>http/2 èƒ½è®© css æ–‡ä»¶ä½¿ç”¨å•ä¸ªæ–‡ä»¶å­˜å‚¨ï¼Œé€šè¿‡æœåŠ¡å™¨æ¨é€ css æ–‡ä»¶çš„ä¼ è¾“æ–¹å¼å‡å°‘ html æ–‡ä»¶æ•°æ®é‡</p><ul><li><p>éª¨æ¶å±</p></li><li><p>é¢„åŠ è½½</p></li><li><p>å¼‚æ­¥è·¯ç”±</p><blockquote><p>è·¯ç”±æ‹†åˆ†,å‡å°‘åˆå§‹åŠ è½½ä½“ç§¯: åˆ©ç”¨å¼‚æ­¥åŠ è½½æ–¹å¼ï¼Œ<strong>ä»…åœ¨éœ€è¦è¿›å…¥å¯¹åº”è·¯ç”±æ—¶ï¼Œå¯¹åº”ç»„ä»¶æ‰ä¼šè¢«åŠ è½½è¿›æ¥</strong>ã€‚</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">route(&#123;</span><br><span class="line">  Home: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'@/coms/home'</span>),</span><br><span class="line">  About: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'@/coms/about'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p>æœåŠ¡ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰</p><blockquote><p>ç®€å•çš„æ¥è®²ï¼Œå°±æ˜¯æµè§ˆå™¨å‘é€è¯·æ±‚åˆ°æœåŠ¡å™¨ç«¯ï¼ŒæœåŠ¡å™¨ç«¯å¤„ç†è¯·æ±‚ï¼Œå¡«å……æ•°æ®ï¼Œç”Ÿæˆ html è¿”å›ç»™æµè§ˆå™¨ ,æœåŠ¡ç«¯å¿…é¡»æ˜¯ node.js æˆ–è€…ä¸“é—¨è·‘ä¸ª node.js æ¥æ”¯æŒ<br>ä¼˜åŠ¿ï¼šæ›´å¥½çš„ SEOï¼› é¦–å±æ€§èƒ½å¥½ï¼Œä¸éœ€è¦å…ˆä¸‹è½½ä¸€å † js å’Œ css åæ‰èƒ½çœ‹åˆ°é¡µé¢<br>åŠ£åŠ¿ï¼šä¸èƒ½å®ç°éƒ¨åˆ†æ›´æ–°ã€‚å³ä½¿åªæœ‰ä¸€éƒ¨åˆ†å˜åŠ¨ï¼Œä¹Ÿéœ€è¦åç«¯é‡æ–°è¿”å›æ•´ä¸ªé¡µé¢ç»™æµè§ˆå™¨ã€‚</p></blockquote></li></ul><h3 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h3><h4 id="é‡ç»˜-å›æµçš„æ¦‚å¿µ"><a href="#é‡ç»˜-å›æµçš„æ¦‚å¿µ" class="headerlink" title="é‡ç»˜ å›æµçš„æ¦‚å¿µ"></a>é‡ç»˜ å›æµçš„æ¦‚å¿µ</h4><ul><li>repaintï¼Œå°±æ˜¯æµè§ˆå™¨å¾—çŸ¥å…ƒç´ äº§ç”Ÿäº†ä¸å½±å“æ’ç‰ˆçš„æƒ…å†µä¸‹åå¯¹è¿™ä¸ªå…ƒç´ è¿›è¡Œé‡æ–°ç»˜åˆ¶çš„è¿‡ç¨‹ã€‚ä¾‹å¦‚æˆ‘ä»¬æ”¹å˜äº†å…ƒç´ çš„é¢œè‰²ï¼ŒåŠ ä¸ªä¸‹åˆ’çº¿ç­‰ã€‚</li><li>reflow, æµè§ˆå™¨å¾—çŸ¥å…ƒç´ äº§ç”Ÿäº†å¯¹æ–‡æ¡£æ ‘æ’ç‰ˆæœ‰å½±å“çš„æ ·å¼å˜åŒ–ï¼Œå¯¹æ‰€æœ‰å—å½±å“çš„domèŠ‚ç‚¹è¿›è¡Œé‡æ–°æ’ç‰ˆå·¥ä½œ<h4 id="å‡å°‘å›æµ"><a href="#å‡å°‘å›æµ" class="headerlink" title="* å‡å°‘å›æµ"></a>* å‡å°‘å›æµ</h4></li></ul><p>å›æµçš„å‘ç”Ÿï¼š<br>1ã€DOM æ ‘çš„ç»“æ„å˜åŒ–ï¼Œå¦‚æ·»åŠ æˆ–åˆ é™¤å…ƒç´ ã€‚ï¼ˆå½“æ–°å¢å¤šä¸ªå…ƒç´ çš„æ—¶å€™ä½¿ç”¨æ–‡æ¡£ç¢ç‰‡ï¼‰åŒ…æ‹¬è®¾ç½® display:none è®¾ç½® visibility åªä¼šè§¦å‘é‡ç»˜<br>2ã€å…ƒç´ çš„å‡ ä½•å±æ€§çš„æ”¹å˜ï¼ˆå¦‚ marginã€paddingã€widthã€heightã€border ç­‰ï¼‰ã€‚<br>3ã€é¡µé¢åˆå§‹åŒ–æ¸²æŸ“ã€‚<br>4ã€è·å–æŸäº›å±æ€§ï¼Œæµè§ˆå™¨ä¸ºå–å¾—å‡†ç¡®çš„å€¼ä¹Ÿä¼šè§¦å‘å›æµï¼ˆoffsetTopã€clientTopã€scrollTopã€getComputedSyle()ç­‰ç­‰ï¼‰ã€‚<br>5ã€æµè§ˆå™¨çª—å£å°ºå¯¸çš„æ”¹å˜</p><p>ä¸ºä»€ä¹ˆè·å–æŸäº›å±æ€§ä¼šè§¦å‘å›æµï¼Ÿ<br>ç”±äºæ¯æ¬¡é‡æ’éƒ½ä¼šé€ æˆé¢å¤–çš„è®¡ç®—æ¶ˆè€—ï¼Œå› æ­¤å¤§å¤šæ•°æµè§ˆå™¨éƒ½ä¼šé€šè¿‡é˜Ÿåˆ—åŒ–ä¿®æ”¹å¹¶æ‰¹é‡æ‰§è¡Œæ¥ä¼˜åŒ–é‡æ’è¿‡ç¨‹ã€‚æµè§ˆå™¨ä¼šå°†ä¿®æ”¹æ“ä½œæ”¾å…¥åˆ°é˜Ÿåˆ—é‡Œï¼Œç›´åˆ°è¿‡äº†ä¸€æ®µæ—¶é—´æˆ–è€…æ“ä½œè¾¾åˆ°äº†ä¸€ä¸ªé˜ˆå€¼ï¼Œæ‰æ¸…ç©ºé˜Ÿåˆ—ã€‚ä½†æ˜¯ï¼å½“ä½ è·å–å¸ƒå±€ä¿¡æ¯çš„æ“ä½œçš„æ—¶å€™ï¼Œä¼šå¼ºåˆ¶é˜Ÿåˆ—åˆ·æ–°ï¼Œæ¯”å¦‚å½“ä½ è®¿é—®ä»¥ä¸‹å±æ€§æˆ–è€…ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ï¼š</p><ul><li>offsetTopã€offsetLeftã€offsetWidthã€offsetHeight</li><li>scrollTopã€scrollLeftã€scrollWidthã€scrollHeight</li><li>clientTopã€clientLeftã€clientWidthã€clientHeight</li><li>getComputedStyle()</li><li>getBoundingClientRect</li></ul><p>ä»¥ä¸Šå±æ€§å’Œæ–¹æ³•éƒ½éœ€è¦è¿”å›æœ€æ–°çš„å¸ƒå±€ä¿¡æ¯ï¼Œå› æ­¤æµè§ˆå™¨ä¸å¾—ä¸æ¸…ç©ºé˜Ÿåˆ—ï¼Œè§¦å‘å›æµé‡ç»˜æ¥è¿”å›æ­£ç¡®çš„å€¼ã€‚</p><h4 id="æ€ä¹ˆé¿å…"><a href="#æ€ä¹ˆé¿å…" class="headerlink" title="æ€ä¹ˆé¿å…"></a>æ€ä¹ˆé¿å…</h4><ul><li>å¯¹äºå¤æ‚çš„åŠ¨ç”»æ•ˆæœï¼Œè®©å…¶ç»å¯¹å®šä½</li><li>é¿å…å¤šæ¬¡è®¿é—®ä¸Šè¿°çš„å±æ€§</li><li>ä½¿ç”¨ç±»å</li><li>ä½¿ç”¨ csstext</li><li>å½“æ·»åŠ æ’å…¥å¤§é‡çš„å…ƒç´ çš„æ—¶å€™ ä½¿ç”¨æ–‡æ¡£ç¢ç‰‡æˆ–è€…æ˜¯åœ¨çˆ¶å…ƒç´ åœ¨è¢«æ’å…¥ä¹‹å‰è®¾ç½®<code>display:none</code>è®©å…¶è„±ç¦»æ–‡æ¡£æµ ä¹‹åå†å¸¦å›æ–‡æ¡£æµ</li><li>ç¡¬ä»¶åŠ é€Ÿï¼Œä½¿ç”¨ css3 ç¡¬ä»¶åŠ é€Ÿï¼Œå¯ä»¥è®© transformã€opacityã€filters è¿™äº›åŠ¨ç”»ä¸ä¼šå¼•èµ·å›æµé‡ç»˜ ã€‚ä½†æ˜¯å¯¹äºåŠ¨ç”»çš„å…¶å®ƒå±æ€§ï¼Œæ¯”å¦‚ background-color è¿™äº›ï¼Œè¿˜æ˜¯ä¼šå¼•èµ·å›æµé‡ç»˜çš„ï¼Œä¸è¿‡å®ƒè¿˜æ˜¯å¯ä»¥æå‡è¿™äº›åŠ¨ç”»çš„æ€§èƒ½</li></ul><blockquote><p>å¸¸è§çš„è§¦å‘ç¡¬ä»¶åŠ é€Ÿçš„ css å±æ€§ï¼štransform,opacity,filters,Will-change</p></blockquote><h3 id="ä½¿ç”¨æ§åˆ¶å°çš„performanceç›‘æµ‹é¡µé¢çš„æ€§èƒ½ï¼ˆåŸæ¥çš„-timelineï¼‰"><a href="#ä½¿ç”¨æ§åˆ¶å°çš„performanceç›‘æµ‹é¡µé¢çš„æ€§èƒ½ï¼ˆåŸæ¥çš„-timelineï¼‰" class="headerlink" title="ä½¿ç”¨æ§åˆ¶å°çš„performanceç›‘æµ‹é¡µé¢çš„æ€§èƒ½ï¼ˆåŸæ¥çš„ timelineï¼‰"></a>ä½¿ç”¨æ§åˆ¶å°çš„<a href="https://zhuanlan.zhihu.com/p/29879682" target="_blank" rel="noopener">performance</a>ç›‘æµ‹é¡µé¢çš„æ€§èƒ½ï¼ˆåŸæ¥çš„ timelineï¼‰</h3><p>ä½¿ç”¨æŒ‡å—ï¼š<a href="https://www.cnblogs.com/xiaohuochai/p/9182710.html" target="_blank" rel="noopener">https://www.cnblogs.com/xiaohuochai/p/9182710.html</a></p><h4 id="å…¶ä»–-1"><a href="#å…¶ä»–-1" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h4><ul><li>å¤æ‚çš„è®¡ç®—ä½¿ç”¨web workers</li><li>äº‹ä»¶å§”æ‰˜</li><li>æ­£åˆ™è¡¨è¾¾å¼ä¸è¦è¿‡äºå¤æ‚</li></ul><h3 id="ä½¿ç”¨-webpack-ä¼˜åŒ–"><a href="#ä½¿ç”¨-webpack-ä¼˜åŒ–" class="headerlink" title="ä½¿ç”¨ webpack ä¼˜åŒ–"></a>ä½¿ç”¨ webpack ä¼˜åŒ–</h3><ul><li>ä¼˜åŒ–å›¾ç‰‡ - ä½¿ç”¨<code>url-loader</code> è®¾ç½®<code>limit</code> å¤§çš„å›¾è½¬æˆ<code>base64</code></li><li>ä½¿ç”¨å„ç§æ’ä»¶å‹ç¼©ä»£ç </li><li><a href="https://webpack.docschina.org/guides/tree-shaking/" target="_blank" rel="noopener">tree-shaking</a><br>æ˜¯ä»€ä¹ˆï¼Ÿ<br>ç”¨äºæè¿°ç§»é™¤ JavaScript ä¸Šä¸‹æ–‡ä¸­çš„æœªå¼•ç”¨ä»£ç <br>æ€ä¹ˆåšï¼Ÿ<blockquote><p>ä½¿ç”¨ ES2015 æ¨¡å—è¯­æ³•ï¼ˆå³ import å’Œ exportï¼‰ã€‚<br>ç¡®ä¿æ²¡æœ‰ compiler å°† ES2015 æ¨¡å—è¯­æ³•è½¬æ¢ä¸º CommonJS æ¨¡å—ï¼ˆè¿™ä¹Ÿæ˜¯æµè¡Œçš„ Babel preset ä¸­ @babel/preset-env çš„é»˜è®¤è¡Œä¸º \</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é…ç½® Babel è®©å…¶ä¿ç•™ ES6 æ¨¡å—åŒ–è¯­å¥ </span></span><br><span class="line"><span class="comment">// babelrc</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"presets"</span>: [</span><br><span class="line">    [</span><br><span class="line">      <span class="string">"env"</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"modules"</span>: <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><blockquote><p>åœ¨é¡¹ç›® package.json æ–‡ä»¶ä¸­ï¼Œæ·»åŠ ä¸€ä¸ª â€œsideEffectsâ€ å±æ€§ã€‚æ¯”å¦‚polyfillç­‰ åªè¦å¼•å…¥ å°±ä¼šäº§ç”Ÿå‰¯ä½œç”¨ å½“è¯¥å±æ€§è®¾ç½®ä¸ºfalseçš„æ—¶å€™ä¼šåˆ é™¤æ‰€æœ‰æœªå¼•ç”¨çš„æ–‡ä»¶ æ‰€ä»¥polyfilléœ€è¦å£°æ˜sideeffects,true æ˜¯é»˜è®¤å€¼ï¼Œå¦‚æœä¸æŒ‡å®šå…¶ä»–å€¼çš„è¯ã€‚è¿™æ„å‘³ç€æ‰€æœ‰çš„æ–‡ä»¶éƒ½æœ‰å‰¯ä½œç”¨ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰ä¸€ä¸ªæ–‡ä»¶å¯ä»¥ tree-shakingã€‚</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// æ‰€æœ‰æ–‡ä»¶éƒ½æœ‰å‰¯ä½œç”¨ï¼Œå…¨éƒ½ä¸å¯ tree-shaking</span><br><span class="line">&#123;</span><br><span class="line"> <span class="attr">"sideEffects"</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line">// æ²¡æœ‰æ–‡ä»¶æœ‰å‰¯ä½œç”¨ï¼Œå…¨éƒ½å¯ä»¥ tree-shaking</span><br><span class="line">&#123;</span><br><span class="line"> <span class="attr">"sideEffects"</span>: <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line">// åªæœ‰è¿™äº›æ–‡ä»¶æœ‰å‰¯ä½œç”¨ï¼Œæ‰€æœ‰å…¶ä»–æ–‡ä»¶éƒ½å¯ä»¥ tree-shakingï¼Œä½†ä¼šä¿ç•™è¿™äº›æ–‡ä»¶</span><br><span class="line">&#123;</span><br><span class="line"> <span class="attr">"sideEffects"</span>: [</span><br><span class="line">  <span class="string">"./src/file1.js"</span>,</span><br><span class="line">  <span class="string">"./src/file2.js"</span></span><br><span class="line"> ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>é€šè¿‡å°† mode é€‰é¡¹è®¾ç½®ä¸º productionï¼Œå¯ç”¨ minification(ä»£ç å‹ç¼©) å’Œ tree shakingã€‚<br>å¼€å¯ optimization.usedExports,ç¼–è¯‘æ—¶å¯ä»¥åˆ†æå‡ºè§£æ„å†™æ³•å¼•å…¥çš„esmæ¨¡å—ï¼Œå“ªäº›exportç”¨åˆ°äº†ï¼Œå“ªäº›æ¨¡å—æ²¡æœ‰ç”¨åˆ°ã€‚ç„¶åå°±éœ€è¦åˆ†åˆ«è¿›è¡Œæ ‡è®°,æ ‡è®°å¦‚ä¸‹ å¹¶ä½¿ç”¨å‹ç¼©æ’ä»¶å‹ç¼©ä»£ç  webpack4 modeä¸ºproductionæ—¶å€™é»˜è®¤å°±æœ‰è¿™ä¸¤ä¸ªè®¾ç½®</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* harmony export (immutable) */</span> __webpack_exports__[<span class="string">"xxx"</span>] = xxxx;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* unused harmony export xxx */</span> æ ‡è®°ä¸ºè¿™ä¸ªå°±æ˜¯éœ€è¦åˆ æ‰çš„</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šè¿°æ–¹å¼å£°æ˜sideeffectsä¼šå‡ºç°çš„é—®é¢˜ï¼šä»¥<code>import &#39;xxx.css</code>ç›´æ¥å¯¼å…¥åˆ° JavaScript æ–‡ä»¶ä¸­çš„æ ·å¼è¡¨éƒ½å°†ä»è¾“å‡ºä¸­åˆ é™¤<br>è§£å†³åŠæ³•æ˜¯ï¼šwebpackçš„é…ç½®æ–‡ä»¶ä¸­</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line"> rules: [</span><br><span class="line">  &#123;</span><br><span class="line">   test: <span class="regexp">/...css.../</span>,</span><br><span class="line">   use: [loaders],</span><br><span class="line">   sideEffects: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line"> ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å¼•å…¥çš„æ—¶å€™ä½¿ç”¨è§£æ„èµ‹å€¼</p></blockquote><ul><li>ä¸ç”¨çš„ä¾èµ–åŠæ—¶åˆ é™¤</li><li>external æŠŠæˆ‘ä»¬çš„ä¾èµ–ç”³æ˜ä¸ºä¸€ä¸ªå¤–éƒ¨ä¾èµ–ï¼Œå¤–éƒ¨ä¾èµ–é€šè¿‡ &lt; script&gt; å¤–é“¾è„šæœ¬å¼•å…¥ã€‚</li><li>optimization é…ç½®ç»†èŠ‚<br><a href="https://imweb.io/topic/5b66dd601402769b60847149" target="_blank" rel="noopener">https://imweb.io/topic/5b66dd601402769b60847149</a></li><li>alias å’Œ noParse<br>å½“éœ€è¦å°†è¿™ä¸ªå¤–éƒ¨ä¾èµ–æ‰“åŒ…è¿›å…¥åˆ°ä½ çš„ bundle çš„æ—¶å€™</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">webpackConfig</span>) </span>&#123;</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">+ webpackConfig.resolve.alias = &#123;</span><br><span class="line">+   <span class="string">'react'</span>: <span class="string">'react/dist/react.min'</span></span><br><span class="line">+ &#125;</span><br><span class="line">+ webpackConfig.module.noParse.push(</span><br><span class="line">+  <span class="regexp">/react.min/</span></span><br><span class="line">+ )</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> webpackConfig;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="å…¶ä»–-ä¼˜åŒ–SEO"><a href="#å…¶ä»–-ä¼˜åŒ–SEO" class="headerlink" title="å…¶ä»– - ä¼˜åŒ–SEO"></a>å…¶ä»– - ä¼˜åŒ–SEO</h4><p>é‡è¦çš„å†…å®¹æ”¾åœ¨é¦–é¡µ å› ä¸ºçˆ¬è™«ä¼šå…ˆä»é¦–é¡µå¼€å§‹çˆ¬<br>æäº¤sitemap<br>åŠ å¿«é¡µé¢åŠ è½½é€Ÿåº¦ æå‡æœç´¢å¼•æ“æ’å<br>â€¦</p><h3 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h3><ul><li><a href="https://zhuanlan.zhihu.com/p/52076790" target="_blank" rel="noopener">ä½ çœŸçš„äº†è§£å›æµå’Œé‡ç»˜å—</a></li><li><a href="https://juejin.im/entry/585232e21b69e6006c7e33fb" target="_blank" rel="noopener">Webpack æ„å»ºæ€§èƒ½ä¼˜åŒ–æ¢ç´¢</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> æ€§èƒ½ä¼˜åŒ– </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>cssä¸­å®½é«˜çš„æ–°å€¼å¤ä¹ </title>
      <link href="/ashley271017.github.io/2019/10/17/css%E4%B8%AD%E5%AE%BD%E9%AB%98%E7%9A%84%E6%96%B0%E5%80%BC%E5%A4%8D%E4%B9%A0/"/>
      <url>/ashley271017.github.io/2019/10/17/css%E4%B8%AD%E5%AE%BD%E9%AB%98%E7%9A%84%E6%96%B0%E5%80%BC%E5%A4%8D%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<ul><li><p>fill-available<br>ã€€å‡ºç°fill-availableå…³é”®å­—å€¼çš„ä»·å€¼åœ¨äºï¼Œå¯ä»¥è®©å…ƒç´ çš„100%è‡ªåŠ¨å¡«å……ç‰¹æ€§ä¸ä»…ä»…åœ¨blockæ°´å¹³å…ƒç´ ä¸Šï¼Œä¹Ÿå¯ä»¥åº”ç”¨åœ¨å…¶ä»–å…ƒç´ <br>åˆ©ç”¨å®ƒå®ç°ç­‰é«˜å¸ƒå±€</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css"><span class="selector-class">.inner</span>&#123;</span></span><br><span class="line"><span class="css">  <span class="selector-tag">width</span><span class="selector-pseudo">:100px</span>;</span></span><br><span class="line"><span class="css">  <span class="selector-tag">height</span><span class="selector-pseudo">:-webkit-fill-available</span>;</span></span><br><span class="line"><span class="css">  <span class="selector-tag">margin</span><span class="selector-pseudo">:0</span> 10<span class="selector-tag">px</span>;</span></span><br><span class="line">  display: inline-block;</span><br><span class="line">  vertical-align: middle;</span><br><span class="line">  background-color: pink;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"height: 100px;"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"inner"</span>&gt;</span>HTML<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"inner"</span>&gt;</span>CSS<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"inner"</span>&gt;</span>JS<span class="tag">&lt;<span class="name">br</span>&gt;</span>jQyery<span class="tag">&lt;<span class="name">br</span>&gt;</span>Vue<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>max-content<br>fit-content uses max-content, unless available &lt; max-content, then it uses available. Unless available &lt; min-content, then it uses min-content.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css"><span class="selector-class">.outer</span>&#123;</span></span><br><span class="line"><span class="css">  <span class="selector-tag">width</span><span class="selector-pseudo">:-webkit-max-content</span>;</span></span><br><span class="line"><span class="css">  <span class="selector-tag">border</span><span class="selector-pseudo">:1px</span> <span class="selector-tag">solid</span> <span class="selector-tag">black</span>;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"outer"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"height:10px;width:100px;background:lightgreen"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"background-color: pink;"</span>&gt;</span>æµ‹è¯•æµ‹è¯•æµ‹è¯•æµ‹è¯•æµ‹è¯•æµ‹ hi æ˜¯æµ‹è¯•æµ‹è¯•æµ‹è¯•æµ‹ä½ æµ‹è¯•æµ‹è¯•æµ‹è¯•æµ‹è¯•<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="æ¯æ—¥å°çŸ¥è¯†ç‚¹"><a href="#æ¯æ—¥å°çŸ¥è¯†ç‚¹" class="headerlink" title="æ¯æ—¥å°çŸ¥è¯†ç‚¹"></a>æ¯æ—¥å°çŸ¥è¯†ç‚¹</h3><ul><li>å…³äºä¸‹è½½çš„æ–‡ä»¶çš„åç¼€<br>ä½ åœ¨ç½‘ä¸Šä¸‹è½½ä¸€ä¸ªå¾ˆå¤§çš„æ–‡ä»¶ï¼Œä¸‹è½½è¿‡ç¨‹ä¸­ä½ æ€ä¹ˆçŸ¥é“è‡ªå·±ä¸‹è½½çš„å¯¹ä¸å¯¹å‘¢ï¼Ÿæ‰€ä»¥MD5 å°±æ˜¯ä¸ºäº†è¿™ç§æƒ…æ™¯è€Œç”Ÿçš„ã€‚å³ç½‘ä¸Šçš„æ–‡ä»¶é™¤äº†æœ‰èµ„æºæœ¬èº«å¤–ï¼Œè¿˜ä¼šæœ‰ä¸€ä¸ªMD5å€¼ï¼Œç„¶åä½ ä¸‹è½½åˆ°æœ¬åœ°åçš„æ–‡ä»¶ä¹Ÿå¯ä»¥ç®—å‡ºä¸€ä¸ªMD5 å€¼ï¼Œç„¶åäºŒè€…å¯¹æ¯”ï¼Œå¦‚æœå®Œå…¨ç›¸åŒåˆ™è¯´æ˜ä¸‹çš„æ–‡ä»¶æ˜¯æ­£ç¡®çš„ã€‚</li></ul><h3 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h3><ul><li><a href="https://www.jianshu.com/p/9ed3e8759ce3" target="_blank" rel="noopener">æµè§ˆå™¨ç¼“å­˜æ§åˆ¶è¯¦è§£ï¼ˆcookieã€sessionã€localStorageã€Cache-Controlç­‰</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> css </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ§åˆ¶reactçš„stateä¸ºåˆæ³•çŠ¶æ€</title>
      <link href="/ashley271017.github.io/2019/10/14/%E6%8E%A7%E5%88%B6react%E7%9A%84state%E4%B8%BA%E5%90%88%E6%B3%95%E7%8A%B6%E6%80%81/"/>
      <url>/ashley271017.github.io/2019/10/14/%E6%8E%A7%E5%88%B6react%E7%9A%84state%E4%B8%BA%E5%90%88%E6%B3%95%E7%8A%B6%E6%80%81/</url>
      
        <content type="html"><![CDATA[<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> zipList = <span class="function"><span class="params">initialArray</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [initialActive, ...restOfTabs] = initialArray</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> zip = &#123;</span><br><span class="line">    previous: [],</span><br><span class="line">    current: initialActive,</span><br><span class="line">    next: restOfTabs,</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> setActive = <span class="function"><span class="params">zip</span> =&gt;</span> <span class="function"><span class="params">newActive</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> fill this in</span></span><br><span class="line">    <span class="keyword">const</span> newZip = zip</span><br><span class="line">    <span class="keyword">return</span> apiForZip(newZip)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> apiForZip = <span class="function"><span class="params">zip</span> =&gt;</span> (&#123;</span><br><span class="line">    asArray: <span class="function"><span class="params">()</span> =&gt;</span> [...zip.previous, zip.current, ...zip.next],</span><br><span class="line">    isActive: <span class="function"><span class="params">tab</span> =&gt;</span> zip.current === tab,</span><br><span class="line">    setActive: setActive(zip),</span><br><span class="line">    activeTab: <span class="function"><span class="params">()</span> =&gt;</span> zip.current,</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> apiForZip(zip)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> [tabs, setTabs] = React.useState(</span><br><span class="line">  zipList([</span><br><span class="line">    &#123; <span class="attr">title</span>: <span class="string">'Tab One'</span>, <span class="attr">content</span>: <span class="string">'This is tab one'</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">title</span>: <span class="string">'Tab Two'</span>, <span class="attr">content</span>: <span class="string">'This is tab two'</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">title</span>: <span class="string">'Tab Three'</span>, <span class="attr">content</span>: <span class="string">'This is tab three'</span> &#125;,</span><br><span class="line">  ])</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h2 id="æ¯æ—¥å°çŸ¥è¯†ç‚¹"><a href="#æ¯æ—¥å°çŸ¥è¯†ç‚¹" class="headerlink" title="æ¯æ—¥å°çŸ¥è¯†ç‚¹"></a>æ¯æ—¥å°çŸ¥è¯†ç‚¹</h2><ul><li><p>å­—ä½“çš„æ—‹è½¬<br>å°†å­—ä½“è®¾ç½®æˆ<code>display:block</code>å³å¯</p></li><li><p>run buildæ–‡ä»¶å¤¹ï¼ˆä¸ºäº†æ›´æ¥è¿‘çº¿ä¸Šçš„æ•ˆæœï¼‰<br>ä½¿ç”¨<code>http-server</code>å·¥å…· æ‰§è¡Œå‘½ä»¤: ï¼ˆåŸç†æ˜¯puputeeræŠ“å–buildä¸‹çš„èµ„æº ç„¶åã€‚ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http-server build/ project name</span><br></pre></td></tr></table></figure></li><li><p>å°½é‡ä¸è¦ä½¿ç”¨<code>push</code>è·³è½¬è·¯ç”± å› ä¸ºè¿™ç§åŠ¨æ€çš„æ–¹å¼ä¸åˆ©äº<code>ssr</code></p></li><li><p><code>git config -list</code> æŸ¥çœ‹å½“å‰é¡¹ç›®çš„gité…ç½®</p></li><li><p>è¯·æ±‚è¢«é‡å®šå‘ ï¼ˆnetworkå‡ºç°â€¦htmlâ€¦å¾ˆé•¿çš„è·¯å¾„ å¹¶è¢«canceledï¼‰ å¯èƒ½æ˜¯åç«¯æ­£åœ¨éƒ¨ç½²åˆ°æ–°çš„æœåŠ¡å™¨</p></li></ul><h2 id="æ¯æ—¥bugè®°å½•"><a href="#æ¯æ—¥bugè®°å½•" class="headerlink" title="æ¯æ—¥bugè®°å½•"></a>æ¯æ—¥bugè®°å½•</h2><ul><li><p>è¯·æ±‚è¿”å›500 å‘ç°æ˜¯ä¼ çš„å‚æ•°çš„æ ¼å¼ä¸å¯¹ åº”è¯¥æ˜¯<code>form</code>è¡¨å•çš„å½¢å¼ è€Œä¸æ˜¯<code>application/json</code>æ ¼å¼ è™½ç„¶APIæ–‡æ¡£ä¸­æ²¡æœ‰æ ‡å‡º ä½†æ˜¯ä¹Ÿè¦æ³¨æ„</p></li><li><p>å‘ç°é‡æ–°è¿›å…¥é¡µé¢åŠ è½½æ•°æ®çš„æ—¶å€™æ²¡æœ‰å‡ºç°<code>loading</code> æ˜¯å› ä¸ºæ•°æ®å­˜å‚¨åœ¨mobxä¸­ æ²¡æœ‰åˆ·æ–°è¢«æ¸…é™¤ æ‰€ä»¥è¦åœ¨æ¯æ¬¡è¯·æ±‚ä¹‹å‰æ¸…é™¤ä¸€æ¬¡æˆ–è€…æ˜¯ä¸èµ°mobxæµç¨‹</p></li><li><p>çˆ¶å±‚å ä¸Šä¸‹æ–‡ä¸­çš„å­å±‚å ä¸Šä¸‹æ–‡ </p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="selector-tag">position</span><span class="selector-pseudo">:relative</span> <span class="comment">/* çˆ¶ */</span></span><br><span class="line">...</span><br><span class="line"><span class="selector-tag">position</span><span class="selector-pseudo">:absolute</span></span><br><span class="line"><span class="selector-tag">z-index</span><span class="selector-pseudo">:2</span>  <span class="comment">/*å­*/</span></span><br><span class="line">...</span><br><span class="line"><span class="selector-tag">position</span><span class="selector-pseudo">:absolute</span></span><br><span class="line"><span class="selector-tag">z-index</span><span class="selector-pseudo">:1</span> <span class="comment">/* å”å” */</span></span><br></pre></td></tr></table></figure></li></ul><p>æœ€åè¿˜æ˜¯å”å”æ˜¾ç¤ºåœ¨å­èŠ‚ç‚¹çš„ä¸Šé¢ å› ä¸ºå­å±‚å ä¸Šä¸‹æ–‡å±äºçˆ¶å±‚å ä¸Šä¸‹æ–‡</p><ul><li><p><code>table</code> è®¾ç½®flexå¸ƒå±€ tdå…ƒç´ ä¸ä¼šè‡ªåŠ¨å¡«å……æ»¡tbody</p></li><li><p>node <code>exec</code>ä¸æ‰§è¡Œå›è°ƒå‡½æ•°</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> exec = <span class="built_in">require</span>(<span class="string">'child_process'</span>).exec;</span><br><span class="line">exec(<span class="string">"&#123;COMMAND&#125; &gt; results.log"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">error, stdout, stderr</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'callback called!'</span>); <span class="comment">// this never gets called.</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li></ul><p>æ˜¯å› ä¸ºé‡å®šå‘åˆ°äº†å¦ä¸€ä¸ªæ–‡ä»¶</p><p>*</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>sassä¸­çš„mapå’Œlist</title>
      <link href="/ashley271017.github.io/2019/10/11/sass%E4%B8%AD%E7%9A%84map/"/>
      <url>/ashley271017.github.io/2019/10/11/sass%E4%B8%AD%E7%9A%84map/</url>
      
        <content type="html"><![CDATA[<h2 id="map"><a href="#map" class="headerlink" title="map"></a>map</h2><h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>ç±»ä¼¼äº js ä¸­çš„ map æ•°æ®ç»“æ„</p><h3 id="ä¸»è¦å‡½æ•°"><a href="#ä¸»è¦å‡½æ•°" class="headerlink" title="ä¸»è¦å‡½æ•°"></a>ä¸»è¦å‡½æ•°</h3><table><thead><tr><th>å‡½æ•°</th><th>åŠŸèƒ½</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td>map-keys(map)</td><td>è¿”å› map é‡Œé¢æ‰€æœ‰çš„ key(list)</td><td>map-keys((â€œfooâ€: 1, â€œbarâ€: 2)) =&gt; â€œfooâ€, â€œbarâ€</td></tr><tr><td>map-values(map)</td><td>è¿”å› map é‡Œé¢æ‰€æœ‰çš„ value(list)</td><td>map-values((â€œfooâ€: 1, â€œbarâ€: 2)) =&gt; 1, 2</td></tr><tr><td>map-get(map,key)</td><td>è¿”å› map é‡Œé¢æŒ‡å®šå¯ä»¥çš„ value</td><td>map-get((â€œfooâ€: 1, â€œbarâ€: 2), â€œfooâ€) =&gt; 1</td></tr><tr><td>map-has-key(map,key)</td><td>è¿”å› map é‡Œé¢æ˜¯å¦å«æœ‰æŒ‡å®šçš„ key</td><td>map-has-key((â€œfooâ€: 1, â€œbarâ€: 2), â€œfooâ€) =&gt; true</td></tr><tr><td>map-merge(map1,map2)</td><td>åˆå¹¶ map(map)</td><td>map-merge((â€œfooâ€: 1), (â€œbarâ€: 2)) =&gt; (â€œfooâ€: 1, â€œbarâ€: 2)</td></tr><tr><td>map-remove(map,keys)</td><td>åˆ é™¤æŒ‡å®š map ä¸­çš„æŒ‡å®š key(map)</td><td>map-remove((â€œfooâ€: 1, â€œbarâ€: 2), â€œbarâ€) =&gt; (â€œfooâ€: 1)</td></tr><tr><td>keywords(args)</td><td>è¿”å›ä¸€ä¸ªå‡½æ•°å‚æ•°ç»„æˆçš„ map(map)</td><td>@mixin foo(argsâ€¦){@debug keywords($args); //=&gt; (arg1: val, arg2: val)}</td></tr></tbody></table><h2 id="list"><a href="#list" class="headerlink" title="list"></a>list</h2><h3 id="ç®€ä»‹-1"><a href="#ç®€ä»‹-1" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>ç±»ä¼¼jsä¸­çš„æ•°ç»„</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$list: ( </span><br><span class="line">        ("<span class="selector-tag">item-1</span><span class="selector-class">.1</span>", "<span class="selector-tag">item-1</span><span class="selector-class">.2</span>", "<span class="selector-tag">item-1</span><span class="selector-class">.3</span>"), </span><br><span class="line">        ("<span class="selector-tag">item-2</span><span class="selector-class">.1</span>", "<span class="selector-tag">item-2</span><span class="selector-class">.2</span>", "<span class="selector-tag">item-2</span><span class="selector-class">.3</span>"),</span><br><span class="line">        ("<span class="selector-tag">item-3</span><span class="selector-class">.1</span>", "<span class="selector-tag">item-3</span><span class="selector-class">.2</span>", "<span class="selector-tag">item-3</span><span class="selector-class">.3</span>")</span><br><span class="line">       );</span><br></pre></td></tr></table></figure><h2 id="æ–¹æ³•"><a href="#æ–¹æ³•" class="headerlink" title="æ–¹æ³•"></a>æ–¹æ³•</h2><ul><li><p>length æ£€æµ‹å…¶é•¿åº¦ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">length($a) =&gt; 1</span><br></pre></td></tr></table></figure></li><li><p>nth è·å–ç¬¬né¡¹ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nth($a,1) =&gt; test</span><br></pre></td></tr></table></figure></li><li><p>index($list,$value)ï¼šè¿”å›$valueåœ¨$listä¸­çš„ä½ç½®</p></li><li><p>append($list,$value[,$separator])ï¼šä½¿ç”¨$separatoråˆ†éš”ç¬¦å°†$valueåˆ—è¡¨é¡¹æ·»åŠ åˆ°$listæœ€åï¼ˆå¦‚æœæ²¡æœ‰æ˜¾å¼æŒ‡å®š $separatoråˆ†éš”ç¬¦ï¼Œä¼šä»¥å½“å‰åˆ†éš”ç¬¦åˆ†éš”ï¼‰</p></li><li><p>join($list-1,$list-2[,$separator]):ä½¿ç”¨$separatoråˆ†éš”ç¬¦å°†$list-2é™„åŠ åˆ°$list-1ï¼ˆå¦‚æœæ²¡æœ‰æ˜¾å¼æŒ‡å®šåˆ†éš”ç¬¦ï¼Œå°†å¯¹* $list-1ä¸­çš„åˆ†éš”ç¬¦ï¼‰</p></li><li><p>zip($lists):å°†å¤šä¸ª$listç»„åˆåœ¨ä¸€èµ·æˆä¸ºä¸€ä¸ªå¤šç»´åˆ—è¡¨ã€‚å¦‚æœåˆ—è¡¨æºé•¿åº¦å¹¶ä¸æ˜¯æ‰€æœ‰éƒ½ç›¸åŒï¼Œç»“æœåˆ—è¡¨é•¿åº¦å°†ä»¥æœ€çŸ­çš„ä¸€ä¸ªä¸ºå‡†</p></li><li><p>reject($list,$value)ï¼šè¿™æ˜¯Compassä¸­çš„ä¸€ä¸ªå‡½æ•°ï¼Œå°†$valueå€¼ä»$listä¸­åˆ é™¤</p></li><li><p>compact(*$args)ï¼šCompasså‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªåˆ é™¤éçœŸå€¼çš„æ–°åˆ—è¡¨</p></li></ul><h3 id="liståº”ç”¨"><a href="#liståº”ç”¨" class="headerlink" title="liståº”ç”¨"></a>liståº”ç”¨</h3><ul><li>æ‰©å±•é€‰æ‹©å™¨ å¦‚:<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.home .nav-home,</span><br><span class="line">.about .nav-about,</span><br><span class="line">.products .nav-products,</span><br><span class="line">.contact .nav-contact</span><br></pre></td></tr></table></figure></li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$pages: home,about,products,contact;</span><br><span class="line">$selector:();</span><br><span class="line">@<span class="keyword">each</span> $item in $pages &#123;</span><br><span class="line">    //æˆ‘ä»¬åˆ›å»º$selector</span><br><span class="line">&#125;</span><br><span class="line">#&#123;$selector&#125;&#123;</span><br><span class="line">    //æ ·å¼å†™åœ¨è¿™é‡Œ</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>è‡ªå®šä¹‰å‡½æ•°<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//å®šä¹‰first()å‡½æ•°ï¼Œè·å–åˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªåˆ—è¡¨é¡¹</span><br><span class="line">@<span class="keyword">function</span> first($list)&#123;</span><br><span class="line">    @<span class="keyword">return</span> nth($list,<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//å®šä¹‰last()å‡½æ•°ï¼Œè·å–åˆ—è¡¨ä¸­çš„æœ€åä¸€ä¸ªåˆ—è¡¨é¡¹</span><br><span class="line">@<span class="keyword">function</span> last($list)&#123;</span><br><span class="line">    @<span class="keyword">return</span> nth($list,length($list));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id="æ¯æ—¥å°çŸ¥è¯†ç‚¹"><a href="#æ¯æ—¥å°çŸ¥è¯†ç‚¹" class="headerlink" title="æ¯æ—¥å°çŸ¥è¯†ç‚¹"></a>æ¯æ—¥å°çŸ¥è¯†ç‚¹</h2><ul><li>unquote ç”¨æ¥å»é™¤å­—ç¬¦ä¸²ä¸­çš„å¼•å·</li><li>quote ç»™å­—ç¬¦ä¸²å¢åŠ å¼•å·</li><li>ä¼ é€’å†…å®¹å—åˆ° mixin: <code>@content</code></li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">mixin</span> apply-to-ie6-only &#123;</span><br><span class="line">  * <span class="selector-tag">html</span> &#123;</span><br><span class="line">    @content;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">@<span class="keyword">include</span> apply-to-ie6-only &#123;</span><br><span class="line">  <span class="selector-id">#logo</span> &#123;</span><br><span class="line">    <span class="attribute">background-image</span>: <span class="built_in">url</span>(/logo.gif);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>target ä¼ªç±»å¯ä»¥åœ¨ä¸æ–°å¢ç±»åçš„æ—¶å€™ç›´æ¥å®ç°æ ‡ç­¾é¡µçš„æ•ˆæœ<br>åŸç†ï¼š ä¹Ÿå°±æ˜¯ç»™ä¸€ä¸ªå…ƒç´  A è®¾å®š idï¼Œå¦ä¸€ä¸ªå…ƒç´  B æŒ‡å®šè·³è½¬åˆ°è¿™ä¸ª idï¼Œç„¶åå°±å‘ a:hover é‚£æ ·ï¼Œåœ¨ css ä¸­è®¾å®š â€œå…ƒç´ ï¼štargetâ€å¹¶æ”¹å˜æ ·å¼ï¼Œé‚£ä¹ˆç‚¹å‡» B å…ƒç´ ï¼Œå°±ä¼šæ ¹æ®ä½ çš„è®¾å®šæ”¹å˜ A çš„æ ·å¼ã€‚</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"swiper-box"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"swiper-cont"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"swiper1"</span> <span class="attr">id</span>=<span class="string">"swiper1"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"swiper2"</span> <span class="attr">id</span>=<span class="string">"swiper2"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"swiper3"</span> <span class="attr">id</span>=<span class="string">"swiper3"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"swiper-num"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#swiper1"</span>&gt;</span>1<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#swiper2"</span>&gt;</span>2<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#swiper3"</span>&gt;</span>3<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>focus:within ä¼ªç±» åº”ç”¨äºå½“å­å…ƒç´ ä¸­å‡ºç°è·å¾—ç„¦ç‚¹çš„å…ƒç´ æ—¶å€™</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">div</span><span class="selector-pseudo">:focus</span><span class="selector-pseudo">:within</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>css ä¼ªç±»ä¸ä¼ªå…ƒç´ <br>css ä¼ªç±»<br>css ä¼ªç±»ç”¨äºå‘æŸäº›é€‰æ‹©å™¨æ·»åŠ ç‰¹æ®Šçš„æ•ˆæœã€‚<br>:link, :visited, :hover, :focus, :active, :first-child, :lang<br>css3 æ–°å¢çš„ä¼ªç±»ï¼š<br>:last-child, :only-child, :first-of-type, :last-of-type, :only-of-type, :nth-child(n), :nth-last-child(n), :nth-of-type(n), :nth-last-of-type(n), :root, :empty, :target, :enabled, :disabled, :checked, :not(selector),</li></ul><p>css ä¼ªå…ƒç´ <br>css ä¼ªå…ƒç´ ç”¨äºå‘æŸäº›é€‰æ‹©å™¨è®¾ç½®ç‰¹æ®Šæ•ˆæœã€‚<br>::first-letter, ::first-line, ::before, ::after<br>css3 æ–°å¢çš„ä¼ªå…ƒç´ <br>::selection</p><ul><li>é€šè¿‡ <code>first-letter text-transform: uppercase text-transform: lowercase</code>æ§åˆ¶å¤§å°å†™</li></ul><h2 id="æ¯æ—¥-bug-è®°å½•"><a href="#æ¯æ—¥-bug-è®°å½•" class="headerlink" title="æ¯æ—¥ bug è®°å½•"></a>æ¯æ—¥ bug è®°å½•</h2><ul><li><p>max-height è®¾ç½® transition çš„æ—¶å€™ä¸ç”Ÿæ•ˆ æ˜¯å› ä¸º max-height è®¾ç½®äº†ä¸€ä¸ªå¾ˆå¤§çš„èŒƒå›´ æ¯”å¦‚ä» 0 åˆ° 1000 è€Œå®é™…çš„å†…å®¹é«˜åº¦åªæœ‰ 100 é‚£ä¹ˆå‰©ä¸‹çš„æ—¶é—´å¤§éƒ½æ˜¯åœ¨æ»šåŠ¨è¿™ 900</p></li><li><p>ä½¿ç”¨ js è®¾ç½®å…ƒç´ çš„è¡Œå†…æ ·å¼å¯ä»¥åº”ç”¨æ ·å¼è¡¨ä¸­çš„ transition</p></li><li><p>git å†²çªçš„ç†è§£<br>åªæœ‰å½“åŒæ—¶ä¿®æ”¹äº†æŸä¸ªæ–‡ä»¶çš„æ—¶å€™æ‰ä¼šå‡ºç°å†²çª è¦æ˜¯æœ¬åœ°çš„çŠ¶æ€æ˜¯ nothing commit git pull çš„æ—¶å€™ä¼šç›´æ¥è¦†ç›–æ‰æœ¬åœ°çš„æ–‡ä»¶</p></li><li><p>git merge çš„ç†è§£<br>ä»çˆ¶åˆ†æ”¯åˆ‡å‡ºå­åˆ†æ”¯ å­åˆ†æ”¯ pull çˆ¶åˆ†æ”¯ å­åˆ†æ”¯ä¸Šçš„ä»£ç ä¼šä¸çˆ¶åˆ†æ”¯ä¿æŒä¸€è‡´ ä½†æ˜¯çˆ¶åˆ†æ”¯ merge å­åˆ†æ”¯ çˆ¶åˆ†æ”¯çš„å†…å®¹ä¸ä¸€å®šè¦ä¸å­åˆ†æ”¯ä¿æŒä¸€è‡´</p></li><li><p>åœ¨ä¸€ä¸ªhooksé‡Œé¢ç»´æŠ¤ä¸€ä»½state ç„¶ååœ¨å¦ä¸€ä¸ªç»„ä»¶ä¸­setState ä¸€ä¸ªç»„ä»¶ä¸­è·å–state ä¸¤ä¸ªç»„ä»¶çš„stateå¹¶ä¸ä¼šåŒæ­¥</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> sass </category>
          
      </categories>
      
      
        <tags>
            
            <tag> sass css </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>tså°çŸ¥è¯†ç‚¹</title>
      <link href="/ashley271017.github.io/2019/10/11/ts%E5%B0%8F%E7%9F%A5%E8%AF%86%E7%82%B9/"/>
      <url>/ashley271017.github.io/2019/10/11/ts%E5%B0%8F%E7%9F%A5%E8%AF%86%E7%82%B9/</url>
      
        <content type="html"><![CDATA[<ul><li>ç”¨ <code>keyof</code> æ¥çº¦å®šæ–¹æ³•çš„å‚æ•°</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> type keys = &#123;</span><br><span class="line">    name: string;</span><br><span class="line">    appId: number;</span><br><span class="line">    config: object;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å‚æ•°å’Œå€¼çº¦æŸèŒƒå›´</span></span><br><span class="line">    <span class="keyword">set</span>&lt;T extends keyof keys&gt;(key: T, val: keys[T])</span><br><span class="line">    <span class="keyword">get</span>&lt;T extends keyof keys&gt;(key: T): keys[T]</span><br><span class="line">&#125;</span><br><span class="line">----</span><br></pre></td></tr></table></figure><h2 id="interface-vs-type"><a href="#interface-vs-type" class="headerlink" title="interface vs type"></a>interface vs type</h2><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ in æ¥çº¦æŸå±æ€§åå¿…é¡»ä¸ºä¸‰å®¶è¿è¥å•†ä¹‹ä¸€ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">type ChinaMobilePhones = <span class="string">'10086'</span> | <span class="string">'10010'</span> | <span class="string">'10000'</span></span><br><span class="line"></span><br><span class="line">interface ChinaMobile &#123;</span><br><span class="line">    name: string;</span><br><span class="line">    website: string;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åªèƒ½ type ä½¿ç”¨ï¼Œ interface æ— æ³•ä½¿ç”¨</span></span><br><span class="line">type ChinaMobileList = &#123;</span><br><span class="line">    <span class="comment">// éå†å±æ€§</span></span><br><span class="line">    [phone <span class="keyword">in</span> ChinaMobilePhones]: ChinaMobile</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç±»å‹å®šä¹‰æ–‡ä»¶"><a href="#ç±»å‹å®šä¹‰æ–‡ä»¶" class="headerlink" title="ç±»å‹å®šä¹‰æ–‡ä»¶"></a>ç±»å‹å®šä¹‰æ–‡ä»¶</h2><p>åœ¨ TypeScript ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆç®€å•çš„ï¼Œåœ¨ä»£ç ç¼–å†™ä¸­å®šä¹‰ç±»å‹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">interface IBaseModel &#123;</span><br><span class="line">    say(keys: string[] | <span class="literal">null</span>): object</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="title">implements</span> <span class="title">IBaseModel</span> </span>&#123;</span><br><span class="line">    name: string</span><br></pre></td></tr></table></figure><p><code>ä½†æ˜¯ä¸»æµçš„åº“éƒ½æ˜¯ JavaScript ç¼–å†™çš„ï¼ŒTypeScript èº«ä¸º JavaScript çš„è¶…é›†ï¼Œè‡ªç„¶éœ€è¦è€ƒè™‘åˆ°å¦‚ä½•è®© JS åº“ä¹Ÿèƒ½å®šä¹‰é™æ€ç±»å‹</code>ã€‚</p><p>TypeScript ç»è¿‡äº†ä¸€ç³»åˆ—çš„æ‘¸ç´¢ï¼Œå…ˆåæå‡ºäº† tsd(å·²åºŸå¼ƒ)ã€typings(å·²åºŸå¼ƒ)ï¼Œæœ€ç»ˆåœ¨ TypeScript 2.0 çš„æ—¶å€™é‡æ–°æ•´ç†äº†ç±»å‹å®šä¹‰ï¼Œæå‡ºäº† DefinitelyTypedã€‚</p><p>DefinitelyTyped å°±æ˜¯è®©ä½ æŠŠ â€œç±»å‹å®šä¹‰æ–‡ä»¶(*.d.ts)â€ï¼Œå‘å¸ƒåˆ° npm ä¸­ï¼Œé…åˆç¼–è¾‘å™¨(æˆ–æ’ä»¶)ï¼Œå°±èƒ½å¤Ÿæ£€æµ‹åˆ° JS åº“ä¸­çš„é™æ€ç±»å‹ã€‚</p><p>ç±»å‹å®šä¹‰æ–‡ä»¶çš„ä»¥ .d.ts ç»“å°¾ï¼Œé‡Œé¢ä¸»è¦ç”¨æ¥å®šä¹‰ç±»å‹ã€‚<br>æ¯”å¦‚ï¼š</p><blockquote><p>å› ä¸ºè¿™å‡ ä¸ªåº“æ˜¯ js çš„ï¼Œæ²¡æœ‰ ts çš„ç±»å‹å£°æ˜<br>ä¹Ÿæ²¡æœ‰å¥½çš„@types/å¯¹åº”çš„åº“</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">declare <span class="built_in">module</span> <span class="string">'classnames'</span>;</span><br><span class="line">declare <span class="built_in">module</span> <span class="string">'htmr'</span>;</span><br><span class="line">declare <span class="built_in">module</span> <span class="string">'showdown-katex'</span>;</span><br></pre></td></tr></table></figure><blockquote><p>å†…ç½®ç±»å‹å®šä¹‰å°±æ˜¯æŠŠä½ çš„ç±»å‹å®šä¹‰æ–‡ä»¶å’Œ npm åŒ…ä¸€èµ·å‘å¸ƒ</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pageage.json</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"name"</span>: <span class="string">"demo"</span>,</span><br><span class="line">    <span class="string">"author"</span>: <span class="string">"demo project"</span>,</span><br><span class="line">    <span class="string">"version"</span>: <span class="string">"1.0.0"</span>,</span><br><span class="line">    <span class="string">"main"</span>: <span class="string">"./lib/main.js"</span>,</span><br><span class="line">    <span class="comment">// å®šä¹‰ä¸»ç±»å‹å®šä¹‰æ–‡ä»¶</span></span><br><span class="line">    <span class="string">"types"</span>: <span class="string">"./lib/main.d.ts"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å®šä¹‰æ•°ç»„çš„ç±»å‹ä¸ºç¬¬ä¸€é¡¹æ˜¯å‡½æ•° å…¶ä½™çš„æ˜¯å¯¹è±¡</li></ul><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Arglist &#123;</span><br><span class="line">  [index: <span class="built_in">number</span>]: object</span><br><span class="line">  <span class="number">0</span>: <span class="built_in">Function</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> a1: Arglist = [func]</span><br><span class="line"><span class="keyword">const</span> a2: Arglist = [<span class="number">22</span>] <span class="comment">// fails</span></span><br><span class="line"><span class="keyword">const</span> a3: Arglist = [func, <span class="string">'foo'</span>]</span><br><span class="line"><span class="comment">// æ–¹å¼äºŒ</span></span><br><span class="line"><span class="keyword">type</span> FAs = [<span class="built_in">Function</span>, &#123;&#125;]</span><br></pre></td></tr></table></figure><ul><li>ç»§æ‰¿çš„æ—¶å€™æ’é™¤çˆ¶æ¥å£ä¸­çš„ä¸€éƒ¨åˆ†å±æ€§</li></ul><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> Omit&lt;T, K <span class="keyword">extends</span> keyof T&gt; = Pick&lt;T, Exclude&lt;keyof T, K&gt;&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> ICollapseProps <span class="keyword">extends</span> Omit&lt;React.HTMLAttributes&lt;HTMLUListElement&gt;,"title"&gt;</span><br></pre></td></tr></table></figure><ul><li><code>react.cloneElement</code>çš„æ­£ç¡®ç”¨æ³•</li></ul><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cloneElement(children  <span class="keyword">as</span> React.ReactElement&lt;<span class="built_in">any</span>&gt;, &#123;</span><br><span class="line">                ref,</span><br><span class="line">                <span class="keyword">type</span>: hasError ? <span class="string">'error'</span> : <span class="string">'default'</span>,</span><br></pre></td></tr></table></figure><ul><li><code>index signature</code> ç´¢å¼•ç­¾å<br>é€‚ç”¨äºæ— æ³•ç¡®å®šå±æ€§åç§°çš„åœºæ™¯<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> NetCache &#123;</span><br><span class="line">    [propName: <span class="built_in">string</span>]: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><ul><li><p><code>useImmperativeHandle</code> ç»“åˆ éœ€è¦å®šä¹‰é™æ€å±æ€§çš„ç»„ä»¶ ç»„ä»¶çš„å®šä¹‰åº”è¯¥å¦‚ä¸‹</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> IMessage <span class="keyword">extends</span> React.ForwardRefExoticComponent&lt;</span><br><span class="line">IMessageProps &amp; React.RefAttributes&lt;HTMLDivElement | refType&gt;</span><br><span class="line">&gt; &#123;</span><br><span class="line"><span class="comment">// ä½¿ç”¨</span></span><br><span class="line"> <span class="keyword">const</span> ref = createRef&lt;refType &amp; HTMLDivElement&gt;()</span><br><span class="line"> &lt;Message ref=&#123;ref&#125;/&gt;</span><br></pre></td></tr></table></figure></li><li><p>Using a forwardRef component with children in TypeScript</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> ButtonProps = React.HTMLProps&lt;HTMLButtonElement&gt; or React.ComponentPropsWithoutRef&lt;<span class="string">'button'</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> FancyButton = React.forwardRef&lt;HTMLButtonElement, ButtonProps&gt;<span class="function">(<span class="params">(<span class="params">props, ref</span>) =&gt; (<span class="params"></span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">  &lt;button <span class="keyword">type</span>="button" ref=&#123;ref&#125; className="FancyButton"&gt;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">    &#123;props.children&#125;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">  &lt;/button&gt;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params"></span>)</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">// <span class="params">You</span> <span class="params">can</span> <span class="params">now</span> <span class="params">get</span> <span class="params">a</span> <span class="params">ref</span> <span class="params">directly</span> <span class="params">to</span> <span class="params">the</span> <span class="params">DOM</span> <span class="params">button</span>:</span></span><br><span class="line"><span class="function"><span class="params">const</span> <span class="params">ref</span> = <span class="params">React</span>.<span class="params">createRef</span>&lt;<span class="params">HTMLButtonElement</span>&gt;<span class="params">()</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">&lt;<span class="params">FancyButton</span> <span class="params">ref</span>=&#123;<span class="params">ref</span>&#125;&gt;<span class="params">Click</span> <span class="params">me</span>!&lt;/<span class="params">FancyButton</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>å½“æŠ¥é”™çš„æ—¶å€™ä¸€å®šè¦ä»”ç»†çœ‹é”™è¯¯ ç„¶åå¤šè¯•ä¸€è¯•</p>]]></content>
      
      
      <categories>
          
          <category> ts </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ts </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2019æ˜¥æ‹›å›é¡¾</title>
      <link href="/ashley271017.github.io/2019/08/14/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%9B%9E%E9%A1%BE%E6%98%A5%E6%8B%9B/"/>
      <url>/ashley271017.github.io/2019/08/14/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%9B%9E%E9%A1%BE%E6%98%A5%E6%8B%9B/</url>
      
        <content type="html"><![CDATA[<h3 id="ä½¿ç”¨-Linux-å‘½ä»¤æ¨¡æ‹Ÿå‘èµ·ä¸€ä¸ªè¯·æ±‚"><a href="#ä½¿ç”¨-Linux-å‘½ä»¤æ¨¡æ‹Ÿå‘èµ·ä¸€ä¸ªè¯·æ±‚" class="headerlink" title="ä½¿ç”¨ Linux å‘½ä»¤æ¨¡æ‹Ÿå‘èµ·ä¸€ä¸ªè¯·æ±‚"></a>ä½¿ç”¨ Linux å‘½ä»¤æ¨¡æ‹Ÿå‘èµ·ä¸€ä¸ªè¯·æ±‚</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">ä¸€ã€<span class="keyword">get</span>è¯·æ±‚ï¼š</span><br><span class="line"></span><br><span class="line">ã€€ã€€1ã€ä½¿ç”¨curlå‘½ä»¤ï¼š</span><br><span class="line">// åœ¨ç»ˆç«¯æ•²ä¸‹è¯¥å‘½ä»¤ä¹‹åå›è½¦ä¼šå‡ºç°å“åº”å†…å®¹</span><br><span class="line"></span><br><span class="line">ã€€ã€€curl â€œhttp://www.baidu.comâ€ å¦‚æœè¿™é‡Œçš„URLæŒ‡å‘çš„æ˜¯ä¸€ä¸ªæ–‡ä»¶æˆ–è€…ä¸€å¹…å›¾éƒ½å¯ä»¥ç›´æ¥ä¸‹è½½åˆ°æœ¬åœ°</span><br><span class="line"></span><br><span class="line">ã€€ã€€curl -i â€œhttp://www.baidu.comâ€ æ˜¾ç¤ºå…¨éƒ¨ä¿¡æ¯</span><br><span class="line"></span><br><span class="line">ã€€ã€€curl -l â€œhttp://www.baidu.comâ€ åªæ˜¾ç¤ºå¤´éƒ¨ä¿¡æ¯</span><br><span class="line"></span><br><span class="line">ã€€ã€€curl -v â€œhttp://www.baidu.comâ€ æ˜¾ç¤º<span class="keyword">get</span>è¯·æ±‚å…¨è¿‡ç¨‹è§£æ</span><br><span class="line"></span><br><span class="line">ã€€ã€€2ã€ä½¿ç”¨wgetå‘½ä»¤ï¼š</span><br><span class="line"></span><br><span class="line">ã€€ã€€wget â€œhttp://www.baidu.comâ€ä¹Ÿå¯ä»¥</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">äºŒã€postè¯·æ±‚</span><br><span class="line"></span><br><span class="line">ã€€ã€€1ã€ä½¿ç”¨curlå‘½ä»¤ï¼ˆé€šè¿‡-då‚æ•°ï¼ŒæŠŠè®¿é—®å‚æ•°æ”¾åœ¨é‡Œé¢ï¼‰ï¼š</span><br><span class="line"></span><br><span class="line">ã€€ã€€curl -d â€œparam1=value1Â¶m2=value2â€ â€œhttp://www.baidu.comâ€</span><br><span class="line"></span><br><span class="line">ã€€ã€€2ã€ä½¿ç”¨wgetå‘½ä»¤ï¼šï¼ˆ--post-dataå‚æ•°æ¥å®ç°ï¼‰</span><br><span class="line"></span><br><span class="line">ã€€ã€€wget --post-data â€˜user=foo&amp;password=barâ€™ http://www.baidu.com</span><br><span class="line"></span><br><span class="line">ã€€ã€€ä»¥ä¸Šå°±æ˜¯Linuxæ¨¡æ‹ŸHttpçš„<span class="keyword">get</span>æˆ–postè¯·æ±‚çš„æ–¹æ³•äº†ï¼Œè¿™æ ·ä¸€æ¥Linuxç³»ç»Ÿä¹Ÿèƒ½å‘è¿œç¨‹æœåŠ¡å™¨å‘é€æ¶ˆæ¯äº†ã€‚</span><br><span class="line"></span><br><span class="line">## é˜²æŠ–èŠ‚æµ</span><br><span class="line"># Throttle and debounce</span><br><span class="line"></span><br><span class="line">## Throttle ï¼ˆå‡½æ•°èŠ‚æµï¼‰</span><br><span class="line"></span><br><span class="line">### Throttle å®šä¹‰</span><br><span class="line"></span><br><span class="line">å°±æ˜¯æŒ‡è¿ç»­è§¦å‘äº‹ä»¶ååœ¨ n ç§’å†…å‡½æ•°åªèƒ½æ‰§è¡Œä¸€æ¬¡</span><br><span class="line"></span><br><span class="line">å¦‚æœå°†æ°´é¾™å¤´æ‹§ç´§ç›´åˆ°æ°´æ˜¯ä»¥æ°´æ»´çš„å½¢å¼æµå‡ºï¼Œé‚£ä½ ä¼šå‘ç°æ¯éš”ä¸€æ®µæ—¶é—´ï¼Œå°±ä¼šæœ‰ä¸€æ»´æ°´æµå‡ºã€‚</span><br><span class="line"></span><br><span class="line">ä¹Ÿå°±æ˜¯ä¼šè¯´é¢„å…ˆè®¾å®šä¸€ä¸ªæ‰§è¡Œå‘¨æœŸï¼Œå½“è°ƒç”¨åŠ¨ä½œçš„æ—¶åˆ»å¤§äºç­‰äºæ‰§è¡Œå‘¨æœŸåˆ™æ‰§è¡Œè¯¥åŠ¨ä½œï¼Œç„¶åè¿›å…¥ä¸‹ä¸€ä¸ªæ–°å‘¨æœŸ</span><br><span class="line"></span><br><span class="line">```js</span><br><span class="line">/**</span><br><span class="line"> * é¢‘ç‡æ§åˆ¶ è¿”å›å‡½æ•°è¿ç»­è°ƒç”¨æ—¶ï¼Œaction æ‰§è¡Œé¢‘ç‡é™å®šä¸º æ¬¡ / delay</span><br><span class="line"> * @param delay  &#123;number&#125;    å»¶è¿Ÿæ—¶é—´ï¼Œå•ä½æ¯«ç§’</span><br><span class="line"> * @param action &#123;<span class="function"><span class="keyword">function</span>&#125;  è¯·æ±‚å…³è”å‡½æ•°ï¼Œå®é™…åº”ç”¨éœ€è¦è°ƒç”¨çš„å‡½æ•°</span></span><br><span class="line"><span class="function"> * @<span class="title">return</span> </span>&#123;<span class="function"><span class="keyword">function</span>&#125;    è¿”å›å®¢æˆ·è°ƒç”¨å‡½æ•°</span></span><br><span class="line"><span class="function"> */</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">var</span> <span class="title">throttle</span> = <span class="title">function</span>(<span class="params">delay, action</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> last = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> curr = +<span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">    <span class="keyword">if</span> (curr - last &gt; delay) &#123;</span><br><span class="line">      action.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">      last = curr;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ç‰ˆæœ¬äºŒï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">throttle</span>(<span class="params">fun, delay</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> last, deferTimer;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">args</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> that = <span class="keyword">this</span>;</span><br><span class="line">    <span class="keyword">let</span> _args = <span class="built_in">arguments</span>;</span><br><span class="line">    <span class="keyword">let</span> now = +<span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">    <span class="keyword">if</span> (last &amp;&amp; now &lt; last + delay) &#123;</span><br><span class="line">      clearTimeout(deferTimer);</span><br><span class="line">      <span class="comment">// ä¿è¯ä¸€å®šä¼šæ‰§è¡Œä¸€æ¬¡ è¿™å°±æ˜¯è·Ÿé˜²æŠ–ä¸ä¸€æ ·çš„åœ°æ–¹</span></span><br><span class="line">      deferTimer = setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        last = now;</span><br><span class="line">        fun.apply(that, _args);</span><br><span class="line">      &#125;, delay);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// ç¬¬ä¸€æ¬¡æˆ–è€…å½“æ—¶é—´é—´éš”è¾¾åˆ°è¦æ±‚çš„æ—¶å€™ä¼šæ‰§è¡Œå‡½æ•°</span></span><br><span class="line">      last = now;</span><br><span class="line">      fun.apply(that, _args);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¯”å¦‚æœç´¢æ¡† å½“ç”¨æˆ·è¾“å…¥é¢‘ç¹çš„æ—¶å€™</p><h2 id="Debounce-å‡½æ•°å»æŠ–"><a href="#Debounce-å‡½æ•°å»æŠ–" class="headerlink" title="Debounce (å‡½æ•°å»æŠ–)"></a>Debounce (å‡½æ•°å»æŠ–)</h2><h3 id="Debounce-å®šä¹‰"><a href="#Debounce-å®šä¹‰" class="headerlink" title="Debounce å®šä¹‰"></a>Debounce å®šä¹‰</h3><p>å°±æ˜¯æŒ‡è§¦å‘äº‹ä»¶ååœ¨ n ç§’å†…å‡½æ•°åªèƒ½æ‰§è¡Œä¸€æ¬¡ï¼ˆæœ€åä¸€æ¬¡ï¼‰ï¼Œå¦‚æœåœ¨ n ç§’å†…åˆè§¦å‘äº†äº‹ä»¶ï¼Œåˆ™ä¼šé‡æ–°è®¡ç®—å‡½æ•°æ‰§è¡Œæ—¶é—´ã€‚</p><p>å¦‚æœç”¨æ‰‹æŒ‡ä¸€ç›´æŒ‰ä½ä¸€ä¸ªå¼¹ç°§ï¼Œå®ƒå°†ä¸ä¼šå¼¹èµ·ç›´åˆ°ä½ æ¾æ‰‹ä¸ºæ­¢ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´å½“è°ƒç”¨åŠ¨ä½œ n æ¯«ç§’åï¼Œæ‰ä¼šæ‰§è¡Œè¯¥åŠ¨ä½œï¼Œè‹¥åœ¨è¿™ n æ¯«ç§’å†…åˆè°ƒç”¨æ­¤åŠ¨ä½œåˆ™å°†é‡æ–°è®¡ç®—æ‰§è¡Œæ—¶é—´</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç©ºé—²æ§åˆ¶ è¿”å›å‡½æ•°è¿ç»­è°ƒç”¨æ—¶ï¼Œç©ºé—²æ—¶é—´å¿…é¡»å¤§äºæˆ–ç­‰äº idleï¼Œaction æ‰ä¼šæ‰§è¡Œ</span></span><br><span class="line"><span class="comment"> * @param idle   &#123;number&#125;    ç©ºé—²æ—¶é—´ï¼Œå•ä½æ¯«ç§’</span></span><br><span class="line"><span class="comment"> * @param action &#123;function&#125;  è¯·æ±‚å…³è”å‡½æ•°ï¼Œå®é™…åº”ç”¨éœ€è¦è°ƒç”¨çš„å‡½æ•°</span></span><br><span class="line"><span class="comment"> * @return &#123;function&#125;    è¿”å›å®¢æˆ·è°ƒç”¨å‡½æ•°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> debounce = <span class="function"><span class="keyword">function</span>(<span class="params">idle, action</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> last;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> ctx = <span class="keyword">this</span>,</span><br><span class="line">      args = <span class="built_in">arguments</span>;</span><br><span class="line">    clearTimeout(last);</span><br><span class="line">    last = setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      action.apply(ctx, args);</span><br><span class="line">    &#125;, idle);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="åŒºåˆ«"><a href="#åŒºåˆ«" class="headerlink" title="åŒºåˆ«"></a>åŒºåˆ«</h2><ul><li>debounce<br>search æœç´¢è”æƒ³ï¼Œç”¨æˆ·åœ¨ä¸æ–­è¾“å…¥å€¼æ—¶ï¼Œç”¨é˜²æŠ–æ¥èŠ‚çº¦è¯·æ±‚èµ„æºã€‚<br>window è§¦å‘ resize çš„æ—¶å€™ï¼Œä¸æ–­çš„è°ƒæ•´æµè§ˆå™¨çª—å£å¤§å°ä¼šä¸æ–­çš„è§¦å‘è¿™ä¸ªäº‹ä»¶ï¼Œç”¨é˜²æŠ–æ¥è®©å…¶åªè§¦å‘ä¸€æ¬¡</li><li>throttle<br>é¼ æ ‡ä¸æ–­ç‚¹å‡»è§¦å‘ï¼Œmousedown(å•ä½æ—¶é—´å†…åªè§¦å‘ä¸€æ¬¡)<br>ç›‘å¬æ»šåŠ¨äº‹ä»¶ï¼Œæ¯”å¦‚æ˜¯å¦æ»‘åˆ°åº•éƒ¨è‡ªåŠ¨åŠ è½½æ›´å¤šï¼Œç”¨ throttle æ¥åˆ¤æ–­</li></ul><h2 id="vue-çš„è·¯ç”±å¦‚ä½•å®ç°ï¼Œæœ€åæåˆ°äº†æœåŠ¡å™¨ç«¯æ¸²æŸ“ï¼Œè§£é‡Šå…¶è¿‡ç¨‹"><a href="#vue-çš„è·¯ç”±å¦‚ä½•å®ç°ï¼Œæœ€åæåˆ°äº†æœåŠ¡å™¨ç«¯æ¸²æŸ“ï¼Œè§£é‡Šå…¶è¿‡ç¨‹" class="headerlink" title="vue çš„è·¯ç”±å¦‚ä½•å®ç°ï¼Œæœ€åæåˆ°äº†æœåŠ¡å™¨ç«¯æ¸²æŸ“ï¼Œè§£é‡Šå…¶è¿‡ç¨‹"></a>vue çš„è·¯ç”±å¦‚ä½•å®ç°ï¼Œæœ€åæåˆ°äº†æœåŠ¡å™¨ç«¯æ¸²æŸ“ï¼Œè§£é‡Šå…¶è¿‡ç¨‹</h2><blockquote><p>å‰ç«¯è·¯ç”±å®ç°çš„å°±æ˜¯åŒ¹é…ä¸åŒçš„ url è·¯å¾„ï¼Œè¿›è¡Œè§£æï¼Œç„¶ååŠ¨æ€çš„æ¸²æŸ“å‡ºåŒºåŸŸ html å†…å®¹</p><ol><li>hash æ¨¡å¼ã€‚hash å€¼å˜åŒ–ï¼Œæµè§ˆå™¨ä¸å‘å‡ºè¯·æ±‚ï¼Œä½†æ˜¯ä¼šè§¦å‘ hashchange è¿™ä¸ªäº‹ä»¶ï¼Œ é€šè¿‡è¿™ä¸ªäº‹ä»¶æˆ‘ä»¬å°±å¯ä»¥çŸ¥é“ hash å€¼å‘ç”Ÿäº†å“ªäº›å˜åŒ–ï¼Œæ¥æ›´æ–°é¡µé¢å†…å®¹</li></ol></blockquote>   <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">matchAndUpdate</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// todo åŒ¹é… hash åš dom æ›´æ–°æ“ä½œ</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">"hashchange"</span>, matchAndUpdate);</span><br></pre></td></tr></table></figure><blockquote><ol start="2"><li>history æ¨¡å¼. pushState å’Œ replaceState åˆ†åˆ«å¯ä»¥æ·»åŠ å’Œä¿®æ”¹å†å²è®°å½•æ¡ç›®,é€šè¿‡è¿™ä¸¤ä¸ª API å¯ä»¥æ”¹å˜ url åœ°å€ä¸”ä¸ä¼šå‘é€è¯·æ±‚,å½“ç”¨æˆ·åˆ·æ–°é¡µé¢ä¹‹ç±»çš„æ“ä½œæ—¶ï¼Œæµè§ˆå™¨è¿˜æ˜¯ä¼šç»™æœåŠ¡å™¨å‘é€è¯·æ±‚ã€‚ä¸ºäº†é¿å…å‡ºç°è¿™ç§æƒ…å†µï¼Œæ‰€ä»¥è¿™ä¸ªå®ç°éœ€è¦æœåŠ¡å™¨çš„æ”¯æŒï¼Œéœ€è¦æŠŠæ‰€æœ‰è·¯ç”±éƒ½é‡å®šå‘åˆ°æ ¹é¡µé¢ã€‚å½“å¤„äºæ¿€æ´»çŠ¶æ€çš„å†å²è®°å½•æ¡ç›®å‘ç”Ÿå˜åŒ–æ—¶,popstate äº‹ä»¶å°±ä¼šåœ¨å¯¹åº” window å¯¹è±¡ä¸Šè§¦å‘</li></ol></blockquote><h2 id="animation-transitionçš„åŒºåˆ«"><a href="#animation-transitionçš„åŒºåˆ«" class="headerlink" title="animation transitionçš„åŒºåˆ«"></a>animation transitionçš„åŒºåˆ«</h2><ul><li>transition åŠ¨ç”»å¯ä»¥é€šè¿‡äº‹ä»¶ç›‘å¬å¯åŠ¨å’Œå®Œæˆ<code>transitionstart</code>ã€<code>transitionrun</code>ã€<code>transitionend</code>,transition åŠ¨ç”»æœ‰å‡ ä¸ªå±€é™ï¼š<ol><li>éœ€è¦é€šè¿‡ç”¨æˆ·çš„è¡Œä¸ºï¼ˆå¦‚ç‚¹å‡»ï¼Œæ‚¬æµ®ç­‰ï¼‰è§¦å‘ï¼Œæ‰€ä»¥æ²¡æ³•åœ¨ç½‘é¡µåŠ è½½æ—¶è‡ªåŠ¨å‘ç”Ÿ</li><li>æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œä¸èƒ½é‡å¤å‘ç”Ÿ</li><li>åªèƒ½å®šä¹‰å¼€å§‹çŠ¶æ€å’Œç»“æŸçŠ¶æ€ï¼Œä¸èƒ½å®šä¹‰ä¸­é—´çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯è¯´åªæœ‰ä¸¤ä¸ªçŠ¶æ€ã€‚<ul><li>keyframes: å…³é”®å¸§ keyframe è‡ªå®šä¹‰åŠ¨ç”»,èƒ½å¤Ÿè‡ªå®šä¹‰ä»»æ„é˜¶æ®µçš„åŠ¨ç”»åŠ¨ä½œã€‚</li></ul></li><li>animation åœ¨ä¸éœ€è¦è§¦å‘äº‹ä»¶çš„æƒ…å†µä¸‹ï¼Œä¹Ÿå¯ä»¥éšæ—¶é—´å˜åŒ–æ¥æ”¹å˜å…ƒç´  CSS å±æ€§ã€‚</li><li>å¯ä»¥æŒ‡å®šåŠ¨ç”»å…·ä½“æ’­æ”¾çš„æ¬¡æ•°</li><li>å¯ä»¥æŒ‡å®šå„ä¸ªé˜¶æ®µçš„çŠ¶æ€ï¼Œè€Œä¸æ˜¯åªæœ‰å¼€å§‹å’Œç»“å°¾ã€‚</li></ol></li></ul><h2 id="ä»‹ç»-requestAnimateFrameï¼Œä¸-setInterval-æˆ–-setTimeout-çš„åŒºåˆ«"><a href="#ä»‹ç»-requestAnimateFrameï¼Œä¸-setInterval-æˆ–-setTimeout-çš„åŒºåˆ«" class="headerlink" title="ä»‹ç» requestAnimateFrameï¼Œä¸ setInterval æˆ– setTimeout çš„åŒºåˆ«"></a>ä»‹ç» requestAnimateFrameï¼Œä¸ setInterval æˆ– setTimeout çš„åŒºåˆ«</h2><ol><li><p><code>setTimeout</code>: seTimeout å®ç°çš„åŠ¨ç”»å®¹æ˜“å‡ºç°å¡é¡¿ã€æŠ–åŠ¨çš„ç°è±¡ï¼Œæœ‰ä¸¤ä¸ªåŸå› å¯èƒ½ä¼šå¯¼è‡´ä¸¢å¸§ï¼š</p><ul><li>setTimeout çš„æ‰§è¡Œæ—¶é—´å¹¶ä¸æ˜¯ç¡®å®šçš„, setTimeout ä»»åŠ¡è¢«æ”¾è¿›äº†å¼‚æ­¥é˜Ÿåˆ—ä¸­ï¼Œåªæœ‰å½“ä¸»çº¿ç¨‹ä¸Šçš„ä»»åŠ¡æ‰§è¡Œå®Œä»¥åï¼Œæ‰ä¼šå»æ£€æŸ¥è¯¥é˜Ÿåˆ—é‡Œçš„ä»»åŠ¡æ˜¯å¦éœ€è¦å¼€å§‹æ‰§è¡Œï¼Œæ‰€ä»¥ setTimeout çš„å®é™…æ‰§è¡Œæ—¶æœºä¸€èˆ¬è¦æ¯”å…¶è®¾å®šçš„æ—¶é—´æ™šä¸€äº›ã€‚</li><li>åˆ·æ–°é¢‘ç‡å— å±å¹•åˆ†è¾¨ç‡ å’Œ å±å¹•å°ºå¯¸ çš„å½±å“ï¼Œä¸åŒè®¾å¤‡çš„å±å¹•ç»˜åˆ¶é¢‘ç‡å¯èƒ½ä¼šä¸åŒï¼Œè€Œ setTimeout åªèƒ½è®¾ç½®ä¸€ä¸ªå›ºå®šçš„æ—¶é—´é—´éš”ï¼Œè¿™ä¸ªæ—¶é—´ä¸ä¸€å®šå’Œå±å¹•çš„åˆ·æ–°æ—¶é—´ç›¸åŒã€‚</li></ul></li><li><p><code>requestAnimateFrame</code>ï¼šè¯·æ±‚æµè§ˆå™¨åœ¨ä¸‹ä¸€æ¬¡é‡ç»˜ä¹‹å‰è°ƒç”¨æŒ‡å®šçš„å‡½æ•°æ¥æ›´æ–°åŠ¨ç”»,å›è°ƒçš„æ¬¡æ•°é€šå¸¸æ˜¯æ¯ç§’ 60 æ¬¡,è¿”å›ä¸€ä¸ª long æ•´æ•°ï¼Œè¯·æ±‚ IDï¼Œå¯ä»¥ä¼ è¿™ä¸ªå€¼ç»™ window.cancelAnimationFrame() ä»¥å–æ¶ˆå›è°ƒå‡½æ•°. æœ€å¤§çš„ä¼˜åŠ¿æ˜¯<strong>rAF çš„æ‰§è¡Œæ­¥ä¼è·Ÿç€æµè§ˆå™¨çš„ç»˜åˆ¶é¢‘ç‡èµ°ï¼Œè¿™æ ·å°±ä¸ä¼šå¼•èµ·ä¸¢å¸§ç°è±¡ï¼Œä¹Ÿä¸ä¼šå¯¼è‡´åŠ¨ç”»å‡ºç°å¡é¡¿çš„é—®é¢˜ã€‚</strong></p></li></ol><h2 id="js-ä¸ºä»€ä¹ˆè¦å•çº¿ç¨‹çš„"><a href="#js-ä¸ºä»€ä¹ˆè¦å•çº¿ç¨‹çš„" class="headerlink" title="js ä¸ºä»€ä¹ˆè¦å•çº¿ç¨‹çš„"></a>js ä¸ºä»€ä¹ˆè¦å•çº¿ç¨‹çš„</h2><blockquote><p>åœ¨å¤šçº¿ç¨‹æ“ä½œçš„æƒ…å†µä¸‹å¯ä»¥å®ç°åº”ç”¨çš„å¹¶è¡Œå¤„ç†ï¼Œè€Œæé«˜æ•´ä¸ªåº”ç”¨ç¨‹åºçš„æ€§èƒ½å’Œååé‡ï¼Œæ›´å¤§ç²’åº¦çš„æ¦¨å–æœ¬æœºçš„ CPU åˆ©ç”¨ç‡ï¼Œç‰¹åˆ«æ˜¯ç°ä»£å¾ˆå¤šè¯­è¨€éƒ½æ”¯æŒäº†å¤šæ ¸å¹¶è¡Œå¤„ç†æŠ€æœ¯ã€‚JavaScript æ˜¯å•çº¿ç¨‹æ‰§è¡Œï¼Œå› ä¸ºå¦‚æœ JavaScript æ˜¯å¤šçº¿ç¨‹çš„æ–¹å¼æ¥æ“ä½œ UIï¼Œåˆ™å¯èƒ½å‡ºç° UI æ“ä½œçš„å†²çª, å¦‚æœå¼•å…¥ä¸€äº›é”çš„æœºåˆ¶æ¥è§£å†³è¿™äº›å†²çªï¼Œåˆ™å®¹æ˜“å¼•å…¥æ›´å¤§çš„å¤æ‚æ€§ï¼Œæ‰€ä»¥ JavaScript ä»å¼€å§‹å°±é€‰æ‹©äº†å•çº¿ç¨‹æ‰§è¡Œã€‚</p></blockquote><h2 id="åŒæ­¥ä¸éåŒæ­¥-é˜»å¡éé˜»å¡-å¹¶å‘å¹¶è¡Œçš„åŒºåˆ«"><a href="#åŒæ­¥ä¸éåŒæ­¥-é˜»å¡éé˜»å¡-å¹¶å‘å¹¶è¡Œçš„åŒºåˆ«" class="headerlink" title="## åŒæ­¥ä¸éåŒæ­¥ é˜»å¡éé˜»å¡ å¹¶å‘å¹¶è¡Œçš„åŒºåˆ«"></a>## åŒæ­¥ä¸éåŒæ­¥ é˜»å¡éé˜»å¡ å¹¶å‘å¹¶è¡Œçš„åŒºåˆ«</h2><p>ç”¨æ™®é€šçš„æ°´å£¶çƒ§ï¼Œäººåœ¨è¾¹ä¸Šçœ‹ç€ï¼Œæ°´å¼€äº†å†å»çœ‹çƒã€‚ï¼ˆåŒæ­¥ï¼Œé˜»å¡ï¼‰è¿™ä¸ªæ˜¯å¸¸è§„åšæ³•ï¼Œä½†æ˜¯æˆ‘çœ‹çƒä¸çˆ½äº†ã€‚<br>ç”¨æ™®é€šæ°´å£¶çƒ§ï¼Œäººå»çœ‹çƒï¼Œéš”å‡ åˆ†é’Ÿå»å¨æˆ¿çœ‹çœ‹ã€‚ï¼ˆåŒæ­¥ï¼Œéé˜»å¡ï¼‰è¿™ä¸ªåˆå¤§é—®é¢˜ï¼Œä¸‡ä¸€åœ¨æˆ‘ç¦»å¼€çš„å‡ åˆ†é’Ÿæ°´å¼€äº†ï¼Œæˆ‘å°±éº»çƒ¦äº†ã€‚<br>ç”¨ä¼šå«çš„æ°´å£¶ï¼Œäººåœ¨è¾¹ä¸Šçœ‹ç€ã€‚ï¼ˆå¼‚æ­¥ï¼Œé˜»å¡ï¼‰è¿™ä¸ªæ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯æˆ‘å¤ªå‚»äº†ã€‚<br>ç”¨ä¼šå«çš„æ°´å£¶ï¼Œäººå»çœ‹çƒï¼Œå¬è§æ°´å£¶å«äº†å†å»çœ‹ã€‚ï¼ˆå¼‚æ­¥ï¼Œéé˜»å¡ï¼‰è¿™ä¸ªåº”è¯¥æ˜¯æœ€å¥½çš„ã€‚<br>ç­‰ç€çœ‹çƒçš„æˆ‘ï¼šé˜»å¡</p><p>çœ‹ç€ç”µè§†çš„æˆ‘ï¼šéé˜»å¡</p><p>æ™®é€šæ°´å£¶ï¼šåŒæ­¥</p><p>ä¼šå«çš„æ°´å£¶ï¼šå¼‚æ­¥ (å†…æ ¸ä¼šé€šçŸ¥)</p><ul><li>åŒæ­¥è¿‡ç¨‹ä¸­è¿›ç¨‹è§¦å‘ IO æ“ä½œå¹¶ç­‰å¾…æˆ–è€…è½®è¯¢çš„å»æŸ¥çœ‹ IO æ“ä½œæ˜¯å¦å®Œæˆã€‚å¼‚æ­¥è¿‡ç¨‹ä¸­è¿›ç¨‹è§¦å‘ IO æ“ä½œä»¥åï¼Œç›´æ¥è¿”å›ï¼Œåšè‡ªå·±çš„äº‹æƒ…ï¼ŒIO äº¤ç»™å†…æ ¸æ¥å¤„ç†ï¼Œå®Œæˆåå†…æ ¸é€šçŸ¥è¿›ç¨‹ IO å®Œæˆã€‚</li></ul><ul><li>é˜»å¡</li></ul><p>é˜»å¡çš„æ¦‚å¿µå¾€å¾€ä¼´éšç€çº¿ç¨‹ã€‚é˜»å¡ä¸€èˆ¬æ˜¯æŒ‡ï¼šåœ¨è°ƒç”¨ç»“æœè¿”å›ä¹‹å‰ï¼Œå½“å‰çº¿ç¨‹ä¼šè¢«æŒ‚èµ·ã€‚è°ƒç”¨çº¿ç¨‹åªæœ‰åœ¨å¾—åˆ°ç»“æœä¹‹åæ‰ä¼šè¢«å”¤é†’æ‰§è¡Œåç»­çš„æ“ä½œã€‚</p><ul><li>éé˜»å¡</li></ul><p>é‚£ä¹ˆéé˜»å¡ï¼Œæ¯«æ— ç–‘é—®æ˜¯é˜»å¡çš„åå‘æ“ä½œã€‚éé˜»å¡å¼çš„è°ƒç”¨æŒ‡ï¼šåœ¨ç»“æœæ²¡æœ‰è¿”å›ä¹‹å‰ï¼Œè¯¥è°ƒç”¨ä¸ä¼šé˜»å¡ä½å½“å‰çº¿ç¨‹ã€‚</p><ul><li><p>å¹¶å‘ï¼šå½“æœ‰å¤šä¸ªçº¿ç¨‹åœ¨æ“ä½œæ—¶ï¼Œå¦‚æœç³»ç»Ÿåªæœ‰ä¸€ä¸ª CPUï¼Œæ“ä½œç³»ç»Ÿåªèƒ½æŠŠ CPU è¿è¡Œæ—¶é—´åˆ’åˆ†æˆè‹¥å¹²ä¸ªæ—¶é—´æ®µ,å†å°†æ—¶é—´æ®µåˆ†é…ç»™å„ä¸ªçº¿ç¨‹æ‰§è¡Œï¼Œåœ¨ä¸€ä¸ªæ—¶é—´æ®µçš„å¿«é€Ÿçš„åˆ‡æ¢ä¸åŒçš„çº¿ç¨‹ä»£ç è¿è¡Œã€‚</p></li><li><p>å¹¶è¡Œï¼šå½“ç³»ç»Ÿæœ‰å¤šä¸ª CPU æ—¶ï¼Œå¯ä»¥å­˜åœ¨å½“ä¸€ä¸ª CPU æ‰§è¡Œä¸€ä¸ªçº¿ç¨‹æ—¶ï¼Œå¦ä¸€ä¸ª CPU å¯ä»¥æ‰§è¡Œå¦ä¸€ä¸ªçº¿ç¨‹ï¼Œä¸¤ä¸ªçº¿ç¨‹äº’ä¸æŠ¢å  CPU èµ„æºï¼Œå¯ä»¥åŒæ—¶è¿›è¡Œã€‚</p></li></ul><h3 id="nodejs-ä¸­çš„é˜»å¡éé˜»å¡"><a href="#nodejs-ä¸­çš„é˜»å¡éé˜»å¡" class="headerlink" title="nodejs ä¸­çš„é˜»å¡éé˜»å¡"></a>nodejs ä¸­çš„é˜»å¡éé˜»å¡</h3><p>é˜»å¡ï¼Œè¯»å–æ–‡ä»¶åŒæ­¥ I/O æ“ä½œï¼Œç­‰å¾…æ–‡ä»¶è¯»å–å®Œå†è¿›è¡Œå…¶ä»–æ“ä½œã€‚</p><p>éé˜»å¡ï¼Œè¯»å–æ–‡ä»¶æ˜¯å¼‚æ­¥å›è°ƒï¼Œåœ¨ç­‰å¾…æ–‡ä»¶è¯»å–æ—¶å¯ä»¥è¿›è¡Œå…¶ä»–æ“ä½œï¼Œè¿™å°±å¤§å¤§æé«˜äº† Node.js çš„æ€§èƒ½ï¼Œå¯ä»¥å¤„ç†å¤§é‡çš„å¹¶å‘è¯·æ±‚ã€‚</p><h2 id="react-çš„-filber-ï¼ˆ16-3ä¹‹åå¼€å¯å¼‚æ­¥æ¸²æŸ“"><a href="#react-çš„-filber-ï¼ˆ16-3ä¹‹åå¼€å¯å¼‚æ­¥æ¸²æŸ“" class="headerlink" title="react çš„ filber ï¼ˆ16.3ä¹‹åå¼€å¯å¼‚æ­¥æ¸²æŸ“)"></a>react çš„ filber ï¼ˆ16.3ä¹‹åå¼€å¯å¼‚æ­¥æ¸²æŸ“)</h2><blockquote><p>åœ¨ fiber ä¸­ï¼Œæ›´æ–°æ˜¯åˆ†é˜¶æ®µçš„ï¼Œå…·ä½“åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼Œé¦–å…ˆæ˜¯ reconciliation çš„é˜¶æ®µï¼Œè¿™ä¸ªé˜¶æ®µåœ¨è®¡ç®—å‰å dom æ ‘çš„å·®å¼‚ï¼Œç„¶åæ˜¯ commit çš„é˜¶æ®µï¼Œè¿™ä¸ªé˜¶æ®µå°†æŠŠæ›´æ–°æ¸²æŸ“åˆ°é¡µé¢ä¸Šã€‚ç¬¬ä¸€ä¸ªé˜¶æ®µæ˜¯å¯ä»¥æ‰“æ–­çš„ï¼Œå› ä¸ºè¿™ä¸ªé˜¶æ®µè€—æ—¶å¯èƒ½ä¼šå¾ˆé•¿ï¼Œå› æ­¤éœ€è¦æš‚åœä¸‹æ¥å»æ‰§è¡Œå…¶ä»–æ›´é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡ï¼Œç¬¬äºŒä¸ªé˜¶æ®µåˆ™ä¸ä¼šè¢«æ‰“æ–­ï¼Œä¼šä¸€å£æ°”æŠŠæ›´æ–°æ¸²æŸ“åˆ°é¡µé¢ä¸Šã€‚</p></blockquote><p>ç”±äº reconciliation çš„é˜¶æ®µä¼šè¢«æ‰“æ–­ï¼Œå¯èƒ½ä¼šå¯¼è‡´ commit å‰çš„è¿™äº›ç”Ÿå‘½å‘¨æœŸå‡½æ•°å¤šæ¬¡æ‰§è¡Œã€‚react å®˜æ–¹ç›®å‰å·²ç»æŠŠ componentWillMountã€componentWillReceiveProps å’Œ componetWillUpdate æ ‡è®°ä¸º unsafeï¼Œå¹¶ä½¿ç”¨æ–°çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•° getDerivedStateFromProps å’Œ getSnapshotBeforeUpdate è¿›è¡Œæ›¿æ¢ã€‚</p><p>ç»„ä»¶çš„æ¸²æŸ“è¢«åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼šç¬¬ä¸€ä¸ªé˜¶æ®µï¼ˆä¹Ÿå«åš render é˜¶æ®µï¼‰æ˜¯å¯ä»¥è¢« React æ‰“æ–­çš„ï¼Œä¸€æ—¦è¢«æ‰“æ–­ï¼Œè¿™é˜¶æ®µæ‰€åšçš„æ‰€æœ‰äº‹æƒ…éƒ½è¢«åºŸå¼ƒï¼Œå½“ React å¤„ç†å®Œç´§æ€¥çš„äº‹æƒ…å›æ¥ï¼Œä¾ç„¶ä¼šé‡æ–°æ¸²æŸ“è¿™ä¸ªç»„ä»¶ï¼Œè¿™æ—¶å€™ç¬¬ä¸€é˜¶æ®µçš„å·¥ä½œä¼šé‡åšä¸€éï¼›ç¬¬äºŒä¸ªé˜¶æ®µå«åš commit é˜¶æ®µï¼Œä¸€æ—¦å¼€å§‹å°±ä¸èƒ½ä¸­æ–­ï¼Œä¹Ÿå°±æ˜¯è¯´ç¬¬äºŒä¸ªé˜¶æ®µçš„å·¥ä½œä¼šç¨³ç¨³å½“å½“åœ°åšåˆ°è¿™ä¸ªç»„ä»¶çš„æ¸²æŸ“ç»“æŸã€‚</p><p>ä¸¤ä¸ªé˜¶æ®µçš„åˆ†ç•Œç‚¹ï¼Œå°±æ˜¯  render  å‡½æ•°ã€‚render å‡½æ•°ä¹‹å‰çš„æ‰€æœ‰ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼ˆåŒ…æ‹¬ render)éƒ½å±äºç¬¬ä¸€é˜¶æ®µï¼Œä¹‹åçš„éƒ½å±äºç¬¬äºŒé˜¶æ®µã€‚<br>render ä¹‹å‰çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼ˆä¹Ÿå°±æ˜¯ç¬¬ä¸€é˜¶æ®µç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼‰åŒ…æ‹¬è¿™äº›ï¼š</p><ul><li>componentWillReceiveProps</li><li>shouldComponentUpdate</li><li>componentWillUpdate</li><li>componentWillMount</li><li>render</li></ul><p>getDerivedStateFromProps åº”è¯¥æ˜¯ä¸€ä¸ªçº¯å‡½æ•°ï¼ŒReact å°±æ˜¯é€šè¿‡è¦æ±‚è¿™ç§çº¯å‡½æ•°ï¼Œå¼ºåˆ¶å¼€å‘è€…ä»¬å¿…é¡»é€‚åº”å¼‚æ­¥æ¸²æŸ“ã€‚</p><h2 id="reconciliation-é˜¶æ®µ"><a href="#reconciliation-é˜¶æ®µ" class="headerlink" title="reconciliation é˜¶æ®µ"></a>reconciliation é˜¶æ®µ</h2><p>è™šæ‹Ÿ dom çš„æ•°æ®å¯¹æ¯”</p><h2 id="commit-é˜¶æ®µ"><a href="#commit-é˜¶æ®µ" class="headerlink" title="commit é˜¶æ®µ"></a>commit é˜¶æ®µ</h2><p>å°† change list æ›´æ–°åˆ° dom ä¸Š ä¸é€‚åˆæ‹†åˆ†æ˜¯å› ä¸ºä½¿ç”¨ vdom çš„æ„ä¹‰å°±æ˜¯ä¸ºäº†èŠ‚çœè€—æ—¶çš„ dom æ“ä½œ</p><h2 id="linuxå¸¸è§å‘½ä»¤"><a href="#linuxå¸¸è§å‘½ä»¤" class="headerlink" title="linuxå¸¸è§å‘½ä»¤"></a>linuxå¸¸è§å‘½ä»¤</h2><ul><li><p>åˆ›å»ºç¬¦å·é“¾æ¥ï¼ˆç±»ä¼¼windowsçš„å¿«æ·æ–¹å¼)</p><blockquote><p>ln -s source_file symbolic_link</p></blockquote></li><li><p>æ‰“å¼€æ–‡ä»¶è·³åˆ°ç¬¬ä¸€ä¸ªåŒ¹é…çš„è¡Œ</p><blockquote><p>$ vim +/search-term filename.txt</p></blockquote></li><li><p>grepç›¸å…³</p></li></ul><p>1.åœ¨æ–‡ä»¶ä¸­æŸ¥æ‰¾å­—ç¬¦ä¸²ä¸åŒºåˆ†å¤§å°å†™</p><blockquote><p>$ grep -i â€œtheâ€ demo_file<br>2.åœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­é€’å½’æŸ¥è¯¢åŒ…å«æŒ‡å®šå­—ç¬¦ä¸²çš„æ–‡ä»¶<br>$ grep -r â€œrameshâ€ *</p></blockquote><ul><li><p>æŸ¥æ‰¾æŒ‡å®šæ–‡ä»¶åçš„æ–‡ä»¶(ä¸åŒºåˆ†å¤§å°å†™)</p><blockquote><p>find -iname â€˜..â€™</p></blockquote></li><li><p>ç™»å½•åˆ°è¿œç¨‹ä¸»æœº</p><blockquote><p>$ ssh -l jsmith remotehost.example.com</p></blockquote></li><li><p>ps</p></li></ul><p>1.æŸ¥çœ‹å½“å‰æ­£åœ¨è¿è¡Œçš„æ‰€æœ‰è¿›ç¨‹</p><blockquote><p>$ ps -ef | more<br>2.ä»¥æ ‘çŠ¶ç»“æ„æ˜¾ç¤ºå½“å‰æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ï¼ŒHé€‰é¡¹è¡¨ç¤ºæ˜¾ç¤ºè¿›ç¨‹çš„å±‚æ¬¡ç»“æ„<br>$ ps -efH | more</p><ul><li>æ˜¾ç¤ºå½“å‰ç³»ç»Ÿä¸­å ç”¨èµ„æºæœ€å¤šçš„ä¸€äº›è¿›ç¨‹<br>top</li></ul></blockquote><ul><li><p>æŸ¥çœ‹æ‰€æœ‰ç½‘ç»œæ¥å£åŠå…¶çŠ¶æ€</p><blockquote><p>$ ifconfig -a</p></blockquote></li><li><p>ä½¿ç”¨upå’Œdownå‘½ä»¤å¯åŠ¨æˆ–åœæ­¢æŸä¸ªæ¥å£</p><blockquote><p>$ ifconfig eth0 up</p></blockquote></li></ul><blockquote><p>$ ifconfig eth0 down</p></blockquote><ul><li><p>æŸ¥æ‰¾æŸä¸ªå‘½ä»¤çš„ä½ç½®</p><blockquote><p>$ whereis cmd</p></blockquote></li><li><p>ä¸åŠ è½½æ•´ä¸ªæ–‡ä»¶çš„å‰æä¸‹æ˜¾ç¤ºæ–‡ä»¶å†…å®¹ (æŸ¥çœ‹å¤§å‹æ—¥å¿—æ–‡ä»¶çš„æ—¶å€™)</p><blockquote><p>$ less</p></blockquote></li><li><p>è®¾ç½®ç¯å¢ƒå˜é‡</p><blockquote><p>$ export â€¦</p></blockquote></li><li><p>catè¿½åŠ aå†…å®¹åˆ°æ–‡ä»¶bçš„æœ«å°¾</p><blockquote><p>$ cat a &gt; b</p></blockquote></li><li><p>catè¦†ç›–åŸæœ‰æ–‡ä»¶çš„å†…å®¹</p><blockquote><p>$ cat a &gt;&gt; b</p></blockquote></li><li><p>curlå‘½ä»¤ç›¸å…³</p></li></ul><p>1.æ¨¡ä»¿æµè§ˆå™¨</p><blockquote><p>$ curl -A â€œMozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.0)â€ <a href="http://www.linux.com" target="_blank" rel="noopener">http://www.linux.com</a><br>2.ä¼ªé€ refererï¼ˆç›—é“¾ï¼‰<br>$ curl -e â€œ<a href="http://www.linux.com&quot;" target="_blank" rel="noopener">www.linux.com&quot;</a> <a href="http://mail.linux.com" target="_blank" rel="noopener">http://mail.linux.com</a><br>3.åˆ©ç”¨curlä¸‹è½½æ–‡ä»¶<br>ä½¿ç”¨å†…ç½®optionï¼š-o(å°å†™)<br>$ curl -o dodo1.jpg http:<a href="http://www.linux.com/dodo1.JPG" target="_blank" rel="noopener">www.linux.com/dodo1.JPG</a><br>4.ä½¿ç”¨curlå‘é€POSTè¯·æ±‚<br>$ curl -d â€œuser=admin&amp;passwd=12345678â€ <a href="http://127.0.0.1:8080/login" target="_blank" rel="noopener">http://127.0.0.1:8080/login</a></p></blockquote><h3 id="å‰ç«¯æ¨¡å—åŒ–"><a href="#å‰ç«¯æ¨¡å—åŒ–" class="headerlink" title="å‰ç«¯æ¨¡å—åŒ–"></a>å‰ç«¯æ¨¡å—åŒ–</h3><p>CommonJsç”¨åœ¨æœåŠ¡å™¨ç«¯ï¼ŒAMDå’ŒCMDç”¨åœ¨æµè§ˆå™¨ç¯å¢ƒ<br>AMD:æå‰æ‰§è¡Œï¼ˆå¼‚æ­¥åŠ è½½ï¼šä¾èµ–å…ˆæ‰§è¡Œï¼‰+å»¶è¿Ÿæ‰§è¡Œ<br>CMD:å»¶è¿Ÿæ‰§è¡Œï¼ˆè¿è¡Œåˆ°éœ€åŠ è½½ï¼Œæ ¹æ®é¡ºåºæ‰§è¡Œï¼‰</p><h2 id="ç§»åŠ¨ç«¯ç›¸å…³"><a href="#ç§»åŠ¨ç«¯ç›¸å…³" class="headerlink" title="ç§»åŠ¨ç«¯ç›¸å…³"></a>ç§»åŠ¨ç«¯ç›¸å…³</h2><h3 id="ç§»åŠ¨ç«¯ç‚¹å‡»-300ms-å»¶è¿Ÿæ˜¯ä»€ä¹ˆï¼Ÿæ€æ ·æ¶ˆé™¤ï¼Ÿ"><a href="#ç§»åŠ¨ç«¯ç‚¹å‡»-300ms-å»¶è¿Ÿæ˜¯ä»€ä¹ˆï¼Ÿæ€æ ·æ¶ˆé™¤ï¼Ÿ" class="headerlink" title="ç§»åŠ¨ç«¯ç‚¹å‡» 300ms å»¶è¿Ÿæ˜¯ä»€ä¹ˆï¼Ÿæ€æ ·æ¶ˆé™¤ï¼Ÿ"></a>ç§»åŠ¨ç«¯ç‚¹å‡» 300ms å»¶è¿Ÿæ˜¯ä»€ä¹ˆï¼Ÿæ€æ ·æ¶ˆé™¤ï¼Ÿ</h3><p>ä¸ºäº†åŒå‡»ç¼©æ”¾ï¼Œé¡µé¢ç‚¹å‡»ä¼šæœ‰ 300ms å»¶è¿Ÿ<br>è§£å†³æ–¹æ³•ï¼Œç¦ç”¨ç¼©æ”¾ï¼Œæ›´æ”¹é»˜è®¤çš„è§†å£å®½åº¦<br>&lt;meta name=â€viewportâ€ content=â€user-scalable=no, initial-scale=1,maximum-scale=1, width=device-widthâ€&gt;</p>]]></content>
      
      
      
        <tags>
            
            <tag> é¢ç» </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å‰ç«¯æ–‡ä»¶ä¸Šä¼ </title>
      <link href="/ashley271017.github.io/2019/06/14/%E5%89%8D%E7%AB%AF%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"/>
      <url>/ashley271017.github.io/2019/06/14/%E5%89%8D%E7%AB%AF%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸Šä¼ æ–‡ä»¶çš„å‡ ç§æ–¹å¼"><a href="#ä¸Šä¼ æ–‡ä»¶çš„å‡ ç§æ–¹å¼" class="headerlink" title="ä¸Šä¼ æ–‡ä»¶çš„å‡ ç§æ–¹å¼"></a>ä¸Šä¼ æ–‡ä»¶çš„å‡ ç§æ–¹å¼</h2><ul><li><p>æ™®é€šè¡¨å•ä¸Šä¼ <br>ä½¿ç”¨ PHP æ¥å±•ç¤ºå¸¸è§„çš„è¡¨å•ä¸Šä¼ æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚é¦–å…ˆæ„å»ºæ–‡ä»¶ä¸Šä¼ çš„è¡¨å•ï¼Œå¹¶æŒ‡å®šè¡¨å•çš„æäº¤å†…å®¹ç±»å‹ä¸º enctype=â€multipart/form-dataâ€ï¼Œè¡¨æ˜è¡¨å•éœ€è¦ä¸Šä¼ äºŒè¿›åˆ¶æ•°æ®ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"/index.php"</span> <span class="attr">method</span>=<span class="string">"POST"</span> <span class="attr">enctype</span>=<span class="string">"multipart/form-data"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">name</span>=<span class="string">"myfile"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>æ–‡ä»¶ç¼–ç ä¸Šä¼ <br>ç¬¬ä¸€ä¸ªæ€è·¯æ˜¯å°†æ–‡ä»¶è¿›è¡Œç¼–ç ï¼Œç„¶ååœ¨æœåŠ¡ç«¯è¿›è¡Œè§£ç ï¼Œä¹‹å‰å†™è¿‡ä¸€ç¯‡åœ¨å‰ç«¯å®ç°å›¾ç‰‡å‹ç¼©ä¸Šä¼ çš„åšå®¢ï¼Œå…¶ä¸»è¦å®ç°åŸç†å°±æ˜¯å°†å›¾ç‰‡è½¬æ¢æˆ base64 è¿›è¡Œä¼ é€’<br>var imgURL = URL.createObjectURL(file);<br>ctx.drawImage(imgURL, 0, 0);<br>// è·å–å›¾ç‰‡çš„ç¼–ç ï¼Œç„¶åå°†å›¾ç‰‡å½“åšæ˜¯ä¸€ä¸ªå¾ˆé•¿çš„å­—ç¬¦ä¸²è¿›è¡Œä¼ é€’<br>var data = canvas.toDataURL(â€œimage/jpegâ€, 0.5);</p></li></ul><p>é™¤äº†è¿›è¡Œ base64 ç¼–ç ï¼Œè¿˜å¯ä»¥åœ¨å‰ç«¯ç›´æ¥è¯»å–æ–‡ä»¶å†…å®¹åä»¥äºŒè¿›åˆ¶æ ¼å¼ä¸Šä¼ </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¯»å–äºŒè¿›åˆ¶æ–‡ä»¶</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">readBinary</span>(<span class="params">text</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> data = <span class="keyword">new</span> <span class="built_in">ArrayBuffer</span>(text.length)</span><br><span class="line">  <span class="keyword">var</span> ui8a = <span class="keyword">new</span> <span class="built_in">Uint8Array</span>(data, <span class="number">0</span>)</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; text.length; i++) &#123;</span><br><span class="line">    ui8a[i] = text.charCodeAt(i) &amp; <span class="number">0xff</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(ui8a)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> reader = <span class="keyword">new</span> FileReader()</span><br><span class="line">reader.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  readBinary(<span class="keyword">this</span>.result) <span class="comment">// è¯»å–resultæˆ–ç›´æ¥ä¸Šä¼ </span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æŠŠä»inputé‡Œè¯»å–çš„æ–‡ä»¶å†…å®¹ï¼Œæ”¾åˆ°fileReaderçš„resultå­—æ®µé‡Œ</span></span><br><span class="line">reader.readAsBinaryString(file)</span><br></pre></td></tr></table></figure><h2 id="æ–‡ä»¶ä¸Šä¼ "><a href="#æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="æ–‡ä»¶ä¸Šä¼ "></a>æ–‡ä»¶ä¸Šä¼ </h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">uploadAndSubmit</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">var</span> form = <span class="built_in">document</span>.forms[<span class="string">"demoForm"</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (form[<span class="string">"file"</span>].files.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line"><span class="comment">// å¯»æ‰¾è¡¨å•åŸŸä¸­çš„ &lt;input type="file" ... /&gt; æ ‡ç­¾</span></span><br><span class="line"><span class="keyword">var</span> file = form[<span class="string">"file"</span>].files[<span class="number">0</span>];</span><br><span class="line"><span class="comment">// try sending</span></span><br><span class="line"><span class="keyword">var</span> reader = <span class="keyword">new</span> FileReader();</span><br><span class="line"></span><br><span class="line">reader.onloadstart = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="comment">// è¿™ä¸ªäº‹ä»¶åœ¨è¯»å–å¼€å§‹æ—¶è§¦å‘</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"onloadstart"</span>);</span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">"bytesTotal"</span>).textContent = file.size;</span><br><span class="line">&#125;</span><br><span class="line">reader.onprogress = <span class="function"><span class="keyword">function</span>(<span class="params">p</span>) </span>&#123;</span><br><span class="line"><span class="comment">// è¿™ä¸ªäº‹ä»¶åœ¨è¯»å–è¿›è¡Œä¸­å®šæ—¶è§¦å‘</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"onprogress"</span>);</span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">"bytesRead"</span>).textContent = p.loaded;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">reader.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">   <span class="comment">// è¿™ä¸ªäº‹ä»¶åœ¨è¯»å–æˆåŠŸç»“æŸåè§¦å‘</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"load complete"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">reader.onloadend = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">   <span class="comment">// è¿™ä¸ªäº‹ä»¶åœ¨è¯»å–ç»“æŸåï¼Œæ— è®ºæˆåŠŸæˆ–è€…å¤±è´¥éƒ½ä¼šè§¦å‘</span></span><br><span class="line"><span class="keyword">if</span> (reader.error) &#123;</span><br><span class="line"><span class="built_in">console</span>.log(reader.error);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">"bytesRead"</span>).textContent = file.size;</span><br><span class="line"><span class="comment">// æ„é€  XMLHttpRequest å¯¹è±¡ï¼Œå‘é€æ–‡ä»¶ Binary æ•°æ®</span></span><br><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">xhr.open(<span class="comment">/* method */</span> <span class="string">"POST"</span>,</span><br><span class="line"><span class="comment">/* target url */</span> <span class="string">"upload.jsp?fileName="</span> + file.name</span><br><span class="line"><span class="comment">/*, async, default to true */</span>);</span><br><span class="line"><span class="comment">// äºŒè¿›åˆ¶æµ</span></span><br><span class="line"><span class="comment">// æŒ‡å®šä¸€ä¸ªMIMEç±»å‹ç”¨äºæ›¿ä»£æœåŠ¡å™¨æŒ‡å®šçš„ç±»å‹ï¼Œä½¿æœåŠ¡ç«¯å“åº”ä¿¡æ¯ä¸­ä¼ è¾“çš„æ•°æ®æŒ‰ç…§è¯¥æŒ‡å®šMIMEç±»å‹å¤„ç†</span></span><br><span class="line">xhr.overrideMimeType(<span class="string">"application/octet-stream"</span>);</span><br><span class="line">xhr.sendAsBinary(reader.result);</span><br><span class="line">xhr.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (xhr.readyState == <span class="number">4</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (xhr.status == <span class="number">200</span>) &#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"upload complete"</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"response: "</span> + xhr.responseText);</span><br></pre></td></tr></table></figure><ul><li>formData å¼‚æ­¥ä¸Šä¼ <br>FormData å¯¹è±¡ä¸»è¦ç”¨æ¥ç»„è£…ä¸€ç»„ç”¨ XMLHttpRequest å‘é€è¯·æ±‚çš„é”®/å€¼å¯¹ï¼Œå¯ä»¥æ›´åŠ çµæ´»åœ°å‘é€ Ajax è¯·æ±‚ã€‚å¯ä»¥ä½¿ç”¨ FormData æ¥æ¨¡æ‹Ÿè¡¨å•æäº¤ã€‚</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> files = e.target.files <span class="comment">// è·å– input çš„ file å¯¹è±¡</span></span><br><span class="line"><span class="keyword">let</span> formData = <span class="keyword">new</span> FormData()</span><br><span class="line">formData.append(<span class="string">'file'</span>, file)</span><br><span class="line">axios.post(url, formData)</span><br></pre></td></tr></table></figure><h2 id="å¤§æ–‡ä»¶ä¸Šä¼ "><a href="#å¤§æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="å¤§æ–‡ä»¶ä¸Šä¼ "></a>å¤§æ–‡ä»¶ä¸Šä¼ </h2><p>å¤§æ–‡ä»¶ä¸Šä¼ æœ€ä¸»è¦çš„é—®é¢˜å°±åœ¨äºï¼šåœ¨åŒä¸€ä¸ªè¯·æ±‚ä¸­ï¼Œè¦ä¸Šä¼ å¤§é‡çš„æ•°æ®ï¼Œå¯¼è‡´æ•´ä¸ªè¿‡ç¨‹ä¼šæ¯”è¾ƒæ¼«é•¿ï¼Œä¸”å¤±è´¥åéœ€è¦é‡å¤´å¼€å§‹ä¸Šä¼ ã€‚è¯•æƒ³ï¼Œå¦‚æœæˆ‘ä»¬å°†è¿™ä¸ªè¯·æ±‚æ‹†åˆ†æˆå¤šä¸ªè¯·æ±‚ï¼Œæ¯ä¸ªè¯·æ±‚çš„æ—¶é—´å°±ä¼šç¼©çŸ­ï¼Œä¸”å¦‚æœæŸä¸ªè¯·æ±‚å¤±è´¥ï¼Œåªéœ€è¦é‡æ–°å‘é€è¿™ä¸€æ¬¡è¯·æ±‚å³å¯ï¼Œæ— éœ€ä»å¤´å¼€å§‹ï¼Œè¿™æ ·æ˜¯å¦å¯ä»¥è§£å†³å¤§æ–‡ä»¶ä¸Šä¼ çš„é—®é¢˜å‘¢ï¼Ÿ</p><ul><li>æ–‡ä»¶åˆ‡ç‰‡<br>å‚è€ƒï¼š å¤§æ–‡ä»¶åˆ‡å‰²ä¸Šä¼ <br>ç¼–ç æ–¹å¼ä¸Šä¼ ä¸­ï¼Œåœ¨å‰ç«¯æˆ‘ä»¬åªè¦å…ˆè·å–æ–‡ä»¶çš„äºŒè¿›åˆ¶å†…å®¹ï¼Œç„¶åå¯¹å…¶å†…å®¹è¿›è¡Œæ‹†åˆ†ï¼Œæœ€åå°†æ¯ä¸ªåˆ‡ç‰‡ä¸Šä¼ åˆ°æœåŠ¡ç«¯å³å¯ã€‚<br>åœ¨ JavaScript ä¸­ï¼Œæ–‡ä»¶ FIle å¯¹è±¡æ˜¯ Blob å¯¹è±¡çš„å­ç±»ï¼ŒBlob å¯¹è±¡åŒ…å«ä¸€ä¸ªé‡è¦çš„æ–¹æ³• sliceï¼Œé€šè¿‡è¿™ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¯¹äºŒè¿›åˆ¶æ–‡ä»¶è¿›è¡Œæ‹†åˆ†ã€‚<br>ä¸‹é¢æ˜¯ä¸€ä¸ªæ‹†åˆ†æ–‡ä»¶çš„ç¤ºä¾‹</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">slice</span>(<span class="params">file, piece = <span class="number">1024</span> * <span class="number">1024</span> * <span class="number">5</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> totalSize = file.size; <span class="comment">// æ–‡ä»¶æ€»å¤§å°</span></span><br><span class="line">  <span class="keyword">let</span> start = <span class="number">0</span>; <span class="comment">// æ¯æ¬¡ä¸Šä¼ çš„å¼€å§‹å­—èŠ‚</span></span><br><span class="line">  <span class="keyword">let</span> end = start + piece; <span class="comment">// æ¯æ¬¡ä¸Šä¼ çš„ç»“å°¾å­—èŠ‚</span></span><br><span class="line">  <span class="keyword">let</span> chunks = []</span><br><span class="line">  <span class="keyword">while</span> (start &lt; totalSize) &#123;</span><br><span class="line">    <span class="comment">// æ ¹æ®é•¿åº¦æˆªå–æ¯æ¬¡éœ€è¦ä¸Šä¼ çš„æ•°æ®</span></span><br><span class="line">    <span class="comment">// Fileå¯¹è±¡ç»§æ‰¿è‡ªBlobå¯¹è±¡ï¼Œå› æ­¤åŒ…å«sliceæ–¹æ³•</span></span><br><span class="line">    <span class="keyword">let</span> blob = file.slice(start, end);</span><br><span class="line">    chunks.push(blob)</span><br><span class="line"></span><br><span class="line">    start = end;</span><br><span class="line">    end = start + piece;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> chunks</span><br><span class="line">&#125;</span><br><span class="line">å°†æ–‡ä»¶æ‹†åˆ†æˆpieceå¤§å°çš„åˆ†å—ï¼Œç„¶åæ¯æ¬¡è¯·æ±‚åªéœ€è¦ä¸Šä¼ è¿™ä¸€ä¸ªéƒ¨åˆ†çš„åˆ†å—å³å¯</span><br><span class="line"><span class="keyword">let</span> file =  <span class="built_in">document</span>.querySelector(<span class="string">"[name=file]"</span>).files[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> LENGTH = <span class="number">1024</span> * <span class="number">1024</span> * <span class="number">0.1</span>;</span><br><span class="line"><span class="keyword">let</span> chunks = slice(file, LENGTH); <span class="comment">// é¦–å…ˆæ‹†åˆ†åˆ‡ç‰‡</span></span><br><span class="line"></span><br><span class="line">chunks.forEach(<span class="function"><span class="params">chunk</span>=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">let</span> fd = <span class="keyword">new</span> FormData();</span><br><span class="line">  fd.append(<span class="string">"file"</span>, chunk);</span><br><span class="line">  post(<span class="string">'/mkblk.php'</span>, fd)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ul><li>æ–­ç‚¹ç»­ä¼ <br>å³ä½¿å°†å¤§æ–‡ä»¶æ‹†åˆ†æˆåˆ‡ç‰‡ä¸Šä¼ ï¼Œæˆ‘ä»¬ä»éœ€ç­‰å¾…æ‰€æœ‰åˆ‡ç‰‡ä¸Šä¼ å®Œæ¯•ï¼Œåœ¨ç­‰å¾…è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½å‘ç”Ÿä¸€ç³»åˆ—å¯¼è‡´éƒ¨åˆ†åˆ‡ç‰‡ä¸Šä¼ å¤±è´¥çš„æƒ…å½¢ï¼Œå¦‚ç½‘ç»œæ•…éšœã€é¡µé¢å…³é—­ç­‰ã€‚ç”±äºåˆ‡ç‰‡æœªå…¨éƒ¨ä¸Šä¼ ï¼Œå› æ­¤æ— æ³•é€šçŸ¥æœåŠ¡ç«¯åˆæˆæ–‡ä»¶ã€‚è¿™ç§æƒ…å†µä¸‹å¯ä»¥é€šè¿‡æ–­ç‚¹ç»­ä¼ æ¥è¿›è¡Œå¤„ç†ã€‚<br>æ–­ç‚¹ç»­ä¼ æŒ‡çš„æ˜¯ï¼šå¯ä»¥ä»å·²ç»ä¸Šä¼ éƒ¨åˆ†å¼€å§‹ç»§ç»­ä¸Šä¼ æœªå®Œæˆçš„éƒ¨åˆ†ï¼Œè€Œæ²¡æœ‰å¿…è¦ä»å¤´å¼€å§‹ä¸Šä¼ ï¼ŒèŠ‚çœä¸Šä¼ æ—¶é—´ã€‚<br>ç”±äºæ•´ä¸ªä¸Šä¼ è¿‡ç¨‹æ˜¯æŒ‰åˆ‡ç‰‡ç»´åº¦è¿›è¡Œçš„ï¼Œä¸” mkfile æ¥å£æ˜¯åœ¨æ‰€æœ‰åˆ‡ç‰‡ä¸Šä¼ å®Œæˆåç”±å®¢æˆ·ç«¯ä¸»åŠ¨è°ƒç”¨çš„ï¼Œå› æ­¤æ–­ç‚¹ç»­ä¼ çš„å®ç°ä¹Ÿååˆ†ç®€å•ï¼š</li></ul><p>åœ¨åˆ‡ç‰‡ä¸Šä¼ æˆåŠŸåï¼Œä¿å­˜å·²ä¸Šä¼ çš„åˆ‡ç‰‡ä¿¡æ¯<br>å½“ä¸‹æ¬¡ä¼ è¾“ç›¸åŒæ–‡ä»¶æ—¶ï¼Œéå†åˆ‡ç‰‡åˆ—è¡¨ï¼Œåªé€‰æ‹©æœªä¸Šä¼ çš„åˆ‡ç‰‡è¿›è¡Œä¸Šä¼ <br>æ‰€æœ‰åˆ‡ç‰‡ä¸Šä¼ å®Œæ¯•åï¼Œå†è°ƒç”¨ mkfile æ¥å£é€šçŸ¥æœåŠ¡ç«¯è¿›è¡Œæ–‡ä»¶åˆå¹¶</p><p>å› æ­¤é—®é¢˜å°±è½åœ¨äº†å¦‚ä½•ä¿å­˜å·²ä¸Šä¼ åˆ‡ç‰‡çš„ä¿¡æ¯äº†ï¼Œä¿å­˜ä¸€èˆ¬æœ‰ä¸¤ç§ç­–ç•¥</p><p>å¯ä»¥é€šè¿‡ locaStorage ç­‰æ–¹å¼ä¿å­˜åœ¨å‰ç«¯æµè§ˆå™¨ä¸­ï¼Œè¿™ç§æ–¹å¼ä¸ä¾èµ–äºæœåŠ¡ç«¯ï¼Œå®ç°èµ·æ¥ä¹Ÿæ¯”è¾ƒæ–¹ä¾¿ï¼Œç¼ºç‚¹åœ¨äºå¦‚æœç”¨æˆ·æ¸…é™¤äº†æœ¬åœ°æ–‡ä»¶ï¼Œä¼šå¯¼è‡´ä¸Šä¼ è®°å½•ä¸¢å¤±<br>æœåŠ¡ç«¯æœ¬èº«çŸ¥é“å“ªäº›åˆ‡ç‰‡å·²ç»ä¸Šä¼ ï¼Œå› æ­¤å¯ä»¥ç”±æœåŠ¡ç«¯é¢å¤–æä¾›ä¸€ä¸ªæ ¹æ®æ–‡ä»¶ context æŸ¥è¯¢å·²ä¸Šä¼ åˆ‡ç‰‡çš„æ¥å£ï¼Œåœ¨ä¸Šä¼ æ–‡ä»¶å‰è°ƒç”¨è¯¥æ–‡ä»¶çš„å†å²ä¸Šä¼ è®°å½•<br>ä¸‹é¢è®©æˆ‘ä»¬é€šè¿‡åœ¨æœ¬åœ°ä¿å­˜å·²ä¸Šä¼ åˆ‡ç‰‡è®°å½•ï¼Œæ¥å®ç°æ–­ç‚¹ä¸Šä¼ çš„åŠŸèƒ½</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// è·å–å·²ä¸Šä¼ åˆ‡ç‰‡è®°å½•</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getUploadSliceRecord</span>(<span class="params">context</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">let</span> record = localStorage.getItem(context)</span><br><span class="line">  <span class="keyword">if</span>(!record)&#123;</span><br><span class="line">    <span class="keyword">return</span> []</span><br><span class="line">  &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">JSON</span>.parse(record)</span><br><span class="line">    &#125;<span class="keyword">catch</span>(e)&#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ä¿å­˜å·²ä¸Šä¼ åˆ‡ç‰‡</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">saveUploadSliceRecord</span>(<span class="params">context, sliceIndex</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">let</span> list = getUploadSliceRecord(context)</span><br><span class="line">  list.push(sliceIndex)</span><br><span class="line">  localStorage.setItem(context, <span class="built_in">JSON</span>.stringify(list))</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ç„¶åå¯¹ä¸Šä¼ é€»è¾‘ç¨ä½œä¿®æ”¹ï¼Œä¸»è¦æ˜¯å¢åŠ ä¸Šä¼ å‰æ£€æµ‹æ˜¯å·²ç»ä¸Šä¼ ã€ä¸Šä¼ åä¿å­˜è®°å½•çš„é€»è¾‘</span></span><br><span class="line"><span class="keyword">let</span> context = createContext(file);</span><br><span class="line"><span class="comment">// è·å–ä¸Šä¼ è®°å½•</span></span><br><span class="line"><span class="keyword">let</span> record = getUploadSliceRecord(context);</span><br><span class="line"><span class="keyword">let</span> tasks = [];</span><br><span class="line">chunks.forEach(<span class="function">(<span class="params">chunk, index</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// å·²ä¸Šä¼ çš„åˆ‡ç‰‡åˆ™ä¸å†é‡æ–°ä¸Šä¼ </span></span><br><span class="line">  <span class="keyword">if</span>(record.includes(index))&#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> fd = <span class="keyword">new</span> FormData();</span><br><span class="line">  fd.append(<span class="string">"file"</span>, chunk);</span><br><span class="line">  fd.append(<span class="string">"context"</span>, context);</span><br><span class="line">  fd.append(<span class="string">"chunk"</span>, index + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> task = post(<span class="string">"/mkblk.php"</span>, fd).then(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">// ä¸Šä¼ æˆåŠŸåä¿å­˜å·²ä¸Šä¼ åˆ‡ç‰‡è®°å½•</span></span><br><span class="line">    saveUploadSliceRecord(context, index)</span><br><span class="line">    record.push(index)</span><br><span class="line">  &#125;)</span><br><span class="line">  tasks.push(task);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ä¸Šä¼ æ—¶åˆ·æ–°é¡µé¢æˆ–è€…å…³é—­æµè§ˆå™¨ï¼Œå†æ¬¡ä¸Šä¼ ç›¸åŒæ–‡ä»¶æ—¶ï¼Œä¹‹å‰å·²ç»ä¸Šä¼ æˆåŠŸçš„åˆ‡ç‰‡å°±ä¸ä¼šå†é‡æ–°ä¸Šä¼ äº†ã€‚<br>æœåŠ¡ç«¯å®ç°æ–­ç‚¹ç»­ä¼ çš„é€»è¾‘åŸºæœ¬ç›¸ä¼¼ï¼Œåªè¦åœ¨ getUploadSliceRecord å†…éƒ¨è°ƒç”¨æœåŠ¡ç«¯çš„æŸ¥è¯¢æ¥å£è·å–å·²ä¸Šä¼ åˆ‡ç‰‡çš„è®°å½•å³å¯ï¼Œå› æ­¤è¿™é‡Œä¸å†å±•å¼€ã€‚<br>æ­¤å¤–æ–­ç‚¹ç»­ä¼ è¿˜éœ€è¦è€ƒè™‘åˆ‡ç‰‡è¿‡æœŸçš„æƒ…å†µï¼šå¦‚æœè°ƒç”¨äº† mkfile æ¥å£ï¼Œåˆ™ç£ç›˜ä¸Šçš„åˆ‡ç‰‡å†…å®¹å°±å¯ä»¥æ¸…é™¤æ‰äº†ï¼Œå¦‚æœå®¢æˆ·ç«¯ä¸€ç›´ä¸è°ƒç”¨ mkfile çš„æ¥å£ï¼Œæ”¾ä»»è¿™äº›åˆ‡ç‰‡ä¸€ç›´ä¿å­˜åœ¨ç£ç›˜æ˜¾ç„¶æ˜¯ä¸å¯é çš„ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåˆ‡ç‰‡ä¸Šä¼ éƒ½æœ‰ä¸€æ®µæ—¶é—´çš„æœ‰æ•ˆæœŸï¼Œè¶…è¿‡è¯¥æœ‰æ•ˆæœŸï¼Œå°±ä¼šè¢«æ¸…é™¤æ‰ã€‚åŸºäºä¸Šè¿°åŸå› ï¼Œæ–­ç‚¹ç»­ä¼ ä¹Ÿå¿…é¡»åŒæ­¥åˆ‡ç‰‡è¿‡æœŸçš„å®ç°é€»è¾‘ã€‚</p><h3 id="ä¸Šä¼ è¿›åº¦å’Œæš‚åœ"><a href="#ä¸Šä¼ è¿›åº¦å’Œæš‚åœ" class="headerlink" title="ä¸Šä¼ è¿›åº¦å’Œæš‚åœ"></a>ä¸Šä¼ è¿›åº¦å’Œæš‚åœ</h3><p>é€šè¿‡ xhr.upload ä¸­çš„ progress æ–¹æ³•å¯ä»¥å®ç°ç›‘æ§æ¯ä¸€ä¸ªåˆ‡ç‰‡ä¸Šä¼ è¿›åº¦ã€‚<br>ä¸Šä¼ æš‚åœçš„å®ç°ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œé€šè¿‡ xhr.abort å¯ä»¥å–æ¶ˆå½“å‰æœªå®Œæˆä¸Šä¼ åˆ‡ç‰‡çš„ä¸Šä¼ ï¼Œå®ç°ä¸Šä¼ æš‚åœçš„æ•ˆæœï¼Œæ¢å¤ä¸Šä¼ å°±è·Ÿæ–­ç‚¹ç»­ä¼ ç±»ä¼¼ï¼Œå…ˆè·å–å·²ä¸Šä¼ çš„åˆ‡ç‰‡åˆ—è¡¨ï¼Œç„¶åé‡æ–°å‘é€æœªä¸Šä¼ çš„åˆ‡ç‰‡ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">xhr.upload.onprogress = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (event.lengthComputable) &#123;</span><br><span class="line">    <span class="keyword">var</span> percentComplete = (event.loaded / event.total) * <span class="number">100</span></span><br><span class="line">    <span class="comment">// å¯¹è¿›åº¦è¿›è¡Œå¤„ç†</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­äº‹ä»¶çš„ lengthComputable å±æ€§ä»£è¡¨æ–‡ä»¶æ€»å¤§å°æ˜¯å¦å¯çŸ¥ã€‚å¦‚æœ lengthComputable å±æ€§çš„å€¼æ˜¯ falseï¼Œé‚£ä¹ˆæ„å‘³ç€æ€»å­—èŠ‚æ•°æ˜¯æœªçŸ¥å¹¶ä¸” total çš„å€¼ä¸ºé›¶ã€‚</p><p>å¦‚æœæ˜¯ç°ä»£æµè§ˆå™¨ï¼Œå¯ä»¥ç›´æ¥é…åˆ HTML5 æä¾›çš„</p><progress id="myProgress" value="50" max="100"></progress><h3 id="å›¾ç‰‡é¢„è§ˆ"><a href="#å›¾ç‰‡é¢„è§ˆ" class="headerlink" title="å›¾ç‰‡é¢„è§ˆ"></a>å›¾ç‰‡é¢„è§ˆ</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">handleImageFile</span>(<span class="params">file</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> previewArea = <span class="built_in">document</span>.getElementById(<span class="string">'previewArea'</span>)</span><br><span class="line">  <span class="keyword">var</span> img = <span class="built_in">document</span>.createElement(<span class="string">'img'</span>)</span><br><span class="line">  <span class="keyword">var</span> fileInput = <span class="built_in">document</span>.getElementById(<span class="string">'myFile'</span>)</span><br><span class="line">  <span class="keyword">var</span> file = fileInput.files[<span class="number">0</span>]</span><br><span class="line">  img.file = file</span><br><span class="line">  previewArea.appendChild(img)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> reader = <span class="keyword">new</span> FileReader()</span><br><span class="line">  reader.onload = (<span class="function"><span class="keyword">function</span>(<span class="params">aImg</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">      aImg.src = e.target.result</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)(img)</span><br><span class="line">  reader.readAsDataURL(file)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ FileReader æ¥å¤„ç†å›¾ç‰‡çš„å¼‚æ­¥åŠ è½½ã€‚åœ¨åˆ›å»ºæ–°çš„ FileReader å¯¹è±¡ä¹‹åï¼Œæˆ‘ä»¬å»ºç«‹äº† onload å‡½æ•°ï¼Œç„¶åè°ƒç”¨ readAsDataURL()å¼€å§‹åœ¨åå°è¿›è¡Œè¯»å–æ“ä½œã€‚å½“å›¾åƒæ–‡ä»¶åŠ è½½åï¼Œè½¬æ¢æˆä¸€ä¸ª data: URLï¼Œå¹¶ä¼ é€’åˆ° onload å›è°ƒå‡½æ•°ä¸­è®¾ç½®ç»™ img çš„ srcã€‚<br>è¯¥å‡½æ•°å¯ä»¥å¸®åŠ©å®ç°é¢„è§ˆä»¥åŠå‹ç¼©å›¾ç‰‡çš„åŠŸèƒ½</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">å¦å¤–æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ä½¿ç”¨å¯¹è±¡URLæ¥å®ç°é¢„è§ˆ</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> img = <span class="built_in">document</span>.createElement(<span class="string">'img'</span>)</span><br><span class="line">img.src = <span class="built_in">window</span>.URL.createObjectURL(file)</span><br><span class="line">img.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// æ˜ç¡®åœ°é€šè¿‡è°ƒç”¨é‡Šæ”¾</span></span><br><span class="line">  <span class="built_in">window</span>.URL.revokeObjectURL(<span class="keyword">this</span>.src)</span><br><span class="line">&#125;</span><br><span class="line">previewArea.appendChild(img)</span><br></pre></td></tr></table></figure><h3 id="å¤šæ–‡ä»¶æ”¯æŒ"><a href="#å¤šæ–‡ä»¶æ”¯æŒ" class="headerlink" title="å¤šæ–‡ä»¶æ”¯æŒ"></a>å¤šæ–‡ä»¶æ”¯æŒ</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;input id=<span class="string">"myFile"</span> type=<span class="string">"file"</span> multiple&gt;</span><br><span class="line"><span class="comment">// æˆ‘ä»¬å°±èƒ½åœ¨æ‰“å¼€çš„æ–‡ä»¶é€‰æ‹©å¯¹è¯æ¡†ä¸­é€‰ä¸­å¤šä¸ªæ–‡ä»¶äº†ã€‚ç„¶åä½ åœ¨ä»£ç é‡Œæ‹¿åˆ°çš„FileUploadå¯¹è±¡çš„fileså±æ€§å°±æ˜¯ä¸€ä¸ªé€‰ä¸­çš„å¤šæ–‡ä»¶çš„æ•°ç»„äº†ã€‚</span></span><br><span class="line"><span class="keyword">var</span> fileInput = <span class="built_in">document</span>.getElementById(<span class="string">"myFile"</span>);</span><br><span class="line"><span class="keyword">var</span> files = fileInput.files;</span><br><span class="line"><span class="keyword">var</span> formData = <span class="keyword">new</span> FormData();</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; files.length; i++) &#123;</span><br><span class="line"><span class="keyword">var</span> file = files[i];</span><br><span class="line">formData.append(<span class="string">'files[]'</span>, file, file.name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>FormDataçš„appendæ–¹æ³•æä¾›ç¬¬ä¸‰ä¸ªå¯é€‰å‚æ•°ç”¨äºæŒ‡å®šæ–‡ä»¶åï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªè¡¨å•é¡¹åï¼Œç„¶åç”¨æ–‡ä»¶ååŒºåˆ†ä¸Šä¼ çš„å¤šä¸ªæ–‡ä»¶ã€‚è¿™æ ·ä¹Ÿæ–¹ä¾¿å‰åå°çš„å¾ªç¯æ“ä½œã€‚</p><h3 id="å›¾ç‰‡å‹ç¼©"><a href="#å›¾ç‰‡å‹ç¼©" class="headerlink" title="å›¾ç‰‡å‹ç¼©"></a>å›¾ç‰‡å‹ç¼©</h3><p>ä½¿ç”¨filereaderè¯»å–åˆ°å›¾ç‰‡ä¹‹åä½¿ç”¨canvaså‹ç¼©å›¾ç‰‡çš„å°ºå¯¸</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">compress (data, callback) &#123;</span><br><span class="line">       <span class="comment">/**</span></span><br><span class="line"><span class="comment">        * å‹ç¼©å›¾ç‰‡</span></span><br><span class="line"><span class="comment">        * @param data fileæ–‡ä»¶ æ•°æ®ä¼šä¸€ç›´å‘ä¸‹ä¼ é€’</span></span><br><span class="line"><span class="comment">        * @param callback ä¸‹ä¸€æ­¥å›è°ƒ</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">       <span class="keyword">const</span> &#123;compressionRatio&#125; = <span class="keyword">this</span>.props;</span><br><span class="line">       <span class="keyword">const</span> imgFile = data.file;</span><br><span class="line">       <span class="keyword">const</span> img = <span class="keyword">new</span> <span class="built_in">window</span>.Image();</span><br><span class="line"></span><br><span class="line">       img.src = data.dataUrl;</span><br><span class="line"></span><br><span class="line">       img.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">           <span class="keyword">const</span> canvas = <span class="built_in">document</span>.createElement(<span class="string">'canvas'</span>);</span><br><span class="line">           <span class="keyword">const</span> ctx = canvas.getContext(<span class="string">'2d'</span>);</span><br><span class="line"></span><br><span class="line">           canvas.width = img.width;</span><br><span class="line">           canvas.height = img.height;</span><br><span class="line"></span><br><span class="line">           ctx.drawImage(img, <span class="number">0</span>, <span class="number">0</span>, canvas.width, canvas.height);</span><br><span class="line"></span><br><span class="line">           <span class="keyword">let</span> compressedDataUrl;</span><br><span class="line"></span><br><span class="line">           <span class="keyword">if</span>(data.compress)&#123;</span><br><span class="line">               compressedDataUrl = canvas.toDataURL(imgFile.type, (compressionRatio / <span class="number">100</span>));</span><br><span class="line">           &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">               compressedDataUrl = canvas.toDataURL(imgFile.type, <span class="number">1</span>);</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           data.compressedDataUrl = compressedDataUrl;</span><br><span class="line"></span><br><span class="line">           callback(data);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h3 id="ç»“åˆ-xhr-çš„-progress-äº‹ä»¶å®ç°ä¸Šä¼ è¿›åº¦æ¡"><a href="#ç»“åˆ-xhr-çš„-progress-äº‹ä»¶å®ç°ä¸Šä¼ è¿›åº¦æ¡" class="headerlink" title="ç»“åˆ xhr çš„ progress äº‹ä»¶å®ç°ä¸Šä¼ è¿›åº¦æ¡"></a>ç»“åˆ xhr çš„ progress äº‹ä»¶å®ç°ä¸Šä¼ è¿›åº¦æ¡</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">uploadImg (data, formData) &#123;</span><br><span class="line">        <span class="comment">// å¼€å§‹å‘é€è¯·æ±‚ä¸Šä¼ </span></span><br><span class="line">        <span class="keyword">const</span> _this = <span class="keyword">this</span>;</span><br><span class="line">        <span class="keyword">const</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">        <span class="keyword">const</span> &#123;uploadUrl&#125; = <span class="keyword">this</span>.props;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¿›åº¦ç›‘å¬</span></span><br><span class="line">        xhr.upload.addEventListener(<span class="string">'progress'</span>, _this.handleProgress.bind(_this, data.uuid), <span class="literal">false</span>);</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">        xhr.open(<span class="string">'POST'</span>, uploadUrl , <span class="literal">true</span>);</span><br><span class="line">        xhr.send(formData);</span><br><span class="line">    &#125;</span><br><span class="line"> handleProgress (id, e) &#123;</span><br><span class="line">        <span class="comment">// ç›‘å¬ä¸Šä¼ è¿›åº¦ æ“ä½œDOM æ˜¾ç¤ºè¿›åº¦</span></span><br><span class="line">        <span class="keyword">const</span> number = <span class="built_in">Number</span>.parseInt((e.loaded / e.total) * <span class="number">100</span>) + <span class="string">"%"</span>;</span><br><span class="line">        <span class="keyword">const</span> text = <span class="built_in">document</span>.querySelector(<span class="string">'#text-'</span>+id);</span><br><span class="line">        <span class="keyword">const</span> progress = <span class="built_in">document</span>.querySelector(<span class="string">'#progress-'</span>+id);</span><br><span class="line"></span><br><span class="line">        text.innerHTML = number;</span><br><span class="line">        progress.style.width = number;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="ä¸Šä¼ å¤šä¸ªæ–‡ä»¶"><a href="#ä¸Šä¼ å¤šä¸ªæ–‡ä»¶" class="headerlink" title="ä¸Šä¼ å¤šä¸ªæ–‡ä»¶"></a>ä¸Šä¼ å¤šä¸ªæ–‡ä»¶</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">*uploadGenerator (uploadQueue) &#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * å¤šå¼ å›¾ç‰‡å¹¶å‘ä¸Šä¼ æ§åˆ¶è§„åˆ™</span></span><br><span class="line"><span class="comment">         * ä¸Šä¼ 1-maxæ•°é‡çš„å›¾ç‰‡</span></span><br><span class="line"><span class="comment">         * è®¾ç½®ä¸€ä¸ªæœ€å¤§ä¸Šä¼ æ•°é‡</span></span><br><span class="line"><span class="comment">         * ä¿è¯æœ€å¤§åªæœ‰è¿™ä¸ªæ•°é‡çš„ä¸Šä¼ è¯·æ±‚</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// æœ€å¤šåªæœ‰ä¸‰ä¸ªè¯·æ±‚åœ¨ä¸Šä¼ </span></span><br><span class="line">        <span class="keyword">const</span> maxUploadSize = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(uploadQueue.length &gt; maxUploadSize)&#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> result = [];</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; uploadQueue.length; i++)&#123;</span><br><span class="line">                <span class="comment">// ç¬¬ä¸€æ¬¡return maxUploadSizeæ•°é‡çš„å›¾ç‰‡</span></span><br><span class="line">                <span class="keyword">if</span>(i &lt; maxUploadSize)&#123;</span><br><span class="line">                    result.push(uploadQueue[i]);</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span>(i === maxUploadSize - <span class="number">1</span>)&#123;</span><br><span class="line">                        <span class="keyword">yield</span> result;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">yield</span> [uploadQueue[i]];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">yield</span> uploadQueue.map(<span class="function">(<span class="params">item</span>)=&gt;</span>(item));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// è°ƒç”¨</span></span><br><span class="line"><span class="comment">// é€šè¿‡è¯¥å‡½æ•°è·å–æ¯æ¬¡è¦ä¸Šä¼ çš„æ•°ç»„</span></span><br><span class="line">        <span class="keyword">this</span>.uploadGen = <span class="keyword">this</span>.uploadGenerator(uploadQueue);</span><br><span class="line">        <span class="comment">// ç¬¬ä¸€æ¬¡è¦ä¸Šä¼ çš„æ•°é‡</span></span><br><span class="line">        <span class="keyword">const</span> firstUpload = <span class="keyword">this</span>.uploadGen.next();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// çœŸæ­£å¼€å§‹ä¸Šä¼ æµç¨‹</span></span><br><span class="line">        firstUpload.value.map(<span class="function">(<span class="params">item</span>)=&gt;</span>&#123;</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * å›¾ç‰‡ä¸Šä¼ åˆ†æˆ5æ­¥</span></span><br><span class="line"><span class="comment">             * å›¾ç‰‡è½¬dataUrl</span></span><br><span class="line"><span class="comment">             * å‹ç¼©</span></span><br><span class="line"><span class="comment">             * å¤„ç†æ•°æ®æ ¼å¼</span></span><br><span class="line"><span class="comment">             * å‡†å¤‡æ•°æ®ä¸Šä¼ </span></span><br><span class="line"><span class="comment">             * ä¸Šä¼ </span></span><br><span class="line"><span class="comment">             *</span></span><br><span class="line"><span class="comment">             * å‰ä¸¤æ­¥æ˜¯å›è°ƒçš„å½¢å¼ åé¢æ˜¯åŒæ­¥çš„å½¢å¼</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="keyword">this</span>.transformFileToDataUrl(item, <span class="keyword">this</span>.compress, <span class="keyword">this</span>.processData);</span><br><span class="line">        &#125;);</span><br><span class="line"><span class="comment">// ä¸Šä¼ ä¸‹ä¸€ä¸ª function uploadImg</span></span><br><span class="line">xhr.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (xhr.readyState === <span class="number">4</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (xhr.status === <span class="number">200</span> || xhr.status === <span class="number">201</span>) &#123;</span><br><span class="line">                    <span class="comment">// ä¸Šä¼ æˆåŠŸ</span></span><br><span class="line">                    _this.handleUploadEnd(data, <span class="number">2</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// ä¸Šä¼ å¤±è´¥</span></span><br><span class="line">                    _this.handleUploadEnd(data, <span class="number">3</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"><span class="comment">// function handleuploadend</span></span><br><span class="line"> <span class="keyword">const</span> nextUpload = <span class="keyword">this</span>.uploadGen.next();</span><br><span class="line">        <span class="keyword">if</span>(!nextUpload.done)&#123;</span><br><span class="line">            nextUpload.value.map(<span class="function">(<span class="params">item</span>)=&gt;</span>&#123;</span><br><span class="line">                _this.transformFileToDataUrl(item, _this.compress, _this.processData);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><h3 id="ç§»åŠ¨ç«¯ä¸Šä¼ æ–‡ä»¶çš„å…¼å®¹æ€§é—®é¢˜"><a href="#ç§»åŠ¨ç«¯ä¸Šä¼ æ–‡ä»¶çš„å…¼å®¹æ€§é—®é¢˜" class="headerlink" title="ç§»åŠ¨ç«¯ä¸Šä¼ æ–‡ä»¶çš„å…¼å®¹æ€§é—®é¢˜"></a>ç§»åŠ¨ç«¯ä¸Šä¼ æ–‡ä»¶çš„å…¼å®¹æ€§é—®é¢˜</h3><p>éƒ¨åˆ†å®‰å“å¾®ä¿¡æµè§ˆå™¨æ— æ³•è§¦å‘ onchange äº‹ä»¶ï¼ˆç¬¬ä¸€æ­¥å°±ç‰¹ä¹ˆé‡åˆ°é—®é¢˜ï¼‰<br>è¿™å…¶å®å®‰å“å¾®ä¿¡çš„ä¸€ä¸ªé—ç•™é—®é¢˜ã€‚ æŸ¥çœ‹è®¨è®º è§£å†³åŠæ³•ä¹Ÿå¾ˆç®€å•ï¼šinput æ ‡ç­¾ &lt;input type=â€œfileâ€ name=â€imageâ€ accept=â€image/gif, image/jpeg, image/pngâ€&gt;è¦å†™æˆ<input type="file" name="image" accept="â€œimage/*â€">å°±æ²¡é—®é¢˜äº†ã€‚<br>éƒ¨åˆ†å®‰å“å¾®ä¿¡ä¸æ”¯æŒ Blob å¯¹è±¡<br>éƒ¨åˆ† Blob å¯¹è±¡ append è¿› FormData ä¸­å‡ºç°é—®é¢˜<br>iOS 8 ä¸æ”¯æŒ new File Constructorï¼Œä½†æ˜¯æ”¯æŒ input é‡Œçš„ file å¯¹è±¡ã€‚<br>iOS ä¸Šç»è¿‡å‹ç¼©åçš„å›¾ç‰‡å¯ä»¥ä¸Šä¼ æˆåŠŸ ä½†æ˜¯ size æ˜¯ 0 æ— æ³•æ‰“å¼€ã€‚<br>éƒ¨åˆ†æ‰‹æœºå‡ºç°å›¾ç‰‡ä¸Šä¼ è½¬æ¢é—®é¢˜ï¼Œè¯·ç§»æ­¥ã€‚<br>å®‰å“æ‰‹æœºä¸æ”¯æŒå¤šé€‰ï¼ŒåŸå› åœ¨äº multiple å±æ€§æ ¹æœ¬å°±ä¸æ”¯æŒã€‚<br>å¤šå¼ å›¾ç‰‡è½¬ base64 æ—¶å€™å¡é¡¿ï¼Œå› ä¸ºè°ƒç”¨äº† cpu è¿›è¡Œäº†è®¡ç®—ã€‚<br>ä¸Šä¼ å›¾ç‰‡å¯ä»¥ä½¿ç”¨ base64 ä¸Šä¼ æˆ–è€… formData ä¸Šä¼ </p><ul><li>è§£å†³å¯¹ç­–<br><img src="https://image-static.segmentfault.com/620/361/62036185-595a6630913f2_articlex" alt="img"></li></ul><h3 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h3><ul><li><a href="https://segmentfault.com/a/1190000010034177" target="_blank" rel="noopener">ç§»åŠ¨ç«¯ H5 å®ç°å›¾ç‰‡ä¸Šä¼ </a></li></ul><h3 id="æ¯æ—¥å°çŸ¥è¯†ç‚¹"><a href="#æ¯æ—¥å°çŸ¥è¯†ç‚¹" class="headerlink" title="æ¯æ—¥å°çŸ¥è¯†ç‚¹"></a>æ¯æ—¥å°çŸ¥è¯†ç‚¹</h3><ul><li>é€‰å–ç¬¬ä¸€ä¸ªåˆ°å€’æ•°ç¬¬äºŒä¸ªå…ƒç´ <blockquote><p>aaa.slice(0,-1)</p></blockquote></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> åŸºç¡€æŠ€èƒ½ </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
